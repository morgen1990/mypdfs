window.bubble_bundle_name = 'run_debug';
(function(){function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,(function(e){var n=t[o][1][e];return i(n||e)}),u,u.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}return e})()({1:[function(e,t,n){t.exports={ADMIN_EMAIL:"admin@bubble.io",ADMIN_NO_REPLY:"admin-no-reply@bubbleapps.io",MAX_ALLOWED_REQUEST:5e4,MAX_LIST_LENGTH:1e4,PROD_DOMAINS:{main:"bubble.io",old:"bubble.is"},REQUEST_TTL:36e5,SUPPORT_EMAIL:"support@bubble.io",SUPPORT_NAME:"Bubble Support",a_record_ip:"54.203.28.28",amplitude_experiment_key:"client-mzmGCQlKvIat72aRwurU9POklOVWqQYc",amplitude_experiments_enabled:true,apps_domain:"bubbleapps.io",braintree_partner_code:"Bubble_SP",breaking_revision:5,browser_console_log_level:"error",cdn_host:"d3dqmih97rcqmh.cloudfront.net",commit_sha:"a7860c02ae38b3decdb8f8467379bef952223871",commit_timestamp:1689611028e3,database_query_limit:200,env:"prod",environment_name:"main",firebase_app_config:{apiKey:"AIzaSyDVlyff9gf_eG2kq_OTfhUytinKJ619FrM",appId:"1:380032246750:web:50d6f5f804d7ce281e334f",authDomain:"bubble-workflow.firebaseapp.com",databaseURL:"https://bubble-workflow.firebaseio.com",messagingSenderId:"380032246750",projectId:"bubble-workflow",storageBucket:"bubble-workflow.appspot.com"},hide_export_bulk_operation:true,image_optimization_service:"d1muf25xaso8hp.cloudfront.net",is_clustered:true,max_api_bulk_post:1e3,max_new_list_length:100,meta_billing_api_endpoint:"https://bubble.io/api/1.1/",meta_upload_tracking_api_endpoint:"https://bubble.io/api/1.1/",notifier_domain:"main",notifier_host:"notify.bubble.is",otel_log_events_flag:true,page_speed_metrics_on:true,paid_features:true,plugin_commission:.75,plugins_live_here:true,private_version_prefix:"p_",use_analytics:true,use_cloudflare:true,user_file_bucket:"appforest_uf",user_file_cdn:"a3f482aa37473c68f97b76bd2e4a3782.cdn.bubble.io/",user_file_url:"s3.amazonaws.com/appforest_uf/"}},{}],2:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("../u");const i=e("../logger");const s=e("../u/shared/async/b_fiber");const o=e("../u/shared/incremental");const a=e("../lang/btypes");const l=e("../lang/btype_ids");const c=e("../external/StructValue");const u=e("../db/values/StaticObject");const d=e("../db/values/StaticList");const p=e("../constants/apiconnectorbase");class _ extends c{constructor(e,t,n,i){var s;(s=n)!=null?s:n={};const o={extract(e){return r.incremental_json_stringify(e.body)},caption:"raw body text",ret_value:"text"};const a=Object.assign(t,{body_raw_text:o});super(e,a,n);this.key_prefix=i}get_message_names(){var e;return Object.entries((e=this._fields())!=null?e:{}).filter((e=>{let[t,n]=e;return n.ret_value!==p.IGNORE_FIELD})).map((e=>{let[t]=e;return t}))}flatten_raw(e){if(!e){return{}}const t={};const n=this._fields();for(const s in n){const p=n[s];o.optional_pause_tick(20,`flatten raw call field key (${s})`);let _;if(p.extract){_=p.extract(e)}else if(p.no_key){_=e}else{var i;const t=(i=p.path)!=null?i:[s.replace(this.key_prefix,"")];_=r.extract_from_object(e,t)}if(p.post_call_processing){_=p.post_call_processing(_,e)}if(_!=null&&typeof _!=="function"){if(p.ret_value){const e=a.get(p.ret_value);if(l.is_list(p.ret_value)&&Array.isArray(_)){const t=e.inner();if(t.is_missing()){throw new r.OwnerError("Issue with call",{display:"Issue with the call "+this.human+". Please initialize it again"})}_=_.map((e=>{var n,r,i;return(n=(r=(i=t.plugin).extract)==null?void 0:r.call(i,e))!=null?n:e}))}else{var c,u,d;if(e.is_missing()){throw new r.OwnerError("Issue with call",{display:"Issue with the call "+this.human+". Please initialize it again"})}_=(c=(u=(d=e.plugin).extract)==null?void 0:u.call(d,_))!=null?c:_}}t[s]=_}}s.optional_pause("finished flatten raw");return t}convert_to_bubble_instance(e){let t,n;if(Array.isArray(e)){t=[];n=a.get(this.full_name);if(n.plugin.convert_to_bubble_instance){for(const r of e){t.push(n.plugin.convert_to_bubble_instance(r))}return new d(t,undefined,this.full_name)}else{return new d(e,undefined,this.full_name)}}else if(e!=null&&typeof e==="object"){t={};const c=this._fields();for(const u in c){const d=c[u];n=a.get(d.ret_value);if(l.is_list(d.ret_value)&&Array.isArray(e[u])){const r=n.inner();if(r.plugin instanceof _){t[u]=r.plugin.convert_to_bubble_instance(e[u])}else{t[u]=n.cast(e[u])}}else{var r,s,o;if(n.is_missing()){i.owner_error("Missing API connector response type data",{display:`Cannot properly interpret response from API call ${this.human}, please reinitialize the call`})}t[u]=(r=(s=(o=n.plugin).convert_to_bubble_instance)==null?void 0:s.call(o,e[u]))!=null?r:e[u]}}t._id=e._id;return new u(t,undefined,this.full_name)}else{return e}}export_to_string(){return"(data from API connector)"}}t.exports=_},{"../constants/apiconnectorbase":43,"../db/values/StaticList":471,"../db/values/StaticObject":473,"../external/StructValue":603,"../lang/btype_ids":652,"../lang/btypes":653,"../logger":744,"../u":823,"../u/shared/async/b_fiber":833,"../u/shared/incremental":848,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],3:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i,s,o,a,l,c,u,d,p;function _(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const f=e("lodash/isEqual");const h=e("../u");const m=e("../lib");const g=e("../lang/caching");const v=e("../constants/plugin");const b=e("../shared/external_api_utilities");const y=e("../lang/btype_ids");const w=e("../external/ExternalCall");const x=e("../external/ExternalService");const j=e("../external/StructValue");const A=e("./call_objects");const M=e("./call_btypes");const E=e("./post_processing");const k=e("./xml_to_json");let O=(r=g.cached({type:g.AUTORUN}),i=g.cached({type:g.AUTORUN}),s=g.cached({type:g.AUTORUN}),o=g.cached({type:g.AUTORUN}),a=g.cached({type:g.AUTORUN}),l=g.cached({type:g.AUTORUN}),c=g.cached({type:g.AUTORUN}),u=g.cached({type:g.AUTORUN,compare_fn(e,t){if(e!=null&&e.call_raw_data&&t!=null&&t.call_raw_data){return f(e.call_raw_data,t.call_raw_data)}return h.compare(e,t)}}),d=g.cached({type:g.AUTORUN}),p=class e extends x{get dynamic_calls(){return true}public_values(){const e=[];const t=this.get_all_apis();for(const n in t){const r=t[n];for(const t in r.calls){const n=r.calls[t];if(n.initialized){if(n.no_types){continue}for(const t in n.types){e.push(t)}}}}return e}values(){const e={};const t=this.get_all_apis();for(const n in t){const r=t[n];if(r.auth==="oauth2_user"){e[n+"_oauth_profile"]=new j("Profile "+r.human,{id:{path:r.id_path!=null?r.id_path.split("."):undefined},email:{path:r.email_path!=null?r.email_path.split("."):undefined}})}M.get_btypes_from_call(n,r,e,this.key_prefix)}return e}public_calls(){return this._get_sorted_list("data")}action_calls(){return this._get_sorted_list("action")}user_calls(){const e=[];const t=this.get_all_apis();for(const n in t){const r=t[n];if(r.auth==="oauth2_user"){e.push(n+"_oauth_user_data_call")}}return e}oauth_providers(){const e=[];const t=this.get_all_apis();for(const n in t){const r=t[n];if(r.auth==="oauth2_user"){e.push({id:this.BASE+v.PLUGIN_SEPARATOR+n,display:"API - "+r.human})}}return e}get do_not_report_error(){return true}get_call_class(e){const t=this.calls()[e];if(t==null){return}if(e.indexOf("_oauth_user_data_call")!==-1||e==="TestAPICall"){return t}else{return A.get_call_from_raw(e.split(".")[1],t,this.plugin_name,this.BASE)}}get_call(e){const t=this._instantiate_call(e,this.get_call_class(e));if(!t&&!m().is_edit_mode()&&e.indexOf("_oauth_user_data_call")===-1){throw new h.OwnerError("missing call",{display:this.plugin_name+" error: the call "+e+" is missing, please reinitialize your calls."})}return t}calls(){const e={};const{BASE:t}=this;const{plugin_name:n}=this;const r=this.get_all_apis();for(const i in r){const s=r[i];if(s.auth==="oauth2_user"){const r=i+"_oauth_user_data_call";e[r]=class extends w{get human(){return s.human}get _must_proxy(){return true}get value_id(){return y.api_type(t+"."+i+"_oauth_profile")}build(e,t){if(!s.oauth_user_data_call){return{dont_do_call:true,message:n+" error: the User profile endpoint is missing, please check your configuration.",force_error_message:true}}const r=s.oauth_user_data_call;return{path:r}}get_authenticator(){return this.service().get_authenticator(i)}}}for(const t in s.calls){const n=s.calls[t];n.api_human=s.human;n.api_id=i;e[i+"."+t]=n}}e.TestAPICall=class e extends w{get _must_proxy(){return true}get skip_property_security(){return true}build(e,t,r){const{call_id:i,api_obj:s}=t;const o=s.calls[i];o.initialize_mode=true;return A.generate_request_from_call_data(o,undefined,n)}execute(t,n,r,i,s){return m.extend({appname:n.appname,app_version:n.app_version,is_edit_mode(){return true}},(()=>{let o,a,l;let c;if(h.on_client()){return Object.getPrototypeOf(e.prototype).execute.call(this,t,n,r,i,s)}const{call_id:u,api_obj:d,api_id:p}=n;const _=d.calls[u];this.get_authenticator=function(){return this.service().get_authenticator(p,d)};try{a=this.build_request(t,n,r)}catch(e){o=e;if(o instanceof h.ExpectedError){throw o}else{throw new h.OwnerError("Token generation error",{display:o.message,original:o})}}if(a.dont_do_call){throw new h.UserError(null,a.message)}try{l=m().http_request(a).block()}catch(e){o=e;if(o instanceof h.BubbleError){c=o.message}else{c=h.json_stringify(o,true)}const t="Raw error for the API \n"+c;throw new h.UserError(null,t,{original:o})}let{headers:f,body:g}=l;if(l.statusCode>299||l.statusCode<200){let e;if(g.toString!=null){e=g.toString("utf8")}else{e=h.json_stringify(g,true)}if([null,undefined,""].includes(e)){e=l.statusMessage}e=`Status code ${l.statusCode}\n${e}`;throw new h.OwnerError("Unexpected status code",{display:"Raw response for the API \n"+e})}let{data_type:v}=_;if(!v){v="json"}const b={data_type:v,passed_url:_.url,api_human:_.api_human,name:_.name,get_headers:_.get_headers,wrap_error:_.wrap_error};if(_.data_type==="XML"){try{g=k(g);f["content-type"]="application/json";delete f["content-length"]}catch(e){throw new h.OwnerError("There was an issue parsing the XML body")}}return E(n,l,a,b,true)}))}};return e}constructor(){super();this.keys={}}handle_request_failures(e){return b.handle_request_failures(e)}_get_sorted_list(e){const t=[];let n=0;const r=this.get_all_apis();for(const o in r){const a=r[o];for(const r in a.calls){var i,s;const l=a.calls[r];(i=l.publish_as)!=null?i:l.publish_as="data";if(l.publish_as!==e||!A.is_call_initialized(l)){continue}t.push({id:o+"."+r,rank:(s=l.rank)!=null?s:n});n++}}t.sort(((e,t)=>{if(e.rank<t.rank){return-1}else{return 1}}));return t.map((e=>e.id))}base_url(){return""}response_to_data(e,t,n,r){const i=super.response_to_data(e,t,n,r,r==null?void 0:r.wrap_error);if(r!=null&&r.get_headers||r!=null&&r.wrap_error){const{headers:e}=t;return{body:i,headers:e}}return i}get_error_message(e,t){return A.get_error_message(e,t)}},_(p.prototype,"public_values",[r],Object.getOwnPropertyDescriptor(p.prototype,"public_values"),p.prototype),_(p.prototype,"values",[i],Object.getOwnPropertyDescriptor(p.prototype,"values"),p.prototype),_(p.prototype,"public_calls",[s],Object.getOwnPropertyDescriptor(p.prototype,"public_calls"),p.prototype),_(p.prototype,"action_calls",[o],Object.getOwnPropertyDescriptor(p.prototype,"action_calls"),p.prototype),_(p.prototype,"user_calls",[a],Object.getOwnPropertyDescriptor(p.prototype,"user_calls"),p.prototype),_(p.prototype,"oauth_providers",[l],Object.getOwnPropertyDescriptor(p.prototype,"oauth_providers"),p.prototype),_(p.prototype,"get_call_class",[c],Object.getOwnPropertyDescriptor(p.prototype,"get_call_class"),p.prototype),_(p.prototype,"get_call",[u],Object.getOwnPropertyDescriptor(p.prototype,"get_call"),p.prototype),_(p.prototype,"calls",[d],Object.getOwnPropertyDescriptor(p.prototype,"calls"),p.prototype),p);t.exports=O},{"../constants/plugin":78,"../external/ExternalCall":600,"../external/ExternalService":601,"../external/StructValue":603,"../lang/btype_ids":652,"../lang/caching":656,"../lib":741,"../shared/external_api_utilities":794,"../u":823,"./call_btypes":5,"./call_objects":6,"./post_processing":9,"./xml_to_json":11,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/isEqual":1321}],4:[function(e,t,n){"use strict";const r=e("../lib");const i=e("../db/db");const s=e("../lang/appquery");const o=e("../constants/locations");const a=e("../external/authenticators");const l=n;function c(e,t){if(!e){return}if(s.app_version()!==o.LIVE_VERSION){var n;return(n=e[t+"_test"])!=null?n:e[t]}else{return e[t]}}class u extends a.PrivateKey{constructor(e){super(e);const t=this._get_api();if(!this.params.token_param_name){if(t.auth==="private_key_url"){this.params.token_param_name="private_key"}else if(t.auth==="private_key_header"){this.params.token_param_name="Authorization"}}}get_secret_key(){return c(this._get_api(),"private_key")}}class d extends a.BasicAuth{get_secret_key(){var e;return(e=this._get_api())==null?void 0:e.password}get_public_key(){var e;return(e=this._get_api())==null?void 0:e.username}}class p extends a.SSLProtocol{get_key(e){var t;return(t=this._get_api())==null?void 0:t[e]}}class _ extends a.Oauth2PWFlow{get_secret_key(){var e;return(e=this._get_api())==null?void 0:e.password}get_public_key(){var e;return(e=this._get_api())==null?void 0:e.username}}class f extends a.Oauth2Custom{_get_token_request(){return this.service().get_call(this.params.call_id+".token_call").build()}}class h extends a.JWT{get_key(e){var t;if(e==="iss"){return this.get_property("iss")}return(t=this._get_api())==null?void 0:t[e]}}class m extends a.Oauth2{get_secret_key(){return c(this._get_api(),"appsecret")}get_public_key(){return c(this._get_api(),"appid")}get_oauth_user_data_call(){return this.service().get_call(this.params.api_id+"_oauth_user_data_call")}get_user_authentication_node(e){if(r().is_edit_mode()){return new i.StaticNode(this.get_owner_token_data(),null,"sys.json")}else{return super.get_user_authentication_node(e)}}tested(){return this._get_api().tested}has_token_data(){return this._get_api().has_token_data}get_owner_token_data(){return this._get_api().token_data}}l.APIConnectorBasePrivateKey=u;l.APIConnectorBasicAuth=d;l.APIConnectorBaseSSLProtocol=p;l.APIConnectorBaseOauth2PWFlow=_;l.APIConnectorBaseOauth2Custom=f;l.APIConnectorBaseJWT=h;l.APIConnectorBaseOauth2=m},{"../constants/locations":74,"../db/db":427,"../external/authenticators":617,"../lang/appquery":651,"../lib":741}],5:[function(e,t,n){"use strict";const r=e("../lang/btypes");const i=e("../constants/apiconnectorbase");const s=e("./APIConnectorStructValue");const o=n;o.get_btypes_from_call=function(e,t,n,o){for(const e in t.calls){const a=t.calls[e];for(const e in a.types){const t=a.types[e];for(const e in t.fields){const n=t.fields[e];if([null,undefined,i.IGNORE_FIELD].includes(n.ret_value)){delete t.fields[e]}else{let e;if(n.ret_value==="date_unix"){e=true;n.ret_value="date"}n.post_call_processing=function(t){let i;if(n.ret_value==="geographic_address"){i=r.get(n.ret_value);return i.plugin.cast(t)}if(n.ret_value==="date"){if(e){if(typeof t==="number"){t=t*1e3}}else{if(typeof t==="number"&&String(t).length<10){t=t*1e3}}i=r.get(n.ret_value);return i.plugin.cast(t)}else{return t}}}}n[e]=new s(t.caption,t.fields,{storable:true},o)}}}},{"../constants/apiconnectorbase":43,"../lang/btypes":653,"./APIConnectorStructValue":2}],6:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("../u");const i=e("../logger");const s=e("../lib");const o=e("../constants/time");const a=e("../constants/apiconnectorbase");const l=e("../lang/btype_ids");const c=e("../lang/btypes");const u=e("../external/ExternalCall");const d=e("./parsing_utils");const p=e("./post_processing");const _=e;let f;if(r.on_server()){f=_("../server/utility/reserved_address")}const h=n;h.methods={get:"GET",post:"POST",put:"PUT",patch:"PATCH",delete_method:"DELETE"};h.method_uses_body=function(e){return["PUT","PATCH","POST","DELETE_METHOD"].includes(e==null?void 0:e.toUpperCase())};const m={none:"text",text:"text",number:"text",JSON:"json",null:"json",undefined:"json"};const g=["url_params","headers","params","body_params","shared_headers","shared_params"];const v={none:true,text:true,number:true,JSON:true,null:true,undefined:true};h.user_friendly_parameter_names={headers:"(header)",params:"(param.)",url_params:"(path)",body_params:"(body)",shared_headers:"(shared headers)",shared_params:"(shared param.)"};function b(e){return!e.body_params||r.is_empty(e.body_params)}h.is_call_initialized=e=>e.initialized||e.no_types;h.get_error_message=function(e,t,n){var i,s;const o=(i=t==null?void 0:(s=t.display)==null?void 0:s.call(t))!=null?i:"this service";if(e.statusCode>=400&&e.statusCode<=499){let t="The service "+o+" just returned an error (HTTP "+e.statusCode+"). ";if(n){t+="Please contact the plugin author directly for feedback."}else{t+="Please consult their documentation to ensure your call is setup properly."}t+=` Raw error:\n\n${r.escape(e.body)}`;return t}else if(e.statusCode>=500&&e.statusCode<=599){return"Temporary error connecting to "+o+" (raw message: "+e.body+")"}else if(e.statusCode<200||e.statusCode>299){return"Error connecting to "+o+": expected a 2XX statusCode but got "+e.statusCode}};h.can_be_in_browser=function(e,t){if(!t){return false}if(!v[t.data_type]){return false}if(t.get_headers){return false}if(t.publish_as==="action"){return false}if(t.url_private){return false}for(const e of g){for(const r of Object.values((n=t[e])!=null?n:{})){var n;if(e==="headers"){for(const n in t[e]){if(Object.keys(t[e][n]).length!==0){return false}}}if(r!=null&&r.private){return false}}}if(e==null){return true}if(e.auth!=null&&e.auth!=="none"){return false}for(const t of g){for(const n of Object.values((r=e[t])!=null?r:{})){var r;if(t==="shared_headers"){return false}if(n!=null&&n.private){return false}}}return true};h.get_call_from_raw=function(e,t,n,i){var s;let o,d,_;if(!t){return}if(!i){_=e}else{_=t.api_id+"."+e}const f={};if((!t.url_params||r.is_empty(t.url_params))&&!t.url_private&&i&&!t.url_cant_be_private){f.url={display:"Call endpoint - URL",editor:"LongText",no_enter:true,no_rich_text_editing:true,default:t.url}}function g(e){const n=t[e];for(const o in n){const a=n[o];if(a!=null&&a.key){if(i&&!a.private||!i&&[undefined,"public"].includes(a.visibility)){var s;let n;if(t.body_type==="form_data"&&a.binary_file){n="DynamicFile"}else{if(a.long_text){n="LongText"}else{n="ShortText"}}f[r.encode_key(e+"_"+a.key)]={display:((s=h.user_friendly_parameter_names)==null?void 0:s[e])+" "+a.key,editor:n,default:!a.allow_blank?a.value:null,optional:a.optional||a.allow_blank,doc:a.doc}}}}}const v=["url_params","headers","shared_headers","shared_params"];if(t.body_type!=="plain_text"){v.push("params")}for(const e of v){g(e)}if(t.body&&h.method_uses_body(t.method)){if(b(t)){f.body={display:"Body (JSON object)",editor:"LongText",no_rich_text_editing:true,default:t.body}}else{g("body_params")}}if(!t.no_types){if(t.ret_value===a.IGNORE_FIELD){o="null"}else{const e=c.get(t.ret_value);if(!e.is_missing()&&e.plugin.is_simple){o=t.ret_value}else if(i){o=l.api_type(i+"."+_)}else{o=l.api_type(t.api_id+".plugin_api."+_)}}}else if(["image","text","number","file"].includes(t.data_type)){o=t.data_type}(s=o)!=null?s:o="null";const y=h.can_be_in_browser(null,t);const w=t.in_browser&&y;if(r.on_client()&&w){d=m[t.data_type]}const x=class extends u{get human(){return t.api_human+" - "+t.name}get _must_proxy(){return!w}get value_id(){return o}get doc_link(){return t.doc_link}get is_list(){return t.is_list&&o!=="null"}get category(){return"plugins"}get parameters(){return f}get get_headers(){return t.get_headers}get return_type(){if(t.no_types||["XML","image","file","text","number"].includes(t.data_type)){return"raw"}else{return"json"}}get data_type_for_ajax_call(){return d}get wrap_error(){return t.wrap_error}get can_be_used_as_action(){return t.publish_as==="action"}get_authenticator(){return this.service().get_authenticator(t.api_id)}build(r,s){return h.generate_request_from_call_data(t,s,n,(t=>{let{param_id:n,type:r,miss_ok:s=false}=t;if(i){return}if(["shared_headers","shared_params"].includes(r)){return this.get_key(r+"_"+n,undefined,s)}else{return this.get_key(e+"_"+r+"_"+n,undefined,s)}}))}post_processing(e,n,r,i){var s;const o={data_type:t.data_type,passed_url:t.url,api_human:t.api_human,name:t.name,get_headers:this.get_headers,wrap_error:this.wrap_error,returned_an_error:e==null?void 0:(s=e.body)==null?void 0:s.returned_an_error};return p(n,r,i,o)}};return x};const y=/\n/g;const w="BODY UNUSED";const x=2.5*o.MINUTE_MS;const j=4;function A(){return{timeout:x,max_retries:j}}h.generate_request_from_call_data=function(e,t,n,o){var a,l,c;(a=t)!=null?a:t={};const u=h.methods[e.method];const p=h.method_uses_body(e.method)?e.body_type:w;let _=(l=t.url)!=null?l:e.url;const m=t==null;function g(n,s,a){var l;const c=r.encode_key(`${n}_${a.key}`);let u=(l=t)==null?void 0:l[c];const d=a.value;if(a.optional&&!m){if(!r.is_empty(t)){return u}else{i.warn("inconsistent blank api optional param autofilled",{default_value:d,param_id:s,type:n,raw:a})}}if(u===""&&![null,undefined,""].includes(d)){u=undefined}const p=a.allow_blank&&!e.initialize_mode;if(p){var _;return(_=u)!=null?_:o==null?void 0:o({param_id:s,type:n,miss_ok:true})}else{var f,h;return(f=(h=u)!=null?h:d)!=null?f:o==null?void 0:o({param_id:s,type:n,miss_ok:false})}}if(e.url_params){_=d.apply_template_params(_,"bracket",e.url_params,g.bind(null,"url_params"))}if(r.on_server()){_=d.sanitize_url(_,e)}let v;if(e.headers!=null){v={};for(const T in e.headers){const N=e.headers[T];if(!h.validate_header_name(N.key)){throw new r.OwnerError("Header name is not correct",{display:e.api_human+" error: this header name is not correct "+N.key})}const P=g("headers",T,N);if(!N.optional||N.optional&&![null,undefined,""].includes(P)){if(!h.validate_header_value(P)){throw new r.OwnerError("header value is not correct",{display:e.api_human+" error: this header value for "+N.key+" is not correct "+P})}v[N.key.trim()]=P}if(!N.optional&&[null,undefined,""].includes(P)){return{dont_do_call:true,message:e.api_human+" error: the header "+N.key+" is empty and is mandatory"}}}}let x;if(p!==w&&p!=="form_data"&&![null,undefined,""].includes((c=e.body)==null?void 0:c.trim())){if(!b(e)||t.body==null){x=e.body;if(e.body_params){function I(e,t){const n=g("body_params",e,t);if([null,undefined,""].includes(n)){return"null"}return n}const R=e.data_type==="XML"||p==="plain_text";if(R){x=d.apply_template_params(x,"_*_",e.body_params,I)}else{x=d.apply_template_params(x,"less_than",e.body_params,((e,t)=>I(e,t).replace(y,"\\n")))}}}else{x=t.body}}const j=p==="plain_text";let M,E;if(e.params!=null){M={};E={};for(const L in e.params){const z=e.params[L];if(z.key!=null){let B=g("params",L,z);const q=z.key.trim();const U=p===w||z.querystring&&p!=="form_data";const F=[null,undefined,""].includes(B);const W=z.optional||U&&!z.binary_file;if(F&&!W){return{dont_do_call:true,message:`${e.api_human} error: the parameter ${q} cannot be empty`}}else if(F){continue}if(U){E[q]=B}else if(z.binary_file){if(B.slice(0,2)==="//"){B="http:"+B}const $=decodeURIComponent(B.split("/").pop());let G;try{if(f.is_reserved_url(B)){return{dont_do_call:true,message:`Error trying to fetch file at URL '${B}': invalid host`}}G=s().http_request({uri:B,encoding:null}).block()}catch(V){return{dont_do_call:true,message:`Error trying to fetch file at URL '${B}': ${V.message}`}}if(G.statusCode!==200){return{dont_do_call:true,message:n+" error: the parameter "+q+" is not a valid file"}}M[q]={value:G.body,options:{filename:$}}}else{M[q]=B}}}if(E!=null&&r.is_empty(E)){E=undefined}if(M!=null&&!j){if(r.is_empty(M)){M=undefined}else if(x!=null){try{x=r.json_parse(x)}catch(H){throw new r.OwnerError("Body could not be parsed",{display:e.api_human+" error: this body could not be parsed as JSON "+x})}r.extend(x,M);M=undefined}}}if(j){M=undefined}let k;if(["image","file"].includes(e.data_type)){k=null}const{timeout:O,max_retries:S}=A();const D={method:u,path:_,headers:v,encoding:k,timeout:O,max_retries:S};if(p==="form_data"){D.formData=M}else if(p===w){var C;D.qs=(C=E)!=null?C:{}}else{D.body=x;D.data=M;D.qs=E}return D};h.validate_header_name=function(e){if(typeof e!=="string"||!(e!=null&&e.length)){return false}for(let t=0;t<e.length;t++){const n=e.charCodeAt(t);if(n>=65&&n<=90){continue}if(n>=97&&n<=122){continue}if([94,95,96,124,126].includes(n)){continue}if([48,49,50,51,52,53,54,55,56].includes(n)){continue}if(n>=33&&n<=46){if([34,40,41,44].includes(n)){return false}continue}return false}return true};h.validate_header_value=function(e){if(e==null){return false}e=""+e;if(!e.length){return false}for(let t=0;t<e.length;t++){const n=e.charCodeAt(t);if(n===9){continue}if(n<=31||n>255||n===127){return false}}return true};h.add_shared_params_and_headers=function(e,t,n,i,s){let o;if(e.shared_headers!=null){var a;(a=t.headers)!=null?a:t.headers={};for(const s in e.shared_headers){const a=e.shared_headers[s];if(t.headers[a.key]==null&&a.key){if(!h.validate_header_name(a.key)){var l;throw new r.OwnerError("Header name is not correct",{display:((l=e.human)!=null?l:n)+" error: this header name is not correct "+a.key})}o=i(s,a);if(!h.validate_header_value(o)){var c;throw new r.OwnerError("Header Value not correct",{display:((c=e.human)!=null?c:n)+" error: this header value for "+a.key+" is not correct "+o})}t.headers[a.key]=o}}}if(e.shared_params!=null){var u,d,p;const n=(u=(d=(p=t.data)!=null?p:t.body)!=null?d:t.formData)!=null?u:t.qs;const r=n!=null?n:{};for(const t in e.shared_params){const n=e.shared_params[t];if(typeof r==="object"&&r[n.key]==null&&n.key){o=s(t,n);r[n.key]=o}}if(!n){t.body=r}}}},{"../constants/apiconnectorbase":43,"../constants/time":92,"../external/ExternalCall":600,"../lang/btype_ids":652,"../lang/btypes":653,"../lib":741,"../logger":744,"../u":823,"./parsing_utils":8,"./post_processing":9,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],7:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../safe_require");i.safe_register("./apiconnectorbase",r);const s=e("./template_parser");const o=e("./call_objects");const a=e("./xml_to_json");const l=e("./auth_classes");const c=e("./call_btypes");const u=e("./APIConnectorStructValue");const d=e("./BaseAPIConnector");const p=e("./parsing_utils");r.find_between_characters=s.find_between_characters;r.methods=o.methods;r.method_uses_body=o.method_uses_body;r.user_friendly_parameter_names=o.user_friendly_parameter_names;r.can_be_in_browser=o.can_be_in_browser;r.get_call_from_raw=o.get_call_from_raw;r.sanitize_url=p.sanitize_url;r.generate_request_from_call_data=o.generate_request_from_call_data;r.validate_header_name=o.validate_header_name;r.validate_header_value=o.validate_header_value;r.add_shared_params_and_headers=o.add_shared_params_and_headers;r.is_call_initialized=o.is_call_initialized;r.get_error_message=o.get_error_message;r.xml_to_json=a;r.APIConnectorBasePrivateKey=l.APIConnectorBasePrivateKey;r.APIConnectorBasicAuth=l.APIConnectorBasicAuth;r.APIConnectorBaseSSLProtocol=l.APIConnectorBaseSSLProtocol;r.APIConnectorBaseOauth2PWFlow=l.APIConnectorBaseOauth2PWFlow;r.APIConnectorBaseOauth2Custom=l.APIConnectorBaseOauth2Custom;r.APIConnectorBaseJWT=l.APIConnectorBaseJWT;r.APIConnectorBaseOauth2=l.APIConnectorBaseOauth2;r.APIConnectorStructValue=u;r.BaseAPIConnector=d;r.get_btypes_from_call=function(){return c.get_btypes_from_call(...arguments)};r.get_private_key_auth_params=e=>({token_param_name:e.token_param_name,add_to_header:e.auth==="private_key_header",add_to_url:e.auth==="private_key_url"});r.get_oauth2_user_auth_params=e=>{var t,n;return{token_param_name:(t=e.token_param_name)!=null?t:"access_token",header_key:e.header_key,scope:e.scope,authentication_url:e.authentication_url,generate_token_from_code_uri:e.generate_token_from_code_uri,add_to_header:e.add_to_header,auth_url_params:(n=e.auth_url_params)!=null?n:{},add_to_url:!e.add_to_header,add_basic_authentication:e.add_basic_authentication,data_type:e.token_data_type?"querystring":undefined,access_type:e.add_offline?"offline":undefined,prompt:e.add_offline?"consent":undefined,server_redirect:e.server_redirect}};r.get_oauth2_pw_auth_params=e=>({generate_token_from_code_uri:e.token_endpoint,grant_type:"password",use_username_password:true});r.get_jwt_auth_params=e=>({iss:e.iss,scope:e.scope,generate_token_from_code_uri:e.generate_token_from_code_uri})},{"../safe_require":777,"./APIConnectorStructValue":2,"./BaseAPIConnector":3,"./auth_classes":4,"./call_btypes":5,"./call_objects":6,"./parsing_utils":8,"./template_parser":10,"./xml_to_json":11,"core-js/modules/web.dom-collections.iterator.js":1123}],8:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("url");const i=e("../u");const s=e("./template_parser");let o;const a=e;if(i.on_server()){o=a("../server/utility/reserved_address")}const l=n;l.apply_template_params=function(e,t,n,r){let o;let a;switch(t){case"bracket":o="[";a="]";break;case"less_than":o="<";a=">";break;default:o=t;a=t}const l=s.find_between_characters(e,t);for(const[t,s]of Object.entries(n!=null?n:{})){if(l.includes(s.key)){e=i.replace_all(e,o+s.key+a,r(t,s))}}return e};l.sanitize_url=function(e,t){let n;try{n=new r.URL(e)}catch(n){throw new i.OwnerError("url is not correct",{display:t.api_human+` error: this URL is not correct (${n.message}) `+e})}if(o.is_reserved_host(n.hostname)){throw new i.OwnerError("invalid host",{display:"The host "+n.hostname+" is not valid"})}return n.href}},{"../u":823,"./template_parser":10,"core-js/modules/web.dom-collections.iterator.js":1123,url:981}],9:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.url.js");e("core-js/modules/web.url-search-params.js");const r=e("../u");const i=e("../lib");const s=e("./xml_to_json");const o=e;let a,l,c;if(r.on_server()){l=o("../server/fileupload");a=o("../monitoring/apm/activityApm");c=o("content-disposition")}t.exports=u;function u(e,t,n,r,i){const s=()=>d(e,t,n,r,i);if(a){return a.traceSpan("post processing",{},(e=>{var r,i,o,a;let{recordActivity:l}=e;l("api_outbound",{count:1,request_bytes:(r=(i=n.body)==null?void 0:i.length)!=null?r:0,response_bytes:(o=(a=t.body)==null?void 0:a.length)!=null?o:0});return s()}))}else{return s()}}function d(e,t,n,o,a){var c,u,d;let p,_,f,h;const{data_type:m,passed_url:g,api_human:v,name:b,get_headers:y}=o;const w=(c=e.appname)!=null?c:i().appname();const x=(u=e.app_version)!=null?u:i().app_version();const j=o.wrap_error;let A=(d=t.headers)==null?void 0:d["content-disposition"];if(/filename/.test(A)){A=A.replace(/;$/,"");h=extract_filename_from_content_disposition(A)}if(!h){let e;try{({pathname:e}=new URL(n.url))}catch(t){e=g}h=e.split("/").filter(Boolean).pop()||"root_file"}if(m==="XML"){try{p=s(t.body.toString("utf8"))}catch(e){if(j){o.returned_an_error=true;t.statusCode=400;t.statusMessage="Issue Parsing XML";t.body="There was an issue parsing the XML body for the call "+v+" - "+b}else{throw new r.OwnerError("issue parsing XML",{display:"There was an issue parsing the XML body for the call "+v+" - "+b})}}}else if(["image","file"].includes(m)){const e=String(t.body);try{JSON.parse(e);_=true}catch(e){}if(_){if(j){o.returned_an_error=true;t.statusCode=400;t.statusMessage="Issue Getting File For Call";t.body="There was an issue getting the file for the call "+v+" - "+b+". See the response "+e}else{throw new r.OwnerError("Issue getting file for call",{display:"There was an issue getting the file for the call "+v+" - "+b+". See the response "+e})}}else{let e;if(a){e="api_initialize_"+m}else{e=h}p=l.save_to_s3(t.body,e,t.headers["content-type"],undefined,undefined,w,x)}}else if(["text","number"].includes(m)){p=t.body.toString("utf8")}else if(m==="empty"){p=null}else{let e=t.body;if(t.statusCode===202){var M;(M=e)!=null?M:e="{}"}if(e!=null&&typeof e==="string"){e=e.trim()}try{p=JSON.parse(e)}catch(e){_=e;if(a&&(!y||!j)){if(t.body){throw new r.OwnerError("The API call returns a non-object and you picked JSON. Please check.",{original:_})}else{throw new r.OwnerError("The API call returns an empty body and you picked JSON. Please check.",{original:_})}}else{p={}}}}if(y||j){f={body:p};if(j){var E;if(a||o.returned_an_error){const e={status_code:t.statusCode,status_message:t.statusMessage,body:JSON.stringify(t.body)};f.error=e}f.returned_an_error=(E=o.returned_an_error)!=null?E:false}if(y){f.headers=t.headers}}else{f=p}return f}},{"../lib":741,"../u":823,"./xml_to_json":11,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.url-search-params.js":1126,"core-js/modules/web.url.js":1127}],10:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../u/shared/b_array");const i=n;const s=/\[([^\]]+)]/g;const o=/<[^>]+>/g;i.find_between_characters=function(e,t){let n,i;const a=[];if(!e){return a}switch(t){case"bracket":i=s;n="[";break;case"less_than":i=o;n="<";break;default:n=t;for(const e of["\\",".","^","$","*","+","?"]){t=t.split(e).join("\\"+e)}i=new RegExp(t+"(.*?)"+t,"g")}const l=e.match(i);for(const e of l!=null?l:[]){if(["bracket","less_than"].includes(t)){if(e.slice(1).indexOf(n)===-1){a.push(e.slice(1,-1))}}else{a.push(e.slice(n.length,-n.length))}}return r.unique(a)}},{"../u/shared/b_array":835,"core-js/modules/web.dom-collections.iterator.js":1123}],11:[function(e,t,n){"use strict";const r=e("../u");const i=e("../lib");const s=e("../u/shared/async/b_fiber");const o=e("../u/shared/incremental");const a=e;let l;if(r.on_server()){l=a("xml2js")}function c(e){let t;o.optional_pause_tick(1,"xml simplify");if(Array.isArray(e)){if(e.length===1){return c(e[0])}return e.map((e=>c(e)))}else if(e&&typeof e==="object"){const n={};for(const r in e){t=e[r];if(r!=="$"){n[r]=c(t)}}return n}else{return e}}function u(e){o.optional_pause_tick(1,"xml_to_json");return e}t.exports=function e(t){var n;const o=s.Block("xml_to_json");(n=l)!=null?n:l=i().editor_vendor.xml2js;l.parseString(t,{attrkey:"_attributes",tagNameProcessors:[u],attrNameProcessors:[u],valueProcessors:[u],attrValueProcessors:[u]},((e,n)=>{if(e){return o.fail(new r.OwnerError("Unable to parse response",{display:"Unable to parse response: "+t}))}else{return o.success(n)}}));return c(o.wait())}},{"../lib":741,"../u":823,"../u/shared/async/b_fiber":833,"../u/shared/incremental":848}],12:[function(e,t,n){"use strict";e("core-js/modules/es.error.cause.js");const r=e("./safe_require");const i=t.exports;r.safe_register("./assert",i);i.assert=s;i.fail=o;function s(e,t){console.log(`Asserting true: ${e}`);if(!e){o(t!=null?t:"expected true, got: "+e)}}function o(e){throw new Error(e)}},{"./safe_require":777,"core-js/modules/es.error.cause.js":1116}],13:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("./u");const s=e("./safe_require");s.safe_register("./box",r);r.left=(e,t)=>p(e,"left",t);r.top=(e,t)=>p(e,"top",t);r.offset_left=e=>e.offset().left;r.offset_top=e=>e.offset().top;r.right=e=>r.left(e)+r.width(e);r.bottom=e=>r.top(e)+r.height(e);r.width=(e,t)=>p(e,"width",t);r.height=(e,t)=>p(e,"height",t);r.inner_left=e=>r.left(e)+p(e,"border-left-width");r.inner_top=e=>r.top(e)+p(e,"border-top-width");r.inner_right=e=>r.right(e)-p(e,"border-right-width");r.inner_bottom=e=>r.bottom(e)-p(e,"border-bottom-width");r.inner_width=e=>r.inner_right(e)-r.inner_left(e);r.inner_height=e=>r.inner_bottom(e)-r.inner_top(e);r.offset_bottom=e=>r.offset_top(e)+r.height(e);r.offset_right=e=>r.offset_left(e)+r.width(e);r.min_width=e=>p(e,"border-left-width")+p(e,"border-right-width")+p(e,"padding-left")+p(e,"padding-right");r.min_height=e=>p(e,"border-top-width")+p(e,"border-bottom-width")+p(e,"padding-top")+p(e,"padding-bottom");r.get=(e,t)=>n[t](e);r.set=(e,t,r)=>n[t](e,r);r.get_dim=function(e){const t=l[c(e)];if(!t){throw new i.UnexpectedError("unrecognized: "+c(e))}return t};r.dim_props=e=>a[e];r.transform_dim=function(e,t){const n=i.extend({},a[e],t);return r.get_dim(n)};const o=["width","left","right","inner_left","inner_right","inner_width","height","top","bottom","inner_top","inner_bottom","inner_height"];const a={};const l={};function c(e){return e.axis+e.type+e.edge+e.rank}function u(e,t,n){if(!a[e]){a[e]={}}a[e][t]=n}function d(e,t){for(const n of t){if(e.indexOf(n)!==-1){return true}}return false}for(const e of o){if(d(e,["width","left","right"])){u(e,"axis","x")}else{u(e,"axis","y")}if(d(e,["inner"])){u(e,"edge","inner")}else{u(e,"edge","outer")}if(d(e,["width","height"])){u(e,"rank","span")}else if(d(e,["left","top"])){u(e,"rank","near")}else{u(e,"rank","far")}l[c(a[e])]=e}function p(e,t,n){if(n===undefined||n===null){n=Math.round(parseFloat(e.css(t)));if(isNaN(n)){return 0}return n}else{return e.css(t,n+"px")}}},{"./safe_require":777,"./u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.get_free_plan_for_user=n.get_feature_descriptions=n.get_dedicated_enterprise_plan_id=n.get_custom_plan_feature_descriptions=n.get_app_plans=n.get_app_plan_edit_mode=n.features_caption=n.feature_description_functions_2023=n.default_additional_storage_unit_price=n.can_add_storage_units=n.app_can_get_trial_from_meta=n.app_can_get_trial=n.anti_babel_function=n.add_ons_pricing=n.VersionControlTier=n.RecurringFrequency=void 0;n.get_monthly_to_annual_allowlist=se;n.requires_different_stripe_plan=n.plan_exposes_capacity=n.plan_exists=n.is_free_plan=n.is_downgrade=n.is_dedicated_plan=n.is_custom_plan=n.is_2023_plan=n.infinity=n.has_limited_workload_plan=n.has_limited_db_plan=n.has_limited_db_disk_size_plan=n.get_yearly_price_total=n.get_version_control_tier=n.get_trial_plan_id=n.get_suggested_app_plan_id=n.get_suggested_app_plan_display=n.get_stripe_plan_id=n.get_sorted_plan_ids_with_custom=n.get_sorted_plan_ids=n.get_run_mode_client_plan=n.get_price_per_month=n.get_plan=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=h(e("./u"));var i=_(e("./lib"));var s=h(e("./logger"));var o=h(e("./constants/time"));var a=h(e("./constants/app_plans"));var l=h(e("./client_config"));var c=e("./constants/subscriptions");var u=_(e("pluralize"));var d=h(e("./shared/pricing_configs"));var p=e("./constants/app_usage");function _(e){return e&&e.__esModule?e:{default:e}}function f(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(f=function(e){return e?n:t})(e)}function h(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=f(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}r.edit_mode_only();const m=1e13;n.infinity=m;const g=1e5;let v=function(e){e["None"]="none";e["Daily"]="daily";e["Weekly"]="weekly";e["Monthly"]="monthly";e["Quarterly"]="quarterly";e["Yearly"]="yearly";return e}({});n.RecurringFrequency=v;const b=[v.None,v.Daily,v.Weekly,v.Monthly,v.Quarterly,v.Yearly];const y=[v.None,v.Weekly,v.Monthly,v.Quarterly,v.Yearly];const w=[v.None,v.Monthly,v.Quarterly,v.Yearly];const x={app_personal_2022:{display:"Personal",live_version:true,no_branding:true,api:true,scheduler:true,max_schedules_per_thing:1,initial_capacity:15,initial_storage:10,possible_additional_units:0,collaboration:1,logs:14*1*24,version_control:7*1*24,db_backup:7*1*24,custom_domain:true,ssl:true,sub_apps:false,import_export_csv:true,upload_csv_run_mode_limit:100,bulk:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:w,monitoring:true,monthly_price:29,yearly_price:25,support:"Email",index:1,can_buy_plugins:true,paid_plugin_free:false,discourse_sso:false,two_factor_auth:false,export_app_json:true,versions:0,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:false,max_total_db_things:5e3,max_monthly_unique_daily_visitors:1e4,value_prop:"Best for launching new apps to the world."},app_professional_2022:{display:"Professional",live_version:true,no_branding:true,possible_additional_units:40,initial_capacity:25,initial_storage:20,additional_storage_chunk:100,max_storage:320,api:true,scheduler:true,max_schedules_per_thing:5,bulk:true,collaboration:4,logs:7*2*24,version_control:1*24*30,db_backup:1*24*30,custom_domain:true,ssl:true,sub_apps:false,import_export_csv:true,upload_csv_run_mode_limit:200,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,monthly_price:129,yearly_price:115,support:"Email",index:2,can_buy_plugins:true,paid_plugin_free:false,discourse_sso:true,two_factor_auth:false,export_app_json:true,versions:4,algolia_search:true,data_trigger:true,ab_test_integration:true,can_use_multiple_clusters:true,max_total_db_things:25e3,db_things_overage_chunk:1e4,db_things_overage_price_per_chunk:.2,max_monthly_unique_daily_visitors:5e4,monthly_unique_daily_visitors_overage_chunk:25e3,monthly_unique_daily_visitors_overage_price_per_chunk:.2,value_prop:"Best for startup teams building and enhancing their products."},app_production_2022:{display:"Production",live_version:true,custom_domain:true,import_export_csv:true,upload_csv_run_mode_limit:1e3,no_branding:true,initial_capacity:35,initial_storage:50,additional_storage_chunk:100,max_storage:350,possible_additional_units:40,collaboration:10,api:true,scheduler:true,max_schedules_per_thing:20,bulk:true,logs:7*2*24,version_control:24*365,db_backup:24*90,sub_apps:true,ssl:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,monthly_price:359,yearly_price:320,support:"Email",index:3,can_buy_plugins:true,paid_plugin_free:false,discourse_sso:true,two_factor_auth:true,export_app_json:true,versions:19,algolia_search:true,data_trigger:true,ab_test_integration:true,can_use_multiple_clusters:true,max_total_db_things:2e5,db_things_overage_chunk:1e4,db_things_overage_price_per_chunk:.2,max_monthly_unique_daily_visitors:1e5,monthly_unique_daily_visitors_overage_chunk:25e3,monthly_unique_daily_visitors_overage_price_per_chunk:.2,value_prop:"Best for businesses growing at scale."},enterprise_2022:{not_shown:true,display:"Custom",live_version:true,custom_domain:true,no_branding:true,import_export_csv:true,collaboration:15,upload_csv_run_mode_limit:3e3,possible_additional_units:0,api:true,scheduler:true,max_schedules_per_thing:100,bulk:true,logs:365*24,support:"Priority email",price:"Starts at $1000/mo",version_control:365*24,db_backup:90*24,sub_apps:true,ssl:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,initial_capacity:40,initial_storage:1e3,can_buy_plugins:true,paid_plugin_free:false,discourse_sso:true,two_factor_auth:true,export_app_json:true,versions:99,algolia_search:true,data_trigger:true,ab_test_integration:true,can_use_multiple_clusters:true,max_total_db_things:5e5,db_things_overage_chunk:1e4,db_things_overage_price_per_chunk:.1,max_monthly_unique_daily_visitors:5e5,monthly_unique_daily_visitors_overage_chunk:25e3,monthly_unique_daily_visitors_overage_price_per_chunk:.1,value_prop:"Best for large-scale businesses."}};const j={not_shown:true,not_paid_per_app:true,force_branding_live:true,display:"Agency",live_version:true,custom_domain:true,no_branding:true,recurring_frequencies:b,scheduler:true,sub_apps:true,api:true,can_buy_plugins:true,collaboration:1,version_control:24*7,initial_storage:.5,db_backup:12*1,support:"Email",edit_mode_pw_protection:true,pw_protection:true,pw_protection_forced:true,logs:12*1,import_export_csv:true,seo:false,two_factor_auth:false,max_schedules_per_thing:5,possible_additional_units:0,initial_capacity:0,bulk:false,custom_headers:true,hosted_files:false,upload_csv_run_mode_limit:100,monthly_price:78,yearly_price:71,ssl:true,monitoring:false,special_description:"The Agency plan lets you access all features to test the application you are building for a client. It will be password-protected by default and will only show a banner in live mode. Note that using the Agency plan for an app that is not built for a client is against Bubble's terms and can lead to the termination of your Agency subscription.",paid_plugin_free:true,discourse_sso:false,export_app_json:false,versions:2,algolia_search:true,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:false};const A={display:"Free",live_version:false,custom_domain:false,no_branding:false,recurring_frequencies:[v.None],scheduler:false,sub_apps:false,api:false,can_buy_plugins:false,collaboration:1,initial_storage:.5,max_total_db_things:200,edit_mode_pw_protection:true,pw_protection:false,import_export_csv:false,seo:false,two_factor_auth:false,max_schedules_per_thing:0,possible_additional_units:0,initial_capacity:0,bulk:false,custom_headers:false,hosted_files:false,upload_csv_run_mode_limit:0,ssl:false,monitoring:false,support:"Email",index:10,paid_plugin_free:false,discourse_sso:false,export_app_json:false,data_trigger:false,ab_test_integration:false,can_use_multiple_clusters:false,value_prop:"Best for exploring Bubble and learning before you launch.",versions:0,version_control:6,workload_units:5e4,db_backup:6,logs:6};const M={...j,monthly_price:85,yearly_price:78,collaboration:2,versions:10,version_control:2*o.WEEK_H,workload_units:15e4,monthly_test_version_workload_credit_units:g,initial_storage:2,db_backup:2*o.DAY_H,logs:2*o.DAY_H,two_factor_auth:true};const E={...M,display:"Free (Enterprise)",collaboration:25,versions:25,version_control:20*o.DAY_H,db_backup:20*o.DAY_H,logs:20*o.DAY_H,monthly_price:0,yearly_price:0};const k={...A,display:"Starter",value_prop:"Best for launching new apps to the world.",monthly_price:32,yearly_price:29,live_version:true,custom_domain:true,no_branding:true,recurring_frequencies:b,scheduler:true,api:true,can_buy_plugins:true,version_control:2*o.DAY_H,workload_units:175e3,workload_overage_rate:.3,workload_overage_chunk_size:1e3,initial_storage:50,additional_storage_unit_price:3,additional_storage_chunk:100,db_backup:2*o.DAY_H,edit_mode_pw_protection:true,pw_protection:true,logs:2*o.DAY_H,import_export_csv:true,seo:true,max_schedules_per_thing:1,initial_capacity:15,max_storage:2e3,possible_additional_units:0,ssl:true,upload_csv_run_mode_limit:100,bulk:true,custom_headers:true,hosted_files:true,monitoring:true,support:"Email",index:1,paid_plugin_free:false,export_app_json:true,data_trigger:true,monthly_test_version_workload_credit_units:g,max_total_db_things:undefined};const O={...k,display:"Growth",value_prop:"Best for startup teams building and enhancing their products.",monthly_price:134,yearly_price:119,collaboration:2,versions:10,version_control:2*o.WEEK_H,workload_units:25e4,max_schedules_per_thing:5,initial_capacity:25,initial_storage:100,db_backup:2*o.WEEK_H,logs:2*o.WEEK_H,two_factor_auth:true,algolia_search:true,discourse_sso:true,ab_test_integration:true,can_use_multiple_clusters:true,upload_csv_run_mode_limit:200};const S={...O,display:"Team",value_prop:"Best for businesses growing at scale.",monthly_price:399,yearly_price:349,sub_apps:true,collaboration:5,versions:25,version_control:20*o.DAY_H,workload_units:5e5,max_schedules_per_thing:20,initial_capacity:35,initial_storage:1024,db_backup:20*o.DAY_H,logs:20*o.DAY_H,upload_csv_run_mode_limit:1e3};const D={...S,display:"Custom",value_prop:"Best for enterprise-level security and scale.",initial_capacity:40};const C={app_starter_2023:k,app_growth_2023:O,app_team_2023:S,app_custom_2023:D};const T={...A,display:"Plugin Demo",live_version:true,api:true,max_total_db_things:undefined};const N=e=>{const t=te(e);return!t.workload_units};n.plan_exposes_capacity=N;const P=e=>e===a.APP_CUSTOM_2023;n.is_custom_plan=P;const I=e=>e===a.DEFAULT_DEDICATED_PLAN;n.is_dedicated_plan=I;const R=e=>{if(!e)return true;const t=a.PricingModel2023Plans.includes(e);if(d.isStateR()){return t||ge(e)||e===a.AGENCY_PLAN}return t};n.is_2023_plan=R;const L=e=>{var t,n;let{from_plan_id:r,to_plan_id:i}=e;const s=te(r);const o=te(i);return((t=s.monthly_price)!=null?t:0)>((n=o.monthly_price)!=null?n:0)};n.is_downgrade=L;const z=e=>{const t=e.max_total_db_things;return Number.isFinite(t)};n.has_limited_db_plan=z;const B=e=>!!e.db_disk_size_GB_included_plan&&!e.db_disk_size_overage_GB_increments;n.has_limited_db_disk_size_plan=B;const q=e=>!!e.workload_units&&!e.workload_overage_rate;n.has_limited_workload_plan=q;const U=()=>{if(d.isStateR()){return a.APP_STARTER_2023}return a.APP_PERSONAL_2019};n.get_trial_plan_id=U;const F={e1:{app_personal_2019:{monthly_price:59,yearly_price:49,logs:24*3,version_control:7*24*2},app_professional_2019:{monthly_price:189,yearly_price:175,logs:7*2*24*2,version_control:24*30*3},app_production_2019:{monthly_price:629,yearly_price:575,logs:7*2*24*2,collaboration:18}},e2:{},e3:{app_personal_2019:{monthly_price:39,yearly_price:34,logs:1*24*2,version_control:10*1*24}},e4:{app_personal_2019:{monthly_price:35,yearly_price:29,logs:1*24*2,version_control:10*1*24}},e5:{added_plans:["app_hobby_2021"],app_personal_2019:{monthly_price:39,yearly_price:34,logs:1*24,version_control:10*1*24,recurring_frequencies:["none","weekly","monthly","quarterly","yearly"]}},e6:{added_plans:["app_hobby_2021"],app_hobby_2021:{monthly_price:14,yearly_price:12}},e7:{offer_trial:{plan:a.APP_PERSONAL_2019,days:14,in_time_range(e){const t=Date.now()-e;return 24*60*60*1e3<t&&t<24*60*60*1e3*10}}},e8:{offer_trial:{plan:"app_professional_2019",days:14,in_time_range(e){const t=Date.now()-e;return 2*24*60*60*1e3<t&&t<24*60*60*1e3*10}}},p1:{app_personal_2019:{monthly_price:32,yearly_price:27.5},app_professional_2019:{monthly_price:142,yearly_price:126.5},app_production_2019:{monthly_price:582,yearly_price:522.5}}};const W=function(e){const t=Date.now()-e;return!!e&&o.DAY_MS<t&&t<o.DAY_MS*10};n.app_can_get_trial=W;const $=function(e){const t=Date.now()-e;return!!e&&t<o.DAY_MS*10};n.app_can_get_trial_from_meta=$;const G=e=>{var t;return((t=e.yearly_price)!=null?t:0)*12};n.get_yearly_price_total=G;const V=e=>{if(!(e!=null&&e.frequency))return 0;switch(e.frequency){case c.BillingFrequency.Month:return e.monthly_price;case c.BillingFrequency.Year:return e.yearly_price;default:s.error("Unknown billing frequency",{frequency:e.frequency});return 0}};n.get_price_per_month=V;const H=()=>undefined;const X=e=>{const t=d.getPricingPlanKey(e);const n=!!t&&F[t]!=null;if(n){return t}return undefined};const Y=()=>i.default.extend({ignore_privacy_rules(){return true}},(()=>{var e,t;const n=(e=(t=i.default.or_throw()).current_user)==null?void 0:e.call(t);if(n!=null){const e=n.child("pricing_group_text").raw();const t=F[e]!=null;if(t){return e}}return null}));const K=e=>{var t;return(t=X(e))!=null?t:Y()};const J=(e,t)=>{const n=K(t);if(n&&F[n][e]!=null){for(const t of["monthly_price","yearly_price"]){const r=te(e);const i=F[n][e];if((i==null?void 0:i[t])!==r[t]){return true}}}return false};n.requires_different_stripe_plan=J;function Z(e){if(!(e!=null&&e.includes(a.DEFAULT_DEDICATED_PLAN))||!l.is_dedicated||!l.enterprise_plan_id){return e}return l.enterprise_plan_id}const Q=()=>Z(a.DEFAULT_DEDICATED_PLAN);n.get_dedicated_enterprise_plan_id=Q;const ee=function(e){let{plan:t,frequency:n,appname:r}=e;let i;if(J(t,r)){const e=K(r);i=`${t}_${e}`}else{i=t}if(["month",null,undefined].includes(n)){i=i+"_month"}else{i=i+"_year"}return i};n.get_stripe_plan_id=ee;const te=function(e,t){if(!e){throw new r.UnexpectedError("called get plan with null id")}t||(t=d.isStateR());e=Z(e);let n;if(t&&e===a.AGENCY_PLAN){n=M}else if(ke[e]!==undefined){n=ke[e]}else if(Oe[e]!==undefined){const t=Oe[e];n={...t,legacy:true}}else if(C[e]!==undefined){n=C[e]}else if(experimental_plans[e]!==undefined){n=experimental_plans[e]}else if(x[e]!==undefined){n={...x[e],price_2022:true}}if(n==null){throw new r.UnexpectedError(`plan ${String(e)} does not exist!`)}return{...n,id:e,display:he(e,n)}};n.get_plan=te;const ne=function(e,t,n){var i;const s=te(e,t);const o=K(n);if(o!=null&&((i=F[o])==null?void 0:i[e])!=null){r.extend(s,F[o][e])}return s};n.get_app_plan_edit_mode=ne;const re=function(e){var t,n,r,i;const s=(t=(n=(r=(i=ke[e])!=null?i:Oe[e])!=null?r:experimental_plans[e])!=null?n:x[e])!=null?t:C[e];return s!=null};n.plan_exists=re;const ie=function(e,t){const n={};Object.entries(C).forEach((e=>{let[r,i]=e;n[r]=ne(r,true,t)}));Object.entries(ke).forEach((e=>{let[r,i]=e;n[r]=ne(r,true,t)}));const r=K(t);if(r&&F[r]!==null&&F[r]!==undefined){for(const e of(i=F[r].added_plans)!=null?i:[]){var i;n[e]=ne(e,true,t)}}if(e){for(const e of a.UserSelectablePre2019Plans){n[e]=ne(e,true,t)}}return n};n.get_app_plans=ie;function se(){if(d.isStateR()){return a.UserSelectable2023Plans}return[...a.LEGACY_2019_PLANS,...a.UserSelectable2023Plans]}const oe={no_branding:true,import_export_csv:true,force_branding_live:true,custom_domain:true,ab_test_integration:true};const ae=function(e){const t=te(e);const n={id:e};Object.entries(oe).forEach((e=>{let[r,i]=e;const s=r;if(i){n[s]=t[s]}}));return n};n.get_run_mode_client_plan=ae;const le=()=>a.FREE;n.get_free_plan_for_user=le;const ce=10;n.default_additional_storage_unit_price=ce;const ue=e=>{var t,n;return{capacity:{unit:1,price:e.legacy?20:30},storage:{unit:(t=e.additional_storage_chunk)!=null?t:10,price:(n=e.additional_storage_unit_price)!=null?n:ce}}};n.add_ons_pricing=ue;const de=e=>!!e.possible_additional_units||!!e.additional_storage_chunk;n.can_add_storage_units=de;const pe=()=>[a.FREE,...a.UserSelectable2023Plans];n.get_sorted_plan_ids=pe;const _e=()=>[a.FREE,...a.PricingModel2023Plans];n.get_sorted_plan_ids_with_custom=_e;const fe=(e,t)=>{const n=t!=null?t:pe();return n.find((t=>ve(te(t),e)))};n.get_suggested_app_plan_id=fe;const he=(e,t)=>{if(t.display==null){return r.toTitleCase(e)}if(a.DO_NOT_MARK_AS_LEGACY.includes(e)){return t.display}return`${t.display} (legacy)`};const me=e=>{const t=fe(e);return t&&te(t).display};n.get_suggested_app_plan_display=me;const ge=e=>e===a.FREE||e===a.APP_PLUGIN_DEMO;n.is_free_plan=ge;const ve=(e,t)=>{if(typeof t==="function"){const n=t(e);return!n}else{return Boolean(e[t])}};const be=[e=>e.no_branding?"White labeling":"Bubble branding",e=>e.live_version&&"Access to live version",e=>e.custom_domain&&"Custom domain",e=>{var t;if(((t=e.recurring_frequencies)==null?void 0:t.length)<=1)return false;return`Run ${e.recurring_frequencies[1]} scheduled workflows`},e=>e.api&&"API",e=>e.pw_protection?"Password protection: Editor & live mode":"Password protection: Editor only",e=>e.import_export_csv&&"Import / Export CSV",e=>e.discourse_sso&&"Discourse SSO",e=>!!e.algolia_search&&"Algolia search",e=>e.sub_apps&&"Main apps + Sub apps",e=>!!e.support&&`${e.support} support`,e=>{if(e.initial_capacity){return`${e.initial_capacity} reserved units of capacity`}return"Basic server capacity"},e=>{if(e.possible_additional_units&&e.possible_additional_units>0){return`Ability to add up to ${e.possible_additional_units} units of capacity`}return false},e=>{if(e.collaboration===m){return"Unlimited application editors"}return(0,u.default)("application editor",e.collaboration,true)},e=>e.versions>0&&(0,u.default)("development version",e.versions+1,true),e=>{if(e.db_backup<=0){return false}if(e.db_backup===m){return"Unlimited data backup & restore"}if(e.db_backup<12){return`Data backup & restore last ${(0,u.default)("hour",e.db_backup)}`}return`Data backup & restore last ${(0,u.default)("day",e.db_backup/24,true)}`},e=>{if(e.logs===m){return"2 weeks of logs"}if(e.logs<=1){return`${e.logs*60} minutes of logs`}if(e.logs<=24){return`${e.logs} hours of logs`}return`${e.logs/24} days of logs`},e=>{if(e.initial_storage){return`${e.initial_storage} GBs file storage`}return false}];let ye=function(e){e["None"]="None";e["Basic"]="Basic";e["Premium"]="Premium";return e}({});n.VersionControlTier=ye;const we=e=>{if(!e.live_version){return ye.None}else if(e.versions===0){return ye.Basic}else{return ye.Premium}};n.get_version_control_tier=we;const xe=[e=>e.live_version?"Live app":"Development version",e=>ge(e.id)&&"API connector",e=>ge(e.id)&&"Component library",e=>e.custom_domain&&"Custom domain",e=>{var t;if(((t=e.recurring_frequencies)==null?void 0:t.length)<=1)return false;return`Recurring workflows`},e=>{if(e.collaboration===m){return"Unlimited application editors"}return(0,u.default)("app editor",e.collaboration,true)},e=>e.sub_apps&&"Sub apps",e=>`${we(e)} version control`,e=>!!e.two_factor_auth&&"Two-factor authentication",e=>e.versions>1&&(0,u.default)("custom branch",e.versions,true),e=>{if(e.workload_units===undefined){return false}return r.compact_number(e.workload_units)+" workload units/mo"},e=>{if(e.logs===m){return"2 weeks of logs"}if(e.logs<=1){return`${e.logs*60} minutes of server logs`}if(e.logs<=24){return`${e.logs} hours of server logs`}return`${e.logs/24} days of server logs`}];n.feature_description_functions_2023=xe;const je=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;const n=e=>Boolean(e);const r=d.isStateR()?xe:be;const i=e=>r.map((t=>t(e))).filter(n);const s=(e,t)=>e.filter((e=>!t.includes(e)));const o=e?i(e):[];if(t){const e=i(t);return s(o,e)}return o};n.get_feature_descriptions=je;const Ae=(e,t,n,i)=>{var s,o;const a=((s=e.additional_storage)!=null?s:0)+((o=e.initial_storage)!=null?o:0);const l=n?r.compact_number(n):p.UNKNOWN_VALUE_PLACEHOLDER;const c=i==null?p.UNKNOWN_VALUE_PLACEHOLDER:i?"Disabled":"Enabled";const d=[(0,u.default)("App editor",t!=null?t:e.collaboration,true),`${l} Workload units`,`${a} GBs file storage`,(0,u.default)("Custom branch",e.versions,true),`Overage Protection: ${c}`];return d};n.get_custom_plan_feature_descriptions=Ae;const Me={live_version:"allows accessing the live version of the app",no_branding:"remove branding in run mode",custom_domain:"use a custom domain with SSL encryption",edit_mode_pw_protection:"restrict access to the app in the editor",pw_protection:"restrict access to the app in run mode with a password",collaboration(e){return`add ${e-1} application editors`},can_use_multiple_clusters:"have the ability to opt into scheduled releases of the Bubble platform",seo:"customize SEO",possible_additional_units(){return"add capacity and storage"},can_buy_plugins:"use paid plugins",versions(e){return`have ${e} additional development version${e>1?"s":""} of your app`},logs(e){return`get logs up to ${e/24} days`},version_control(e){return`get application version control up to ${e/24} days`},db_backup(e){return`get database backup up to ${e/24} days`},monitoring:"get real time analytics",sub_apps:"create sub apps",two_factor_auth:"set up 2-factor authentication",scheduler:"schedule actions in the future",recurring_frequencies(e){return`schedule actions on a ${e} basis`},max_schedules_per_thing(e){return`schedule up to ${e} recurring events per thing`},data_trigger:"Trigger workflows to run automatically when your data changes",export_app_json:"export / import your app as a JSON file",custom_headers:"customize pages headers and body",bulk:"run bulk operations on your database",import_export_csv:"export and import CSV data in edit and run mode",upload_csv_run_mode_limit(e){return`upload CSV files in run mode up to ${e} lines`},hosted_files:"host files in the root directory",discourse_sso:"use your app to authenticate with Discourse forums via SSO",algolia_search:"integrate your data with Algolia to perform faster and more customizable searches",ab_test_integration:"use Google Optimize with Segment or Google Analytics to AB test variants of your page"};n.features_caption=Me;const Ee={live_version:true,import_export_csv:true,upload_csv_run_mode_limit:1e3,initial_capacity:10,initial_storage:50,possible_additional_units:30,api:true,scheduler:true,max_schedules_per_thing:20,bulk:true,logs:7*2*24,sub_apps:true,ssl:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,can_buy_plugins:true,paid_plugin_free:false,discourse_sso:true,two_factor_auth:true,export_app_json:true,algolia_search:true,data_trigger:true,ab_test_integration:true,can_use_multiple_clusters:true};const ke={app_free2:A,app_personal_2019:{display:"Personal",live_version:true,no_branding:true,api:true,scheduler:true,max_schedules_per_thing:1,initial_capacity:0,initial_storage:10,possible_additional_units:0,collaboration:1,logs:1*24,version_control:7*1*24,db_backup:7*1*24,custom_domain:true,ssl:true,sub_apps:false,import_export_csv:true,upload_csv_run_mode_limit:100,bulk:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:w,monitoring:true,monthly_price:29,yearly_price:25,support:"Email",index:6,can_buy_plugins:true,paid_plugin_free:false,discourse_sso:false,two_factor_auth:false,export_app_json:true,versions:0,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:false},app_professional_2019:{display:"Professional",live_version:true,no_branding:true,possible_additional_units:7,initial_capacity:3,initial_storage:20,api:true,scheduler:true,max_schedules_per_thing:5,bulk:true,collaboration:2,logs:7*2*24,version_control:1*24*30,db_backup:24*30,custom_domain:true,ssl:true,sub_apps:false,import_export_csv:true,upload_csv_run_mode_limit:200,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,monthly_price:129,yearly_price:115,support:"Email",index:7,can_buy_plugins:true,paid_plugin_free:false,discourse_sso:true,two_factor_auth:false,export_app_json:true,versions:2,algolia_search:true,data_trigger:true,ab_test_integration:true,can_use_multiple_clusters:true},app_production_2019:{...Ee,display:"Production",custom_domain:true,no_branding:true,collaboration:15,version_control:24*365,db_backup:24*365,monthly_price:529,yearly_price:475,support:"Priority email",index:8,versions:19},enterprise:{not_shown:true,display:"Dedicated",live_version:true,custom_domain:true,no_branding:true,import_export_csv:true,collaboration:m,upload_csv_run_mode_limit:3e3,possible_additional_units:0,api:true,scheduler:true,max_schedules_per_thing:100,bulk:true,logs:m,support:"Priority email",price:"Starts at $480/mo",version_control:m,db_backup:m,sub_apps:true,ssl:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,initial_capacity:2,initial_storage:1e3,can_buy_plugins:true,paid_plugin_free:false,discourse_sso:true,two_factor_auth:true,export_app_json:true,versions:50,algolia_search:true,data_trigger:true,ab_test_integration:true,can_use_multiple_clusters:false},app_agency:j,app_education:{not_shown:true,live_version:true,not_paid_per_app:true,display:"Education",no_branding:true,force_branding_live:true,api:true,scheduler:true,max_schedules_per_thing:5,possible_additional_units:0,initial_capacity:0,initial_storage:1,collaboration:20,logs:24*7,bulk:true,seo:true,custom_headers:true,hosted_files:true,version_control:24*7,db_backup:24*1,custom_domain:true,import_export_csv:true,upload_csv_run_mode_limit:100,sub_apps:true,ssl:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:false,special_description:"The Education plan lets you access all features, but you will not be able to buy paid plugins or add capacity to your app. Please upgrade to a different plan if you want to use such features.",can_buy_plugins:false,paid_plugin_free:false,discourse_sso:true,two_factor_auth:false,export_app_json:false,versions:5,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:false},app_hackathon:{not_shown:true,live_version:true,display:"Hackathon",not_paid_per_app:true,no_branding:false,api:true,scheduler:true,max_schedules_per_thing:5,possible_additional_units:0,initial_capacity:0,initial_storage:1,collaboration:7,logs:24*3,bulk:true,seo:true,custom_headers:true,hosted_files:true,version_control:24*3,db_backup:24*3,custom_domain:true,import_export_csv:true,upload_csv_run_mode_limit:100,sub_apps:false,ssl:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:false,special_description:"The Hackathon plan lets you access all features for the time of the hackathon. Have fun and happy building!",can_buy_plugins:true,paid_plugin_free:true,discourse_sso:false,two_factor_auth:false,export_app_json:false,versions:3,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:false},app_instructor:{not_shown:true,live_version:true,not_paid_per_app:true,display:"Instructor",no_branding:true,force_branding_live:true,api:true,scheduler:true,max_schedules_per_thing:2,possible_additional_units:0,initial_capacity:2,initial_storage:.5,collaboration:9,logs:12*1,bulk:true,seo:false,custom_headers:false,hosted_files:false,version_control:24*1,db_backup:12*1,custom_domain:true,import_export_csv:true,upload_csv_run_mode_limit:10,monthly_price:0,yearly_price:0,sub_apps:true,ssl:true,edit_mode_pw_protection:true,pw_protection:true,pw_protection_forced:true,recurring_frequencies:b,monitoring:false,special_description:"The Instructor demo plan lets you access all features to teach Bubble; it should never be used for production.",can_buy_plugins:true,paid_plugin_free:true,discourse_sso:false,two_factor_auth:false,export_app_json:false,versions:2,algolia_search:true,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:false},app_test_dedicated_on_main:{not_shown:true,live_version:true,display:"Test Dedicated",custom_domain:false,no_branding:true,import_export_csv:true,collaboration:m,upload_csv_run_mode_limit:1e3,possible_additional_units:0,api:true,scheduler:true,max_schedules_per_thing:100,bulk:true,logs:12,version_control:1,db_backup:1,sub_apps:false,ssl:false,seo:false,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,pw_protection_forced:true,recurring_frequencies:b,monitoring:false,initial_capacity:0,initial_storage:5,can_buy_plugins:false,paid_plugin_free:true,discourse_sso:false,two_factor_auth:true,export_app_json:false,versions:0,data_trigger:true,ab_test_integration:true,can_use_multiple_clusters:false},app_testing:{not_shown:true,live_version:true,custom_domain:true,import_export_csv:true,upload_csv_run_mode_limit:100,collaboration:1,api:true,no_branding:true,bulk:true,scheduler:true,max_schedules_per_thing:1,seo:true,custom_headers:true,hosted_files:true,logs:0,support:"Two business days",price:"na",version_control:1*24,db_backup:24*7,sub_apps:false,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:w,monitoring:false,initial_capacity:0,can_buy_plugins:false,paid_plugin_free:false,discourse_sso:true,two_factor_auth:false,export_app_json:false,versions:0,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:false},forum_apps:{not_shown:true,live_version:true,custom_domain:false,import_export_csv:true,upload_csv_run_mode_limit:100,possible_additional_units:0,no_branding:true,initial_capacity:0,collaboration:1,api:true,scheduler:true,max_schedules_per_thing:1,bulk:true,logs:m,support:"Same-day",price:"79",version_control:1*24*30,db_backup:24,sub_apps:false,seo:false,custom_headers:true,ssl:false,edit_mode_pw_protection:true,pw_protection:false,recurring_frequencies:[v.None],monitoring:false,can_buy_plugins:false,paid_plugin_free:false,discourse_sso:false,two_factor_auth:false,export_app_json:false,versions:0,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:false},template_app:{display:"Template",live_version:true,not_shown:true,custom_domain:false,import_export_csv:false,upload_csv_run_mode_limit:0,no_branding:false,possible_additional_units:0,initial_capacity:0,collaboration:3,api:true,scheduler:true,max_schedules_per_thing:0,bulk:false,logs:0,seo:false,custom_headers:true,hosted_files:false,support:"Same-day",price:"0",version_control:1*24*30,db_backup:1,sub_apps:false,ssl:false,edit_mode_pw_protection:true,pw_protection:false,recurring_frequencies:[v.None],monitoring:false,can_buy_plugins:true,paid_plugin_free:true,discourse_sso:false,two_factor_auth:false,export_app_json:false,versions:0,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:false},app_covid:{not_shown:true,live_version:true,display:"Covid Special",custom_domain:true,import_export_csv:true,upload_csv_run_mode_limit:1e3,no_branding:false,initial_capacity:10,initial_storage:10,possible_additional_units:0,collaboration:15,api:true,scheduler:true,max_schedules_per_thing:20,bulk:true,logs:7*2*24,version_control:24*365,db_backup:24*365,sub_apps:true,ssl:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,can_buy_plugins:false,paid_plugin_free:true,discourse_sso:true,two_factor_auth:true,export_app_json:true,versions:15,algolia_search:true,data_trigger:true,ab_test_integration:false,can_use_multiple_clusters:true},app_employee:{not_shown:true,live_version:true,display:"Employee",not_paid_per_app:true,custom_domain:true,import_export_csv:true,upload_csv_run_mode_limit:1e3,no_branding:false,initial_capacity:10,initial_storage:10,possible_additional_units:0,collaboration:1,api:true,scheduler:true,max_schedules_per_thing:20,bulk:true,logs:7*2*24,version_control:24*365,db_backup:24*365,sub_apps:true,ssl:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,can_buy_plugins:true,paid_plugin_free:true,discourse_sso:false,two_factor_auth:true,export_app_json:true,versions:5,algolia_search:true,data_trigger:true,ab_test_integration:true,can_use_multiple_clusters:true},version_control_beta_2023:{...Ee,not_shown:true,display:"Version Control Beta",not_paid_per_app:true,custom_domain:false,no_branding:false,collaboration:25,version_control:24*30,db_backup:24*30,versions:50},app_organization_free:E,app_plugin_demo:T};const Oe={personal:{display:"Personal",live_version:true,custom_domain:true,private_apps:2,possible_additional_units:0,no_branding:true,initial_capacity:2,initial_storage:10,import_export_csv:true,upload_csv_run_mode_limit:100,collaboration:1,api:true,scheduler:true,max_schedules_per_thing:1,logs:24*7,bulk:true,seo:true,custom_headers:true,hosted_files:true,version_control:1*24,db_backup:24*7,sub_apps:false,ssl:false,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:w,monitoring:true,can_buy_plugins:false,paid_plugin_free:false,discourse_sso:false,export_app_json:false,versions:0,data_trigger:false,ab_test_integration:false,can_use_multiple_clusters:false},professional:{display:"Professional",live_version:true,custom_domain:true,private_apps:5,possible_additional_units:0,import_export_csv:true,upload_csv_run_mode_limit:100,no_branding:true,initial_capacity:2,initial_storage:10,collaboration:3,api:true,seo:true,custom_headers:true,hosted_files:true,bulk:true,scheduler:true,max_schedules_per_thing:1,logs:24*14,version_control:1*24*30,db_backup:24*30,sub_apps:false,ssl:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:y,monitoring:true,can_buy_plugins:false,paid_plugin_free:false,discourse_sso:true,export_app_json:false,versions:0,data_trigger:false,ab_test_integration:false,can_use_multiple_clusters:false},team:{display:"Team",live_version:true,custom_domain:true,private_apps:15,import_export_csv:true,upload_csv_run_mode_limit:100,possible_additional_units:0,initial_capacity:2,no_branding:true,collaboration:11,api:true,scheduler:true,max_schedules_per_thing:1,bulk:true,logs:m,version_control:1*24*365,db_backup:24*90,sub_apps:true,seo:true,custom_headers:true,hosted_files:true,ssl:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,can_buy_plugins:false,paid_plugin_free:false,discourse_sso:true,export_app_json:false,versions:0,data_trigger:false,ab_test_integration:true,can_use_multiple_clusters:false},app_personal:{display:"Personal",no_branding:true,live_version:true,api:true,scheduler:true,max_schedules_per_thing:1,initial_capacity:0,initial_storage:10,possible_additional_units:0,collaboration:1,logs:1*24,version_control:7*1*24,db_backup:7*1*24,custom_domain:true,ssl:true,sub_apps:false,import_export_csv:true,upload_csv_run_mode_limit:100,bulk:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:w,monitoring:true,monthly_price:16,yearly_price:14,support:"Email",can_buy_plugins:true,paid_plugin_free:false,discourse_sso:false,two_factor_auth:false,export_app_json:true,versions:0,data_trigger:false,ab_test_integration:false,can_use_multiple_clusters:false},app_professional:{display:"Professional",live_version:true,no_branding:true,possible_additional_units:38,initial_capacity:2,initial_storage:10,api:true,scheduler:true,max_schedules_per_thing:5,bulk:true,collaboration:2,logs:7*2*24,version_control:1*24*30,db_backup:24*30,custom_domain:true,ssl:true,sub_apps:false,import_export_csv:true,upload_csv_run_mode_limit:200,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:y,monitoring:true,monthly_price:69,yearly_price:62,support:"Email",can_buy_plugins:true,paid_plugin_free:false,discourse_sso:true,two_factor_auth:false,export_app_json:true,versions:0,data_trigger:false,ab_test_integration:false,can_use_multiple_clusters:false},app_team:{display:"Team",live_version:true,custom_domain:true,no_branding:true,import_export_csv:true,upload_csv_run_mode_limit:1e3,initial_capacity:2,initial_storage:10,possible_additional_units:38,collaboration:8,api:true,scheduler:true,max_schedules_per_thing:10,bulk:true,logs:7*2*24,version_control:1*24*90,db_backup:24*90,sub_apps:true,ssl:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,monthly_price:185,yearly_price:165,support:"Priority email",can_buy_plugins:true,paid_plugin_free:false,discourse_sso:true,two_factor_auth:false,export_app_json:true,versions:0,data_trigger:false,ab_test_integration:false,can_use_multiple_clusters:false},app_production:{display:"Production",live_version:true,custom_domain:true,import_export_csv:true,upload_csv_run_mode_limit:1e3,no_branding:true,initial_capacity:2,initial_storage:10,possible_additional_units:38,collaboration:15,api:true,scheduler:true,max_schedules_per_thing:20,bulk:true,logs:7*2*24,version_control:24*365,db_backup:24*365,sub_apps:true,ssl:true,seo:true,custom_headers:true,hosted_files:true,edit_mode_pw_protection:true,pw_protection:true,recurring_frequencies:b,monitoring:true,monthly_price:500,yearly_price:445,support:"Priority email",can_buy_plugins:true,paid_plugin_free:false,discourse_sso:true,two_factor_auth:true,export_app_json:true,versions:0,data_trigger:false,ab_test_integration:false,can_use_multiple_clusters:false}}},{"./client_config":41,"./constants/app_plans":47,"./constants/app_usage":48,"./constants/subscriptions":90,"./constants/time":92,"./lib":741,"./logger":744,"./shared/pricing_configs":800,"./u":823,"core-js/modules/web.dom-collections.iterator.js":1123,pluralize:2275}],15:[function(e,t,n){"use strict";const r=n;r.message="Bug fix for permissions on server side workflows";r.link="https://forum.bubble.io/t/upgrade-to-bubble-version-23-privacy-rules-tweak/264611";r.date=1684949231611;e("./bubble_version").register(23,r)},{"./bubble_version":18}],16:[function(e,t,n){"use strict";const r=n;r.message='Bug fix for correctly returning the empty status in dynamic expressions for API calls that return structs (i.e. "<API return value> is empty")';r.link="https://forum.bubble.io/t/upgrade-to-bubble-version-24-correctly-get-is-empty-status-for-api-call-results/271159";r.date=168798975e4;e("./bubble_version").register(24,r)},{"./bubble_version":18}],17:[function(e,t,n){"use strict";const r=n;r.message="Giving all external API calls a default user agent if they don't already have one set";r.link="https://forum.bubble.io/t/upgrade-to-bubble-version-25-giving-all-external-api-calls-a-default-user-agent-if-they-dont-already-have-one-set/271309";r.date=1688634e6;e("./bubble_version").register(25,r)},{"./bubble_version":18}],18:[function(e,t,n){"use strict";const r=n;const i=e("./../u");r.LATEST_VERSION=25;let s=null;r.get_bv=function(e){if(!s){u()}return s[e]};let o=null;r.get_all_version_messages=function(){if(!o){const e=[];for(let t=0;t<=r.LATEST_VERSION;t++){const n=c(t);e.push({id:t,message:n.message,link:n.link,date:n.date})}o=e}return o};const a=e;const l={};r.register=function(e,t){l[e]=t};function c(e){var t;return(t=l[e])!=null?t:a("./"+String(e))}function u(){let t;if(i.on_client()){var n;t=(n=window.bubble_version)!=null?n:r.LATEST_VERSION}else{t=0}let o=e("./latest");const a={};for(let e=r.LATEST_VERSION;e>=t;e--){o=a[e]=i.extend({},o,c(e))}s=a}},{"./../u":823,"./latest":19}],19:[function(e,t,n){"use strict";const r=n;const i=e("./../u/shared/b_date");r.date_code=i.date_math;const s=e("./../core/core_elements/legacy/responsive_v0/shared/text_elements");r.apply_dynamic_properties_text=s.apply_dynamic_properties_text;const o=e("../core/core_datasources/utilities/core_ds_db_ops_utilities");r.resolve_constraints=o.resolve_constraints;r.s3_get=(e,t,n)=>e.get_redirect({path:t,appname:n});r.fileupload_too_large=e=>false;const a=e("../constants/auth");r.NO_SUCH_USER=a.INVALID_LOGIN_CREDENTIALS;r.WRONG_PASSWORD=a.INVALID_LOGIN_CREDENTIALS;r.wrong_password_msg="We didnt find an account with those login credentials";r.throw_on_failed_pwd_reset=false;const l=e("../constants/runmode");r.MAX_POPUP_ZINDEX=l.MAX_POPUP_ZINDEX},{"../constants/auth":50,"../constants/runmode":83,"../core/core_datasources/utilities/core_ds_db_ops_utilities":232,"./../core/core_elements/legacy/responsive_v0/shared/text_elements":354,"./../u/shared/b_date":836}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.track_with_marketing_metadata=n.track_count=n.track=n.retrieve_utm_from_header=n.reset=n.page=n.package_utm_data=n.manage_utm_data=n.init_segment=n.format_campaign_data=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=i(e("./../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./client/analytics",t.exports);function s(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++){r[i]=arguments[i]}if(window.meta_analytics){return window.meta_analytics[e](...r)}else{return t}}}const o=s("retrieve_utm_from_header",[]);n.retrieve_utm_from_header=o;const a=s("format_campaign_data",{});n.format_campaign_data=a;const l=s("package_utm_data","");n.package_utm_data=l;const c=s("manage_utm_data",undefined);n.manage_utm_data=c;const u=s("init_segment",undefined);n.init_segment=u;const d=s("reset",undefined);n.reset=d;const p=s("track_with_marketing_metadata",undefined);n.track_with_marketing_metadata=p;const _=s("track",undefined);n.track=_;const f=s("page",undefined);n.page=f;const h=s("track_count",undefined);n.track_count=h},{"./../safe_require":777,"core-js/modules/web.dom-collections.iterator.js":1123}],21:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../lang/appquery");const i=e("../client_config");const s=e("../lib");const o=e("../logger");const a=e("../u");const l=n;l.add_bubble_marketing=p;function c(e){if((!r.app_plan().no_branding&&!i.is_dedicated||r.app_version()==="live"&&r.app_plan().force_branding_live)&&(r.appname()!=="meta"||!["invoice","payout_receipt","poststripeauth"].includes(e))){const e="https://meta.cdn.bubble.io/f1585607370503x914556455591480200/banner-icon.svg";const n=$('<div style="width: 128px !important; position: fixed !important; bottom: 10px !important; right: 10px !important; height: 29px !important; z-index: 100000000000 !important; box-shadow: 0px 0px 20px 0 #00000069 !important; background: #0205D3 !important; border-radius: 3px !important;"></div>');const i=$('<div style="position: absolute;" class="notranslate" translate="no"></div>');const s=$(`<a target="${r.appname()==="meta"?"_self":"_blank"}" style="width: 100%; height: 100%; position: absolute;"></a>`);const o=$('<div style=""></div>');o.append($(`<img alt="Bubble" src="${e}" style="width: 15px !important; margin-top: 7px !important; margin-left: 6px !important; float: left;"></img>`));const a=$('<div style="color: white; font-size: 12px; font-family: Arial, sans-serif; margin-top: 9px; float: left; margin-left: 8px; width: 95px; font-weight: bold;"></div>');o.append(a);n.append(i.append(o));n.append(s);const l="https://bubble.io?utm_source=app_mention&utm_content="+r.appname();s.attr("href",l);if(window.self!==window.top){$(window.frameElement).parent().append(n)}else{$("body").append(n)}const c="Built on Bubble";a.html(c);const p=n.html();if(!["meta","pioneer","bubblepodcasts"].includes(r.appname())){var t;const e=(t=d("setInterval"))!=null?t:window.setInterval;if(window.self===window.top){e.call(window,(()=>u(n,p)),2e3)}}}}function u(e,t){const n={tampered_banner:e.html()!==t,banner_not_visible:!e.is(":visible"),moved_div:e.parent()[0]!==$("body")[0],not_in_document:!$.contains(document,e[0])};let r;if(n.tampered_banner){r={original_html:t,tampered_html:e.html()}}for(const[e,t]of Object.entries(n)){if(t){o.info("User bypassed free branding",{broken_rule:e,details:r});alert("This app is a free plan and should have a Bubble banner. Please upgrade to remove this banner. Removing or altering the banner in any way is against Bubble terms and can lead to your account termination.");document.location=s().location.get_base_for_meta();return}}}function d(e){const t=document.createElement("iframe");document.body.appendChild(t);const n=t.contentWindow[e];document.body.removeChild(t);return n}function p(e){setTimeout((()=>{a.page_is_loaded();setTimeout((()=>window.onpopstate=()=>s().pageparam.invalidate()),1500);setTimeout((()=>{if(!(r.app_plan().no_branding&&r.get_public_setting("remove_bubble_console"))||r.app_plan().force_branding_live){a.console_with_styling("This web application is entirely built without code on Bubble");console.log("Visit https://bubble.io to build your own apps")}}),3e3);setTimeout((()=>{const e=$.migrateWarnings.filter((e=>!e.includes("deprecated")));e.forEach((e=>{o.info("JQMIGRATE WARNING "+e)}))}),1e4);if(!a.is_debug_mode()){setTimeout((()=>c(e)),100)}}),200)}},{"../client_config":41,"../lang/appquery":651,"../lib":741,"../logger":744,"../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],22:[function(e,t,n){"use strict";const r=n;const i=e("../shared/initializer");const s=e("../logger");const o=e("./logging_medium");const a=e("./scheduledTasks");const l=e("../safe_require");const c=e("./elementservice");e("../core/core_elements");e("../external");e("../constants/auth");const u=e("../core/plugin_initializer");const d=e("../db/values/registration");const p=e("../geolocation/client/client_core");e("../shared/payment_converter");e("../u/shared/decaf");const _=e("../lib/default_lib");r.initialize=function(){i.initialize();_.register();f();if(typeof window!=="undefined"){const t=e("../../vendor/jquery_plugins/moment.timezone.min.js");l.safe_register("moment",t)}s.register_logger(o);a.start();u.initialize();d.register_values();p.init();c.initialize()};function f(){var e;(e=Math.log2)!=null?e:Math.log2=e=>Math.log(e)*Math.LOG2E}},{"../../vendor/jquery_plugins/moment.timezone.min.js":2353,"../constants/auth":50,"../core/core_elements":322,"../core/plugin_initializer":384,"../db/values/registration":477,"../external":618,"../geolocation/client/client_core":622,"../lib/default_lib":740,"../logger":744,"../safe_require":777,"../shared/initializer":797,"../shared/payment_converter":799,"../u/shared/decaf":844,"./elementservice":24,"./logging_medium":28,"./scheduledTasks":35}],23:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("./../u");const s=e("./../logger");const o=e("../constants/db");const a=e("../constants/byte");const l=e("../webfonts");const c=e("../lang/evaluation/element_eval");const u=e("./../lib");const d=e("./../lang/lang");const p=e("./../lang/btypes");const _=e("./../lang/application");const f=e("./../lang/appquery");const h=e("../db/values/ClientDBObject");const m=e("./../client_config");const g=e("./../editor/utils/evaluate_condition");const{ignoreError:v}=e("../u/shared/callbacks");const{get_composer:b}=e("../editor/composer/compatibility/composers");const{DropdownContents:y}=e("../editor/composer/utilities/dropdown_contents");const w={normal:{off:"Normal",on:"Run"},slow:{off:"Slow",on:"Run slow"},step_by_step:{off:"Step-by-step",on:"Run next"}};const x=250;const j=1e3;function A(e){if(m.d_perm_field){i.run_once(30,(()=>{for(const e of f.custom_type("user").fields()){if(e.display()===m.d_perm_field&&!e.deleted()){return u().current_user().child(e.name()).get()}}return false}),((t,n)=>{if(t){s.log(t);e(false)}else{e(n)}}))}else{u().location.get("server://api/1.1/u/can_view").callback(((t,n)=>{if(t){s.log(t);e(false)}else{e(n)}}))}}let M={};function E(e,t,n){const r=e.privacy_roles().filter((e=>e.name()!=="everyone"));if(!r.length){i.run_once(30,(()=>u().db_instance().get(t.thing_id).raw()),((e,t)=>{if(e){s.log(e)}else{n(t)}}))}else{var o,a;const e=i.json_stringify(t);(a=(o=M)[e])!=null?a:o[e]=u().location.post("server://api/1.1/u/check_privacy",t);M[e].callback(((e,t)=>{if(e){s.log(e)}else{n(t)}}))}}const k={};class O{constructor(){this.canvas=i.div("debugger-canvas",$("body"));this.highlight_box=i.div("highlight-box",$("body"));this.hide_highlight_box();this.top_bar=i.div("top-bar",this.canvas);this.usage={};const e=i.local_storage_get("bubble_debugger_situation");this.canvas.hide();this.ready_key=i.MakeKey(null,"debugger can render");A((e=>{if(e){this.canvas.show();i.WaitFor(i.page_loaded_key,(()=>i.div("debugger-page-mention",$(".main-page.Page"),"The page is higher than your real design as the debugger is visible and displays a white area. \n It will be back to normal when the debugger is off.")))}else{const e=encodeURIComponent(window.location.href);const t=`${u().location.get_base_for_meta()}/appeditor/debug_mode?on_success=${e}`;window.location.href=t}this.ready_key.turn()}));this.workflow_area=i.div("workflow-area",this.top_bar);i.div("title",this.workflow_area,"Debugger");this.workflow_buttons={};for(const e in w){const t=w[e];this.workflow_buttons[e]=i.div("btn workflow-mode",this.workflow_area,t.off);this.workflow_buttons[e].click((()=>{this.set_workflow_mode(e)}))}this.breakpoint_mention=i.div("title",this.workflow_area);this.breakpoint_mention.hide();this.set_workflow_mode(e!=null?e:"normal");this.element_area=i.div("element-area",this.top_bar);const t=i.div("element-picker-wrapper",this.element_area);this.errors_area=i.div("error-area",this.top_bar);this.error_icon=i.div("error-icon",this.errors_area);this.error_icon.click((()=>{if(this.is_error_console_on){this.turn_off_error_console()}else if(this.eval_errors.length){if(this.is_element_inspector_on){this.turn_off_element_inspector((()=>{this.turn_on_error_console()}))}else{this.turn_on_error_console()}}}));this.error_count=i.div("error-count",this.errors_area);this.error_count.hide();this.current_element=u().composer.Owner();i.WaitFor(u().element.ready_key,(()=>{this.element_picker=b("Dropdown",this.current_element,{set:u().sets.get_set("PageInstances")(u().element.get_page()),on_change:e=>{this.start_element_inspection(e,e.get_partial())}});this.element_picker.get_canvas().addClass("element-picker");t.append(this.element_picker.get_canvas());this.element_picker.disable()}));this.element_analysis_btn=i.div("btn element-analysis grey",this.element_area,"Inspect");this.element_analysis_btn.click((()=>{if(this.is_element_inspector_on){this.turn_off_element_inspector()}else{this.turn_on_element_inspector()}}));this.responsive_area=i.div("responsive-area",this.element_area);const n=i.Box(false);this.responsive_area.click((()=>n(!n())));i.autorun((()=>{if(n()){this.responsive_area.addClass("showing");this.responsive_area.text("Hide responsive boxes");$(window.document.body).addClass("bubble-r-debug");$(".bubble-r-box,.bubble-r-line").addClass("debug");$(".bubble-r-box").off("click.debug_click");$(".bubble-r-box").on("click.debug_click",(e=>{const t=e.currentTarget.box_debugging_metadata;let n="These elements all stretch and move together: ";n+=Object.values(t.contains).map((e=>f.element(e).get_name())).join(", ");const r=f.element(t.first);n+="\n\nThis box is hidden / shown based on element "+r.get_name();n+=" which has the following visibility rule: ";const i=r.responsive_show();const s=r.responsive_show_width();if(i!=null){n+="hide when parent container "+i+" "+s}else{n+="always show"}window.alert(n)}))}else{this.responsive_area.removeClass("showing");$(window.document.body).removeClass("bubble-r-debug");$(".bubble-r-box,.bubble-r-line").removeClass("debug");$(".bubble-r-box").off("click.debug_click");this.responsive_area.text("Show responsive boxes")}}));const r=()=>{var e;const t=(e=u().element.get_page())==null?void 0:e.element;if(t){if(!t.use_responsive_algorithm()){this.responsive_area.hide()}}else{setTimeout(r,300)}};r();this.element_inspector_pane=i.div("element-inspector-pane main-pane",this.canvas);this.element_properties_list=i.div("element-properties",this.element_inspector_pane);this.element_evaluator=i.div("expression-evaluator",this.element_inspector_pane);this.workflow_debugger_pane=i.div("workflow-debugger-pane main-pane",this.canvas);this.workflow_vert_flex_container=i.div("workflow-vert-flex",this.workflow_debugger_pane);this.workflow_evaluator=i.div("expression-evaluator",this.workflow_debugger_pane);this.workflow_display_panel=i.div("workflow-display-panel",this.workflow_vert_flex_container);this.workflow_display_panel_innner=i.div("workflow-display-panel-inner",this.workflow_display_panel);this.workflow_properties_list=i.div("workflow-properties",this.workflow_vert_flex_container);this.greyout_when_debugging=i.div("greyout-when-debugging",$("body"));this.greyout_when_debugging.hide();this.error_console=i.div("error-console",this.canvas);this.error_list=i.div("error-list",this.error_console);this.clear_errors=i.div("clear-errors",this.error_console,"Clear errors");this.clear_errors.click((()=>{this.reinitialize_errors();this.turn_off_error_console()}));this.error_console.hide();this.reinitialize_errors=()=>{this.eval_errors=[];this.last_seen_error=0};this.element_inspector_pane.hide();this.workflow_debugger_pane.hide();this.debugger_opened=false;this.evaluation_navigation_stack=[];this._hovered_elements=[];this.reinitialize_errors()}highlight(e,t,n,r,s){i.WaitFor(this.ready_key,(()=>{if(e.get_static_property("breakpoint")){this.set_workflow_mode("step_by_step");this.breakpoint_mention.show();if(e instanceof d.Event){this.breakpoint_mention.text("(breakpoint on event)")}else{this.breakpoint_mention.text("(breakpoint on action)")}}else{this.breakpoint_mention.hide()}if(this.workflow_mode==="normal"||this.is_element_inspector_on){s()}else{const i=()=>{if(e instanceof d.Event){this.workflow_left=0}this.display_workflow(e.event());this.workflow_display_panel_innner.find(".workflow-item.current").removeClass("current");this.workflow_divs[e.id()].addClass("current");this.make_sure_action_visible(e);this.build_workflow_item_analysis(e,n,t,r);if(this.workflow_mode==="slow"){setTimeout((()=>s()),j)}else{for(const e of Object.values(this.workflow_buttons)){e.one("click.while-running",(()=>s()))}}};if(!this.is_workflow_inspector_on){this.turn_on_workflow_debugger((()=>{i()}))}else{i()}}}))}all_finished(e){if(this.is_workflow_inspector_on){setTimeout((()=>{if(e()){this.turn_off_workflow_debugger()}}),this.workflow_mode==="normal"?0:j)}}element_hovered(e){this.current_element.set(e);this._hovered_elements.push(e);e.canvas.one("mouseleave.debugger",(()=>{i.array_remove(this._hovered_elements,e);if(this._hovered_elements.length){this.element_hovered(this._hovered_elements[this._hovered_elements.length-1])}}));if(this.is_element_inspector_on){const t=e.get_canvas();this.hide_highlight_box();this.position_highlight_box(t);if(e.element.type()==="Link"){t.on("click.link_debugger",(e=>{e.preventDefault();e.stopPropagation();return false}));t.one("mouseleave.link_debugger",(()=>t.off("click.link_debugger")))}}}element_clicked(e,t){this.current_element.set(e);if(this.is_element_inspector_on){if(e.element.type()==="GroupItem"){e=e.parent()}this.start_element_inspection(e,t);return true}else{return false}}start_element_inspection(e,t){this.evaluation_navigation_stack=[];this.build_element_analysis(e,t)}update_error_icon(){if(this.eval_errors.length>this.last_seen_error){this.error_icon.addClass("has-errors");this.error_count.text(this.eval_errors.length-this.last_seen_error);this.error_count.show();if(!this.eval_errors.some((e=>!["warning","performance"].includes(e.type)))){this.errors_area.addClass("warning-only")}else{this.errors_area.removeClass("warning-only")}}else{this.error_icon.removeClass("has-errors");this.error_count.hide()}if(this.eval_errors.length===0){this.errors_area.addClass("disabled")}else{this.errors_area.removeClass("disabled")}}report_error(e){var t,n;(t=this.unique_eval_errors_cache)!=null?t:this.unique_eval_errors_cache={};e.date=i.format_date(new Date,"HH:MM:ss");const r=(n=e.instance)==null?void 0:n.toUniqueString();if(!e.instance||!this.unique_eval_errors_cache[r+e.error.message]){if(e.instance){this.unique_eval_errors_cache[r+e.error.message]=true}this.eval_errors.push(e);this.update_error_icon()}}get_request_size(e,t){if(!t){if(e.indexOf("apiservice/doapicallfromserver")!==-1){t="api"}else if(e.indexOf("workflow/start")!==-1){t="workflow"}else if(e.indexOf("elasticsearch/")!==-1){t="data"}}if(!t){return}for(const s of(n=(r=window.performance)==null?void 0:(i=r.getEntriesByName)==null?void 0:i.call(r,e))!=null?n:[]){var n,r,i;if(k[t+"_"+s.startTime]){continue}k[t+"_"+s.startTime]=true;if(t==="image"){if(s.duration>0){this.report_image_size(s.duration)}}else{if(s.transferSize>0){this["report_"+t+"_size"](s.transferSize)}}break}}_report_with_threshold(e,t,n,r){var i,s,o,a,l;(s=(i=this.usage)[e])!=null?s:i[e]=0;(l=(o=this.usage)[a=e+"_current"])!=null?l:o[a]=0;if(t>0){this.usage[e]+=t;this.usage[e+"_current"]+=t}if(this.usage[e+"_current"]>n){this.report_error({type:"performance",error:{message:r(this.usage[e])}});this.usage[e+"_current"]=0}}report_capacity(e){this._report_with_threshold("capacity",e,5*1e3,(e=>"Your application could have been "+i.add_thousand_sep(Math.ceil(e/1e3))+" seconds faster since page load with more capacity. You add more capacity in the Settings Tab of the Editor."))}report_image_size(e){this._report_with_threshold("image_download_time",e,30*1e3,(e=>"Downloading images on this page has cumulatively taken more than "+Math.floor(e/1e3)+" seconds. You can look at showing less images or making them smaller to make your app faster."))}report_api_size(e){this._report_with_threshold("api_download_size",e,a.MEBIBYTE,(e=>"API calls on this page have downloaded more than "+Math.floor(e/a.MEBIBYTE*10)/10+" megabytes. This can slow down your app, you should look into making different calls."))}report_workflow_size(e){this._report_with_threshold("wf_download_size",e,a.MEBIBYTE,(e=>"Workflows on this page have downloaded more than "+Math.floor(e/a.MEBIBYTE*10)/10+" megabytes. This can slow down your app, you could look into simplifying your workflows."))}report_data_size(e){this._report_with_threshold("data_download_size",e,2*a.MEBIBYTE,(e=>"Your page has downloaded more than "+Math.floor(e/a.MEBIBYTE*10)/10+" megabytes of data via searches. This can slow down your app, you could look into simplifying it to download less data."))}update_error_console(){this.error_list.empty();if(this.eval_errors.length){const e=e=>{let{instance:t,event:n,prop_name:r,error:s,date:o,type:a}=e;let l;let c;const u=i.div("error-row",this.error_list);i.div("date",u,o);switch(a){case"element":{const e=t.element.fields(true);for(const t of e){if(t.name===r){var d;l=(d=t.caption)!=null?d:t.name;break}}c=i.div("element-name",u,"Element "+t.element.get_name());i.div("property-name",u,l);break}case"workflow":c=i.div("event-name",u,"Event "+n.display());break;case"action":c=i.div("event-name",u,"Action "+t.display());break;case"general":c=i.div("general-name",u,"General error");break;case"warning":c=i.div("general-name",u,"General warning");break;case"performance":c=i.div("general-name",u,"Performance warning");break}if(t&&t.get_canvas!=null){c.on("mouseenter",(e=>{this.position_highlight_box(t.get_canvas());c.one("mouseleave",(()=>this.hide_highlight_box()))}))}const p=i.div("error-message",u);p.html(s.message);return u};const t=[...this.eval_errors].reverse();for(let n=0;n<t.length;n++){const r=t[n];const i=e(r);if(n<this.eval_errors.length-this.last_seen_error){i.addClass("non-seen")}else{i.removeClass("non-seen")}}this.clear_errors.show()}else{this.clear_errors.hide()}}set_workflow_mode(e){var t,n;for(const t in this.workflow_buttons){const n=this.workflow_buttons[t];if(t!==e){n.removeClass("red");n.addClass("grey")}}(t=this.workflow_buttons)==null?void 0:t[e].addClass("red");(n=this.workflow_buttons)==null?void 0:n[e].removeClass("grey");this.workflow_mode=e;i.local_storage_put("bubble_debugger_situation",this.workflow_mode)}slide_up_debugger(e){if(this.debugger_opened){return}M={};this.debugger_opened=true;this.canvas.css("bottom",-x);i.velocity(this.canvas,{bottom:0},{duration:500,complete_cb:()=>e==null?void 0:e()});this.moved_floating_groups={};for(const e of $(".bubble-element.FloatingGroup.floating-group:visible")){var t;if(["bottom","both"].includes((t=e.bubble_data)==null?void 0:t.bubble_instance.get_static_property("floating_reference"))){var n;const t=parseInt($(e).css("bottom"));this.moved_floating_groups[(n=e.bubble_data)==null?void 0:n.bubble_instance.toUniqueString()]={old_bottom:t,div:$(e)};i.velocity($(e),{bottom:t+x},{duration:500})}}}slide_down_debugger(e){if(!this.debugger_opened){return}this.debugger_opened=false;i.velocity(this.canvas,{bottom:-x},{duration:500,complete_cb:()=>{this.canvas.css("bottom",0);e()}});for(const{old_bottom:e,div:t}of Object.values(this.moved_floating_groups)){i.velocity(t,{bottom:e},{duration:500})}}turn_on_element_inspector(){this.is_element_inspector_on=true;this.element_analysis_btn.addClass("red");this.element_analysis_btn.removeClass("grey");this.element_analysis_btn.text("Stop");this.workflow_area.addClass("disabled");this.errors_area.addClass("disabled");this.element_inspector_pane.show();this.element_picker.enable();this.slide_up_debugger()}turn_off_element_inspector(e){this.hide_highlight_box();this.is_element_inspector_on=false;this.element_analysis_btn.removeClass("red");this.element_analysis_btn.addClass("grey");this.element_analysis_btn.text("Inspect");this.workflow_area.removeClass("disabled");this.errors_area.removeClass("disabled");this.element_picker.disable();this.slide_down_debugger((()=>{this.element_inspector_pane.hide();e==null?void 0:e()}))}turn_on_error_console(){this.is_error_console_on=true;this.greyout_when_debugging.show();this.element_area.addClass("disabled");this.workflow_area.addClass("disabled");this.error_console.show();this.update_error_console();this.slide_up_debugger();this.error_icon.removeClass("has-errors");this.error_count.hide()}turn_off_error_console(){this.is_error_console_on=false;this.last_seen_error=this.eval_errors.length;this.element_area.removeClass("disabled");this.workflow_area.removeClass("disabled");this.greyout_when_debugging.hide();this.slide_down_debugger((()=>{this.error_console.hide()}))}turn_on_workflow_debugger(e){this.is_workflow_inspector_on=true;this.greyout_when_debugging.show();this.element_area.addClass("disabled");this.errors_area.addClass("disabled");this.workflow_debugger_pane.show();this.slide_up_debugger(e)}turn_off_workflow_debugger(){this.is_workflow_inspector_on=false;this.greyout_when_debugging.hide();this.element_area.removeClass("disabled");this.errors_area.removeClass("disabled");for(const e in this.workflow_buttons){const t=this.workflow_buttons[e];t.text(w[e].off);t.off("click.while-running")}this.breakpoint_mention.hide();this.slide_down_debugger((()=>{this.workflow_debugger_pane.hide()}))}build_element_analysis(e,t){this.element_properties_list.empty();this.element_evaluator.empty();this.build_custom_states(e,this.element_properties_list);this.build_states_list(e,t,this.element_properties_list);this.build_property_list(e.element,t,this.element_properties_list,undefined,undefined,e)}build_workflow_item_analysis(e,t,n,r){this.workflow_properties_list.empty();this.workflow_evaluator.empty();this.build_property_list(e,t,this.workflow_properties_list,n,r)}display_workflow(e){this.current_workflow=e;for(const e in this.workflow_buttons){const t=this.workflow_buttons[e];t.text(w[e].on)}this.workflow_divs={};this.workflow_display_panel_innner.empty();this.workflow_display_panel_innner.css("left",-this.workflow_left);this.display_workflow_item(e);for(const t of e.actions()){i.div("pre-action-arrow fa fa-arrow-right",this.workflow_display_panel_innner);this.display_workflow_item(t)}}display_workflow_item(e){this.workflow_divs[e.id()]=i.div("workflow-item",this.workflow_display_panel_innner);i.run_once(30,(()=>e.display()),v((t=>{this.workflow_divs[e.id()].text(t)})))}make_sure_action_visible(e){const t=this.workflow_display_panel.width()+this.workflow_display_panel.offset().left;const n=this.workflow_divs[e.id()];if(n.offset().left+n.width()>t-50||n.offset().left<0){this.workflow_left=n.offset().left-200-this.workflow_display_panel_innner.offset().left;i.velocity(this.workflow_display_panel_innner,{left:-this.workflow_left},{duration:1e3})}}get_sorted_fields(e,t){if(!e.property_sections){return}const n=e.property_sections();for(let e=0;e<t.length;e++){const r=t[e];for(let t=0;t<n.length;t++){const i=n[t];if(i.name!=null){if(i.name===r.pretty.section){r.rank=t;r.sub_rank=e;break}}}}function r(e,t){if(e.rank<t.rank){return-1}else if(e.rank>t.rank){return 1}else{if(e.sub_rank<t.sub_rank){return-1}else if(e.sub_rank>t.sub_rank){return 1}}}return t.sort(r)}build_property_list(e,t,n,r,s,o){var a,l;i.div("section-title",n,"Properties");const c=e.fields(true);this.get_sorted_fields(e,c);const u=e.field_names();for(const a of c){var d;if(a.include_in_redesign){continue}i.extend(a,u[a.name]);let l=e.property(a.name);const c=(d=e.get_style_if_exists)==null?void 0:d.call(e);if(c!=null&&l.is_empty()){const e=c.property(a.name);if(e!=null&&!e.is_empty()){l=e;l.from_style=true}}this.build_property_div(l,a,t,n,r==null?void 0:r[a.name],s,o)}if(e.is_action!=null&&!((a=e.is_action)!=null&&a.call(e))&&!((l=e.element_id)!=null&&l.call(e))){var p;i.div("section-super-title",n,`This workflow is triggered by ${(p=e.context_element())==null?void 0:p.display()}`)}}build_custom_states(e,t){let n=false;const r=[];const s=i.div("custom-states-evals",t);i.div("section-title",s,"Custom states and other values (scroll down for properties)");const o=(t,o,a,l)=>{r.push(t);n=true;i.run_once(30,(()=>a()),v((n=>{o=p.get(o);if(o.is_list()){if(Array.isArray(n)){n=u().db_instance().static_list(o.inner().id(),n)}}this.display_evaluation(o,n,l,i.div("prop-div state",s),false,{});if(["get_group_data","get_list_data"].includes(t)){if(e.state("datasource_changed_by_workflow_action")){i.div("privacy-warning datasource-changed-by-action",s,`The data in this group was changed by an action. The value of the group's data (above) may differ from the Data Source property below!`)}}})))};const a=p.get(e.element.get_value_id());for(const t of a.get_messages()){if(!["force_pressed","is_visible","isnt_visible","is_hovered","isnt_hovered","is_pressed","isnt_pressed","is_focused","isnt_focused","isnt_clickable"].includes(t.name())&&!r.includes(t.name())){o(t.name(),t.ret_btype(),(()=>t.evaluate(e)),t.description(e.element,true))}}if(!n){s.remove()}}evaluate_and_display_object(e,t,n,r){r.empty();i.run_once(30,(()=>n(e)),((e,n)=>{if(e){s.log(e);return}const i={};this.display_evaluation(p.get(n[1]),n[0],t+": ",r,undefined,i)}))}display_evaluation(e,t,n,r,a,l){var c;if(typeof((c=t)==null?void 0:c._id)==="function"){if(l[t._id()]){return}l[t._id()]=true}const d=i.div("expression-text",r,n);const m=i.div("privacy-warning",r);m.hide();const g=i.div("privacy-warning",r,"This user is a user without an ID, created when no cookies were allowed");g.hide();const v=i.div("eval",r);if(e.id().indexOf("element.")===0){const{canvas:e}=t;if(e!=null&&e.is(":visible")){v.text("Hover to reveal element");v.addClass("hoverable");v.on("mouseenter",(t=>{this.position_highlight_box(e);v.one("mouseleave",(()=>this.hide_highlight_box()))}))}else{v.text("Element currently invisible")}}else{if(t&&(e.is_list()||e.custom_type()!=null||e.bindable())){v.addClass("composite");const r=()=>{if(e.is_list()){if(a){d.html(n+'<div class="click-for-more">(list of things)</div>')}const r=e.inner();v.addClass("show-list");i.run_once(30,(()=>{var e,n;const r=(e=(n=t).length)==null?void 0:e.call(n);let i;if(t.loaded_count!=null){const e=t.loaded_count();if(e===0){i=Math.min(3,r)}else{i=e}}else{i=r}return t.get_children(0,i)}),((e,t)=>{if(e){s.log(e);return}if(!t.length){v.text("(empty)");v.addClass("empty")}else{v.empty();for(let e=0;e<t.length;e++){const n=t[e];this.display_evaluation(r,n,r.display()+" - "+(e+1)+": ",v,undefined,l)}}}))}else if(e.custom_type()!=null){const c=e.custom_type();if(a){d.html(n+'<div class="click-for-more">(thing)</div>')}if(c.name()==="user"&&t._id()===o.NO_USER){g.show()}const u={name(){return"_id"},display(){return"Unique ID"},value(){return"text"}};for(const e of c.fields().concat(_.get_special_fields(c)).concat([u])){var r;if(e.value()!=="not_indexed"&&!((r=e.deleted)!=null&&r.call(e))){i.run_once(30,(()=>{if(e.name()==="Created By"&&c.id()==="user"){return}if(["user_signed_up"].includes(e.name())){return}const n=p.get(c.to_value());const r=n.get_message(e.name());const i=r.ret_btype();const s=r.evaluate(t);return{field_ret_val:i,val:s,display:e.display()}}),((e,t)=>{if(e){s.log(e);return}if(t!=null&&t.val!=null){this.display_evaluation(t.field_ret_val,t.val,t.display+": ",v,true,l)}}))}}}else if(e.bindable()){if(a){d.html(n+'<div class="click-for-more">(API data)</div>')}for(const n of e.get_messages()){i.run_once(30,(()=>n.evaluate(t)),((e,t)=>{if(e){s.log(e);return}this.display_evaluation(n.ret_btype(),t,n.description().slice(3)+": ",v,true,{})}))}}};if(a){d.addClass("composite closed");v.hide();d.click((()=>{if(d.hasClass("closed")){d.removeClass("closed");d.addClass("opened");i.velocity(v,"slideDown",{duration:200});r()}else{d.removeClass("opened");d.addClass("closed");i.velocity(v,"slideUp",{duration:200})}}))}else{r()}}else if(e.has_debugging_display()){if(t==null&&e.matches("boolean")){t=false}i.run_once(30,(()=>e.debugging_display(t)),((n,r)=>{if(n){s.log(n);return}if(e.id()==="image"){i.img("image-preview",v,t)}else{if(!r){v.text("(empty)");v.addClass("empty")}else{v.text(r)}}}))}else if(t==null){v.text("(empty)");v.addClass("empty")}else{v.text("(some value that we don't know how to display)")}if(!a){var b;if(((b=e.custom_type)==null?void 0:b.call(e))!=null&&t instanceof h){const n={appname:f.appname(),app_version:f.app_version()};n.thing_id=t._id();const r=e.custom_type();E(r,n,(e=>i.run_once(30,(()=>t.raw()),((t,n)=>{if(t){s.log(t);return}let i=0;let o="";for(const t in e.thing){let s=e.thing[t];if(s!=null&&!["_version","_type","_id"].includes(t)){if(e.thing._type==="user"){if(t==="authentication"){var a,l;if(((a=s.email)==null?void 0:a.salt)!=null){delete s.email.salt}if(((l=s.email)==null?void 0:l.hashed_pw)!=null){delete s.email.hashed_pw}if(e.thing._id!==u().current_user()._id()){for(const e in s){const t=s[e];if(s!==["email"]&&t.access_token!=null){delete t.access_token}}}}else if(t==="stripeauthtoken"){s=undefined}}if(s!=null&&n[t]==null){var c;const e=(c=r.field(t).display())!=null?c:t;if(o){o=o+", "+e}else{o=e}i++}}}if(i>0){m.show();m.text(i+" hidden fields because of privacy rules ("+o+")");v.addClass("privacy-impact")}}))))}}}}build_expression_evaluator(e,t,n,r){var s;n.empty();i.div("section-title",n,"Evaluator");if(this.evaluation_navigation_stack.length>0){const e=i.div("back-btn",n,"back");e.click((()=>{const t=this.evaluation_navigation_stack[this.evaluation_navigation_stack.length-2];this.evaluation_navigation_stack.pop();if(t==null){e.hide();return}this.build_expression_evaluator(t.node,t.partial,t.div,t.path_to_open)}))}if(((s=this.evaluation_navigation_stack[this.evaluation_navigation_stack.length-1])==null?void 0:s.node.path())!==e.path()){this.evaluation_navigation_stack.push({node:e,partial:t,div:n})}this.display_expression(e,t,n,r)}display_expression(e,t,n,r){const s=i.div("expression",n);const o=i.div("analysis",n);function a(){n.css("margin-top",1);setTimeout((()=>n.css("margin-top",0)),20)}const l=e=>{let n;let l=null;if(e instanceof d.Literal){n=e.get_literal();if(typeof n==="string"){n=n.split("\n").join("  ")}}else{try{n=e.display()}catch(e){l=e;n="(An error occurred trying to evaluate this expression)"}}if(typeof n==="number"){n=n.toString()}const c=i.div("expression-node-div",s,n);if(l!=null){c.addClass("dynamic-expression");const t=()=>{o.empty();s.find(".dynamic-expression.selected").removeClass("selected");c.addClass("selected");const e=i.div("evaluation",o);e.text(l);a()};c.on("click",t);if(r===e.path()){t()}}else if(!e.is_static()){c.addClass("dynamic-expression");const l=()=>{o.empty();s.find(".dynamic-expression.selected").removeClass("selected");c.addClass("selected");if(e.get_spot()==="SlidableAtom"){const n=i.div("slidable-prop-divs",o);for(const r of e.fields()){if(r.include_in_redesign){continue}const i=e.property(r.name);this.build_property_div(i,r,t,n)}}const r=i.div("evaluation",o);this.evaluate_and_display_object(e,n,t,r);a()};c.on("click",(()=>{if(this.evaluation_navigation_stack[this.evaluation_navigation_stack.length-1]!=null){this.evaluation_navigation_stack[this.evaluation_navigation_stack.length-1].path_to_open=e.path()}l()}));if(r===e.path()){l()}}};const c=e=>{let t=e;while((n=t)!=null&&n.exists()){var n,r,i;l(t);if(t.has_args()){c(t.args())}t=(r=(i=t).next)==null?void 0:r.call(i)}};if(e instanceof d.TextExpression){for(const t of e.entries()){c(t)}}else{c(e)}a()}build_states_list(e,t,n){let r=e.element.states();const s=e.element.get_style_if_exists();if(s){r=r.concat(s.states())}if(!r.length){return}i.div("section-title",n,"Conditions");for(const s of r){if(s.exists()){const r=i.div("state-wrapper",n);this.build_property_div(s.condition(),{name:"condition",caption:"Condition "+(s.rank()+1)},t,r,undefined,undefined,e);r.addClass("state");if(c.is_state_on(e,s)){r.addClass("state-is-on");const o=i.div("state-properties",n);const a=e.element.fields(true);this.get_sorted_fields(e.element,a);for(const n of a){if(s.property_names().includes(n.name)){if(n.include_in_redesign){continue}const r=s.property(n.name);this.build_property_div(r,n,t,o,undefined,undefined,e)}}}else{r.addClass("state-is-off")}}}}build_property_div(e,t,n,r,s,o,a){if(["Button","Crop_Button"].includes(t.editor)||t.only_edit_mode||t.editor==="Label"&&t.set==null){return}const c=i.div("prop-div",r);i.run_once(30,(()=>{if(["ObjectList","FlyoutObjectList","StaticList"].includes(t.editor)){return null}else{let h,m;if(t.name==="element_style"){var r;return{val:(r=a.element.get_style_if_exists())==null?void 0:r.display()}}if(a!=null&&a instanceof d.GenericElement){var i,o,l,c;if((i=(o=a.element).get_style_if_exists)!=null&&i.call(o)&&((l=(c=a.element).get_styleable_properties)!=null&&l.call(c)[t.name]||t.in_style)){e=a.element.get_style_if_exists().property(t.name)}}let v=e;while(v.next!=null&&(u=v.next())!=null&&u.exists()){var u;v=v.next()}let[b,w]=n(v);if(t.name==="condition"){var _,f;if(b&&((_=(f=e.next()).name)==null?void 0:_.call(f))==="is_hovered"&&e.next().next().is_empty()){b=false}return{val:e.get_tree_display(),prop_val:b}}if(a&&b==null&&v.is_empty()){if(e.is_empty()){b=null}else{b=a.get_static_property(t.name,true)}}if(s){b=s}if(t.set!=null&&b!=null&&t.name!=="element_id"){const e=t.set;if(e instanceof y){const t=e.find((e=>e.value===b));if(t!=null){b=t.display}}else{if(e.contains(b)){b=e.get_display(b)}}}if(t.editor==="Checkbox"){m=p.get("sys.bool");if(!b){b=false}}else{m=p.get(w)}if(a){h=g(t.condition,a,true)}if(m.id()==="null"){return{val:b,condition_eval:h}}else if(m.has_debugging_display()){if(e.from_style){return{condition_eval:h,val:m.debugging_display(b)+"\n(from style)"}}return{condition_eval:h,val:m.debugging_display(b)}}else{return{condition_eval:h,val:e.get_tree_display()}}}}),((a,u)=>{var d;let p;if(a!=null){if(a instanceof i.BubbleError){p=`(An error occurred trying to evaluate this property: ${a.display()})`}else{p="(An error occurred trying to evaluate this property)"}}else if(u!=null){if(t.condition!=null&&u.condition_eval===false){c.remove();return}if(u.prop_val!=null){s=u.prop_val}p=u.val}let _=false;if(p==null&&e.type()==="InjectedValue"){_=true;p=e.get_tree_display()}if(["ObjectList","FlyoutObjectList","StaticList"].includes(t.editor)){var f,h,m;const r=(f=(h=(m=e).entries)==null?void 0:h.call(m))!=null?f:[];if(r.length){c.addClass("objectlist");i.div("prop-name",c,i.toTitleCase(t.name));for(const s of r){const r=i.div("objectlist",c);for(const o of t.sub_properties(s,e)){if(o.include_in_redesign){continue}const e=i.div("subprop",r);const t=s.property(o.name);this.build_property_div(t,o,n,e)}}}else{c.remove()}return}if(t.editor==="GeographicSearch"){const t=i.div("geographic-search-div",c);this.build_property_div(e.property("range"),{editor:"Basic"},n,t);this.build_property_div(e.property("unit"),{editor:"Dropdown"},n,t);i.div(undefined,t,"of");this.build_property_div(e.property("origin_address"),{editor:"Basic"},n,t);return}if([undefined,null].includes(p)){p=t.default}const g=(d=t.long_caption)!=null?d:t.caption;let v;if(g){v=i.div("prop-name",c,g)}if(typeof p==="number"){p=p.toString()}const b=i.div("prop-val",c,p);if((!p||typeof p==="string"&&!p.trim())&&t.name!=="action"){b.text("(empty)");b.addClass("empty")}if(p!=null&&a==null){if(t.name==="font_family"&&t.default.includes("var(")){const{token_name:e,font_family:n}=l.font_token_to_font(t.default);b.text(e+" ("+n+")")}if(t.editor==="Color"){const e=i.div("color-preview",c);e.css("background-color",p)}if(t.editor==="IconPicker"){i.div("icon-preview "+p,c)}if(["Image","DynamicImage"].includes(t.editor)){b.addClass("img");b.after(i.img("image-preview",undefined,p))}}if(t.name==="element_id"&&o!=null&&a==null){const e=o.element.find_instance_by_id(p);if(e){const t=e.get_canvas();if(t!=null&&t.is(":visible")){b.text(e.element.get_name()+" (hover to reveal)");b.addClass("hoverable");b.on("mouseenter",(e=>{this.position_highlight_box(t);b.one("mouseleave",(()=>this.hide_highlight_box()))}))}else{b.text(e.element.get_name())}}else{c.remove()}}if(t.name==="condition"){if(e.is_empty()){v.hide();b.hide()}else{if(s){v.addClass("condition-true")}else{v.addClass("condition-false")}}}if(!e.is_static()){if(_){b.addClass("injected-expression")}else{b.addClass("dynamic-expression");b.on("click",(()=>{$(".dynamic-expression.selected").removeClass("selected");b.addClass("selected");this.build_expression_evaluator(e,n,r.parents(".main-pane").find(".expression-evaluator"))}))}}}))}position_highlight_box(e){if(e!=null&&e.is(":visible")&&!e.hasClass("main-page")){var t,n;this.highlight_box.css({width:(t=parseInt(e.css("width")))!=null?t:e.width(),height:(n=parseInt(e.css("height")))!=null?n:e.height(),left:e.offset().left,top:e.offset().top,display:"block",padding:e.css("padding"),border:e.css("border"),"border-radius":e.css("border-radius")})}}hide_highlight_box(){this.highlight_box.css({display:"none"})}}r.install=function(){const e=new O;u().workflow.set_debugger(e)}},{"../constants/byte":52,"../constants/db":58,"../db/values/ClientDBObject":463,"../editor/composer/compatibility/composers":532,"../editor/composer/utilities/dropdown_contents":556,"../lang/evaluation/element_eval":690,"../u/shared/callbacks":843,"../webfonts":858,"./../client_config":41,"./../editor/utils/evaluate_condition":594,"./../lang/application":650,"./../lang/appquery":651,"./../lang/btypes":653,"./../lang/lang":714,"./../lib":741,"./../logger":744,"./../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],24:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");const i=e("./../u");const s=e("../lib");const o=e("../lang/appquery");const a=e("events");const l=e("./epoch");const c=e("../constants/epoch");const{render:u}=e("solid-js/web");const d=e("../lang/elements/rendering_perf");const{CSS_FLAG:p,ROOT_CLASS:_}=e("../constants/server_rendering");const{RenderElement:f}=e("../renderer/RenderElement");const{checkNonDeferrable:h}=e("../renderer/drawstate");const m=n;m.initialize=function(){b.set_responsive_container(v)};m.ElementService=class e extends a.EventEmitter{constructor(){super();this.ready_key=i.MakeKey(null,"ElementService ready")}display(e){const t=e.get_responsive_version();l.addEpochLabels({responsive_version:t});let n;if(t>0){n=new v(null,$("body"))}else if(e.use_responsive_algorithm()){n=new b.Container(null,$("body"))}else{n=new b.OldContainer(null,$("body"))}if(o.has_feature_enabled("defer_element_instances")){h(e)}e=g.ElementInstance(e,g.RUN);e.split_namespace();e.register(null);this._page=e;const i=c.SPANS.page_draw;const a=e=>l.traceSpan(i.name,i.type,(()=>{if((o.has_feature_enabled("react_upgrade")||o.get_public_setting("bubble_version")>=21||s().location.get_query().new_elements_rendering)&&typeof u==="function"){this.new_rendering=true;if(!getComputedStyle(document.body).getPropertyValue(p)){delete window._bubble_watcher_cache}else if(window._bubble_watcher_cache!=null){document.documentElement.classList.add(_)}if(t>0){n=new v(null);e.set_containers(n);const t=u((()=>(0,r.createComponent)(f,{instance:e})),document.body);e.on_destroy(t)}else{e.create_skeleton(n)}}else{e.create_skeleton(n)}e.start_draw_tree();e.ensure_drawn()}));const m={deferred_drawing_enabled:true};const y=d.measure_initial_draw(m,(()=>{a(e)}));l.addEpochLabels(y);setTimeout((()=>{this.ready_key.turn()}))}_loading_key(e){return e?"_page_done_loading_entire":"_page_done_loading"}on_page_done_loading(e,t){const n=i.Watcher((()=>this.page_done_loading(e)));n.on_value((e=>{if(e){t();n.destroy()}}))}page_done_loading(e){const t=this._loading_key(e);if(!this[t]){this[t]=i.Box(false);this._check_if_page_is_done(e,true)}return this[t]()}_check_if_page_is_done(e,t){const n=t=>{const r=t.get_canvas();if(!r||r.is(":hidden")||r.css("visibility")==="hidden"){return null}if(!e){if($(window).height()<r.offset().top){return null}}for(const e of Object.values((i=t._watchers)!=null?i:{})){var i;const[t,n,r]=e.get_current_status_array();if(!t&&!n){return r}}const s=t.element.can_have_children();if(t.is_ready&&!s){return null}const o=t.get_children_drawn_key();if(!o.is_turned()){return o}for(const e of t.current_children){const t=n(e);if(t){return t}}return null};const r=()=>{const t=n(this._page);if(t==null){this[this._loading_key(e)](true)}else{i.WaitFor(t,this._check_if_page_is_done.bind(this,e))}};if(t&&this.ready_key.is_turned()){r()}else{i.WaitFor(this.ready_key,(()=>{setTimeout(r,100)}))}}get_page(){return this._page}};const g=e("./../lang/elements");const v=e("../shared/responsive/ResponsiveContainer");const b=e("./responsive_v0/containers")},{"../constants/epoch":63,"../constants/server_rendering":86,"../lang/appquery":651,"../lang/elements/rendering_perf":683,"../lib":741,"../renderer/RenderElement":769,"../renderer/drawstate":772,"../shared/responsive/ResponsiveContainer":801,"./../lang/elements":680,"./../u":823,"./epoch":25,"./responsive_v0/containers":33,"core-js/modules/web.dom-collections.iterator.js":1123,events:978,"solid-js/web":2315}],25:[function(e,t,n){"use strict";e("core-js/modules/es.error.cause.js");e("core-js/modules/web.dom-collections.iterator.js");function r(e,t){i(e,t);t.add(e)}function i(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function s(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}const o=n;const a=e("../u/shared/uuid");const l=e("../monitoring/apm");const c=e("../constants/epoch");const u=e("../lib");const d=e("../u/shared/mode_check");const p=e("../u/client/client_storage");var _=new WeakSet;class f{constructor(e){r(this,_);this.name=e;this.id=a.UUID();this.labels=s(this,_,h).call(this);this.transaction=l.startTransaction(e,this.labels)}}function h(){const e=u().location.base_url;const t=u().location.get_page();const n=m();const r=u().appname();const i=this.id;const s=this.name;return{epoch_name:s,epoch_id:i,user_appname:n,appname:r,url:e,page:t}}o.start=e=>{o.end();const t=new f(e);p.set_active_epoch(t)};o.end=()=>{const e=p.get_active_epoch();if(e){var t,n,r,i;const s=(t=window)==null?void 0:(n=t.performance)==null?void 0:(r=n.timing)==null?void 0:r.fetchStart;const o=((i=Object.values(c.EPOCHS).find((t=>t.name===e.name)))==null?void 0:i.start_at_page_load)||false;if(o&&s){g(e,s)}l.endTransaction(e.transaction)}p.set_active_epoch(undefined)};o.addEpochLabels=e=>{const t=p.get_active_epoch();if(t){Object.assign(t.labels,e);l.addTransactionLabels(e)}};o.startSpan=function(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const r=p.get_active_epoch();if(r){return l.startSpan(e,{...r.labels,type:t},n)}};o.traceSpan=(e,t,n)=>{const r=p.get_active_epoch();if(r){return l.traceSpan(e,{...r.labels,type:t},n)}else{return n()}};o.endSpan=e=>{l.endSpan(e)};const m=()=>{const e=u().appname();if(d.is_edit_mode()){var t,n;return(t=(n=u().location.get_query())==null?void 0:n.id)!=null?t:e}else{return e}};const g=(e,t)=>{const n=e.transaction;n.setStart(t);n.spans.filter((e=>{var t;return(t=Object.values(c.SPANS).find((t=>t.name===e.name)))==null?void 0:t.start_at_page_load})).forEach((e=>e.setStart(t)))}},{"../constants/epoch":63,"../lib":741,"../monitoring/apm":746,"../u/client/client_storage":816,"../u/shared/mode_check":851,"../u/shared/uuid":855,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123}],26:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../lib");const i=e("../locations");const s=n;s.internal_navigation_handler=o;s.can_internally_navigate_to=a;s.add_internal_navigation_handlers=l;function o(e){const t=e.currentTarget;if(t.target!=="_self"||t.protocol!=="http:"&&t.protocol!=="https:"||e.button||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||!a(t.href)){}}function a(e){const t=r().location.get_pieces();const n=new i.Location(e);const s=n.get_pieces();if(t.appname===s.appname&&t.app_version===s.app_version&&t.domain===s.domain){return true}return false}function l(e){const t=e.getElementsByTagName("a");for(const e of t){e.addEventListener("click",o)}}function c(){r().element.get_page().destroy();document.body.innerHTML=""}},{"../lib":741,"../locations":743,"core-js/modules/web.dom-collections.iterator.js":1123}],27:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r;const i=e("../u/shared/async/async_state");const s=e("./../locations");const o=e("./../lib");const a=e("./../logger");const l=e("../u/shared/mode_check");const c=e("../u/shared/async/b_async");const u=e("../u/shared/b_object");const d=e("../u/shared/errors");const p=e("../u/shared/uuid");const _=e("./../client/analytics");const f=e("../u/client/client_storage");const h={};let m=(r=window)==null?void 0:r.bubble_page_load_id;const g={"server://workflow/start":true,"server://user/hi":true};function v(e){return g[e]}function b(e){if(e!=null){window.bubble_session_uid=e.bubble_session_uid}}function y(e){if(l.on_phonegap()){const t=e.getResponseHeader("Set-Cookie");if(t){const e=[];const n=t.split(",");let r=n[0];let i=0;while(r){r=n[i];if(r.indexOf("expires=")!==-1){r=r+","+n[i+1];i++}e.push(r);i++;r=n[i]}for(const t of e){const e=t.split("=");const n=e[0].trim();const r=e[1].split(";")[0];f.createCookie(n,r)}}}}t.exports=class e extends s.Location{constructor(e,t){super(e,t);this.open_requests=c.MakeKeyList()}load(){const e=o();e.workflow.announce_event("PageLoaded");return o().user.ready()}change_page(e,t,n){document.location.href=this.get_page_url(e,t,n)}reload_page(){return document.location.reload()}set_url_without_refresh(e){let{url:t,push_state:n}=e;if(n){window.history.pushState({},document.title,t)}else{window.history.replaceState({},document.title,t)}this.base_url=t}get(e,t){return this.request(e,"get",null,t)}post(e,t,n){return this.request(e,"post",t,n)}put(e,t,n){return this.request(e,"put",t,n)}delete(e,t){return this.request(e,"delete",null,t)}request(e,t,n,r,s,h,g){var j,A,M,E,k;(j=s)!=null?j:s=500;(A=g)!=null?A:g=Date.now();if(Date.now()-g>x.REQUEST_TTL*2/3){throw new d.OwnerError("Could not reach server")}const O=c.Promise(null,t+" "+e);(M=h)!=null?M:h=p.UUID();if(r){O.callback(r)}const S=e;e=e.toLowerCase();let D=false;let C=false;if(e.indexOf("server://")!==-1){e=this.get_server_base()+e.split("server://")[1];D=true}else if(e.indexOf("meta://")!==-1){const t={};if(!document.location.href.startsWith(o().location.get_base_for_meta())){t.protocol="HTTPS:"}e=this.get_base_for_meta(t)+"/"+e.split("meta://")[1];D=true;C=true}else if(e.indexOf("bubble:")===0){D=true;e=e.slice(7)}else{D=false;a.warn("Using Lib().location.request to hit a non-Bubble server. Use Lib().http_request instead! If this actually"+' is bubble, prefix url with "server://"',{uri:e})}const T={processData:false,type:t,dataType:"json"};(E=T.xhrFields)!=null?E:T.xhrFields={};(k=T.headers)!=null?k:T.headers={};if(C||l.on_phonegap()){T.xhrFields.withCredentials=true}if(l.on_phonegap()){var N;(N=n)!=null?N:n={};n.headers_for_phonegap=o().location.base_url}if(t!=="get"&&t!=="delete"){try{var P;T.data=JSON.stringify((P=n)!=null?P:{})}catch(e){var I;const t={};const r=(I=n)!=null?I:{};for(const e in r){const n=r[e];try{t[e]=JSON.stringify(n)}catch(e){}}T.data=JSON.stringify(t)}T.contentType="application/json";T.headers["cache-control"]="no-cache"}if(D){var R,L,z;const e=(R=window)==null?void 0:(L=R.read_url)==null?void 0:L.call(R).app_id;if(l.is_edit_mode()&&e){T.headers["X-Bubble-Appname"]=e}else if(l.is_plugin_edit_mode()){T.headers["X-Bubble-Appname"]="meta"}T.headers["X-Bubble-Breaking-Revision"]=x.breaking_revision;T.headers["X-Bubble-R"]=encodeURI(this.base_url);(z=m)!=null?z:m=p.LUID();T.headers["X-Bubble-PL"]=m;const t=f.get_active_epoch();if(t){T.headers["X-Bubble-Epoch-ID"]=t.id;T.headers["X-Bubble-Epoch-Name"]=t.name}T.headers["X-Bubble-Fiber-ID"]=h;const n=_.package_utm_data();if(n){T.headers["X-Bubble-UTM-Data"]=n}}const B=$.ajax(e,T);B.done(((t,n,r)=>{if(D){i.server_connection_problems=false}if(window.start_debugger!=null&&o().workflow.debugger!=null){const t=parseInt(r.getResponseHeader("X-Bubble-Capacity-Limit"));if(!isNaN(t)){o().workflow.debugger.report_capacity(t)}o().workflow.debugger.get_request_size(e)}y(B);if(v(S)){b(t)}f.rebuild_cookies();return w.recheck_uid((()=>O.resolve(t)),S)}));B.fail(((r,l,c)=>{var p,_;const m=r.getResponseHeader("x-bubble-change-page");if(m){const e=document.location.href;const t={referrer:encodeURIComponent(e)};const n=u.extend({},o().location.get_query(),t);this.change_page(m,n);return}y(B);f.rebuild_cookies();w.recheck_uid();if(D){if(r.status>=400&&r.status<=599){i.server_connection_problems=false}else{i.server_connection_problems=true}}if([503,0,12017].includes(r.status)||D&&[502,504].includes(r.status)){if(r.status===0&&c!=null){a.warn(new d.UnexpectedError("Bad request not sent",{status:c}))}setTimeout((()=>O.resolve(this.request(S,t,n,null,Math.min(s*2),h,g))),s);return}if(((p=r.responseText)==null?void 0:(_=p.indexOf)==null?void 0:_.call(p,"Chrome Data Compression Proxy"))!==-1||[12019,524].includes(r.status)){if(s<2e3){setTimeout((()=>O.resolve(this.request(S,t,n,null,s*2,h,g))),s);return}}if(!D){let e;try{e=u.json_parse(r.responseText)}catch(t){e=r.responseText}O.reject(new d.UnexpectedError(e));return}O.reject(this.response_to_error(r,{uri:e,request_data:T,method:t,fiber_id:h}))}));this.open_requests.add_key(O.ready_key());return O}response_to_error(e,t){const{uri:n,request_data:r,method:i,fiber_id:s}=t!=null?t:{};let o=null;if(e.responseText&&e.getResponseHeader("Content-Type")==="application/json"){try{o=JSON.parse(e.responseText)}catch(e){}}const a=e.getAllResponseHeaders();if(o==null||!o.error_class){return new d.UnexpectedError("unexpected server response",{statusCode:e.status,response_body:e.responseText,uri:n,request_data:r,method:i,headers_string:a,code:s})}const l=d.from_json_client(o);if(l instanceof d.UnexpectedError){l.extend({uri:n,request_data:r,method:i})}return l}request_synchronous(e,t,n){var r;function i(e){let{response:t,error:n,cache_status:r,current_version:i}=e;if(r.version===i){r.response=t;r.error=n;r.keys.map((e=>e.turn()));r.version+=1;r.state="complete"}}const s=u.json_stringify({uri:e,method:t,data:n});(r=h[s])!=null?r:h[s]={state:"invalidated",version:0};const o=h[s];if(o.state==="invalidated"){var a;const r=o.version;o.state="pending";(a=o.keys)!=null?a:o.keys=[];o.keys.push(c.MakeKey(null,"request_synchronous "+e));const s=this.request(e,t,n);s.then((e=>{i({response:e,cache_status:o,current_version:r})}),(e=>{i({error:e,cache_status:o,current_version:r})}))}c.ensure_ready(o.keys[o.keys.length-1]);if(o.error){throw o.error}else{return o.response}}wipe_request_cache(e,t,n){const r=u.json_stringify({uri:e,method:t,data:n});if(h[r]!=null){h[r].state="invalidated";h[r].version+=1;delete h[r].response;delete h[r].error}}};const w=e("./../db/client_db");const x=e("./../client_config")},{"../u/client/client_storage":816,"../u/shared/async/async_state":829,"../u/shared/async/b_async":832,"../u/shared/b_object":839,"../u/shared/errors":846,"../u/shared/mode_check":851,"../u/shared/uuid":855,"./../client/analytics":20,"./../client_config":41,"./../db/client_db":424,"./../lib":741,"./../locations":743,"./../logger":744,"core-js/modules/web.dom-collections.iterator.js":1123}],28:[function(e,t,n){"use strict";const r=n;const i=e("../lib");const s=e("../u/shared/async/async_state");const o=e("../u/shared/b_object");const a=e("./../client_config");const l=e("../u/shared/errors");const c=e("../u/shared/mode_check");const u=e("../u/shared/logging");const d=e("../u/client/test_state");const p=e("../u/shared/uuid");const _=e("../lang/appquery");const f=Date.now();const h={debug:"debug",verbose:"debug",info:"info",warn:"warn",error:"error",fatal:"error"};const m={user_error:"info",owner_warn:"warn",owner_error:"error"};const g={};let v=0;let b=0;let y=false;let w=false;function x(){if(w){return}w=true;console.warn("Note: we are hiding further messages to avoid excess logging")}r.fiber_wrapper=e=>e;r.log=function(e,t,n){var r,w,j,A,M,E;(r=g[t])!=null?r:g[t]=0;if(g[t]>=5){x();return}if(v>=20){x();return}g[t]++;v++;const k=m[(w=n.tags)==null?void 0:w.user_level];(A=(j=n).code)!=null?A:j.code=p.UUID();if(k||u.level_gte(e,a.browser_console_log_level)){var O,S,D;const r=k!=null?k:e;const i=(O=(S=console[h[r]])==null?void 0:S.bind(console))!=null?O:console.log.bind(console);let s;if(k){var C;if(n.element_instance!=null){s=`Element ${n.element_instance.element.get_name()} - `}else if(n.event){s=`Event ${n.event.display()} - `}else if(n.action){s=`Action ${n.action.display()} - `}else{s=""}if(n.prop_name){s+=n.prop_name+" "}s+=(C=n.display)!=null?C:t}else if(t!=null){s=t;if(typeof n.stack==="string"){s=[s].concat(n.stack.split("\n").slice(1)).join("\n")+"\n"}}else{s=n.stack}const a=o.extend({},n);delete a.stack;delete a.tags;delete a.display;if(/Bubble Tests/.test((D=navigator)==null?void 0:D.userAgent)){a.bubble_level=e}if(s[-1]!=="\n"){s+="\n"}i(s,a)}if(u.level_gte(e,"warn")){d.all_page_errors.push({message:t,stack:n.stack,data:n,level:e})}if(i().workflow.debugger&&u.level_gte(k,"warn")){var T,N;let r,s;if(k){var P;r=(P=n.display)!=null?P:t}else{if(y){return}y=true;r=`Sorry, we have encountered an unexpected error. Please <a href='https://bubble.io/support/report?app=${_.appname()}&fiber=${n.code}' class="click-for-bug-report" target="_blank">click here to file a bug report</a>, including error code ${n.code} and a step-by-step explanation of how to reproduce this issue.`}if(n.event){s="workflow"}else if(n.action){s="action"}else if(n.element_instance){s="element"}else if(u.level_gte(k!=null?k:e,"error")){s="general"}else{s="warning"}const o=(T=n.action)!=null?T:n.element_instance;const{event:a}=n;const{prop_name:l}=n;const c={message:r};(N=i().workflow.debugger)==null?void 0:N.report_error({type:s,instance:o,event:a,prop_name:l,error:c})}if(n.server_generated){return}if(!u.level_gte(e,"info")){return}n=l.clean_args({args:n});const I={level:e,message:t,data:n,server_connection_problems:s.server_connection_problems,session_count:b,js_user_agent:window.navigator.userAgent,page_load_time:f,client_commit_sha:a.commit_sha,client_commit_timestamp:a.commit_timestamp,client_page_url:(M=i().location)==null?void 0:(E=M.my_location)==null?void 0:E.call(M),mode:c.is_edit_mode()?"edit":c.is_plugin_edit_mode()?"plugin":"run"};if(u.level_gte(e,"error")){b++}function R(e){if(e){console.error(e)}}i().location.request("server://bug/client_log","POST",I,R,null,n.code)}},{"../lang/appquery":651,"../lib":741,"../u/client/test_state":821,"../u/shared/async/async_state":829,"../u/shared/b_object":839,"../u/shared/errors":846,"../u/shared/logging":850,"../u/shared/mode_check":851,"../u/shared/uuid":855,"./../client_config":41}],29:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../u");const i=e("./../logger");const s=e("../constants/workflow");const{ignoreError:o}=e("../u/shared/callbacks");const a=e("./../lib");const l=e("./../services");const c=e("./../lang/appquery");const u=e("url");const d=e("./../core/core_events");const p={invalid:"Invalid login link.",user:"User attempting to login does not exist.",expired:"This link is expired or has already been used. Please request another.",robot:"Incompatible browser."};function _(e){if(!e){return false}try{return r.json_parse(e).oauth_provider}catch(e){return false}}function f(e){if(!e){return false}try{return r.json_parse(e).magic_link_status}catch(e){return false}}n.onload=function(e){var t;const n=u.parse(document.location.href,true);const{query:h}=n;const m=r.json_deep_copy(h);if((t=h.state)!=null&&t.replace){const e=/&#34;/g;h.state=h.state.replace(e,'"')}h.state=decodeURIComponent(h.state);let g,v;if(h.oauth_provider){g=r.json_deep_copy(h);({run_id:v}=g);delete h.oauth_provider;delete h.run_id}else if(_(h.state)){var b,y;g=r.json_parse(h.state);(y=(b=g).code)!=null?y:b.code=h.code;delete h.state}else if(f(h.state)){var w;g=r.json_parse(h.state);delete h.state;delete n.search;a().location.set_url_without_refresh({url:u.format(n)});const t=(w=p[g.magic_link_status])!=null?w:"Invalid login link.";d.handle_uncaught_error({original_error:new r.OwnerError(t),caught_from:s.ERROR_SOURCES.ELEMENT_WORKFLOW,cb(e){if(e){window.alert(t)}}});e==null?void 0:e();return}else{e==null?void 0:e();return}const x=l.get_oauth_authenticator(g.oauth_provider);if(x==null){window.alert(a().get_text("CORE","OAUTH_ISSUE"));e==null?void 0:e();return}for(const e of(j=x.get_property("additional_query_url_to_delete"))!=null?j:[]){var j;delete h[e]}delete h.code;delete h.resume_key;delete n.search;delete n.hash;a().location.set_url_without_refresh({url:u.format(n)});const A=v||g.resume_key;if(!g.code&&!g.oauth_token){i.error("oauth login failed",{service_name:x.id(),original_query:m});const t=a().get_text("CORE","OAUTH_ISSUE")+x.id()+". "+a().get_text("CORE","TRY_AGAIN");const n=new r.OwnerError(t);d.handle_uncaught_error({original_error:n,caught_from:s.ERROR_SOURCES.ELEMENT_WORKFLOW,cb(e){if(e){window.alert(i.human_friendly(e))}}});e==null?void 0:e();return}const M=x.get_data_for_login(g);const E=a().workflow.resume(A,M);E.callback((t=>{if(t){d.handle_uncaught_error({original_error:t,caught_from:s.ERROR_SOURCES.ELEMENT_WORKFLOW,cb(e){if(e){window.alert(i.human_friendly(e))}}})}e==null?void 0:e();if(!t&&g.oauth_provider.indexOf("apiconnector")===0&&r.is_debug_mode()&&c.app_version()!=="live"){if(!x.has_token_data()){const e={api_id:g.oauth_provider,current_user_id:a().current_user()._id(),appname:c.appname(),plugin:g.oauth_provider.indexOf("apiconnector2")===0?"apiconnector2":"apiconnector"};a().location.post("server://api/1.1/u/save_owner_oauth_token",e).callback(o((e=>{if(e===true){window.alert(`You have successfully initialized the OAuth2 connection for ${x.display()}. You can go back to the Editor and keep building!`)}})))}}}))}},{"../constants/workflow":95,"../u/shared/callbacks":843,"./../core/core_events":377,"./../lang/appquery":651,"./../lib":741,"./../logger":744,"./../services":780,"./../u":823,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,url:981}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.can_use=l;n.fully_loaded=h;n.render_end=_;n.render_start=d;e("core-js/modules/web.dom-collections.iterator.js");var r=a(e("./epoch"));var i=a(e("../constants/epoch"));var s=a(e("../db/db"));function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function l(){var e;return((e=window.performance)==null?void 0:e.timing)!=null&&window._bubble_page_load_data!=null}let c;let u;function d(e){c=Date.now();if(e){r.start(e);const t=i.SPANS.render;u=r.startSpan(t.name,t.type,t.sync)}}let p;function _(){r.endSpan(u);p=Date.now()}let f;function h(){f=Date.now();r.end();const e=s.global_data_items_loaded;if(!l()){return}const t=window.performance.timing.fetchStart;const n=window.performance.timing.responseEnd;const i=n-t;const o=c-t;const a=p-t;const u=f-t;const{pre_run_js:d,run_js_start:_,post_run_js:h,static_js_start:m,dynamic_js_start:g,pre_static_js:v,pre_dynamic_js:b}=window._bubble_page_load_data;let y;let w;let x;let j;for(const e of(A=(M=(E=window.performance).getEntriesByType)==null?void 0:M.call(E,"resource"))!=null?A:[]){var A,M,E;const t=e;if(t.name.includes("/package/run_js/")){y=t;j=y.encodedBodySize}else if(t.name.includes("/package/run_js_page/")){w=t}if(t.name.includes("/package/run_js/")){var k;(k=x)!=null?k:x=0;x+=t.encodedBodySize}}const O=u;const S=e=>Math.round(e*1e3/O)/10;function D(e,t,n){if(typeof performance.now!=="function"||n==null){return}const r=t-window.performance.timing.fetchStart;const i=Math.max(0,n.responseStart-r);const s=Math.max(0,n.responseEnd-Math.max(r,n.responseStart));e.request=S(i);e.download=S(s)}const C=_-d;const T={total:S(C)};D(T,d,y);const N=m-v;const P=g-b;const I={total:S(N)};const R={total:S(P)};D(I,h,w);D(R,h,w);const L={page_data:e,page_html:i,page_render_start:o,page_render:a,page_full:u};if(x!=null){L.packager_size=x}if(j!=null){L.run_js_size=j}return L}},{"../constants/epoch":63,"../db/db":427,"./epoch":25,"core-js/modules/web.dom-collections.iterator.js":1123}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.page_load_performance_metrics=h;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var r=p(e("../lang/appquery"));var i=p(e("./../lib"));var s=p(e("../pluginservice"));var o=d(e("../logger"));var a=e("../constants/editor");var l=e("../lang/elements/rendering_perf");var c=d(e("../client_config"));function u(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=u(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function p(e){return e&&e.__esModule?e:{default:e}}function _(e,t){if(t!==undefined){if(t.page_data!=null)e.page_data=t.page_data;if(t.page_html!=null)e.page_html=t.page_html;if(t.page_render_start!=null)e.page_render_start=t.page_render_start;if(t.page_render!=null)e.page_render=t.page_render;if(t.page_full!=null)e.page_full=t.page_full;if(t.packager_size!=null&&typeof t.packager_size==="number")e.packager_size=t.packager_size;if(t.run_js_size!=null)e.run_js_size=t.run_js_size}return e}var f=function(e){e[e["dynamic_js"]=0]="dynamic_js";e[e["early_js"]=1]="early_js";e[e["edit_js"]=2]="edit_js";e[e["run_debug_js"]=3]="run_debug_js";e[e["run_js"]=4]="run_js";e[e["static_js"]=5]="static_js";e[e["run_css"]=6]="run_css";return e}(f||{});function h(e,t){if(!c.page_speed_metrics_on){return}const{dns_time:n,redirect_time:s,tcp_time:a}=m();const{third_party_plugin_count:u,third_party_plugin_js_execution_time_ms:d,third_party_plugin_code_string_length:p,hardcoded_plugin_count:f,hardcoded_plugins:h}=A();const g=Date.now();const v=window.location.href;const b=r.default.appname();const y=r.default.app_version();const M=window.bubble_bundle_name;const E=x();let k;if(!(E!=null&&E.brands)){k=window.navigator.userAgent}const{bubble_version:O,experimental_features:S,responsive_version:D,old_responsive_elements:C}=j(t);const T=_({timestamp:g,url:v,appname:b,app_version:y,bundle_type:M,asset_info:w(),dns_time:n,redirect_time:s,tcp_time:a,browser:E,user_agent:k,bubble_version:O,experimental_features:S,responsive_version:D,old_responsive_elements:C,third_party_plugin_count:u,third_party_plugin_js_execution_time_ms:d,third_party_plugin_code_string_length:p,hardcoded_plugin_count:f,hardcoded_plugins:h,json_info:window._bubble_page_load_data.json_info,element_counts:window._bubble_page_load_data.element_counts,element_instances_count:l.element_counts.element_instances.total},e);i.default.or_throw().location.post("server://user/m",T,(e=>{if(e){o.log(e)}}))}function m(){let e;let t;let n;for(const o of window.performance.getEntries()){const a=o;if(!Number.isNaN(a.domainLookupEnd-a.domainLookupStart)){var r;(r=e)!=null?r:e=0;e+=a.domainLookupEnd-a.domainLookupStart}if(!Number.isNaN(a.redirectEnd-a.redirectStart)){var i;(i=t)!=null?i:t=0;t+=a.redirectEnd-a.redirectStart}if(!Number.isNaN(a.connectEnd-a.connectStart)){var s;(s=n)!=null?s:n=0;n+=a.connectEnd-a.connectStart}}return{dns_time:e,redirect_time:t,tcp_time:n}}function g(e){let t=false;const n=e.name.substring(e.name.lastIndexOf(".")+1).toLowerCase();if(e.name.includes("package")){t=true}return{first_party:t,file_type:n}}function v(e,t,n){if(Object.values(f).includes(n)){t[`${n}_uncompressed_size_bytes`]=e.decodedBodySize;t[`${n}_compressed_size_bytes`]=e.encodedBodySize;if(e.duration>=0){t[`${n}_download_time_ms`]=e.duration}}else{var r;(r=t.other_assets_count)!=null?r:t.other_assets_count=0;t.other_assets_count+=1}return t}function b(e,t){const n=window._bubble_page_load_data.js_execution_timings;e[`${t}_start_execution_ms`]=n[`${t}_start_execution`];if(!Number.isNaN(n[`${t}_end_execution`]-n[`${t}_start_execution`])){e[`${t}_execution_time_ms`]=n[`${t}_end_execution`]-n[`${t}_start_execution`]}e[`pre_${t}_ms`]=n[`pre_${t}`];e[`post_${t}_ms`]=n[`post_${t}`];return e}function y(e,t){t.third_party_assets_count+=1;if(e.decodedBodySize){var n;(n=t.third_party_assets_uncompressed_size_bytes)!=null?n:t.third_party_assets_uncompressed_size_bytes=0;t.third_party_assets_uncompressed_size_bytes+=e.decodedBodySize}if(e.encodedBodySize){var r;(r=t.third_party_assets_compressed_size_bytes)!=null?r:t.third_party_assets_compressed_size_bytes=0;t.third_party_assets_compressed_size_bytes+=e.encodedBodySize}return t}function w(){const e=window.performance.getEntriesByType("resource");const t={};for(const r of e){var n;const e=r.name;const i=r;(n=t.third_party_assets_count)!=null?n:t.third_party_assets_count=0;const s=g(i);if(s.first_party){const n=e.substring(e.lastIndexOf("/")+1,e.length).replace(".","_");v(i,t,n);if(s.file_type==="js"){b(t,n)}}else{y(i,t)}}return t}function x(){const e=window.navigator;const t=e.userAgentData;if(t){return{brands:`[${t.brands.map((e=>`${e.brand} ${e.version}`)).join(", ")}]`,platform:t.platform,mobile:t.mobile,language:window.navigator.language}}return{language:window.navigator.language}}function j(e){let t;let n;const i={};for(const e in a.PUBLIC_ACTIVE_EXPERIMENTS){if(r.default.has_feature_enabled(e)){i[e]=true}}if(e){const i=r.default.get_page_by_name(e);t=i==null?void 0:i.get_responsive_version();const s=r.default.custom_definitions();for(const e of s){if(e.get_responsive_version()===0){n=true}}}return{bubble_version:window.bubble_version,experimental_features:i,responsive_version:t,old_responsive_elements:n}}function A(){let e;let t;if(window.plugins!=null){e=Object.keys(window.plugins).length;for(const e in window._bubble_page_load_data.plugins_size){var n;(n=t)!=null?n:t=0;t+=window._bubble_page_load_data.plugins_size[e]}}let r;let i;const o=s.default.get_plugin_execution_time();for(const e in o){var a;(a=i)!=null?a:i=0;i+=o[e]}const l=window._bubble_page_load_data.js_execution_timings;if(l.plugin_js_end_execution&&l.plugin_js_start_execution){r=l.plugin_js_end_execution-l.plugin_js_start_execution}if(i&&r){r+=i}else if(i){r=i}let c;let u;if(window._bubble_page_load_data.hardcoded_plugins!=null){c=window._bubble_page_load_data.hardcoded_plugins;u=Object.keys(c).length}return{third_party_plugin_count:e,third_party_plugin_js_execution_time_ms:r,third_party_plugin_code_string_length:t,hardcoded_plugin_count:u,hardcoded_plugins:c}}},{"../client_config":41,"../constants/editor":60,"../lang/appquery":651,"../lang/elements/rendering_perf":683,"../logger":744,"../pluginservice":756,"./../lib":741,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],32:[function(e,t,n){"use strict";const r=e("./../lib");const i=e("./../u");const s=e("../page_thing_utils");t.exports=class e{constructor(){this._dependency=i.Dependency()}invalidate(){if(!i.on_phonegap()){r().location.base_url=document.location.href}r().workflow.announce_event("PageLoaded");this._dependency.invalidate()}get(){if(s.get_page_thing_id(r().location)!=null){this.exists=true}else{this.exists=false}this._dependency.register();if(!this.exists){var e,t,n;if(((e=r().element)==null?void 0:(t=e.get_page())==null?void 0:(n=t.element)==null?void 0:n.get_static_property("page_item_type"))!=null){console.log("warning: no id specified.  this page expects an id")}return null}else{return s.get_page_thing(r().location)}}}},{"../page_thing_utils":754,"./../lib":741,"./../u":823}],33:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../../u");const i=e("./../../lang/appquery");const s=e("events");const o=n;let a=null;class l{constructor(e,t){var n;this.owner_instance=e;this.container_canvas=t;this.container_canvas.css("box-sizing","border-box");if(this.owner_instance){const{element:e}=this.owner_instance;this.info=r.json_deep_copy(e.get_responsive_data())}(n=this.info)!=null?n:this.info={};this.is_initialized=r.MakeKey(null,"container initialized")}destroy(){var e;(e=this.owner_instance)==null?void 0:e.destroy();this.owner_instance=null}resize_width(){}add_to_instances(){}ready_key(){return this.is_initialized}get_canvas(){return this.container_canvas}get_owner(){return this.owner_instance}render(e){const t=$(e);t.addClass("bubble-element");return t}recalculate(e){var t;const n=this.info[e];(t=n.pushed_by)!=null?t:n.pushed_by=[];const r=Object.values(n.pushed_by).map((e=>this.info[e].height_delta+this.info[e].top_delta));const i=Math.max(...r);if(i!==n.top_delta){n.top_delta=i;n.instance.canvas.css("top",n.top_delta+n.it);this.calculate_children(e);this.recalculate_stripe(e)}}calculate_children(e){var t;const n=this.info[e];(t=n.pushes)!=null?t:n.pushes=[];if(r.is_empty(n.pushes)){this.recalculate_container(e)}else{for(const e in n.pushes){const t=n.pushes[e];this.recalculate(t)}}}recalculate_container(e){let t;for(const e in this.info.container_bottoms){const n=this.info.container_bottoms[e];const r=this.info[n];if(t==null){t=r.height_delta+r.top_delta}else{t=Math.max(t,r.height_delta+r.top_delta)}}if(this.owner_instance.supports_message("child_movement")){this.owner_instance.message("child_movement",t)}}recalculate_stripe(e){if(!this.owner_instance.supports_message("movement_in_stripe")||this.info[e].pushes_stripe==null){return}const t=this.info[e].pushes_stripe;let n;for(const e in this.info){const r=this.info[e];if(r.pushes_stripe===t){if(n==null){n=r.height_delta+r.top_delta}else{n=Math.max(n,r.height_delta+r.top_delta)}}}this.owner_instance.message("movement_in_stripe",t,n)}set_height(e,t,n){var i;(i=n)!=null?i:n={};r.WaitFor(this.is_initialized,(()=>{const r=e.element_id();if(this.info[r].current_height===t){return}this.info[r].current_height=t;if(!n.no_css_update){e.canvas.css("height",t)}const i=t-this.info[r].ih;if(i===this.info[r].height_delta){return}this.info[r].height_delta=i;this.calculate_children(r);this.recalculate_stripe(r)}))}add(e,t){const{element:n}=e;const i=n.id();const s=this.info[i];if(s==null){if(t){e.wait_for_visible_lite((()=>{const{style:t}=e.canvas[0];t.boxSizing="border-box";t.position="absolute";t.zIndex=e.element.get_zindex();t.left=e.element.get_left()+"px";t.top=e.element.get_top()+"px";t.width=e.element.get_width()+"px";t.height=e.element.get_height()+"px"}))}return}r.extend(s,{current_height:s.ih,top_delta:0,height_delta:0,instance:e});e.wait_for_visible_lite((()=>{const{style:t}=e.canvas[0];t.boxSizing="border-box";t.position="absolute";t.zIndex=s.iz;t.left=s.il+"px";t.top=s.it+s.top_delta+"px";t.width=s.iw+"px";t.height=s.current_height+"px";return e.notify_width(s.iw)}));this.container_canvas.append(e.canvas)}create_child(e,t){const{custom_definition:n}=e.element.E;if(n){let i;if(n().get_responsive_version()>0){return new a(e,t)}if(!n().use_responsive_algorithm()){i=new l(e,t)}else{i=new c(e,t,e.element.get_responsive_data())}i.resize_width(r.real_inner_width(t));return i}else{return new l(e,t)}}initialize(){u.tab_container(this.owner_instance);this.is_initialized.turn()}detach(e){e.canvas.detach()}}class c extends s.EventEmitter{constructor(e,t,n,i){var s,o,a,l,c;super();this.owner_instance=e;this.container_canvas=t;this.owner=i;this.container_canvas[0].style["box-sizing"]="border-box";if(this.owner_instance){({elements:this.elements,boxes:this.boxes,lines:this.lines,lines_length:this.lines_length}=r.json_deep_copy(n!=null?n:{}))}(s=this.elements)!=null?s:this.elements={};(o=this.boxes)!=null?o:this.boxes={};(a=this.lines)!=null?a:this.lines={};(l=this.lines_length)!=null?l:this.lines_length=0;this.instances={};this.instances_keys={};(c=this.lines)!=null?c:this.lines={};this.child_containers=[];this.flow_created=r.MakeKey(null,"flow created")}destroy(){var e,t;this.destroyed=true;(e=this.owner_instance)==null?void 0:e.destroy();this.owner_instance=null;const n=(t=this.instances)!=null?t:{};for(const e in n){const t=n[e];t.destroy()}this.instances=null;for(const e of this.child_containers){e.destroy()}this.elements=this.boxes=this.lines=this.lines_length=this.instance_keys=this.flow_created=null}ready_key(){return this.flow_created}get_canvas(){return this.container_canvas}get_owner(){return this.owner_instance}render(e){const t=$(e);t.addClass("bubble-element");return t}_show_line(e){var t,n,i,s;(t=this._lines)!=null?t:this._lines={};(i=(n=this._lines)[e])!=null?i:n[e]=r.div("bubble-r-line",this.container_canvas);this._lines[e].show();this._num_lines=Math.max((s=this._num_lines)!=null?s:0,parseInt(e)+1);return this._lines[e]}_hide_lines(e){this.last_display_line=e-1;for(let t=e;t<this._num_lines;t++){this._lines[t].hide()}}_get_box(e){var t;(t=this._boxes)!=null?t:this._boxes={};if(!this._boxes[e]){this._boxes[e]=r.div("bubble-r-box");this.recalculate_box_height(e);this._boxes[e][0].box_debugging_metadata=this.boxes[e]}return this._boxes[e]}recalculate_box_height(e){const t=this.boxes[e];let n=null;for(const e in t.bottoms){var r;const i=t.bottoms[e];const s=this.elements[i];const o=this._get_height_delta(i)+((r=s.top_delta)!=null?r:0);if(n==null){n=o}else{n=Math.max(n,o)}}const i=n+(t.ih-t.line_gap);if(i!==t.height){var s;t.height=i;this._get_box(e)[0].style.height=Math.max(i,0)+"px";const n=(s=this.box_to_display_line)==null?void 0:s[e];if(n){this.update_display_line_height(n)}}}update_display_line_height(e){var t;const n=(t=this._lines[e.idx])==null?void 0:t[0];if(n){n.style.height=Math.max(this.get_display_line_height(e),0)+"px"}}_update_instance(e,t){if(this.instances[e]){this.instances[e].wait_for_visible_lite(t)}else{var n,i;(i=(n=this.instances_keys)[e])!=null?i:n[e]=r.MakeKey(null,"waiting for instance for "+e);r.WaitFor(this.instances_keys[e],this._update_instance.bind(this,e,t))}}_wait_for_instance_added(e,t){if(this.instances[e]){t()}else{var n,i;(i=(n=this.instances_keys)[e])!=null?i:n[e]=r.MakeKey(null,"waiting for instance for "+e);r.WaitFor(this.instances_keys[e],this._wait_for_instance_added.bind(this,e,t))}}_set_element_width(e,t,n){const r=this.elements[e];r.width=t;r.left=n;this._update_instance(e,(()=>{this.to_canvas(this.instances[e])[0].style.width=r.width+"px";this.to_canvas(this.instances[e])[0].style.left=r.left+"px";this.instances[e].notify_width(r.width)}))}get_display_line_top(e){let t=0;for(let n=0;n<e.idx;n++){const e=this.display_lines[n];t+=e.top_margin;t+=this.get_display_line_height(e)}return t+e.top_margin}get_display_line_height(e){return Math.max(...e.boxes.map((e=>e.height)))}get_hidden_elements(){var e;const t=[].concat((e=this._visibility_rules)!=null?e:[]);return t.concat(...this.child_containers.map((e=>e.get_hidden_elements())))}get_all_instances(){const e=Object.values(this.instances);for(const t of this.child_containers){e.push(...t.get_all_instances())}return e}get_element_box(e,t){const n=this.search_for_element(e);if(!n){return null}if(t){return n.instances[e]}else{const t=n.elements[e].box;return n.boxes[t]}}search_for_element(e){if(this.destroyed){return null}if(!this.elements[e]){for(const t of this.child_containers){const n=t.search_for_element(e);if(n!=null){return n}}return null}return this}get_margin_info(e){var t;const n=this.search_for_element(e);if(!n||n.elements[e].box==null){return null}if(((t=n.owner_instance)==null?void 0:t.element.type())==="RepeatingGroup"){var r;return(r=n.child_containers)==null?void 0:r[0].get_margin_info(e)}else{return n.margin_debugging[n.elements[e].box]}}resize_width(e){var t;if(this.container_width===e||this.destroyed){return}this.container_width=e;this._visibility_rules=[];this.margin_debugging={};const n=(e,t)=>{if(t===0){const t=this.lines[e.line_idx];const n=this.boxes[t.boxes[0]];this.margin_debugging[e.box_id].left.from_element=n.leftmost;this.margin_debugging[e.box_id].left.from_dir="left";this.margin_debugging[e.box_id].left.original=n.left_margin;return n.left_margin}else{this.margin_debugging[e.box_id].left.from_element=e.leftmost;this.margin_debugging[e.box_id].left.from_dir="left";this.margin_debugging[e.box_id].left.original=e.left_margin;return e.left_margin}};const r=e=>{const t=this.lines[e.line_idx];const n=this.boxes[t.boxes[t.boxes_length-1]];this.margin_debugging[e.box_id].right.from_element=n.rightmost;this.margin_debugging[e.box_id].right.from_dir="right";this.margin_debugging[e.box_id].right.original=n.right_margin;return n.right_margin};const i=t=>{if(p().bubble_version()>=2&&this.owner_instance.get_static_property("fixed_width")){return true}if(t.rs==="<="&&e<=t.rsw){return false}else if(t.rs===">"&&e>t.rsw){return false}else{return true}};this.box_to_display_line={};this.display_lines=[];let s;let o=null;for(let t=0;t<this.lines_length;t++){const c=this.lines[t];if(!this.elements[this.boxes[c.boxes[0]].first].wtp){o=null}for(let t=0;t<c.boxes_length;t++){var a,l;const u=c.boxes[t];const d=this.boxes[u];let p=0;let _=-Infinity;let f=false;for(const e in d.contains){const t=d.contains[e];if(i(this.elements[t])){f=true;p=Math.max(p,this.elements[t].mw);let{maxw:e}=this.elements[t];if(e!=null){e=e/this.elements[t].iw*d.iw;_=Math.max(_,e)}else{_=Infinity}}}if(!f){this._get_box(d.box_id).hide();this._visibility_rules.push(...Object.values(d.contains));continue}if(isFinite(_)){d.max_width=_}d.min_width=Math.min(e,p);let h=(a=(l=o)==null?void 0:l.boxes.length)!=null?a:0;let m=d.min_width;this.margin_debugging[u]={right:{},left:{}};if(d.align!=="right"||h!==0&&o.boxes[h-1].align!=="left"){m+=n(d,h);this.margin_debugging[u].left.break_first=true}else{this.margin_debugging[u].left.break_first=false}if(d.align!=="left"){m+=r(d);this.margin_debugging[u].right.break_first=true}else{this.margin_debugging[u].right.break_first=false}if(o==null){o={boxes:[d],top_margin:c.top_margin,idx:this.display_lines.length,topmost:c.topmost};this.display_lines.push(o);s=0}else if(s+m<=e){o.boxes.push(d)}else{o={boxes:[d],top_margin:c.top_margin,idx:this.display_lines.length,topmost:c.topmost};this.display_lines.push(o);s=0;h=0}s+=d.min_width+n(d,h);this.box_to_display_line[u]=o}}const c=(t=this.display_lines)!=null?t:[];let u,d;for(u=0;u<c.length;u++){var _;const t=c[u];let s=0;let o=0;let a=0;let l=0;let p=0;(_=t.boxes)!=null?_:t.boxes=[];const h=(e,n)=>{if(e.align==="left"){this.margin_debugging[e.box_id].left.fixed=e.contains[0];this.margin_debugging[e.box_id].left.fixed_dir="left";return false}const r=t.boxes[n-1];if((r==null?void 0:r.align)==="right"){this.margin_debugging[e.box_id].left.fixed=r.contains[0];this.margin_debugging[e.box_id].left.fixed_dir="right";return false}this.margin_debugging[e.box_id].left.fixed=null;return true};for(let e=0;e<t.boxes.length;e++){const i=t.boxes[e];o+=i.iw-i.min_width;if(i.max_width){a+=i.max_width-i.min_width}else{if(i.iw!==i.min_width){a=Infinity}}const c=n(i,e);s+=i.iw+c;if(h(i,e)){l+=c;p++}if(e===t.boxes.length-1){const e=r(i);s+=e;if(i.align!=="right"){this.margin_debugging[i.box_id].right.fixed=null;l+=e;p++}else{this.margin_debugging[i.box_id].right.fixed=i.contains[0];this.margin_debugging[i.box_id].right.fixed_dir="right"}}}let m=s-e;let g;if(o===0){g=1}else{if(t.boxes.length===1&&t.boxes[0].collapse_margin!=null&&t.boxes[0].collapse_margin>=e){d=true;m-=l}else{d=false}if(o>=m){if(o-m>a){g=a/o;m+=a-o}else{g=(o-m)/o;m=0}}else{g=0;m-=o}}let v;if(l===0){v=1}else if(d){v=0}else{v=(l-m)/l;m=0}const b=m/-p;const y=new Array(t.boxes.length);let w=0;let x=0;for(let e=0;e<t.boxes.length;e++){const n=t.boxes[e];const r=n.min_width+(n.iw-n.min_width)*g;if(n.max_width&&r>n.max_width){w+=r-n.max_width;y[e]=n.max_width}else{x+=n.iw-n.min_width;y[e]=r}}while(w>0){let e=0;let n=0;for(let r=0;r<t.boxes.length;r++){const i=t.boxes[r];if(!i.max_width||y[r]<i.max_width){const t=y[r]+w*(i.iw-i.min_width)/x;if(i.max_width&&t>i.max_width){n+=i.max_width-y[r];y[r]=i.max_width}else{n+=t-y[r];e+=i.iw-i.min_width;y[r]=t}}}w-=n;if(w<1){w=0}x=e}const j=this._show_line(u);j[0].style["margin-top"]=t.top_margin+"px";let A=0;for(let r=0;r<t.boxes.length;r++){var f;const s=t.boxes[r];const o=this._get_box(s.box_id);o.show();if(j[0].lastChild!==o[0]){j.append(o)}let a;if(h(s,r)){a=n(s,r)*v+b}else{a=n(s,r)}const l=y[r];o[0].style.left=A+a+"px";A+=a+l;o[0].style.width=l+"px";const c=l/s.iw;this.margin_debugging[s.box_id].left.actual=a;if(r===t.boxes.length-1){this.margin_debugging[s.box_id].right.actual=e-A}this.margin_debugging[s.box_id].left.collapsed=d&&this.margin_debugging[s.box_id].left.fixed_dir!=="left";this.margin_debugging[s.box_id].right.collapsed=d&&this.margin_debugging[s.box_id].right.fixed_dir!=="right";const u=v>1||b>0;const p=v<1||b<0;this.margin_debugging[s.box_id].left.stretched=u;this.margin_debugging[s.box_id].right.stretched=u;this.margin_debugging[s.box_id].left.squeezed=p;this.margin_debugging[s.box_id].right.squeezed=p;this.margin_debugging[s.box_id].left.things_to_break=t.boxes.length>1;this.margin_debugging[s.box_id].right.things_to_break=t.boxes.length>1;this.margin_debugging[s.box_id].top={actual:t.top_margin,from_element:t.topmost};if(r>0){this.margin_debugging[t.boxes[r-1].box_id].right=this.margin_debugging[s.box_id].left}const _=(f=s.contains)!=null?f:{};for(const t in _){const n=_[t];const r=Math.min(this.elements[n].mw,e);let a=Math.max(r,this.elements[n].iw*c);if(this.elements[n].maxw&&a>this.elements[n].maxw){a=this.elements[n].maxw}const u=l-a;let d;if(s.iw-this.elements[n].iw===0){d=u/2}else{const e=this.elements[n].il/(s.iw-this.elements[n].iw);d=e*u}const p=i(this.elements[n]);if(p&&!this.elements[n].is_attached){this.elements[n].is_attached=true;this.calculate_children(n);const e=(e,t)=>e.append(t);this._wait_for_instance_added(n,(()=>{var t;const r=this.instances[n];const i=(t=r.element.E.wrapped_canvas_append)!=null?t:e;i(o,this.to_canvas(this.instances[n]))}))}else if(this.elements[n].is_attached!==false&&!p){this.elements[n].is_attached=false;this.calculate_children(n);this._wait_for_instance_added(n,(()=>{this.to_canvas(this.instances[n]).detach()}))}if(p){this._set_element_width(n,a,d)}if(!this.elements[n].is_attached){this._visibility_rules.push(n)}}}this.update_display_line_height(t)}this._hide_lines(u);this.recalculate_container();this.flow_created.turn();this.emit("resize_width",e)}recalculate_container(){r.WaitFor(this.flow_created,(()=>{if(this.owner_instance.supports_message("child_movement")&&this.lines_length>0){const t=this.lines[this.lines_length-1].bottom;let n=0;for(const t of(e=this.display_lines)!=null?e:[]){var e;let r=0;for(const e of t.boxes){r=Math.max(r,e.height)}n+=r+t.top_margin}const r=n-t;this.owner_instance.message("child_movement",r)}}))}set_height(e,t,n){var r,i;(r=n)!=null?r:n={};const s=e.element_id();const o=(i=this.elements[s])!=null?i:{};if(o.height===t){return}o.height=t;if(!n.no_css_update){this._update_instance(s,(()=>{this.to_canvas(e)[0].style.height=o.height+"px"}))}const a=t-o.ih;if(a===o.height_delta){return}o.height_delta=a;this.calculate_children(s)}calculate_children(e){const t=this.elements[e];if(t==null){let t;const n=i.by_id(e);const s=n==null?void 0:n.display();if(s!=null){const e=n.root().display();t=`Could not draw element ${s} on ${e}, please make some changes to it or recreate it in the editor and retry`}else{t="Could not draw an element on the page, please ask the Bubble team for guidance"}throw new r.OwnerError("Missing responsive index",{display:t,element_id:e,tags:{user_level:"owner_error"}})}if(!t.pushes){this.recalculate_box_height(t.box);this.recalculate_container()}else{for(const e in t.pushes){const n=t.pushes[e];this.recalculate(n)}}}_get_height_delta(e){if(this.elements[e].is_attached){var t;return(t=this.elements[e].height_delta)!=null?t:0}else{var n;return(n=-this.elements[e].ih)!=null?n:0}}recalculate(e){let t;const n=this.elements[e];if(!n.pushed_by){t=0}else{const e=Object.values(n.pushed_by).map((e=>{var t;return this._get_height_delta(e)+((t=this.elements[e].top_delta)!=null?t:0)}));t=Math.max(...e)}if(t!==n.top_delta){n.top_delta=t;const r=n.top_delta+n.it;if(n.top!==r){n.top=r;this._update_instance(e,(()=>{this.to_canvas(this.instances[e])[0].style.top=n.top+"px"}))}this.calculate_children(e)}}to_canvas(e){return e.canvas}add_to_instances(e){var t,n,r;(r=(t=this.elements)[n=e.element_id()])!=null?r:t[n]={};this.instances[e.element_id()]=e}add(e){const{element:t}=e;const n=this.to_canvas(e);if(t instanceof d.Root){this.container_canvas.append(n);n[0].style["z-index"]=2;n[0].style.position="absolute";return}const r=t.id();const i=this.elements[r];if(i==null){return}this.instances[r]=e;if(this.instances_keys[r]){this.instances_keys[r].turn();this.instances_keys[r]=null}e.wait_for_visible_lite((()=>{const{style:e}=n[0];e.position="absolute";e.boxSizing="border-box";e.zIndex=i.iz;if(i.height==null){i.height=i.ih;e.height=i.height+"px"}if(i.width==null){i.width=i.iw;e.width=i.width+"px"}if(i.left==null){i.left=i.il;e.left=i.left+"px"}if(i.top==null){i.top=i.it;e.top=i.top+"px"}}))}create_child(e,t){const{custom_definition:n}=e.element.E;if(n){if(n().get_responsive_version()>0){return new a(e,t)}if(!n().use_responsive_algorithm()){return new l(e,t)}else{return new c(e,t,e.element.get_responsive_data())}}else{const n=new this.constructor(e,t,e.element.get_responsive_data(),this.owner);this.child_containers.push(n);return n}}initialize(){u.tab_container(this.owner_instance)}detach(e){this.to_canvas(e).detach()}}o.Container=c;o.OldContainer=l;o.set_responsive_container=function(e){a=e};const u=e("../tab");const d=e("../../lang/lang");const p=e("../../lib")},{"../../lang/lang":714,"../../lib":741,"../tab":38,"./../../lang/appquery":651,"./../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123,events:978}],34:[function(e,t,n){"use strict";const r=n;const i=e("./../u");r.get=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++){n[r-1]=arguments[r]}const o=JSON.stringify({function_name:e,args:n});if(window.bubble_run_derived[o]){return new s(window.bubble_run_derived[o])}else{throw new i.UnexpectedError("Derived not included in package",{function_name:e,args:n})}};class s{constructor(e){this._content=e}content(){return this._content}set_app(e){}}},{"./../u":823}],35:[function(e,t,n){"use strict";const r=n;const i=e("../lib");const s=e("../constants/time");const o=e("../monitoring/apm/clientApm");const a=s.SECOND_MS*2;r.start=function(){l()};function l(){const e=o.getCompletedTransactions();if(e.length){i().location.post("server://user/apm",{completedTransactions:e,apm:true});o.clearCompletedTransactions()}setTimeout(l,a)}},{"../constants/time":92,"../lib":741,"../monitoring/apm/clientApm":745}],36:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("./../u");const s=e("./../lib");const o=e("./../logger");r.do_it=function(){if(i.on_phonegap()){return}i.run_once(30,(()=>s().current_user().is_logged_in()),((e,t)=>{if(e){o.log(e);return}if(!t){const e=s().location.post("server://frg",{action:"ask",url:document.location.href});e.then((e=>{if(e){let e=document.documentElement.outerHTML;const[t,n]=e.split('<meta charset="utf-8">');e=t+'<script type="text/javascript">window.dont_call_page_display = true;<\/script>'+'<meta charset="utf-8">'+n;s().location.post("server://frg",{action:"set",html:e,url:document.location.href})}}))}}))}},{"./../lib":741,"./../logger":744,"./../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],37:[function(e,t,n){"use strict";const r=e("../u");e("../lang/btypes");e("../box");const i=e("../lang/appquery");const s=e("../shared/apps_utilities");const o=e("../db/client_db");const a=e("./client_initializer");const l=e("../ddg");const c=e("../shared/domain_utilities");const u=e("./elementservice");const d=e("../lang/lang");const p=e("../lib");const _=e("./locationservice");const f=e("../logger");const h=e("../u/shared/b_date").require_moment();const m=e("../services/shared/plugin_getter");const g=e("../services/client/runmode/pluginservice_getter");const v=e("./run_derived");const b=e("../test_utilities/testing");const y=e("url");const w=e("./userservice");const x=e("../webfonts");const j=n;j.make_document_ready=A;j.initialize_tests=S;j.set_temp_db=D;j.set_up_debugger=k;j.set_webfonts_key=O;j.create_lib=E;function A(){if(typeof document!=="undefined"&&document!==null){window.document_ready_key=r.MakeKey(null,"window.document_ready_key");$((()=>window.document_ready_key.turn()));a.initialize();f.install_browser_error_handler({Lib:p});m.initialize(g)}}function M(){let e;if(r.on_phonegap()){if(!window.web_url_equivalent_for_phonegap){throw new r.UnexpectedError("missing web_url_equivalent_for_phonegap for phonegap app. Should be set in index.html when generating the phonegap build")}e=new _(window.web_url_equivalent_for_phonegap)}else{e=new _(document.location.href,{normalizeUnicode:true})}return e}function E(e,t){const n=r.json_parse(window._p);return{app:d.make_run_app(e,e._id,e.app_version),is_edit_mode:false,appname(){return e._id},app_version(){return e.app_version},db_instance:o.instance,current_user:o.current_user,ddg:l.instance(t),location:M(),user:new w,element:new u.ElementService,ignore_privacy_rules(){return false},app_plan(){return n},derived:v.get,current_timezone(){if(i.has_advanced_feature_enabled("timezone_controls_page")){const e=i.get_page_by_name(t);return e.get_page_timezone()}else{return h.tz.guess()}}}}function k(){if(y.parse(document.location.href,true).query.debug_mode){if(window.start_debugger!=null){window.start_debugger()}else{const e=y.parse(document.location.href,true);delete e.query.debug_mode;delete e.search;p().location.set_url_without_refresh({url:y.format(e)})}}}function O(){r.WaitFor(x.active_key,x.fontface_key,(()=>{var e,t;(e=window.performance)==null?void 0:(t=e.mark)==null?void 0:t.call(e,"webfonts active")}))}function S(){b.initialize();if(s.is_test(p().appname())){const e=p().load_plugin(p().plugin_prefixes.module+"runmode_tests");e.initialize()}}function D(){const e=y.parse(document.location.href,true);if(r.readCookie("temp_db")){if(c.is_hostname_bubble(e.host)){r.eraseCookie("temp_db")}else{console.log("TEMP DB IS SET!!!")}}}},{"../box":13,"../db/client_db":424,"../ddg":484,"../lang/appquery":651,"../lang/btypes":653,"../lang/lang":714,"../lib":741,"../logger":744,"../services/client/runmode/pluginservice_getter":779,"../services/shared/plugin_getter":783,"../shared/apps_utilities":788,"../shared/domain_utilities":792,"../test_utilities/testing":811,"../u":823,"../u/shared/b_date":836,"../webfonts":858,"./client_initializer":22,"./elementservice":24,"./locationservice":27,"./run_derived":34,"./userservice":39,url:981}],38:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");let r=1;n.tab_container=e=>{e.wait_for_visible_lite((()=>{const t=[];for(const n of e.children){if(n.element.get_messages().includes("set_focus")||n.element.get_related_workflows("ButtonClicked").length){t.push(n)}}const n=t.filter((e=>!e.state("tab_index")));n.sort(((e,t)=>e.element.get_top()-t.element.get_top()));function i(e,t){return Math.max(...e.map((e=>e.element.get_top()+e.element.get_height())))>=t.element.get_top()}const s=[];let o=[];for(const e of n){if(o.length===0||i(o,e)){o.push(e)}else{s.push(o);o=[e]}}s.push(o);for(const e of s){e.sort(((e,t)=>e.element.get_left()-t.element.get_left()));for(const t of e){t.message("add_tab_index",r);r++}}}))}},{"core-js/modules/web.dom-collections.iterator.js":1123}],39:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=e("./../u");const i=e("events");const s=e("url");const o=e("./../lib");const a=e("../logger");const l=e("./../db/client_db");const c=e("../db/db");const u=e("../constants/db");const d=e("../core/core_events");const{ERROR_SOURCES:p}=e("../constants/workflow");if(typeof window!=="undefined"&&window!==null){window.authenticate_as=e=>o().location.post("server://user/auth_as/"+e,{},((e,t)=>{if(e){console.log("Authentication failed")}else{console.log("Authentication succeeded.  Refreshing...");setTimeout((()=>window.document.location.reload()),1e3)}}))}t.exports=class e extends i.EventEmitter{constructor(){super();this.ready_key=r.MakeKey(null,"user_service");this.has_changed_flag=false;this.heartbeat_interval=null;const e=()=>{this.heartbeat_interval=setInterval((()=>o().location.post("server://user/hi",null)),5*60*1e3)};r.WaitFor(this.ready_key,(()=>{if(this.heartbeat_interval==null){o().location.post("server://user/hi",null,e)}const t=r.Watcher((()=>{var e,t;const n=l.current_user();const r=n.is_logged_in();const i=n._id();const s=(e=o().pageparam.get())==null?void 0:(t=e._id)==null?void 0:t.call(e);return r+"_"+i+"_"+s}));t.on_value((e=>{const t=l.current_user().is_logged_in();if(o().current_user()._id()!==u.NO_USER){c.wipe_no_user();this.emit("cookie_opt_in")}const{on_login:n}=o().location.get_query();if(t&&n){this.has_changed_flag=true;o().workflow.about_to_change_page=true;const e=o().location.get_server_base()+"api/1.1/util/rr/"+n;window.location.replace(e)}if(t){o().workflow.announce_event("LoggedIn")}else{o().workflow.announce_event("LoggedOut")}}))}))}on_cookie_opt_in(e){if(o().current_user()._id()!==u.NO_USER){e()}else{this.once("cookie_opt_in",e)}}is_cookie_opt_in(){return o().current_user()._id()!==u.NO_USER}has_changed(){if(o().current_user().is_logged_in()){return this.has_changed_flag}}ready(){this.ready_key.turn()}login(e,t){const n=o().location.post("server://user/login",e);n.then(t)}logout(e){const t=o().location.post("server://user/logout",{});t.then(e)}add_learn_lesson_to_user(e,t){const n=o().location.post("server://user/add_learn_lesson_to_user",e);n.then(t)}took_one_learn(e,t){const n=o().location.post("server://user/took_one_learn",e);n.then(t)}set_deployed_ever(e){const t=o().location.post("server://user/set_deployed_ever",e);t.then((()=>o().current_user().flush()))}set_conversed_with_ai_chatbot(){o().location.post("server://user/set_conversed_with_ai_chatbot",{})}set_seen_editor_help_center(){o().location.post("server://user/set_seen_editor_help_center",{})}set_seen_component_library_onboarding(){o().location.post("server://user/set_seen_component_library_onboarding",{})}set_actually_building_trigger(e,t){const n=o().location.post("server://user/set_actually_building_trigger",e);n.then(t)}set_maison_editor_by_default(e,t){const n=o().location.post("server://user/set_maison_by_default_flag",e);n.then(t)}on_page_load_for_confirmation_email(){$(document).ready((()=>{const e=s.parse(o().location.base_url,true);const t=e.query;if(t.confirmation_email){const n=o().location.post("server://user/confirm_email",{confirmation_email_id:t.confirmation_email});n.then((()=>{o().current_user().flush();delete t.confirmation_email;delete e.search;delete e.hash;o().location.set_url_without_refresh({url:s.format(e)})}),(e=>{d.handle_uncaught_error({original_error:e,caught_from:p.GENERAL_WORKFLOW,cb(e){if(e){window.alert(a.human_friendly(e))}}})}))}}))}}},{"../constants/db":58,"../constants/workflow":95,"../core/core_events":377,"../db/db":427,"../logger":744,"./../db/client_db":424,"./../lib":741,"./../u":823,"core-js/modules/es.string.replace.js":1121,events:978,url:981}],40:[function(e,t,n){(function(n){(function(){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.immediate.js");e("core-js/modules/es.error.cause.js");const r=e("./../u");const i=e("../db/hydrate");const s=e("./../u/shared/mode_check");const o=e("url");const a=e("./../client_config");const l=e("../constants/db");const c=e("./../constants/locations");const u=e("../constants/notifier_topics");const d=e("../core/core_datasources/utilities/core_ds_workflow_utilities");const p=e("../lang/evaluation/node_eval");const _=e("../lang/evaluation/FrozenState");const f=e("../lang/evaluation/page_state");const h=e("./../logger");const m=e("./../lib");const g=e("./../lang/appquery");const v=e("./../lang/expressions");const b=e("./../notifier/client");const y=e("./../locations");t.exports=class t{constructor(){this._global=new(e("events").EventEmitter);this._initialized=r.MakeKey(null,"workflow engine initialized");this.open_server_actions=[];this.all_sent_to_server=r.MakeKeyList();this.all_client_completed=r.MakeKeyList();this.all_server_completed=r.MakeKeyList();this.everything_completed=r.MakeKeyList([this.all_client_completed,this.all_server_completed]);this.debug_queue=[];this.disabled=r.Box(false);this.about_to_change_page=false;if(!s.running_test()){setTimeout((()=>{if(m()&&!m().is_edit_mode()){if(typeof window!=="undefined"&&window!==null&&!["tour","learn"].includes(m().appname())){window.onbeforeunload=()=>{if(!this.warn_on_page_change){return undefined}if(this.about_to_change_page){return undefined}if(this.can_change_page()){return undefined}return m().get_text("CORE","STILL_CHANGING")}}if(typeof window!=="undefined"&&window!==null){if(y.is_hardcode(m().appname(),m().app_version())){return}const e=c.BREAKING_REVISION_TOPIC;b.watch([u.LastChangeTopic,m().appname(),m().app_version()],(()=>g.app().json.child("last_change_as_of").get()),(e=>{let{message:t}=e;if(t!=null&&t!==g.last_change()){console.log("PLEASE REFRESH:","last change",t,g.last_change());this.show_bad_revision()}}));return b.watch(e,(()=>a.breaking_revision),(e=>{let{version:t}=e;if(t!=null&&t!==a.breaking_revision){console.log("BREAKING REVISION:","breaking revision",t,a.breaking_revision);this.show_bad_revision()}}))}}}),1e3)}}everything_done_key(){return this.everything_completed}can_change_page(){return this.all_client_completed.is_turned()&&this.all_sent_to_server.is_turned()}show_bad_revision(){if(this.bad_revision){return}this.bad_revision=true;const e=r.div("bad-revision",$("body"));if(r.on_phonegap()||r.is_on_mobile_or_tablet()){e.html(m().get_text("CORE","BAD_REVISION_PHONE"));e.css("font-size","16px")}else{e.append(m().get_text("CORE","BAD_REVISION"))}e.on("click",(()=>{if(r.on_phonegap()){navigator.splashscreen.show()}window.location.reload(true)}))}show_db_limit_reached(){if(this.db_limit_reached){return}this.db_limit_reached=true;const e=r.div("db-limit-reached",$("body"));e.append(m().get_text("CORE","DB_LIMIT_REACHED"));if(r.is_debug_mode()){e.css("cursor","pointer");e.on("click",(()=>{const e=g.get_editor_link()+"&tab=tabs-6&subtab=Plan";window.open(e)}))}}show_app_limit_reached(){if(this.app_limit_reached){return}this.app_limit_reached=true;const e=r.div("app-limit-reached",$("body"));e.append(m().get_text("CORE","APP_LIMIT_REACHED"));if(r.is_debug_mode()){e.css("cursor","pointer");e.on("click",(()=>{const e=g.get_editor_link()+"&tab=tabs-6&subtab=Plan";window.open(e)}))}}toggle(){this.disabled(!this.disabled())}set_debugger(e){this.debugger=e}debug(e,t,n){if(this.debugger==null||e.get_static_property("workflow_disabled")){return r.Promise(true)}const i=r.Promise(null,"waiting for debugger to finish with "+e.id());const s=()=>{i.resolve();this._debugger_send_next_item(true)};this.debug_queue.push({item:e,context:n,next:s,properties_promise:t});this._debugger_send_next_item();return i}_debugger_send_next_item(e){if(e){this._debugger_waiting=false}if(this._debugger_waiting){return}let t;if(this._current_debug_run==null){t=this.debug_queue.shift()}else{t=null;for(const e of this.debug_queue){if(e.context.run_id===this._current_debug_run){t=e;r.array_remove(this.debug_queue,t);break}}}if(t!=null){this._debugger_waiting=true;this._was_debugging=true;const{item:e,context:n,next:r,properties_promise:i}=t;this._current_debug_run=n.run_id;i.callback(((t,i)=>{if(t){this._debugger_waiting=false;r()}else{const t=v.make_partial_expression_evaluator(n);this.debugger.highlight(e,i,t,n,r)}}))}}debug_done(e){if(this._current_debug_run===e){this._current_debug_run=null}n((()=>{if(this.debug_queue.length===0&&this._was_debugging&&!this._debugger_waiting){var e;(e=this.debugger)==null?void 0:e.all_finished((()=>this.debug_queue.length===0&&!this._debugger_waiting));this._was_debugging=false}else{this._debugger_send_next_item()}}))}announce_event(e){this._global.emit(e)}on_event(e,t){this._global.setMaxListeners(200);this._global.on(e,t)}off_event(e,t){this._global.removeListener(e,t)}abort_server_calls(){if(this.bad_revision){return new r.UserError("BAD_REVISION")}if(this.db_limit_reached){return new r.UserError("DB_LIMIT_REACHED")}if(this.app_limit_reached){return new r.UserError("APP_LIMIT_REACHED")}return null}run_workflows(e,t,n){var i;const s=r.Promise(null,"running workflows");(i=e.datasources)!=null?i:e.datasources=f.get_basic_datasources(e.element.element.root());if(!e.element){throw new r.UnexpectedError("context must contain an element")}if(!e.frozen_state){new _(e)}const o=this.all_sent_to_server.make(30,"freezing workflows");const a=this.all_client_completed.make(30,"starting workflows");if(n){this.warn_on_page_change=true;const e=()=>{if(this.can_change_page()){this.warn_on_page_change=false}else{r.WaitFor(this.all_client_completed,this.all_sent_to_server,(()=>{setTimeout(e,100)}))}};e()}e.frozen_state.freeze_workflows(t,(n=>{if(n){o.turn();a.turn();s.reject(n)}else{const n=t.map((t=>({event:t,context:this.create_context(e,t)})));s.resolve(this.should_events_run(n).then((e=>this.refreeze_states(e).then((e=>{try{e=this.filter_invalid_states(e);this._start_workflows_on_server(e);o.turn();let t=r.Promise(true);for(const n of e){t=t.then((()=>this._run_workflow(n.context,n.event)))}return t.then((()=>e.map((e=>e.event))))}finally{o.turn();a.turn()}}))),(e=>{o.turn();return e})))}}));return s}filter_invalid_states(e){const t=[];for(const{event:n,context:i}of e){if(i.frozen_state.has_invalid_state()){const e=new r.OwnerError("Cannot run workflow -- relies on invalid inputs");this.report_error(e,i)}else{t.push({event:n,context:i})}}return t}refreeze_states(e){const t=[];for(const{event:n,context:i}of e){const e=r.Promise(null,"refreezing");t.push(e);i.frozen_state.freeze_workflows([n],(t=>{if(t){e.reject(t)}else{e.resolve({event:n,context:i})}}))}return r.promise_array(t)}_start_workflows_on_server(e){const t=[];const n=this.abort_server_calls();for(const{context:i,event:s}of e){if(!r.cookies_enabled()&&this.uses_cookies(s)){throw new r.UserError(null,"Oops! Your browser seems to have cookies disabled. Make sure cookies are enabled.")}if(this.uses_server(s)){if(n){throw n}t.push({context:i,item:s});i.is_running_on_server=true}else{i.server_completion_promise=r.Promise(true);i.server_initiation_promise=r.Promise(true)}}this.start_server_call(t)}start_server_call(e){if(e.length===0){return}for(const t of e){t.context.server_initiation_promise=r.Promise(null,"server call initiated for "+t.item.id());t.context.server_completion_promise=r.Promise(null,"server call completed for "+t.item.id());t.server_call_id=r.UUID();t.context.server_call_id=t.server_call_id;t.context.server_call_context="";t.context.server_initiation_promise.callback((e=>{if(e){t.context.server_completion_promise.reject(e)}}));this.all_server_completed.add_promise(t.context.server_completion_promise)}const t=this.all_sent_to_server.make(30,"start_server_call");r.run_once(30,(()=>{let t;const n=m().current_user();const s=n._id();if(s===l.NO_USER){t=n.raw()}else{t=undefined}const o={wait_for:r.json_deep_copy(this.open_server_actions),app_last_change:g.last_change(),client_breaking_revision:a.breaking_revision,calls:[],timezone_offset:(new Date).getTimezoneOffset(),timezone_string:m().current_timezone(),user_id:s,no_user_data:t};for(const{context:t,item:n,send_to_server:r,server_call_id:s}of e){o.calls.push({client_state:t.frozen_state.get_client_state(),run_id:t.run_id,server_call_id:s,item_id:n.id(),element_id:t.element.element_id(),additional_parameters:r,uid_generator:t.uid_generator,random_seed:t.random_seed,current_date_time:f.get_page_data("Current Date/Time",t).getTime(),current_wf_params:d.dehydrate_wf_params(t,(e=>i.dehydrate_tree(e)))})}return o}),((n,i)=>{if(n){for(const{context:t}of e){t.server_completion_promise.reject(n);t.server_initiation_promise.reject(n)}t.turn();return}m().location.post("server://workflow/start",i).callback(((t,n)=>{if(t){if(t.message==="BAD_REVISION"){console.log("PLEASE REFRESH:","workflow",JSON.stringify(i));this.show_bad_revision()}else if(t.message==="DB_LIMIT_REACHED"){this.show_db_limit_reached()}else if(t.message==="APP_LIMIT_REACHED"){this.show_app_limit_reached()}else{h.log(t)}}else{m().db_instance().ensure_object_updates(n.object_updates)}for(const{context:i,server_call_id:s}of e){if(t){i.server_completion_promise.reject(t)}else{const e=n[s];if(!e){i.server_completion_promise.reject(new r.UnexpectedError("missing outcome",{res:n,server_call_id:s}))}else if(e.outcome==="error"){t=r.errors.from_json_client(e.error);i.server_completion_promise.reject(t)}else if(e.outcome==="event_failed"){i.server_completion_promise.reject(new r.UserError(null,"We weren't able to complete your action.  Please try again..."))}else if(e.outcome==="redirect"){i.server_completion_promise.resolve(e);this.wait_for_safe(i,(()=>document.location.href=e.next_url))}else if(e.outcome!=="success"){i.server_completion_promise.reject(new r.UnexpectedError("non-success workflow outcome: "+JSON.stringify(e)))}else{i.server_completion_promise.resolve(e)}}}}));setTimeout((()=>t.turn()),200);for(const{context:t,server_call_id:n}of e){t.server_initiation_promise.resolve();const e=()=>{this.open_server_actions=this.open_server_actions.filter((e=>e.server_call_id!==n))};t.server_completion_promise.callback(e);setTimeout((()=>{const r=this.open_server_actions;e();if(r.length!==this.open_server_actions.length){const e=t.server_completion_promise.inspect().state;const i=r.filter((e=>!this.open_server_actions.includes(e)));h.error("MANUALLY REMOVING SERVER_CALL_ID",{server_call_id:n,removed:i,promise_state:e})}}),5*60*1e3)}}))}should_events_run(e){const t=[];for(const{event:n,context:i}of e){const e=r.Promise(null,"should event run: "+n.id());t.push(e);r.run_once(30,(()=>this.should_workflow_run(i,n)),((t,s)=>{if(t){e.reject(t)}else if(!s){e.resolve(this.debug(n,r.Promise(null),i).then((()=>{this.debug_done(i.run_id);return false})))}else{e.resolve(true)}}))}return r.promise_array(t).then((t=>{const n=[];for(let r=0;r<t.length;r++){const i=t[r];if(i){n.push(e[r])}}return n}))}_run_workflow(e,t){if(this.disabled()){const e=r.Promise(true);return e}const n=this.debug(t,r.Promise(null),e).then((()=>this.run_subsequent_actions(e,t)));this.all_client_completed.add_promise(n);const i=n.then((()=>e.server_initiation_promise));this.add_error_handling(e,i);return i}add_logger(e){const t=[];e.log=e=>t.push(e);e.dump_log=()=>t}create_context(e,t){var n,s,o,a;const l=r.extend({},e);delete l.frozen_state;e.frozen_state.clone(l);l.inputs_must_be_valid=true;(n=l.datasources)!=null?n:l.datasources=f.get_basic_datasources(l.element.element.root());l.event=t;const c=r.get_random_seed();(s=l.uid_generator)!=null?s:l.uid_generator={timestamp:Date.now(),seed:c};l.UUID_SEED=r.get_uuid_seed(l.uid_generator);(o=l.random_seed)!=null?o:l.random_seed=Math.random();l.random_generator=new r.Random(l.random_seed);this.add_logger(l);(a=l.run_id)!=null?a:l.run_id=r.UUID();l.get_server_outcome=(e,t)=>l.server_completion_promise.callback(((n,s)=>{l.server_workflow_completed=true;if(n){t(n)}else{const{return_value:n,random_interations:o,UUID_iterations:a}=s.step_results[e.id()];if(a&&a!==l.UUID_SEED.iterations){l.UUID_SEED=r.get_uuid_seed({seed:l.UUID_SEED.seed,timestamp:l.UUID_SEED.timestamp,iterations:a})}if(o&&o!==l.random_generator.iterations){l.random_generator=new r.Random(l.random_generator.seed,o)}t(null,i.rehydrate_tree(m().db_instance(),n))}}));l.update_from_action=function(e,t,n){var r;if(((r=this.original_context)!=null?r:this).server_workflow_completed&&e.can_fall_back_to_server()){return this._fetch_updates(e).then((e=>{for(const t in e){const n=e[t];if(n.x){this.frozen_state.clear(t)}else{this.frozen_state.set(t,n.v)}}return null}))}else{return this.frozen_state.update_from_action(e,n,t,this)}};l._fetch_updates=e=>l.server_completion_promise.then((t=>{var n;const r=i.rehydrate_tree(m().db_instance(),(n=t.state_changes[e.id()])!=null?n:{});if(r==null){h.error("unexpected null _fetch_updates result",{res:t,item_id:e.id()})}return r!=null?r:{}}));return l}resume_action(e,t){const n=r.Promise(null,"Resuming "+t.id());e.log("about to resume "+t.type()+" "+t.id());t.resume(e,((r,i)=>{if(r){n.reject(r)}else{e.log("successfully resumed "+t.type()+" with result "+i);const r=p.evaluate_action_clientside(t,e);n.resolve(e.update_from_action(t,r,i).then((()=>this.run_subsequent_actions(e,t))))}}));return n}run_subsequent_actions(e,t){const n=t.next();if(n==null){e.log("workflow is finished");return r.Promise(true)}const i=p.evaluate_action_clientside(n,e);return this.debug(n,i,e).then((()=>{var t;const s=r.Promise(null,(t="Running action "+(n==null?void 0:n.id()))!=null?t:"<done>");e.log("about to run "+n.type()+" "+n.id());if(["TriggerCustomEvent","TriggerCustomEventFromReusable"].includes(n.type())){s.resolve(this.start_custom_workflow(e,n))}else{n.run(e,i,((t,r)=>{if(t){if(t==="aborted"){s.resolve()}else{s.reject(t)}}else{e.log("successfully ran "+n.type()+" "+n.id()+" with result "+r);e.update_from_action(n,i,r).callback((t=>{if(t){s.reject(t);return}if(n.requires_server()&&e.server_completion_promise.inspect().state==="pending"){if(!e.server_call_id){throw new Error("could not find our server call")}const t=e.server_call_context+n.id();this.open_server_actions.push({server_call_id:e.server_call_id,action_id:t})}if(n.type()==="DisplayGroupData"){setTimeout((()=>{s.resolve(this.run_subsequent_actions(e,n))}),0)}else{s.resolve(this.run_subsequent_actions(e,n))}}))}}))}return s}))}start_custom_workflow(e,t){const n=g.event(t.get_static_property("custom_event"));const i=()=>this.run_subsequent_actions(e,t);return p.evaluate_wf_properties(t,e).then((s=>{let o,a;if(!s.condition){a=r.Promise(false)}else{var l;const i=d.wf_params_from_properties(s);o=d.build_duplicate_per_item_context(e,i);o.event=n;if(e._previously_run_custom_events){o._previously_run_custom_events=r.extend({},e._previously_run_custom_events)}else{o._previously_run_custom_events={}}if(o._previously_run_custom_events[t.id()]){throw new r.OwnerError("Circular custom workflow -- custom workflows cannot call themselves (either directly or indirectly)")}o._previously_run_custom_events[t.id()]=true;o.original_context=(l=e.original_context)!=null?l:e;if(t.type()==="TriggerCustomEventFromReusable"){o.element=e.element.find_instance_by_id(t.get_static_property("element_id"))}else{o.element=e.element.find_instance_by_id(t.root().id())}o.server_call_context+=t.id()+".";o.get_server_outcome=(n,i)=>e.get_server_outcome(t,((t,s)=>{o.server_workflow_completed=true;if(t){i(t);return}if(!(n.id()in s)){t=new r.UnexpectedError("Error Getting Server Outcome",{outcome_for:n.id(),have_outcomes:Object.keys(s)});i(t);return}const{return_value:a,random_interations:l,UUID_iterations:c}=s[n.id()];if(c&&c!==e.UUID_SEED.iterations){e.UUID_SEED=r.get_uuid_seed({seed:e.UUID_SEED.seed,timestamp:e.UUID_SEED.timestamp,iterations:c})}if(l&&l!==e.random_generator.iterations){e.random_generator=new r.Random(e.random_generator.seed,l)}i(null,a)}));o._fetch_updates=n=>e._fetch_updates(t).then((e=>e[n.id()]));a=r.run_once(30,(()=>this.should_workflow_run(o,n)))}return a.then((e=>{if(!e){return i()}else{return this._run_workflow(o,n).then(i)}}))}))}_uses(e,t){for(const n of e.actions()){if(n["requires_"+t]()){return true}}return false}uses_server(e){return this._uses(e,"server")}uses_cookies(e){return this._uses(e,"cookies")}should_workflow_run(e,t){var n,r;(n=e.log)==null?void 0:n.call(e,"in should_workflow run for "+t.id());const i=p.evaluate_event_condition(t,e);(r=e.log)==null?void 0:r.call(e,"should_workflow_run: "+i);return i}add_error_handling(e,t){return t.callback((t=>{this.debug_done(e.run_id);if(t){return this.report_error(t,e)}}))}report_error(e,t){r.ensure_bubble_error(e).extend({event:t.event,element_instance:t==null?void 0:t.element,log:t==null?void 0:t.dump_log()});h.log(e)}wait_for_server(e){if(this.all_server_completed.is_turned()){e()}else{r.WaitFor(this.all_server_completed,(()=>{setTimeout((()=>{this.wait_for_server(e)}),10)}))}}wait_for_safe(e,t){this.debug_done(e.run_id);if(this.all_sent_to_server.is_turned()&&this.all_server_completed.is_turned()){this.about_to_change_page=true;t()}else{r.WaitFor(this.all_sent_to_server,this.all_server_completed,(()=>{setTimeout((()=>{this.wait_for_safe(e,t)}),100)}))}}initialize(){const e=o.parse(m().location.base_url,true);const t=e.query.resume;if(t){delete e.query.resume;const n={};for(const t in e.query){const r=e.query[t];if(r!=null){n[t]=r}}e.query=n;delete e.search;m().location.set_url_without_refresh({url:o.format(e)});this.resume(t)}this._initialized.turn()}initialize_key(){return this._initialized}resume_uses_server(e,t){return t||e.terminate_server_workflow()}make_resume_key(e,t,n){if(t.next()||this.resume_uses_server(t,n)){const i=d.dehydrate_wf_params(e,(e=>{if((e==null?void 0:e.dehydrate)!=null){return e.dehydrate()}else{return e}}));const{state:s,value:o,reason:a}=e.server_completion_promise.inspect();const l=o;if(s!=="fulfilled"){h.warn("bad server outcome before navigation",{state:s,value:o,reason:a})}const c={element_instance:e.element.dehydrate(),element_id:e.element.element_id(),current_wf_params:i,to_resume:t.id(),frozen_state:e.frozen_state.serialize(),run_id:e.run_id,server_workflow_terminated:n,uid_generator:e.uid_generator,server_outcome_value:l};if(c.uid_generator!=null){c.uid_generator.iterations=e.UUID_SEED.iterations}const u=e.run_id;r.local_storage_put(u,c,true);return u}}resume(e,t){const n=r.local_data_retrieve(e);if(!n){h.error("Could not resume workflow, was not able to retrieve data",{resume_key:e});return r.Promise(false)}const s=g.action(n.to_resume);const o=r.Promise(null,"finished resuming workflow");r.run_once(30,(()=>{m().app_language();let e=n.element_instance;let t="";const s=/(.*?:[a-zA-Z]+)_group_item_.*?_(\d+):/;let o=e.match(s);while(o!=null){const n=i.rehydrate_tree(m().db_instance(),t+o[1]);const a=o[2];n.message("draw_till",a);const l=n.repeating_layout_type==="Table";const c=l?n.parent().table_element_layout:n.repeating_group_layout;c.raw_list_data();r.ensure_ready(c.finished_loading_switch);e=e.substring(o[0].length);t+=o[0];o=e.match(s)}return{element:i.rehydrate_tree(m().db_instance(),n.element_instance)}}),((e,i)=>{if(e){o.reject(e);return}let{element:a}=i;if(!a){a=new w(n.element_instance,n.element_id)}let l={element:a,run_id:n.run_id,uid_generator:n.uid_generator};const c=_.deserialize(l,n.frozen_state);l.frozen_state=c;l=this.create_context(l,s.event());l.datasources.get_wf_param=d.generate_wf_param_datasource(n.current_wf_params);l.log("resuming workflow at action "+s.id()+" "+s.type());if(this.resume_uses_server(s,n.server_workflow_terminated)){this.start_server_call([{context:l,item:s,send_to_server:t}])}else{l.server_completion_promise=r.Promise(n.server_outcome_value);l.server_initiation_promise=r.Promise(true)}const u=this.resume_action(l,s);o.resolve(u.then((()=>l.server_initiation_promise)));this.add_error_handling(l,o)}));return o}};class w{constructor(e,t){this.instance_id=e;this._element_id=t;this.element=g.element(this._element_id)}dehydrate(){return this.instance_id}element_id(){return this._element_id}find_instance_by_id(e){return null}}}).call(this)}).call(this,e("timers").setImmediate)},{"../constants/db":58,"../constants/notifier_topics":76,"../core/core_datasources/utilities/core_ds_workflow_utilities":236,"../db/hydrate":429,"../lang/evaluation/FrozenState":687,"../lang/evaluation/node_eval":697,"../lang/evaluation/page_state":698,"./../client_config":41,"./../constants/locations":74,"./../lang/appquery":651,"./../lang/expressions":711,"./../lib":741,"./../locations":743,"./../logger":744,"./../notifier/client":747,"./../u":823,"./../u/shared/mode_check":851,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,events:978,timers:2334,url:981}],41:[function(e,t,n){"use strict";var r=s(e("./safe_require"));var i=s(e("../client_config.json"));function s(e){return e&&e.__esModule?e:{default:e}}const o=i.default;t.exports=o;r.default.safe_register("./client_config",o)},{"../client_config.json":1,"./safe_require":777}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ORDERED_ADVANCED_FEATURES=n.ADVANCED_FEATURE_JSON_SETTINGS_PATH=n.ADVANCED_FEATURES=void 0;const r="advanced_features";n.ADVANCED_FEATURE_JSON_SETTINGS_PATH=r;const i=["timezone_controls","expose_id_option"];n.ORDERED_ADVANCED_FEATURES=i;const s={timezone_controls:{display:"Enable timezone override controls",enabled_by_default:true,children_advanced_features:["timezone_controls_date_time_inputs","timezone_controls_page","timezone_controls_backend_workflows"]},timezone_controls_date_time_inputs:{display:"Date-time inputs (Date-Time Picker and Input)",enabled_by_default:true,parent_advanced_feature:"timezone_controls"},timezone_controls_page:{display:"Page (at the individual page level)",enabled_by_default:false,parent_advanced_feature:"timezone_controls",fallback:["experimental_feature","timezone_improvements"]},timezone_controls_backend_workflows:{display:"Backend workflows (API workflows, scheduled workflows, data triggers",enabled_by_default:false,parent_advanced_feature:"timezone_controls",fallback:["experimental_feature","timezone_improvements"]},expose_id_option:{display:"Expose the option to add an ID attribute to HTML elements",enabled_by_default:false,fallback:["raw_path","settings.client_safe.expose_id_option"]}};n.ADVANCED_FEATURES=s},{}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.PUBLIC_ONLY=n.PRIVATE_ONLY=n.IGNORE_FIELD=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/apiconnectorbase",n);const s="_ignore";n.IGNORE_FIELD=s;const o="public_only";n.PUBLIC_ONLY=o;const a="private_only";n.PRIVATE_ONLY=a},{"../safe_require":777}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.API_RETURN_TYPES_IDENTIFIERS=void 0;const r={plain_text:{caption:"Plain text",value:true,server_return_type:"plain_text"},json:{caption:"Structured JSON",value:false,server_return_type:"json"},custom:{caption:"Other content-type",value:"custom_content",server_return_type:"custom_content"}};n.API_RETURN_TYPES_IDENTIFIERS=r},{}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.PROTECTED_PAGE_NAMES=n.PROTECTED_KEYS=n.OBJECT_MARKER=n.CONFLICT_PATHS=n.BUBBLE_RESERVED_KEYS=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/app_json",n);const s=new Set(["constructor","__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","toString","valueOf","__proto__","toLocaleString"]);n.PROTECTED_KEYS=s;const o="__obj_marker__";n.OBJECT_MARKER=o;const a=new Set(["type","id","_id","length",o,"phone_number"]);n.BUBBLE_RESERVED_KEYS=a;const l=new Set(["index","reset_pw","404"]);n.PROTECTED_PAGE_NAMES=l;const c=["settings.client_safe.uid_counter","uid_counter","conflicts","conflicts_theirs_version_name","conflicts_undo_snapshot_id","merge_changes","no_merge_changes","_index","screenshot"];n.CONFLICT_PATHS=c},{"../safe_require":777,"core-js/modules/web.dom-collections.iterator.js":1123}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.redirect_301_upgrade_source=n.favicon_upgrade_source=n.SOURCE_TO_FEATURE=n.DESCRIPTIONS=void 0;const r="Settings/General/CustomFavicon";n.favicon_upgrade_source=r;const i="favicon";const s="Settings/SEO/301Redirect";n.redirect_301_upgrade_source=s;const o="redirect_301";const a={algolia_search:"Algolia integration",api:"Using APIs and backend workflows",bulk:"Performing bulk operations",can_buy_plugins:"Recurring subscriptions on paid plugins",can_use_multiple_clusters:"Using scheduled releases",collaboration:"Adding collaborators to this app",custom_domain:"Using a custom domain",custom_headers:"Headers customization",data_trigger:"Triggering data event",discourse_sso:"Setting up Discourse SSO",export_app_json:"Exporting / Importing your app as JSON",[i]:"Custom favicon",hosted_files:"Exposing files",import_export_csv:"Importing / Exporting to CSV",live_version:"Deploying your app's live version",monitoring:"Real time metrics on workflow runs, page views and CPU usage",no_branding:"White labeling",pw_protection:"Password protection",[o]:"301 redirection",scheduler:"Running scheduled workflows",seo:"SEO and social media tags optimization",sub_apps:"Creating sub applications",two_factor_auth:"Two-factor authentication",version_control:"Version control",versions:"Adding more branches"};n.DESCRIPTIONS=a;const l={[r]:i,[s]:o};n.SOURCE_TO_FEATURE=l},{}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.UserSelectablePre2019Plans=n.UserSelectable2023Plans=n.TEST_PLAN=n.TEMPLATE=n.PricingModel2023Plans=n.PricingModel2022Plans=n.LEGACY_PAID_ON_2022_PRICING_LAUNCH=n.LEGACY_2019_PLANS=n.LATEST_ENTERPRISE_PLAN=n.FREE=n.ExperimentalPlans=n.ENTERPRISE_PLANS=n.DO_NOT_MARK_AS_LEGACY=n.DEFAULT_DEDICATED_PLAN=n.CurrentPlans=n.AllPre2019Plans=n.AllPlans=n.APP_TEAM_2023=n.APP_STARTER_2023=n.APP_PROFESSIONAL_2019=n.APP_PRODUCTION_2019=n.APP_PLUGIN_DEMO=n.APP_PERSONAL_2019=n.APP_ORGANIZATION_FREE=n.APP_INSTRUCTOR=n.APP_HACKATHON=n.APP_GROWTH_2023=n.APP_EMPLOYEE=n.APP_EDUCATION=n.APP_CUSTOM_2023=n.AGENCY_PLAN=void 0;e("core-js/modules/web.dom-collections.iterator.js");const r="app_free2";n.FREE=r;const i="app_personal_2019";n.APP_PERSONAL_2019=i;const s="app_professional_2019";n.APP_PROFESSIONAL_2019=s;const o="app_production_2019";n.APP_PRODUCTION_2019=o;const a="app_starter_2023";n.APP_STARTER_2023=a;const l="app_growth_2023";n.APP_GROWTH_2023=l;const c="app_team_2023";n.APP_TEAM_2023=c;const u="app_custom_2023";n.APP_CUSTOM_2023=u;const d="template_app";n.TEMPLATE=d;const p="enterprise";n.DEFAULT_DEDICATED_PLAN=p;const _="enterprise_2022";n.LATEST_ENTERPRISE_PLAN=_;const f="app_agency";n.AGENCY_PLAN=f;const h="app_testing";n.TEST_PLAN=h;const m="app_instructor";n.APP_INSTRUCTOR=m;const g="app_hackathon";n.APP_HACKATHON=g;const v="app_employee";n.APP_EMPLOYEE=v;const b="app_education";n.APP_EDUCATION=b;const y="app_organization_free";n.APP_ORGANIZATION_FREE=y;const w="app_plugin_demo";n.APP_PLUGIN_DEMO=w;const x=["app_personal","app_production","app_professional","app_team",f,"app_covid",b,v,m,g,r,"app_hobby_2021",i,"app_personal_2022",s,"app_professional_2022",o,"app_production_2022",a,l,c,u,h,p,_,"forum_apps",d,"was_legacy_paid_on_2022_pricing_launch","version_control_beta_2023",y,w];n.AllPlans=x;const j=[r,i,s,o,p,f,g,m,b,"app_test_dedicated_on_main",h,"forum_apps",d,"app_covid",v,"version_control_beta_2023",y,w];n.CurrentPlans=j;const A=["app_personal","app_production","app_professional","app_team"];n.UserSelectablePre2019Plans=A;const M=["personal","professional","team",...A];n.AllPre2019Plans=M;const E=["app_personal_2022","app_professional_2022","app_production_2022",_];n.PricingModel2022Plans=E;const k=[a,l,c];n.UserSelectable2023Plans=k;const O=[...k,u];n.PricingModel2023Plans=O;const S=["app_hobby_2021"];n.ExperimentalPlans=S;const D=Object.freeze([r,f,y,"app_covid","app_education","app_employee","app_hackathon","app_instructor","forum_apps",d,w,...O]);n.DO_NOT_MARK_AS_LEGACY=D;const C=Object.freeze([p,u]);n.ENTERPRISE_PLANS=C;const T="was_legacy_paid_on_2022_pricing_launch";n.LEGACY_PAID_ON_2022_PRICING_LAUNCH=T;const N=Object.freeze([i,s,o]);n.LEGACY_2019_PLANS=N},{"core-js/modules/web.dom-collections.iterator.js":1123}],48:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.WARNING_NAME_METADATA_RELATION=n.USAGE_PLAN_METADATA_KEY=n.USAGE_LIMIT_50_WEEK_OLD_ACTON=n.USAGE_LIMIT_50=n.USAGE_LIMIT_100_REMINDER=n.USAGE_LIMIT_100_END_OF_GRACE_PERIOD=n.USAGE_LIMIT_100=n.USAGE_FROM_ABOVE_THE_CAP_RESET=n.USAGE_FROM_ABOVE_THE_CAP_CONVERT=n.UPGRADE_PLAN_90_REMINDER=n.UNKNOWN_VALUE_PLACEHOLDER=n.SCHEDULE_DAILY_USER_DB_SIZE=n.SCHEDULE_APP_MONTHLY_USAGE=n.REDIS_MONTHLY_LOCK_FLAG_TTL=n.REDIS_MONTHLY_LOCK_FLAG_ATTEMPT_TTL=n.REDIS_DAILY_USER_DB_SIZE_LOCK_FLAG_TTL=n.REDIS_BILLED_LOCK_FLAG_TTL=n.PRICING_FLAG_METADATA_KEY=n.NOTIFICATION_SPACE_PERIOD=n.GRACE_PERIOD_AFTER_REMINDER=n.DB_LIMIT_50=n.DB_LIMIT_100=n.DAILY_USER_DB_SIZE_SCHEDULE_WINDOW_IN_MINUTES=void 0;n.redis_billed_app_usage_key=h;n.redis_monthly_usage_attempt_schedule_key=u;n.redis_monthly_usage_key=c;var r=s(e("./time"));function i(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(i=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=i(t);if(n&&n.has(e)){return n.get(e)}var r={};var s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;if(a&&(a.get||a.set)){Object.defineProperty(r,o,a)}else{r[o]=e[o]}}}r.default=e;if(n){n.set(e,r)}return r}const o="schedule_app_monthly_usage";n.SCHEDULE_APP_MONTHLY_USAGE=o;const a="schedule_daily_user_db_size";n.SCHEDULE_DAILY_USER_DB_SIZE=a;const l=90;n.DAILY_USER_DB_SIZE_SCHEDULE_WINDOW_IN_MINUTES=l;function c(e,t,n){return`app_monthly_usage2_${e}_${t}_${n}`}function u(e,t,n){return`app_monthly_usage_attempt_schedule_${e}_${t}_${n}`}const d=33*r.DAY_MS;n.REDIS_MONTHLY_LOCK_FLAG_TTL=d;const p=5*r.MINUTE_MS;n.REDIS_MONTHLY_LOCK_FLAG_ATTEMPT_TTL=p;const _=2*r.DAY_MS;n.REDIS_DAILY_USER_DB_SIZE_LOCK_FLAG_TTL=_;const f=2*r.DAY_MS;n.REDIS_BILLED_LOCK_FLAG_TTL=f;function h(e,t,n){return`billed_app_monthly_usage_${e}_${t}_${n}`}const m=r.WEEK_MS;n.NOTIFICATION_SPACE_PERIOD=m;const g=3*r.DAY_MS;n.GRACE_PERIOD_AFTER_REMINDER=g;const v="usage_warning_name";n.WARNING_NAME_METADATA_RELATION=v;const b="usage_limit_50";n.USAGE_LIMIT_50=b;const y="usage_limit_100";n.USAGE_LIMIT_100=y;const w=`${y}_reminder`;n.USAGE_LIMIT_100_REMINDER=w;const x=`${y}_end_of_grace_period`;n.USAGE_LIMIT_100_END_OF_GRACE_PERIOD=x;const j="90_pct_upgrade_plan_reminder_email";n.UPGRADE_PLAN_90_REMINDER=j;const A="db_limit_50";n.DB_LIMIT_50=A;const M="db_limit_100";n.DB_LIMIT_100=M;const E=b+"_week_old";n.USAGE_LIMIT_50_WEEK_OLD_ACTON=E;const k="from_above_the_cap_convert";n.USAGE_FROM_ABOVE_THE_CAP_CONVERT=k;const O="from_above_the_cap_reset";n.USAGE_FROM_ABOVE_THE_CAP_RESET=O;const S="usage_plan";n.USAGE_PLAN_METADATA_KEY=S;const D="app_plan_pricing_flag";n.PRICING_FLAG_METADATA_KEY=D;const C="";n.UNKNOWN_VALUE_PLACEHOLDER=C},{"./time":92,"core-js/modules/web.dom-collections.iterator.js":1123}],49:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.SPECIAL_APPS=void 0;var r=s(e("./app_plans"));function i(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(i=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=i(t);if(n&&n.has(e)){return n.get(e)}var r={};var s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;if(a&&(a.get||a.set)){Object.defineProperty(r,o,a)}else{r[o]=e[o]}}}r.default=e;if(n){n.set(e,r)}return r}const o={blocked:false,editable:false,forkable:false,hard_code:false,meta:false,no_issue_checker:false,test:false};const a={coffeesearcher:{...o,editable:true,forkable:true,hard_code:true},countrycity:{...o,editable:true,forkable:true,hard_code:true},cutepuppy:{...o,editable:true,forkable:true,hard_code:true},demo:{...o,editable:true,hard_code:true,no_issue_checker:true},empty_template:{...o,hard_code:true},findatrainer:{...o,editable:true,forkable:true,hard_code:true},g2_iphone_test:{...o,no_issue_checker:true},itunessearcher:{...o,editable:true,forkable:true,hard_code:true},launchpage:{...o,editable:true,forkable:true,hard_code:true},learn:{...o,editable:true,hard_code:true,no_issue_checker:true},lostandfound:{...o,editable:true,forkable:true,hard_code:true},meta:{...o,meta:true,plan:r.DEFAULT_DEDICATED_PLAN},meta_dedicated:{...o,hard_code:true,meta:true},meta_public:{...o,editable:true,forkable:true,hard_code:true,meta:true},microbloggingapp:{...o,editable:true,forkable:true,hard_code:true},template:{...o,hard_code:true},template_live:{...o,hard_code:true},template_new_responsive:{...o,hard_code:true},test_app:{...o,hard_code:true,no_issue_checker:true,plan:r.TEST_PLAN,test:true},test_app_editor:{...o,hard_code:true,no_issue_checker:true,plan:r.TEST_PLAN,test:true},test_app2:{...o,hard_code:true,no_issue_checker:true,plan:r.TEST_PLAN,test:true},test_app_plugins:{...o,hard_code:true,plan:r.TEST_PLAN,test:true},test_app_education:{...o,hard_code:true,plan:r.APP_EDUCATION,test:true},test_app_internal:{...o,hard_code:true,plan:"app_production_2019",test:true},test_app_elements:{...o,hard_code:true,no_issue_checker:false,plan:r.TEST_PLAN,test:true},test_app_cycles:{...o,hard_code:true,no_issue_checker:false,plan:r.TEST_PLAN,test:true},derived_test:{...o,hard_code:true,test:true},todomvcapp:{...o,editable:true,forkable:true,hard_code:true},tour:{...o,editable:true,hard_code:true,no_issue_checker:true},airbnbclonetemplate:{...o,blocked:true},bubblewits1:{...o,blocked:true},bubblewits2:{...o,blocked:true},bubblewits3:{...o,blocked:true},spam:{...o,blocked:true},trello:{...o,blocked:true},yelpclone:{...o,blocked:true}};n.SPECIAL_APPS=a},{"./app_plans":47,"core-js/modules/web.dom-collections.iterator.js":1123}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.WRONG_PASSWORD=n.WORKOS_AUTH_URL=n.NO_SUCH_USER=n.INVALID_LOGIN_CREDENTIALS=n.EMPLOYEE_ACCESSING_ORGANIZATION_FREE_APP=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/auth",n);const s="INVALID_LOGIN_CREDENTIALS";n.INVALID_LOGIN_CREDENTIALS=s;const o="NO_SUCH_USER";n.NO_SUCH_USER=o;const a="WRONG_PASSWORD";n.WRONG_PASSWORD=a;const l="EMPLOYEE_ACCESSING_ORGANIZATION_FREE_APP";n.EMPLOYEE_ACCESSING_ORGANIZATION_FREE_APP=l;const c="https://api.workos.com/sso";n.WORKOS_AUTH_URL=c},{"../safe_require":777}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.META_APPNAME_FOR_OWN_CDN=n.META_APPNAME_FOR_FILE_CDN=n.DISTINCT_BV_BUNDLES=n.BUNDLE_NAMES=n.BASE_BUNDLES=void 0;const r=["edit","run","run_debug","plugin"];n.BUNDLE_NAMES=r;const i={edit:{entrypoint:"editor.js",is_edit_mode:true},run:{entrypoint:"window.js",is_run:true},run_debug:{entrypoint:"window_debug.js",is_run:true,is_debug_mode:true},plugin:{entrypoint:"editor_plugin.js",is_edit_mode:true,is_plugin_edit_mode:true}};n.BASE_BUNDLES=i;const s=4;n.DISTINCT_BV_BUNDLES=s;const o="meta-p";n.META_APPNAME_FOR_FILE_CDN=o;const a="meta-l";n.META_APPNAME_FOR_OWN_CDN=a},{}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.STORAGE_UNITS=n.MEBIBYTE=n.KIBIBYTE=n.GIBIBYTE=void 0;const r=1024;n.KIBIBYTE=r;const i=r*r;n.MEBIBYTE=i;const s=r*i;n.GIBIBYTE=s;const o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"];n.STORAGE_UNITS=o},{}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.VAR_IDENTIFIER=n.TOKEN_NAME=n.SORTED_DEFAULT_TOKENS=n.RGB_VAR_IDENTIFIER=n.RGB_TOKEN_ALPHA=n.RGBA_TOKEN=n.MISSING_USER_COLOR_TOKEN_TEXT=n.MAX_USER_COLORS=n.DEFAULT_USER_COLOR_TOKEN_RGBA=n.DEFAULT_TOKEN_NAMES_DESCRIPTIONS=n.DEFAULT_COLOR_TOKENS=n.COLOR_VARIANTS=n.CAPTURE_ALPHA=void 0;const r={primary:{default:"rgba(2, 5, 211, 1)"},primary_contrast:{default:"rgba(255, 255, 255, 1)"},text:{default:"rgba(9, 23, 71, 1)"},surface:{default:"rgba(255, 255, 255, 1)"},background:{default:"rgba(255, 255, 255, 0)"},destructive:{default:"rgba(255, 0, 0, 1)"},success:{default:"rgba(23, 219, 78, 1)"},alert:{default:"rgba(250, 181, 21, 1)"}};n.DEFAULT_COLOR_TOKENS=r;const i="rgba(0,0,0,1)";n.DEFAULT_USER_COLOR_TOKEN_RGBA=i;const s="Custom color (MISSING)";n.MISSING_USER_COLOR_TOKEN_TEXT=s;const o=/var\(--color_[^)]*\)/g;n.RGBA_TOKEN=o;const a=/rgba\(var\(--color_[^)]*\),[^)]*\)/g;n.RGB_TOKEN_ALPHA=a;const l=/var\(--color_([^)]*)\)/;n.TOKEN_NAME=l;const c=/rgba\((?<base>.*), ?(?<opacity>[0-9.]+)\)/;n.CAPTURE_ALPHA=c;const u=24;n.MAX_USER_COLORS=u;const d="var(";n.VAR_IDENTIFIER=d;const p="_rgb";n.RGB_VAR_IDENTIFIER=p;const _=["default"];n.COLOR_VARIANTS=_;const f=["primary","primary_contrast","text","surface","background","destructive","success","alert"];n.SORTED_DEFAULT_TOKENS=f;const h={primary:{name:"Primary",description:"Color for any primary buttons, actions, or hover treatment for clickable elements."},primary_contrast:{name:"Primary contrast",description:"Color of text and icons in a primary button."},text:{name:"Text",description:"Color of static text and icons."},surface:{name:"Surface",description:"Background color for containers."},background:{name:"Background",description:"Background color for pages and page sections."},destructive:{name:"Destructive",description:"Indicates major errors, deleting, and negative values."},success:{name:"Success",description:"Indicates a successful action the user has taken, or positive numerical values."},alert:{name:"Alert",description:"Caution color that notifies a user there is an action to take."}};n.DEFAULT_TOKEN_NAMES_DESCRIPTIONS=h},{}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.FINITE_OPTION_INPUT_TYPES=n.COMPOSER_INPUT_TYPES_WITH_TYPEAHEAD=n.COMPOSER_INPUT_TYPES=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/composer",n);let s=function(e){e["REAL_TIME_SEARCH"]="real_time_search";e["BOOLEAN"]="boolean";e["NUMBER"]="number";e["INTEGER"]="integer";e["TEXT"]="text";e["KEY_COMBINATION"]="key_combination";e["GEOGRAPHIC_ADDRESS"]="geographic_address";e["ENUMERATED"]="enumerated";return e}({});n.COMPOSER_INPUT_TYPES=s;const o=new Set([s.REAL_TIME_SEARCH,s.BOOLEAN,s.NUMBER,s.INTEGER,s.TEXT]);n.COMPOSER_INPUT_TYPES_WITH_TYPEAHEAD=o;const a=new Set([s.ENUMERATED,s.REAL_TIME_SEARCH]);n.FINITE_OPTION_INPUT_TYPES=a},{"../safe_require":777,"core-js/modules/web.dom-collections.iterator.js":1123}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.SLOW_RANDOM_LENGTH=n.LEGACY_PARAM_ID=n.DROPDOWN_DESCRIPTION_CONTEXT=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/core",n);const s="DROPDOWN_OPTIONS";n.DROPDOWN_DESCRIPTION_CONTEXT=s;const o="_LEGACY_";n.LEGACY_PARAM_ID=o;const a=1e5;n.SLOW_RANDOM_LENGTH=a},{"../safe_require":777}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.legacy_currency_symbols=n.currency_symbols=void 0;e("core-js/modules/web.dom-collections.iterator.js");const r={dollar:"$",euro:"",pound:"",yen:"",rand:"R",naira:"",won:"",peso:"",bgn:""};n.legacy_currency_symbols=r;const i=[".","."];const s=[...Object.values(r),...i,"kr",""];n.currency_symbols=s},{"core-js/modules/web.dom-collections.iterator.js":1123}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ON_ELEMENT_LIST=n.ON_ELEMENT=n.GROUP_TYPES=void 0;const r={Group:"Group",Popup:"Popup",FloatingGroup:"Floating Group"};n.GROUP_TYPES=r;const i={includes:e=>s.includes(e)||e.startsWith("param_")};n.ON_ELEMENT=i;const s=["lock_in_editor","is_visible","top","left","zindex","data_source","custom_id","greyout_color","greyout_blur","responsive_alignment","prevent_user_from_closing_through_esc","collapse_margin","fixed_width","min_width","use_max_width","max_width","responsive_show","responsive_show_width","width","height","floating_reference","floating_reference_horizontal","unique_id","floating_reference_horizontal_resp","float_zindex","parallax","nonant_alignment","vert_alignment","horiz_alignment","order","collapse_when_hidden","collapse_animation","animation_type","single_width","min_width_css","max_width_css","fit_width","single_height","min_height_css","max_height_css","fit_height","margin_left","margin_right","margin_top","margin_bottom","overflow_scroll"];n.ON_ELEMENT_LIST=s},{}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.range_states=n.SUPPORTED_AGGREGATIONS=n.RetryError=n.REDIS_ONLY=n.REDIS_AND_POSTGRES=n.POSTGRES_AUTOINDEX_KEY=n.NO_USER=n.NO_SEARCH_PATH=n.NO_DB_CONSTRAINTS=n.NON_AUTHENTICATED_USER_ID=n.MAX_SEARCH_CHUNK=n.MAX_GROUPING_CALL=n.DONT_KNOW=n.DATA_PANEL_SEARCH_FAKE_EVAL_NODE=n.CALENDAR_GROUPINGS=n.BUCKET_GROUPINGS=n.BATCH_SIZE=n.ARCHIVED_DB_COUNT=n.ALL_MAX=n.ADMIN_USER_ID=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/db",n);const s="no_user";n.NO_USER=s;const o="no_search_path";n.NO_SEARCH_PATH=o;const a="admin_user";n.ADMIN_USER_ID=a;const l="non_authenticated_user";n.NON_AUTHENTICATED_USER_ID=l;const c="<data admin panel>";n.DATA_PANEL_SEARCH_FAKE_EVAL_NODE=c;const u=400;n.MAX_SEARCH_CHUNK=u;const d="dontknow";n.DONT_KNOW=d;const p=100;n.MAX_GROUPING_CALL=p;const _=["list.date_range","list.number_range","list.geographic_address"];n.NO_DB_CONSTRAINTS=_;const f=["count","sum","product","average","median","min","max"];n.SUPPORTED_AGGREGATIONS=f;const h=["day","month"];n.CALENDAR_GROUPINGS=h;const m=["bucket","day","month"];n.BUCKET_GROUPINGS=m;const g=1e12;n.ALL_MAX=g;const v=-2;n.ARCHIVED_DB_COUNT=v;let b=function(e){e["LOADING"]="loading";e["AVAILABLE"]="available";e["ERROR"]="error";e["NOT_STARTED"]="not_started";e["DELETED"]="deleted";e["PAST_END"]="past_end";return e}({});n.range_states=b;const y=class e{};n.RetryError=y;const w="redis-only";n.REDIS_ONLY=w;const x="redis-and-postgres";n.REDIS_AND_POSTGRES=x;const j=100;n.BATCH_SIZE=j;const A="postgres_auto_index";n.POSTGRES_AUTOINDEX_KEY=A},{"../safe_require":777}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.OLD_META_HOSTNAME=n.META_ORIGIN=n.META_HOSTNAME=n.LOCAL_HOSTNAME=n.BLOG_URL=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/domain",n);const s="bubble.io";n.META_HOSTNAME=s;const o="https://bubble.io";n.META_ORIGIN=o;const a="bubble.is";n.OLD_META_HOSTNAME=a;const l="local.bubble.is";n.LOCAL_HOSTNAME=l;const c=`https://${s}/blog/`;n.BLOG_URL=c},{"../safe_require":777}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.PUBLIC_ACTIVE_EXPERIMENTS=n.MAX_FILE_COMPOSER_SIZE=n.LEGACY_EXPERIMENTS=n.FEATURE_FLAGS_PATH=n.DEPRECATED_EXPERIMENTS=void 0;var r=e("../constants/byte");const i=50*r.MEBIBYTE;n.MAX_FILE_COMPOSER_SIZE=i;const s="feature_flags.";n.FEATURE_FLAGS_PATH=s;const o={parens:{display:"Expression parentheses",description:"Automatically add parentheses to all dynamic expressions in the editor. Makes Current Page Width +2 *3 display as (Current Page Width + 2) * 3. This feature lets you add to any part of a dynamic expression, and indicate where to apply a piece of a dynamic expression.",launch_date:1650973876351,modification_date:1650973876351,alters_app_json:true},reference_snippet:{display:"Show snippets of the reference on hover",description:"When hovering any feature in the editor, show the beginning of the manual entry.",launch_date:1650973876351,modification_date:1650973876351,alters_app_json:false},reorg_component_selection:{display:"Categorized types, datasources and operators",description:"When creating expressions, select from a categorized list of datasources and operators. When selecting a type in general, select from a categorized list.",launch_date:168002638e4,modification_date:1688662721e3,alters_app_json:false},defer_edit_mode:{display:"Edit-mode deferred element rendering",description:"This feature optimizes memory usage and performance of the editor by not drawing elements which are hidden. "+"For large single-page apps with a lot of hidden groups, this should drastically speed up editor load and reduce memory usage."+"\n\nNote: This feature only affects new responsive pages.",launch_date:1685639139880,modification_date:1685639139880,alters_app_json:false},defer_element_instances:{display:"Run-mode page-load optimization",description:"In run-mode, this optimization prevents us from allocating more memory than necessary for hidden elements. "+"Although we already defer creation of DOM nodes, this prevents us from allocating internal state until it is requested."+"\n\nNote: This feature only affects new responsive pages, and for the apps on at least BV 21.",launch_date:1686676558984,modification_date:1686676558984,alters_app_json:false}};n.PUBLIC_ACTIVE_EXPERIMENTS=o;const a=["deferred_drawing","tz_info_in_date_input","react_upgrade"];n.LEGACY_EXPERIMENTS=a;const l={timezone_improvements:{display:"Overriding timezones more broadly (deprecated)",description:"This feature set allows you to set an overriding timezone for any page, "+"any backend workflow (API workflow, recurring event, and database trigger event), "+"and when using the :rounding to operator.",launch_date:1657566861888,modification_date:1657566861888,alters_app_json:false,has_been_previously_used:false,deprecation_bv:20,test_app_exceptions:["test_app_elements"]},react_upgrade:{display:"New, more performant elements rendering (deprecated)",description:"This feature enables a new experimental rendering pipeline which more optimally "+"renders any elements you have on the page. It does so by precomputing a lot of the properties "+"on the server beforehand, and shipping a static CSS file to the client to avoid repeated work. "+"\n\nNote: This feature only affects new responsive pages.",launch_date:1659456830513,modification_date:1659456830513,alters_app_json:false,deprecation_bv:21}};n.DEPRECATED_EXPERIMENTS=l},{"../constants/byte":52}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.VERSION_STYLE_OVERRIDES=n.STATE_NOT_READY=n.PLACEHOLDER_COLOR_VERSION=n.PADDING_VERSION=n.OLD_VERSION_OVERRIDE_PROPERTIES=n.NOT_STATIC_PROP=n.LATEST_ELEMENT_VERSION=n.FONT_FAMILY_VERSION=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/elements",n);const s=4;n.LATEST_ELEMENT_VERSION=s;const o=4;n.VERSION_STYLE_OVERRIDES=o;const a=["padding_top","padding_bottom","padding_left","padding_right"];n.OLD_VERSION_OVERRIDE_PROPERTIES=a;const l=1;n.FONT_FAMILY_VERSION=l;const c=Symbol("NOT_STATIC_PROP");n.NOT_STATIC_PROP=c;const u={};n.STATE_NOT_READY=u;const d=2;n.PADDING_VERSION=d;const p=3;n.PLACEHOLDER_COLOR_VERSION=p},{"../safe_require":777}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.QA=n.PROD=n.LOCAL=n.DEV=n.ALL=void 0;const r="prod";n.PROD=r;const i="local";n.LOCAL=i;const s="qa";n.QA=s;const o="dev";n.DEV=o;const a=[r,i,s,o];n.ALL=a},{}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.SPANS=n.EPOCHS=void 0;const r={drawing:"Drawing",network:"Network"};const i={load_runmode:{name:"Epoch: Runmode page fully loaded",start_at_page_load:true},load_editor:{name:"Epoch: Editor page fully loaded",start_at_page_load:true},load_maison:{name:"Epoch: Editor Maison page fully loaded",start_at_page_load:true}};n.EPOCHS=i;const s={render:{name:"Client: render complete",type:r.drawing,start_at_page_load:true,sync:false},data_retrieval:{name:"Client: data retrieval",type:r.network,sync:false,start_at_page_load:false},autorun_scheduled:{name:"Client: Autorun run_scheduled",type:r.drawing,sync:false,start_at_page_load:false},page_draw:{name:"Client: page.draw()",type:r.drawing,sync:true,start_at_page_load:false},rg_display_data_in_cells:{name:"Client: RepeatingGroup display_data_in_cells",type:r.drawing,sync:true,start_at_page_load:false},rg_add_cells:{name:"Client: RepeatingGroup add_cells",type:r.drawing,sync:true,start_at_page_load:false}};n.SPANS=s},{}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.NV_MARKER=n.NULL_VALUE_TO_REGISTER=n.HYDRATE_STRING=n.EVAL_TYPE=n.ESTATE_PREFIX=n.ELEMENT_INSTANCE_DEHYDRATE=void 0;const r="1348695171700984260__LOOKUP__";n.HYDRATE_STRING=r;const i="ElementInstance";n.ELEMENT_INSTANCE_DEHYDRATE=i;const s="ElementState:";n.ESTATE_PREFIX=s;const o="not_valid_1431708660335x963720156345516400";n.NV_MARKER=o;const a={};n.NULL_VALUE_TO_REGISTER=a;let l=function(e){e["value"]="VALUE";e["thunk"]="THUNK";e["skip"]="SKIP";return e}({});n.EVAL_TYPE=l},{}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.VISUAL_INDICATORS_ON_ELEMENTS_VARIANT_ID=n.VISUAL_INDICATORS_ON_ELEMENTS_ID=n.TREATMENT_VARIANT_ID=n.RUN_ONCE_TIMEOUT=n.REALTIME_METRICS_VARIANT_ID=n.REALTIME_METRICS_AMPLITUDE_ID=n.PROPERTY_EDITOR_WORKFLOW_AND_DATA_ONBOARDING_ID=n.PAYWALL_PRE_SELECT_PLAN_VARIANT_ID=n.PAYWALL_PRE_SELECT_PLAN_ID=n.PAYLOAD_KEY_EXPERIMENT_START_DATE=n.ON_VARIANT_ID=n.ONBOARDING_CHECKLIST_IN_EDITOR_ID=n.NEW_PRICING_PLAN_CHARTS_VARIANT_ID=n.NEW_PRICING_PLAN_CHARTS_ID=n.NEW_APP_EDITOR_FREE_TRIAL_POP_UP_VARIANT_ID=n.NEW_APP_EDITOR_FREE_TRIAL_POP_UP_AMPLITUDE_ID=n.IN_EDITOR_CHATBOT_ID=n.GUIDED_BUILD_SIGN_UP_VARIANT_ID=n.GUIDED_BUILD_SIGN_UP=n.GUIDED_BUILD_EDITOR_INTRO_VARIANT_ID=n.GUIDED_BUILD_EDITOR_INTRO=n.FREE_TRIAL_VARIANT_LENGTHS=n.FREE_TRIAL_LENGTH_VARIANT_2_ID=n.FREE_TRIAL_LENGTH_VARIANT_1_ID=n.FREE_TRIAL_LENGTH_ID=n.EDITOR_EXPERIMENTS=n.CTAS_3_0_AMPLITUDE_ID=n.BUBBLE_FRAMEWORK_EXPERIMENTS=void 0;const r=120;n.RUN_ONCE_TIMEOUT=r;const i="treatment";n.TREATMENT_VARIANT_ID=i;const s="on";n.ON_VARIANT_ID=s;const o="experiment_start_date";n.PAYLOAD_KEY_EXPERIMENT_START_DATE=o;const a="ctas-3-0-draft-state";n.CTAS_3_0_AMPLITUDE_ID=a;const l="g43";n.FREE_TRIAL_LENGTH_ID=l;const c=1;n.FREE_TRIAL_LENGTH_VARIANT_1_ID=c;const u=2;n.FREE_TRIAL_LENGTH_VARIANT_2_ID=u;const d=[14,30,7];n.FREE_TRIAL_VARIANT_LENGTHS=d;const p="h15";n.GUIDED_BUILD_EDITOR_INTRO=p;const _=i;n.GUIDED_BUILD_EDITOR_INTRO_VARIANT_ID=_;const f="guided-build-sign-up";n.GUIDED_BUILD_SIGN_UP=f;const h=i;n.GUIDED_BUILD_SIGN_UP_VARIANT_ID=h;const m="h16";n.IN_EDITOR_CHATBOT_ID=m;const g="new-app-editor-free-trial-pop-up";n.NEW_APP_EDITOR_FREE_TRIAL_POP_UP_AMPLITUDE_ID=g;const v=i;n.NEW_APP_EDITOR_FREE_TRIAL_POP_UP_VARIANT_ID=v;const b="metrics-round";n.NEW_PRICING_PLAN_CHARTS_ID=b;const y=s;n.NEW_PRICING_PLAN_CHARTS_VARIANT_ID=y;const w="h17";n.ONBOARDING_CHECKLIST_IN_EDITOR_ID=w;const x="paywall-pre-select-plan";n.PAYWALL_PRE_SELECT_PLAN_ID=x;const j=i;n.PAYWALL_PRE_SELECT_PLAN_VARIANT_ID=j;const A="h13";n.PROPERTY_EDITOR_WORKFLOW_AND_DATA_ONBOARDING_ID=A;const M="real-time-metrics";n.REALTIME_METRICS_AMPLITUDE_ID=M;const E=s;n.REALTIME_METRICS_VARIANT_ID=E;const k="h14";n.VISUAL_INDICATORS_ON_ELEMENTS_ID=k;const O=i;n.VISUAL_INDICATORS_ON_ELEMENTS_VARIANT_ID=O;const S={[l]:{name:"Experiment to test new free trial length",numGroups:3,isActive:false,isAmplitude:false}};n.BUBBLE_FRAMEWORK_EXPERIMENTS=S;const D={[a]:{name:"Emphasize CTAs more and allow editing of all paid features before upgrade",numGroups:2,isAmplitude:true},[p]:{name:"DWD: Editor intro videos",numGroups:2,isAmplitude:true},[f]:{name:"Test effect of a guided builds on sign up rates",numGroups:2,isAmplitude:true},[m]:{name:"In-editor Chatbot",numGroups:2,isAmplitude:true},[g]:{name:"Experiment to test new free trial popup for new app editors",numGroups:2,isAmplitude:true},[b]:{name:"Experiment to test new pricing plan charts",numGroups:2,isAmplitude:true},[x]:{name:"Experiment to test the success of pre-selecting a plan on the paywall for them",numGroups:2,isAmplitude:true},[A]:{name:"DWD: Help users understand when they need workflows or data for a component",numGroups:2,isAmplitude:true},[k]:{name:"Experiment (and feature flag) to test effects of visual indicators on elements",numGroups:2,isAmplitude:true},[w]:{name:"Experiment to test effects of onboarding checklist in editor",numGroups:2,isAmplitude:true},[M]:{name:"Feature flag for realtime metrics",numGroups:2,isAmplitude:true}};const C={...S,...D};n.EDITOR_EXPERIMENTS=C},{}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.EMPTY_RAW_STRUCT_ID_ENDING=void 0;const r="__bubble_originally_empty";n.EMPTY_RAW_STRUCT_ID_ENDING=r},{}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.WORKFLOW=n.SYSTEM_FIBER=n.SERVICEHOSTER=n.RUN_DATA_TRIGGER_WORKFLOW=n.RUNNING_TASK=n.QUEUE_TIMEOUT=n.PERCOLATE_FIBER=n.PAGE=n.PACKAGE=n.FiberTag=n.FILE_UPLOAD=n.ELASTICSEARCH=n.API_SERVICE=n.API=void 0;var r=e("./routes");const i="Operation timed out -- app too busy";n.QUEUE_TIMEOUT=i;const s="SYSTEM_FIBER";n.SYSTEM_FIBER=s;const o="servicehoster";n.SERVICEHOSTER=o;const a="running_task";n.RUNNING_TASK=a;const l="run_data_trigger_workflow";n.RUN_DATA_TRIGGER_WORKFLOW=l;const c="percolate_fiber";n.PERCOLATE_FIBER=c;let u=function(e){e["Appname"]="appname";e["AppVersion"]="app_version";e["APIEndpoint"]="api_endpoint";e["AppEditorPath"]="appeditor_path";e["CSVFileName"]="csv_file_name";e["EServiceCommand"]="eservice_command";e["ExternalAPIID"]="external_api_id";e["PageName"]="page_name";e["Path"]="path";e["SearchPath"]="search_path";e["Service"]="service";e["SchedulerName"]="scheduler_name";e["SyncRun"]="syncrun";e["UserAppname"]="user_appname";e["UserAppVersion"]="user_app_version";e["WorkflowItem"]="workflow_item";e["WorkflowID"]="workflow_id";e["WorkflowActionID"]="workflow_action_id";e["WorkflowConditionEvaluation"]="workflow_condition_evaluation";e["APINetworkOperation"]="api_network_operation";return e}({});n.FiberTag=u;const d="page";n.PAGE=d;const p=r.PACKAGER_ROUTE;n.PACKAGE=p;const _=r.FILEUPLOAD_ROUTE;n.FILE_UPLOAD=_;const f=r.WORKFLOW_ROUTE;n.WORKFLOW=f;const h=r.DATA_ROUTE;n.ELASTICSEARCH=h;const m=r.API_SERVICE_ROUTE;n.API_SERVICE=m;const g=r.API_ROUTE;n.API=g},{"./routes":82}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.TOKEN_NAMES=n.TOKEN_DESCRIPTIONS=n.SPECIAL_DISPLAY=n.NAMED_WEIGHTS=n.MISSING_USER_FONT_TOKEN_TEXT=n.MAX_USER_FONTS=n.FONT_VARIANTS=n.FONT_TOKEN_NAME_AND_WEIGHT=n.FONT_STYLE_LIST=n.DEFAULT_WEIGHT=n.DEFAULT_TOKENS=n.DEFAULT_FONT=n.DEFAULT_FAMILY=n.DEFAULT_CSS_TOKEN=n.CUSTOM_FONT_FLAG=n.ALL_WEIGHTS=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/fonts",n);const s="Lato:::";n.DEFAULT_FONT=s;const o="Lato";n.DEFAULT_FAMILY=o;const a="400";n.DEFAULT_WEIGHT=a;const l=["100","200","300","400","500","600","700","800","900"];n.ALL_WEIGHTS=l;const c={regular:"400",bold:"700"};n.NAMED_WEIGHTS=c;let u=function(e){e["default"]="App Font";return e}({});n.TOKEN_NAMES=u;let d=function(e){e["default"]="Applied to all elements using App Font as their font family in styles.";return e}({});n.TOKEN_DESCRIPTIONS=d;let p=function(e){e["default"]="Lato";return e}({});n.DEFAULT_TOKENS=p;const _=":::custom";n.CUSTOM_FONT_FLAG=_;const f=7;n.MAX_USER_FONTS=f;const h="Custom font (MISSING)";n.MISSING_USER_FONT_TOKEN_TEXT=h;const m="var(--font_default)";n.DEFAULT_CSS_TOKEN=m;const g=/var\(--font_(.*)\)(.*)/;n.FONT_TOKEN_NAME_AND_WEIGHT=g;const v=["default"];n.FONT_VARIANTS=v;const b={100:"100 (Thin)",200:"200 (Extra Light)",300:"300 (Light)",400:"400 (Regular)",500:"500 (Medium)",600:"600 (Semi Bold)",700:"700 (Bold)",800:"800 (Extra Bold)",900:"900 (Black)"};n.SPECIAL_DISPLAY=b;const y=["bold","italic","underline"];n.FONT_STYLE_LIST=y},{"../safe_require":777}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.SERVER_SIDE_MAX_REQUEST_PER_MINUTE=n.SAMPLE_VALUE_FRANCE=n.SAMPLE_VALUE=n.MAP_MAX_REQUEST_PER_MINUTE=n.GEOHASH_PRECISION=n.AUTOCOMPLETE_SERVER_SIDE_MAX_REQUEST_PER_MINUTE=void 0;const r={lat:40.72743,lng:-74.00595,address:"175 Varick Street, New York, NY 10014, USA",components:{"street number":"175",street:"Varick Street",neighborhood:"Lower Manhattan",city:"New York","state code":"NY",state:"New York",county:"New York County","zip code":"10014",country:"United States","country code":"US"}};n.SAMPLE_VALUE=r;const i={lat:49.19973,lng:.21102,address:"Coquainvilliers, France",components:{city:"Coquainvilliers","state code":"Lower Normandy",state:"Lower Normandy",country:"France","country code":"FR"}};n.SAMPLE_VALUE_FRANCE=i;const s=2;n.MAP_MAX_REQUEST_PER_MINUTE=s;const o=6;n.SERVER_SIDE_MAX_REQUEST_PER_MINUTE=o;const a=12;n.AUTOCOMPLETE_SERVER_SIDE_MAX_REQUEST_PER_MINUTE=a;const l=15;n.GEOHASH_PRECISION=l},{}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ICONS_CONTENT=void 0;const r={"fa-superscript":"","fa-delicious":"","fa-bathtub":"","fa-s15":"","fa-bath":"","fa-podcast":"","fa-hdd-o":"","fa-vcard-o":"","fa-address-card-o":"","fa-odnoklassniki":"","fa-openid":"","fa-joomla":"","fa-neuter":"","fa-angle-double-up":"","fa-deviantart":"","fa-sliders":"","fa-viadeo-square":"","fa-lock":"","fa-quora":"","fa-safari":"","fa-drivers-license":"","fa-id-card":"","fa-circle":"","fa-bus":"","fa-glide":"","fa-bold":"","fa-flag":"","fa-search-plus":"","fa-hotel":"","fa-bed":"","fa-linode":"","fa-trash":"","fa-snapchat-ghost":"","fa-cny":"","fa-rmb":"","fa-yen":"","fa-jpy":"","fa-subscript":"","fa-battery-4":"","fa-battery":"","fa-battery-full":"","fa-thumbs-o-up":"","fa-tint":"","fa-user-md":"","fa-tripadvisor":"","fa-bitcoin":"","fa-btc":"","fa-file-word-o":"","fa-refresh":"","fa-cc-diners-club":"","fa-sort-alpha-desc":"","fa-mortar-board":"","fa-graduation-cap":"","fa-mars-double":"","fa-text-width":"","fa-shopping-cart":"","fa-minus-circle":"","fa-compass":"","fa-twitter-square":"","fa-genderless":"","fa-leaf":"","fa-arrows-h":"","fa-window-maximize":"","fa-hand-o-down":"","fa-free-code-camp":"","fa-arrow-circle-o-down":"","fa-hand-lizard-o":"","fa-asterisk":"","fa-modx":"","fa-pie-chart":"","fa-square-o":"","fa-magic":"","fa-qrcode":"","fa-yahoo":"","fa-gears":"","fa-cogs":"","fa-spotify":"","fa-bullseye":"","fa-twitch":"","fa-signal":"","fa-user-secret":"","fa-check-square":"","fa-spoon":"","fa-cloud":"","fa-calculator":"","fa-camera":"","fa-video-camera":"","fa-gift":"","fa-hourglass-2":"","fa-hourglass-half":"","fa-mercury":"","fa-street-view":"","fa-chevron-circle-left":"","fa-edit":"","fa-pencil-square-o":"","fa-terminal":"","fa-dashcube":"","fa-github-alt":"","fa-volume-off":"","fa-headphones":"","fa-hourglass-o":"","fa-train":"","fa-send-o":"","fa-paper-plane-o":"","fa-subway":"","fa-500px":"","fa-random":"","fa-expand":"","fa-beer":"","fa-thumb-tack":"","fa-shirtsinbulk":"","fa-map-o":"","fa-fa":"","fa-font-awesome":"","fa-chevron-left":"","fa-hand-grab-o":"","fa-hand-rock-o":"","fa-slideshare":"","fa-cc-stripe":"","fa-play-circle":"","fa-eercast":"","fa-wheelchair":"","fa-slack":"","fa-automobile":"","fa-car":"","fa-opencart":"","fa-scribd":"","fa-remove":"","fa-close":"","fa-times":"","fa-object-group":"","fa-lastfm":"","fa-smile-o":"","fa-object-ungroup":"","fa-cloud-upload":"","fa-align-right":"","fa-i-cursor":"","fa-circle-thin":"","fa-comment":"","fa-recycle":"","fa-wikipedia-w":"","fa-soccer-ball-o":"","fa-futbol-o":"","fa-cc-paypal":"","fa-arrows-alt":"","fa-turkish-lira":"","fa-try":"","fa-venus":"","fa-chevron-up":"","fa-map":"","fa-flickr":"","fa-bookmark-o":"","fa-user":"","fa-handshake-o":"","fa-y-combinator-square":"","fa-yc-square":"","fa-hacker-news":"","fa-arrow-circle-up":"","fa-angle-left":"","fa-hand-peace-o":"","fa-building":"","fa-envelope-open":"","fa-legal":"","fa-gavel":"","fa-moon-o":"","fa-play-circle-o":"","fa-thermometer-1":"","fa-thermometer-quarter":"","fa-level-up":"","fa-mail-reply-all":"","fa-reply-all":"","fa-folder":"","fa-copy":"","fa-files-o":"","fa-mouse-pointer":"","fa-paperclip":"","fa-hand-o-left":"","fa-github":"","fa-exclamation":"","fa-yc":"","fa-y-combinator":"","fa-flask":"","fa-eject":"","fa-forumbee":"","fa-hand-pointer-o":"","fa-stumbleupon-circle":"","fa-calendar-o":"","fa-stop-circle-o":"","fa-sort-amount-desc":"","fa-windows":"","fa-meh-o":"","fa-toggle-off":"","fa-xing":"","fa-server":"","fa-creative-commons":"","fa-toggle-down":"","fa-caret-square-o-down":"","fa-yoast":"","fa-toggle-up":"","fa-caret-square-o-up":"","fa-arrows-v":"","fa-gbp":"","fa-chevron-down":"","fa-underline":"","fa-print":"","fa-vimeo":"","fa-flag-o":"","fa-pagelines":"","fa-vcard":"","fa-address-card":"","fa-exclamation-circle":"","fa-user-plus":"","fa-cc-visa":"","fa-folder-open-o":"","fa-file-zip-o":"","fa-file-archive-o":"","fa-wpbeginner":"","fa-paypal":"","fa-newspaper-o":"","fa-sign-out":"","fa-bitbucket-square":"","fa-text-height":"","fa-align-center":"","fa-google-wallet":"","fa-plus-circle":"","fa-angle-double-left":"","fa-whatsapp":"","fa-question":"","fa-italic":"","fa-git-square":"","fa-opera":"","fa-arrow-circle-left":"","fa-anchor":"","fa-plug":"","fa-cubes":"","fa-yelp":"","fa-list-ul":"","fa-list-ol":"","fa-thumbs-up":"","fa-arrow-circle-o-up":"","fa-phone-square":"","fa-adjust":"","fa-volume-up":"","fa-unlock":"","fa-step-forward":"","fa-header":"","fa-drupal":"","fa-comments":"","fa-amazon":"","fa-caret-up":"","fa-fire-extinguisher":"","fa-film":"","fa-dropbox":"","fa-comment-o":"","fa-tencent-weibo":"","fa-internet-explorer":"","fa-medium":"","fa-arrow-right":"","fa-lastfm-square":"","fa-drivers-license-o":"","fa-id-card-o":"","fa-hand-o-up":"","fa-facebook-f":"","fa-facebook":"","fa-bell":"","fa-gear":"","fa-cog":"","fa-minus":"","fa-globe":"","fa-retweet":"","fa-bullhorn":"","fa-mobile-phone":"","fa-mobile":"","fa-snapchat":"","fa-sort-alpha-asc":"","fa-css3":"","fa-envira":"","fa-leanpub":"","fa-align-justify":"","fa-code-fork":"","fa-angle-double-right":"","fa-xing-square":"","fa-bookmark":"","fa-vine":"","fa-square":"","fa-stack-exchange":"","fa-houzz":"","fa-user-times":"","fa-get-pocket":"","fa-envelope":"","fa-qq":"","fa-linkedin":"","fa-glide-g":"","fa-deafness":"","fa-hard-of-hearing":"","fa-deaf":"","fa-life-bouy":"","fa-life-buoy":"","fa-life-saver":"","fa-support":"","fa-life-ring":"","fa-digg":"","fa-keyboard-o":"","fa-snowflake-o":"","fa-suitcase":"","fa-tty":"","fa-balance-scale":"","fa-ellipsis-h":"","fa-battery-3":"","fa-battery-three-quarters":"","fa-file-pdf-o":"","fa-circle-o":"","fa-pause-circle":"","fa-flag-checkered":"","fa-rotate-left":"","fa-undo":"","fa-send":"","fa-paper-plane":"","fa-cc-amex":"","fa-contao":"","fa-star-half":"","fa-google-plus-square":"","fa-indent":"","fa-angellist":"","fa-trash-o":"","fa-cart-arrow-down":"","fa-wpexplorer":"","fa-bandcamp":"","fa-music":"","fa-skype":"","fa-trello":"","fa-black-tie":"","fa-long-arrow-down":"","fa-google":"","fa-stethoscope":"","fa-caret-down":"","fa-battery-2":"","fa-battery-half":"","fa-cab":"","fa-taxi":"","fa-cc":"","fa-cc-mastercard":"","fa-commenting-o":"","fa-hashtag":"","fa-gitlab":"","fa-cc-jcb":"","fa-check":"","fa-user-circle-o":"","fa-history":"","fa-times-circle-o":"","fa-bar-chart-o":"","fa-bar-chart":"","fa-bell-slash":"","fa-clone":"","fa-briefcase":"","fa-glass":"","fa-calendar-minus-o":"","fa-arrow-left":"","fa-pencil-square":"","fa-money":"","fa-fast-forward":"","fa-bicycle":"","fa-fighter-jet":"","fa-download":"","fa-ticket":"","fa-exchange":"","fa-user-circle":"","fa-map-pin":"","fa-mars-stroke-v":"","fa-key":"","fa-imdb":"","fa-calendar-times-o":"","fa-simplybuilt":"","fa-battery-0":"","fa-battery-empty":"","fa-arrow-up":"","fa-maxcdn":"","fa-pied-piper-pp":"","fa-check-circle-o":"","fa-chevron-right":"","fa-heart":"","fa-eye":"","fa-cut":"","fa-scissors":"","fa-quote-right":"","fa-sellsy":"","fa-wechat":"","fa-weixin":"","fa-search":"","fa-comments-o":"","fa-wordpress":"","fa-sort-numeric-desc":"","fa-hand-spock-o":"","fa-gamepad":"","fa-fax":"","fa-list-alt":"","fa-youtube":"","fa-sticky-note-o":"","fa-ge":"","fa-empire":"","fa-gittip":"","fa-gratipay":"","fa-toggle-left":"","fa-caret-square-o-left":"","fa-tumblr":"","fa-stumbleupon":"","fa-tv":"","fa-television":"","fa-bell-o":"","fa-wifi":"","fa-inbox":"","fa-eyedropper":"","fa-hospital-o":"","fa-ravelry":"","fa-building-o":"","fa-fort-awesome":"","fa-shopping-bag":"","fa-address-book":"","fa-fonticons":"","fa-feed":"","fa-rss":"","fa-toggle-right":"","fa-caret-square-o-right":"","fa-microphone-slash":"","fa-git":"","fa-medkit":"","fa-line-chart":"","fa-shopping-basket":"","fa-external-link-square":"","fa-times-rectangle":"","fa-window-close":"","fa-book":"","fa-rocket":"","fa-caret-left":"","fa-wpforms":"","fa-chain":"","fa-link":"","fa-ioxhost":"","fa-quote-left":"","fa-github-square":"","fa-ban":"","fa-universal-access":"","fa-credit-card":"","fa-steam-square":"","fa-id-badge":"","fa-html5":"","fa-envelope-open-o":"","fa-file-code-o":"","fa-mail-reply":"","fa-reply":"","fa-google-plus":"","fa-youtube-play":"","fa-venus-double":"","fa-stop":"","fa-phone":"","fa-reddit-square":"","fa-reddit-alien":"","fa-product-hunt":"","fa-star-half-empty":"","fa-star-half-full":"","fa-star-half-o":"","fa-long-arrow-up":"","fa-ambulance":"","fa-won":"","fa-krw":"","fa-heartbeat":"","fa-sign-in":"","fa-caret-right":"","fa-chrome":"","fa-save":"","fa-floppy-o":"","fa-female":"","fa-braille":"","fa-pinterest-square":"","fa-paragraph":"","fa-folder-open":"","fa-envelope-square":"","fa-codiepie":"","fa-birthday-cake":"","fa-dot-circle-o":"","fa-sort-down":"","fa-sort-desc":"","fa-signing":"","fa-sign-language":"","fa-frown-o":"","fa-angle-right":"","fa-star-o":"","fa-angle-down":"","fa-space-shuttle":"","fa-arrow-circle-down":"","fa-arrow-circle-right":"","fa-soundcloud":"","fa-pause":"","fa-truck":"","fa-hand-stop-o":"","fa-hand-paper-o":"","fa-credit-card-alt":"","fa-file-photo-o":"","fa-file-picture-o":"","fa-file-image-o":"","fa-level-down":"","fa-backward":"","fa-eye-slash":"","fa-euro":"","fa-eur":"","fa-behance":"","fa-crosshairs":"","fa-certificate":"","fa-copyright":"","fa-meetup":"","fa-thumbs-o-down":"","fa-thermometer-0":"","fa-thermometer-empty":"","fa-meanpath":"","fa-arrows":"","fa-fast-backward":"","fa-vk":"","fa-map-marker":"","fa-bell-slash-o":"","fa-venus-mars":"","fa-map-signs":"","fa-filter":"","fa-calendar-plus-o":"","fa-language":"","fa-warning":"","fa-exclamation-triangle":"","fa-bluetooth-b":"","fa-minus-square-o":"","fa-home":"","fa-plane":"","fa-chevron-circle-up":"","fa-android":"","fa-volume-down":"","fa-institution":"","fa-bank":"","fa-university":"","fa-sort-amount-asc":"","fa-tumblr-square":"","fa-odnoklassniki-square":"","fa-bluetooth":"","fa-tag":"","fa-th":"","fa-ellipsis-v":"","fa-percent":"","fa-adn":"","fa-shekel":"","fa-sheqel":"","fa-ils":"","fa-weibo":"","fa-chevron-circle-down":"","fa-mars":"","fa-share-square":"","fa-search-minus":"","fa-child":"","fa-ruble":"","fa-rouble":"","fa-rub":"","fa-compress":"","fa-thumbs-down":"","fa-check-circle":"","fa-heart-o":"","fa-tags":"","fa-facebook-square":"","fa-asl-interpreting":"","fa-american-sign-language-interpreting":"","fa-motorcycle":"","fa-paste":"","fa-clipboard":"","fa-question-circle":"","fa-cutlery":"","fa-hourglass-3":"","fa-hourglass-end":"","fa-clock-o":"","fa-archive":"","fa-times-rectangle-o":"","fa-window-close-o":"","fa-bug":"","fa-codepen":"","fa-mail-forward":"","fa-share":"","fa-mars-stroke":"","fa-file-excel-o":"","fa-commenting":"","fa-behance-square":"","fa-folder-o":"","fa-microphone":"","fa-h-square":"","fa-etsy":"","fa-vimeo-square":"","fa-ship":"","fa-google-plus-circle":"","fa-google-plus-official":"","fa-info-circle":"","fa-table":"","fa-shower":"","fa-buysellads":"","fa-dollar":"","fa-usd":"","fa-themeisle":"","fa-user-o":"","fa-columns":"","fa-camera-retro":"","fa-star":"","fa-edge":"","fa-file-text-o":"","fa-rss-square":"","fa-laptop":"","fa-calendar-check-o":"","fa-area-chart":"","fa-pinterest":"","fa-plus-square":"","fa-envelope-o":"","fa-window-restore":"","fa-eraser":"","fa-trophy":"","fa-battery-1":"","fa-battery-quarter":"","fa-arrow-circle-o-left":"","fa-foursquare":"","fa-sitemap":"","fa-hourglass-1":"","fa-hourglass-start":"","fa-desktop":"","fa-gg":"","fa-rotate-right":"","fa-repeat":"","fa-calendar":"","fa-stop-circle":"","fa-intersex":"","fa-transgender":"","fa-firefox":"","fa-file-text":"","fa-coffee":"","fa-sort-up":"","fa-sort-asc":"","fa-steam":"","fa-hourglass":"","fa-road":"","fa-mixcloud":"","fa-lightbulb-o":"","fa-arrow-circle-o-right":"","fa-flash":"","fa-bolt":"","fa-hand-scissors-o":"","fa-tree":"","fa-ra":"","fa-resistance":"","fa-rebel":"","fa-audio-description":"","fa-spinner":"","fa-optin-monster":"","fa-facebook-official":"","fa-jsfiddle":"","fa-tablet":"","fa-navicon":"","fa-reorder":"","fa-bars":"","fa-long-arrow-left":"","fa-dribbble":"","fa-volume-control-phone":"","fa-diamond":"","fa-group":"","fa-users":"","fa-youtube-square":"","fa-usb":"","fa-minus-square":"","fa-first-order":"","fa-sticky-note":"","fa-upload":"","fa-thermometer-3":"","fa-thermometer-three-quarters":"","fa-renren":"","fa-times-circle":"","fa-pinterest-p":"","fa-linkedin-square":"","fa-cloud-download":"","fa-wrench":"","fa-file-sound-o":"","fa-file-audio-o":"","fa-linux":"","fa-instagram":"","fa-snapchat-square":"","fa-apple":"","fa-bitbucket":"","fa-align-left":"","fa-viacoin":"","fa-long-arrow-right":"","fa-share-alt-square":"","fa-fire":"","fa-font":"","fa-twitter":"","fa-circle-o-notch":"","fa-angle-up":"","fa-th-list":"","fa-list":"","fa-location-arrow":"","fa-hand-o-right":"","fa-plus-square-o":"","fa-toggle-on":"","fa-crop":"","fa-paw":"","fa-file-movie-o":"","fa-file-video-o":"","fa-dashboard":"","fa-tachometer":"","fa-at":"","fa-male":"","fa-th-large":"","fa-sun-o":"","fa-address-book-o":"","fa-window-minimize":"","fa-forward":"","fa-pied-piper":"","fa-code":"","fa-thermometer-4":"","fa-thermometer":"","fa-thermometer-full":"","fa-registered":"","fa-connectdevelop":"","fa-share-square-o":"","fa-expeditedssl":"","fa-barcode":"","fa-external-link":"","fa-check-square-o":"","fa-pause-circle-o":"","fa-question-circle-o":"","fa-industry":"","fa-chevron-circle-right":"","fa-transgender-alt":"","fa-thermometer-2":"","fa-thermometer-half":"","fa-grav":"","fa-paint-brush":"","fa-pencil":"","fa-skyatlas":"","fa-trademark":"","fa-lemon-o":"","fa-assistive-listening-systems":"","fa-sort-numeric-asc":"","fa-pied-piper-alt":"","fa-power-off":"","fa-cube":"","fa-telegram":"","fa-umbrella":"","fa-viadeo":"","fa-file-o":"","fa-file-powerpoint-o":"","fa-angle-double-down":"","fa-plus":"","fa-database":"","fa-arrow-down":"","fa-microchip":"","fa-unsorted":"","fa-sort":"","fa-photo":"","fa-image":"","fa-picture-o":"","fa-wheelchair-alt":"","fa-mars-stroke-h":"","fa-magnet":"","fa-file":"","fa-step-backward":"","fa-unlink":"","fa-chain-broken":"","fa-strikethrough":"","fa-reddit":"","fa-superpowers":"","fa-bomb":"","fa-cart-plus":"","fa-cc-discover":"","fa-gg-circle":"","fa-share-alt":"","fa-stack-overflow":"","fa-unlock-alt":"","fa-play":"","fa-low-vision":"","fa-binoculars":"","fa-puzzle-piece":"","fa-blind":"","fa-dedent":"","fa-outdent":"","fa-shield":"","fa-info":"","fa-tasks":"","fa-rupee":"","fa-inr":""};const i=r;n.ICONS_CONTENT=i},{}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.HOVERABLE_INSTRUCTION_BOX_ICON=n.GUIDED_BUILD_SIGN_UP_OUTRO_URL=n.GUIDED_BUILD_SIGN_UP_INTRO_URL=n.GUIDED_BUILD_SIGN_UP_EXAMPLE=n.EDITOR_CHECKLIST_LOGO_WHITE=n.EDITOR_CHECKLIST_LOGO_BLUE=n.EDITOR_CHECKLIST_CHECKBOX_COMPLETED=n.EDITOR_CHECKLIST_ARROW_UP=n.EDITOR_CHECKLIST_ARROW_DOWN=n.CHATBOT_LOGO_WHITE=n.CHATBOT_LOGO_BLUE=n.BUBBLE_LOGO=void 0;const r="//s3.amazonaws.com/appforest_uf/f1677624424761x877447606772898400/Base%20Mock-2.jpg";n.GUIDED_BUILD_SIGN_UP_INTRO_URL=r;const i="//s3.amazonaws.com/appforest_uf/f1680845675441x408099983847100400/Screenshot%202023-04-05%20at%202.07%201%20%281%29.png";n.GUIDED_BUILD_SIGN_UP_OUTRO_URL=i;const s="//s3.amazonaws.com/appforest_uf/f1681233610246x380788763799280200/input_name_295.png";n.GUIDED_BUILD_SIGN_UP_EXAMPLE=s;const o="//s3.amazonaws.com/appforest_uf/f1531946819200x747478706762194600/Bubble%20logo.svg";n.BUBBLE_LOGO=o;const a="//s3.amazonaws.com/appforest_uf/f1686339475649x113299227323281120/Chatbot_logo_white.svg";n.CHATBOT_LOGO_WHITE=a;const l="//s3.amazonaws.com/appforest_uf/f1687964894196x291335348662573600/Chatbot_logo_blue.svg";n.CHATBOT_LOGO_BLUE=l;const c="//s3.amazonaws.com/appforest_uf/f1688045559118x688690430093604100/Editor_checklist_logo_blue.svg";n.EDITOR_CHECKLIST_LOGO_BLUE=c;const u="//s3.amazonaws.com/appforest_uf/f1688675061585x642751681374738000/Editor_checklist_arrow_down.svg";n.EDITOR_CHECKLIST_ARROW_DOWN=u;const d="//s3.amazonaws.com/appforest_uf/f1688675084460x716023009696408400/Editor_checklist_arrow_up.svg";n.EDITOR_CHECKLIST_ARROW_UP=d;const p="//s3.amazonaws.com/appforest_uf/f1688653501732x930455032006831200/editor_checklist_checkbox_completed.svg";n.EDITOR_CHECKLIST_CHECKBOX_COMPLETED=p;const _="//s3.amazonaws.com/appforest_uf/f1688045625426x688199849039023700/Editor_checklist_logo_white.svg";n.EDITOR_CHECKLIST_LOGO_WHITE=_;const f="//s3.amazonaws.com/appforest_uf/f1688139463466x216822577833231330/Hoverable_instruction_box_icon.svg";n.HOVERABLE_INSTRUCTION_BOX_ICON=f},{}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ZIGGEO=n.TWILIO=n.STRIPE=n.SENDGRID=n.SEGMENT=n.RECAPTCHA=n.PEXELS=n.MAILCHIMP=n.LEGACY_API_CONNECTOR=n.DOCUSIGN=n.DB_CONNECTOR=n.CLOSURE_COMPILER=n.BUBBLE_PLUGIN=n.BUBBLEBOT=n.BRAINTREE=n.BOX=n.BLOCKSPRING=n.API_CONNECTOR=n.ADD_TO_ANY=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/known_plugins",n);const s="apiconnector2";n.API_CONNECTOR=s;const o="Blockspring";n.BLOCKSPRING=o;const a="box";n.BOX=a;const l="braintree";n.BRAINTREE=l;const c="bubble_plugin";n.BUBBLE_PLUGIN=c;const u="bubblebot";n.BUBBLEBOT=u;const d="closurecompiler";n.CLOSURE_COMPILER=d;const p="dbconnector";n.DB_CONNECTOR=p;const _="docusign";n.DOCUSIGN=_;const f="apiconnector";n.LEGACY_API_CONNECTOR=f;const h="mailchimp";n.MAILCHIMP=h;const m="pexels";n.PEXELS=m;const g="recaptcha";n.RECAPTCHA=g;const v="segment";n.SEGMENT=v;const b="sendgrid";n.SENDGRID=b;const y="stripe";n.STRIPE=y;const w="twilio";n.TWILIO=w;const x="ziggeo";n.ZIGGEO=x;const j="addtoany";n.ADD_TO_ANY=j},{"../safe_require":777}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.OPTION_VALUE_FORMATS=n.MISSING_TYPE=n.DETECT_FIELD_NAMES=void 0;const r="DETECT";n.DETECT_FIELD_NAMES=r;const i="<<MISSING TYPE INFO>>";n.MISSING_TYPE=i;let s=function(e){e["name_is_key"]="name_is_key";e["name_is_db_value_with_fallback"]="name_is_db_value_with_fallback";return e}({});n.OPTION_VALUE_FORMATS=s},{}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.VERSION_PATH_PREFIX=n.VERSIONS_DISPLAY=n.TEST_VERSION_DISPLAY=n.TEST_VERSION=n.TEMPLATE_VERSIONS=n.RESERVED_VERSION_NAMES=n.PUBLISHED_TEMPLATE_VERSION=n.PENDING_TEMPLATE_VERSION=n.OKAY_VERSIONS=n.MAIN_VERSION_DISPLAY=n.LIVE_VERSION_DISPLAY=n.LIVE_VERSION=n.LIVE_ENVIRONMENT_DISPLAY=n.HOTFIX_VERSION_DISPLAY=n.ENVIRONMENTS=n.DEVELOPMENT_ENVIRONMENT_DISPLAY=n.DEFAULT_TEST_VC_DESCRIPTION=n.DEFAULT_TEST_NO_VC_DESCRIPTION=n.DEFAULT_LIVE_DESCRIPTION=n.DEFAULT_HOTFIX_DESCRIPTION=n.DEFAULT_CUSTOM_BRANCH_DESCRIPTION=n.BREAKING_REVISION_TOPIC=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/locations",n);const s="Live";n.LIVE_ENVIRONMENT_DISPLAY=s;const o="Development";n.DEVELOPMENT_ENVIRONMENT_DISPLAY=o;const a=[s,o];n.ENVIRONMENTS=a;const l="live";n.LIVE_VERSION=l;const c="test";n.TEST_VERSION=c;const u=[l,c,o,s].map((e=>e.toLowerCase()));n.RESERVED_VERSION_NAMES=u;const d="pending_template";n.PENDING_TEMPLATE_VERSION=d;const p="published_template";n.PUBLISHED_TEMPLATE_VERSION=p;const _="breaking_revision";n.BREAKING_REVISION_TOPIC=_;const f=[l,c];n.OKAY_VERSIONS=f;const h=[d,p];n.TEMPLATE_VERSIONS=h;const m="version-";n.VERSION_PATH_PREFIX=m;const g="Live";n.LIVE_VERSION_DISPLAY=g;const v="Development";n.TEST_VERSION_DISPLAY=v;const b="hotfix";n.HOTFIX_VERSION_DISPLAY=b;const y="Main";n.MAIN_VERSION_DISPLAY=y;const w={[c]:v,[l]:g};n.VERSIONS_DISPLAY=w;const x="This is your default development branch. Make changes here, and deploy them to Live.";n.DEFAULT_TEST_NO_VC_DESCRIPTION=x;const j="This is your default deployment branch. Make changes and test them in custom branches, then merge into Main and deploy from Main to Live.";n.DEFAULT_TEST_VC_DESCRIPTION=j;const A="This is your live site on the web.";n.DEFAULT_LIVE_DESCRIPTION=A;const M="This is your custom branch #BRANCHNAME. Make changes here, and merge them into Main for deployment. You can customize this description.";n.DEFAULT_CUSTOM_BRANCH_DESCRIPTION=M;const E="Use this branch to make urgent bug fixes or time-sensitive changes, and deploy them directly to Live.";n.DEFAULT_HOTFIX_DESCRIPTION=E},{"../safe_require":777}],75:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.UPCOMING_BREAKING_CHANGE_MSG=n.STACK_OMITTED=n.SPECIAL_LOGGING_PROCS=n.PLUGIN_PAGE_HEADER_PREFIX=n.PLUGIN_MAIN_HEADER_PREFIX=n.LOG_LARGE_UPSERTS_TEXT_THRESHOLD=n.LOG_LARGE_UPSERTS_LIST_THRESHOLD=n.LEVEL_SEVERITY=n.CUSTOM_PAGE_HEADER_TAG=n.CUSTOM_APP_HEADER_TAG=n.AREAS=n.ALL_LEVELS=n.ALLOWED_ERRORS_IN_TESTS=void 0;var r=o(e("./redis"));var i=o(e("./postgres_pool"));function s(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(s=function(e){return e?n:t})(e)}function o(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=s(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;if(a&&(a.get||a.set)){Object.defineProperty(r,o,a)}else{r[o]=e[o]}}}r.default=e;if(n){n.set(e,r)}return r}const a=["debug","verbose","info","warn","error","fatal"];n.ALL_LEVELS=a;const l={debug:0,verbose:1,info:2,warn:3,error:4,fatal:5};n.LEVEL_SEVERITY=l;const c=512*1024;n.LOG_LARGE_UPSERTS_TEXT_THRESHOLD=c;const u=5e3;n.LOG_LARGE_UPSERTS_LIST_THRESHOLD=u;let d=function(e){e["certificates"]="certificates";e["cloudflare"]="cloudflare";e["cron"]="cron";e["fibers"]="fibers";e["logging"]="logging";e["metrics"]="metrics";e["notifier"]="notifier";e["percolator"]="percolator";e["postgres"]="postgres";e["pregenerate"]="pregenerate";e["redis"]="redis";e["scheduler"]="scheduler";e["server"]="server";e["threads"]="threads";e["workflow"]="workflow";return e}({});n.AREAS=d;const p={add_mapping:true,cancel_all_tasks:true,delete:true,delete_app:true,finish_task:true,multi_upsert:true,rewind_app:true,schedule_task:true,upsert:true};n.SPECIAL_LOGGING_PROCS=p;const _="app affected by breaking change";n.UPCOMING_BREAKING_CHANGE_MSG=_;const f=[r.SLOW_CALL_MSG,r.SLOW_LOG_MSG,i.POOL_QUERY_OVER_THRESHOLD_MSG,i.ZERO_CLIENTS_NO_SLOTS_MSG,i.TIMEOUT_QUERY_MSG,i.PG_CLIENT_ERR_MSG,i.PG_CLIENT_DESTRUCTION_ERR,i.PG_CLIENT_CANNOT_CONNECT_ERR];n.ALLOWED_ERRORS_IN_TESTS=f;const h="plugin_main_headers_";n.PLUGIN_MAIN_HEADER_PREFIX=h;const m="plugin_page_headers_";n.PLUGIN_PAGE_HEADER_PREFIX=m;const g="custom_page_header";n.CUSTOM_PAGE_HEADER_TAG=g;const v="custom_app_header";n.CUSTOM_APP_HEADER_TAG=v;const b="stack omitted";n.STACK_OMITTED=b},{"./postgres_pool":80,"./redis":81,"core-js/modules/web.dom-collections.iterator.js":1123}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.SearchNotificationTopic=n.NotificationTopic=n.LastChangeTopic=n.EditorUidTopic=n.BreakingRevisionTopic=n.BranchesListTopic=n.AppUsageTopic=n.AppUsagePlanChangedTopic=n.AppSettingTopic=n.AppPlanChangeTopic=void 0;const r="id-update-";n.NotificationTopic=r;const i="search-update";n.SearchNotificationTopic=i;const s="usage-update-";n.AppUsageTopic=s;const o="last-change-";n.LastChangeTopic=o;const a="app-plan-update-";n.AppPlanChangeTopic=a;const l="breaking_revision";n.BreakingRevisionTopic=l;const c="branches-list-";n.BranchesListTopic=c;const u="editor-uid-";n.EditorUidTopic=u;const d="app-setting-";n.AppSettingTopic=d;const p="usage-plan-update-";n.AppUsagePlanChangedTopic=p},{}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ALL_OPTIONS=void 0;const r="all values";n.ALL_OPTIONS=r},{}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.TYPES_TAG_TYPE=n.TYPES=n.THIRD_PARTY_TAG_NAME=n.TAG_TYPE_TO_NAMES=n.PRICE_NUMBER_PROPERTY=n.PREMIUM_TAG_TYPE=n.PREMIUM_TAG_NAME=n.PLUGIN_TAGS=n.PLUGIN_SEPARATOR=n.PLUGIN_CODE_SRC_PREFIX=n.OFFICIAL_TAG_NAME=n.NO_CREATOR_NAME=n.MAX_FUNCTION_PAYLOAD_LENGTH=n.LICENSE_PRIVATE=n.LICENSE_OPEN_SOURCE=n.LICENSE_COMMERCIAL=n.LEGAL_NODE_VERSIONS=n.LEGACY_NO_CREATOR_NAME=n.KEYS_THAT_CONTAIN_IDS=n.FREE_TAG_NAME=n.CATEGORIES_TAG_TYPE=n.CATEGORIES=n.BUILT_BY_TAG_TYPE=n.BUBBLE_TEAM_MEMBER_IDS=n.ALLOWED_DEPENDENCIES=void 0;var r=s(e("../safe_require"));var i=e("./byte");function s(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/plugin",n);const o="built_by";n.BUILT_BY_TAG_TYPE=o;const a="premium";n.PREMIUM_TAG_TYPE=a;const l="types";n.TYPES_TAG_TYPE=l;const c="categories";n.CATEGORIES_TAG_TYPE=c;const u="Official";n.OFFICIAL_TAG_NAME=u;const d="Third-party developers";n.THIRD_PARTY_TAG_NAME=d;const p="free";n.FREE_TAG_NAME=p;const _="premium";n.PREMIUM_TAG_NAME=_;const f={Analytics:"analytics",ArtificialIntelligence:"artificial intelligence (AI)",Blog:"blog",Compliance:"compliance",Containers:"containers",CustomerSupport:"customer support",DataThings:"data (things)",Ecommerce:"ecommerce",Email:"email",HealthAndFitness:"health & fitness",InputForms:"input forms",Internationalization:"internationalization",Location:"location",Media:"media",Mobile:"mobile",News:"news",Payment:"payment",Productivity:"productivity",SmallBusiness:"small business",SocialNetwork:"social network",Technical:"technical",Testing:"testing",Video:"video",VisualElements:"visual elements",WebScraping:"web scraping"};n.CATEGORIES=f;const h={Action:"action",Api:"api",BackgroundServices:"background services",Element:"element",Event:"event",LoginService:"login service",Storage:"storage"};n.TYPES=h;const m={[o]:[u,d],[a]:[p,_]};n.TAG_TYPE_TO_NAMES=m;const g={[l]:h,[c]:f,[o]:m[o],[a]:m[a]};n.PLUGIN_TAGS=g;const v="-";n.PLUGIN_SEPARATOR=v;const b=["1339510945575x284965680912137020","bubble-1571682061136x385876099972947800"];n.BUBBLE_TEAM_MEMBER_IDS=b;const y=["actions","actions.fields","events","fields","states"];n.KEYS_THAT_CONTAIN_IDS=y;const w=["use_jquery","plugin_api_version"];n.ALLOWED_DEPENDENCIES=w;const x=6*i.MEBIBYTE;n.MAX_FUNCTION_PAYLOAD_LENGTH=x;const j="(no name provided)";n.NO_CREATOR_NAME=j;const A="Bubble user";n.LEGACY_NO_CREATOR_NAME=A;const M="PLUGIN_";n.PLUGIN_CODE_SRC_PREFIX=M;const E="commercial";n.LICENSE_COMMERCIAL=E;const k="private";n.LICENSE_PRIVATE=k;const O="open_source";n.LICENSE_OPEN_SOURCE=O;const S=[14,18];n.LEGAL_NODE_VERSIONS=S;const D="price_number";n.PRICE_NUMBER_PROPERTY=D},{"../safe_require":777,"./byte":52}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.INITIAL_POPUP_TOP=n.HORIZONTAL_SPACING=n.FILL_POPUP_BOTTOM=void 0;const r=10;n.HORIZONTAL_SPACING=r;const i=20;n.INITIAL_POPUP_TOP=i;const s=50;n.FILL_POPUP_BOTTOM=s},{}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.mapping_error_regex=n.ZERO_CLIENTS_NO_SLOTS_MSG=n.USER_REQUESTED_CANCEL_CODE=n.USERDB_NAME=n.TIMEOUT_QUERY_MSG=n.TIMEOUT_MSG=n.STRING_TOO_LONG_FOR_TSVECTOR=n.SOURCE_DOES_NOT_EXIST=n.RELATION_DOES_NOT_EXIST=n.QUERY_TIMEOUTS=n.POOL_QUERY_OVER_THRESHOLD_MSG=n.PLV8_EXECUTION_ERROR_CODE=n.PG_CLIENT_ERR_PROPAGATED_MSG=n.PG_CLIENT_ERR_MSG=n.PG_CLIENT_DESTRUCTION_ERR=n.PG_CLIENT_CANNOT_CONNECT_ERR=n.PERCOLATE_NAME=n.MULTI_UPSERT_RETRY_WARN_THRESHOLD=n.MULTI_UPSERT_RETRY_SPEND_TIME_MS=n.MULTI_UPSERT_MIN_EXP_BACKOFF_MS=n.MULTI_UPSERT_MAX_EXP_BACKOFF_MS=n.MAGIC_POOL_READY_STRING=n.DEFAULT_QUERY_NAME=n.CONCURRENT_TRANSACTION_ERROR_CODE=n.APP_ALREADY_EXISTS=n.APPSERVER_NAME=void 0;const r={upsert:1e4,get:1e4,search:1e4,group_by:1e4,aggregate:1e4,aggregate_sql:1e4,percolate:1e4,watch_search:1e4,set_ttl:1e4,mget:1e4,evaluate_search:1e4,check_next_run:1e4,get_next_task:3e4,check_operation_state:6e4,delete_app:6e4,add_mapping:6e4,build_concurrent_index:6e4,clear_expired:6e4,clear_searches:6e4,clean_app_references:6e4,clean_deletions:6e4,last_snapshot_time:5e3,get_restore_history:5e3,add_new_annotation:5e3,get_id_counter:5e3,delete_metadata2:5e3,list_apps_by_plugin:5e3,get_plugin_count:5e3,list_plugins_by_count:5e3,read_keys:5e3,read_path:5e3,read_paths:5e3,write_changes2:5e3,snapshot:3e4,delete_app_version:3e4,restore_to:3e4,find_unowned_apps:3e4,copy_app_version:3e4,remove_old_history:3e4,get_indexes:2e4,list_changes:2e4};n.QUERY_TIMEOUTS=r;const i=250;n.MULTI_UPSERT_MIN_EXP_BACKOFF_MS=i;const s=4e3;n.MULTI_UPSERT_MAX_EXP_BACKOFF_MS=s;const o=30;n.MULTI_UPSERT_RETRY_WARN_THRESHOLD=o;const a=10;n.MULTI_UPSERT_RETRY_SPEND_TIME_MS=a;const l="Pool query over threshold";n.POOL_QUERY_OVER_THRESHOLD_MSG=l;const c="postgres_pool.coffee: ready clients and empty clients at 0";n.ZERO_CLIENTS_NO_SLOTS_MSG=c;const u="postgres_pool.coffee: query exceeded timeout";n.TIMEOUT_MSG=u;const d="postgres_pool.coffee: timing out query";n.TIMEOUT_QUERY_MSG=d;const p="Postgres pool: client got an unhandled error";n.PG_CLIENT_ERR_MSG=p;const _="destroying client that had an unhandled error";n.PG_CLIENT_ERR_PROPAGATED_MSG=_;const f="Destroying client due to unexpected error";n.PG_CLIENT_DESTRUCTION_ERR=f;const h="Postgres pool: unable to connect";n.PG_CLIENT_CANNOT_CONNECT_ERR=h;const m="42P01";n.RELATION_DOES_NOT_EXIST=m;const g="57014";n.USER_REQUESTED_CANCEL_CODE=g;const v="App already exists, cannot copy";n.APP_ALREADY_EXISTS=v;const b="Source app does not exist";n.SOURCE_DOES_NOT_EXIST=b;const y=/MAPPING:([^\n]+)/;n.mapping_error_regex=y;const w="XX000";n.PLV8_EXECUTION_ERROR_CODE=w;const x="40001";n.CONCURRENT_TRANSACTION_ERROR_CODE=x;const j="54000";n.STRING_TOO_LONG_FOR_TSVECTOR=j;const A="percolatedb";n.PERCOLATE_NAME=A;const M="userdb";n.USERDB_NAME=M;const E="appserver";n.APPSERVER_NAME=E;const k="POOL_READY";n.MAGIC_POOL_READY_STRING=k;const O="unnamed_query";n.DEFAULT_QUERY_NAME=O},{}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.STATES=n.SLOW_LOG_MSG=n.SLOW_CALL_MSG=n.INSTANCE_NAMES=n.GEOCACHE_PREFIX=void 0;let r=function(e){e["SMALL"]="small";e["WORKFLOW"]="workflow";e["BIG"]="big";e["ELASTICSEARCH"]="elasticsearch";e["CACHE"]="cache";return e}({});n.INSTANCE_NAMES=r;const i="redis slow call";n.SLOW_CALL_MSG=i;const s="redis log call";n.SLOW_LOG_MSG=s;let o=function(e){e["STARTING"]="starting";e["AVAILABLE"]="available";e["IN_USE"]="in_use";e["TERMINATING"]="terminating";e["EMPTY"]="empty";return e}({});n.STATES=o;const a="geo_cache_";n.GEOCACHE_PREFIX=a},{}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.WORKFLOW_ROUTE=n.USER_ROUTE=n.TEST_CREATION_ROUTE=n.STATIC_ROUTE=n.PLUGIN_ROUTE=n.PAGE_ROUTE=n.PACKAGER_ROUTE=n.ILLEGAL_PAGE_NAMES=n.FILEUPLOAD_ROUTE=n.DCV_ROUTE=n.DATA_ROUTE=n.BUG_ROUTE=n.APP_EDITOR_ROUTE=n.API_SERVICE_ROUTE=n.API_ROUTE=void 0;const r="api";n.API_ROUTE=r;const i="apiservice";n.API_SERVICE_ROUTE=i;const s="appeditor";n.APP_EDITOR_ROUTE=s;const o="bug";n.BUG_ROUTE=o;const a="elasticsearch";n.DATA_ROUTE=a;const l=".well-known";n.DCV_ROUTE=l;const c="fileupload";n.FILEUPLOAD_ROUTE=c;const u="package";n.PACKAGER_ROUTE=u;const d="";n.PAGE_ROUTE=d;const p="pluginserver";n.PLUGIN_ROUTE=p;const _="static";n.STATIC_ROUTE=_;const f="versioncontrol";n.TEST_CREATION_ROUTE=f;const h="user";n.USER_ROUTE=h;const m="workflow";n.WORKFLOW_ROUTE=m;const g=[r,i,s,o,a,l,c,u,d,p,_,f,h,m];n.ILLEGAL_PAGE_NAMES=g},{}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.POPUP_ZINDEX=n.MAX_POPUP_ZINDEX=n.FLOATING_GROUP_ZINDEX_OFFSET=n.CLICKABLE_ELEMENT=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/runmode",n);const s="clickable-element";n.CLICKABLE_ELEMENT=s;const o=2002;n.POPUP_ZINDEX=o;const a=o+100;n.MAX_POPUP_ZINDEX=a;const l=500;n.FLOATING_GROUP_ZINDEX_OFFSET=l},{"../safe_require":777}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.USER_FIELDS=n.SOCIAL=n.SECURABLE_PREFIX=n.EMAIL=n.DATE_FIELDS=n.CREATOR_FIELD=n.BUILTIN_FIELDS=n.BUILTIN_CUSTOM_FIELDS=void 0;e("core-js/modules/web.dom-collections.iterator.js");const r="email";n.EMAIL=r;const i="_social_networks";n.SOCIAL=i;const s=[{display:"email",value:r},{display:"Social Networks",value:i}];n.USER_FIELDS=s;const o=[{display:"Created Date",value:"Created Date"},{display:"Modified Date",value:"Modified Date"}];n.DATE_FIELDS=o;const a=[{display:"Created By",value:"Created By"}];n.CREATOR_FIELD=a;const l="securable_";n.SECURABLE_PREFIX=l;const c=["Created Date","Modified Date","Created By","Slug"];n.BUILTIN_CUSTOM_FIELDS=c;const u=[...c,r,i];n.BUILTIN_FIELDS=u},{"core-js/modules/web.dom-collections.iterator.js":1123}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.REDIRECTED_TO_STRIPE_CHECKOUT=n.PREVIEW_VIEWED=n.POINT_IN_PERCENTAGE_OF_DESIGNATED_TIME_CLICKED=n.POINT_IN_AVERAGE_CPU_USAGE_CLICKED=n.PLUGIN_UNINSTALLED=n.PLUGIN_INSTALLED=n.PLUGIN_EDITOR_SUBMIT_NEW_VERSION=n.PAYWALL_MODAL_PLAN_UPGRADE_CLICKED=n.PAYWALL_MODAL_PLAN_DOWNGRADE_CLICKED=n.PAYWALL_MODAL_PLAN_CHOSEN=n.PAYWALL_MODAL_OPENED=n.OPTION_SET_GUIDED_SETUP_SKIP_CLICKED=n.OPTION_SET_GUIDED_SETUP_CREATION_SOURCE=n.OPTION_SET_GUIDED_SETUP_CLICKED=n.OPTION_SET_EDITOR_CREATION_SOURCE=n.OPTION_SET_CREATED=n.OPTION_SET_ATTRIBUTE_CREATED=n.MASONRY_GRID_SETTING_CLICKED=n.HTML_UPLOAD_EVENT=n.HELP_OPENED=n.HELP_ITEM_CLICKED=n.GB_X_OUT_CLICKED=n.GB_START_EDIT_WORKFLOW_ON_SIGNUP_POPUP_CLICKED=n.GB_START_EDIT_WF_ON_SIGNUP_HEADER_CLICKED=n.GB_SIGN_USER_UP_CLICKED=n.GB_SIGNUP_ON_POPUP_CLICKED=n.GB_SIGNUP_ON_HEADER_CLICKED=n.GB_SHOW_ELEMENT_CLICKED=n.GB_SET_TO_COLUMN_CLICKED=n.GB_PREVIEW_CLICKED=n.GB_POPUP_SIGNUP_DRAGGED=n.GB_KEEP_AS_IS_COLUMN_CLICKED=n.GB_HEADER_COMPONENT_DRAGGED=n.GB_FINISH_ON_CONGRATS_CLICKED=n.GB_ENTRY_NO_THANKS_CLICKED=n.GB_ENTRY_GET_STARTED_CLICKED=n.GB_ELEMENT_POPUP_SIGNUP_LOGIN_SELECTED=n.GB_DONE_CLICKED=n.GB_DATA_FIELDS_ON_SIGNUP_COMPLETED=n.GB_CONTINUE_ON_WORKFLOW_TAB_INTRO_CLICKED=n.GB_CONTINUE_ON_INDEX_PE_CLICKED=n.GB_CONTINUE_ON_ALMOST_THERE_CLICKED=n.GB_CONTINUE_NAME_FIELD_CREATED_CLICKED=n.GB_CONTINUE_HIDE_ELEMENT_ACTION_CLICKED=n.GB_CONTINUE_FINAL_ACTIONS_WF_CLICKED=n.GB_ADD_ACTION_FOR_SIGN_USER_UP_CLICKED=n.GB_ADD_ACTION_FOR_SHOW_ELEMENT_CLICKED=n.FREE_TRIAL_CREATED_FROM_CLIENT=n.FREE_TRIAL_CANCELED=n.FIRST_SUBSCRIPTION=n.ELEMENT_TEMPLATE_USED=n.ELEMENT_STYLE_EDITED=n.EDITOR_VISIT=n.DYNAMIC_EXPRESSION_EDITED_V1=n.DYNAMIC_EXPRESSION_EDITED=n.DWD_WORKFLOW_VIDEO_POPUP_SEEN=n.DWD_WORKFLOW_VIDEO_PLAYED=n.DWD_VISUAL_INDICATOR_SETTING_TOGGLED=n.DWD_DESIGN_VIDEO_POPUP_SEEN=n.DWD_DESIGN_VIDEO_PLAYED=n.DWD_DATA_VIDEO_POPUP_SEEN=n.DWD_DATA_VIDEO_PLAYED=n.DETACH_REUSABLE_CLICKED=n.DEPLOY_TO_LIVE_CLICKED=n.DEPLOY_FAILURE_MODAL_SEEN=n.DAILY_EDITOR_VISIT=n.CREATE_VARIABLE_CLICKED=n.COMPONENT_LIBRARY_ONBOARDING_VIEWED=n.COMPONENT_LIBRARY_MENU_CLICKED=n.COMPONENT_CREATED=n.COLOR_PICKER_VALUE_SET=n.CHECKOUT_OPENED=n.CHECKOUT_COMPLETED=n.CAPACITY_USAGE_ANALYTICS_CLOSED=n.APP_PLAN_CONFIRM_CLICKED=n.APP_ASSIST_PLUGIN_NEXT_CLICKED=n.APP_ASSIST_PLUGIN_EDITED=n.APP_ASSIST_PLUGIN_CLICKED=n.APP_ASSIST_FONT_NEXT_CLICKED=n.APP_ASSIST_FONT_EDITED=n.APP_ASSIST_FAVICON_EDITED=n.APP_ASSIST_COMPLETED_CLICKED=n.APP_ASSIST_COMPLETED=n.APP_ASSIST_COLOR_NEXT_CLICKED=n.APP_ASSIST_COLOR_EDITED=n.APP_ASSIST_CLOSE_CLICKED=n.APP_ASSIST_BROWSER_NEXT_CLICKED=n.APP_ASSIST_BROWSER_EDITED=n.APP_ASSIST_BACK_CLICKED=n.API_CONNECTOR_INITIALIZE_CALL_SUCCESS=n.API_CONNECTOR_INITIALIZE_CALL_FAILURE=n.API_CONNECTOR_INITIALIZE_CALL_CLICKED=n.API_CONNECTOR_ADD_CALL_CLICKED=n.AI_CHAT_RATING=n.AI_CHAT_PROMPT_SENT=n.AI_CHAT_COMPLETION_RECEIVED=n.ACTUALLY_BUILDING_20=n.ACTUALLY_BUILDING_2=n.ACTUALLY_BUILDING_10=n.ACTUALLY_BUILDING=void 0;n.YOUTUBE_VIDEO_RATE_CHANGED=n.YOUTUBE_VIDEO_QUALITY_CHANGED=n.YOUTUBE_VIDEO_PLAYING=n.YOUTUBE_VIDEO_PAUSED=n.YOUTUBE_VIDEO_ENDED=n.YOUTUBE_VIDEO_CUED=n.YOUTUBE_VIDEO_BUFFER=n.WORKLOAD_PIE_CHART_CLICKED=n.WORKLOAD_BAR_CHART_CLICKED=n.VERIFY_SENDGRID_CLICKED=n.VC_UPGRADE_CTA=n.VC_UPDATE_TO_REDESIGN=n.VC_SIDEPANEL_MORE_ACTIONS_MENU_USED=n.VC_SIDEPANEL_MORE_ACTIONS_MENU_OPENED=n.VC_SIDEPANEL_INTERACTION=n.VC_SIDEPANEL_ENGAGEMENT=n.VC_SAVEPOINT_CREATED=n.VC_COPY_LIVE=n.VC_BRANCH_REVERTED=n.VC_BRANCH_NAVIGATED=n.VC_BRANCH_MERGE_COMPLETED=n.VC_BRANCH_MERGE_CANCELED=n.VC_BRANCH_MERGED=n.VC_BRANCH_DEPLOYED=n.VC_BRANCH_DELETED=n.VC_BRANCH_CREATED=n.USER_SUBSCRIBED_TO_PLAN=n.USER_APP_TRANSFERRED=n.TRIAL_BUTTON_CLICKED=n.TOOLBAR_ELEMENTS=n.TOOLBAR_CLICKED=n.STYLE_VALUE_RESET=n.STYLE_VALUE_OVERRIDDEN=n.STYLES_VARIABLE_EDITED=n.STYLES_VARIABLE_DELETED=n.STYLES_VARIABLE_CREATED=n.STYLES_VARIABLES_TAB_CLICKED=n.SERVER_CAPACITY_USAGE_FILTER_SET=n.SERVER_CAPACITY_USAGE_DETAILS_PIE_CHART_CLICKED=n.REUSABLE_PROPERTY_CREATED=n.REUSABLE_CREATED=void 0;const r="actually building";n.ACTUALLY_BUILDING=r;const i="actually building 2";n.ACTUALLY_BUILDING_2=i;const s="actually building 10";n.ACTUALLY_BUILDING_10=s;const o="actually building 20";n.ACTUALLY_BUILDING_20=o;const a="Deploy To Live Button Clicked";n.DEPLOY_TO_LIVE_CLICKED=a;const l=" Deploy Failure Modal Seen";n.DEPLOY_FAILURE_MODAL_SEEN=l;const c="editor visit";n.EDITOR_VISIT=c;const u="daily editor visit";n.DAILY_EDITOR_VISIT=u;const d="Help Item Clicked";n.HELP_ITEM_CLICKED=d;const p="Help Opened";n.HELP_OPENED=p;const _="Preview Viewed";n.PREVIEW_VIEWED=_;const f="Toolbar Clicked";n.TOOLBAR_CLICKED=f;const h={cursor:"Cursor Icon",undo:"Undo Button",redo:"Redo Button",grid_dropdown:"Grid Settings Menu",arrange_menu:"Arrange Menu",version_dropdown:"Version Menu",logo:"Bubble Logo",releases:"Releases Icon",edit:"Edit Menu",user_menu:"User Icon",project_menu:"Project Menu",login:"Login Button",search:"Search Icon",element_picker:"Element/Workflow Picker",selected_element:"Selected Element",selected_workflow:"Selected Workflow",feedback:"Feedback Icon"};n.TOOLBAR_ELEMENTS=h;const m="Trial button clicked";n.TRIAL_BUTTON_CLICKED=m;const g="Verify SendGrid button clicked";n.VERIFY_SENDGRID_CLICKED=g;const v="Component Onboarding Hoverable Viewed";n.COMPONENT_LIBRARY_ONBOARDING_VIEWED=v;const b="Element template added to editor canvas";n.ELEMENT_TEMPLATE_USED=b;const y="Detach reusable clicked";n.DETACH_REUSABLE_CLICKED=y;const w="Masonry Grid Setting Clicked";n.MASONRY_GRID_SETTING_CLICKED=w;const x="FirstSubscription (client)";n.FIRST_SUBSCRIPTION=x;const j="Free Trial created (client)";n.FREE_TRIAL_CREATED_FROM_CLIENT=j;const A="App Assist - Browser Next Clicked";n.APP_ASSIST_BROWSER_NEXT_CLICKED=A;const M="App Assist - Font Next Clicked";n.APP_ASSIST_FONT_NEXT_CLICKED=M;const E="App Assist - Color Next Clicked";n.APP_ASSIST_COLOR_NEXT_CLICKED=E;const k="App Assist - Plugin Next Clicked";n.APP_ASSIST_PLUGIN_NEXT_CLICKED=k;const O="App Assist - Back Clicked";n.APP_ASSIST_BACK_CLICKED=O;const S="App Assist - Browser Edited";n.APP_ASSIST_BROWSER_EDITED=S;const D="App Assist - Favicon Edited";n.APP_ASSIST_FAVICON_EDITED=D;const C="App Assist - Font Edited";n.APP_ASSIST_FONT_EDITED=C;const T="App Assist - Color Edited";n.APP_ASSIST_COLOR_EDITED=T;const N="App Assist - Plugin Edited";n.APP_ASSIST_PLUGIN_EDITED=N;const P="App Assist - Plugin Clicked";n.APP_ASSIST_PLUGIN_CLICKED=P;const I="App Assist - Completed Clicked";n.APP_ASSIST_COMPLETED_CLICKED=I;const R="App Assist - Close Assistant Clicked";n.APP_ASSIST_CLOSE_CLICKED=R;const L="completed new app assistant";n.APP_ASSIST_COMPLETED=L;const z="API Connector - Initialize Call clicked";n.API_CONNECTOR_INITIALIZE_CALL_CLICKED=z;const B="API Connector - Initialize Call success";n.API_CONNECTOR_INITIALIZE_CALL_SUCCESS=B;const q="API Connector - Initialize Call failure";n.API_CONNECTOR_INITIALIZE_CALL_FAILURE=q;const U="API Connector - Add Call clicked";n.API_CONNECTOR_ADD_CALL_CLICKED=U;const F="Option Set Created";n.OPTION_SET_CREATED=F;const W="Option Set Attribute Created";n.OPTION_SET_ATTRIBUTE_CREATED=W;const $="Option Set Guided Setup Clicked";n.OPTION_SET_GUIDED_SETUP_CLICKED=$;const G="Option Set Guided Setup Skip Clicked";n.OPTION_SET_GUIDED_SETUP_SKIP_CLICKED=G;const V="editor";n.OPTION_SET_EDITOR_CREATION_SOURCE=V;const H="guided setup";n.OPTION_SET_GUIDED_SETUP_CREATION_SOURCE=H;const X="Paywall Modal Opened";n.PAYWALL_MODAL_OPENED=X;const Y="Paywall Modal Plan Chosen";n.PAYWALL_MODAL_PLAN_CHOSEN=Y;const K="Paywall Modal Plan Upgrade Clicked";n.PAYWALL_MODAL_PLAN_UPGRADE_CLICKED=K;const J="Paywall Modal Plan Downgrade Clicked";n.PAYWALL_MODAL_PLAN_DOWNGRADE_CLICKED=J;const Z="Plugin editor - Submit a New Version";n.PLUGIN_EDITOR_SUBMIT_NEW_VERSION=Z;const Q="Server capacity usage filter set (start or end)";n.SERVER_CAPACITY_USAGE_FILTER_SET=Q;const ee="Point in percentage of designated time clicked";n.POINT_IN_PERCENTAGE_OF_DESIGNATED_TIME_CLICKED=ee;const te="Point in Average CPU usage clicked";n.POINT_IN_AVERAGE_CPU_USAGE_CLICKED=te;const ne="Capacity Usage Analytics - Closed";n.CAPACITY_USAGE_ANALYTICS_CLOSED=ne;const re="Server capacity usage details - pie chart clicked";n.SERVER_CAPACITY_USAGE_DETAILS_PIE_CHART_CLICKED=re;const ie="Workload Pie Chart clicked";n.WORKLOAD_PIE_CHART_CLICKED=ie;const se="Workload Bar chart clicked";n.WORKLOAD_BAR_CHART_CLICKED=se;const oe="App Plan Confirm Clicked";n.APP_PLAN_CONFIRM_CLICKED=oe;const ae="Stripe Checkout Opened";n.CHECKOUT_OPENED=ae;const le="Stripe Checkout Completed";n.CHECKOUT_COMPLETED=le;const ce="Directed to Stripe Checkout";n.REDIRECTED_TO_STRIPE_CHECKOUT=ce;const ue="Trial Canceled";n.FREE_TRIAL_CANCELED=ue;const de="User subscribed to plan";n.USER_SUBSCRIBED_TO_PLAN=de;const pe="Component Added to Page";n.COMPONENT_CREATED=pe;const _e="Component Library Menu Clicked";n.COMPONENT_LIBRARY_MENU_CLICKED=_e;const fe="Styles Variables Tab Clicked";n.STYLES_VARIABLES_TAB_CLICKED=fe;const he="Styles Variable Edited";n.STYLES_VARIABLE_EDITED=he;const me="Create Variable Clicked";n.CREATE_VARIABLE_CLICKED=me;const ge="Styles Variable Created";n.STYLES_VARIABLE_CREATED=ge;const ve="Styles Variable Deleted";n.STYLES_VARIABLE_DELETED=ve;const be="Color Picker Value Set";n.COLOR_PICKER_VALUE_SET=be;const ye="Element Style Edited";n.ELEMENT_STYLE_EDITED=ye;const we="Element Style Value Overridden";n.STYLE_VALUE_OVERRIDDEN=we;const xe="Element Style Value Reset";n.STYLE_VALUE_RESET=xe;const je="Dynamic expression edited";n.DYNAMIC_EXPRESSION_EDITED=je;const Ae="Dynamic expression edited (V1)";n.DYNAMIC_EXPRESSION_EDITED_V1=Ae;const Me="Plugin Installed";n.PLUGIN_INSTALLED=Me;const Ee="Plugin Uninstalled";n.PLUGIN_UNINSTALLED=Ee;const ke="Version control side panel used";n.VC_SIDEPANEL_INTERACTION=ke;const Oe="Version control more actions menu clicked";n.VC_SIDEPANEL_MORE_ACTIONS_MENU_OPENED=Oe;const Se="Version control more actions menu engagement";n.VC_SIDEPANEL_MORE_ACTIONS_MENU_USED=Se;const De="Version control side panel engagement";n.VC_SIDEPANEL_ENGAGEMENT=De;const Ce="Version control branch created";n.VC_BRANCH_CREATED=Ce;const Te="Version control branch deleted";n.VC_BRANCH_DELETED=Te;const Ne="Version control merge started";n.VC_BRANCH_MERGED=Ne;const Pe="Version control merge canceled";n.VC_BRANCH_MERGE_CANCELED=Pe;const Ie="Version control merge completed";n.VC_BRANCH_MERGE_COMPLETED=Ie;const Re="Version control branch navigated";n.VC_BRANCH_NAVIGATED=Re;const Le="Version control branch deployed to Live";n.VC_BRANCH_DEPLOYED=Le;const ze="Version control branch reverted";n.VC_BRANCH_REVERTED=ze;const Be="Version control upgrade cta clicked";n.VC_UPGRADE_CTA=Be;const qe="Version control custom savepoint created";n.VC_SAVEPOINT_CREATED=qe;const Ue="Version control reset to Live";n.VC_COPY_LIVE=Ue;const Fe="Version control update to redesign";n.VC_UPDATE_TO_REDESIGN=Fe;const We="User Transferred An App";n.USER_APP_TRANSFERRED=We;const $e="Youtube video ended";n.YOUTUBE_VIDEO_ENDED=$e;const Ge="Youtube video playing";n.YOUTUBE_VIDEO_PLAYING=Ge;const Ve="Youtube video buffering";n.YOUTUBE_VIDEO_BUFFER=Ve;const He="Youtube video cued";n.YOUTUBE_VIDEO_CUED=He;const Xe="Youtube video paused";n.YOUTUBE_VIDEO_PAUSED=Xe;const Ye="Youtube video playback rate changed";n.YOUTUBE_VIDEO_RATE_CHANGED=Ye;const Ke="Youtube video playback quality changed";n.YOUTUBE_VIDEO_QUALITY_CHANGED=Ke;const Je="GB - Entry Get Started Clicked";n.GB_ENTRY_GET_STARTED_CLICKED=Je;const Ze="GB - Entry No Thanks Clicked";n.GB_ENTRY_NO_THANKS_CLICKED=Ze;const Qe="GB - Set to Column Clicked";n.GB_SET_TO_COLUMN_CLICKED=Qe;const et="GB - Keep as Column Clicked";n.GB_KEEP_AS_IS_COLUMN_CLICKED=et;const tt="GB - Continue on Index PE Clicked";n.GB_CONTINUE_ON_INDEX_PE_CLICKED=tt;const nt="GB - Header Component Dragged";n.GB_HEADER_COMPONENT_DRAGGED=nt;const rt="GB - Popup Sign Up Dragged";n.GB_POPUP_SIGNUP_DRAGGED=rt;const it="GB - Sign Up on Popup Clicked";n.GB_SIGNUP_ON_POPUP_CLICKED=it;const st="GB - Start/Edit Workflow on Sign Up Popup Clicked";n.GB_START_EDIT_WORKFLOW_ON_SIGNUP_POPUP_CLICKED=st;const ot="GB - Continue on Workflow Tab Intro Clicked";n.GB_CONTINUE_ON_WORKFLOW_TAB_INTRO_CLICKED=ot;const at="GB - Add an Action for Sign the User Up Clicked";n.GB_ADD_ACTION_FOR_SIGN_USER_UP_CLICKED=at;const lt='GB - "Sign the User Up" Clicked';n.GB_SIGN_USER_UP_CLICKED=lt;const ct="GB - Continue Name Field Created Clicked";n.GB_CONTINUE_NAME_FIELD_CREATED_CLICKED=ct;const ut="GB - Data Fields on Sign Up Completed";n.GB_DATA_FIELDS_ON_SIGNUP_COMPLETED=ut;const dt="GB - Continue Hide an Element Action Clicked";n.GB_CONTINUE_HIDE_ELEMENT_ACTION_CLICKED=dt;const pt="GB - Continue on Almost There Clicked";n.GB_CONTINUE_ON_ALMOST_THERE_CLICKED=pt;const _t="GB - Sign Up on Header Clicked";n.GB_SIGNUP_ON_HEADER_CLICKED=_t;const ft="GB - Start/Edit Workflow on Sign Up Header Clicked";n.GB_START_EDIT_WF_ON_SIGNUP_HEADER_CLICKED=ft;const ht="GB - Add an Action for Show an Element Clicked";n.GB_ADD_ACTION_FOR_SHOW_ELEMENT_CLICKED=ht;const mt="GB - Show an Element Clicked";n.GB_SHOW_ELEMENT_CLICKED=mt;const gt="GB - Element Popup Sign Up/Log In Selected";n.GB_ELEMENT_POPUP_SIGNUP_LOGIN_SELECTED=gt;const vt="GB - Continue Final Actions Workflow Clicked";n.GB_CONTINUE_FINAL_ACTIONS_WF_CLICKED=vt;const bt="GB - Done Clicked";n.GB_DONE_CLICKED=bt;const yt="GB - Preview Clicked";n.GB_PREVIEW_CLICKED=yt;const wt="GB - Finish on Congrats Clicked";n.GB_FINISH_ON_CONGRATS_CLICKED=wt;const xt="GB - X Out Clicked";n.GB_X_OUT_CLICKED=xt;const jt="DWD Design video popup seen";n.DWD_DESIGN_VIDEO_POPUP_SEEN=jt;const At="DWD Design video played";n.DWD_DESIGN_VIDEO_PLAYED=At;const Mt="DWD Workflow video popup seen";n.DWD_WORKFLOW_VIDEO_POPUP_SEEN=Mt;const Et="DWD Workflow video played";n.DWD_WORKFLOW_VIDEO_PLAYED=Et;const kt="DWD Data video popup seen";n.DWD_DATA_VIDEO_POPUP_SEEN=kt;const Ot="DWD Data video played";n.DWD_DATA_VIDEO_PLAYED=Ot;const St="DWD Visual Indicator Setting Toggled";n.DWD_VISUAL_INDICATOR_SETTING_TOGGLED=St;const Dt="HTML file upload";n.HTML_UPLOAD_EVENT=Dt;const Ct="Reusable element property added";n.REUSABLE_PROPERTY_CREATED=Ct;const Tt="Reusable element added to page";n.REUSABLE_CREATED=Tt;const Nt="AI Chat Prompt Sent";n.AI_CHAT_PROMPT_SENT=Nt;const Pt="AI Chat Completion Received";n.AI_CHAT_COMPLETION_RECEIVED=Pt;const It="AI Chat Rating";n.AI_CHAT_RATING=It},{}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ROOT_CLASS=n.CSS_FLAG=n.AT_ROOT=void 0;const r="@at-root";n.AT_ROOT=r;const i="b-root";n.ROOT_CLASS=i;const s="--stylesheet-active";n.CSS_FLAG=s},{}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.UNIQUE_ID=n.RANDOM_SORTING=n.DYNAMIC_SORTING_FIELD=n.ALL_DB_FIELDS=n.ADVANCED_SEARCH_CONSTRAINT=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/special_keys",n);const s="_all";n.ALL_DB_FIELDS=s;const o="_advanced_search_constraint";n.ADVANCED_SEARCH_CONSTRAINT=o;const a="_id";n.UNIQUE_ID=a;const l="_dynamic_sort_field";n.DYNAMIC_SORTING_FIELD=l;const c="_random_sorting";n.RANDOM_SORTING=c},{"../safe_require":777}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ALL=void 0;const r={};n.ALL=r},{}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.STYLE_PROPS=n.BORDER_TO_CORNER_MAPPING=void 0;const r={top:"top-left",left:"bottom-left",right:"top-right",bottom:"bottom-right"};n.BORDER_TO_CORNER_MAPPING=r;const i=["Opacity","Font","PlaceholderColor","CenterVertically","BackdropBackground","Stripes","Background","ButtonBackground","Border","Padding","InputPadding","FontShadow","Boxshadow"];n.STYLE_PROPS=i},{}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.TRIAL_END_NOW=n.STRIPE_PLUGIN_ID_PREFIX=n.SOURCE_WORKLOAD_PLAN_TABLE=n.SOURCE_EDITOR_PRICING_TABLE=n.SOURCE_EDITOR_PAYWALL=n.SOURCE_EDITOR_ANNUAL_CTA=n.SOURCE_EDITOR=n.MAX_FREE_TRIAL_DAYS=n.LEGACY_END_DATE=n.LEGACY_CREATION_DATE_CUTOFF=n.IMMEDIATE_INVOICE_THRESHOLD=n.FREE_TRIAL_TEXT=n.FREE_TRIAL_DAYS=n.CANCELED_STATUS=n.BillingFrequencyDisplay=n.BillingFrequency=void 0;const r=14;n.FREE_TRIAL_DAYS=r;const i="2-week";n.FREE_TRIAL_TEXT=i;const s="now";n.TRIAL_END_NOW=s;const o=40;n.IMMEDIATE_INVOICE_THRESHOLD=o;const a=1565886001e3;n.LEGACY_CREATION_DATE_CUTOFF=a;const l=1629044401e3;n.LEGACY_END_DATE=l;const c=31;n.MAX_FREE_TRIAL_DAYS=c;const u="plugin_";n.STRIPE_PLUGIN_ID_PREFIX=u;const d="editor";n.SOURCE_EDITOR=d;const p="editor_paywall";n.SOURCE_EDITOR_PAYWALL=p;const _="editor_pricing_table";n.SOURCE_EDITOR_PRICING_TABLE=_;const f="editor_switch_annual_cta";n.SOURCE_EDITOR_ANNUAL_CTA=f;const h="workload_plan_table";n.SOURCE_WORKLOAD_PLAN_TABLE=h;let m=function(e){e["Month"]="month";e["Year"]="year";return e}({});n.BillingFrequency=m;const g={[m.Month]:"monthly",[m.Year]:"annually"};n.BillingFrequencyDisplay=g;const v="canceled";n.CANCELED_STATUS=v},{}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.TEST_APP_KEY=n.OLD_TEST_APP_KEY=n.NUMBER_OF_EDIT_TESTS=n.MAX_EDITMODE_TESTS_PER_CHUNK=n.MAIN_RUNMODE_TESTS_APPNAME=n.FUNCTIONAL_TEST_APPNAME_PREFIXES=n.EDITOR_TESTS_APPNAME=n.E2E_TEST_APPS_PREFIX=n.APPS_WITHOUT_PE_INSPECTOR=n.APPS_WITHOUT_PE_HELP_BUTTON=n.APPS_EXCLUDED_FROM_TUTORIALS=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/test_apps",n);const s="test_app_editor";n.EDITOR_TESTS_APPNAME=s;const o="test_app";n.MAIN_RUNMODE_TESTS_APPNAME=o;const a=["learn","demo"];n.APPS_WITHOUT_PE_INSPECTOR=a;const l=["learn",s,"demo"];n.APPS_WITHOUT_PE_HELP_BUTTON=l;const c="test-app-234789asdfjl";n.TEST_APP_KEY=c;const u="test_app_234789asdfjl";n.OLD_TEST_APP_KEY=u;const d=["backup_test_original","backup-test-original","backup_test_restore","backup-test-restore"];n.FUNCTIONAL_TEST_APPNAME_PREFIXES=d;const p="test_app";n.E2E_TEST_APPS_PREFIX=p;const _=["learn","test_app","test_app2","test_app_internal"];n.APPS_EXCLUDED_FROM_TUTORIALS=_;const f=31;n.NUMBER_OF_EDIT_TESTS=f;const h=7;n.MAX_EDITMODE_TESTS_PER_CHUNK=h},{"../safe_require":777}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.YEAR_S=n.YEAR_MS=n.YEAR_MONTH=n.YEAR_H=n.WEEK_S=n.WEEK_MS=n.WEEK_H=n.TimeUnit=n.THIRTY_DAY_S=n.THIRTY_DAY_H=n.SECOND_MS=n.MINUTE_S=n.MINUTE_MS=n.MILLISECONDS_US=n.MILLISECONDS_NS=n.MICROSECONDS_NS=n.HOUR_S=n.HOUR_MS=n.DAY_S=n.DAY_MS=n.DAY_H=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/time",n);const s=12;n.YEAR_MONTH=s;const o=24;n.DAY_H=o;const a=7*o;n.WEEK_H=a;const l=30*o;n.THIRTY_DAY_H=l;const c=365*o;n.YEAR_H=c;const u=60;n.MINUTE_S=u;const d=60*u;n.HOUR_S=d;const p=o*d;n.DAY_S=p;const _=a*d;n.WEEK_S=_;const f=l*d;n.THIRTY_DAY_S=f;const h=c*d;n.YEAR_S=h;const m=1e3;n.SECOND_MS=m;const g=u*m;n.MINUTE_MS=g;const v=d*m;n.HOUR_MS=v;const b=p*m;n.DAY_MS=b;const y=_*m;n.WEEK_MS=y;const w=h*m;n.YEAR_MS=w;const x=1e3;n.MILLISECONDS_US=x;const j=1e6;n.MILLISECONDS_NS=j;const A=1e3;n.MICROSECONDS_NS=A;let M=function(e){e["MINUTE"]="minute";e["HOUR"]="hour";e["DAY"]="day";return e}({});n.TimeUnit=M},{"../safe_require":777}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.MAX_TOKEN_NAME_LENGTH=n.MAX_TOKEN_DESC_LENGTH=n.DELETED_USER_TOKEN_STRING=n.DEFAULT_USER_TOKENS=void 0;const r=" (DELETED)";n.DELETED_USER_TOKEN_STRING=r;const i=30;n.MAX_TOKEN_NAME_LENGTH=i;const s=100;n.MAX_TOKEN_DESC_LENGTH=s;const o={default:{}};n.DEFAULT_USER_TOKENS=o},{}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.YOUR_FIRST_WORKFLOW_VIMEO_ID=n.YOUR_FIRST_DATA_TYPE_VIMEO_ID=n.DESIGNING_IN_BUBBLE_VIMEO_ID=void 0;const r=815725067;n.DESIGNING_IN_BUBBLE_VIMEO_ID=r;const i=815725232;n.YOUR_FIRST_DATA_TYPE_VIMEO_ID=i;const s=815725175;n.YOUR_FIRST_WORKFLOW_VIMEO_ID=s},{}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.KEY_CODE_TO_CHAR=n.ERROR_SOURCES=n.ERROR_CATCHER_TYPES=n.DEFAULT_CATCHER_TYPE=n.CAUGHT_ERROR_SOURCES=void 0;var r=i(e("../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./constants/workflow",n);let s=function(e){e["GENERAL_WORKFLOW"]="general_workflow";e["ELEMENT_WORKFLOW"]="element_workflow";e["ELEMENT"]="element";return e}({});n.ERROR_SOURCES=s;let o=function(e){e["all_wf_errors"]="Any workflow error";e["element_wf_errors"]="Element workflow errors only";return e}({});n.ERROR_CATCHER_TYPES=o;const a="element_wf_errors";n.DEFAULT_CATCHER_TYPE=a;const l={all_wf_errors:[s.GENERAL_WORKFLOW,s.ELEMENT_WORKFLOW,s.ELEMENT],element_wf_errors:[s.ELEMENT_WORKFLOW,s.ELEMENT]};n.CAUGHT_ERROR_SOURCES=l;const c={KeyA:"A",KeyB:"B",KeyC:"C",KeyD:"D",KeyE:"E",KeyF:"F",KeyG:"G",KeyH:"H",KeyI:"I",KeyJ:"J",KeyK:"K",KeyL:"L",KeyM:"M",KeyN:"N",KeyO:"O",KeyP:"P",KeyQ:"Q",KeyR:"R",KeyS:"S",KeyT:"T",KeyU:"U",KeyV:"V",KeyW:"W",KeyX:"X",KeyY:"Y",KeyZ:"Z",Backspace:"Backspace",Tab:"Tab",BracketLeft:"[",BracketRight:"]",Backslash:"\\",Semicolon:";",Quote:"'",Comma:",",Period:".",Slash:"/",Space:"Spacebar",Backquote:"`",Minus:"-",Equal:"=",CapsLock:"Caps Lock",ArrowDown:"Down Arrow",ArrowUp:"Up Arrow",ArrowLeft:"Left Arrow",ArrowRight:"Right Arrow",Enter:"Enter",Escape:"Esc",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F12:"F12",PageUp:"PageUp",PageDown:"PageDown",Delete:"Delete",NumpadAdd:"+",NumpadEnter:"Enter",Numpad1:"1(Numpad)",Numpad2:"2(Numpad)",Numpad3:"3(Numpad)",Numpad4:"4(Numpad)",Numpad5:"5(Numpad)",Numpad6:"6(Numpad)",Numpad7:"7(Numpad)",Numpad8:"8(Numpad)",Numpad9:"9(Numpad)",Numpad0:"0(Numpad)",NumpadDecimal:".(Numpad)",NumpadDivide:"/(Numpad)",NumpadMultiply:"*(Numpad)",NumpadSubtract:"-"};n.KEY_CODE_TO_CHAR=c},{"../safe_require":777}],96:[function(e,t,n){"use strict";const r=n;r.get_manual_link_for_plugin=e=>{var t;return((t=i(e))==null?void 0:t.section_url)||null};function i(e){return s("Plugins").subsections[e]}function s(e){return r.mapping.subsections[e]}r.mapping={subsections:{Introduction:{no_title:true,section_url:"https://manual.bubble.io/core-resources/bubbles-interface"},Interface:{subsections:{MainTabs:{subsections:{"tabs-1":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/design-tab"},"tabs-2":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/workflow-tab"},"tabs-3":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab"},"tabs-4":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/styles-tab"},"tabs-5":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/plugins-tab"},"tabs-6":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/settings-tab"},"tabs-7":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab"},"tabs-8":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/template-tab"}}},ToolBar:{subsections:{Undo:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#undo"},Redo:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#redo"},ResponsiveDropdown:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#viewing-mode"},SelectionMode:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#selection-mode"},ShowHideBorders:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#show-hide-element-edges"},"XRay-mode":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#x-ray-mode"},NoThumbnails:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#disable-element-thumbnails-on-hover"},NoReferenceSnippet:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#disable-reference-snippet-on-hover"},LockPropertyEditor:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#lock-property-editor"},ShowDistances:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#show-distances"},GridSetting:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#grid-options"},ZoomLevel:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#zoom"},Arrange:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#arrange-options"},Preview:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#preview"},SearchPalette:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#search-tool"},FeedbackPopup:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/toolbar#issue-checker"}}},Menu:{subsections:{Undo:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#undo"},Redo:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#redo"},Edit:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#edit"},"Edit page":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#edit-page"},Delete:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#delete"},"Replace the element type":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#replace-by-another-type"},"Replace by another type":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#replace-by-another-type"},"Convert to a reusable element":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#convert-into-a-reusable-element"},"Edit reusable element":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#edit-reusable"},"Detach reusable element":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#detach-reusable-element"},"Group elements in a Group":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#group-elements-in-a-group"},"Group elements in":{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#group-elements-in"},"Fixed container":{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#group-elements-fixed"},"Row container":{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#group-elements-row"},"Column container":{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#group-elements-column"},"Align-to-Parent container":{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#group-elements-align-to-parent"},"Group elements in a Fixed container":{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#group-elements-fixed"},"Group elements in a Row container":{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#group-elements-row"},"Group elements in a Column container":{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#group-elements-column"},"Group elements in an Align-to-Parent container":{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#group-elements-align-to-parent"},"Ungroup these elements":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#ungroup-these-elements"},"Add a new page...":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#add-a-new-page"},"Clone this Page":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#clone-this-page"},"Make this page the new index":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#make-this-page-the-new-index"},"Add a new reusable element...":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#add-a-new-reusable-element"},"Clone this reusable element":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#clone-this-reusable-element"},"Backend workflows":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#backend-workflows"},Cut:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#cut"},Copy:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#copy"},Paste:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste"},Duplicate:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#duplicate"},"Select all":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#select-all"},"Select first parent":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#select-first-parent"},"Copy special":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options"},"Paste special":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options"},"Copy with workflows":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#copy-with-workflows"},"Paste with workflows":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste-with-workflows"},"Copy layout settings":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#copy-layout-settings"},"Paste layout settings":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste-layout-settings"},"Copy formatting":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#copy-formatting"},"Copy style":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#copy-style"},"Paste style":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste-style"},"Paste formatting":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste-formatting"},"Copy conditional expressions":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#copy-conditional-formatting"},"Paste conditional expressions":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste-conditional-formatting"},"Copy condition":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#copy-condition"},"Paste condition":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste-condition"},"Copy expression":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#copy-expression"},"Paste expression":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste-expression"},"Clear expression":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#clear-expression"},"Paste before":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste-before"},"Paste after":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#paste-after"},"Clear all":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#clear-all"},"Bring to front":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#bring-to-front"},"Send to back":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#send-to-back"},"Show all children":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#show-all-children"},"Hide all children":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#hide-all-children"},"Delete all children":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#delete-all-children"},"Center horizontally":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#center-horizontally"},"Center vertically":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#center-vertically"},"Align left":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#align-left"},"Align horizontal centers":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#align-horizontal-centers"},"Align right":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#align-right"},"Align top":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#align-top"},"Align vertical centers":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#align-vertical-centers"},"Align bottom":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#align-bottom"},"Distribute horizontally":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#distribute-horizontally"},"Distribute vertically":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#distribute-vertically"},"Swap element positions":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#swap-element-positions"},"Reveal in Elements tree":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#reveal-in-elements-tree"},"Start/Edit workflow":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#start-edit-workflow"},"Insert an action":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#insert-an-action"},"Reveal the element":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#reveal-the-element"},"Reveal the action":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#reveal-the-action"},"Show short videos":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#show-short-videos"},"Always show all properties":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Cut column":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Copy column":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Copy column with workflows":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Cut row":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Copy row":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Copy row with workflows":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Paste column to right":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Paste column to left":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Paste row above":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Paste row below":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Paste column with workflows to left":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Paste column with workflows to right":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Paste row with workflows above":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Paste row with workflows below":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Select all cells":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Add column to left":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Add column to right":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Add row above":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Add row below":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Copy cell content":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"},"Copy cell content with workflows":{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/top-and-context-menu-options#always-show-all-properties"}}},VersionsDropdown:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown",subsections:{commit_dev:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown#create-save-point"},deploy_to_live:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown#deploy-development-to-live"},create_new_version:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown#create-a-new-version"},sync_with_live:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown#sync-with-live"},add_changes_from:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown#add-changes-from"},history:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown#history-popup"},timestamp_input:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown#date-inputs"},restore:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown#revert-to-this-time"},deploy_list:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/deployment-and-version-control-dropdown#previous-deployments-and-reverts"}}},VersionControlSidepanel:{subsections:{live_branch:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#live-branch"},create_hotfix:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#create-a-hotfix"},create_custom_branch:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#create-a-new-branch"},create_savepoint:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#create-savepoint"},restore_to_savepoint:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#restore-savepoint"},restore_to_custom_date:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#restore-to-custom-date-and-time"},deploy:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#deploy-to-live"},reset_to_live:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#reset-to-live"},edit_description:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#edit-description"},sync_with_main:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#sync-with-main"},sync_with_live:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#sync-with-live"},delete_branch:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#delete"},merge_changes_from_another_branch:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#merge-changes-from-another-branch"},behind_live:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#your-branch-is-out-of-sync-with-live"},main_branch:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/version-control-deployment#the-main-branch"}}},DatabaseViewer:{subsections:{create_view:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#new-view"},quick_search:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#search"},CreateEntry:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#new-entry"},ImportCSV:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#upload"},ModifyCSV:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#modify"},ExportCSV:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#export"},BulkAction:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#bulk-action"},switch_db:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#switch-to-live-switch-to-dev"},copy_db:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#copy-and-restore-database"},ShowPrimaryFieldPopup:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#primary-fields"},CSVUploader:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#upload-data-as-a-csv"},make_data_private:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#make-this-data-type-private"}}},CSVUploader:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#upload-data-as-a-csv",subsections:{type_to_create:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#type-of-data"},delimiter:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#data-delimiter"},pick_file_button:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#pick-a-file-to-upload"},get_fields:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#map-fields"},bubble_field:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#custom-field"},bubble_composite_field:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#composite-field"},list_delimiter_composer:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#list-delimiter"},overwrite_with_empty:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#overwrite-data-when-the-field-value-is-empty"},analyse_data:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#validate-data"},upload_button:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/data-tab#upload-data"},Usage:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#capacity"}}},Usage:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#capacity",subsections:{PageMetrics:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#page-load-metrics",subsections:{Metric:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#metric-to-display"},Percentile:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#percentile"}}}}},WorkflowLogs:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#server-logs",subsections:{from_date:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#basic-filtering"},to_date:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#basic-filtering"},user:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#basic-filtering"},log_keywords:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#basic-filtering"},search_button:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#basic-filtering"},data_area:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/logs-tab#server-log-entries"}}},Comments:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/comments-and-notes"},ElementInspector:{section_url:"https://manual.bubble.io/core-resources/bubbles-interface/design-tab#element-inspector"}}},Elements:{section_url:"https://manual.bubble.io/core-resources/elements",subsections:{GeneralConcepts:{subsections:{Responsive:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties",subsections:{new_responsive:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#enable-responsive-page-rendering-engine"},fixed_width:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#make-this-element-fixed-width"},min_width:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#minimum-width-of-current-width"},use_max_width:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#apply-a-max-width-when-the-page-is-stretched"},max_width:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#maximum-width-of-current-width"},collapse_margin:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#collapse-margins-when-container-width"},responsive_alignment:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#fixed-margin"},wrap_to_previous:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#wrap-to-previous-line-if-the-page-is-stretched"},keep_proportion_resize:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#keep-element-proportions"},visibility_rule:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#add-hiding-rule"},debug_mode:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#debug-mode"},rendering_paused_mode:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#paused-rendering-mode"}}},State:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#conditions",subsections:{condition:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#when"},properties:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#select-a-property-to-change-when-true"},move_up:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#move-up"},move_down:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#move-down"},remove_state:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#remove-condition"},toggle_state:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#on-off"},slug_can_be:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#can-have-the-slug-value-beta"},slug_cannot_be:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#cannot-have-the-slug-value-beta"}}},Transitions:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#transitions",subsections:{duration:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#duration"},duration_fn:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#transition-timing-dropdown"},add_new:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#select-a-property-to-define-a-new-transition"},remove:{section_url:"https://manual.bubble.io/core-resources/elements/conditional-formatting#remove-the-transition"}}},States:{section_url:"https://manual.bubble.io/core-resources/elements/states",subsections:{get_width:{section_url:"https://manual.bubble.io/core-resources/elements/states#...s-width"},get_height:{section_url:"https://manual.bubble.io/core-resources/elements/states#...s-height"},is_hovered:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-hovered"},isnt_hovered:{section_url:"https://manual.bubble.io/core-resources/elements/states#isnt-hovered"},is_pressed:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-pressed"},isnt_pressed:{section_url:"https://manual.bubble.io/core-resources/elements/states#isnt-pressed"},is_focused:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-focused"},isnt_focused:{section_url:"https://manual.bubble.io/core-resources/elements/states#isnt-focused"},is_visible:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-visible"},isnt_visible:{section_url:"https://manual.bubble.io/core-resources/elements/states#isnt-visible"},is_valid:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-valid"},isnt_valid:{section_url:"https://manual.bubble.io/core-resources/elements/states#isnt-valid"},isnt_clickable:{section_url:"https://manual.bubble.io/core-resources/elements/states#isnt-clickable"},get_data:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-value-input"},get_not_data:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-isnt-checked-checkbox"},get_pw_strength:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-password-strength"},get_typed_content:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-typed-text-search-box-input"},get_place_name:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-place-name-search-box-input"},get_group_data:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-content-container"},get_list_data:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-list-repeating-group"},get_loading_status:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-loading-repeating-group-picture-uploader"},page_number:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-page-number-repeating-group"},is_first_page:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-first-page-repeating-group"},is_last_page:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-first-page-repeating-group-1"},get_file_size:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-file-size-file-and-image-uploader"},get_upload_percent:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-upload-percentage-file-uploader"},get_currently_selected_marker:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-current-marker-map"},get_map_center_address:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-center-address"},get_currently_selected_event:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-current-event-calendar"},get_currently_selected_days_event:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-current-days-events-calendar"},get_currently_selected_day:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-current-day-calendar"},get_current_view_range:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-current-date-range-calendar"},get_currently_displayed_image:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-current-slide-slideshow-tinder"},get_current_slidebar_menu_option:{section_url:"https://manual.bubble.io/core-resources/elements/states#s-current-option-slidable-menu"},is_dragged:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-dragged"},is_dragged_over:{section_url:"https://manual.bubble.io/core-resources/elements/states#is-dragged-over"},CustomStates:{section_url:"https://manual.bubble.io/core-resources/elements/states#custom-states"}}},ChangeParentType:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#changing-the-parent-elements-type"},is_visible:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#this-element-is-visible-on-page-load"},switch_element:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#replace-element"},element_style:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#style"},delete_style:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#remove-style"},edit_style:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#edit-style"},select_parent:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#select-parent"},reveal_in_tree:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#reveal-in-elements-tree"},lock_in_editor:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#lock-this-element-not-draggable-in-editor"},unique_id:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#id-attribute-advanced"}}},Page:{section_url:"https://manual.bubble.io/core-resources/elements/page-element",subsections:{page_item_type:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#type-of-content"},readable_field:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#backup-field-for-readable-url"},title:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#page-title"},native_app:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#this-page-is-a-native-app"},native_app_name:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#native-app-name"},mobile_page:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#mobile-version"},preset_width:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#preset-page-width"},preset_width_v1:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#preset-page-width"},meta_title:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#title-for-seo-fb"},meta_description:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#description-for-seo-fb"},meta_image:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#image-for-fb"},html_header:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#page-html-header"},backdrop_background_style:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#background-style"},backdrop_bgcolor:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#background-color"},backdrop_background_gradient_style:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#gradient-style"},backdrop_background_gradient_direction:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#gradient-direction"},backdrop_background_gradient_custom_angle:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#direction-degrees"},backdrop_background_radial_gradient_shape:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#gradient-shape"},backdrop_background_radial_gradient_size:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#gradient-base"},backdrop_background_radial_gradient_xpos:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#x-center-position"},backdrop_background_radial_gradient_ypos:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#y-center-position"},backdrop_background_gradient_from:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#starting-color"},backdrop_background_gradient_to:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#ending-color"},backdrop_background_gradient_mid:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#intermediate-color"},backdrop_background_image:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#background-image"},backdrop_center_background:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#center-the-image"},backdrop_background_size_cover:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#make-image-as-wide-as-parent-element"},backdrop_repeat_background_vertical:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#repeat-the-image-vertically"},backdrop_repeat_background_horizontal:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#repeat-the-image-horizontally"},backdrop_background_color_if_empty_image:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#background-color-if-empty"},backdrop_image_paralax:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#apply-a-parallax-effect-desktop-only"},backdrop_paralax_speed:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#parallax-speed"},backdrop_video_source:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#video-file"},backdrop_video_image_fallback:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#fallback-image"},backdrop_video_silence:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#play-video-silent"},stripes:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#stripes-deprecated"},tz_type:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#time-zone-selection"},tz_static:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#time-zone-selection"},tz_type_overridden:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#time-zone-selection"},tz_static_overridden:{section_url:"https://manual.bubble.io/core-resources/elements/page-element#time-zone-selection"}}},Text:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#text-element",subsections:{text:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#text"},editor_preview_text:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#canvas-placeholder"},cut_off_content:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#cut-off-content-if-the-element-is-not-tall-enough"},text_probably_hidden:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#shrink-the-element-height-if-the-text-gets-shorter"},text_height_options:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#shrink-the-element-height-if-the-text-gets-shorter"},shrink_if_less_high:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#stretch-to-fit-content-non-responsive-mode"},stretch_to_fit:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#stretch-to-fit-content-non-responsive-mode"},no_bbcode:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#do-not-apply-bb-code"},recognize_links:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#recognize-links-and-emails"},link_color:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#link-color"},nofollow:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#mark-the-links-as-nofollow"},tag_type:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#html-tag-for-this-element-seo"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#start-edit-workflow"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#this-element-isnt-clickable"}}},Image:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#image",subsections:{src:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#image-source"},editor_preview_image:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#canvas-placeholder-1"},stretch_or_rescale:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#run-mode-rendering"},crop_data:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#cropping-tool"},alt_tag:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#alt-tag"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#start-edit-workflow-1"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#this-element-isnt-clickable-1"}}},Button:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#button",subsections:{text:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#text-1"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#start-edit-workflow-2"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#this-element-isnt-clickable-2"}}},Link:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#link",subsections:{show_icon:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#show-an-icon-instead-of-text"},text:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#text-2"},icon:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#icon-1"},linktype:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#link-destination"},page:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#destination-page"},data_to_send:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#data-to-send"},url:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#destination-url"},open_in_new_tab:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#open-in-a-new-tab"},link_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#disabled-clicking-on-the-link"},nofollow:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#Elements.Link.nofollow"},add_parameters:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#send-more-parameters-to-the-page"},url_parameters:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#additional-parameters"},keep_current_page_params:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#send-current-page-parameters"},wrap_when_squizzed:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#wrap-the-text-when-the-width-changes"}}},Icon:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#icon",subsections:{icon:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#icon-2"},icon_color:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#icon-color"},spin_icon:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#make-the-icon-rotate"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#start-edit-workflow-3"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#this-element-isnt-clickable-3"}}},Shape:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#shape",subsections:{start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#start-edit-workflow-4"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#this-element-isnt-clickable-4"}}},Video:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#video",subsections:{video_source:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#video-source"},video_id:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#video-id"},autoplay:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#play-the-video-automatically-on-load"},loop:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#replay-video-when-over"},control_color_vimeo:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#video-control-color"},auth_token:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#server-authentication-token"}}},GoogleMap:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#google-maps",subsections:{marker_type:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#number-of-markers"},marker_data_type:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#type-of-markers"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#data-source"},location_field:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#address-field"},show_info_window:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#show-title-window"},marker_caption_expression:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#marker-caption"},autoclose:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#auto-close-window-when-another-is-clicked-on"},map_type:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#map-type"},map_style:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#map-style"},custom_style:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#custom-style-json-object"},allow_zoom_drag:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#allow-zooming-and-dragging"},disable_zoom_scroll:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#disable-zooming-on-scroll"},manual_setting:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#set-center-and-zoom-manually"},center:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#map-centered-on"},initial_zoom:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#initial-zoom"},use_customized_marker_icon:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#use-customized-marker-icon"},use_customized_marker_icon_for_list:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#customized-icon"},custom_marker_icon:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#customized-icon-1"},custom_marker_field:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#icon-field"},custom_selected_icon:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#custom-selected-icon"},custom_selected_icon_image:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#selected-icon"},custom_selected_icon_field:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#selected-icon-field"}}},Alert:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#alert",subsections:{text:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#text-3"},at_to_top:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#position-the-alert-at-the-top"}}},HTML:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#html-element",subsections:{html:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#html"},useiframe:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#display-as-an-iframe"},stretch_to_fit:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#stretch-to-fit-content"},defer_drawing:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#defer-drawing-html"}}},PoweredByBubble:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#built-on-bubble",subsections:{element_type:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#visual-type"},add_border:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#add-a-border"},text_color:{section_url:"https://manual.bubble.io/core-resources/elements/visual-elements#text-color"}}},Group:{section_url:"https://manual.bubble.io/core-resources/elements/containers#group",subsections:{group_type:{section_url:"https://manual.bubble.io/core-resources/elements/containers#type-of-content"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/containers#data-source"},collapse_when_hidden:{section_url:"https://manual.bubble.io/core-resources/elements/containers#collapse-this-elements-height-when-hidden"},collapse_animation:{section_url:"https://manual.bubble.io/core-resources/elements/containers#Elements.Group.collapse_animation"},animation_type:{section_url:"https://manual.bubble.io/core-resources/elements/containers#animate-the-collapse-operation"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/containers#start-edit-workflow"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/containers#this-element-isnt-clickable"},overflow_scroll:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#allow-vertical-scrolling"}}},RepeatingGroup:{section_url:"https://manual.bubble.io/core-resources/elements/containers#repeating-group",subsections:{group_type:{section_url:"https://manual.bubble.io/core-resources/elements/containers#type-of-content-1"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/containers#data-source-1"},layout_style:{section_url:"https://manual.bubble.io/core-resources/elements/containers#layout-style"},auto_fit_row:{section_url:"https://manual.bubble.io/core-resources/elements/containers#stretch-rows-to-fit"},auto_fit_column:{section_url:"https://manual.bubble.io/core-resources/elements/containers#stretch-columns-to-fit"},fixed_rows:{section_url:"https://manual.bubble.io/core-resources/elements/containers#set-fixed-number-of-rows"},rows:{section_url:"https://manual.bubble.io/core-resources/elements/containers#rows"},rows_v1:{section_url:"https://manual.bubble.io/core-resources/elements/containers#rows"},fixed_columns:{section_url:"https://manual.bubble.io/core-resources/elements/containers#set-fixed-number-of-columns"},columns:{section_url:"https://manual.bubble.io/core-resources/elements/containers#columns"},columns_v1:{section_url:"https://manual.bubble.io/core-resources/elements/containers#columns"},cell_min_width:{section_url:"https://manual.bubble.io/core-resources/elements/containers#cell-minimum-width-for-responsive-px"},cell_min_width_css:{section_url:"https://manual.bubble.io/core-resources/elements/containers#min-width-of-column"},cell_min_height_css:{section_url:"https://manual.bubble.io/core-resources/elements/containers#min-height-of-row"},row_cell_gap:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#row-gap-px"},column_cell_gap:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#column-gap-px"},masonry:{section_url:"https://manual.bubble.io/core-resources/elements/containers#display-items-as-masonry-grid"},stable_pagination:{section_url:"https://manual.bubble.io/core-resources/elements/containers#show-partial-list-on-last-page-if-needed"},stable_pagination_v1:{section_url:"https://manual.bubble.io/core-resources/elements/containers#show-partial-list"},allow_more_than_one_colum:{section_url:"https://manual.bubble.io/core-resources/elements/containers#allow-more-than-one-column-when-stretched"},separator_style:{section_url:"https://manual.bubble.io/core-resources/elements/containers#separator-style"},separator_width:{section_url:"https://manual.bubble.io/core-resources/elements/containers#separator-width"},separator_color:{section_url:"https://manual.bubble.io/core-resources/elements/containers#separator-color"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/containers#start-edit-workflow-1"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/containers#this-element-isnt-clickable-1"},scroll_direction:{section_url:"https://manual.bubble.io/core-resources/elements/containers#scroll-direction"},show_all_items:{section_url:"https://manual.bubble.io/core-resources/elements/containers#show-all-items-immediately"}}},Popup:{section_url:"https://manual.bubble.io/core-resources/elements/containers#popup",subsections:{group_type:{section_url:"https://manual.bubble.io/core-resources/elements/containers#type-of-content-2"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/containers#data-source-2"},prevent_user_from_closing_through_esc:{section_url:"https://manual.bubble.io/core-resources/elements/containers#this-popup-cant-be-closed-by-pressing-esc"},greyout_color:{section_url:"https://manual.bubble.io/core-resources/elements/containers#grayout-color"},greyout_blur:{section_url:"https://manual.bubble.io/core-resources/elements/containers#grayout-blur"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/containers#start-edit-workflow-2"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/containers#this-element-isnt-clickable-2"}}},FloatingGroup:{section_url:"https://manual.bubble.io/core-resources/elements/containers#floating-group",subsections:{group_type:{section_url:"https://manual.bubble.io/core-resources/elements/containers#type-of-content-3"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/containers#data-source-3"},floating_reference:{section_url:"https://manual.bubble.io/core-resources/elements/containers#vertically-float-relative-to"},floating_reference_horizontal:{section_url:"https://manual.bubble.io/core-resources/elements/containers#horizontally-float-relative-to"},float_zindex:{section_url:"https://manual.bubble.io/core-resources/elements/containers#floating-zindex"},parallax:{section_url:"https://manual.bubble.io/core-resources/elements/containers#parallax-effect-factor"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/containers#start-edit-workflow-3"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/containers#this-element-isnt-clickable-3"}}},GroupFocus:{section_url:"https://manual.bubble.io/core-resources/elements/containers#group-focus",subsections:{reference:{section_url:"https://manual.bubble.io/core-resources/elements/containers#reference-element"},offset_top:{section_url:"https://manual.bubble.io/core-resources/elements/containers#offset-top"},offset_left:{section_url:"https://manual.bubble.io/core-resources/elements/containers#offset-left"},group_type:{section_url:"https://manual.bubble.io/core-resources/elements/containers#type-of-content-4"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/containers#data-source-4"},collapse_when_hidden:{section_url:"https://manual.bubble.io/core-resources/elements/containers#collapse-this-elements-height-when-hidden-1"},collapse_animation:{section_url:"https://manual.bubble.io/core-resources/elements/containers#animate-the-collapse-operation-1"},animation_type:{section_url:"https://manual.bubble.io/core-resources/elements/containers#animation-style-1"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/elements/containers#start-edit-workflow-4"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/elements/containers#this-element-isnt-clickable-4"}}},GeneralInput:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#general-input-options",subsections:{auto_binding:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#enable-auto-binding-on-parent-elements-thing"},bind_field:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#field-to-modify"},show_alert_on_sucess:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#show-an-alert-on-success"},alert_element:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#alert-to-show"},alert_message:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#alert-message"},mandatory:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#this-input-should-not-be-empty"},disabled:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#this-input-is-disabled"}}},Input:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#input",subsections:{placeholder:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#placeholder"},content:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#initial-content"},content_format:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#content-format"},currency_symbol:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#currency-symbol"},always_show_decimals:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#always-show-decimals"},show_thousands:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#show-thousands-separator"},decimal_place:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#decimal-place"},limit_number_of_characters:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#limit-the-number-of-characters"},not_submit_on_enter:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#prevent-enter-key-from-submitting"},character_limit:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#maximum-number"},have_a_numerical_range:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#set-a-range-min-and-max"},min_range_value:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#minimum-value"},max_range_value:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#maximum-value"},check_password_policy:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#check-the-password-while-typing"},tz_type:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#timezone-type"},tz_static:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#timezone-type"},tz_dynamic:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#timezone-type"},tz_type_overridden:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#timezone-type"},tz_static_overridden:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#timezone-type"},tz_dynamic_overridden:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#timezone-type"}}},MultiLineInput:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#multiline-input",subsections:{placeholder:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#placeholder-1"},content:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#initial-content-1"},limit_number_of_characters:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#limit-the-number-of-characters-1"},character_limit:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#maximum-number-1"},stretch_to_fit:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#stretch-to-fit-content"}}},Checkbox:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#checkbox",subsections:{label:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#label"},contents:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#preset-status"},dynamic:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#dynamic-status"},mandatory:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#this-checkbox-should-be-checked"}}},Dropdown:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#dropdown",subsections:{placeholder:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#placeholder-2"},choices_style:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#choices-style"},choices:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#choices-press-enter-between-each-option"},dynamic_type:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#type-of-choices"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#choices-source"},option_display_expression:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#option-caption"},default:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#default-value"}}},AutocompleteDropdown:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#search-box",subsections:{placeholder:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#placeholder-3"},choices_style:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#choices-style-1"},choices:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#choices-press-enter-between-each-option-1"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#define-list-of-options"},algolia_source:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#define-list-of-options-1"},field_to_search:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#field-to-search"},field_to_display:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#field-to-display"},allow_not_in_list:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#allow-entries-not-in-list"},ac_list_max:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#maximum-entries-to-show"},not_submit_on_enter:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#prevent-enter-key-from-submitting-1"},default:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#default-value-1"},location:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#prefer-results-around"},radius:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#radius-meters"}}},RadioButtons:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#radio-buttons",subsections:{choices_style:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#choices-style-2"},choices:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#choices-press-enter-between-each-option-2"},dynamic_type:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#type-of-choices-1"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#choices-source-1"},option_display_expression:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#option-caption-1"},default:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#default-value-2"},use_dynamic_columns:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#use-dynamic-columns"},columns:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#number-of-columns"},min_column_width_px:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#min-column-width"},color:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#bootstrap-color"}}},SliderInput:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#slider-input",subsections:{min_value:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#min-value"},max_value:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#max-value"},step:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#step"},range_type:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#slider-type"},content:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#initial-content-2"},orientation:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#orientation"},border_color:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#border-color"},background_color:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#background-color"},handle_color:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#handle-color"},range_area_color:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#range-area-color"}}},DateInput:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#date-time-picker",subsections:{input_type:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#input-type"},content:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#initial-content-3"},overwrite_placeholder:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#customize-the-input-placeholder"},placeholder:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#placeholder-4"},date_format:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#date-format"},custom_format:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#custom-format"},start_monday:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#start-the-week-on-monday"},show_month_year_picker:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#display-dropdowns-to-pick-month-year"},time_interval:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#time-interval"},time_format:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#time-format"},min_date:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#minimum-date"},max_date:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#maximum-date"},min_hour:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#minimum-hour"},max_hour:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#maximum-hour"},tz_type:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#time-zone-selection"},tz_static:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#time-zone-selection"},tz_dynamic:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#time-zone-selection"},tz_type_overridden:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#time-zone-selection"},tz_static_overridden:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#time-zone-selection"},tz_dynamic_overridden:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#time-zone-selection"}}},PictureInput:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#picture-uploader",subsections:{placeholder:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#placeholder-5"},src:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#default"},private:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#make-this-file-private"},attach_to:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#attach-this-file-to"},service:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#storage-service"},destination:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#folder-path"},limit_image_width:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#limit-image-size-before-upload"}}},FileInput:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#file-uploader",subsections:{placeholder:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#placeholder-6"},src:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#default-1"},private:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#make-this-file-private-1"},attach_to:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#attach-this-file-to-1"},service:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#storage-service-1"},destination:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#folder-path-1"},max_size:{section_url:"https://manual.bubble.io/core-resources/elements/input-forms#max-file-size-mb"}}},CustomDefinition:{section_url:"https://manual.bubble.io/core-resources/elements/reusable-elements",subsections:{element_type:{section_url:"https://manual.bubble.io/core-resources/elements/reusable-elements#type-of-element"},group_type:{section_url:"https://manual.bubble.io/core-resources/elements/reusable-elements#type-of-content"},data_source:{section_url:"https://manual.bubble.io/core-resources/elements/reusable-elements#data-source"},delete_custom_definition:{section_url:"https://manual.bubble.io/core-resources/elements/reusable-elements#delete-this-reusable-element"}}}}},PropertyApplications:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties",subsections:{Dimensions:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#dimensions",subsections:{width:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#width"},width_v1:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#width"},height:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#height"},height_v1:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#height"},left:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#left"},left_v1:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#x"},top:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#top"},top_v1:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#y"},rotation_angle:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#rotation-angle"}}},Opacity:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#opacity",subsections:{opacity:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#opacity"}}},BoxShadow:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#shadows",subsections:{boxshadow_style:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#shadow-style"},boxshadow_horizontal:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#horizontal-offset"},boxshadow_vertical:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#vertical-offset"},boxshadow_blur:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#shadow-blur-radius"},boxshadow_spread:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#shadow-spread-radius"},boxshadow_color:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#shadow-color"}}},Font:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font-options",subsections:{font_face:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font"},font_family:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font"},font_weight:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font"},font_size:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font-size"},bold:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#bold"},italic:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#italic"},underline:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#underline"},font_alignment:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#text-alignment"},font_color:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font-color"},placeholder_color:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#placeholder-color"}}},FontShadow:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font-shadow",subsections:{textshadow:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#show-text-shadow"},textshadow_horizontal:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#horizontal-offset-1"},textshadow_vertical:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#vertical-offset-1"},textshadow_blur:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font-shadow-blur-radius"},textshadow_color:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font-shadow-color"}}},FontSpacing:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#font-options-1",subsections:{word_spacing:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#word-spacing"},line_height:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#line-spacing"},letter_spacing:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#letter-spacing"}}},Border:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#borders",subsections:{four_border_style:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#define-each-border-independently"},border_style:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#border-style"},border_roundness:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#border-roundness"},border_width:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#border-width"},border_color:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#border-color"}}},ToolTip:{subsections:{title_attribute:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#tooltip-on-hover"}}},Padding:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#padding",subsections:{padding_vertical:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#vertical-padding"},padding_horizontal:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#horizontal-padding"},vertical_centering:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#center-the-text-vertically"}}},PaddingFields:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#padding",subsections:{padding_label:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#padding"},padding_reset:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#reset"},padding_edit_style:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#edit-style-1"},padding_top:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#padding-top"},padding_bottom:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#padding-bottom"},padding_left:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#padding-left"},padding_right:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#padding-right"}}},ResponsiveElement:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types",subsections:{nonant_alignment:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#pin-to-nonant-selection"},vert_alignment:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#vertical-alignment"},horiz_alignment:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#horizontal-alignment"},margin_label:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#margins"},margin_top:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#margin-top"},margin_right:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#margin-right"},margin_bottom:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#margin-bottom"},margin_left:{section_url:"https://manual.bubble.io/core-resources/elements/shared-properties#margin-left"},parent_container_type_label:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#parent-container-type"},use_aspect_ratio:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#keep-element-aspect-ratio-fixed"},single_width:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#make-this-element-fixed-width"},single_height:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#make-this-element-fixed-height"},min_width_css:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#min-width"},min_height_css:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#min-height"},max_height_css:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#max-height"},fit_height:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#fit-height-to-content"},flex_move_first_row:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#make-first-row"},flex_move_prev_row:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#previous-row"},flex_move_next_row:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#next-row"},flex_move_last_row:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#make-last-row"},flex_move_first_col:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#make-first-column"},flex_move_prev_col:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#previous-column"},flex_move_next_col:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#next-column"},flex_move_last_col:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#make-last-column"}}},ResponsiveContainer:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types",subsections:{container_layout:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types"},container_layout_rg:{section_url:"https://manual.bubble.io/core-resources/elements/containers#container-layout-type"},container_horiz_alignment:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#container-alignment"},container_vert_alignment:{section_url:"https://manual.bubble.io/core-resources/elements/container-layout-types#container-alignment-column"},use_gap:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#apply-gap-spacing"},row_gap:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#row-gap-px"},column_gap:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#column-gap-px"}}},RootSizing:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties",subsections:{default_width:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#width-for-ui-builder"},min_width_px:{section_url:"https://manual.bubble.io/core-resources/elements/responsive-properties#min-width"}}},Background:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#background",subsections:{background_style:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#background-style"},bgcolor:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#background-color"},background_gradient_style:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#gradient-style"},background_gradient_direction:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#gradient-direction"},background_gradient_custom_angle:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#direction-degrees"},background_radial_gradient_shape:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#gradient-shape"},background_radial_gradient_size:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#gradient-base"},background_radial_gradient_xpos:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#x-center-position"},background_radial_gradient_ypos:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#y-center-position"},background_gradient_from:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#starting-color"},background_gradient_to:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#ending-color"},background_gradient_mid:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#intermediate-color"},background_image:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#background-image"},center_background:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#center-the-image"},background_size_cover:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#make-image-as-wide-as-parent-element"},crop_responsive:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#crop-the-image-to-fit-the-element-size"},repeat_background_vertical:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#repeat-the-image-vertically"},repeat_background_horizontal:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#repeat-the-image-horizontally"},background_color_if_empty_image:{section_url:"https://manual.bubble.io/core-resources/elements/styling-properties#background-color-if-empty"}}}}},Workflow:{section_url:"https://manual.bubble.io/core-resources/workflows",subsections:{condition:{section_url:"https://manual.bubble.io/core-resources/workflows#condition"},element_id:{section_url:"https://manual.bubble.io/core-resources/workflows#element"},wf_folder:{section_url:"https://manual.bubble.io/core-resources/workflows#workflow-folder"},event_color:{section_url:"https://manual.bubble.io/core-resources/workflows#event-color"},breakpoint:{section_url:"https://manual.bubble.io/core-resources/workflows#add-a-breakpoint-in-debug-mode"},workflow_disabled:{section_url:"https://manual.bubble.io/core-resources/workflows#disable-workflow"}}},Events:{section_url:"https://manual.bubble.io/core-resources/events",subsections:{PageLoaded:{section_url:"https://manual.bubble.io/core-resources/events/general-events#page-is-loaded"},LoggedIn:{section_url:"https://manual.bubble.io/core-resources/events/general-events#user-is-logged-in"},LoggedOut:{section_url:"https://manual.bubble.io/core-resources/events/general-events#user-is-logged-out"},DoInterval:{section_url:"https://manual.bubble.io/core-resources/events/general-events#do-every-x-seconds",subsections:{interval:{section_url:"https://manual.bubble.io/core-resources/events/general-events#interval"}}},ConditionTrue:{section_url:"https://manual.bubble.io/core-resources/events/general-events#do-when-condition-is-true",subsections:{run_when:{section_url:"https://manual.bubble.io/core-resources/events/general-events#run-this"}}},ButtonClicked:{section_url:"https://manual.bubble.io/core-resources/events/element-events#an-element-is-clicked"},OnError:{section_url:"https://manual.bubble.io/core-resources/events/element-events#an-element-has-an-error-running-a-workflow"},OnPageError:{section_url:"https://manual.bubble.io/core-resources/events/general-events#an-unhandled-error-occurs",subsections:{caught_error_origins:{section_url:"https://manual.bubble.io/core-resources/events/general-events#error-sources-to-catch"}}},InputChanged:{section_url:"https://manual.bubble.io/core-resources/events/element-events#an-inputs-value-is-changed"},PopupOpened:{section_url:"https://manual.bubble.io/core-resources/events/element-events#a-popup-is-opened"},PopupClosed:{section_url:"https://manual.bubble.io/core-resources/events/element-events#a-popup-is-closed"},MapMarkerClicked:{section_url:"https://manual.bubble.io/core-resources/events/element-events#a-maps-marker-is-clicked"},CustomEvent:{section_url:"https://manual.bubble.io/core-resources/events/custom-events",subsections:{event_name:{section_url:"https://manual.bubble.io/core-resources/events/custom-events#event-name"},parameters:{section_url:"https://manual.bubble.io/core-resources/events/custom-events#call-parameters"}}},RecurringEvent:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event",subsections:{event_name:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event#event-name"},custom_event_data_type:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event#type-of-thing"},ignore_privacy_rules:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event#ignore-privacy-rules-when-running-the-workflow"},tz_type:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event#timezone-selection"},tz_static:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event#timezone-selection"},tz_dynamic:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event#timezone-selection"},tz_type_overridden:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event#timezone-selection"},tz_static_overridden:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event#timezone-selection"},tz_dynamic_overridden:{section_url:"https://manual.bubble.io/core-resources/events/recurring-event#timezone-selection"}}},DatabaseTriggerEvent:{section_url:"https://manual.bubble.io/core-resources/events/trigger-event",subsections:{event_name:{section_url:"https://manual.bubble.io/core-resources/events/trigger-event#event-name"},data_trigger_type:{section_url:"https://manual.bubble.io/core-resources/events/trigger-event#type-of-thing"},tz_type:{section_url:"https://manual.bubble.io/core-resources/events/trigger-event#timezone-selection"},tz_static:{section_url:"https://manual.bubble.io/core-resources/events/trigger-event#timezone-selection"},tz_dynamic:{section_url:"https://manual.bubble.io/core-resources/events/trigger-event#timezone-selection"},tz_type_overridden:{section_url:"https://manual.bubble.io/core-resources/events/trigger-event#timezone-selection"},tz_static_overridden:{section_url:"https://manual.bubble.io/core-resources/events/trigger-event#timezone-selection"},tz_dynamic_overridden:{section_url:"https://manual.bubble.io/core-resources/events/trigger-event#timezone-selection"}}}}},Actions:{section_url:"https://manual.bubble.io/core-resources/actions",subsections:{SignUp:{section_url:"https://manual.bubble.io/core-resources/actions/account#sign-the-user-up",subsections:{email:{section_url:"https://manual.bubble.io/core-resources/actions/account#email"},password:{section_url:"https://manual.bubble.io/core-resources/actions/account#password"},require_confirm:{section_url:"https://manual.bubble.io/core-resources/actions/account#require-a-password-confirmation"},password2:{section_url:"https://manual.bubble.io/core-resources/actions/account#password-confirmation"},send_confirm_email:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-an-email-to-confirm-the-email"},page:{section_url:"https://manual.bubble.io/core-resources/actions/account#confirmation-page"},remember_email:{section_url:"https://manual.bubble.io/core-resources/actions/account#remember-the-email"},changes:{section_url:"https://manual.bubble.io/core-resources/actions/account#change-another-field"}}},LogIn:{section_url:"https://manual.bubble.io/core-resources/actions/account#log-the-user-in",subsections:{email:{section_url:"https://manual.bubble.io/core-resources/actions/account#email-1"},password:{section_url:"https://manual.bubble.io/core-resources/actions/account#password-1"},stay_logged_in:{section_url:"https://manual.bubble.io/core-resources/actions/account#stay-logged-in"},remember_email:{section_url:"https://manual.bubble.io/core-resources/actions/account#remember-the-email-1"}}},CookieOptIn:{section_url:"https://manual.bubble.io/core-resources/actions/account#opt-in-to-cookies"},CookieOptOut:{section_url:"https://manual.bubble.io/core-resources/actions/account#opt-out-from-cookies"},OAuthLogin:{section_url:"https://manual.bubble.io/core-resources/actions/account#signup-login-with-a-social-network",subsections:{oauth_provider:{section_url:"https://manual.bubble.io/core-resources/actions/account#oauth-provider"}}},LogOut:{section_url:"https://manual.bubble.io/core-resources/actions/account#log-the-user-out"},UpdateCredentials:{section_url:"https://manual.bubble.io/core-resources/actions/account#update-the-users-credentials",subsections:{old_password:{section_url:"https://manual.bubble.io/core-resources/actions/account#old-password"},change_email:{section_url:"https://manual.bubble.io/core-resources/actions/account#change-email"},email:{section_url:"https://manual.bubble.io/core-resources/actions/account#email-2"},change_password:{section_url:"https://manual.bubble.io/core-resources/actions/account#change-password"},password:{section_url:"https://manual.bubble.io/core-resources/actions/account#new-password"},require_confirm:{section_url:"https://manual.bubble.io/core-resources/actions/account#require-password-confirmation"},password2:{section_url:"https://manual.bubble.io/core-resources/actions/account#confirmation"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/actions/account#do-not-show-success-message"},send_confirm_email:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-an-email-to-confirm-the-email-1"},page:{section_url:"https://manual.bubble.io/core-resources/actions/account#confirmation-page-1"}}},MakeChangeCurrentUser:{section_url:"https://manual.bubble.io/core-resources/actions/account#make-changes-to-current-user",subsections:{changes:{section_url:"https://manual.bubble.io/core-resources/actions/account#changes"}}},SendConfirmationEmail:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-confirmation-email",subsections:{page:{section_url:"https://manual.bubble.io/core-resources/actions/account#confirmation-page-2"},just_make_token:{section_url:"https://manual.bubble.io/core-resources/actions/account#create-a-token-without-sending-an-email"}}},SendPasswordResetEmail:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-password-reset-email",subsections:{to:{section_url:"https://manual.bubble.io/core-resources/actions/account#email-to-reset"},subject:{section_url:"https://manual.bubble.io/core-resources/actions/account#subject"},body:{section_url:"https://manual.bubble.io/core-resources/actions/account#body"},just_make_token:{section_url:"https://manual.bubble.io/core-resources/actions/account#just-make-token-dont-send-email"}}},ResetPassword:{section_url:"https://manual.bubble.io/core-resources/actions/account#reset-password",subsections:{new_password:{section_url:"https://manual.bubble.io/core-resources/actions/account#password-2"},new_password_again:{section_url:"https://manual.bubble.io/core-resources/actions/account#confirmation-1"}}},SendMagicLink:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-magic-login-link",subsections:{valid_link_time_frame:{section_url:"https://manual.bubble.io/core-resources/actions/account#time-expiration-hrs"},email:{section_url:"https://manual.bubble.io/core-resources/actions/account#email-3"},subject:{section_url:"https://manual.bubble.io/core-resources/actions/account#subject-1"},body:{section_url:"https://manual.bubble.io/core-resources/actions/account#body-1"},link_text:{section_url:"https://manual.bubble.io/core-resources/actions/account#magic-link-text"},just_make_link:{section_url:"https://manual.bubble.io/core-resources/actions/account#just-create-link-dont-send-email"},success_page:{section_url:"https://manual.bubble.io/core-resources/actions/account#redirect-on-success"},failure_page:{section_url:"https://manual.bubble.io/core-resources/actions/account#redirect-on-failure"},success_customize:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-data-on-login"},failure_customize:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-data-on-failure"},data_to_send_success:{section_url:"https://manual.bubble.io/core-resources/actions/account#data-to-send"},data_to_send_failure:{section_url:"https://manual.bubble.io/core-resources/actions/account#data-to-send"},add_parameters_success:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-more-parameters-to-the-page"},add_parameters_failure:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-more-parameters-to-the-page"},keep_current_page_params_success:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-current-page-parameters"},keep_current_page_params_failure:{section_url:"https://manual.bubble.io/core-resources/actions/account#send-current-page-parameters"},url_parameters_success:{section_url:"https://manual.bubble.io/core-resources/actions/account#additional-parameters"},url_parameters_failure:{section_url:"https://manual.bubble.io/core-resources/actions/account#additional-parameters"}}},CreateUserAccount:{section_url:"https://manual.bubble.io/core-resources/actions/account#create-an-account-for-someone-else",subsections:{email:{section_url:"https://manual.bubble.io/core-resources/actions/account#email-3"},password:{section_url:"https://manual.bubble.io/core-resources/actions/account#password-3"},return_user_if_already_exists:{section_url:"https://manual.bubble.io/core-resources/actions/account#return-the-user-if-the-account-already-exists"},changes:{section_url:"https://manual.bubble.io/core-resources/actions/account#changes-1"}}},CheckUserPassword:{section_url:"https://manual.bubble.io/core-resources/actions/account#check-password-for-the-current-user",subsections:{password:{section_url:"https://manual.bubble.io/core-resources/actions/account#password-4"}}},SetTemporaryPassword:{section_url:"https://manual.bubble.io/core-resources/actions/account#assign-a-temp-password-to-a-user",subsections:{user:{section_url:"https://manual.bubble.io/core-resources/actions/account#user"}}},ChangeEmailForAnotherUser:{section_url:"https://manual.bubble.io/core-resources/actions/account#change-the-email-for-another-user",subsections:{user:{section_url:"https://manual.bubble.io/core-resources/actions/account#user-1"},new_email:{section_url:"https://manual.bubble.io/core-resources/actions/account#new-email"}}},LogOutOtherSessions:{section_url:"https://manual.bubble.io/core-resources/actions/account#log-out-other-users-sessions"},Generate2FAQRCode:{section_url:"https://manual.bubble.io/core-resources/actions/account#generate-a-2fa-qr-code",subsections:{password:{section_url:"https://manual.bubble.io/core-resources/actions/account#password-5"}}},Validate2FAToken:{section_url:"https://manual.bubble.io/core-resources/actions/account#validate-token-and-activate-2fa",subsections:{token:{section_url:"https://manual.bubble.io/core-resources/actions/account#token"}}},Check2FAToken:{section_url:"https://manual.bubble.io/core-resources/actions/account#check-2fa-token",subsections:{token:{section_url:"https://manual.bubble.io/core-resources/actions/account#token-1"},valid_30_days:{section_url:"https://manual.bubble.io/core-resources/actions/account#valid_-30-_days"}}},Disable2FA:{section_url:"https://manual.bubble.io/core-resources/actions/account#disable-2fa-for-the-current-user",subsections:{password:{section_url:"https://manual.bubble.io/core-resources/actions/account#password-6"},token:{section_url:"https://manual.bubble.io/core-resources/actions/account#token-2"}}},GenerateOneTimeCodes:{section_url:"https://manual.bubble.io/core-resources/actions/account#generate-one-time-backup-codes",subsections:{password:{section_url:"https://manual.bubble.io/core-resources/actions/account#password-7"},token:{section_url:"https://manual.bubble.io/core-resources/actions/account#token-3"},number_of_codes:{section_url:"https://manual.bubble.io/core-resources/actions/account#number_of_codes"}}},ChangePage:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#go-to-page",subsections:{data_to_send:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#data-to-send"},dynamic_page_name:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#dynamic-page-name"},open_in_new_tab:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#open-in-a-new-tab"},add_parameters:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#send-more-parameters-to-the-page"},url_parameters:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#additional-parameters"},keep_current_page_params:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#send-current-page-parameters"},replace_history:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#replace-the-entry-in-the-browser-history"}}},RefreshPage:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#refresh-the-page"},GoPrevious:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#go-to-previous-page"},OpenURL:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#open-an-external-website",subsections:{url:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#destination"},open_in_new_tab:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#open-in-a-new-tab-1"}}},PauseWFClient:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#add-a-pause-before-next-action",subsections:{length:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#pause-length-ms"},hide_status_bar:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#hide-the-status-bar-as-the-pause-occurs"}}},ScrollToElement:{section_url:"https://manual.bubble.io/core-resources/actions/element#scroll-to-an-element",subsections:{offset:{section_url:"https://manual.bubble.io/core-resources/actions/element#offset-pixels"}}},AnimateElement:{section_url:"https://manual.bubble.io/core-resources/actions/element#animate-an-element",subsections:{animation:{section_url:"https://manual.bubble.io/core-resources/actions/element#animation"},customize_duration:{section_url:"https://manual.bubble.io/core-resources/actions/element#define-a-custom-duration"},duration:{section_url:"https://manual.bubble.io/core-resources/actions/element#duration-ms"}}},NewThing:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#create-a-new-thing",subsections:{thing_type:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#type"},initial_values:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#initial-values"}}},ChangeThing:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#make-changes-to-thing",subsections:{to_change:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#thing-to-change"},create_if_missing:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#create-if-the-thing-doesnt-exist"},changes:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#changes"},subsections:{add:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#add"},remove:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#remove"},set_list:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#set-list"},add_list:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#add-list"},remove_list:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#remove-list"},clear_list:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#clear-list"}}}},ChangeListOfThings:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#make-changes-to-a-list-of-things",subsections:{type_to_change:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#type-of-things"},to_change:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#list-to-change"},changes:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#changes-1"}}},DeleteThing:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#delete-thing",subsections:{to_delete:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#to-delete"}}},DeleteListOfThings:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#delete-a-list-of-things",subsections:{type_to_delete:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#type-of-things-1"},to_delete:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#list-to-delete"}}},SetSlug:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#set-a-things-slug-beta",subsections:{to_change:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#thing-to-change-1"},slug:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#slug-beta"}}},CopyListOfThings:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#copy-a-list-of-things",subsections:{type_to_copy:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#list-to-copy"},to_copy:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#list-to-copy"}}},DownloadDataAsCSV:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#download-data-as-csv",subsections:{data_type:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#type-of-data"},data_source:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#data-source"},file_name:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#file-name"},date_formatting:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#date-formatting"},custom_format:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#custom-date-format"},separator:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#separator"},show_labels:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#include-labels-in-first-row"},use_caption_labels:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#use-field-captions-instead-of-ids"},use_quotes:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#wrap-values-in-double-quotes"},hide_some_fields:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#hidden-columns"}}},UploadCSVData:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#upload-data-as-csv",subsections:{data_type:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#type-of-data-1"},file:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#csv-file"},separator:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#separator-1"}}},DeleteUploadedFile:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#delete-an-uploaded-file",subsections:{url_to_delete:{section_url:"https://manual.bubble.io/core-resources/actions/data-things#file-url"}}},SendEmail:{section_url:"https://manual.bubble.io/core-resources/actions/email#send-email",subsections:{to:{section_url:"https://manual.bubble.io/core-resources/actions/email#to"},different_reply_to:{section_url:"https://manual.bubble.io/core-resources/actions/email#specify-a-different-reply-to-address"},replyTo:{section_url:"https://manual.bubble.io/core-resources/actions/email#reply-to"},sender_name:{section_url:"https://manual.bubble.io/core-resources/actions/email#sender-name"},cc:{section_url:"https://manual.bubble.io/core-resources/actions/email#cc"},bcc:{section_url:"https://manual.bubble.io/core-resources/actions/email#bcc"},subject:{section_url:"https://manual.bubble.io/core-resources/actions/email#subject"},body:{section_url:"https://manual.bubble.io/core-resources/actions/email#body"},ignore_template:{section_url:"https://manual.bubble.io/core-resources/actions/email#do-not-apply-a-sendgrid-template"},list_of_attachments:{section_url:"https://manual.bubble.io/core-resources/actions/email#attachments"},unsubscribe_group_id:{section_url:"https://manual.bubble.io/core-resources/actions/email#unsubscribe_group_id"}}},TriggerCustomEvent:{section_url:"https://manual.bubble.io/core-resources/actions/custom",subsections:{custom_event:{section_url:"https://manual.bubble.io/core-resources/actions/custom#custom-event"},arguments:{section_url:"https://manual.bubble.io/core-resources/actions/custom#workflow-parameters"},workflow_thing:{section_url:"DEPRECATED"}}},TriggerCustomOnChange:{section_url:"https://manual.bubble.io/core-resources/actions/custom#trigger-a-custom-event-when-data-changes",subsections:{custom_event:{section_url:"https://manual.bubble.io/core-resources/actions/custom#custom-event-1"},workflow_thing:{section_url:"https://manual.bubble.io/core-resources/actions/custom#parameter"},field:{section_url:"https://manual.bubble.io/core-resources/actions/custom#field"}}},ScheduleCustom:{section_url:"https://manual.bubble.io/core-resources/actions/custom#schedule-a-custom-event",subsections:{custom_event:{section_url:"https://manual.bubble.io/core-resources/actions/custom#custom-event-2"},arguments:{section_url:"https://manual.bubble.io/core-resources/actions/custom#workflow-parameters-1"},delay:{section_url:"https://manual.bubble.io/core-resources/actions/custom#delay"},workflow_thing:{section_url:"DEPRECATED"}}},TriggerCustomEventFromReusable:{section_url:"https://manual.bubble.io/core-resources/actions/custom#trigger-a-custom-event-from-a-reusable-element",subsections:{element_id:{section_url:"https://manual.bubble.io/core-resources/actions/custom#reusable-element"},custom_event:{section_url:"https://manual.bubble.io/core-resources/actions/custom#custom-event-3"},arguments:{section_url:"https://manual.bubble.io/core-resources/actions/custom#workflow-parameters-2"},workflow_thing:{section_url:"DEPRECATED"}}},ScheduleAPIEvent:{section_url:"https://manual.bubble.io/core-resources/actions/custom#schedule-api-workflow",subsections:{api_event:{section_url:"https://manual.bubble.io/core-resources/actions/custom#api-workflow"},date:{section_url:"https://manual.bubble.io/core-resources/actions/custom#scheduled-date"},ignore_privacy_rules:{section_url:"https://manual.bubble.io/core-resources/actions/custom#ignore-privacy-rules-when-running-the-workflow"},parameters:{section_url:"https://manual.bubble.io/core-resources/actions/custom#workflow-parameters-3"}}},ScheduleAPIEventOnList:{section_url:"https://manual.bubble.io/core-resources/actions/custom#schedule-api-workflow-on-a-list",subsections:{type_of_list:{section_url:"https://manual.bubble.io/core-resources/actions/custom#type-of-things"},data_source:{section_url:"https://manual.bubble.io/core-resources/actions/custom#list-to-run-on"},api_event:{section_url:"https://manual.bubble.io/core-resources/actions/custom#api-workflow-1"},date:{section_url:"https://manual.bubble.io/core-resources/actions/custom#scheduled-date-1"},interval:{section_url:"https://manual.bubble.io/core-resources/actions/custom#interval-seconds"},ignore_privacy_rules:{section_url:"https://manual.bubble.io/core-resources/actions/custom#ignore-privacy-rules-when-running-the-workflow-1"},parameters:{section_url:"https://manual.bubble.io/core-resources/actions/custom#workflow-parameters-4"}}},CancelScheduledAPIEvent:{section_url:"https://manual.bubble.io/core-resources/actions/custom#cancel-a-scheduled-api-workflow",subsections:{scheduled_id:{section_url:"https://manual.bubble.io/core-resources/actions/custom#scheduled-api-id"}}},CancelListScheduledAPIEvent:{section_url:"https://manual.bubble.io/core-resources/actions/custom#cancel-a-list-of-scheduled-api-workflows",subsections:{scheduled_ids:{section_url:"https://manual.bubble.io/core-resources/actions/custom#list-of-scheduled-api-ids"}}},SetRecurringEvent:{section_url:"https://manual.bubble.io/core-resources/actions/custom#set-cancel-a-recurring-event",subsections:{recurring_event:{section_url:"https://manual.bubble.io/core-resources/actions/custom#recurring-event"},workflow_thing:{section_url:"https://manual.bubble.io/core-resources/actions/custom#workflow-thing-4"},frequency:{section_url:"https://manual.bubble.io/core-resources/actions/custom#frequency"},start_date:{section_url:"https://manual.bubble.io/core-resources/actions/custom#start-date"}}},SendICSFileEmail:{section_url:"https://manual.bubble.io/core-resources/actions/email#send-meeting-request-by-email",subsections:{to:{section_url:"https://manual.bubble.io/core-resources/actions/email#to-1"},sender_name:{section_url:"https://manual.bubble.io/core-resources/actions/email#sender-name-1"},ORGANIZER:{section_url:"https://manual.bubble.io/core-resources/actions/email#organizer"},SEQUENCE:{section_url:"https://manual.bubble.io/core-resources/actions/email#sequence"},METHOD:{section_url:"https://manual.bubble.io/core-resources/actions/email#method"},UID:{section_url:"https://manual.bubble.io/core-resources/actions/email#uid"},STATUS:{section_url:"https://manual.bubble.io/core-resources/actions/email#status"},start:{section_url:"https://manual.bubble.io/core-resources/actions/email#start-time"},specify_length:{section_url:"https://manual.bubble.io/core-resources/actions/email#set-a-length-instead-of-an-end-time"},end:{section_url:"https://manual.bubble.io/core-resources/actions/email#end-time"},event_length:{section_url:"https://manual.bubble.io/core-resources/actions/email#length-minutes"},summary:{section_url:"https://manual.bubble.io/core-resources/actions/email#summary"},event_description:{section_url:"https://manual.bubble.io/core-resources/actions/email#description"},location:{section_url:"https://manual.bubble.io/core-resources/actions/email#location"},change_body:{section_url:"https://manual.bubble.io/core-resources/actions/email#change-the-body-of-the-email"},body:{section_url:"https://manual.bubble.io/core-resources/actions/email#body-1"},ignore_template:{section_url:"https://manual.bubble.io/core-resources/actions/email#do-not-apply-a-sendgrid-template-1"}}},ShowElement:{section_url:"https://manual.bubble.io/core-resources/actions/element#show-an-element"},HideElement:{section_url:"https://manual.bubble.io/core-resources/actions/element#hide-an-element",subsections:{animation:{section_url:"https://manual.bubble.io/core-resources/actions/element#animation-native-app"},direction:{section_url:"https://manual.bubble.io/core-resources/actions/element#animation-direction"}}},TerminateWorkflow:{section_url:"https://manual.bubble.io/core-resources/actions/navigation#terminate-this-workflow"},ToggleElement:{section_url:"https://manual.bubble.io/core-resources/actions/element#toggle-an-element"},SetCustomState:{section_url:"https://manual.bubble.io/core-resources/actions/element#set-state-of-an-element",subsections:{custom_state:{section_url:"https://manual.bubble.io/core-resources/actions/element#custom-state"},value:{section_url:"https://manual.bubble.io/core-resources/actions/element#value"},custom_states_values:{section_url:"https://manual.bubble.io/core-resources/actions/element#set-another-state"}}},SetFocusToElement:{section_url:"https://manual.bubble.io/core-resources/actions/element#set-focus-to-an-input-element"},ResetInputs:{section_url:"https://manual.bubble.io/core-resources/actions/element#reset-relevant-inputs"},CancelUpload:{section_url:"https://manual.bubble.io/core-resources/actions/element#cancel-upload-of-a-file-uploader"},AlertShowMessage:{section_url:"https://manual.bubble.io/core-resources/actions/element#show-message-in-an-alert-box",subsections:{fade_in:{section_url:"https://manual.bubble.io/core-resources/actions/element#fade-in-ms"},hold:{section_url:"https://manual.bubble.io/core-resources/actions/element#hold-ms"},fade_out:{section_url:"https://manual.bubble.io/core-resources/actions/element#fade-out-ms"},change_message:{section_url:"https://manual.bubble.io/core-resources/actions/element#change-the-alert-message"},message:{section_url:"https://manual.bubble.io/core-resources/actions/element#message"}}},DisplayGroupData:{section_url:"https://manual.bubble.io/core-resources/actions/element#display-data-in-a-group-popup",subsections:{data_source:{section_url:"https://manual.bubble.io/core-resources/actions/element#data-to-display"}}},ResetGroup:{section_url:"https://manual.bubble.io/core-resources/actions/element#reset-a-group-popup"},DisplayListData:{section_url:"https://manual.bubble.io/core-resources/actions/element#display-list-in-a-repeating-group",subsections:{data_source:{section_url:"https://manual.bubble.io/core-resources/actions/element#data-source"}}},ListClear:{section_url:"https://manual.bubble.io/core-resources/actions/element#clear-list-in-a-repeating-group"},ListShowNext:{section_url:"https://manual.bubble.io/core-resources/actions/element#show-next-of-a-repeating-group",subsections:{wrap_around:{section_url:"https://manual.bubble.io/core-resources/actions/element#wrap-around"}}},ListShowPrevious:{section_url:"https://manual.bubble.io/core-resources/actions/element#show-previous-of-a-repeating-group",subsections:{wrap_around:{section_url:"https://manual.bubble.io/core-resources/actions/element#wrap-around-1"}}},ListGoToPage:{section_url:"https://manual.bubble.io/core-resources/actions/element#go-to-page-of-a-repeating-group",subsections:{page:{section_url:"https://manual.bubble.io/core-resources/actions/element#page"}}},ScrollToListEntry:{section_url:"https://manual.bubble.io/core-resources/actions/element#scroll-to-entry-of-a-repeating-group",subsections:{entry:{section_url:"https://manual.bubble.io/core-resources/actions/element#entry-to-scroll-to"},animate:{section_url:"https://manual.bubble.io/core-resources/actions/element#animate-the-scrolling"},offset:{section_url:"https://manual.bubble.io/core-resources/actions/element#vertical-offset-pixels"}}},DisplayMapMarkerData:{section_url:"https://manual.bubble.io/core-resources/actions/element#display-markers-on-a-map",subsections:{data_source:{section_url:"https://manual.bubble.io/core-resources/actions/element#data-source-1"}}},SetCurrentMapMarker:{section_url:"https://manual.bubble.io/core-resources/actions/element#set-current-map-marker-for-a-map",subsections:{to_select:{section_url:"https://manual.bubble.io/core-resources/actions/element#to-select"}}},ClearMapMarkers:{section_url:"https://manual.bubble.io/core-resources/actions/element#clear-markers-on-a-map"},MapAdjustZoom:{section_url:"https://manual.bubble.io/core-resources/actions/element#adjust-map-zoom",subsections:{manual_setting:{section_url:"https://manual.bubble.io/core-resources/actions/element#set-center-and-zoom-manually"},center:{section_url:"https://manual.bubble.io/core-resources/actions/element#map-centered-on"},initial_zoom:{section_url:"https://manual.bubble.io/core-resources/actions/element#initial-zoom"}}},RepositionElement:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#action-reposition",subsections:{X:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#x-position"},Y:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#y-position"}}}}},Data:{subsections:{DataSources:{section_url:"https://manual.bubble.io/core-resources/data/data-sources",subsections:{CurrentUser:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-user"},Search:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#do-a-search-for"},AlgoliaSearch:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#perform-a-search-using-algolia"},OptionValue:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#get-an-option"},DateTime:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#arbitrary-date-time"},ArbitraryText:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#arbitrary-text"},GetDataFromAPI:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#get-data-from-an-external-api"},GetMouseData:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#data-source-get-mouse-data",subsections:{x_position:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#get-mouse-datas-x-position"},y_position:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#get-mouse-datas-y-position"},right_mouse_clicked_down:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#get-mouse-datas-right-mouse-clicked-down"},right_mouse_click_released:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#get-mouse-datas-right-mouse-click-released"},left_mouse_clicked_down:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#get-mouse-datas-left-mouse-clicked-down"},left_mouse_click_released:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#get-mouse-datas-left-mouse-click-released"}}},ElementParent:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#parent-groups-thing-current-cells-thing"},ElementAncestor:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#parent-groups-thing-current-cells-thing"},CurrentCellsIndex:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-cells-index"},CurrentPageItem:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-page-thing"},GetElement:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#element"},ThisElement:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#this-element"},PreviousStep:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#result-of-previous-step"},CurrentWorkflowItem:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-workflow-thing"},CurrentDataItem:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#thing-now"},OldDataItem:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#thing-before-change"},GetParamFromUrl:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#get-data-from-page-url"},InjectedValue:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-option-thing"},APIEventParameter:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#api-endpoint-parameters"},Formulas:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#calculate-formula"},PageData:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#page-data",subsections:{"Website Home":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#website-home-url"},"This Url":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#this-url"},CurrentLanguage:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-language"},"Current Page Name":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-page-name"},"Website Admin Email":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#website-admin-email"},"Current Date/Time":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-date-time"},"Current Position":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-geographic-position"},"Current Page Width":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-page-width"},"Current Page Scrolling Position":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#current-page-scrolling-position"},"Page Loaded Above Fold":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#page-loaded-above-fold"},"Page Loaded (Entire)":{section_url:"https://manual.bubble.io/core-resources/data/data-sources#page-loaded-entire"},AppIsTest:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#isnt-live-version"},AppVersion:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#app-version"}}},AppText:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#application-text"},IncompatibleType:{section_url:"https://manual.bubble.io/core-resources/data/data-sources#incompatible-type-for-inputs"}}},Messages:{subsections:{GenericMessages:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#shared-operators",subsections:{equals:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is"},not_equals:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not"},is_empty:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-empty"},is_not_empty:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-empty"}}},text:{subsections:{is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in"},contains:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#contains"},not_contains:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#doesnt-contain"},contains_keywords:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#contains-keyword-s"},not_contains_keywords:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#doesnt-contain-keyword-s"},to_capitalized_words:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#capitalized-words"},to_uppercase:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#uppercase"},to_lowercase:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#lowercase"},append:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#append"},format_text:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#formatted-as"},use_text_as:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#used-as"},trimmed:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#trimmed"},length:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#number-of-characters"},truncated:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#truncated-to"},truncated_right:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#truncated-from-end-to"},extract_from_text:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#extract"},convert_to_number:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#converted-to-number"},split_by:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#split-by"},find_replace:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#find-replace"},extract_regex:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#extract-with-regex"},defaulting_to:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#defaulting-to"},format_json_encode:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#formatted-as-json-safe"}}},number:{subsections:{is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in-1"},format_number:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#greater-than"},greater_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#greater-than-or-equal-to"},greater_or_equal_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than"},less_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than-or-equal-to"},less_or_equal_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#plus"},plus:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#undefined"},minus:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#multiply"},times:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#divide"},divide:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#rounded-to"},round:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#floor"},floor:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#ceiling"},ceil:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#exponential-function"},power:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than-range-greater-than"},to_range:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than-max-greater-than"},max:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than-min-greater-than"},min:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than-modulo-greater-than"},modulo:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#number-range-type"}}},number_range:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#number-range-type",subsections:{min:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#min"},max:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#max"},average:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#average"},range_contains:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#contains-range"},range_contains_point:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#contains-1"},range_contained_by:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-contained-by"},range_overlaps:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#overlaps-with"},range_greater_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-greater"},range_greater_than_point:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-greater-point"},range_less_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-smaller"},range_less_than_point:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-smaller-point"},is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in-3"}}},date:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#date-type",subsections:{is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in-3"},format_date:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#formatted-as-1"},to_range:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than-range-greater-than-1"},plus_seconds:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#seconds"},plus_minutes:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#minutes"},plus_hours:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#hours"},plus_days:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#days"},plus_months:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#months"},plus_years:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#years"},change_seconds:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#change-seconds-to"},change_minutes:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#change-minutes-to"},change_hours:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#change-hours-to"},change_date:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#change-date-day-to"},change_month:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#change-month-to"},change_years:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#change-years-to"},greater_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#greater-than-date"},less_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than-date"},minus:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#minus-date"},extract_from_date:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#extract-from-date"},rounded_down:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#rounded-down"},equals_rounded_down:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#equals-rounded-down"},max:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than-max-greater-than-date"},min:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#less-than-min-greater-than-date"},format_json_encode:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#formatted-as-json-safe"}}},date_range:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#date-range-type",subsections:{min:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#min"},max:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#max"},average:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#average"},range_contains:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#contains-range"},range_contains_point:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#contains-1"},range_contained_by:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-contained-by"},range_overlaps:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#overlaps-with"},range_greater_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-greater"},range_greater_than_point:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-greater-point"},range_less_than:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-smaller"},range_less_than_point:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-smaller-point"},is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in-3"}}},dateinterval:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#date-type",subsections:{is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in-5"},to_days:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#format-as-days"},to_hours:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#format-as-hours"},to_minutes:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#format-as-minutes"},to_seconds:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#format-as-seconds"}}},boolean:{subsections:{is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in-6"},is_true:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-yes"},is_false:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-no"},and_:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#and"},or_:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#or"},format_boolean:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#formatted-as-text"},format_boolean_number:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#formatted-as-number"},format_json_encode:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#formatted-as-json-safe"}}},file:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#file-type",subsections:{is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in-7"},file_name:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#s-file-name"},url:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#s-url"},saved_s3:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#saved-to-s3"},to_base64:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#encoded-in-base64"}}},image:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#image-type",subsections:{is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in-8"},file_name:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#s-file-name-1"},url:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#s-url-1"},saved_s3:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#saved-to-s3-1"},to_base64:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#encoded-in-base64-1"},imgix_treatment:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#processed-with-imgix"}}},geographic_address:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#geographic-address",subsections:{is_not_contained_by_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-not-in-9"},formatted_address:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...s-formatted-address"},google_map_link:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...s-link-to-google-maps"},distance_from:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-distance-from-..."},extract_from_address:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#extract-..."},latitude:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...s-latitude"},longitude:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...s-longitude"},timezone:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...s-time-zone-id"},timezone_name:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...s-time-zone-name"},daysaving_offset:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...s-daylight-saving-time-offset"},raw_offset:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...s-offset-from-utc-minutes"}}},list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#list-of-things",subsections:{count:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-count"},contains:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-contains-..."},not_contains:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-doesnt-contains-..."},first_element:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-first-item"},last_element:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-last-item"},random_element:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-random-item"},specific_item:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-item"},limit_to:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-items-until"},list_from:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-items-from"},contains_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-contains-list-..."},join:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-join-with-..."},sum:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-sum"},product:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-product"},average:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-average"},median:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-median"},min:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-min"},max:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-max"},approximate_count:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-approximate-count"},cached_aggregation:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-cached-aggregation"},filtered:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-filtered"},format_as_text:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-format-as-text"},sorted:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-sorted"},ranked_by:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#ranked-by..."},merged_with:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-merged-with-..."},intersect_with:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-intersect-with-..."},unique:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-unique-elements"},plus_element:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-plus-item"},minus_element:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-minus-item"},minus_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-minus-list"},make_static:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...-make-static"},group_by:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#..-group-by"},each_item:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#each-item"}}},CustomType:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#custom-types",subsections:{"Created By":{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#creator"},"Created Date":{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#created-date"},"Modified Date":{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#modified-date"},Slug:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#slug-beta"},"Unique ID":{section_url:"https://manual.bubble.io/help-guides/structuring-an-application/data-structure#built-in-fields"},_id:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#s-unique-id"},id_link:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#s-link"},convert_to_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#converted-to-list"}}},NewField:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#custom-fields",subsections:{"Field name":{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#field-name"},"Field type":{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#field-type"},is_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#this-field-is-a-list-multiple-entries"},"Default value":{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#default-value"}}},User:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#user-type",subsections:{email:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#email"},logged_in:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...is-logged-in"},not_logged_in:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#...is-logged-out"},email_confirmed:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#s-email-confirmed"},uses_pw:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#uses-password"},uses_2fa:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#uses-2fa"},has_2fa_backup:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#has-2fa-backup-codes"},is_using_cookies:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#is-using-cookies"}}},OptionSet:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#option-sets",subsections:{display:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#s-display"},defaulting_to:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#defaulting-to-1"},convert_to_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#converted-to-list-1"}}},NewAttribute:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#option-attributes",subsections:{"Attribute name":{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#attribute-name"},"Attribute type":{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#attribute-type"},is_list:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#this-attribute-is-a-list-multiple-entries"}}},NewOption:{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#options",subsections:{"Option name":{section_url:"https://manual.bubble.io/core-resources/data/operations-and-comparisons#option-name"}}}}},SearchOperator:{section_url:"https://manual.bubble.io/core-resources/data/search",subsections:{ignore_empty_constraints:{section_url:"https://manual.bubble.io/core-resources/data/search#ignore-empty-constraints"},type_to_find:{section_url:"https://manual.bubble.io/core-resources/data/search#type-of-find"},constraints:{section_url:"https://manual.bubble.io/core-resources/data/search#constraints"},sort_field:{section_url:"https://manual.bubble.io/core-resources/data/search#Data.SearchOperator.sort_field"},subsections:{use_dynamic_sort_field:{section_url:"https://manual.bubble.io/core-resources/data/search#change-which-field"},random_sorting:{section_url:"https://manual.bubble.io/core-resources/data/search#random-sorting"}},dynamic_sort_field:{section_url:"https://manual.bubble.io/core-resources/data/search#dynamic-field-name"},geo_reference:{section_url:"https://manual.bubble.io/core-resources/data/search#Data.SearchOperator.geo_reference"},descending:{section_url:"https://manual.bubble.io/core-resources/data/search#Data.SearchOperator.descending"},additional_sort_fields:{section_url:"https://manual.bubble.io/core-resources/data/search#Data.SearchOperator.additional_sort_fields"},AnyField:{section_url:"https://manual.bubble.io/core-resources/data/search#Data.SearchOperator.AnyField"},AdvancedFilter:{section_url:"https://manual.bubble.io/core-resources/data/search#Data.SearchOperator.AdvancedFilter"}}},Privacy:{section_url:"https://manual.bubble.io/core-resources/data/privacy",subsections:{NewRole:{section_url:"https://manual.bubble.io/core-resources/data/privacy#Data.Privacy.NewRole"},name:{section_url:"https://manual.bubble.io/core-resources/data/privacy#Data.Privacy.name"},delete:{section_url:"https://manual.bubble.io/core-resources/data/privacy#Data.Privacy.delete"},condition:{section_url:"https://manual.bubble.io/core-resources/data/privacy#Data.Privacy.condition"},permissions:{section_url:"https://manual.bubble.io/core-resources/data/privacy#Data.Privacy.permissions",subsections:{search_for:{section_url:"https://manual.bubble.io/core-resources/data/privacy#find-this-in-searches"},view_all:{section_url:"https://manual.bubble.io/core-resources/data/privacy#view-all-fields"},view_attachments:{section_url:"https://manual.bubble.io/core-resources/data/privacy#view-attached-files"},auto_binding:{section_url:"https://manual.bubble.io/core-resources/data/privacy#allow-auto-binding"},modify_api:{section_url:"https://manual.bubble.io/core-resources/data/privacy#modify-via-api"},delete_api:{section_url:"https://manual.bubble.io/core-resources/data/privacy#delete-via-api"},create_api:{section_url:"https://manual.bubble.io/core-resources/data/privacy#create-via-api"}}},pitfalls:{section_url:"https://manual.bubble.io/core-resources/data/privacy#note-modifying-data-in-the-middle-of-a-workflow",subsections:{modify_thing:{section_url:"https://manual.bubble.io/core-resources/data/privacy#note-modifying-data-in-the-middle-of-a-workflow"}}}}}}},Plugins:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins",subsections:{apiconnector2:{section_url:"https://manual.bubble.io/core-resources/api/the-api-connector",subsections:{name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#call-name"},publish_as:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#use-as"},auth:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#authentication"},delete_call:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#delete-call"},method:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#method"},url:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#url"},body:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#body"},headers:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#headers"},body_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#body-type"},parameters:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#parameters"},get_headers:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#capture-response-headers"},in_browser:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#allow-call-to-run-directly-in-the-browser"},initialize_call:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/api-connector#initialize-call"}}},appconnector:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector",subsections:{domain:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#app-domain"},match_versions:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#match-versions-live-vs-dev"},name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#app-name"},app_token:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#private-key"},client_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#client-id"},client_secret:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#client-secret"},call_name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#call-name"},call_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#call-type"},auth:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#authentication"},refresh_data_button:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/bubble-app-connector#refresh-app-metadata"}}},airtable:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/airtable"},Blockspring:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/blockspring"},braintree:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree",subsections:{ChargeUser:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#charge-the-current-user",subsections:{charged_user_email:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#payer-email"},amount:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#amount"},description:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#description"},button_caption:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#button-caption"},authorize_only:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#authorize-the-charge-only"},use_3d_secure:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#enable-3d-secure-check"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#do-not-show-success-message"}}},SubscribePlan:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#subscribe-the-user-to-a-plan",subsections:{dynamic_plan_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#dynamically-specify-plan"},plan_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#plan-name"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#do-not-show-success-message-1"}}},CancelPlan:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#cancel-the-current-users-plan",subsections:{do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/braintree#do-not-show-success-message-2"}}}}},chartjs:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js",subsections:{LineBarChart:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#line-bar-chart",subsections:{chart_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#chart-type"},data_points_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#type-of-data"},data_source:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#data-source"},y_value_expression:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#value-expression"},label_expression:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#label-expression"},series1_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#series-1-color"},series1_fillColor:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#series-1-fill-color"},showScale:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#show-scale"},scaleLineColor:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#scale-line-color"},scaleFontColor:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#scale-font-color"},scaleShowGridLines:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#show-grid"},scaleGridLineColor:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#grid-line-color"},showTooltips:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#show-tooltips"},customize_tooltips:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#customize-tooltip-number-formatting"},hide_label_tooltips:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#hide-the-label-from-the-tooltips"},bezierCurve:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#apply-bezier-curve"},animateRotate:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#rotation-animation"},datasetFill:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#fill-the-dataset-with-a-color"},formatting_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#number-type"},decimal_place:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#decimal-place"},decimal_separator:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#decimal-separator"},thousand_separator:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#thousand-separator"},currency_symbol:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#currency-prefix"},negative_parenthese:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/chart.js#use-parentheses-for-negative-numbers"}}}}},circle_jplayer:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/circle-music-player",subsections:{CircleJPlayer:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/circle-music-player",subsections:{song:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/circle-music-player#song-file"},start_at:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/circle-music-player#starts-at-seconds"},end_at:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/circle-music-player#ends-at-seconds"},non_seekable:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/circle-music-player#prevent-the-user-from-using-the-round-seekbar"},autoplay:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/circle-music-player#autoplay-when-a-new-song-is-set"}}}}},dbconnector:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/sql-database-connector"},disqus:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/disqus",subsections:{DisqusComments:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/disqus",subsections:{disqus_shortname:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/disqus#disqus-shortname"}}}}},docusign:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/docusign",subsections:{DocusignGetEmbeddedSigningURL:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/docusign#get-embedded-signing-url",subsections:{docusign_api_domain:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/docusign#api-domain"},docusign_email:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/docusign#email"},docusign_integrator_key:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/docusign#docusign-integrator-key"},docusign_password:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/docusign#docusign-account-id"}}}}},draggableui:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements",subsections:{DroppableGroup:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#drag-drop-group",subsections:{constrained:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#constrain-the-movement-within-the-parent"},droppable:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#make-this-element-droppable"},disabled:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#disable-the-ability-to-drag"},post_event:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#behavior-post-drop"},group_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#type-of-content"},data_source:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#data-source"}}},Dropzone:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#drop-area",subsections:{tolerance:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#tolerance"},group_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#type-of-content"},data_source:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#data-source"}}},DroppedOn:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#a-drop-area-has-an-element-dropped-in-it",subsections:{custom_event_data_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#type-of-workflow-thing"}}},MoveElement:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#move-a-draggable-group",subsections:{moving_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#movement-type"},reference:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#element-to-move-to"},offset_top:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#offset-top-px"},offset_left:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#offset-left-px"},left_position:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#left-x-px"},top_position:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#top-y-px"},animation_delay:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/draggable-ui-elements#duration-ms"}}}}},facebook:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook",subsections:{FacebookLikeButton:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#facebook-like",subsections:{href:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#link-to-like"},action:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#action"},colorscheme:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#color-scheme"},layout:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#layout"},share:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#share-button"},show_faces:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#show-faces"}}},FacebookPagePlugin:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#facebook-page",subsections:{href:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#page-link"},hide_cover:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#hide-page-cover"},show_facepile:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#show-faces-1"},show_posts:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#show-posts"}}},SendFacebookMessage:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#send-facebook-message",subsections:{link:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#link"},to_user_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/facebook#facebook-user"}}}}},fullcalendar:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar",subsections:{Calendar:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#calendar",subsections:{event_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#type-of-events"},data_source:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#data-source"},event_starting_date_field:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#start-time-field"},event_end_date_field:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#end-time-field"},all_day_field:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#all-day-field-yes-no"},event_description_expression:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#event-caption"},draggable:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#enable-modification-through-dragging-start-end"},resizable:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#enable-modification-through-resizing-end"},starting_date:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#date-to-display-at-first"},available_views:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#available-views"},show_weekends:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#include-saturday-sunday-columns"},first_day:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#starting-day"},events_days_are_selectable:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#event-and-days-are-selectable"},event_color_is_dynamic:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#use-a-dynamic-color-for-each-event"},event_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#event-color"},dynamic_event_color_field:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#event-color-field"},selected_event_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#selected-event-color"},selected_day_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#selected-day-color"},current_day_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#current-day-color"}}},CalendarEventClicked:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#a-calendars-event-is-clicked"},CalendarDayClicked:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/full-calendar#a-calendars-day-is-clicked"}}},interactions:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions",subsections:{KeyPressed:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#user-presses-a-key-or-combination-of-keys",subsections:{key_combination:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#keyboard-shortcut"},disable_on_text_input:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#disable-when-input-is-focused"}}},PageScrolled:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#event-user-scrolls-on-page",subsections:{mouse_scroll_direction:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#scroll-direction"},workflow_trigger:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#trigger"},prevent_default_scroll:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#prevent-default-1"}}},MouseClicked:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#event-mouse-is-clicked-down",subsections:{mouse_click_side:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#click-side"},prevent_default_click:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#prevent-default"}}},EnterHover:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#an-element-is-hovered",subsections:{element_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#element"}}},ExitHover:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#an-element-stops-being-hovered",subsections:{element_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mouse-and-keyboard-interactions#element-1"}}}}},ionic:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements",subsections:{IonicIcon:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#ionic-icon",subsections:{icon:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#icon"},icon_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#icon-color"},start_workflow:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#start-edit-workflow"},button_disabled:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#this-element-isnt-clickable"}}},IonicToggle:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#ionic-toggle",subsections:{contents:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#preset-status"},dynamic:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#dynamic-status"},mandatory:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#this-checkbox-should-be-checked"},color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#component-color"}}},IonicCheckbox:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#ionic-checkbox",subsections:{contents:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#preset-status-1"},dynamic:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#dynamic-status-1"},mandatory:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#this-checkbox-should-be-checked-1"},color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#component-color-1"}}},IonicRange:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#ionic-range",subsections:{min:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#min-value"},max:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#max-value"},step:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#step"},content:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#initial-content"},color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ionic-elements#track-color"}}}}},jpanelmenu:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu",subsections:{SlidebarMenu:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#slidebar-menu",subsections:{options:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#options"},side:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#opening-side"},show_icon:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#show-an-icon"},icon_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#icon-color"},menu_width:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#menu-width"},offset_top:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#distance-from-top"},background_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#background-color"},hover_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#option-hover-color"},font_face:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#font"},font_family:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#font"},font_weight:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#font"},font_size:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#font-size"},menu_font_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#menu-font-color"},boxshadow_horizontal:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#shadow-offset"},boxshadow_blur:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#blur-radius"},boxshadow_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#shadow-color"}},SlidebarMenuOptionClicked:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slidebar-menu#a-slidebar-menus-option-is-clicked"}}}},jtinder:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element",subsections:{TinderPile:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#tinder-pile",subsections:{group_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#type-of-content"},data_source:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#data-source"},image_field:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#image-field"},show_title:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#show-card-title"},title_expression:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#picture-caption"},background_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#card-background-color"},card_border_width:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#border-width"},title_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#title-color"},like_image:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#image-when-liked"},dislike_image:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#image-when-disliked"}},TinderSwipedLeft:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#a-tinder-piles-card-is-swiped-left"},TinderSwipedRight:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#a-tinder-piles-card-is-swiped-right"},TinderSwipeLeft:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#swipe-a-tinder-pile-left"},TinderSwipeRight:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/tinder-like-element#swipe-a-tinder-pile-right"}}}},localizejs:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/localize-translation",subsections:{ChangeLocalizeLanguage:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/localize-translation",subsections:{language_code:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/localize-translation#language-code"}}}}},mailchimp:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mailchimp",subsections:{AddUserToMailchimpList:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mailchimp#add-an-email-to-a-mailchimp-list",subsections:{email_address:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mailchimp#email-address"},list_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mailchimp#list-name"}}},RemoveUserFromMailchimpList:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mailchimp#remove-an-email-from-a-mailchimp-list",subsections:{email_address:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mailchimp#email-address-1"},list_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mailchimp#list-name-1"}}}}},mixpanel:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel",subsections:{SendEventToMixpanel:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#send-an-event-to-mixpanel",subsections:{event_name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#event-name"},additional_values:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#additional-values"}}},SendUserToMixpanel:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#send-the-user-to-mixpanel",subsections:{user_name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#user-name-or-id"},additional_values:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#additional-values-1"}}},SendChargeToMixpanel:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#send-a-user-charge-to-mixpanel",subsections:{charge_value:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#charge-amount"},additional_values:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#additional-values-2"}}},DeleteCurrentUserFromMixpanel:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/mixpanel#delete-the-current-user-from-mixpanel"}}},multifileupload:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/dropzone",subsections:{MultiFileInput:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/dropzone",subsections:{message:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/dropzone#message-to-display"},initial:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/dropzone#initial-files-to-display"},max_files:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/dropzone#maximum-number-of-files"},private:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/dropzone#make-this-file-private"},attach_to:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/dropzone#attach-this-file-to"},service:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/dropzone#storage-service"},destination:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/dropzone#folder-path"}}}}},progressbar:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/progress-bar",subsections:{ProgressBar:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/progress-bar",subsections:{percentage:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/progress-bar#percentage"},bar_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/progress-bar#progress-bar-color"},animate:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/progress-bar#animate-progress"}}}}},rich_text:{subsections:{RichTextInput:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor",subsections:{content:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor#initial-content"},theme:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor#regular-or-tooltip"},style_complexity:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor#style-complexity"},extend_to_fit:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor#extend-to-fit"}}}}},sceditor:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor-legacy",subsections:{RichTextInput:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor-legacy",subsections:{content:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor-legacy#initial-content"},hide_text_icons:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor-legacy#hide-advanced-editing-features"},enable_table:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/rich-text-editor-legacy#show-table-controls-in-the-icon-bar"}}}}},segment:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment",subsections:{appsecret:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#write-key"},SendTrackToSegment:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#track-an-event-with-segment",subsections:{event_name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#event-name"},additional_values:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#additional-values"}}},ServerSideSendTrackToSegment:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#track-an-event-with-segment-server",subsections:{event_name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#event-name-1"},additional_values:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#additional-values-1"}}},SendPageViewToSegment:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#send-a-page-view-to-segment",subsections:{category:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#page-category"},additional_values:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#additional-values-2"}}},IdentifyUserWithSegment:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/segment#identify-a-user-with-segment"}}},slickcarousel:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow",subsections:{Carousel:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow",subsections:{carousel_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#type-of-list"},static_images:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#list-of-static-images"},list_type:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#type-of-image"},dynamic_images:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#data-source"},stretch_or_rescale:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#run-mode-rendering"},image_field:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#image-field"},reset_list:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#wipe-the-entire-list-when-it-changes"},animation_style:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#animation-style"},animation_speed:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#animation-speed"},autoplay:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#autoplay"},autoplay_speed:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#speed"},pause_on_hover:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#pause-on-hover"},show_dots:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#show-navigation-dots"},navigation_dots_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#navigation-dots-color"},show_buttons:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#show-arrow-buttons"},arrow_button_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/slick-slideshow#arrow-button-color"}}}}},star_rating:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/star-rating",subsections:{StarRating:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/star-rating",subsections:{min:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/star-rating#min-value"},max:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/star-rating#max-value"},step:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/star-rating#step"},size:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/star-rating#star-size"},content:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/star-rating#initial-content"},star_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/star-rating#stars-color"},rating_color:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/star-rating#rating-color"}}}}},stripe:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe",subsections:{ChargeUser:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#charge-the-current-user",subsections:{charged_user_email:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#payer-email"},amount:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#amount"},name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#name"},description:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#description"},image:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#image"},currency:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#currency"},button_caption:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#button-caption"},statement_descriptor:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#statement-descriptor"},authorize_only:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#authorize-the-charge-only"},payee_is_another_user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#the-payee-of-this-transaction-is-another-user"},payee:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#transaction-payee"},app_fee:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#app-fee"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#do-not-show-success-message"},allow_promotion_codes:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#allow-promotion-codes"},apply_tax_rate:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#add-tax-rate-to-checkout-v-3"},tax_ids_style:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#tax-rate-ids-source"},tax_ids_static_choices:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#tax-rate-ids-static"},tax_ids_data_source:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#tax-rate-ids-dynamic"}}},GetUserCCInfo:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#collect-the-users-cc-information",subsections:{update_existing:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#update-existing-main-card"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#do-not-show-success-message-1"}}},ChargeUserWithSavedCC:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#charge-a-user-using-saved-cc",subsections:{charged_user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#charged-user"},amount:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#amount-1"},currency:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#currency-1"},name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#name-1"},description:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#description-1"},image:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#image-1"},payee_is_another_user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#the-payee-of-this-transaction-is-another-user-1"},payee:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#transaction-payee-1"},app_fee:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#app-fee-1"},card_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#card-id-to-charge"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#do-not-show-success-message-2"}}},CaptureAuthorizedCharge:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#capture-an-authorized-charge",subsections:{charge_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#charge-id"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#do-not-show-success-message-3"}}},DefineAsSeller:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#register-the-user-as-a-seller",subsections:{email:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#business-email"},url:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#business-url"},business_name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#business-name"},address:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#business-address"},product_category:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#product-category"},physical_product:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#sold-products-are-physical-products"},product_description:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#product-description"}}},TransferToSeller:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#transfer-to-seller",subsections:{amount:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#amount-3"},currency:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#currency-3"},destination:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#destination-seller"},description:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#description-3"},source_transaction:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#source-charge-id"},transfer_group:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#transfer-group"}}},CreatePayout:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#create-payout"},SubscribeStripePlan:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscribe-the-user-to-a-plan",subsections:{apply_current_user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#apply-this-action-to-the-current-user"},user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscribed-user"},update_existing:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#update-existing-subscription"},subscription_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-id-opt"},dynamic_plan_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#dynamically-specify-plan"},plans_vs_item:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-type"},plan_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#plan-name"},quantity:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#quantity"},items:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-items"},apply_coupon:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#apply-a-coupon-to-this-subscription"},coupon_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#coupon-id"},payment_behavior:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#payment-behavior"},tax_percent:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#tax-percent"},trial_end:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#end-of-the-trial"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#do-not-show-success-message-4"},allow_promotion_codes:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-allow-promotion-codes"},apply_tax_rate:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-add-tax-rate-to-checkout-v-3"},tax_ids_style:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-tax-rate-ids-source"},tax_ids_static_choices:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-tax-rate-ids-static"},tax_ids_data_source:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-tax-rate-ids-dynamic"}}},ApplyCouponToPlan:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#apply-a-coupon-to-the-users-subscription",subsections:{apply_current_user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#apply-this-action-to-the-current-user-1"},user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscribed-user-1"},subscription_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-id-1"},coupon_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#end-of-the-trial-1"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#do-not-show-success-message-5"}}},AddInvoiceItem:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#create-an-invoice-item",subsections:{customer:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#user-1"},amount:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#amount-2"},currency:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#currency-2"},description:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#description-2"},subscription_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-id-1"},apply_tax_rate:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#add-tax-rate-to-invoice-item"},tax_ids_style:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-tax-rate-ids-source-1"},tax_ids_static_choices:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-tax-rate-ids-static-1"},tax_ids_data_source:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-tax-rate-ids-dynamic-1"}}},CreateInvoice:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#create-an-invoice",subsections:{customer:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#user"},subscription_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-id-2"},auto_advance:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#automatic-collection"}}},UpdateInvoice:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#update-an-invoice",subsections:{invoice_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#invoice-id-2"},description:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#description-4"},coupon_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#coupon-id"},auto_advance:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#automatic-collection-2"}}},PayInvoice:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#pay-an-invoice",subsections:{invoice_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#invoice-id"}}},CancelInvoice:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#cancel-an-invoice",subsections:{invoice_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#invoice-id-1"},status:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#status"}}},CancelStripePlan:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#cancel-the-current-users-plan",subsections:{apply_current_user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#apply-this-action-to-the-current-user-2"},user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscribed-user-2"},cancel_all:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#cancel-all-subscriptions"},subscription_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-id-3"},do_not_show_success_alert:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#do-not-show-success-message-6"}}},AddSubscriptionItem:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#create-a-subscription-item",subsections:{subscription_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-id-4"},plan_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#plan-name-1"},quantity:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#quantity-1"}}},UpdateSubscriptionItem:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#update-a-subscription-item",subsections:{subscription_item_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-item-id"},plan_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#plan-name-2"},quantity:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#quantity-2"}}},DeleteSubscriptionItem:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#delete-a-subscription-item",subsections:{subscription_item_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscription-item-id-1"}}},MakeCardDefault:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#make-a-card-new-default",subsections:{card_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#credit-card-id"}}},DeleteCreditCard:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#delete-a-credit-card",subsections:{card_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#credit-card-id-1"}}},GetUserInvoices:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#retrieve-all-user-invoices"},UpdateCustomerInformation:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#update-stripe-customer",subsections:{apply_current_user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#apply-this-action-to-the-current-user-1"},user:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#subscribed-user-1"},email:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#email"},address:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#address"}}},CreateCoupon:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#create-a-stripe-coupon",subsections:{name:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#coupon-name"},amount_off:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#amount-off"},percent_off:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#percent-off"},duration:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#duration"},duration_in_months:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#duration-in-months"},redeem_by:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#expiration-date"},currency:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#currency-2"},max_redemptions:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#max-redemption"}}},CreateStripeValueListItem:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#create-a-stripe-value-list-item",subsections:{value_list_id:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#value-list-id"},value:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/stripe#value"}}}}},zapier:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/zapier",subsections:{TrigggerZap:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/zapier#trigger-a-zap",subsections:{webhook:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/zapier#webhook"},google_sheet_date:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/zapier#make-dates-google-sheets-compatible"},initialize_zap:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/zapier#initiate-this-webhook"}}}}},ziggeo:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ziggeo",subsections:{ZiggeoInput:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ziggeo",subsections:{input_options:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ziggeo#input-options"},limit:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ziggeo#maximum-duration-s"},max_size:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/ziggeo#maximum-size-byte"}}}}},addtoany:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/addtoany-share-buttons",subsections:{AddToAnyShareButtons:{section_url:"https://manual.bubble.io/core-resources/bubble-made-plugins/addtoany-share-buttons"}}}}},ApplicationSettings:{subsections:{monthly_unique_daily_visitor:{section_url:"https://manual.bubble.io/miscellaneous/the-glossary#monthly-unique-daily-visitors"},total_database_records:{section_url:"https://manual.bubble.io/miscellaneous/the-glossary#database-things"},show_collaboration_arrows:{section_url:"https://manual.bubble.io/core-resources/application-settings/collaboration#show-the-cursor-of-other-editors-when-they-modify-the-application"},app_rights:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#application-rights"},pw_protection:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#limit-access-to-this-app-with-a-username-and-password"},username:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#username"},password:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#password"},pw_protection_dev_only:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#do-not-apply-password-for-live"},have_pw_policy:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#define-a-password-policy"},pw_length:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#password-minimum-length"},pw_require_number:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#require-a-number"},pw_require_capital_letter:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#require-a-capital-letter"},pw_require_special_char:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#require-a-non-alphanumeric-character"},temp_pw_page_redirect:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#redirect-users-who-havent-changed-their-password"},twofa_auth:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#activate-two-factor-authentication"},twofa_name:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#application-name-to-display-in-2fa-app"},check_2fa_page:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#redirect-users-to-check-their-temporary-token"},allow_iframe:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#allow-to-render-the-app-in-an-frame-iframe-x-frame-options"},new_types_private:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#make-new-data-types-private-by-default-with-a-privacy-rule-placeholder"},cookie_opt_in:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#do-not-set-cookies-on-new-visitors-by-default"},favicon:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#favicon"},status_bar_color:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#progress-bar-color"},spinner_color:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#repeating-group-spinner-color"},remove_bubble_console:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#remove-bubble-mention-in-console"},expose_id_option:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#expose-the-option-to-add-an-id-attribute-to-html-elements"},cloudflare_activate:{section_url:"https://manual.bubble.io/core-resources/application-settings/domain-email#use-cloudflare"},sendgrid_key:{section_url:"https://manual.bubble.io/core-resources/application-settings/domain-email#sendgrid-key"},sendgrid_template_id:{section_url:"https://manual.bubble.io/core-resources/application-settings/domain-email#sendgrid-template-id"},admin_email:{section_url:"https://manual.bubble.io/core-resources/application-settings/domain-email#admin-email"},admin_email_sender_name:{section_url:"https://manual.bubble.io/core-resources/application-settings/domain-email#sender-name"},redirect_all_to_domain:{section_url:"https://manual.bubble.io/core-resources/application-settings/domain-email#redirect-all-requests-to-the-domain"},ios_meta_tag_hide_safari_ui:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#hide-safari-ui-component"},ios_meta_tag_prevent_zoom:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#prevent-the-user-from-zooming"},ios_meta_tag_icon:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#icon-for-home-screen-60-x-60-pixels"},ios_meta_tag_startup_image_iphone5:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#iphone-5-startup-image-640-x-1096-pixels"},ios_meta_tag_startup_image_ipad_portrait:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#ipad-startup-image-portrait-1536-x-2008-pixels"},ios_meta_tag_startup_image_ipad_landscape:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#ipad-startup-image-landscape-1496-x-2048-pixels"},custom_font:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#custom-fonts"},advanced_features:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#advanced-options",subsections:{timezone_controls:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#enable-timezone-override-controls"},timezone_controls_date_time_inputs:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#enable-timezone-override-controls"},timezone_controls_page:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#enable-timezone-override-controls"},timezone_controls_backend_workflows:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#enable-timezone-override-controls"},expose_id_option:{section_url:"https://manual.bubble.io/core-resources/application-settings/general#expose-the-option-to-add-an-id-attribute-to-html-elements"}}},app_language:{section_url:"https://manual.bubble.io/core-resources/application-settings/languages"},language_field:{section_url:"https://manual.bubble.io/core-resources/application-settings/languages#application-primary-language"},language_attribute:{section_url:"https://manual.bubble.io/core-resources/application-settings/languages#language-field-on-the-user-type"},facebook_meta_tag_title:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#facebook-and-twitter-title"},facebook_meta_tag_site_name:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#facebook-and-twitter-site-name"},facebook_meta_tag_description:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#facebook-and-twitter-description"},facebook_meta_tag_image:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#thumbnail-used-for-links"},expose_text_tags:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#expose-the-type-of-tags-for-text-elements"},enable_canonical_url:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#enable-canonical-url"},customize_robots_txt:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#customize-robots-txt-advanced"},custom_robot_txt:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#custom-robots-txt"},generate_sitemap:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#expose-a-sitemap-file"},custom_header_meta_tag_content:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#script-meta-tags-in-header"},custom_header_meta_tag_body_content:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#script-in-the-body"},redirections_301:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#301-redirections"},hosted_files:{section_url:"https://manual.bubble.io/core-resources/application-settings/seo-metatags#hosting-files-in-the-root-directory"},hide_swagger_api:{section_url:"https://manual.bubble.io/core-resources/application-settings/api#hide-swagger-api-documentation-access"},exposes_wf_api:{section_url:"https://manual.bubble.io/core-resources/application-settings/api#enable-workflow-api-and-backend-workflows"},exposes_get_api:{section_url:"https://manual.bubble.io/core-resources/application-settings/api#enable-data-api"},use_captions_for_get:{section_url:"https://manual.bubble.io/core-resources/application-settings/api#use-field-display-instead-of-id-for-key-names"},oauth_login_page:{section_url:"https://manual.bubble.io/core-resources/application-settings/api#3rd-party-oauth-saml-access"},scheduled_releases:{section_url:"https://manual.bubble.io/core-resources/application-settings/versions#bubble-release-tier"}}},API:{section_url:"https://manual.bubble.io/core-resources/api",subsections:{introduction:{section_url:"https://manual.bubble.io/core-resources/api/introduction#introduction"},live_vs_test:{section_url:"https://manual.bubble.io/core-resources/api/introduction#live-and-development-versions"},authentication:{section_url:"https://manual.bubble.io/core-resources/api/introduction#authentication"},response:{section_url:"https://manual.bubble.io/core-resources/api/introduction#response"},sending_data:{section_url:"https://manual.bubble.io/core-resources/api/introduction#sending-data"},error:{section_url:"https://manual.bubble.io/core-resources/api/introduction#error"},rate_limit:{section_url:"https://manual.bubble.io/core-resources/api/introduction#rate-limiting"},api_versions:{section_url:"https://manual.bubble.io/core-resources/api/introduction#api-versions"},swagger_spec:{section_url:"https://manual.bubble.io/core-resources/api/introduction#swagger-specification"},workflow_api:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api",subsections:{Endpoint:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#general-workflow-endpoint"},APIEvent:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api",subsections:{wf_name:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#endpoint-name"},expose:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#expose-as-a-public-endpoint"},auth_unecessary:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#this-endpoint-can-be-run-without-authentication"},ignore_privacy_rules:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#ignore-privacy-rules-when-running-the-workflow"},trigger_option:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#trigger-workflow-with"},parameter_def:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#parameter-definition"},parameters:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#call-parameters"},include_headers:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#include-headers-in-the-detected-data"},detect_request:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#detect-data"},modify_types:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#modify-types"},response_type:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#response-type"},return_200_if_not_run:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#return-a-200-if-condition-is-not-met"},redirect_page_success:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#redirection-on-success"},redirect_page_error:{section_url:"https://manual.bubble.io/core-resources/api/workflow-api#redirection-on-error"},tz_type:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#timezone-selection"},tz_static:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#timezone-selection"},tz_dynamic:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#timezone-selection"},tz_type_overridden:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#timezone-selection"},tz_static_overridden:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#timezone-selection"},tz_dynamic_overridden:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#timezone-selection"}}},APIReturnData:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#return-data-from-api",subsections:{return_plain_text:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#content-type"},custom_content_type:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#other-content-type"},custom_text:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#text-to-return"},text:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#text-to-return"},parameters_actions:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-workflow-api#list-of-parameters"}}}}},get_api:{section_url:"https://manual.bubble.io/core-resources/api/the-bubble-api/the-data-api",subsections:{Endpoint:{section_url:"https://manual.bubble.io/core-resources/api/data-api#general-data-endpoint"},get_by_id:{section_url:"https://manual.bubble.io/core-resources/api/data-api#retrieve-a-thing-by-id"},modify_by_id:{section_url:"https://manual.bubble.io/core-resources/api/data-api#modify-a-thing-by-id"},replace_by_id:{section_url:"https://manual.bubble.io/core-resources/api/data-api#replace-a-thing-by-id"},delete_by_id:{section_url:"https://manual.bubble.io/core-resources/api/data-api#delete-a-thing-by-id"},create_thing:{section_url:"https://manual.bubble.io/core-resources/api/data-api#create-a-new-thing"},bulk_create:{section_url:"https://manual.bubble.io/core-resources/api/data-api#bulk-create-new-things"},search_call:{section_url:"https://manual.bubble.io/core-resources/api/data-api#getting-a-list-of-things-and-search",subsections:{pagination:{section_url:"https://manual.bubble.io/core-resources/api/data-api#pagination"},search_constraints:{section_url:"https://manual.bubble.io/core-resources/api/data-api#search-constraints"},sorting_options:{section_url:"https://manual.bubble.io/core-resources/api/data-api#sorting-options"}}}}}}}}}},{}],97:[function(e,t,n){"use strict";const r=e("./../u");const i=e("./../lang/appquery");const s=e("./../optional/interactions");const o=e("./../lang/lang");const a=e("./../editor/css");n.demo_tour={exit_button:{caption:"Exit",run(e){r.velocity(e,"fadeOut",{duration:200,complete_cb:()=>{e.remove()}})}},steps:[{content:"Oops, this page isn't working right now!  How did you get here? ?",button_next:"Start",tab:"design"},{content:"Bubble introduces a new way of programming, without code! \n \n Let's go through a sign up form together.",button_next:"Start",tab:"design"},{content:"Here is where you design your user interface, by dragging and dropping elements on the page.",button_next:"Next",element:{type:"Element",id:"1366909795476x192489894805476060"},tab:"design"},{content:"This is an element on our page.  Let's see how we can customize it.",element:{type:"Element",id:"1360451362247x47632711706683040"},post_script(){s.dblclick($("#1360451362247x47632711706683040"))},button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design"},{content:"The Property Editor lets you change the content and appearance of an element. For instance, we can edit the text of our element here.",element:{type:"UI",class_name:'.row[prop_name="text"]'},button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design"},{content:"The Workflow tab lets you decide what happens when a user interacts with your page.",element:{type:"UI",class_name:a.WORKFLOW_TAB},button_next:"Next",post_script(){$(a.WORKFLOW_TAB).click()},arrow_color:"rgb(181, 181, 181)",tab:"design"},{content:"A Bubble Workflow is a set of actions that is triggered by an event. For instance, when the button 'Create my profile' is clicked...",element:{type:"UI",class_name:".token-box",text:"profile is clicked"},post_script(){s.click($(".token-box:contains('profile is clicked')"))},button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"workflow"},{content:"...a user gets created, using the email and password they typed in.",element:{type:"UI",class_name:".token-box",text:"Sign the user up"},pre_script(){s.click($(".token-box:contains('Sign the user up')"))},button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"workflow"},{content:"We also want to save some additional information about the user, in this case their picture, name, and country.",element:{type:"UI",class_name:".token-box",text:"Make change"},pre_script(){s.click($(".token-box:contains('Make change')"))},button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"workflow"},{content:"Let's send a welcome email to our new user. To do this, we add a new action at the end of this workflow.",element:{type:"UI",class_name:".potential-token.child"},post_script(){$(".potential-token.child").click()},button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"workflow"},{content:"Actions include saving data, integrating with other services, making payments... Pick from our pre-built modules or add your own.",button_next:"Next",post_script(){$(".label:contains('Do Stuff')").click()},tab:"workflow"},{content:"And then we pick 'Send Email'",button_next:"Next",post_script(){$(".label:contains('Send Email')").click()},tab:"workflow"},{content:"First we pick who we want to get the email... we want to send it to our current user.",element:{type:"UI",class_name:'.row[prop_name="to"] .text-composer'},button_next:"Next",post_script(){s.click($('.row[prop_name="to"] .text-composer'))},arrow_color:"rgb(181, 181, 181)",tab:"workflow"},{content:"We can type an email, or click this button to insert a dynamic value.  In this case, we want the current user's email.",element:{type:"UI",class_name:".insert-dynamic-button"},post_script(){$(".insert-dynamic-button").click()},button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"workflow"},{content:"We first choose the 'Current User'...",element:{type:"UI",class_name:".dropdown-option",text:"Current User"},pre_script(){$(".dropdown-option:contains('Current User')").addClass("hovered")},post_script(){$(".dropdown-option:contains('Current User')").click()},arrow_color:"rgb(181, 181, 181)",button_next:"Next",tab:"workflow"},{content:"...and then select their email.",element:{type:"UI",class_name:".dropdown-option",text:"s email"},pre_script(){$(".dropdown-option:contains('Current User')").removeClass("hovered");$($(".dropdown-option:contains('email')")[0]).addClass("hovered")},post_script(){$(".dropdown-option:contains('email')").click()},arrow_color:"rgb(181, 181, 181)",button_next:"Next",tab:"workflow"},{content:"And this is where we type the message we want to send.",element:{type:"UI",class_name:'.row[prop_name="body"] .text-composer'},button_next:"Next",pre_script(){$(".dropdown-option:contains('email')").removeClass("hovered")},post_script(){i.page("index").events().actions("SendEmail")[0].set_property("body",o.RAW.TextExpression(["Hello there"]));i.app().commit()},arrow_color:"rgb(181, 181, 181)",tab:"workflow"},{content:"Click PREVIEW and test your app, instantly.  It's already live!",element:{type:"UI",class_name:".btn.preview"},button_next:"Next",post_script(){$(".btn.preview").click()},arrow_color:"rgb(181, 181, 181)"},{content:'The tour is over, but you can keep playing with this app. Change anything you want and hit PREVIEW to see the results! \n\n Sign up <a target="_blank" href="https://bubble.io/signup"> here</a>!',button_next:"Close"}]};n.new_app_tour={exit_button:{caption:"Close",run(e){r.velocity(e,"fadeOut",{duration:200,complete_cb(){e.hide()}})}},steps:[{title:"Bubble Tour",content:"This short tour highlights what you should know about the Bubble interface.",button_next:"Start",tab:"design"},{title:"The Different Tabs",content:"Building an application relies on 6 different concepts and areas in the editor.",button_next:"Next",tab:"design"},{content:"First, the Design tab is where you design your interface. You can simply drag and drop elements on the page, exactly as you would draw some PowerPoint slides.",button_next:"Next",tab:"design",arrow_color:"rgb(181, 181, 181)",arrow_position:"left",element:{type:"UI",class_name:a.VISUAL_TAB},pre_script(){s.click($(a.VISUAL_TAB))}},{content:"Second, the Workflow tab is where you program your application, describing what it does.",button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design",arrow_position:"left",element:{type:"UI",class_name:a.WORKFLOW_TAB}},{content:"Third, the Data tab is where you define the data structure of your application and see/modify your application data.",button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design",arrow_position:"left",element:{type:"UI",class_name:a.DATA_TAB}},{content:"Fourth, the Styles tab is where you define some general styles for your elements, to make the edition of your app faster. You can also apply a theme from your app there.",button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design",arrow_position:"left",element:{type:"UI",class_name:a.STYLES_TAB}},{content:"Fifth, the Plugins tab is where you can install new plugins to add different elements on the page or connect with external APIs.",button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design",arrow_position:"left",element:{type:"UI",class_name:a.PLUGIN_TAB}},{content:"Last, the Settings tab is where you can modify the app subscription, how your app looks like on the web when you're launching it and change some various general settings.",button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design",arrow_position:"left",element:{type:"UI",class_name:a.SETTINGS_TAB}},{title:"Editing Elements",content:"Double-clicking on the page elements reveals the Property Editor. This is where you can change how the elements look like.",button_next:"Next",tab:"design",pre_script(){s.dblclick($(".main-page.page-element"));$(".property-editor-2").css({top:90,left:668})}},{content:"You can for instance change the title of this page...",button_next:"Next",tab:"design",element:{type:"UI",class_name:'.section[section_name="PageTitle"]'}},{content:"...or change its style to another pre-built style.",button_next:"Next",tab:"design",element:{type:"UI",class_name:'.row[prop_name="element_style"]'}},{content:"Elements can be displayed differently under certain circumstances. For instance, you can only show some when the user is logged in.",button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design",element:{type:"UI",class_name:".property-editor-2 .tab.tab-2"},pre_script(){s.click($(".property-editor-2 .tab.tab-2"))}},{title:"Drawing Elements",content:"To insert a new element, click on an icon in the Element Palette and draw it on your page (buttons, links, popups, inputs...)",button_next:"Next",tab:"design",element:{type:"UI",class_name:".add_element.icon"},arrow_color:"rgb(181, 181, 181)",pre_script(){s.click($(".property-editor-2 .tab.tab-1"));s.click($(".add_element.icon"))}},{content:"Bubble lets you build responsive pages. It starts with fixed width, but once you've set it to being responsive, you can click here to see how your page behaves with different screen widths.",element:{type:"UI",class_name:".mode-button.responsive"},button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design"},{title:"Plugins",content:"Bubble has plenty of plugins: to install new elements plugins, click on the 'Install...' button",button_next:"Next",tab:"design",element:{type:"UI",class_name:".add-new-custom.element"},arrow_color:"rgb(181, 181, 181)"},{title:"Workflows",content:"You build workflows that program your app in the Workflow tab",button_next:"Next",tab:"design",element:{type:"UI",class_name:a.WORKFLOW_TAB},pre_script(){s.click($(".btn.pointer"));s.click($(a.WORKFLOW_TAB))}},{content:"A workflow is a set of actions that is triggered by an event, such as a click on a button. Here is where you'll build them.",button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"workflow",element:{type:"UI",class_name:".token-box"}},{content:"Clicking on an event reveals the series of actions that it triggers.",element:{type:"UI",class_name:".token-box"},pre_script(){const e=$(".token.root > .token-box").first();if(e.length){s.click(e)}},button_next:"Next",tab:"workflow"},{title:"Multi-pages Apps",content:"The application menu is where you can navigate across the different pages and create some new ones.",button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design",pre_script(){s.click($(a.VISUAL_TAB))},element:{type:"UI",class_name:".project-name.menu-item"}},{title:"Editor Tips",content:"The Help Center offers some videos that you can watch in the editor to understand how Bubble works.",button_next:"Next",arrow_color:"rgb(181, 181, 181)",tab:"design",element:{type:"UI",class_name:".help-center-button"}},{content:"Use the buttons undo and redo when something goes wrong...",button_next:"Next",tab:"design",element:{type:"UI",class_name:".edit_icons_box"}},{content:"Your app has two versions: one for development and one for production, that your users interact with. You can manage this with the version dropdown.",element:{type:"UI",class_name:".version-dropdown"},button_next:"Next"},{title:"Bubble Tour",content:"Click PREVIEW and see your application, instantly.  It's already live!",element:{type:"UI",class_name:".btn.preview"},button_next:"Next"},{content:"This app is yours! You can design it as you want. \n\n We pre-inserted some elements, but feel free to change everything! Or do CTRL+A to delete them all!",tab:"design",element:{type:"UI",class_name:".compound-cover-label",text:"account_buttons"},button_next:"Close"}]}},{"./../editor/css":560,"./../lang/appquery":651,"./../lang/lang":714,"./../optional/interactions":750,"./../u":823}],98:[function(e,t,n){"use strict";const r=n;r.contextual_videos={Page:566721363,Text:569032822,Image:569032038,Button:569031701,Link:569032110,Icon:569031983,Shape:569032731,Video:569032970,Calendar:91565967,GoogleMap:569032337,Alert:569986806,HTML:569031928,Group:569987721,RepeatingGroup:569032590,Popup:569988531,FloatingGroup:569906922,GroupFocus:569984982,Input:569032059,MultiLineInput:569032508,"sceditor-RichTextInput":92187786,Checkbox:569031495,Dropdown:569031546,AutocompleteDropdown:569032688,SliderInput:569985250,RadioButtons:569032563,DateInput:569031750,PictureInput:569985601,FileInput:569031878,LoggedIn:569032909,LoggedOut:569032938,PageLoaded:92252112,DoInterval:569031787,ButtonClicked:569031574,PopupClosed:92256884,PopupOpened:92257863,"fullcalendar-CalendarEventClicked":92263598,"fullcalendar-CalendarDayClicked":92269017,MapMarkerClicked:569032491,ConditionTrue:569031813,OnError:569031834,OnPageError:569031627,SignUp:92525333,LogIn:92525894,OAuthLogin:92527233,LogOut:92527586,UpdateCredentials:92529951,MakeChangeCurrentUser:92534275,SendPasswordResetEmail:92535071,ChangePage:92757129,RefreshPage:92757779,GoPrevious:92758740,OpenURL:92760264,NewThing:92762875,ChangeThing:92763705,ChangeListOfThings:92773447,DeleteThing:92773918,DownloadDataAsCSV:92774708,SendEmail:92775495,"mailchimp-AddUserToMailchimpList":92776853,"stripe-ChargeUser":92868195,"stripe-GetUserCCInfo":92868798,"stripe-ChargeUserWithSavedCC":92870290,"stripe-DefineAsSeller":92872333,"stripe-SubscribeStripePlan":92877710,"stripe-CancelStripePlan":92878138,"mixpanel-SendEventToMixpanel":92946022,"mixpanel-SendUserToMixpanel":92947567,"mixpanel-SendChargeToMixpanel":92948156,ShowElement:92952914,HideElement:92954188,ScrollToElement:92955066,SetFocusToElement:92956368,ResetInputs:92956857,DisplayListData:92964873,ListShowPrevious:92965399,ListShowNext:92966011,ListClear:92967692,ResetGroup:92970307,DisplayGroupData:92969640,AlertShowMessage:92970705,DisplayMapMarkerData:92972647,ClearMapMarkers:92971785};r.general_videos={bubble_interface:{category:"Getting started",description:"Learn how the editor works",length:"4:03",number:1,thumbnail:"//s3.amazonaws.com/appforest_uf/f1439793452144x724448957713320800/bubble_interface.png",title:"The Bubble interface",vimeo_id:65983338,script:"Hello, welcome to Bubble!\n\nThis video, we're going to go together through the Bubble interface.\n\nHere is where you're going to start building your application, the Bubble editor. The Bubble editor has two parts: the design tab, and the workflow tab. The design tab is where you're going to design your application, while the workflow tab where you're going to program your application.\n\nLet's stick to the design tab for now. What you have here, on the left, are the different elements you can have on your page: text, buttons, images, or input forms...\n\nHow does this work? If i want to add a button, I click on Button, and i draw it on the page. I can drag it around and resize it. What just appeared is the Property Editor. This is where you can change how your element looks like. If i want to display the text 'click me', i just type it there. I can also make the button red, or change other things...\n\nThe way you're usually going to do it is that you're going to build a rather simple interface for your application first, and then move to the workflow tab to program it. So let's do it.\n\nThe workflow tab is where you're going to design some workflows. In Bubble, a workflow is an event that triggers a series of actions. In this case, i open the event menu click here and pick 'an element is clicked', and I just need to define here which element should trigger the workflow. Here we only have one button, so it's simple. Then, I can pick the different actions that compose the workflow.\n\nWe have account management functions, to sign the user up, connect with facebook, etc. Navigation functions enable to redirect the users somewhere else. The Thing part is where you define your database, create elements in your database, like an apartment if you're building something like Airbnb. We'll cover this in another video. You can also send emails, charge credit cards, hide and show elements, etc.\n\nLet's do something simple in this example and let's redirect the user to another page when the button is clicked. Then i just define which page we should redirect to, index for instance.\n\nLet's get back to the overhaul interface. The Application button here is very important. It will let you navigate across the pages of your application. If i click here i can create a page. \n\nThe edit and option menu offer standard editing features, like copy/paste, etc. Most of the options of the edit menu can be found in the contextual menu, right clicking on an element. For instance, clicking 'Start/Edit workflow' is going to reveal the relevant workflow for a particular element.\n\nBubble applications are auto saved, in real-time, you don't need to do anything. For instance, if i move the button, it gets saved immediately.\n\nThe version dropdown here is where you control your application versions. A bubble app has two versions: the live version is the version that your users will have access to, and the development version is the one you work on. This is the one i'm modifying now.\n\nWhen you edit an application, you can have an instant feedback by clicking on preview. Clicking on this button will show you your app as your users will experience it.\n\nLast thing to know: imagine you're making a mistake in a workflow. For instance, we forget to specify which page we should redirect to. The red button here will track errors for you. Clicking on it will reveal a list of errors, and clicking on each error will take where you should fix it. When i fix it, we're good.\n\nThank you, in other videos, we'll get into building stuff. Good bye."},signup_wf:{category:"Getting started",description:"Build a sign up workflow",length:"3:40",number:2,thumbnail:"//s3.amazonaws.com/appforest_uf/f1439793595513x900158822070807200/first_workflow.png",title:"Building your first Bubble workflow",vimeo_id:66067131,script:"Hello, we going to build a sign up form together.\n\nWhat do we need for this? We need to build two input forms so that the user can type an email and a password, and a button to trigger the sign up. \n\nSo lets start with the input forms. I go to forms in the new element palette, and click on input. Then, I can draw a rather large input on the page.  I can also change the placeholder to prompt the user to type their email. \n\nI also define the content type as email to make sure the data entered is an email, and make it mandatory. \nFinally, lets center it in the middle of the page.\n\nLets duplicate this form. If I press control while dragging the element, the form will be duplicated. Lets change so that its built to receive a password.\n\nOkay, we have a simple version of a sign up form. Lets now add a button. We pick button in the visual section, and draw it under the input elements. Lets change the caption to Sign me up, and center it as well.\n\nGood, were now ready to think about workflow. What do we want to happen? When the button is clicked, we should sign the user up. So lets go to the workflow tab and do this.\n\nThe event we should pick here is an element is clicked, and lets define which element. There is only one button in our page, so its easy. The first action of this workflow is to actually sign the user up, using the credentials they entered. This action is in the account section of the action menu. \n\nThis action is going to create a new user for my application, using an email and a password. This is what I define in the Property Editor. \nI just need to tell Bubble where to find this information. Clicking on the Email field reveals a dropdown menu with the different sources of data. We can see the two inputs I just added to my page. In this case, this is the email input form. I do the same thing for the password and the password input form, and were all set. In run mode, at this stage, the user is signed up. \n\nNow, lets say we want to send a welcome email to our new user. To do this, I add a Send an Email action after the sign up action. I can find this action in the Do Stuff section of the action menu.\n\nSimilarly to the sign up action, I need to fill some fields in the Property Editor to define how the Send Email action should behave. Firstly, we need to specify who to send this email to. I, obviously, dont know the email of the new user, but I can define it as the current users email address. Clicking on Insert dynamic data reveals the different data sources in the workflow. In this case, I can pick current user. The next dropdown shows the different information I can have about the user, here, we pick email. Once this is done, I can type the email content as I would do in a regular mail service.\n\nFor the last action, lets redirect the user to another page after the sign up. I pick the Go to page action in the navigation section, and define the page to redirect to as post_signup.\n\nLets review what weve done: when the button is clicked, we sign the user up, based on the information in the page, we send an email to thank the user, and we change the page."},responsive_v1:{title:"Understanding the new responsive engine",vimeo_id:641690042,category:"Concepts",number:3,description:"A powerful way to build layouts using CSS Flexbox in Bubble ",thumbnail:"//s3.amazonaws.com/appforest_uf/f1635889863931x594112462900233200/responsive_v1.png",length:"17:18"},conditional:{category:"Tasks",description:"Build dynamic design",length:"2:51",number:6,thumbnail:"//s3.amazonaws.com/appforest_uf/f1439793997814x919836211251094900/conditionality.png",title:"Using conditional formatting",vimeo_id:79453035,script:"Hello, lets talk about conditional formatting. \n\nWhat do we mean by this? For instance, if I insert an icon and want it to look different when the user hovers it with the mouse, thats a conditional formatting. Right now, if I preview my app, its static, nothing happens when I hover it. How can I do this? Lets edit the icon and go to the conditional formatting tab.\n\nI can define here some states. Lets define a new state, which is the icon is hovered. I can define such a state using the dropdown menu. If I read this in plain English, it comes as when this icon is hovered. The next step is to define what should change in this state, in our example, lets change the color. I pick icon color, and pick another color. And were done! If I click preview, I can test this new behavior. \n\nThis is a very simple example of a conditional formatting usage. I can do other things. For instance, lets say I want the icon to change when the user is logged in. To do this, Im going to define a new state as When current user is logged in. In this state, lets change the icon itself, and pick a key. Lets test this. I still have my previous state, if I hover the icon, it turns red. Now if I log in, the icon turns to a key. And as the previous rule still applies, if I hover it, it turns red.\n\nThe conditional tab enables you to do a lot of things. Using different states, you can start having very complex behavior, depending on what the user does, some information for the database, etc. For instance, I could display some text when the user hovers the icon. \n\nLets insert a text element next to the icon, change its content to the icon is hovered and make it bigger. Now, lets go to the conditional formatting tab and define a new state. Lets define it as When the icon globe is hovered, and pick the visibility property. Now what we want to do by default is to set the element to hidden. I can do that in the appearance tab.\n\nLets test it. If I hover the icon with my mouse, the text shows up!"},save_stuff:{category:"Getting started",description:"Save custom data on server",length:"4:12",number:7,thumbnail:"//s3.amazonaws.com/appforest_uf/f1403900624126x224793329834938000/download3.png",title:"Saving stuff on the server",vimeo_id:66072019,script:"Hello! \n\nIn this video were going to talk about what you can save in your application and learn how to do it. Things that can be saved on the server can be products for a market place, friends, projects if youre building a crowd-funding platform, etc. When you save a thing, its stored on the server, and can be accessed from any user, to perform some searches, display them, change then, using workflow actions.\n\nLets start with a simple example on this page. We have a submit form, where users can register something to sell, like craigslist. There are some input forms, picture uploader, calendar, checkboxes, etc. Our user will use this form to submit an item. Each form has a name, that is displayed in the property editor.\n\nLets think about the workflow. What we want to happen is as follow: when the user clicks on submit, we create a new item, and then go to another page. We go to the workflow tab to build this workflow. Firstly, we pick the relevant event when the button submit is clicked. The first action we choose is Create a new thing, in the data/thing section. This will enable us to save the item on the server. \n\nWhen you create a new thing on bubble, you have to pick its type. For instance, user is a type. In this case, we havent create the type for the item to be sold yet, so lets do it now. If I click on the dropdown menu for Type, I can pick create a new type and I name it product.\n\nA type can have several fields. For instance, in this case, we want to save the description, the price, the picture, the availability, etc. I just need to click on set another field to define this information. Now, because its a new type, I need to define these fields. I do this clicking on create a new field in the dropdown.\n\nTo create a new field, I need to define a description; here I type name, for the name of the product, and a type of data. In this case, its a simple text. Okay, we just created our first field. \nAs a next step, we need to define the name of the product were currently creating in this action. In this case, the name is in an input form, on the page. Its a dynamic information. So we just need to click on Insert dynamic data, and pick the relevant input form in the page. In this case, its input name.\n\nLets add the last field together, based on the checkbox element. We pick create a new field to describe whether the product is negotiable. The field type we want to pick here is yes/no, as it is what describes a checkbox. Once this is done, we just need to define the value as the value of the checkbox in our page.\n\nOkay, at this stage of the workflow, the item is saved on the server. As a next action lets reset the input of the form. We pick reset a group, and pick the Group Submit as the group to reset.\nIf I go to the preference popup, I can see my newly created type. I can also modify them, delete them, etc.\n\nUsing what we just saved on the server, we can perform searches, display list of products, have our users buy them, etc.  What weve done with a product, can be done with anything. Messages if Im building a messaging system, posts if its a social network, friends, etc. The only thing you need to do is to think how to describe in the most accurate way what you want to save."},rep_group:{category:"Getting started",description:"Display list of data or search results",length:"4:48",number:8,thumbnail:"//s3.amazonaws.com/appforest_uf/f1439794471108x333667829865589760/rep_group.png",title:"Displaying data in a repeating group",vimeo_id:69004478,script:"Hi! \n\nIn this video, were going to learn how to display a list of elements from the database, using a repeating group. Here is a search page. Lets assume we have built a page where users can upload information about products they want to sell, like Craigslist.. This is done in another video. Now, we want to offer the ability to search for products. We have some search options here, product category, price limit, etc, and a search button.\n\nLets insert a repeating group. We find this in the container section of the new element palette. Lets make it quite wide, under the search criteria. As repeating groups are used to display lists, I can decide here how many lines and columns the repeating group should have.  Lets have 8 items at a time, and no column.\n\nThe way the repeating group works is as follow. I just need to build the first cell, and the other cells will follow a similar design. The first thing I need to define is the type of content the list has. In this case, we already have defined a type Product, thats what we want to pick. After picking a type, I can define a data source, which will define which products the repeating group should display. Lets say that, on page load, I want to display all the submitted products. If I click on data source, I can pick the Do a search for option that will enable me to search for all products. When I select this, the search palette shows up on the left. In this case, we want to search for products, we dont have constraints at this stage, but we probably want to sort the product. Lets sort them by price, having the most expensive ones first. \n\nOnce this is done, we just need to build the first cell to have a functioning list. Lets first add a text element on the left of the repeating group to display the product name. The red borders indicated were drawing the text element inside the repeating group. To set the text element content, I need to click insert dynamic data to get the current cells products information. I can do this using the dropdown menus.  I can see the different fields that describe a product, and just need to pick name. I can copy the element and modify the content to display the price instead. \n\nNow lets say we want our users to set some search criteria and refine the search results based on these criteria. This is done through a workflow, as it should happen when the user clicks on the search button. To build this workflow, Im going to right click on the button and pick start workflow.\n\nThe first action we want to pick here is display a list in a repeating group. Doing so, Ill be able to define a search that takes the search criteria into account. Lets pick display list in a repeating group in the Element actions section. Once this is done, I just have to define which element will receive the list. In our case, there is only one repeating group in the page, so its easy. Then, I define a data source as I did previously. Lets pick Do a search and design our search.\n\nWe want to do a search for products, with some constraints. What kind of constraints do we have? Lets have a look at our page: we have a category, a maximum price, and a checkbox to tell whether the price should be negotiable or not. If we get back to our search, we can work on the constraints. Lets add our first constraint clicking. This constraint is one the product category, and should be equal to the value of the dropdown. I can get this value using the Insert dynamic data button and referring the relevant page element.\n\nI can do the same thing with the price constraint. In this case, the operator we choose is smaller than. Lastly, we want negotiable to be equal to the value of the checkbox. Finally, lets sort the products by price again, and were all set!"},type_of_things:{category:"Concepts",description:"Structure your data",length:"7:15",number:9,thumbnail:"//s3.amazonaws.com/appforest_uf/f1439794594786x853982064407318800/type_of_things.png",title:"Defining types of things",vimeo_id:69090160},send_data_group:{category:"Getting started",description:"Define what to display in a group",length:"4:03",number:10,thumbnail:"//s3.amazonaws.com/appforest_uf/f1439794705083x873967658961191800/display_data.png",title:"Send data to a group",vimeo_id:79644686,script:"Hello,\n\nIn this video, we're going to talk about the concept of sending data to a group.\n\nLet's say we've already built a page with the results of search in a repeating group. In this case, we're building something like craigslist. What I want to do is to do build a button in each line of the repeating group so that, when the user clicks on it, the details of the item to sell is displayed on the right of the screen.\n\nLet's go to the editor to do this. The first thing to do is to build the button for each line. Let's draw at the right of the repeating group, in the first cell, and let's change the caption to 'Details. \n\nThe second step is to build the page area that is going to display details about the products. To do this, we use the group element, as groups can have data sent to them. Once I've drawn the group, i define its content as 'Product', this is the same time as the result of the search. \n\nThen, i just need to build the content of the group, drawing elements i need inside it. For instance, a text element can display the name of the product. Using 'display dynamic data', I can extract information from the product that is shown in the group, this is 'Current Element's current product', and then pick its name.\n\nTo display other information, such as the category or the price, i can do exactly the same thing. I can even copy the text elements and only need to change the field the display. If i want to display a picture, I can add an image element and pick the 'Current element's current product's picture' as its dynamic content.\n\nNow, we just need to link the button and the group. To do this, we're going to build a workflow that will be triggered when the button 'details' is clicked and than will change the content of the group.\n\nLet's right click on the button 'details' and choose 'Start/Edit workflow' to create a new workflow. Then, we pick the 'Display data in a group' action, in the Elements section. We define here which group we're dealing with for this action, in this case the 'Group product', as shown in the thumbnail. Lastly, the data to send, is going to be the 'Current Element's Current product'. In other words, it will be the product shown in the relevant line of the repeating group.\n\nLet's try it: if i click on details for each line, the content of the group is updated accordingly."},external_API:{title:"Using external APIs",vimeo_id:133106268,category:"Tasks",number:11,description:"Learn how to use the Google Places API",thumbnail:"//s3.amazonaws.com/appforest_uf/f1448896271514x773492053383961300/Google_Places_Logo.png",length:"1:05"},Etsy_API:{title:"Use the Etsy API from Bubble",vimeo_id:162729137,category:"Tasks",number:14,description:"Add Etsy's API with the API Connector",thumbnail:"//s3.amazonaws.com/appforest_uf/f1460575541647x879303049761802000/etsy.png",length:"7:33"}};const i={vimeo_id:718078874,title:"Application Editor Walkthrough",id:"application_editor_walkthrough"};const s={vimeo_id:718078855,title:"Designing an Interface",id:"interface_design"};const o={vimeo_id:718078837,title:"The Workflow Tab",id:"workflow_tab"};const a={vimeo_id:718078792,title:"The Data Tab",id:"data_tab"};const l={vimeo_id:705439062,title:"Intro to Data Types",id:"intro_to_data_types"};const c={vimeo_id:79644686,title:"Sending Data to a Group",id:"sending_data_to_group"};const u={vimeo_id:92964873,title:"Displaying List Data",id:"displaying_list_data"};const d={vimeo_id:92969640,title:"Displaying Group Data",id:"displaying_group_data"};const p={vimeo_id:92969640,title:"Padding in Container Elements",id:"padding_in_container_elements"};const _={vimeo_id:718078821,title:"The Property Editor",id:"property_editor"};const f={vimeo_id:718078808,title:"Building User Signup/Login",id:"building_user_signup"};const h={vimeo_id:718078731,title:"Deploying and Scaling Your Bubble App",id:"deploying_and_scaling_app"};const m={vimeo_id:66067131,title:"Sign Up Workflow",id:"sign_up_workflow"};const g={vimeo_id:739734251,title:"Understanding Workflow Execution Rules",id:"understanding_workflow_execution_rules"};const v={vimeo_id:739734233,title:'How to use the "Result of..." Expression',id:"use_result_of_expression"};const b={vimeo_id:739734202,title:"How to set up Privacy Rules",id:"setup_privacy_rules"};const y={vimeo_id:739734175,title:"How to use the Slidebar Menu Plugin",id:"use_slidebar_menu_plugin"};const w={vimeo_id:739734202,title:"How to Dynamically Display a List in a Slidebar Menu",id:"dynamically_display_list_in_slidebar_menu"};const x={vimeo_id:739734152,title:"Extending Your App",id:"extending_your_app"};const j={vimeo_id:739734122,title:"How to set up Custom Domains",id:"setup_custom_domains"};const A={vimeo_id:739734102,title:"How to set up a Custom Font",id:"setup_custom_font"};r.onboarding_videos=[i,s,o,a,_,f,h];r.workflow_videos=[o,m,f,g,v,h];r.data_videos=[a,l,c,u,d,b];r.styles_videos=[i,p];r.plugins_videos=[y,w];r.settings_videos=[j,A,x];r.logs_videos=[h]},{}],99:[function(e,t,n){"use strict";const r=e("../../../lang/evaluation/state_keys");t.exports={field_names:{user:{},new_email:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"change_email_for_another_user",data_to_refresh(e,t,n){const i={};const{user:s}=t;if(s!=null){i[r.Message({prev:s,message:"email",prior_btype_id:"user"})]=t.new_email}return i}}},{"../../../lang/evaluation/state_keys":699}],100:[function(e,t,n){"use strict";t.exports={field_names:{token:{},valid_30_days:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"check_2fa_token",data_to_refresh:null}},{}],101:[function(e,t,n){"use strict";t.exports={field_names:{password:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"check_user_password",data_to_refresh:null}},{}],102:[function(e,t,n){"use strict";const r=e("../utilities/account_actions_utilities");t.exports={field_names:{},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"cookie_opt_in",requires_cookies:true,data_to_refresh:r.refresh_current_user,check_for_errors:r.check_errors_no_scheduled_context}},{"../utilities/account_actions_utilities":172}],103:[function(e,t,n){"use strict";const r=e("../utilities/account_actions_utilities");t.exports={field_names:{},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"cookie_opt_out",requires_cookies:true,data_to_refresh:r.refresh_current_user,check_for_errors:r.check_errors_no_scheduled_context}},{"../utilities/account_actions_utilities":172}],104:[function(e,t,n){"use strict";const r=e("../../../u/shared/mode_check");const i=e("../../../u/shared/b_object");const s=e("../utilities/generic_actions_utilities");const o=e("../../../constants/eval");t.exports={field_names:i.extend({email:{},password:{},return_user_if_already_exists:{}},s.change_field_names(o.EVAL_TYPE.value)),run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"create_user_account",data_to_refresh:null,return_value(){return a.get("user")},preprocess_properties(e){const t="user";const n="changes";e=s.pre_process_properties({properties:e,prop_name:n,thing_btype_id:t});if(typeof e.email==="string"&&!r.on_server()){e=s.apply_default_fields(n,t,e)}return e}};const a=e("../../../lang/btypes")},{"../../../constants/eval":64,"../../../lang/btypes":653,"../../../u/shared/b_object":839,"../../../u/shared/mode_check":851,"../utilities/generic_actions_utilities":175}],105:[function(e,t,n){"use strict";const r=e("../../../lang/evaluation/state_keys");t.exports={field_names:{token:{},password:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"disable_2fa",data_to_refresh(e,t,n){const s={};s[r.Message({prev:i().current_user(),message:"uses_2fa",prior_btype_id:"user"})]=false;return s}};const i=e("../../../lib")},{"../../../lang/evaluation/state_keys":699,"../../../lib":741}],106:[function(e,t,n){"use strict";t.exports={field_names:{password:{}},do_not_log_result:true,run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"generate_2fa_qr_code",data_to_refresh:null,return_value(){return r.get("image")}};const r=e("../../../lang/btypes")},{"../../../lang/btypes":653}],107:[function(e,t,n){"use strict";const r=e("../../../lang/evaluation/state_keys");const i=e("../../../lang/btype_ids");t.exports={field_names:{token:{},password:{},number_of_codes:{default:10}},do_not_log_result:true,run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"generate_one_time_codes",data_to_refresh(e,t,n){const i={};i[r.Message({prev:s().current_user(),message:"has_codes",prior_btype_id:"user"})]=true;return i},return_value(){return o.get(i.list_type("text"))}};const s=e("../../../lib");const o=e("../../../lang/btypes")},{"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lang/evaluation/state_keys":699,"../../../lib":741}],108:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/account_actions_utilities");t.exports={field_names:{email:{},password:{},stay_logged_in:{default:true},remember_email:{optional:true}},run(e,t,n,s){n.get_server_outcome(e,((e,n)=>{if(t.remember_email){r.local_storage_put(i.get_remember_email_key(),{email:t.email})}i.get_iframe_for_cookie_phonegap();s(e,n)}))},server_method:"log_in",check_for_errors(e,t){if(e.next()&&s.get_public_setting("twofa_auth")){if(!["ShowElement","HideElement"].includes(e.next().type())){t(this.display(e)+" must be the last action in the workflow when you use 2-factor authentication")}}return false},data_to_refresh:i.refresh_current_user,requires_cookies:true};const s=e("../../../lang/appquery")},{"../../../lang/appquery":651,"../../../u":823,"../utilities/account_actions_utilities":172}],109:[function(e,t,n){"use strict";const r=e("../utilities/account_actions_utilities");t.exports={field_names:{},run(e,t,n,i){n.get_server_outcome(e,((e,t)=>{r.get_iframe_for_cookie_phonegap();i(e,t)}))},server_method:"log_out",requires_cookies:true,data_to_refresh:r.refresh_current_user}},{"../utilities/account_actions_utilities":172}],110:[function(e,t,n){"use strict";t.exports={field_names:{},server_method:"log_out_other_sessions",data_to_refresh:null}},{}],111:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../constants/db");const s=e("../../data_updates");const o=e("../utilities/generic_actions_utilities");const a=e("../../../constants/eval");t.exports={field_names:{...o.change_field_names(a.EVAL_TYPE.value)},run(e,t,n,i){if(t.changes&&!r.is_empty(t.changes)){const e=l().current_user();const n=s.update_thing(e,t.changes);n.callback(i)}else{i()}},data_to_refresh(e,t,n){return o.get_data_to_refresh_for_change_action({to_change:l().current_user(),to_change_value_id:"user",changes:t.changes})},return_value(){return null},server_method:"change_current_user",preprocess_properties:o.make_pre_process_properties({prop_name:"changes",thing_btype_id:"user"}),fall_back_to_server:true,requires_server(){if(r.on_client()&&l().current_user()._id()===i.NO_USER){return false}else{return true}}};const l=e("../../../lib")},{"../../../constants/db":58,"../../../constants/eval":64,"../../../lib":741,"../../../u":823,"../../data_updates":381,"../utilities/generic_actions_utilities":175}],112:[function(e,t,n){"use strict";const r=e("../../../services");const i=e("../../../constants/lang");const s=e("../utilities/account_actions_utilities");t.exports={field_names:i.DETECT_FIELD_NAMES,not_api:true,run(e,t,n,i){n.get_server_outcome(e,((s,o)=>{if(s){i(s);return}const{oauth_provider:a}=t;const l=r.get_oauth_authenticator(a);if(!l||!l.login){if(!a){window.alert("Oops, please fill out the social network for this action")}else{window.alert("Undefined oauth provider: "+a)}i("aborted");return}l.login(n,e,o,i)}))},resume(e,t,n){t.get_server_outcome(e,n)},check_for_errors(e,t){const n=e.get_static_property("oauth_provider");const i=r.get_oauth_authenticator(n);if(i!=null&&i.are_keys_missing()){t(this.display(e)+" - remember to fill your app id and secret for "+i.display())}return false},server_method:"oauth_login",server_method_resume:"oauth_login_resume",data_to_refresh:s.refresh_current_user,requires_cookies:true}},{"../../../constants/lang":73,"../../../services":780,"../utilities/account_actions_utilities":172}],113:[function(e,t,n){"use strict";t.exports={field_names:{new_password:{},new_password_again:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"reset_password",data_to_refresh:null}},{}],114:[function(e,t,n){"use strict";const r=e("../../../lang/btypes");t.exports={field_names:{page:{},just_make_token:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"send_confirmation_email",return_value(e){if(e.get_static_property("just_make_token")){return r.get("text")}else{return null}},data_to_refresh:null,check_use_visible:true}},{"../../../lang/btypes":653}],115:[function(e,t,n){"use strict";t.exports={field_names:{email:{},subject:{default:"Your magic link"},body:{default:"Hello,\n\n"+"You requested a magic link to login to your account. Please note that\n"+"this link can only be used to login once and lasts for one hour.\n\n"+"The Team\n\n"},link_text:{default:"Login here"},valid_link_time_frame:{default:null,validation_fn(e){return e<=24&&e>0}},success_page:{},success_customize:{},failure_customize:{},data_to_send_success:{},data_to_send_failure:{},add_parameters_success:{},add_parameters_failure:{},url_parameters_success:{},url_parameters_failure:{},keep_current_page_params_success:{},keep_current_page_params_failure:{},failure_page:{},just_make_link:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"send_magic_link_email",return_value(e){if(e.get_static_property("just_make_link")){return r.get("text")}else{return null}},check_use_visible:true,data_to_refresh:null,do_not_send_result_to_client:true};const r=e("../../../lang/btypes")},{"../../../lang/btypes":653}],116:[function(e,t,n){"use strict";t.exports={field_names:{to:{},subject:{default:"Your password reset request"},body:{default:"Hello,\n\n"+"Someone (hopefully you!) submitted a request to reset your password. If it wasn't you, "+"please ignore this message. If it was you, you can reset your password at the below link.\n\n"+"The Team\n\n"},just_make_token:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"send_password_reset_email",return_value(e){if(e.get_static_property("just_make_token")){return r.get("text")}else{return null}},check_use_visible:true,data_to_refresh:null,do_not_send_result_to_client:true};const r=e("../../../lang/btypes")},{"../../../lang/btypes":653}],117:[function(e,t,n){"use strict";t.exports={field_names:{user:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"set_temporary_password",do_not_log_result:true,data_to_refresh:null,return_value(){return r.get("text")}};const r=e("../../../lang/btypes")},{"../../../lang/btypes":653}],118:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/account_actions_utilities");const s=e("../utilities/generic_actions_utilities");const o=e("../../../constants/eval");t.exports={field_names:{email:{},password:{},password2:{},require_confirm:{},send_confirm_email:{},page:{},remember_email:{optional:true},...s.change_field_names(o.EVAL_TYPE.value)},run(e,t,n,s){n.get_server_outcome(e,((e,n)=>{i.get_iframe_for_cookie_phonegap();if(e){s(e);return}a().current_user().flush();if(t.remember_email===true){r.local_storage_put(i.get_remember_email_key(),{email:t.email})}s(e,n)}))},server_method:"sign_up",data_to_refresh:i.refresh_current_user,preprocess_properties(e){const t="user";const n="changes";e=s.pre_process_properties({properties:e,prop_name:n,thing_btype_id:t});e=s.apply_default_fields(n,t,e);return e},requires_cookies:true};const a=e("../../../lib")},{"../../../constants/eval":64,"../../../lib":741,"../../../u":823,"../utilities/account_actions_utilities":172,"../utilities/generic_actions_utilities":175}],119:[function(e,t,n){"use strict";const r=e("../../../lang/evaluation/state_keys");t.exports={field_names:{old_password:{},change_email:{},email:{},change_password:{},password:{},require_confirm:{},password2:{},do_not_show_success_alert:{},send_confirm_email:{},page:{default:"index"}},run(e,t,n,r){n.get_server_outcome(e,(e=>{i().current_user().flush();if(e){r(e)}else{if(!t.do_not_show_success_alert){alert(i().get_text("CORE","UPDATE_CREDENTIAL_SUCCESS"))}r()}}))},server_method:"update_credentials",data_to_refresh(e,t,n){const s={};if(t.change_email){const e=i().current_user();s[r.Message({prev:e,message:"email",prior_btype_id:"user"})]=t.email}return s}};const i=e("../../../lib")},{"../../../lang/evaluation/state_keys":699,"../../../lib":741}],120:[function(e,t,n){"use strict";const r=e("../../../lang/evaluation/state_keys");t.exports={field_names:{token:{}},run(e,t,n,r){n.get_server_outcome(e,r)},server_method:"validate_2fa_token",data_to_refresh(e,t,n){const s={};s[r.Message({prev:i().current_user(),message:"uses_2fa",prior_btype_id:"user"})]=true;return s}};const i=e("../../../lib")},{"../../../lang/evaluation/state_keys":699,"../../../lib":741}],121:[function(e,t,n){"use strict";t.exports={field_names:{scheduled_ids:{}},server_method:"cancel_list_scheduled_api_events"}},{}],122:[function(e,t,n){"use strict";const r=e("../../../logger");function i(e){if(e==null||e.split==null){return false}return e.split(",").every((e=>{const t=Number(e);return!Number.isNaN(t)&&parseInt(t)===t}))}t.exports={field_names:{scheduled_id:{}},server_method:"cancel_scheduled_api_event",run(e,t,n,s){n.get_server_outcome(e,((e,n)=>{if(e){const e=t.scheduled_id;let n=`The id ${e} is not correctly formatted. `;if(i(t.scheduled_id)){n+="It is formatted as a list of ids. Consider using the 'Cancel a list of scheduled API Workflows' action."}else{n="It should be a single numerical ID in a text expression."}r.owner_error("Invalid API workflow id",{display:"Invalid API workflow id: "+n})}s(e,n)}))}}},{"../../../logger":744}],123:[function(e,t,n){"use strict";const r=e("../../status_bar");t.exports={field_names:{length:{default:1e3},hide_status_bar:{}},run(e,t,n,i){if(!t.length||t.length<=0){t.length=0}if(t.hide_status_bar){function s(){if(r.bar_visible()){r.hide_run_mode()}else{setTimeout(s,100)}}s()}setTimeout((()=>{if(t.hide_status_bar){r.show_run_mode()}i()}),t.length)},not_api:true,data_to_refresh:null}},{"../../status_bar":415}],124:[function(e,t,n){"use strict";const r=e("../../../lang/lang");function i(e,t,n){if(!n){t(undefined,undefined,e.id());return true}else{return false}}t.exports={field_names:r.DETECT_FIELD_NAMES,server_method:"schedule_api_event",check_for_errors(e,t,n){return i(e,t,n)},return_value(){return s.get("text")},run(e,t,n,r){n.get_server_outcome(e,r)}};const s=e("../../../lang/btypes")},{"../../../lang/btypes":653,"../../../lang/lang":714}],125:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../u/shared/async/b_fiber");const s=e("../../../constants/lang");const o=e("../../../lang/evaluation/evaluate");const a=e("../../../lang/evaluation/eval_node_state");const l=e("../utilities/generic_actions_utilities");const{escape_app_json_key:c}=e("../../../lang/app_json/json_utils");const u=e("../../../lang/btype_ids");function d(e,t,n){if(!n){t(undefined,undefined,e.id());return true}else{return false}}t.exports={field_names:s.DETECT_FIELD_NAMES,server_method:"schedule_api_event_on_list",use_injected_datasource(e,t){if(t.node_name().startsWith(l.APIEvent_param_prefix)){return[true,true]}else{const n=t.parent_expression();if(n==null){return[false,true]}return this.use_injected_datasource(e,n)}},get_injected_value(e,t){return e.get_static_property("type_of_list")},get_injected_display(e,t){return"This "+f.get(e.get_static_property("type_of_list")).display()},preprocess_properties(e,t,n){var s,u,d,h;n=r.extend({},n);n.duplicated_from_context=n.object_id;n.object_id=r.UUID();n.duplicated_at="ScheduleAPIEventOnList::preprocess_properties";(s=e.type_of_list)!=null?s:e.type_of_list=f.get(e.type_of_list,{miss_okay:true}).id();n.datasources.injected_value_btype=()=>e.type_of_list;const m=(u=e.data_source)!=null?u:p().db_instance().static_list(e.type_of_list,[]);delete e.data_source;e.to_run=[];const g=_.workflow_item(e.api_event);const v=(d=g==null?void 0:(h=g.get_custom_parameters)==null?void 0:h.call(g))!=null?d:[];for(const t in e){if(t.startsWith(l.APIEvent_param_prefix)){delete e[t]}}const b=r.on_server()?20:1e3;let y=0;while(true){var w,x;if(r.on_server()){i.optional_pause()}const s=(w=(x=m.get_children)==null?void 0:x.call(m,y,b))!=null?w:[];const u=s.filter((e=>e!=null));for(const e of u){var j;(j=e.precache)==null?void 0:j.call(e)}y+=b;if(u.length===0){break}for(const r of u){const i={injected_value:r};n.datasources.injected_value=()=>r;for(const{param_id:e}of v){const r=l.APIEvent_param_prefix+c(e);const s=t.property(r);a.with_eval_node(s,(()=>{const[e]=o.evaluate_json(s.json,n,null,null);i[r]=e}))}e.to_run.push(i)}}return e},check_for_errors(e,t,n){return d(e,t,n)},return_value(){return f.get(u.list_type("text"))},run(e,t,n,r){n.get_server_outcome(e,r)}};const p=e("../../../lib");const _=e("../../../lang/appquery");const f=e("../../../lang/btypes")},{"../../../constants/lang":73,"../../../lang/app_json/json_utils":631,"../../../lang/appquery":651,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lang/evaluation/eval_node_state":694,"../../../lang/evaluation/evaluate":695,"../../../lib":741,"../../../u":823,"../../../u/shared/async/b_fiber":833,"../utilities/generic_actions_utilities":175,"core-js/modules/web.dom-collections.iterator.js":1123}],126:[function(e,t,n){"use strict";const r=e("../../../lang/evaluation/page_state");const i=e("../../../u");const s=e("../../../logger");const o=e("../../../constants/workflow");const a=e("../../core_datasources/utilities/core_ds_workflow_utilities");let l=0;t.exports={field_names:{custom_event:{},workflow_thing:{legacy:true},arguments:{},delay:{}},run(e,t,n,p){var _;const f=a.wf_params_from_properties(t);const h=u.event(t.custom_event);if(!(h!=null&&h.exists())){console.log("Skipping trigger custom event on change, event does not exist");p();return}const{element:m}=n;const g=c().workflow;let v=0;const b=h.actions().some((e=>e.requires_server()));if(b){l++;setTimeout((()=>l--),30*1e3);if(l>10){v=(l-10)*30*1e3}}let y=((_=t.delay)!=null?_:1)*1e3+v;if(y>2147483647){y=2147483647;s.owner_warn(new i.OwnerError("max_timeout",{action:e,display:"Timeout is above the maximum of 2,147,483 seconds; shortening to 2,147,483"}))}setTimeout((()=>{const e=a.build_duplicate_per_item_context({element:m},f);e.datasources=r.get_basic_datasources(e.element.element.root(),e.datasources);g.run_workflows(e,[h],true).callback((e=>d.handle_uncaught_error({original_error:e,caught_from:o.ERROR_SOURCES.GENERAL_WORKFLOW,cb(){}})))}),y);p()},not_api:true};const c=e("../../../lib");const u=e("../../../lang/appquery");const d=e("../../core_events")},{"../../../constants/workflow":95,"../../../lang/appquery":651,"../../../lang/evaluation/page_state":698,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../core_datasources/utilities/core_ds_workflow_utilities":236,"../../core_events":377}],127:[function(e,t,n){"use strict";t.exports={field_names:{recurring_event:{},workflow_thing:{},frequency:{},start_date:{}},server_method:"set_recurring_event"}},{}],128:[function(e,t,n){"use strict";t.exports={field_names:{},handle_condition_internally:true,run(e,t,n,r){if(t.condition){r("aborted")}else if(n.is_running_on_server){n.get_server_outcome(e,((e,t)=>{if(e){r(e)}else if(t==="aborted"){r("aborted")}else{r()}}))}else{r()}}}},{}],129:[function(e,t,n){"use strict";t.exports={field_names:{custom_event:{},workflow_thing:{legacy:true},arguments:{}},check_for_errors(e,t,n){return false}}},{}],130:[function(e,t,n){"use strict";t.exports={field_names:{element_id:{},custom_event:{},workflow_thing:{legacy:true},arguments:{}},not_api:true,check_for_errors(e,t,n){if(!n){t(undefined,undefined,e.id());return true}return false}}},{}],131:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("lodash/isEqual");const s=e("../../../constants/core");const o=e("../../core_datasources/utilities/core_ds_workflow_utilities");t.exports={field_names:{custom_event:{},workflow_thing:{},field:{}},check_for_errors(e,t){const n=e.get_static_property("custom_event");if(n){var r;const i=(r=l.event(n))==null?void 0:r.get_custom_parameters().length;if(i!==1){t(this.display(e)+" - can only be used with custom events that take exactly one argument")}}return false},run(e,t,n,u){const{workflow_thing:d,field:p}=t;const _=l.event(t.custom_event);if(d==null||p==null||!(_!=null&&_.exists())){console.log("Skipping trigger custom event on change, missing data");u();return}const{element:f}=n;const h=a().workflow;r.run_once(30,(()=>{if(p==="email_confirmed"){return c.get("user").get_message("email_confirmed").evaluate(d)}else{return d.child(p).raw()}}),((e,t)=>{if(e){u(e);return}u();d.poll(5e3,600);let n=false;const a=r.Watcher({fn(){return d.child(p).raw()},compare:i});a.on_value((e=>{if(n){return}if(!r.compare(t,e)){var i,l;n=true;a.destroy();const e=(i=(l=_.get_custom_parameters()[0])==null?void 0:l.param_id)!=null?i:s.LEGACY_PARAM_ID;const t={};t[e]=d;const r=o.build_duplicate_per_item_context({element:f},t);console.log(Object.keys(r.datasources.get_wf_param({param_id:"__ALL__"})));h.run_workflows(r,[_],true)}}))}))},not_api:true};const a=e("../../../lib");const l=e("../../../lang/appquery");const c=e("../../../lang/btypes")},{"../../../constants/core":55,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lib":741,"../../../u":823,"../../core_datasources/utilities/core_ds_workflow_utilities":236,"lodash/isEqual":1321}],132:[function(e,t,n){"use strict";t.exports={api_only:true,field_names:{return_plain_text:{},custom_content_type:{},text:{},custom_text:{},parameters_actions:{}},run(e,t,n,r){},server_method:"api_return_data",check_for_errors(e,t){const n=e.event().actions("APIReturnData").filter((e=>{var t,n,r;return((t=e.property)==null?void 0:(n=t.call(e,"condition"))==null?void 0:(r=n.json)==null?void 0:r.raw())==null})).length;if(n>1){t("You should use only one 'Return data from API' action per API workflow")}return false}}},{}],133:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../u/shared/async/b_fiber");const s=e("../../../lang/evaluation/eval_node_state");const o=e("../../data_updates");const a=e("../utilities/generic_actions_utilities");const l=e("../../../constants/eval");const c=e("../../../lang/btype_ids");t.exports={field_names:{type_to_change:{},to_change:{},...a.change_field_names(l.EVAL_TYPE.thunk)},use_injected_datasource(e,t){return a.use_injected_for_change_actions(e,t)},get_injected_value(e,t){return e.get_static_property("type_to_change")},get_injected_display(e,t){return"This "+d.get(e.get_static_property("type_to_change")).display()},preprocess_properties(e,t,n){var o;i.optional_pause();n=r.extend({},n);n.duplicated_from_context=n.object_id;n.object_id=r.UUID();n.duplicated_at="ChangeListOfThings::preprocess_properties";if(!d.is_custom_type(e.type_to_change)){return{changes:null}}n.datasources.injected_value_btype=()=>e.type_to_change;const l=(o=e.to_change)!=null?o:new u([],null,e.type_to_change);delete e.to_change;const c=e.changes;e.changes=[];const p=t.property("changes");const _=r.on_server()?20:1e3;s.with_eval_node(p,(()=>{let t=0;while(true){var r,s;const u=(r=(s=l.get_children)==null?void 0:s.call(l,t,_))!=null?r:[];const d=u.filter((e=>(e==null?void 0:e._id)!=null));for(const e of d){var o;(o=e.precache)==null?void 0:o.call(e)}t+=_;if(d.length===0){break}i.optional_pause();for(const t of d){n.datasources.injected_value=()=>t;const r=c(n);const s=e.type_to_change;const o="changes";e.changes.push(a.pre_process_properties({properties:{item:t,changes:r},prop_name:o,thing_btype_id:s}));i.optional_pause()}}i.optional_pause()}));return e},run(e,t,n,i){if(!t.changes){i(null,null);return}const s=t.changes.map((e=>{let{item:n,changes:r}=e;return o.update_thing(n,r,t.type_to_change)}));r.promise_array(s).callback((e=>{if(!d.is_custom_type(t.type_to_change)){i(null,null);return}i(e,new u(t.changes.map((e=>{let{item:t}=e;return t})),null,t.type_to_change))}))},data_to_refresh(e,t,n){const i={};if(!t.changes){return i}for(const{item:e,changes:n}of Object.values(t.changes)){const s=a.get_data_to_refresh_for_change_action({to_change:e,to_change_value_id:t.type_to_change,changes:n});r.extend(i,s)}return i},return_value(e){const t=e.get_static_property("type_to_change");if(t){return c.list_type(t)}else{return"null"}},server_method:"change_list_of_things",fall_back_to_server:true};const u=e("../../../db/values/StaticList");const d=e("../../../lang/btypes")},{"../../../constants/eval":64,"../../../db/values/StaticList":471,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lang/evaluation/eval_node_state":694,"../../../u":823,"../../../u/shared/async/b_fiber":833,"../../data_updates":381,"../utilities/generic_actions_utilities":175,"core-js/modules/web.dom-collections.iterator.js":1123}],134:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../logger");const s=e("../../../shared/investigations");const o=e("../../data_updates");const a=e("../utilities/generic_actions_utilities");const l=e("../../../constants/eval");const c=e("../../../lang/evaluation/eval_node_state");t.exports={field_names:{to_change:{},create_if_missing:{},...a.change_field_names(l.EVAL_TYPE.thunk)},run(e,t,n,r){const{to_change:i}=t;if(i!=null){const e=o.update_thing(i,t.changes);e.callback((e=>{r(e,i)}))}else if(t.create_if_missing){var s;const i=(s=this._get_type(e))==null?void 0:s.id();const a=n.UUID_SEED.UUID();if(i){const e=u().db_instance().create(i,null,a);o.update_thing(e,t.changes).callback((t=>{r(t,e)}))}else{r()}}else{r()}},use_injected_datasource(e,t){return a.use_injected_for_change_actions(e,t)},_get_type(e){return e.property("to_change").get_eval_value()},get_injected_value(e,t){return this._get_type(e)},get_injected_display(e,t){var n;return"This "+((n=this._get_type(e))==null?void 0:n.display())},server_method:"change_thing",data_to_refresh(e,t,n){var r;return a.get_data_to_refresh_for_change_action({to_change:t.to_change,to_change_value_id:(r=this._get_type(e))==null?void 0:r.id(),changes:t.changes})},return_value(e){return this._get_type(e)},preprocess_properties(e,t,n){var o;n=r.extend({},n);n.duplicated_from_context=n.object_id;n.object_id=r.UUID();n.duplicated_at="ChangeThing::preprocess_properties";const l=(o=this._get_type(t))==null?void 0:o.id();const{to_change:u}=e;n.datasources.injected_value_btype=()=>l;n.datasources.injected_value=()=>u;const d="changes";const p=t.property(d);e.changes=c.with_eval_node(p,(()=>e.changes(n)));const _=s.action_update_thing.active();const f={};if(_){f.from_json=r.extend({},e.changes)}e=a.pre_process_properties({properties:e,prop_name:d,thing_btype_id:l});if(_){f.pre_processed=r.extend({},e.changes)}if(u==null&&e.create_if_missing){if(l){e=a.apply_default_fields(d,l,e);if(_){f.with_defaults=r.extend({},e.changes)}}}if(_){i.debug("change_thing pre_evaluation",f)}return e},fall_back_to_server:true,is_mergeable:true};const u=e("../../../lib")},{"../../../constants/eval":64,"../../../lang/evaluation/eval_node_state":694,"../../../lib":741,"../../../logger":744,"../../../shared/investigations":798,"../../../u":823,"../../data_updates":381,"../utilities/generic_actions_utilities":175}],135:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../logger");const s=e("../../../client_config");const o=e("../utilities/generic_actions_utilities");const a=e("../../../lang/btype_ids");t.exports={field_names:{type_to_copy:{},to_copy:{},information:{}},preprocess_properties(e){var t;if(typeof((t=e.to_copy)==null?void 0:t.length)!=="function"||e.to_copy.length()>s.max_new_list_length){e.to_copy=[]}else{var n,r,i;e.to_copy=(n=(r=e.to_copy)==null?void 0:(i=r.all)==null?void 0:i.call(r))!=null?n:[]}return e},run(e,t,n,s){var a;if(!u.is_custom_type(t.type_to_copy)){s(null,null);return}const d=((a=t.to_copy)!=null?a:[]).filter((e=>(e==null?void 0:e._id)!=null));return r.run_once(30,(()=>d.map((e=>e.raw()))),((e,r)=>{if(e){i.log(e);return}const a=r.map((e=>{const r=n.UUID_SEED.UUID();const i=o.prepare_raw_thing_to_copy(e);return l().db_instance().create(t.type_to_copy,i,r)}));s(undefined,new c(a,null,t.type_to_copy))}))},data_to_refresh:null,return_value(e){const t=e.get_static_property("type_to_copy");if(t){return a.list_type(t)}else{return"null"}},server_method:"copy_list_of_things",fall_back_to_server:true};const l=e("../../../lib");const c=e("../../../db/values/StaticList");const u=e("../../../lang/btypes")},{"../../../client_config":41,"../../../db/values/StaticList":471,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lib":741,"../../../logger":744,"../../../u":823,"../utilities/generic_actions_utilities":175}],136:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");t.exports={field_names:{type_to_delete:{},to_delete:{}},preprocess_properties(e){var t,n,r;e.to_delete=(t=(n=e.to_delete)==null?void 0:(r=n.all)==null?void 0:r.call(n))!=null?t:[];return e},run(e,t,n,r){var i;const s=((i=t.to_delete)!=null?i:[]).filter((e=>(e==null?void 0:e._id)!=null));for(const e of s){var o;(o=e.delete)==null?void 0:o.call(e)}r()},data_to_refresh:null,return_value(e){return null},server_method:"delete_list_of_things",fall_back_to_server:true}},{"core-js/modules/web.dom-collections.iterator.js":1123}],137:[function(e,t,n){"use strict";t.exports={field_names:{to_delete:{}},run(e,t,n,r){var i;const{to_delete:s}=t;s==null?void 0:(i=s.delete)==null?void 0:i.call(s);r()},data_to_refresh:null,return_value(e){return null},server_method:"delete_thing",fall_back_to_server:true,is_mergeable:true}},{}],138:[function(e,t,n){"use strict";t.exports={field_names:{url_to_delete:{}},data_to_refresh:null,server_method:"delete_upload_file",run(e,t,n,r){n.get_server_outcome(e,((e,t)=>r(e,t)))}}},{}],139:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../logger");const s=e("../utilities/core_actions_consts");function o(e,t,n){if(t==null){return""}if(e.has_export_to_string()){return e.export_to_string(t,{option_show_if_deleted:false,custom_use_primary_field:false,booleans_yes_no:false,always_return_text:true,date_formatting:n})}else{i.error("Tried to display a value in DownloadAsCSV but no export_to_string for this value",{ret_btype_id:e.id()});return""}}function a(e,t,n,r,i){var s;(s=r)!=null?s:r=[];const a=[];const l=u.get(t);const c=[];if(l.custom_type()){c.push(...l.custom_type().fields().filter((e=>!e.deleted())).map((e=>e.name())));c.push(...["Created Date","Modified Date","_id","Slug"]);if(t==="user"){c.push("email")}else{c.push("Created By")}}else{c.push(...l.get_messages(true).map((e=>e.name())))}for(const t of e){const e={};for(const s of c){if(!r.includes(s)){const r=l.get_message(s);const a=r.ret_btype();const c=r.evaluate(t);const u=o(a,c,n);const p=i?r.description(undefined,true):r.name();e[p]=u;if(s==="Created By"&&u){var d;e["Created By - email"]=(d=l.get_message("Created By").evaluate(t).get_email())!=null?d:""}}}a.push(e)}return a}t.exports={not_api:true,field_names:{data_type:{},data_source:{},file_name:{default:"data_export.csv"},date_formatting:{default:"spreadsheet_compatible"},custom_format:{default:"ddd, m/dd/yy, mmmm (mmm) dS, yyyy, h:MM tt, HH:MM:ss.L"},separator:{default:"comma"},show_labels:{default:true},use_quotes:{default:true},use_caption_labels:{default:false},hide_some_fields:{optional:true}},run(e,t,n,o){var u;if(!l().app_plan().import_export_csv){o(new r.OwnerError("Exporting CSV data is not possible under this plan."));return}if(!t.data_type){o(null,"Must set a type of thing")}let d;if(t.separator==="tab"){d="\t"}else{var p;d=(p=s.csv_separators[t.separator])!=null?p:","}const _=t.date_formatting==="custom"?t.custom_format:t.date_formatting;const f=(u=t.data_source)!=null?u:new c([],null,t.data_type);r.run_once(120,(()=>{f.all();const e=f.length();const n=100;const i=[];for(let s=0;s<e;s+=n){i.push(r.run_once(10*60*1e3,(()=>{var e,i;const o=(e=f.get_children(s,n))!=null?e:[];return a(o,t.data_type,_,r.json_parse((i=t.hide_some_fields)!=null?i:"[]"),t.use_caption_labels)})))}return i})).then((e=>r.promise_array(e).callback(((e,n)=>{let{file_name:s}=t;if(s.indexOf(".csv")!==s.length-4){s=s+".csv"}let a;if(e){i.log(e);a="Error exporting data... please try again in a bit"}else{let e=[];for(const t of n){e=e.concat(t)}a=r.json_to_csv(e,d,t.show_labels,t.use_quotes)}r.csv_to_downloadable_file(s,a);o(null,a)}))))},data_to_refresh:null};const l=e("../../../lib");const c=e("../../../db/values/StaticList");const u=e("../../../lang/btypes")},{"../../../db/values/StaticList":471,"../../../lang/btypes":653,"../../../lib":741,"../../../logger":744,"../../../u":823,"../utilities/core_actions_consts":173,"core-js/modules/web.dom-collections.iterator.js":1123}],140:[function(e,t,n){"use strict";const r=e("../../data_updates");const i=e("../utilities/generic_actions_utilities");t.exports={field_names:{thing_type:{},initial_values:{}},run(e,t,n,i){const o=n.UUID_SEED.UUID();const a=s().db_instance().create(t.thing_type,null,o);r.update_thing(a,t.initial_values).callback((e=>{i(e,a)}))},data_to_refresh:null,return_value(e){var t;return o.get((t=e.get_static_property("thing_type"))!=null?t:"null")},server_method:"new_thing",preprocess_properties(e){const t=e.thing_type;const n="initial_values";i.pre_process_properties({properties:e,prop_name:n,thing_btype_id:t});e=i.apply_default_fields(n,t,e);return e},fall_back_to_server:true,is_mergeable:true};const s=e("../../../lib");const o=e("../../../lang/btypes")},{"../../../lang/btypes":653,"../../../lib":741,"../../data_updates":381,"../utilities/generic_actions_utilities":175}],141:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/generic_actions_utilities");t.exports={field_names:r.extend({to_change:{},slug:{default:""}}),server_method:"set_slug",data_to_refresh(e,t){var n;return i.get_data_to_refresh_for_change_action({to_change:t.to_change,to_change_value_id:(n=e.property("to_change").get_eval_value())==null?void 0:n.id(),changes:[{key:"Slug",value:t.slug}]})},run(e,t,n,r){n.get_server_outcome(e,((e,t)=>{if((t==null?void 0:t.thing)!=null){t.thing.child("Slug").set(t.slug)}r(e,t)}))}}},{"../../../u":823,"../utilities/generic_actions_utilities":175}],142:[function(e,t,n){"use strict";const r=e("../../../lang/btype_ids");t.exports={field_names:{data_type:{},file:{},separator:{default:"comma"}},run(e,t,n,r){n.get_server_outcome(e,((e,t)=>r(e,t)))},data_to_refresh:null,return_value(e){const t=e.get_static_property("data_type");if(t){return r.list_type(t)}else{return"null"}},server_method:"upload_csv_data"}},{"../../../lang/btype_ids":652}],143:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../utilities/element_actions_utilities");const s=e("../../../lang/evaluation/element_eval");t.exports={field_names:{element_id:{},fade_in:{default:500},hold:{default:2e3},fade_out:{default:500},change_message:{},message:{}},run(e,t,n,i){r.run_once(30,(()=>{const e=n.element.find_instance_by_id(t.element_id);let r;if(!t.change_message){r=s.evaluate_property(e,"text")}else{r=undefined}return[r,e]}),((e,n)=>{if(e){i(e)}else{const[e,r]=n;if(e){t.message=e}r==null?void 0:r.message("show_alert",t);i()}}))},data_to_refresh:null,check_for_errors:i.element_type_checker}},{"../../../lang/evaluation/element_eval":690,"../../../u":823,"../utilities/element_actions_utilities":174,"core-js/modules/web.dom-collections.iterator.js":1123}],144:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,t)=>{if(e){i(e)}else{t==null?void 0:t.message("cancel_upload");i()}}))},data_to_refresh:null,check_for_errors:i.element_type_checker}},{"../../../u":823,"../utilities/element_actions_utilities":174}],145:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,t)=>{if(e){i(e)}else{t==null?void 0:t.message("clear_marker_data");i()}}))},data_to_refresh:null,check_for_errors:i.element_type_checker}},{"../../../u":823,"../utilities/element_actions_utilities":174}],146:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{},data_source:{}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i(e)}else{n==null?void 0:n.message("set_group_data",t.data_source);i()}}))},data_to_refresh(e,t,n){return i._get_data_to_refresh_for_group_actions(e,t,n,t.data_source)},check_for_errors:i.element_type_checker}},{"../../../u":823,"../utilities/element_actions_utilities":174}],147:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{},data_source:{}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i(e)}else{n==null?void 0:n.message("set_list_data",t.data_source);i(null,null)}}))},data_to_refresh(e,t,n){return i._get_data_to_refresh_for_repeating_group_actions(e,t,n,t.data_source)},check_for_errors:i.element_type_checker}},{"../../../u":823,"../utilities/element_actions_utilities":174}],148:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{},data_source:{}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i(e)}else{n==null?void 0:n.message("set_marker_data",t.data_source);i()}}))},data_to_refresh:null,check_for_errors:i.element_type_checker}},{"../../../u":823,"../utilities/element_actions_utilities":174}],149:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../logger");const s=e("../utilities/element_actions_utilities");t.exports={field_names:r.extend({animation:{no_states:true,default:"none"},direction:{no_states:true,default:"left"}},s.field_names_for_show_hide_action),run(e,t,n,s){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,t)=>{if(e){i.log(e)}if(t.element.added_to_container()&&t.parent()&&!t.parent()._has_become_visible.is_turned()){s();return}t==null?void 0:t.workflow_hide();s()}))},data_to_refresh:null}},{"../../../logger":744,"../../../u":823,"../utilities/element_actions_utilities":174}],150:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,t)=>{if(e){i(e)}else{t==null?void 0:t.message("clear_list");i()}}))},data_to_refresh(e,t,n){return i._get_data_to_refresh_for_repeating_group_actions(e,t,n)},check_for_errors:i.element_type_checker}},{"../../../u":823,"../utilities/element_actions_utilities":174}],151:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{},page:{}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i(e)}else{n==null?void 0:n.message("go_to_page",t.page);i()}}))},data_to_refresh:i.clear_rg_pagination_frozen_states,check_for_errors(e,t){i.element_type_checker(e,t);return i._check_for_errors_show_previous_next(e,t,this.display)}}},{"../../../u":823,"../utilities/element_actions_utilities":174}],152:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:r.extend({},i.field_names_show_previous_next),run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i(e)}else{n==null?void 0:n.message("show_next",t.wrap_around);i()}}))},data_to_refresh:i.clear_rg_pagination_frozen_states,check_for_errors(e,t){i.element_type_checker(e,t);return i._check_for_errors_show_previous_next(e,t,this.display)}}},{"../../../u":823,"../utilities/element_actions_utilities":174}],153:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:r.extend({},i.field_names_show_previous_next),run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i(e)}else{n==null?void 0:n.message("show_previous",t.wrap_around);i()}}))},data_to_refresh:i.clear_rg_pagination_frozen_states,check_for_errors(e,t){i.element_type_checker(e,t);return i._check_for_errors_show_previous_next(e,t,this.display)}}},{"../../../u":823,"../utilities/element_actions_utilities":174}],154:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../logger");const s=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{},manual_setting:{},center:{},initial_zoom:{default:10}},run(e,t,n,s){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i.log(e)}n==null?void 0:n.message("map_adjust_zoom",t);s()}))},data_to_refresh:null,check_for_errors:s.element_type_checker}},{"../../../logger":744,"../../../u":823,"../utilities/element_actions_utilities":174}],155:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,t)=>{if(e){i(e)}else{t==null?void 0:t.message("reset_group");i()}}))},data_to_refresh(e,t,n){return i._get_data_to_refresh_for_group_actions(e,t,n,null)},check_for_errors:i.element_type_checker}},{"../../../u":823,"../utilities/element_actions_utilities":174}],156:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");t.exports={not_api:true,field_names:{},run(e,t,n,i){r.run_once(30,(()=>{const t=e.event();const i=r.unique(t.find_expressions("GetElement").element_id());const s=n.element.element_id();if(t.find_expressions("ThisElement").length&&!i.includes(s)){i.push(s)}return i.map((e=>n.element.find_instance_by_id(e))).filter((e=>e&&e.get_messages().includes("reset_input")))}),((e,t)=>{if(e){i(e)}else{for(const e of t){e.message("reset_input")}i()}}))},data_to_refresh:null}},{"../../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],157:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{},entry:{},animate:{},offset:{default:0}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i(e)}else{if(n&&t.entry!=null){n.setTimeout((()=>n.message("scroll_to",t)),100)}i()}}))},data_to_refresh:null,check_for_errors(e,t){i.element_type_checker(e,t);const n=s.element(e==null?void 0:e.element_id());if(n&&i.is_fixed_rg(n)){t(this.display(e)+": "+n.get_name()+" has a 'Fixed number of cells' layout and can't be scrolled to.")}return false}};const s=e("../../../lang/appquery")},{"../../../lang/appquery":651,"../../../u":823,"../utilities/element_actions_utilities":174}],158:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{},to_select:{}},run(e,t,n,i){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i(e)}else{n==null?void 0:n.message("set_marker_selection",t.to_select);i()}}))},data_to_refresh:null,check_for_errors:i.element_type_checker}},{"../../../u":823,"../utilities/element_actions_utilities":174}],159:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../lang/evaluation/state_keys");const i=e("../../../u");const s=e("../../../constants/eval");const o=e("../utilities/element_actions_utilities");const a=e("../../../u/shared/decaf");t.exports={field_names:i.extend({value:{optional:true},custom_state:{},custom_states_values:{optional:true}},o.field_names_for_show_hide_action),run(e,t,n,r){i.run_once(30,(()=>{var e,r;const i=n.element.find_instance_by_id(t.element_id);const s={instance:i,custom_states:[],values:[]};if(i==null){return s}s.custom_states.push(t.custom_state);let o=i.element.element_custom_state(t.custom_state).make_static();if(o&&(e=t.value)!=null&&(r=e.make_static)!=null&&r.call(e)){s.values.push(t.value.make_static())}else{s.values.push(t.value)}if(t.custom_states_values!=null){for(const e in t.custom_states_values){var a,l,c;const n=t.custom_states_values[e];s.custom_states.push(n.custom_state);o=i.element.element_custom_state(n.custom_state).make_static();if(o&&(a=n.value)!=null&&(l=(c=a).make_static)!=null&&l.call(c)){s.values.push(n.value.make_static())}else{s.values.push(n.value)}}}return s}),((e,t)=>{if(e){r(e);return}const{instance:n,custom_states:i,values:s}=t;if(!n){r();return}for(let e=0;e<s.length;e++){const t=s[e];n.state(i[e],t!=null?t:null)}r()}))},data_to_refresh(e,t,n){var i;if(!((i=l.element(t.element_id))!=null&&i.exists())){return{}}const o=n.find_instance_by_id(t.element_id);if(o==null){return{}}const c=o.element.get_value_id();const u={};if(t.custom_state){var d,p;const e=o.element.element_custom_state(t.custom_state);let n;if(e.make_static()&&((d=t.value)==null?void 0:d.all)!=null){n=t.value.make_static()}else{n=t.value}u[r.Message({prev:o,message:e.name(),prior_btype_id:c})]=(p=n)!=null?p:s.NULL_VALUE_TO_REGISTER}if(t.custom_states_values){for(const e of a.object_values(t.custom_states_values)){var _,f;const t=o.element.element_custom_state(e.custom_state);let n;if(t.make_static()&&((_=e.value)==null?void 0:_.all)!=null){n=e.value.make_static()}else{n=e.value}u[r.Message({prev:o,message:t.name(),prior_btype_id:c})]=(f=n)!=null?f:s.NULL_VALUE_TO_REGISTER}}return u}};const l=e("../../../lang/appquery")},{"../../../constants/eval":64,"../../../lang/appquery":651,"../../../lang/evaluation/state_keys":699,"../../../u":823,"../../../u/shared/decaf":844,"../utilities/element_actions_utilities":174,"core-js/modules/web.dom-collections.iterator.js":1123}],160:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../logger");const s=e("../utilities/element_actions_utilities");t.exports={field_names:r.extend({},s.field_names_for_show_hide_action),run(e,t,n,s){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,t)=>{if(e){i.log(e)}if(t.element.added_to_container()&&t.parent()&&!t.parent()._has_become_visible.is_turned()){s();return}t==null?void 0:t.workflow_show();s()}))},data_to_refresh:null}},{"../../../logger":744,"../../../u":823,"../utilities/element_actions_utilities":174}],161:[function(e,t,n){"use strict";const r=e("../../../logger");const i=e("../../../u");const s=e("../utilities/element_actions_utilities");t.exports={field_names:i.extend({},s.field_names_for_show_hide_action),run(e,t,n,s){i.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,t)=>{if(e){r.log(e)}if(t){if(t.element.added_to_container()&&t.parent()&&!t.parent()._has_become_visible.is_turned()){s();return}if(t.is_visible()){t.workflow_hide()}else{t.workflow_show()}}s()}))},data_to_refresh:null}},{"../../../logger":744,"../../../u":823,"../utilities/element_actions_utilities":174}],162:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../safe_require");const s=n;i.safe_register("./core/core_actions",s);const o=e("./utilities/core_actions_consts");const a=e("../../lib");const l=e("../../lang/appquery");const c=e("../../lang/plugins");const u=e("../../services/shared/service_type_parser");const d=e("../../services/shared/plugin_getter");s.SignUp=e("./account/SignUp");s.OAuthLogin=e("./account/OAuthLogin");s.LogIn=e("./account/LogIn");s.LogOut=e("./account/LogOut");s.CookieOptIn=e("./account/CookieOptIn");s.CookieOptOut=e("./account/CookieOptOut");s.UpdateCredentials=e("./account/UpdateCredentials");s.ChangeEmailForAnotherUser=e("./account/ChangeEmailForAnotherUser");s.MakeChangeCurrentUser=e("./account/MakeChangeCurrentUser");s.SendPasswordResetEmail=e("./account/SendPasswordResetEmail");s.SendMagicLink=e("./account/SendMagicLink");s.SendConfirmationEmail=e("./account/SendConfirmationEmail");s.ResetPassword=e("./account/ResetPassword");s.CreateUserAccount=e("./account/CreateUserAccount");s.CheckUserPassword=e("./account/CheckUserPassword");s.SetTemporaryPassword=e("./account/SetTemporaryPassword");s.LogOutOtherSessions=e("./account/LogOutOtherSessions");s.Generate2FAQRCode=e("./account/Generate2FAQRCode");s.Validate2FAToken=e("./account/Validate2FAToken");s.Check2FAToken=e("./account/Check2FAToken");s.Disable2FA=e("./account/Disable2FA");s.GenerateOneTimeCodes=e("./account/GenerateOneTimeCodes");s.ChangePage=e("./navigation/ChangePage");s.RefreshPage=e("./navigation/RefreshPage");s.GoPrevious=e("./navigation/GoPrevious");s.OpenURL=e("./navigation/OpenURL");s.ScrollToElement=e("./navigation/ScrollToElement");s.AnimateElement=e("./navigation/AnimateElement");s.SetFocusToElement=e("./navigation/SetFocusToElement");s.NewThing=e("./db/NewThing");s.ChangeThing=e("./db/ChangeThing");s.ChangeListOfThings=e("./db/ChangeListOfThings");s.DeleteThing=e("./db/DeleteThing");s.DeleteListOfThings=e("./db/DeleteListOfThings");s.CopyListOfThings=e("./db/CopyListOfThings");s.SetSlug=e("./db/SetSlug");s.DownloadDataAsCSV=e("./db/DownloadDataAsCSV");s.UploadCSVData=e("./db/UploadCSVData");s.APIReturnData=e("./db/APIReturnData");s.DeleteUploadedFile=e("./db/DeleteUploadedFile");s.TriggerCustomEvent=e("./custom_workflows/TriggerCustomEvent");s.TriggerCustomEventFromReusable=e("./custom_workflows/TriggerCustomEventFromReusable");s.TriggerCustomOnChange=e("./custom_workflows/TriggerCustomOnChange");s.ScheduleCustom=e("./custom_workflows/ScheduleCustom");s.ScheduleAPIEvent=e("./custom_workflows/ScheduleAPIEvent");s.ScheduleAPIEventOnList=e("./custom_workflows/ScheduleAPIEventOnList");s.TerminateWorkflow=e("./custom_workflows/TerminateWorkflow");s.CancelScheduledAPIEvent=e("./custom_workflows/CancelScheduledAPIEvent");s.CancelListScheduledAPIEvent=e("./custom_workflows/CancelListScheduledAPIEvent");s.SetRecurringEvent=e("./custom_workflows/SetRecurringEvent");s.PauseWFClient=e("./custom_workflows/PauseWFClient");s.SendEmail=e("./misc_actions/SendEmail");s.SendICSFileEmail=e("./misc_actions/SendICSFileEmail");s.ShowElement=e("./elements/ShowElement");s.HideElement=e("./elements/HideElement");s.ToggleElement=e("./elements/ToggleElement");s.SetCustomState=e("./elements/SetCustomState");s.ResetInputs=e("./elements/ResetInputs");s.CancelUpload=e("./elements/CancelUpload");s.DisplayGroupData=e("./elements/DisplayGroupData");s.ResetGroup=e("./elements/ResetGroup");s.DisplayListData=e("./elements/DisplayListData");s.ListClear=e("./elements/ListClear");s.ListShowNext=e("./elements/ListShowNext");s.ListShowPrevious=e("./elements/ListShowPrevious");s.ListGoToPage=e("./elements/ListGoToPage");s.ScrollToListEntry=e("./elements/ScrollToListEntry");s.AlertShowMessage=e("./elements/AlertShowMessage");s.DisplayMapMarkerData=e("./elements/DisplayMapMarkerData");s.SetCurrentMapMarker=e("./elements/SetCurrentMapMarker");s.ClearMapMarkers=e("./elements/ClearMapMarkers");s.MapAdjustZoom=e("./elements/MapAdjustZoom");s.get_action_object=function(e){if(s[e]){return s[e]}else{var t;const[n]=u.get_plugin_and_type(e);return(t=d.get_plugin(n))==null?void 0:t.get_action(e)}};function p(e,t){const n=t==null?void 0:t.is_api();const r=s.get_action_object(e);const i=r.not_api;const o=r.api_only;return i&&n||o&&!n&&t!=null}function _(e,t){const n=[];for(const{type:e}of o.custom_actions["Custom Events"]){if(!p(e,t)){n.push({type:e})}}return r.extend(e,{"Custom Events":n})}function f(e){const t=[];for(const n in o.action_element_mapping){const r=o.action_element_mapping[n];if(r.includes(e)){if(o.plugin_specific_core_element_actions.includes(n)){continue}t.push(n)}}return t}function h(e,t){if(!e){return[]}if(e.is_api()){return[]}const n=e.find_elements();const i=f(o.ALL_ELEMENTS);const s=r.unique(n.map((e=>e.type())));if(e.is_custom_definition()){s.push("CustomDefinition")}for(const e of s){i.push(...f(e))}const a=["ShowElement","HideElement","ToggleElement","AnimateElement","ScrollToElement","SetCustomState","SetFocusToElement","ResetInputs","CancelUpload","DisplayGroupData","ResetGroup","DisplayListData","ListShowPrevious","ListShowNext","ListClear","ListGoToPage","ScrollToListEntry","AlertShowMessage","DisplayMapMarkerData","ClearMapMarkers","MapAdjustZoom","SetCurrentMapMarker"];const l=r.sort_array(r.unique(i),a);if(l.length){t["Element Actions"]=l.map((e=>({type:e,element_type:o.action_element_mapping[e][0]})))}}function m(){const e=[];if(l.app().plugin_special()==="meta"){const t=a().load_plugin(a().plugin_prefixes.module+"special_meta");e.push(...t.special_actions_list.map((e=>({type:e}))))}for(const e of l.list_plugins()){var t,n,r;(t=d.get_plugin(e))==null?void 0:(n=(r=t).map_plugin_actions)==null?void 0:n.call(r)}return e}s.get_root_actions=function(e){const t=r.json_deep_copy(o.root_actions);if(e==null||e.get_name()==="reset_pw"){t.Account.push({type:"ResetPassword"})}if(l.get_public_setting("twofa_auth")){t.Account.push(...o._2fa_actions)}if(l.get_public_setting("cookie_opt_in")){t.Account.push({type:"CookieOptIn"});t.Account.push({type:"CookieOptOut"})}const n=m();if(n.length>0){t.Plugins.push(...n)}for(const n in t){const r=t[n];t[n]=r.filter((t=>!p(t.type,e)));const o=n.toLowerCase();const l=c.get_app_plugins_by_tags("action",o);for(const r of l){for(const a of(i=(u=(d=r.get_service()).get_actions)==null?void 0:u.call(d))!=null?i:[]){var i,u,d;const r=s.get_action_object(a);if(r.category===o){if(!p(a,e)){t[n].push({type:a})}}}}if(c.get_all_plugins_by_tags("action",o).length>l.length){t[n].push({title:"Install more "+o+" actions...",fn(){return a().add_plugin.show({types:["action"],categories:[o]})}})}}t.Plugins.sort(((e,t)=>{var n,r,i,o;if(e.type==null||t.type==null){return-1}const a=(n=s.get_action_object(e.type))==null?void 0:(r=n.display())==null?void 0:r.toLowerCase();const l=(i=s.get_action_object(t.type))==null?void 0:(o=i.display())==null?void 0:o.toLowerCase();if(a<l){return-1}else{return 1}}));return t};s.get_all_actions=function(e){const t=e.root();const n=s.get_root_actions(t);h(t,n);_(n,t);if(t!=null&&t.is_api()&&n["Element Actions"]!=null){delete n["Element Actions"]}return n};s.get_full_list_actions=function(){const e=s.get_root_actions();e["Element Actions"]=Object.keys(o.action_element_mapping).map((e=>({type:e})));_(e);return e};s.init_plugin_actions=m},{"../../lang/appquery":651,"../../lang/plugins":726,"../../lib":741,"../../safe_require":777,"../../services/shared/plugin_getter":783,"../../services/shared/service_type_parser":785,"../../u":823,"./account/ChangeEmailForAnotherUser":99,"./account/Check2FAToken":100,"./account/CheckUserPassword":101,"./account/CookieOptIn":102,"./account/CookieOptOut":103,"./account/CreateUserAccount":104,"./account/Disable2FA":105,"./account/Generate2FAQRCode":106,"./account/GenerateOneTimeCodes":107,"./account/LogIn":108,"./account/LogOut":109,"./account/LogOutOtherSessions":110,"./account/MakeChangeCurrentUser":111,"./account/OAuthLogin":112,"./account/ResetPassword":113,"./account/SendConfirmationEmail":114,"./account/SendMagicLink":115,"./account/SendPasswordResetEmail":116,"./account/SetTemporaryPassword":117,"./account/SignUp":118,"./account/UpdateCredentials":119,"./account/Validate2FAToken":120,"./custom_workflows/CancelListScheduledAPIEvent":121,"./custom_workflows/CancelScheduledAPIEvent":122,"./custom_workflows/PauseWFClient":123,"./custom_workflows/ScheduleAPIEvent":124,"./custom_workflows/ScheduleAPIEventOnList":125,"./custom_workflows/ScheduleCustom":126,"./custom_workflows/SetRecurringEvent":127,"./custom_workflows/TerminateWorkflow":128,"./custom_workflows/TriggerCustomEvent":129,"./custom_workflows/TriggerCustomEventFromReusable":130,"./custom_workflows/TriggerCustomOnChange":131,"./db/APIReturnData":132,"./db/ChangeListOfThings":133,"./db/ChangeThing":134,"./db/CopyListOfThings":135,"./db/DeleteListOfThings":136,"./db/DeleteThing":137,"./db/DeleteUploadedFile":138,"./db/DownloadDataAsCSV":139,"./db/NewThing":140,"./db/SetSlug":141,"./db/UploadCSVData":142,"./elements/AlertShowMessage":143,"./elements/CancelUpload":144,"./elements/ClearMapMarkers":145,"./elements/DisplayGroupData":146,"./elements/DisplayListData":147,"./elements/DisplayMapMarkerData":148,"./elements/HideElement":149,"./elements/ListClear":150,"./elements/ListGoToPage":151,"./elements/ListShowNext":152,"./elements/ListShowPrevious":153,"./elements/MapAdjustZoom":154,"./elements/ResetGroup":155,"./elements/ResetInputs":156,"./elements/ScrollToListEntry":157,"./elements/SetCurrentMapMarker":158,"./elements/SetCustomState":159,"./elements/ShowElement":160,"./elements/ToggleElement":161,"./misc_actions/SendEmail":163,"./misc_actions/SendICSFileEmail":164,"./navigation/AnimateElement":165,"./navigation/ChangePage":166,"./navigation/GoPrevious":167,"./navigation/OpenURL":168,"./navigation/RefreshPage":169,"./navigation/ScrollToElement":170,"./navigation/SetFocusToElement":171,"./utilities/core_actions_consts":173,"core-js/modules/web.dom-collections.iterator.js":1123}],163:[function(e,t,n){"use strict";t.exports={field_names:{to:{},different_reply_to:{},replyTo:{},sender_name:{},cc:{},bcc:{},subject:{},body:{},ignore_template:{},unsubscribe_group_id:{},list_of_attachments:{}},server_method:"send_email",data_to_refresh:null,run(e,t,n,r){n.get_server_outcome(e,r)},check_use_visible:true}},{}],164:[function(e,t,n){"use strict";t.exports={field_names:{to:{},sender_name:{},start:{},end:{},specify_length:{},event_length:{},summary:{},event_description:{},location:{},change_body:{},SEQUENCE:{},UID:{},METHOD:{},ORGANIZER:{},STATUS:{},body:{default:"Open the attached ICS to put the appointment in your calendar."},ignore_template:{}},server_method:"send_ical_by_email",data_to_refresh:null,check_use_visible:true}},{}],165:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../logger");const s=e("../utilities/generic_actions_utilities");t.exports={field_names:{element_id:{},animation:{default:"callout.bounce"},customize_duration:{},duration:{}},run(e,t,n,o){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i.log(e)}if(n&&t.animation){n.with_canvas((e=>{let i;if(t.customize_duration){var o;i=(o=t.duration)!=null?o:s.get_velocity_animation_duration(t.animation)}else{i=s.get_velocity_animation_duration(t.animation)}const a={duration:i};if(t.animation.indexOf("transition.")===0){if(t.animation.indexOf("Out")!==-1){n.workflow_hide(t,a,true)}else if(t.animation.indexOf("In")!==-1){n.workflow_show(t,a,true)}}else{n.setTimeout((()=>{var n;if(((n=document)==null?void 0:n.hidden)===false){r.velocity(e,t.animation,a)}}),20)}}))}o()}))},not_api:true,data_to_refresh:null}},{"../../../logger":744,"../../../u":823,"../utilities/generic_actions_utilities":175}],166:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../shared/build_page_url_for_action");const s=e("../../url_data");const o=e("../utilities/generic_actions_utilities");const a=e("../../../logger");const l=e("../../../lang/appquery");t.exports={field_names:{element_id:{},data_to_send:{},dynamic_page_name:{},open_in_new_tab:{},add_parameters:{},url_parameters:{},keep_current_page_params:{},replace_history:{}},can_redirect(e){if(e.element_id()===null){return false}if(e.property("data_to_send").exists()){return false}if(e.get_static_property("add_parameters")){var t,n,r;const i=(t=(n=e.property("url_parameters"))==null?void 0:(r=n.entries)==null?void 0:r.call(n))!=null?t:[];return i.every((e=>e.property("value").is_static()))}return true},server_side_redirect(e){let t;switch(e.element_id()){case"Current page":t=l.get_page_by_name(c().location.get_page());break;case"Dynamic page":t=l.get_page_by_name(e.dynamic_page_name());break;default:t=o.get_page(e.element_id())}if(t){let s=t.name();if(e.get_static_property("add_parameters")){var n,r,i;s+="?";const t=(n=(r=e.property("url_parameters"))==null?void 0:(i=r.entries)==null?void 0:i.call(r))!=null?n:[];for(let e=0;e<t.length;e++){const n=t[e];if(e>0){s+="&"}s+=n.get_static_property("key")+"="+n.get_static_property("value")}}return s}},check_for_errors(e,t,n){var r,i,s,o;if(!n){t(undefined,undefined,e.id());return true}if((r=e.root())!=null&&r.get_static_property("native_app")){t(this.display(e)+" - Change page actions should not be used in a native app page")}else if(e.next()&&((i=e.property)==null?void 0:(s=i.call(e,"condition"))==null?void 0:(o=s.json)==null?void 0:o.raw())==null){t(this.display(e)+" must be the last action in the workflow")}u.check_parameters(e,t);return false},run(e,t,n,u){function p(e,t,n,u){let p;switch(t.element_id){case"Current page":p=l.get_page_by_name(c().location.get_page());break;case"Dynamic page":p=l.get_page_by_name(t.dynamic_page_name);break;default:p=o.get_page(t.element_id)}if(!p){console.log("not changing page because page not found");u();return}if(r.on_phonegap()){window.alert("Native apps should be built in a single page, you can't use a change action here");return}let _=p.name();r.run_once(30,(()=>{let e;switch(t.element_id){case"Current page":e=c().pageparam.get();break;case"Dynamic page":e="";break;default:e=t.data_to_send}return s.get_data_to_send(e,p.get_static_property("readable_field"))}),((r,s)=>{if(r){a.log(r)}const o=i.build_page_url_for_action(t.data_to_send,t.add_parameters,t.url_parameters,t.keep_current_page_params,_,p,s);const l=o.data_fr_link;if(o.pg_thing){_+="/"+o.pg_thing}const f=l.lang;const h=d.app_language();const m=f&&h!==f.toLowerCase();if(t.open_in_new_tab){window.open(c().location.get_page_url(_,l),"_blank");window.focus();u();return}if(p.name()===c().location.get_page()&&!m){const e=c().location.get_page_url(_,l);if(e!==c().location.my_location()){c().location.set_url_without_refresh({url:e,push_state:!t.replace_history});c().pageparam.invalidate()}if(n!=null){n.__investigate_post_changed_page_url_reads=true}u();return}const g=c().workflow.make_resume_key(n,e);if(g){l.resume=g}c().workflow.wait_for_safe(n,(()=>{if(!g){u("aborted")}n.__investigate_post_changed_page_url_reads=true;if(m){document.location.href=undefined}c().location.change_page(_,l)}))}))}if(c().location.get_query().on_login!=null){r.run_once(15,(()=>c().user.has_changed()),((r,i)=>{if(r){a.log(r)}if(!i){p(e,t,n,u)}}))}else{p(e,t,n,u)}},not_api:true,data_to_refresh:null};const c=e("../../../lib");const u=e("../../core_elements/shared/links");const d=e("../../../languages")},{"../../../lang/appquery":651,"../../../languages":739,"../../../lib":741,"../../../logger":744,"../../../shared/build_page_url_for_action":789,"../../../u":823,"../../core_elements/shared/links":365,"../../url_data":416,"../utilities/generic_actions_utilities":175,"core-js/modules/web.dom-collections.iterator.js":1123}],167:[function(e,t,n){"use strict";t.exports={field_names:{},run(e,t,n,i){r().workflow.wait_for_safe(n,(()=>{window.history.back();i()}))},not_api:true,data_to_refresh:null};const r=e("../../../lib")},{"../../../lib":741}],168:[function(e,t,n){"use strict";const r=e("../../../u");t.exports={field_names:{url:{},open_in_new_tab:{}},run(e,t,n,o){let a=t.url;if(a&&!a.includes("//")&&!s.href_attributes.includes(a.split(":")[0])){a="//"+a}if(r.on_phonegap()){window.open(a,"_blank","location=yes,enableViewportScale=yes");o();return}if(t.open_in_new_tab){window.open(a,"_blank");window.focus();o()}else{i().workflow.wait_for_safe(n,(()=>{o("aborted");document.location.href=a}))}},not_api:true,check_for_errors(e,t){var n,r,i;if(e.next()&&!e.get_static_property("open_in_new_tab")&&((n=e.property)==null?void 0:(r=n.call(e,"condition"))==null?void 0:(i=r.json)==null?void 0:i.raw())==null){t(this.display(e)+" must be the last action in the workflow")}return false},data_to_refresh:null};const i=e("../../../lib");const s=e("../../core_elements/shared/links")},{"../../../lib":741,"../../../u":823,"../../core_elements/shared/links":365}],169:[function(e,t,n){"use strict";const r=e("../utilities/generic_actions_utilities");t.exports={field_names:{},run(e,t,n,s){i().workflow.wait_for_safe(n,(()=>{document.location.href=r.get_resume_url(n,e)}))},not_api:true,data_to_refresh:null};const i=e("../../../lib")},{"../../../lib":741,"../utilities/generic_actions_utilities":175}],170:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../logger");t.exports={field_names:{element_id:{},offset:{optional:true,default:0}},run(e,t,n,s){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),((e,n)=>{if(e){i.log(e)}if(n){n.with_canvas((e=>{var n;r.velocity(e,"scroll",{duration:300,offset:(n=t.offset)!=null?n:0})}))}s()}))},not_api:true,data_to_refresh:null}},{"../../../logger":744,"../../../u":823}],171:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../logger");const s=e("../utilities/element_actions_utilities");t.exports={field_names:{element_id:{}},run(e,t,n,s){r.run_once(30,(()=>n.element.find_instance_by_id(t.element_id)),(function(e,t){if(e){i.log(e)}if(t){t.wait_for_visible((function(){r.wait_for_updates((function(){const e=t.get_canvas();if(!r.isScrolledIntoView(e).status){if(e.add(e.parents()).filter((function(){return $(this).css("position")==="fixed"})).length===0){r.velocity(e,"scroll",{duration:300,offset:-100})}}t.message("set_focus")}))}))}s()}))},not_api:true,data_to_refresh:null,check_for_errors:s.element_type_checker}},{"../../../logger":744,"../../../u":823,"../utilities/element_actions_utilities":174}],172:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../lang/evaluation/state_keys");const s=n;const o=e("../../../client_config");s.get_iframe_for_cookie_phonegap=function(){if(r.on_phonegap()){const e=l.appname();let t;if(o.apps_domain){t="https://"+e+"."+o.apps_domain}else{t=a().location.get_base_for_meta()+"/site/"+e}t+="/version-"+l.app_version()+"/user/hi";const n=$(`<iframe src="${t}"></iframe>`);n.load((()=>{n.remove()}));$("body").append(n)}};s.refresh_current_user=function(){const e={};e[i.CurrentUser()]=null;const t=a().current_user();e[i.Message({prev:t,message:"email",prior_btype_id:"user"})]=null;for(const n of l.get_oauth_providers()){e[i.Message({prev:t,message:n,prior_btype_id:"user"})]=null}return e};s.get_remember_email_key=()=>"_bubble_saved_email_"+a().appname()+"_"+a().app_version();s.check_errors_no_scheduled_context=function(e,t){const n=e.event();if(!n.is_api()){return false}if(n.type()==="CustomEvent"){return false}if(n.type()==="APIEvent"){var r;const e=(r=n.get_static_property("expose"))!=null?r:true;if(e){return false}}t(this.display(e)+" - This action cannot be run inside scheduled tasks");return false};const a=e("../../../lib");const l=e("../../../lang/appquery")},{"../../../client_config":41,"../../../lang/appquery":651,"../../../lang/evaluation/state_keys":699,"../../../lib":741,"../../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],173:[function(e,t,n){"use strict";const r=n;const i=e("../../../safe_require");i.safe_register("./core/core_actions/utilities/core_actions_consts",r);r.csv_separators={comma:",",semicolon:";",tab:"tab",pipe:"|"};r.ALL_ELEMENTS="All elements";r.action_element_mapping={ScrollToElement:[r.ALL_ELEMENTS],AnimateElement:[r.ALL_ELEMENTS],ShowElement:[r.ALL_ELEMENTS],HideElement:[r.ALL_ELEMENTS],ToggleElement:[r.ALL_ELEMENTS],SetCustomState:[r.ALL_ELEMENTS],SetFocusToElement:["Input","MultiLineInput","RichTextInput","Checkbox","Dropdown","AutocompleteDropdown","PictureInput","FileInput","DateInput","SliderInput"],ResetInputs:["Input","MultiLineInput","Checkbox","Dropdown","AutocompleteDropdown","SliderInput","DateInput","PictureInput","FileInput"],CancelUpload:["FileInput"],DisplayListData:["RepeatingGroup"],ListShowPrevious:["RepeatingGroup"],ListShowNext:["RepeatingGroup"],ListClear:["RepeatingGroup"],ScrollToListEntry:["RepeatingGroup"],ListGoToPage:["RepeatingGroup"],ResetGroup:["Group","FloatingGroup","Popup","CustomElement","CustomDefinition","GroupWithFocus","GroupFocus"],DisplayGroupData:["Group","FloatingGroup","Popup","CustomElement","CustomDefinition","GroupWithFocus","GroupFocus"],AlertShowMessage:["Alert"],DisplayMapMarkerData:["GoogleMap"],ClearMapMarkers:["GoogleMap"],MapAdjustZoom:["GoogleMap"],SetCurrentMapMarker:["GoogleMap"]};r.plugin_specific_core_element_actions=["interactions-RepositionElement"];r.root_actions={Account:[{type:"SignUp"},{type:"LogIn"},{type:"OAuthLogin"},{type:"LogOut"},{type:"UpdateCredentials"},{type:"MakeChangeCurrentUser"},{type:"SendConfirmationEmail"},{type:"SendPasswordResetEmail"},{type:"SendMagicLink"},{type:"CreateUserAccount"},{type:"CheckUserPassword"},{type:"SetTemporaryPassword"},{type:"ChangeEmailForAnotherUser"},{type:"LogOutOtherSessions"}],Navigation:[{type:"ChangePage"},{type:"RefreshPage"},{type:"GoPrevious"},{type:"OpenURL"},{type:"PauseWFClient"},{type:"TerminateWorkflow"}],"Data (Things)":[{type:"NewThing"},{type:"ChangeThing"},{type:"ChangeListOfThings"},{type:"DeleteThing"},{type:"DeleteListOfThings"},{type:"CopyListOfThings"},{type:"SetSlug"},{type:"DownloadDataAsCSV"},{type:"UploadCSVData"},{type:"APIReturnData"},{type:"DeleteUploadedFile"}],Email:[{type:"SendEmail"},{type:"SendICSFileEmail"}],Payment:[],Analytics:[],"Element Actions":[],Plugins:[]};r.custom_actions={"Custom Events":[{type:"TriggerCustomEvent"},{type:"ScheduleCustom"},{type:"TriggerCustomEventFromReusable"},{type:"TriggerCustomOnChange"},{type:"ScheduleAPIEvent"},{type:"ScheduleAPIEventOnList"},{type:"SetRecurringEvent"},{type:"CancelScheduledAPIEvent"},{type:"CancelListScheduledAPIEvent"}]};r._2fa_actions=[{type:"Generate2FAQRCode"},{type:"Validate2FAToken"},{type:"Check2FAToken"},{type:"Disable2FA"},{type:"GenerateOneTimeCodes"}];r.basic_actions=r.root_actions},{"../../../safe_require":777}],174:[function(e,t,n){"use strict";const r=n;const i=e("../../../lang/evaluation/state_keys");const s=e("../../../db/hydrate");const o=e("../../../constants/eval");const a=e("./core_actions_consts");const l=e("../../core_datasources/utilities/core_ds_element_utilities");r.field_names_for_show_hide_action={element_id:{}};r._get_data_to_refresh_for_group_actions=function(e,t,n,r){var a,u;if(!((a=c.element(t.element_id))!=null&&a.exists())){return{}}const d=n.find_instance_by_id(t.element_id);if(!d){return{}}const p=s.dehydrate_tree(d);const _={};_[i.Message({prev:d,message:"get_group_data",prior_btype_id:d.element.get_value_id()})]=r;_[o.ESTATE_PREFIX+p]={group_data:r};if((d==null?void 0:d.element.id())===((u=l.get_element_parent(e))==null?void 0:u.id())){_[i.ElementParent()]=r}return _};r.field_names_show_previous_next={element_id:{},wrap_around:{default:false}};r.is_fixed_rg=function(e){var t;if(((t=e.root())==null?void 0:t.get_responsive_version())>0){return e.get_static_property("fixed_rows")&&e.get_static_property("fixed_columns")}else{return e.get_static_property("layout_style")==="limit_items"}};r._get_data_to_refresh_for_repeating_group_actions=function(e,t,n,r){const a=n.find_instance_by_id(t.element_id);const l=s.dehydrate_tree(a);const c={};c[i.Message({prev:a,message:"get_list_data",prior_btype_id:a.element.get_value_id()})]=r;c[o.ESTATE_PREFIX+l]={list_data:r};return c};r.clear_rg_pagination_frozen_states=function(e,t,n){var r;if(!((r=c.element(t.element_id))!=null&&r.exists())){return{}}const s=n.find_instance_by_id(t.element_id);if(!s){return{}}const o={};const a=s.element.get_value_id();o[i.Message({prev:s,message:"is_last_page",prior_btype_id:a})]=null;o[i.Message({prev:s,message:"is_first_page",prior_btype_id:a})]=null;o[i.Message({prev:s,message:"page_number",prior_btype_id:a})]=null;return o};r._check_for_errors_show_previous_next=function(e,t,n){const i=c.element(e==null?void 0:e.element_id());if(i&&!r.is_fixed_rg(i)){t(n(e)+": "+i.get_name()+" is scrollable, you cannot go to a different series")}return false};r.element_type_checker=function(e,t){const n=c.element(e==null?void 0:e.element_id());if(n==null){return false}const r=e.type();const i=a.action_element_mapping[r];if(!i.includes(n.type())){t(`${e.display(true)}: Element ${n.display()} is not a possible option`)}return false};const c=e("../../../lang/appquery")},{"../../../constants/eval":64,"../../../db/hydrate":429,"../../../lang/appquery":651,"../../../lang/evaluation/state_keys":699,"../../core_datasources/utilities/core_ds_element_utilities":234,"./core_actions_consts":173}],175:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../lang/evaluation/state_keys");const s=e("../../../lang/btypes");const o=n;const a=e("../../../safe_require");a.safe_register("./core/core_actions/utilities/generic_actions_utilities",o);const l=e("../../../strings/plugin");const c=e("../../../u/shared/decaf");o.make_pre_process_properties=e=>{let{prop_name:t,thing_btype_id:n}=e;return function(e){var r;const i=s.get(n,{miss_okay:true});const o=i.custom_type();(r=e[t])!=null?r:e[t]={};for(const n of Object.values(e[t])){var a,l,c;if(n===undefined){continue}let e;if(o){const t=o.field(n.key).value();e=s.get(t)}if(n.action!=null&&!((a=e)!=null&&(l=(c=a).inner)!=null&&l.call(c))){n.action=null}if(["add_list","remove_list","set_list"].includes(n==null?void 0:n.action)){var u,d,p,_;n.value=((u=(d=n.value)==null?void 0:(p=(_=d).all)==null?void 0:p.call(_))!=null?u:[]).map((e=>{var t,n;return(t=e==null?void 0:(n=e.all)==null?void 0:n.call(e))!=null?t:e}))}}return e}};o.pre_process_properties=e=>{let{properties:t,prop_name:n,thing_btype_id:r}=e;return o.make_pre_process_properties({prop_name:n,thing_btype_id:r})(t)};o.apply_default_fields=(e,t,n)=>{var r,i;if(typeof t!=="string"){return n}let o;try{o=s.get(t).custom_type()}catch(e){if(String(e==null?void 0:e.message).indexOf(l.MISSING_PLUGIN)===-1){throw e}return n}(r=n[e])!=null?r:n[e]={};const a=Object.values(n[e]).filter((e=>e==null?void 0:e.key)).map((e=>e==null?void 0:e.key));let c=Object.values(n[e]).length;const u=(i=o.default()||o.get_default_fields())!=null?i:{};for(const t of u){if(!t.deleted&&!a.includes(t.name)&&t.default_val!=null){n[e][c]={key:t.name,value:t.default_val};c++}}return n};o._apply_content_format_to_input=function(e,t){const n=d.element(e);if((n==null?void 0:n.type())==="Input"&&n.get_static_property("content_format")!==t){n.set_property("content_format",t);n.commit()}};o.change_field_names=function(e){return{changes:{prop_type:e}}};o.get_page=function(e){var t;let n=d.page(e);(t=n)!=null?t:n=d.get_page_by_name(e);return n};o.get_velocity_animation_duration=function(e){var t,n,i,s,o;const a=(t=$.Velocity)==null?void 0:t.RegisterEffect.packagedEffects;const l=r.custom_transitions;return(n=(i=(s=a[e])==null?void 0:s.defaultDuration)!=null?i:(o=l[e])==null?void 0:o.defaultDuration)!=null?n:300};o.get_data_to_refresh_for_change_action=function(e){let{to_change:t,to_change_value_id:n,changes:r}=e;if(t==null&&u().bubble_version()>=9){return{}}const s={};for(const e of c.object_values(r)){if(e.key){const r=i.Message({prev:t,message:e.key,prior_btype_id:n});if(!e.action){s[r]=e.value}else{s[r]=null}}}s[i.Message({prev:t,message:"Modified Date",prior_btype_id:n})]=null;return s};o.use_injected_for_change_actions=function(e,t){if(t.is_equal_to(e.property("changes"))){return[true,true]}else{const n=t.parent_expression();if(n==null){return[false,true]}return o.use_injected_for_change_actions(e,n)}};o.prepare_raw_thing_to_copy=function(e){if(!e){return null}delete e["Created By"];delete e["Created Date"];delete e["Modified Date"];delete e.Slug;return e};o.sub_node_key_to_value=function(e,t){var n;if(!e){return null}if(!t){return null}return(n=e.get_message(t))==null?void 0:n.ret_btype()};o.APIEvent_param_prefix="_wf_param_";o.get_run_mode_api_event_name=function(e){if(e){if(!u().is_edit_mode()){const t=u().derived("APIWFByName",true).content();for(const n in t){const r=t[n];if(r===e){return n}}}}return undefined};o.get_resume_url=function(e,t,n){const r=p.parse(document.location.href,true);delete r.search;const i=u().workflow.make_resume_key(e,t,n);if(i){r.query.resume=i}return p.format(r)};const u=e("../../../lib");const d=e("../../../lang/appquery");const p=e("url")},{"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/evaluation/state_keys":699,"../../../lib":741,"../../../safe_require":777,"../../../strings/plugin":810,"../../../u":823,"../../../u/shared/decaf":844,"core-js/modules/web.dom-collections.iterator.js":1123,url:981}],176:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../u");const i=n;const s=e("./core_actions");const o=e("./core_actions/utilities/core_actions_consts");const a=e("./core_actions/utilities/generic_actions_utilities");const{COMPOSER_INPUT_TYPES:l}=e("../constants/composer");const{API_RETURN_TYPES_IDENTIFIERS:c}=e("../constants/apiworkflow");const u=e("./../services");const d=e("../services/client/editor_utils");const p=e("../u/shared/decaf");const{escape_app_json_key:_}=e("../lang/app_json/json_utils");const f=e("../lang/btype_ids");const{displayableInListBtypes:h,allowableBtypes:m,customTypes:g,customTypeAccelerator:v}=e("../lang/btypes_dropdowns");const b=e("./../editor/css");const y=e("./../editor/thumbnail");r.edit_mode_only();i.add_fields_to_actions=function(){p.object_entries(s).filter((e=>{let[t,n]=e;return n.field_names&&i[t]})).forEach((e=>{let[t,n]=e;for(const e of["fields","display","next_recommended_actions"]){var r;(r=n[e])!=null?r:n[e]=i[t][e]}}))};function w(e){return[{name:"changes",editor:"ObjectList",show_expand_all:true,condition:t=>W.saveable(e),sub_properties:S((()=>e)),button_caption:"Change another field"}]}function x(){return[{name:"remember_email",caption:"Remember the email",editor:"Basic",value:"boolean"}]}s.get_element_id_field=function(e,t,n){var r;let i=o.action_element_mapping[e.type()];if(((r=i)==null?void 0:r[0])==="All elements"){i=undefined}const s=B().sets.get_set("PageElementsByType")(e,i,t);const a=n?B().sets.get_set("Filtered")(s,(e=>n(e))):undefined;return[{name:"element_id",caption:"Element",editor:"Dropdown",set:a!=null?a:s}]};function j(e,t,n,r){var i,s;(i=t)!=null?i:t="password";(s=n)!=null?s:n="Password";return[{name:t,caption:n,editor:"Basic",value:"text",condition:r,value_setter:{property_modifier(){A(e,t,"password")},no_need_to_show_message:()=>true}}]}i.SignUp={display:()=>"Sign the user up",next_recommended_actions:()=>[{type:"SendEmail"}],fields(e){return[{name:"email",editor:"Basic",value:"text",caption:"Email",value_setter:{property_modifier(){A(e,"email","email")},no_need_to_show_message:()=>true}}].concat(j(e)).concat([{name:"require_confirm",caption:"Require a password confirmation",editor:"Checkbox"}]).concat(j(e,"password2","Confirmation","require_confirm")).concat([{name:"send_confirm_email",caption:"Send an email to confirm the email",editor:"Checkbox"},{name:"page",caption:"Confirmation page",editor:"Dropdown",set:B().sets.get_set("Pages")(),condition:"send_confirm_email"}].concat(x()).concat(w(W.get("user"))))}};i.OAuthLogin={display(e){var t;const n=u.get_oauth_authenticator(e==null?void 0:e.get_static_property("oauth_provider"));return"Signup/login with "+((t=n==null?void 0:n.display())!=null?t:"a social network")},fields(e){var t,n;const r=e.get_static_property("oauth_provider");const i=u.get_oauth_authenticator(r);const s=i==null?void 0:i.are_keys_missing();return[{name:"oauth_provider",caption:"OAuth provider",editor:"Dropdown",set:B().sets.get_set("OauthProviders")()},...(t=i==null?void 0:(n=i.get_additional_fields)==null?void 0:n.call(i))!=null?t:[]].concat(d.get_enter_your_api_key_button(r,s))}};i.LogIn={display:()=>"Log the user in",fields(e){return[{name:"email",caption:"Email",editor:"Basic",value:"text",value_setter:{property_modifier(){A(e,"email","email")},no_need_to_show_message:()=>true}}].concat(j(e)).concat([{name:"stay_logged_in",caption:"Stay logged in",editor:"Basic",value:"boolean"}].concat(x()))}};i.LogOut={display:()=>"Log the user out",fields:()=>[]};i.CookieOptIn={display:()=>"Opt-in to cookies",fields:()=>[]};i.CookieOptOut={display:()=>"Opt-out from cookies",fields:()=>[]};function A(e,t,n){const r=e.property(t);if(r.type()==="GetElement"){const e=r.element_id();a._apply_content_format_to_input(e,n)}}i.UpdateCredentials={display:()=>"Update the user's credentials",fields(e){return j(e,"old_password","Old password").concat([{name:"change_email",caption:"Change email",editor:"Checkbox"},{name:"email",caption:"Email",editor:"Basic",value:"text",condition:"change_email",value_setter:{property_modifier(){A(e,"email","email")},no_need_to_show_message:()=>true}},{name:"change_password",caption:"Change password",editor:"Checkbox"}]).concat(j(e,"password","New password","change_password")).concat([{name:"require_confirm",caption:"Require password confirmation",editor:"Checkbox",condition:"change_password"}]).concat(j(e,"password2","Confirmation",["change_password","require_confirm"])).concat([{name:"do_not_show_success_alert",caption:"Do not show success message",editor:"Checkbox"},{name:"send_confirm_email",caption:"Send an email to confirm the email",editor:"Checkbox",condition:"change_email"},{name:"page",caption:"Confirmation page",editor:"Dropdown",set:B().sets.get_set("Pages")(),condition:()=>e.get_static_property("change_email")&&e.get_static_property("send_confirm_email")}])}};i.ChangeEmailForAnotherUser={display:()=>"Change the email for another user",fields(e){return[{name:"user",caption:"User",editor:"Basic",value:"user"},{name:"new_email",caption:"New email",editor:"Basic",value:"text",value_setter:{property_modifier(){A(e,"email","email")},no_need_to_show_message:()=>true}}]}};i.MakeChangeCurrentUser={display:()=>"Make changes to current user",fields:()=>w(W.get("user"))};i.SendPasswordResetEmail={display:()=>"Send password reset email",fields(){return[{name:"to",caption:"Email to reset",editor:"Basic",value:"text"},{name:"subject",caption:"Subject",editor:"ShortText"},{name:"body",caption:"Body",editor:"LongText"},{name:"just_make_token",caption:"Just make token, don't send email",editor:"Checkbox"}]}};i.SendMagicLink={display:()=>"Send magic login link",fields(e){const t=a.get_page(e.get_static_property("success_page"));const n=t==null?void 0:t.get_static_property("page_item_type");const r=a.get_page(e.get_static_property("failure_page"));const i=r==null?void 0:r.get_static_property("page_item_type");return[{name:"email",editor:"Basic",value:"text",caption:"Email"},{name:"subject",caption:"Subject",editor:"ShortText"},{name:"body",caption:"Body",editor:"LongText"},{name:"link_text",caption:"Link Text",editor:"ShortText"},{name:"valid_link_time_frame",caption:"Link Expiration (0-24 hrs)",editor:"StaticNumber",on_blur_only:true},{name:"success_page",caption:"Navigate on login",editor:"Dropdown",set:B().sets.get_set("Pages")()},{name:"success_customize",caption:"Send data on login",editor:"Checkbox"},{name:"data_to_send_success",caption:"Data to send",editor:"Basic",condition:"success_customize",value:n!=null?n:"text",optional:true,value_setter:{property_modifier(e){U.set_group_type_list_elements(t,e,"page_item_type")},generate_message:e=>U.get_generate_message_page(t,e)}},{name:"keep_current_page_params_success",caption:"Send current page parameters",editor:"Checkbox",condition:"success_customize"},{name:"add_parameters_success",condition:"success_customize",caption:"Send more parameters to the page",editor:"Checkbox"},{name:"url_parameters_success",editor:"ObjectList",condition:e=>e.get_static_property("success_customize")&&e.get_static_property("add_parameters_success"),button_caption:"Add another parameter",has_rows:true,sub_properties:()=>[{name:"key",caption:"Key",editor:"StaticText",include_in_redesign:false},{name:"value",caption:"=",condition:"key",editor:"ShortText",include_in_redesign:false},{name:"key",caption:"Key",editor:"StaticText",include_in_redesign:true,pretty:{row_id:1,class_name:"grouped-properties-span url-parameters-key"}},{name:"value",caption:"=",condition:"key",editor:"ShortText",include_in_redesign:true,pretty:{row_id:1,class_name:"grouped-properties-span url-parameters-value"}}]},{name:"failure_page",caption:"Navigate on failure",editor:"Dropdown",set:B().sets.get_set("Pages")()},{name:"failure_customize",caption:"Send data on failure",editor:"Checkbox"},{name:"data_to_send_failure",caption:"Data to send",editor:"Basic",condition:"failure_customize",value:i!=null?i:"text",optional:true,value_setter:{property_modifier(e){U.set_group_type_list_elements(r,e,"page_item_type")},generate_message:e=>U.get_generate_message_page(r,e)}},{name:"keep_current_page_params_failure",caption:"Send current page parameters",editor:"Checkbox",condition:"failure_customize"},{name:"add_parameters_failure",condition:"failure_customize",caption:"Send more parameters to the page",editor:"Checkbox"},{name:"url_parameters_failure",editor:"ObjectList",condition:e=>e.get_static_property("failure_customize")&&e.get_static_property("add_parameters_failure"),button_caption:"Add another parameter",has_rows:true,sub_properties:()=>[{name:"key",caption:"Key",editor:"StaticText",include_in_redesign:false},{name:"value",caption:"=",condition:"key",editor:"ShortText",include_in_redesign:false},{name:"key",caption:"Key",editor:"StaticText",include_in_redesign:true,pretty:{row_id:1,class_name:"grouped-properties-span url-parameters-key"}},{name:"value",caption:"=",condition:"key",editor:"ShortText",include_in_redesign:true,pretty:{row_id:1,class_name:"grouped-properties-span url-parameters-value"}}]},{name:"just_make_link",caption:"Just create link, dont send email",editor:"Checkbox"}]}};i.SendConfirmationEmail={display:()=>"Send confirmation email",fields(){return[{name:"page",caption:"Confirmation page",editor:"Dropdown",set:B().sets.get_set("Pages")()},{name:"just_make_token",caption:"Just make token, don't send email",editor:"Checkbox"}]}};i.ResetPassword={display:()=>"Reset password",fields(){return[{name:"new_password",caption:"Password",editor:"ShortText"},{name:"new_password_again",caption:"Confirmation",editor:"ShortText"}]}};i.CreateUserAccount={display:()=>"Create an account for someone else",fields(e){const t=[{name:"email",editor:"Basic",value:"text",caption:"Email",value_setter:{property_modifier(){A(e,"email","email")},no_need_to_show_message:()=>true}}];if(!e.property("password").is_empty()){t.push(...j(e))}t.push(...[{name:"return_user_if_already_exists",caption:"Return the user if the account already exists",editor:"Checkbox"}].concat(w(this.return_value())));return t}};i.CheckUserPassword={display:()=>"Check password for the current user",fields(e){return[{name:"password",editor:"ShortText",caption:"Password to check"}]}};i.SetTemporaryPassword={display:()=>"Assign a temp password to a user",fields(e){return[{name:"user",editor:"Basic",value:"user",caption:"User"}]}};i.LogOutOtherSessions={display:()=>"Log out other user's sessions",fields:()=>[]};i.Generate2FAQRCode={display:()=>"Generate a 2FA QR code",fields:e=>j(e,"password","Password")};function M(){return[{name:"token",editor:"Basic",value:"text",caption:"Temporary token"}]}i.Validate2FAToken={display:()=>"Validate token and activate 2FA",fields:()=>M()};i.Check2FAToken={display:()=>"Check 2FA token",fields(){return M().concat([{name:"valid_30_days",editor:"Basic",value:"boolean",caption:"Remember 30 days"}])}};i.Disable2FA={display:()=>"Disable 2FA for the current user",fields(e){return j(e).concat(M())}};i.GenerateOneTimeCodes={display:()=>"Generate one-time backup codes",fields(e){return j(e).concat(M()).concat([{name:"number_of_codes",editor:"StaticNumber",caption:"Number of codes"}])}};i.ChangePage={display(e){var t;const n=a.get_page(e==null?void 0:e.element_id());return"Go to page "+((t=n==null?void 0:n.name())!=null?t:"...")},fields(e){const t=a.get_page(e.element_id());const n=t==null?void 0:t.get_static_property("page_item_type");return[{name:"element_id",caption:"Destination",editor:"Dropdown",set:B().sets.get_set("Pages")({add_pages:[{display:"Current page",value:"Current page"},{display:"Dynamic page...",value:"Dynamic page"}]})},{name:"data_to_send",caption:"Data to send",editor:"Basic",value:n!=null?n:"text",optional:n==null,condition:e=>!["Current page","Dynamic page"].includes(e.get_static_property("element_id")),value_setter:{property_modifier(e){U.set_group_type_list_elements(t,e,"page_item_type")},generate_message:e=>U.get_generate_message_page(t,e)}},{name:"dynamic_page_name",caption:"Dynamic page name",editor:"Basic",value:"text",condition:e=>["Dynamic page"].includes(e.get_static_property("element_id"))},{name:"replace_history",caption:"Replace the entry in the browser history",editor:"Checkbox",condition:e=>{var t;return[(t=e.root())==null?void 0:t.id(),"Current page","Dynamic page"].includes(e.get_static_property("element_id"))}},{name:"open_in_new_tab",caption:"Open in a new tab",editor:"Checkbox"},{name:"information",editor:"Label",condition:"open_in_new_tab",label_text:"Opening in a new tab only works if the workflow triggers from a click or popups are allowed from your site."}].concat(U.add_parameters_to_link())}};i.RefreshPage={display:()=>"Refresh the page",fields:()=>[]};i.GoPrevious={display:()=>"Go to previous page",fields:()=>[]};i.OpenURL={display:()=>"Open an external website",fields:()=>[{name:"url",caption:"Destination",editor:"LongText",no_enter:true,no_rich_text_editing:true},{name:"open_in_new_tab",caption:"Open in a new tab",editor:"Checkbox"},{name:"information",editor:"Label",condition:"open_in_new_tab",label_text:"Opening in a new tab only works if the workflow triggers from a click or popups are allowed from your site."}]};i.ScrollToElement={display(e,t){if(t){return"Scroll to"}const n=q.element(e==null?void 0:e.element_id());const r=n?n.get_name():"an element";return"Scroll to "+r},fields(e){return s.get_element_id_field(e,true).concat([{name:"offset",editor:"StaticNumber",caption:"Offset (pixels)"}])}};function E(e){return r.toTitleCase(e.split(".")[0]+" "+e.split(".")[1])}let k=null;function O(e,t){clearTimeout(k);const n=y().get_canvas();y().render_thumbnail(n,t,1);y().show($(b.PROPERTY_EDITOR),"left",true);r.velocity(n.find(".rendered-element"),e,{});k=setTimeout((()=>y().hide(true)),a.get_velocity_animation_duration(e)+10)}i.AnimateElement={display(e,t){if(t){return"Animate"}const n=q.element(e==null?void 0:e.element_id());const r=n?n.get_name():"an element";return"Animate "+r},fields(e){const t=e.get_static_property("animation");function n(e){const t=e.value;const n=q.element(t);return n.can_animate()}let i;if(t.indexOf("transition.")===0){if(t.indexOf("Out")!==-1){i="This animation will hide the element at the end"}else if(t.indexOf("In")!==-1){i="This animation will show the element at the end"}}const o=e.get_static_property("element_id");let c;if(o){c=B().sets.get_set("FromOptionsList")(r.all_transition_names.map((e=>{const t=new(B().sets.Option)(E(e),e);t.hover_cb={enter(){O(e,o)},leave(){}};return t})),l.REAL_TIME_SEARCH)}return s.get_element_id_field(e,undefined,n).concat([{name:"animation",caption:"Animation",editor:"Dropdown",set:c,condition:()=>o,on_change(t){setTimeout((()=>{O(t,o)}),20);if(e.exists()){if(e.property("duration").is_empty()){e.property("duration").json.set(a.get_velocity_animation_duration(t),{name:"Hack to rename the animation"})}}}},{name:"information",editor:"Label",label_text:i,condition:()=>i!=null},{name:"customize_duration",editor:"Checkbox",caption:"Define a custom duration"},{name:"duration",editor:"StaticNumber",caption:"Duration (ms)",condition:"customize_duration"}])}};i.SetFocusToElement={display(e,t){if(t){return"Set focus"}const n=q.element(e==null?void 0:e.element_id());const r=n?n.get_name():"an input element";return"Set focus to "+r},fields:e=>s.get_element_id_field(e)};function S(e){return function(t){var n,r,i,s,o;const l=W.get(e());let c=t==null?void 0:(n=t.entry)==null?void 0:n.call(t,"key").get_static();const u=a.sub_node_key_to_value(l,c);const d=u!=null&&u.is_list()&&!["add_list","remove_list","set_list"].includes((r=t.property("action"))==null?void 0:r.get_literal())?u.inner():u;c=t==null?void 0:(i=t.entry)==null?void 0:i.call(t,"key").get_static();const p=B().sets.get_set("CustomFields")({btype_name:l,writeable:true});const _=(s=window)!=null&&s.composer_revamp?(o=p.find((e=>e.value===c)))==null?void 0:o.display:p.get_display(c);const f=[{name:"key",editor:"Dropdown",label_text:()=>_,set:p,pretty:{arrowless:true}},{name:"action",editor:u!=null&&u.is_list()?"Dropdown":"Label",label_text:" = ",set:B().sets.get_set("ChangeActions")(),width_class:"width-75",condition:()=>u!=null,pretty:{arrowless:true}}];if(!(u!=null&&u.is_list())||u!=null&&u.is_list()&&!t.property("action").is_empty()&&t.property("action").get_literal()!=="clear_list"){const e=(d==null?void 0:d._id)==="geographic_address"?"Basic":d!=null&&d.matches("text")?"ShortText":"Basic";f.push({name:"value",editor:e,value:d!=null?d:W.get("null"),condition:()=>u!=null,pretty:{arrowless:true},optional:!(u!=null&&u.is_list()),value_setter:{property_modifier(e){var n,r;const i=q.element((n=(r=t.property("value")).get_static_property)==null?void 0:n.call(r,"element_id"));if((i==null?void 0:i.type())==="Input"){const e=d.id()==="number"?"float_number":d.id();const t=i.get_static_property("content_format");if(t||e==="float_number"&&["int_number","float_int"].includes(t)){return}if(Object.keys(F.input_content_options).includes(e)){i.set_property("content_format",e);i.commit()}}},no_need_to_show_message:()=>true}})}return f}}i.NewThing={display(e){const t=!e||this.return_value(e).id()==="null"?"thing":this.return_value(e).display();return"Create a new "+t+"..."},next_recommended_actions(e){for(const t of["GetElement","ThisElement"]){if(e.find_expressions(t).length){return[{type:"ResetInputs"}]}}},fields(e){var t;let n;if(q.has_feature_enabled("reorg_component_selection")){n=g().filter((e=>e.value!=="user")).with_options({new_option_accelerator:v()})}else{n=B().sets.get_set("CustomTypes")(false,true)}return[{name:"thing_type",caption:"Type",editor:"Dropdown",set:n},{name:"initial_values",editor:"ObjectList",sub_properties:S((()=>this.return_value(e))),condition:"thing_type",optional:true,show_expand_all:true,button_caption:"Set another field",remove_caption:(t=window)!=null&&t.is_maison?"remove":undefined}]}};function D(e){const t=e.raw();delete t.next;let n=e;let r=-1;while(n){var i,s,o,a,l,c,u,d,p,_;if((i=(s=n).get_value)!=null&&i.call(s).custom_type()&&!((o=(a=n).next)!=null&&(l=(c=o.call(a)).get_value)!=null&&l.call(c).custom_type())){return t}r++;n=(u=(d=n).next)==null?void 0:u.call(d);const e=(p=(_=n)==null?void 0:_.raw())!=null?p:{};delete e.next;let f=t;for(let e=0;e<r;e++){f=f.next}f.next=e}return false}i.SetSlug={display:()=>"Set a thing's slug...",fields(e){const t=[{name:"to_change",caption:"Thing to change",editor:"Basic",value:W.saveable,value_setter:{generate_message(t){const n=e.property("to_change");if(n&&!n.is_empty()){if(n.get_eval_value().is_list()){return{message:"You're trying to change the slug of a list of "+n.get_eval_value().inner().display()+"s. You probably want to change the first item of this list.",button_caption:"Click here to change the first item"}}else if(D(n)&&!n.get_eval_value().custom_type()){return{message:"You're trying to change a field, and not a thing. You probably want to change the thing itself.",button_caption:"Click here to change the thing"}}}},property_modifier(t){const n=e.property("to_change");let r;if(n.get_eval_value().is_list()){r=n.raw();r.next={name:"first_element",type:"Message"}}else{const e=D(n);if(n&&e&&!n.get_eval_value().custom_type()){r=e}}if(r){e.set_property("to_change",r);e.commit()}}}}];return t.concat([{name:"slug",caption:"Slug",editor:"ShortText"}])}};i.ChangeThing={display(e){let t;if(e){const n=this.return_value(e);if(n.id()==="null"){t="thing"}else{t=n.display()}}else{t="thing"}return`Make changes to ${t}...`},fields(e){const t=e.property("to_change").get_eval_value();const n=[{name:"to_change",caption:"Thing to change",editor:"Basic",value:W.saveable,value_setter:{generate_message(t){const n=e.property("to_change");if(n&&!n.is_empty()){if(n.get_eval_value().is_list()){return{message:"You're trying to change a list of "+n.get_eval_value().inner().display()+"s. You probably want to change the first item of this list.",button_caption:"Click here to change the first item"}}else if(D(n)&&!n.get_eval_value().custom_type()){return{message:"You're trying to change a field, and not a thing. You probably want to change the thing itself and pick the field to modify below in the Property Editor.",button_caption:"Click here to change the thing"}}}},property_modifier(t){const n=e.property("to_change");let r;if(n.get_eval_value().is_list()){r=n.raw();r.next={name:"first_element",type:"Message"}}else{const e=D(n);if(n&&e&&!n.get_eval_value().custom_type()){r=e}}if(r){e.set_property("to_change",r);e.commit()}}}}];if(t&&t.id()!=="user"){n.push({name:"create_if_missing",caption:"Create if the thing doesn't exist",editor:"Checkbox",deprecated_date:1500505935e3})}return n.concat(w(this.return_value(e)))}};i.ChangeListOfThings={display(e){var t;let n=e==null?void 0:e.get_static_property("type_to_change");if(n){n=W.get(n)}const r=(t=n)!=null&&t.display()?n.display()+"s":"things";return"Make changes to a list of "+r+"..."},fields(e){const t=e.get_static_property("type_to_change");const n=t!=null?"."+t:null;const r="list"+(n!=null?n:"*");let i;if(q.has_feature_enabled("reorg_component_selection")){i=g()}else{i=B().sets.get_set("CustomTypes")(true,false)}return[{name:"type_to_change",caption:"Type of things",editor:"Dropdown",set:i},{name:"to_change",caption:"List to change",editor:"Basic",value:r!=null?r:"null",condition:()=>t!=null}].concat(w(W.get(t)))}};i.DeleteThing={display(e){const t=e!=null&&e.property("to_delete")?e.property("to_delete").get_eval_value():W.get("null");const n=t.id()==="null"?"thing":t.display();return`Delete ${n}...`},fields(e){return[{name:"to_delete",caption:"To delete",editor:"Basic",value:W.saveable}]}};i.DeleteListOfThings={display(e){var t;let n=e==null?void 0:e.get_static_property("type_to_delete");if(n){n=W.get(n)}const r=(t=n)!=null&&t.display()?n.display()+"s":"things";return"Delete a list of "+r+"..."},fields(e){const t=e.get_static_property("type_to_delete");const n=t!=null?"."+t:undefined;const r="list"+(n!=null?n:"*");let i;if(q.has_feature_enabled("reorg_component_selection")){i=g()}else{i=B().sets.get_set("CustomTypes")(true,false)}return[{name:"type_to_delete",caption:"Type of things",editor:"Dropdown",set:i},{name:"to_delete",caption:"List to delete",editor:"Basic",value:r!=null?r:"null",condition:()=>t!=null}]}};i.CopyListOfThings={display(e){const t=e!=null&&e.get_static_property("type_to_copy")?W.get(e.get_static_property("type_to_copy")):undefined;const n=t!=null&&t.display()?t.display()+"s":"things";return"Copy a list of "+n+"..."},fields(e){const t=e.get_static_property("type_to_copy");const n=t!=null?"."+t:undefined;const r="list"+(n!=null?n:"*");let i;if(q.has_feature_enabled("reorg_component_selection")){i=g()}else{i=B().sets.get_set("CustomTypes")(true,false)}return[{name:"type_to_copy",caption:"Type of things",editor:"Dropdown",set:i},{name:"to_copy",caption:"List to copy",editor:"Basic",value:r!=null?r:"null",condition:()=>t!=null},{name:"information",editor:"Label",label_text:"For security and performance reasons, this action will only copy lists that have less than "+G.max_new_list_length+" items. If the lists exceeds this limit, this action won't create any new thing."}]}};function C(){if(B().is_edit_mode()){var e;if(!((e=q.app_plan())!=null&&e.import_export_csv)){return[{name:"information",editor:"Label",label_text:"This action is only accessible on paid plans. Click here to upgrade your plan for the action to work properly.",click_cb(){return V.send_to_plan()}}]}}return[]}i.DownloadDataAsCSV={display:()=>"Download data as CSV",fields(e){const t=e.get_static_property("data_type");const n=t!=null?"."+t:null;const r="list"+(n!=null?n:"*");const i=W.get(t);const s=i.custom_type()?B().sets.get_set("CustomFields")({btype_name:t,add_unique_id:true,add_email_field_for_user_type:t==="user"}):B().sets.get_set("MessagesWithoutArguments")({btype_name:t});return C().concat([{name:"data_type",caption:"Type of data",editor:"Dropdown",set:B().sets.get_set("ObjectValues")()},{name:"data_source",caption:"Data source",editor:"Basic",value:r},{name:"file_name",caption:"File name",editor:"ShortText"},{name:"date_formatting",caption:"Date formatting",editor:"Dropdown",set:B().sets.get_set("Object")({spreadsheet_compatible:"Excel friendly",universal:"Full (with time zone)",custom:"Custom"})},{name:"custom_format",caption:"Custom date format",editor:"StaticText",condition:"date_formatting is custom"},{name:"separator",caption:"Separator",editor:"Dropdown",set:B().sets.get_set("Object")(o.csv_separators),pretty:{dropdown_width:"short"}},{name:"show_labels",caption:"Include labels in first row",editor:"Checkbox"},{name:"use_caption_labels",caption:"Use field captions instead of IDs",editor:"Checkbox",condition:"show_labels"},{name:"use_quotes",caption:"Wrap values in double quotes",editor:"Checkbox"},{name:"hide_some_fields",caption:"Hidden columns",editor:"CheckboxList",set:s,condition:()=>t!=null}])}};i.UploadCSVData={display:()=>"Upload data as CSV",fields(e){let t;if(q.has_feature_enabled("reorg_component_selection")){t=g().filter((e=>e.value!=="user"))}else{t=B().sets.get_set("CustomTypes")(false,false)}return C().concat([{name:"data_type",caption:"Type of data",editor:"Dropdown",set:t},{name:"file",caption:"CSV file",editor:"Basic",value:"file"},{name:"separator",caption:"Separator",editor:"Dropdown",set:B().sets.get_set("Object")(o.csv_separators),pretty:{dropdown_width:"short"}},{name:"information",editor:"Label",label_text:"Column headers should match the fields' captions."},{name:"information",editor:"Label",label_text:"On the "+q.app_plan().display+" plan, this action only uploads CSV files with fewer than "+r.add_thousand_sep(q.app_plan().upload_csv_run_mode_limit)+" lines. If the list exceeds this limit, no data will be imported."}])}};i.APIReturnData={display:e=>"Return data from API",fields(e){return[{name:"return_plain_text",caption:"Content-type",editor:"Dropdown",set:B().sets.get_set("APIReturnTypes")(),default:false},{name:"custom_content_type",caption:"Custom type",editor:"ShortText",optional:false,condition:()=>e.get_static_property("return_plain_text")===c.custom.value},{name:"text",caption:"Text to return",editor:"LongText",condition:()=>e.get_static_property("return_plain_text")===c.plain_text.value,pretty:{no_caption:true}},{name:"custom_text",caption:"Custom content to return",editor:"LongText",condition:()=>e.get_static_property("return_plain_text")===c.custom.value,pretty:{no_caption:true}},{name:"parameters_actions",editor:"ObjectList",button_caption:"Add another parameter",condition:()=>e.get_static_property("return_plain_text")==null||e.get_static_property("return_plain_text")===c.json.value,has_rows:true,sub_properties(e){var t;let n;if(e!=null&&(t=e.entry)!=null&&t.call(e,"value").get_static()){var r;if(e!=null&&(r=e.entry)!=null&&r.call(e,"list").get_static()){n=f.list_type(e.entry("value").get_static())}else{n=e.entry("value").get_static()}}let i;if(q.has_feature_enabled("reorg_component_selection")){i=m()}else{i=B().sets.get_set("AllowableValues")()}return[{name:"key",caption:"Key",editor:"StaticText",include_in_redesign:false},{name:"value",editor:"Dropdown",set:i,condition:"key",pretty:{dropdown_width:"medium-large"},include_in_redesign:false},{name:"list",editor:"Checkbox",caption:"List",condition:"key",include_in_redesign:false},{name:"content",editor:"Basic",condition:()=>{var t;return!(e!=null&&(t=e.entry)!=null&&t.call(e,"value").is_empty())},value:n,include_in_redesign:false},{name:"key",caption:"Key",editor:"StaticText",include_in_redesign:true,pretty:{class_name:"api-event-parameter",row_id:1}},{name:"value",editor:"Dropdown",label:"Type",set:i,condition:"key",pretty:{class_name:"api-event-parameter",row_id:2,dropdown_width:"medium-large"},include_in_redesign:true},{name:"list",editor:"Checkbox",caption:"List",condition:"key",include_in_redesign:true,pretty:{class_name:"api-event-parameter",row_id:3}},{name:"content",editor:"Basic",condition:()=>{var t;return!(e!=null&&(t=e.entry)!=null&&t.call(e,"value").is_empty())},value:n,include_in_redesign:true,pretty:{class_name:"api-event-parameter",row_id:4}}]}}]}};i.DeleteUploadedFile={display:e=>"Delete an uploaded file",fields(e){return[{name:"url_to_delete",caption:"File URL",editor:"Basic",value:"text"}]}};const T=e=>({name:"arguments",editor:"StaticList",static_list:()=>{var t,n;const r=e.get_static_property("custom_event");return(t=(n=q.event(r))==null?void 0:n.get_custom_parameters())!=null?t:[]},id_field:"param_id",sub_properties:t=>{var n,r,i;if(t.json){t=t.json.raw()}const s=e.get_static_property("custom_event");const o=q.event(s).get_custom_parameters();const a=o.find((e=>e.param_id===t.param_id));return[{name:"arg_value",caption:(n=a==null?void 0:a.param_name)!=null?n:"MISSING PARAMETER",editor:"Basic",value:(r=a==null?void 0:a.btype_id)!=null?r:"null",optional:(i=a==null?void 0:a.optional)!=null?i:true}]}});i.TriggerCustomEvent={display(e){var t;const n=e?(t=q.event(e.get_static_property("custom_event")))==null?void 0:t.get_static_property("event_name"):undefined;return"Trigger "+(n!=null?n:"a custom event")},fields(e){return[{name:"custom_event",caption:"Custom event",editor:"Dropdown",set:B().sets.get_set("CustomEvents")(e)},T(e)]}};i.TriggerCustomOnChange={display(e){var t;let n,r;if(e){var i;const t=e.get_static_property("custom_event");const s=q.event(t);r=s==null?void 0:s.get_static_property("event_name");const o=s==null?void 0:(i=s.get_custom_parameters()[0])==null?void 0:i.btype_id;const a=e.get_static_property("field");if(o&&a){const e=W.get(o);n="a "+e.display()+e.get_message(a).description()+" changes"}}if(!n){n="data changes"}return"Trigger "+((t=r)!=null?t:"a custom event")+" when "+n},fields(e){var t,n;const r=e.get_static_property("custom_event");const i=(t=q.event(r))==null?void 0:(n=t.get_custom_parameters()[0])==null?void 0:n.btype_id;return[{name:"custom_event",caption:"Custom event",editor:"Dropdown",set:B().sets.get_set("CustomEvents")(e)},{name:"workflow_thing",caption:"Thing to Watch",editor:"Basic",value:i,condition:()=>i!=null},{name:"field",caption:"Field to watch",editor:"Dropdown",set:B().sets.get_set("CustomFields")({btype_name:i,add_email_confirmed_field_for_user_type:true}),condition:()=>i!=null}]}};i.ScheduleCustom={display(e){var t;let n,r;if(e){var i;const t=e.get_static_property("custom_event");r=(i=q.event(t))==null?void 0:i.get_static_property("event_name");n=e.property("delay");if(!n.is_empty()){n=" after "+n.get_tree_display()+" seconds"}else{n=""}}if(!n){n=""}return"Schedule "+((t=r)!=null?t:"a custom event")+n},fields(e){return[{name:"custom_event",caption:"Custom event",editor:"Dropdown",set:B().sets.get_set("CustomEvents")(e)},T(e),{name:"delay",caption:"Delay (seconds)",editor:"Basic",value:"number"}]}};i.TriggerCustomEventFromReusable={display(e){var t,n;let r,i;if(e){var s,o;const t=e.get_static_property("custom_event");i=(s=q.event(t))==null?void 0:s.get_static_property("event_name");r=(o=q.element(e.get_static_property("element_id")))==null?void 0:o.get_name()}return"Trigger "+((t=i)!=null?t:"a custom event")+" from "+((n=r)!=null?n:"a reusable element")},fields(e){var t;const n=(t=q.element(e.get_static_property("element_id")))==null?void 0:t.get_static_property("custom_id");return[{name:"element_id",caption:"Reusable element",editor:"Dropdown",set:B().sets.get_set("PageElements")(e,"CustomElement")},{name:"custom_event",caption:"Custom event",editor:"Dropdown",set:B().sets.get_set("CustomEventsFromReusable")(e,n),condition:"element_id"},T(e)]}};function N(){if(B().is_edit_mode()){var e,t;if(!((e=q.app_plan())!=null&&e.api)||!((t=q.app_plan())!=null&&t.scheduler)){return[{name:"information",editor:"Label",label_text:"This action is only accessible with the Bubble API and scheduler. Click here to upgrade your plan for the action to run successfully.",click_cb(){V.send_to_plan()}}]}else if(!q.get_public_setting("exposes_wf_api")){return[{name:"information",editor:"Label",label_text:"The Workflow API is not activated for your app. Please do this in Settings -> API.",click_cb(){$(b.SETTINGS_TAB).click();B().settings_editor.settings_canvas.open_tab("API")}}]}}return[]}function P(e,t){var n;const r=q.workflow_item(e.get_static_property("api_event"));const i=[];if(r){for(const{param_id:e,btype_id:t,optional:n,in_url:l}of(s=(o=r.get_custom_parameters)==null?void 0:o.call(r))!=null?s:[]){var s,o;const r=_(e);if(!l&&!r.includes(".")){i.push({name:a.APIEvent_param_prefix+r,caption:e,editor:t==="text"?"ShortText":"Basic",value:t,optional:n})}}}let l=B().sets.get_set("Filtered")(B().sets.get_set("PageEventsByType")(q.api()),(e=>{const t=q.event(e.value);return t.exists()&&!t.is_action()&&t.wf_name()!=null&&t.get_static_property("parameter_def")!=="auto"}));if((n=window)!=null&&n.composer_revamp){l=l.with_options({new_option_accelerator:{display:"Edit Backend workflows...",hide_dropdown:true,onClick:()=>{window.edit_api_workflows()}}})}else{l.add_new=()=>[{display:"Edit Backend workflows...",hide_dropdown:true,fn:()=>{window.edit_api_workflows()}}]}const c=[{name:"api_event",caption:"API Workflow",editor:"Dropdown",set:l},{name:"date",caption:"Scheduled date",editor:"Basic",value:"date"}];if(t){c.push(...[{name:"interval",caption:"Interval (seconds)",editor:"StaticNumber",optional:true},{name:"information",editor:"Label",label_text:"To maintain healthy system functioning, we may schedule calls further apart.",condition:()=>e.get_static_property("interval")!=null&&e.get_static_property("interval")<5}])}return c.concat([{name:"ignore_privacy_rules",caption:"Ignore privacy rules when running the workflow",editor:"Checkbox"}].concat(i))}i.ScheduleAPIEvent={display(e){var t,n,r,i;const s=e==null?void 0:e.get_static_property("api_event");const o=(t=(n=a.get_run_mode_api_event_name(s))!=null?n:(r=q.event(e==null?void 0:e.get_static_property("api_event")))==null?void 0:(i=r.wf_name)==null?void 0:i.call(r))!=null?t:"";return"Schedule API Workflow "+o},fields:e=>N().concat(P(e))};i.ScheduleAPIEventOnList={display(e){var t,n,r;const i=e==null?void 0:e.get_static_property("api_event");let s=(t=a.get_run_mode_api_event_name(i))!=null?t:(n=q.event(e==null?void 0:e.get_static_property("api_event")))==null?void 0:(r=n.wf_name)==null?void 0:r.call(n);if(s){s+=" "}else{s=""}return"Schedule API Workflow "+s+"on a list"},fields(e){const t=e.get_static_property("type_of_list");const n=t!=null?"."+t:undefined;const r="list"+(n!=null?n:"*");let i;if(q.has_feature_enabled("reorg_component_selection")){var s,o;const t=p.object_values(e==null?void 0:(s=(o=e.event()).get_value)==null?void 0:s.call(o)).map((e=>({value:e.full_name,display:e.human})));const n="";i=h().add_items([n,t]).with_options({section_order:[n,"Data Types","Option Sets","Basic Types","Plugin Types"]})}else{var a,l,c;const t={};p.object_values(e==null?void 0:(a=(l=e.event()).get_value)==null?void 0:a.call(l)).forEach((e=>{t[e.full_name]=e.human}));const n=B().sets.get_set("DisplayableInListValues")(true);const r=(c=window)!=null&&c.composer_revamp?n.all():n.get_options();for(const{display:e,value:n}of r){t[n]=e}i=B().sets.get_set("Object")(t)}return N().concat([{name:"type_of_list",caption:"Type of things",editor:"Dropdown",set:i},{name:"data_source",caption:"List to run on",editor:"Basic",value:r}].concat(P(e,true)))}};i.TerminateWorkflow={display:e=>"Terminate this workflow",fields:()=>[]};i.CancelScheduledAPIEvent={display(e){const t=e==null?void 0:e.property("scheduled_id");if(t==null||t!=null&&t.is_empty()){return"Cancel a scheduled API Workflow"}else{return"Cancel scheduled API "+t.get_tree_display()}},fields(){return N().concat([{name:"scheduled_id",caption:"Scheduled API ID",editor:"Basic",value:"text"}])}};i.CancelListScheduledAPIEvent={display:()=>"Cancel a list of scheduled API Workflows",fields(){return N().concat([{name:"scheduled_ids",caption:"List of scheduled API ID",editor:"Basic",value:f.list_type("text")}])}};i.SetRecurringEvent={display(e){var t,n,r;const i=e==null?void 0:e.get_static_property("frequency");const s=e==null?void 0:e.get_static_property("recurring_event");if(i==null){return"Set/cancel a recurring event"}const o=(t=(n=a.get_run_mode_api_event_name(s))!=null?n:(r=q.event(s))==null?void 0:r.display(true))!=null?t:"event";if(i==="none"){return"Cancel recurring "+o}else{return"Set recurring "+o+" "+i}},fields(e){var t,n;let r=B().sets.get_set("PageEventsByType")(q.api(),"RecurringEvent");if((t=window)!=null&&t.composer_revamp){r=r.with_options({new_option_accelerator:{display:"Edit recurring workflows...",hide_dropdown:true,onClick:()=>{window.edit_api_workflows()}}})}else{r.add_new=()=>[{display:"Edit recurring workflows...",hide_dropdown:true,fn:()=>{window.edit_api_workflows()}}]}const i=e.get_static_property("recurring_event");const s=(n=q.event(i))==null?void 0:n.get_static_property("custom_event_data_type");return N().concat([{name:"recurring_event",caption:"Recurring event",editor:"Dropdown",set:r},{name:"workflow_thing",caption:"Workflow thing",editor:"Basic",value:s,condition:()=>s!=null},{name:"frequency",caption:"Frequency",editor:"Dropdown",set:B().sets.get_set("List")(["none"].concat(["daily","weekly","monthly","quarterly","yearly"]))},{name:"start_date",caption:"Start date",editor:"Basic",value:"date",condition:e=>![null,undefined,"none"].includes(e.get_static_property("frequency"))},{name:"information",editor:"Label",label_text:"Your current plan does not let you use the scheduler. Please upgrade your plan for more.",condition:()=>!q.app_plan().scheduler,click_cb(){V.send_to_plan()}},{name:"information",editor:"Label",label_text:"Your current plan does not let you use the frequency "+(e==null?void 0:e.get_static_property("frequency"))+". Please upgrade your plan.",condition:()=>{var t;return(e==null?void 0:e.get_static_property("frequency"))!=null&&!((t=q.app_plan().recurring_frequencies)!=null&&t.includes(e==null?void 0:e.get_static_property("frequency")))&&q.app_plan().scheduler},click_cb(){V.send_to_plan()}},{name:"information",editor:"Label",label_text:"Your current plan lets you schedule up to "+q.app_plan().max_schedules_per_thing+" recurring events per thing."+(G.is_dedicated?"":" Please upgrade your plan for more."),condition:()=>q.app_plan().scheduler,click_cb(){V.send_to_plan()}}])}};i.PauseWFClient={display:()=>"Add a pause before next action",fields(){return[{name:"length",caption:"Pause length (ms)",editor:"StaticNumber"},{name:"hide_status_bar",caption:"Hide the status bar as the pause occurs",editor:"Checkbox"},{name:"information",editor:"Label",label_text:"Please note that the pause will only happen for actions happening on the screen. It won't apply for workflows that modify data, send emails, etc."}]}};function I(){return[{name:"ignore_template",caption:"Do not apply a SendGrid template",editor:"Checkbox",condition:()=>q.get_public_setting("sendgrid_verified")}]}i.SendEmail={display:()=>"Send email",fields(){return[{name:"to",caption:"To",editor:"ShortText"},{name:"different_reply_to",caption:"Specify a different reply-to address",editor:"Checkbox"},{name:"replyTo",caption:"Reply to",editor:"ShortText",condition:"different_reply_to"},{name:"sender_name",caption:"Sender name",editor:"ShortText",optional:true},{name:"cc",caption:"Cc",editor:"ShortText",optional:true},{name:"bcc",caption:"Bcc",editor:"ShortText",optional:true},{name:"subject",caption:"Subject",editor:"ShortText",optional:true},{name:"body",caption:"Body",editor:"LongText"},{name:"list_of_attachments",editor:"ObjectList",button_caption:"Attach file",sub_properties(){return[{name:"value",caption:"File",editor:"ShortText"}]}}].concat(I()).concat([{name:"unsubscribe_group_id",caption:"Unsubscribe group ID",editor:"Basic",value:"number",optional:true}])}};i.SendICSFileEmail={display:()=>"Send meeting request by email",fields(e){return[{name:"to",caption:"To",editor:"ShortText"},{name:"sender_name",caption:"Sender name",editor:"ShortText",optional:true},{name:"ORGANIZER",caption:"Organizer",editor:"ShortText",optional:true},{name:"start",caption:"Start time",editor:"Basic",value:"date"},{name:"specify_length",caption:"Set a length instead of an end time",editor:"Checkbox"},{name:"end",caption:"End time",editor:"Basic",value:"date",condition:()=>!e.get_static_property("specify_length")},{name:"event_length",caption:"Length (minutes)",editor:"Basic",value:"number",condition:()=>e.get_static_property("specify_length")},{name:"summary",caption:"Summary (subject)",editor:"ShortText"},{name:"event_description",caption:"Description",editor:"LongText",optional:true,no_rich_text_editing:true},{name:"location",caption:"Location",editor:"ShortText",optional:true},{name:"SEQUENCE",caption:"Sequence",editor:"Basic",value:"number",optional:true},{name:"METHOD",caption:"Method",editor:"ShortText",optional:true},{name:"UID",caption:"UID",editor:"ShortText",optional:true},{name:"STATUS",caption:"Status",editor:"ShortText",optional:true},{name:"change_body",caption:"Change the body of the email",editor:"Checkbox"},{name:"body",caption:"Body",editor:"LongText",condition:"change_body",optional:true}].concat(I())}};i.ResetInputs={display:(e,t)=>t?"Reset inputs":"Reset relevant inputs",fields:e=>[]};function R(e,t,n){const r=q.element(e==null?void 0:e.element_id());const i=r?r.get_name():n;return t+" "+i}i.DisplayGroupData={display:(e,t)=>t?"Display data":R(e,"Display data in","a group/popup"),fields(e){var t;const n=e.element_id();const r=q.element(n);const i=(t=r==null?void 0:r.get_static_property("group_type"))!=null?t:"null";return s.get_element_id_field(e,true).concat([{name:"data_source",caption:"Data to display",editor:"Basic",value:i,value_setter:{property_modifier(t){U.set_group_type_group_elements(r,e,t)},generate_message(e){return U.get_generate_message_group_elements(r,e,"displaying")}}}])},next_recommended_actions(e){if(e.previous().type()!=="ShowElement"){const t=q.element(e==null?void 0:e.element_id());if(t){return[{type:"ShowElement",properties:{element_id:t.id()}}]}}}};i.ResetGroup={display:(e,t)=>t?"Reset data":R(e,"Reset","a group/popup"),fields(e){var t;const n=(e==null?void 0:(t=e.context_element().root())==null?void 0:t.type())==="CustomDefinition";return s.get_element_id_field(e,n)}};function L(e){var t,n;const r=(e==null?void 0:(t=e.context_element())==null?void 0:(n=t.root())==null?void 0:n.type())==="CustomDefinition";function i(e){const t=q.element(e.value).type();return!(t==="Alert")}return s.get_element_id_field(e,r,i)}i.ShowElement={display:(e,t)=>t?"Show":R(e,"Show","an element"),fields:e=>L(e),next_recommended_actions(e){const t=q.element(e==null?void 0:e.element_id());if(t&&!["DisplayGroupData","DisplayListData"].includes(e.previous().type())){const e=["DisplayGroupData","DisplayListData"].find((e=>o.action_element_mapping[e].includes(t.type())));if(e){return[{type:e,properties:{element_id:t.id()}}]}}}};i.HideElement={display:(e,t)=>t?"Hide":R(e,"Hide","an element"),fields(e){var t;const n=L(e);if((t=e.root())!=null&&t.get_static_property("native_app")){n.push(...[{name:"animation",caption:"Animation (native app)",editor:"Dropdown",set:B().sets.get_set("Object")({none:"None",slide:"Slide",flip:"Flip"})},{name:"direction",caption:"Animation direction",editor:"Dropdown",set:B().sets.get_set("List")(["left","right","up","down"]),condition:()=>{var t;return((t=e.root())==null?void 0:t.get_static_property("native_app"))&&![undefined,null,"none"].includes(e.get_static_property("animation"))}}])}return n}};i.ToggleElement={display:(e,t)=>t?"Toggle":R(e,"Toggle","an element"),fields:e=>L(e)};i.CancelUpload={display:(e,t)=>t?"Cancel upload":R(e,"Cancel upload of","a file uploader"),fields(e){return s.get_element_id_field(e,false)}};i.SetCustomState={display(e,t){var n;if(t){return"Set state"}const r=e==null?void 0:e.element_id();const i=e==null?void 0:e.get_static_property("custom_state");const s=(e==null?void 0:e.get_static_property("custom_states_values"))!=null;const o=(n=q.element(r))==null?void 0:n.element_custom_state(i);let a;if(r&&i&&o!=null){const e=o.display();if(s){a=`Set state ${e} of`}else{a=`Set states ${e}... of`}}else{a="Set state of"}return R(e,a,"an element")},fields(e){var t,n;const r=e==null?void 0:e.element_id();let i=e==null?void 0:e.get_static_property("custom_state");let o=r&&i?(t=q.element(r))==null?void 0:t.element_custom_state(i):undefined;let a=(n=o)!=null&&n.exists()?o.value():undefined;return s.get_element_id_field(e,true).concat([{name:"custom_state",caption:"Custom state",editor:"Dropdown",set:B().sets.get_set("CustomStates")(r),condition:()=>r!=null},{name:"value",caption:"Value",editor:"Basic",value:a,condition:()=>a!=null},{name:"custom_states_values",editor:"ObjectList",condition:()=>a!=null,button_caption:"Set another state",sub_properties(e){i=e==null?void 0:e.property("custom_state").get_static();if(i!=null){o=q.element(r).element_custom_state(i);a=o.value()}return[{name:"custom_state",caption:"Custom state",editor:"Dropdown",set:B().sets.get_set("CustomStates")(r),condition:()=>r!=null},{name:"value",caption:"Value",editor:"Basic",optional:true,value:a,condition:()=>a!=null}]}}])}};i.DisplayListData={display:(e,t)=>t?"Display list":R(e,"Display list in","a repeating group"),fields(e){var t;const n=q.element(e.element_id());let r=n==null?void 0:n.get_static_property("group_type");if(r!=null){r="."+r}const i="list"+((t=r)!=null?t:"*");return s.get_element_id_field(e).concat([{name:"data_source",caption:"Data source",editor:"Basic",value:i,value_setter:{property_modifier(e){U.set_group_type_list_elements(n,e,"group_type")},generate_message(e){return U.get_generate_message_list_elements(n,e,"group_type",n.get_name()+"'s content type","displaying")}}}])}};i.ListClear={display:(e,t)=>t?"Clear list":R(e,"Clear list in","a repeating group"),fields:e=>s.get_element_id_field(e)};function z(e){return s.get_element_id_field(e).concat([{name:"wrap_around",caption:"Wrap around",editor:"Checkbox"}])}i.ListShowNext={display:(e,t)=>t?"Show next":R(e,"Show next of","a repeating group"),fields:e=>z(e)};i.ListShowPrevious={display:(e,t)=>t?"Show previous":R(e,"Show previous of","a repeating group"),fields:e=>z(e)};i.ListGoToPage={display:(e,t)=>t?"Go to page":R(e,"Go to page of","a repeating group"),fields(e){return s.get_element_id_field(e).concat([{name:"page",caption:"Page",editor:"Basic",value:"number"}])}};i.ScrollToListEntry={display:(e,t)=>t?"Scroll to entry":R(e,"Scroll to entry of","a repeating group"),fields(e){const t=e.get_static_property("element_id");const n=t?q.element(t):undefined;const r=t?n.get_static_property("group_type"):undefined;return s.get_element_id_field(e,true).concat([{name:"entry",caption:"Entry to scroll to",editor:"Basic",value:r,condition:()=>r!=null},{name:"animate",caption:"Animate the scrolling",editor:"Checkbox"},{name:"offset",editor:"StaticNumber",caption:"Vertical offset (pixels)",condition:()=>n!=null&&n.get_static_property("layout_style")!=="horizontal_scroll"}])}};i.DisplayMapMarkerData={display:(e,t)=>t?"Display markers":R(e,"Display markers on","a map"),fields(e){const t=q.element(e.element_id());const n=t==null?void 0:t.get_static_property("marker_type");let r;if(n==="list"){var i;let e=t==null?void 0:t.get_static_property("marker_data_type");if(e!=null){e="."+e}r="list"+((i=e)!=null?i:"*")}else{r="geographic_address"}return s.get_element_id_field(e).concat([{name:"data_source",caption:n==="list"?"List source":"Marker address",editor:"Basic",value:r,value_setter:{property_modifier(e){if(n==="list"){U.set_group_type_list_elements(t,e,"marker_data_type")}},generate_message(e){if(n==="list"){return U.get_generate_message_list_elements(t,e,"marker_data_type",t.get_name()+"'s marker type","setting")}}}}])}};i.SetCurrentMapMarker={display:(e,t)=>t?"Set current map marker":R(e,"Set current map marker for","a map"),fields(e){const t=q.element(e.element_id());const n=t==null?void 0:t.get_static_property("marker_type");const r=n!=="list"?{name:"information",editor:"Label",label_text:"This action only works on maps that display a list of markers, but this map displays a single marker"}:{name:"to_select",caption:"To select",editor:"Basic",value:t==null?void 0:t.get_static_property("marker_data_type")};return s.get_element_id_field(e).concat(r)}};i.ClearMapMarkers={display:(e,t)=>t?"Clear markers":R(e,"Clear markers on","a map"),fields:e=>s.get_element_id_field(e)};i.MapAdjustZoom={display(e,t){const n=q.element(e==null?void 0:e.element_id());if(n){return"Adjust zoom of "+n.get_name()}else{return"Adjust map zoom"}},fields(e){return s.get_element_id_field(e).concat([{name:"manual_setting",caption:"Set center and zoom manually",editor:"Checkbox"},{name:"center",caption:"Map centered on",editor:"Basic",value:"geographic_address",condition:"manual_setting"},{name:"initial_zoom",caption:"Zoom",editor:"Dropdown",set:B().sets.get_set("Integer")([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]),numerical_step:1,condition:"manual_setting"}])}};i.AlertShowMessage={display(e,t){if(t){return"Show message"}return R(e,"Show message in ","an alert box")},fields(e){return s.get_element_id_field(e).concat([{name:"fade_in",caption:"Fade in (ms)",editor:"Basic",value:"number"},{name:"hold",caption:"Hold (ms)",editor:"Basic",value:"number"},{name:"fade_out",caption:"Fade out (ms)",editor:"Basic",value:"number"},{name:"change_message",caption:"Change the alert message",editor:"Checkbox"},{name:"message",caption:"Message",editor:"LongText",condition:"change_message"}])}};const B=e("./../lib");const q=e("./../lang/appquery");const U=e("./shared_fields");const F=e("./core_elements/shared/inputs");const W=e("./../lang/btypes");const G=e("./../client_config");const V=e("./../editor/subscription")},{"../constants/apiworkflow":44,"../constants/composer":54,"../lang/app_json/json_utils":631,"../lang/btype_ids":652,"../lang/btypes_dropdowns":654,"../services/client/editor_utils":778,"../u/shared/decaf":844,"./../client_config":41,"./../editor/css":560,"./../editor/subscription":589,"./../editor/thumbnail":590,"./../lang/appquery":651,"./../lang/btypes":653,"./../lib":741,"./../services":780,"./../u":823,"./core_actions":162,"./core_actions/utilities/core_actions_consts":173,"./core_actions/utilities/generic_actions_utilities":175,"./core_elements/shared/inputs":364,"./shared_fields":414,"core-js/modules/web.dom-collections.iterator.js":1123}],177:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("./../../lang/application/builtins");const s=e("../../lang/btypes_registry");const o=e("./utilities/generate_utilities");r.plugins={};r.plugins.boolean=e("./plugins/boolean");r.plugins.date=e("./plugins/date");r.plugins.dateinterval=e("./plugins/dateinterval");r.plugins.date_range=e("./plugins/date_range");r.plugins.file=e("./plugins/file");r.plugins.geographic_address=e("./plugins/geographic_address");r.plugins.image=e("./plugins/image");r.plugins.key_combination=e("./plugins/key_combination");r.plugins.null=e("./plugins/null");r.plugins.number_range=e("./plugins/number_range");r.plugins.number=e("./plugins/number");r.plugins.text=e("./plugins/text");r.plugins.user=e("./plugins/user");r.providers={};r.providers.api_wf_data=e("./providers/api_wf_data");r.providers.api=e("./providers/api");r.providers.custom=e("./providers/custom");r.providers.element=e("./providers/element");r.providers.list=e("./providers/list");r.providers.option=e("./providers/option");r.providers.struct=e("./providers/struct");r.providers.style=e("./providers/style");r.providers.sys=e("./providers/sys");for(const e of i.SPECIAL_TYPES){const t=e.name();const n=()=>o.create_custom_btype(t,e,undefined,undefined,true);n.dont_list=true;r.plugins[t]=n}const a=["text","number","number_range","null","date","date_range","dateinterval","boolean","file","image","geographic_address","key_combination","user",...i.SPECIAL_TYPES.map((e=>e.name()))];const l=["sys","element","style","struct","list","custom","api","api_wf_data","option"];r.all={};for(const e of a){s.plugins.add(e,r.plugins[e]);r.all[e]=r.plugins[e]}for(const e of l){s.providers.add(e,r.providers[e]);r.all[e]=r.providers[e]}},{"../../lang/btypes_registry":655,"./../../lang/application/builtins":649,"./plugins/boolean":178,"./plugins/date":179,"./plugins/date_range":180,"./plugins/dateinterval":181,"./plugins/file":182,"./plugins/geographic_address":183,"./plugins/image":184,"./plugins/key_combination":185,"./plugins/null":186,"./plugins/number":187,"./plugins/number_range":188,"./plugins/text":189,"./plugins/user":190,"./providers/api":191,"./providers/api_wf_data":192,"./providers/custom":193,"./providers/element":194,"./providers/list":195,"./providers/option":196,"./providers/struct":197,"./providers/style":198,"./providers/sys":199,"./utilities/generate_utilities":201,"core-js/modules/web.dom-collections.iterator.js":1123}],178:[function(e,t,n){"use strict";const r=e("../../../db/postgres_constraints");const i=e("../../../lib");const{render_bool:s,bool_equals:o,to_bool:a,format_boolean_message:l,format_boolean_number_message:c}=e("../utilities/boolean_utilities");const{build_simple:u}=e("../utilities/generate_utilities");const{get_json_encode_msg:d,generate_JS_to_bubble_error:p}=e("../utilities/misc_utilities");const{COMPOSER_INPUT_TYPES:_}=e("../../../constants/composer");t.exports=u("boolean",{messages:{is_true:{description:' is "yes"',ret_btype:"sys.bool",build_pg_constraint:r.is_true,fn(e,t){return a(e)}},is_false:{description:' is "no"',ret_btype:"sys.bool",build_pg_constraint:r.is_false,fn(e,t){return!a(e)}},format_boolean:l,format_boolean_number:c,format_json_encode:d("boolean"),and_:{description:" and ",no_composer:()=>true,ret_btype:"sys.bool",arg_btype:"sys.bool",fn(e,t){return a(e)&&a(t)}},or_:{description:" or ",no_composer:()=>true,ret_btype:"sys.bool",arg_btype:"sys.bool",fn(e,t){return a(e)||a(t)}}},messages_reorganized:{is_true:{description:" is yes",section:"Operators",ret_btype:"sys.bool",build_pg_constraint:r.is_true,fn(e,t){return a(e)}},is_false:{description:" is no",section:"Operators",ret_btype:"sys.bool",build_pg_constraint:r.is_false,fn(e,t){return!a(e)}},and_:{description:" and ",section:"Operators",no_composer:()=>true,ret_btype:"sys.bool",arg_btype:"sys.bool",fn(e,t){return a(e)&&a(t)}},or_:{description:" or ",section:"Operators",no_composer:()=>true,ret_btype:"sys.bool",arg_btype:"sys.bool",fn(e,t){return a(e)||a(t)}},format_boolean:l,format_boolean_number:c,format_json_encode:d("boolean")},display(){return"yes / no"},composer_input_type:_.BOOLEAN,runmode_display:s,export_to_string(e,t){if(t.booleans_yes_no){return s(e)}else{return e!=null?e:false}},equals:o,get_sample(){return true},from_human(e){if(typeof e==="string"){switch(e.toLowerCase()){case i().get_text("BUILT_IN","YES").toLowerCase():return true;case i().get_text("BUILT_IN","NO").toLowerCase():return false;default:return a(e)}}else{return a(e)}},cast(e){return a(e)},get_JS_object(e){var t;return(t=this.cast(e))!=null?t:false},JS_to_bubble(e){e=this.cast(e);if(e===undefined){p("boolean",e)}return e},convert_to_bubble_instance:a,storable:true,bindable:false})},{"../../../constants/composer":54,"../../../db/postgres_constraints":459,"../../../lib":741,"../utilities/boolean_utilities":200,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203}],179:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("./../../../lang/appquery");const s=e("./../../../db/postgres_constraints");const{build_simple:o}=e("../utilities/generate_utilities");const{generate_JS_to_bubble_error:a,get_json_encode_msg:l}=e("../utilities/misc_utilities");const c=e("../../../u/shared/b_date");const u=e("../../custom_tz_utilities");const{has_rounding_operator_timezone_controls_on:d}=e("../../../lang/timezone_override_settings");const p=e("../../../u/shared/mode_check");const _=r.require_moment();const f=e("./../../../lib");function h(e){const t=i.has_advanced_feature_enabled("timezone_controls_page");const n=i.has_advanced_feature_enabled("timezone_controls_backend_workflows");if(e!=null&&e.json){const r=e.json._path();if(r.startsWith("api")){if(n){return"api_wf"}}else if(t){return"on_page"}}else if(n||t){return"unknown"}return"legacy"}function m(e){let{date:t,properties:n,context:r}=e;let i;if(d()||p.running_test()){i=u.get_custom_tz({static_eval:e=>n[e]})}else{i=f().current_timezone()}const s=c.to_moment(t,i);if(!s.isValid()){return null}return s.clone().startOf(n.component_to_extract).toDate()}const g={minute:"minute",hour:"hour",day:"day",date:"date",week:"week",month:"month",year:"year"};function v(e,t){var n,r;return((n=c.mk_date(e))==null?void 0:n.valueOf())===((r=c.mk_date(t))==null?void 0:r.valueOf())}t.exports=o("date",{messages:{format_date:{ret_btype:"text",arg_btype:null,field_names:{formatting_type:{default:"m/dd/yy"},custom_format:{default:"ddd, m/dd/yy, mmmm (mmm) dS, yyyy, h:MM tt, HH:MM:ss.L"},...u.custom_tz_field_names},spot_data:"SlidableAtom",description(e){var t;const n={formatting_type:(t=e==null?void 0:e.property("formatting_type").raw())!=null?t:"m/dd/yy",custom_format:e==null?void 0:e.property("custom_format").raw()};let r;if(n){r=" "+this.fn(new Date,undefined,n)}else{r="..."}return":formatted as"+r},description_for_sliding_palette:"Date Formatting",fields(e,t){const n=new Date;const i={};for(const e of["m/dd/yy","m/dd/yyyy","mmm d, yyyy","mmmm d, yyyy","ddd, mmm d, yyyy","ddd d mmmm, yyyy","dddd, mmmm d, yyyy","h:MM tt","HH:MM","HH:MM:ss"]){i[e]=r.format_date(n,e,f().get_text("BUILT_IN","DATE_FORMAT"))}i.iso_date="Simplified extended ISO";i.custom="Custom";return[{name:"formatting_type",caption:"Format type",editor:"Dropdown",set:f().sets.get_set("Object")(i)},{name:"custom_format",caption:"Custom format",editor:"StaticText",condition:"formatting_type is custom"},...u.custom_tz_fields(h(t),{},true)]},fn(e,t,n,i,s){let o=n==null?void 0:n.formatting_type;if(o==="custom"){o=n.custom_format}e=c.mk_date(e);if(!e){return""}else{const t=u.get_custom_tz({static_eval:e=>n[e],not_overridden:true});let i;if(t&&_.tz.zone(t)){i=t}else{i=_.tz.guess()}if(o==="iso_date"){return e.toISOString()}return r.format_date(e,o,f().get_text("BUILT_IN","DATE_FORMAT"),i)}}},format_json_encode:l("date"),to_range:{description:"<- range ->",arg_btype:"date",ret_btype:"date_range",fn(e,t){e=c.mk_date(e);t=c.mk_date(t);if(!e||!t){return[]}return[c.mk_date(Math.min(e,t)),c.mk_date(Math.max(e,t))]}},plus_seconds:{description:" +(seconds): ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_seconds(e,t,n,r,i)}},plus_minutes:{description:" +(minutes): ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_minutes(e,t,n,r,i)}},plus_hours:{description:" +(hours): ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_hours(e,t,n,r,i)}},plus_days:{description:" +(days): ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_days(e,t,n,r,i)}},plus_months:{description:" +(months): ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_months(e,t,n,r,i)}},plus_years:{description:" +(years): ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_years(e,t,n,r,i)}},change_seconds:{description:" change seconds to ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_seconds(e,t,n,r,i)}},change_minutes:{description:" change minutes to ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_minutes(e,t,n,r,i)}},change_hours:{description:" change hours to ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_hours(e,t,n,r,i)}},change_date:{description:" change date to ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_date(e,t,n,r,i)}},change_month:{description:" change month to ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_month(e,t,n,r,i)}},change_years:{description:" change years to ",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_years(e,t,n,r,i)}},greater_than:{description:" > ",ret_btype:"sys.bool",arg_btype:"date",fn(e,t){return c.mk_date(e)>c.mk_date(t)}},less_than:{description:" < ",ret_btype:"sys.bool",arg_btype:"date",fn(e,t){return c.mk_date(e)<c.mk_date(t)}},minus:{description:" - ",ret_btype:"dateinterval",arg_btype:"date",fn(e,t){return c.mk_date(e)-c.mk_date(t)}},extract_from_date:{ret_btype:"number",field_names:{component_to_extract:{},...u.custom_tz_field_names},spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.property("component_to_extract");let n;if(t&&!t.is_empty()){n=" "+t.get_static()}else{n="..."}return":extract"+n},description_for_sliding_palette:"Extract from date",fields(e,t){return[{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:f().sets.get_set("Object")(r.extend({},g,{UNIX:"UNIX timestamp (ms)"}))},...u.custom_tz_fields(h(t),(e=>{const t=i.get_public_setting("bubble_version");const n=e.get_static_property("component_to_extract");return t>0&&n!=="UNIX"}),true)]},fn(e,t,n,r,i){return f().bv().date_code.extract_from_date(e,t,n,r,i)}},rounded_down:{ret_btype:"date",field_names:r.extend({component_to_extract:{}},u.custom_tz_field_names),spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.property("component_to_extract");let n;if(t&&!t.is_empty()){n=" "+t.get_static()}else{n="..."}return":rounded down to"+n+" "},description_for_sliding_palette:"Rounded down to",fields(e,t){return[{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:f().sets.get_set("Object")(g)},...u.custom_tz_fields(h(t),{condition:d})]},fn(e,t,n,r,i){return m({date:e,properties:n,context:i})}},equals_rounded_down:{ret_btype:"sys.bool",arg_btype:"date",field_names:r.extend({component_to_extract:{}},u.custom_tz_field_names),spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.property("component_to_extract");let n;if(t&&!t.is_empty()){n=" "+t.get_static()}else{n="..."}return":equals rounded down to "+n+" "},description_for_sliding_palette:"Equals rounded down to",fields(e,t){return[{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:f().sets.get_set("Object")(g)},...u.custom_tz_fields(h(t),{condition:d})]},fn(e,t,n,r,i){e=m({date:e,properties:n,context:i});t=m({date:t,properties:n,context:i});return v(e,t)}},max:{description:" <- max -> ",ret_btype:"date",arg_btype:"date",fn(e,t){var n,r,i,s;e=c.mk_date(e);t=c.mk_date(t);if(((n=e)==null?void 0:(r=n.getTime)==null?void 0:r.call(n))>=((i=t)==null?void 0:(s=i.getTime)==null?void 0:s.call(i))||!t){return e}else{return t}}},min:{description:" <- min -> ",ret_btype:"date",arg_btype:"date",fn(e,t){var n,r,i,s;e=c.mk_date(e);t=c.mk_date(t);if(((n=e)==null?void 0:(r=n.getTime)==null?void 0:r.call(n))<=((i=t)==null?void 0:(s=i.getTime)==null?void 0:s.call(i))||!t){return e}else{return t}}},is_empty:{description:" is empty",ret_btype:"sys.bool",build_pg_constraint:s.is_empty,fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",ret_btype:"sys.bool",build_pg_constraint:s.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}},equals:{description:" is ",ret_btype:"sys.bool",arg_btype:"date",no_composer:()=>true,fn(e,t){return v(e,t)},build_pg_constraint:s.equals,build_pg_r_constraint:s.equals,build_pg_relationship:s.equals_both},not_equals:{description:" is not ",ret_btype:"sys.bool",arg_btype:"date",no_composer:()=>true,fn(e,t){return!v(e,t)},build_pg_constraint:s.not_equals,build_pg_r_constraint:s.not_equals,build_pg_relationship:s.not_equals_both}},messages_reorganized:{equals:{description:" is ",section:"Operators",ret_btype:"sys.bool",arg_btype:"date",no_composer:()=>true,fn(e,t){return v(e,t)},build_pg_constraint:s.equals,build_pg_r_constraint:s.equals,build_pg_relationship:s.equals_both},not_equals:{description:" is not ",section:"Operators",ret_btype:"sys.bool",arg_btype:"date",no_composer:()=>true,fn(e,t){return!v(e,t)},build_pg_constraint:s.not_equals,build_pg_r_constraint:s.not_equals,build_pg_relationship:s.not_equals_both},format_date:{section:"Operators",ret_btype:"text",arg_btype:null,field_names:{formatting_type:{default:"m/dd/yy"},custom_format:{default:"ddd, m/dd/yy, mmmm (mmm) dS, yyyy, h:MM tt, HH:MM:ss.L"},...u.custom_tz_field_names},spot_data:"SlidableAtom",description(e){var t;const n={formatting_type:(t=e==null?void 0:e.property("formatting_type").raw())!=null?t:"m/dd/yy",custom_format:e==null?void 0:e.property("custom_format").raw()};let r;if(n){r=" "+this.fn(new Date,undefined,n)}else{r="..."}return":formatted as"+r},description_for_sliding_palette:"Date Formatting",fields(e,t){const n=new Date;const i={};for(const e of["m/dd/yy","m/dd/yyyy","mmm d, yyyy","mmmm d, yyyy","ddd, mmm d, yyyy","ddd d mmmm, yyyy","dddd, mmmm d, yyyy","h:MM tt","HH:MM","HH:MM:ss"]){i[e]=r.format_date(n,e,f().get_text("BUILT_IN","DATE_FORMAT"))}i.iso_date="Simplified extended ISO";i.custom="Custom";return[{name:"formatting_type",caption:"Format type",editor:"Dropdown",set:f().sets.get_set("Object")(i)},{name:"custom_format",caption:"Custom format",editor:"StaticText",condition:"formatting_type is custom"},...u.custom_tz_fields(h(t),{},true)]},fn(e,t,n,i,s){let o=n==null?void 0:n.formatting_type;if(o==="custom"){o=n.custom_format}e=c.mk_date(e);if(!e){return""}else{const t=u.get_custom_tz({static_eval:e=>n[e],not_overridden:true});let i;if(t&&_.tz.zone(t)){i=t}else{i=_.tz.guess()}if(o==="iso_date"){return e.toISOString()}return r.format_date(e,o,f().get_text("BUILT_IN","DATE_FORMAT"),i)}}},greater_than:{description:" > ",section:"Operators",ret_btype:"sys.bool",arg_btype:"date",fn(e,t){return c.mk_date(e)>c.mk_date(t)}},less_than:{description:" < ",section:"Operators",ret_btype:"sys.bool",arg_btype:"date",fn(e,t){return c.mk_date(e)<c.mk_date(t)}},minus:{description:" - ",section:"Operators",ret_btype:"dateinterval",arg_btype:"date",fn(e,t){return c.mk_date(e)-c.mk_date(t)}},to_range:{description:"<- range ->",section:"Other Operators",arg_btype:"date",ret_btype:"date_range",fn(e,t){e=c.mk_date(e);t=c.mk_date(t);if(!e||!t){return[]}return[c.mk_date(Math.min(e,t)),c.mk_date(Math.max(e,t))]}},max:{description:" <- max -> ",section:"Other Operators",ret_btype:"date",arg_btype:"date",fn(e,t){var n,r,i,s;e=c.mk_date(e);t=c.mk_date(t);if(((n=e)==null?void 0:(r=n.getTime)==null?void 0:r.call(n))>=((i=t)==null?void 0:(s=i.getTime)==null?void 0:s.call(i))||!t){return e}else{return t}}},min:{description:" <- min -> ",section:"Other Operators",ret_btype:"date",arg_btype:"date",fn(e,t){var n,r,i,s;e=c.mk_date(e);t=c.mk_date(t);if(((n=e)==null?void 0:(r=n.getTime)==null?void 0:r.call(n))<=((i=t)==null?void 0:(s=i.getTime)==null?void 0:s.call(i))||!t){return e}else{return t}}},plus_seconds:{description:"+ seconds: ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_seconds(e,t,n,r,i)}},plus_minutes:{description:"+ minutes: ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_minutes(e,t,n,r,i)}},plus_hours:{description:"+ hours: ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_hours(e,t,n,r,i)}},plus_days:{description:"+ days: ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_days(e,t,n,r,i)}},plus_months:{description:"+ months: ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_months(e,t,n,r,i)}},plus_years:{description:"+ years: ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.plus_years(e,t,n,r,i)}},change_seconds:{description:" change seconds to ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_seconds(e,t,n,r,i)}},change_minutes:{description:" change minutes to ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_minutes(e,t,n,r,i)}},change_hours:{description:" change hours to ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_hours(e,t,n,r,i)}},change_date:{description:" change date to ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_date(e,t,n,r,i)}},change_month:{description:" change month to ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_month(e,t,n,r,i)}},change_years:{description:" change years to ",section:"Other Operators",ret_btype:"date",arg_btype:"number",fn(e,t,n,r,i){return f().bv().date_code.change_years(e,t,n,r,i)}},extract_from_date:{ret_btype:"number",section:"Other Operators",field_names:{component_to_extract:{},...u.custom_tz_field_names},spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.property("component_to_extract");let n;if(t&&!t.is_empty()){n=" "+t.get_static()}else{n="..."}return":extract"+n},description_for_sliding_palette:"Extract from date",fields(e,t){return[{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:f().sets.get_set("Object")(r.extend({},g,{UNIX:"UNIX timestamp (ms)"}))},...u.custom_tz_fields(h(t),(e=>{const t=i.get_public_setting("bubble_version");const n=e.get_static_property("component_to_extract");return t>0&&n!=="UNIX"}),true)]},fn(e,t,n,r,i){return f().bv().date_code.extract_from_date(e,t,n,r,i)}},rounded_down:{ret_btype:"date",section:"Other Operators",field_names:r.extend({component_to_extract:{}},u.custom_tz_field_names),spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.property("component_to_extract");let n;if(t&&!t.is_empty()){n=" "+t.get_static()}else{n="..."}return":rounded down to"+n+" "},description_for_sliding_palette:"Rounded down to",fields(e,t){return[{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:f().sets.get_set("Object")(g)},...u.custom_tz_fields(h(t),{condition:d})]},fn(e,t,n,r,i){return m({date:e,properties:n,context:i})}},equals_rounded_down:{ret_btype:"sys.bool",section:"Other Operators",arg_btype:"date",field_names:r.extend({component_to_extract:{}},u.custom_tz_field_names),spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.property("component_to_extract");let n;if(t&&!t.is_empty()){n=" "+t.get_static()}else{n="..."}return`equals rounded down to ${n} `},description_for_sliding_palette:"Equals rounded down to",fields(e,t){return[{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:f().sets.get_set("Object")(g)},...u.custom_tz_fields(h(t),{condition:d})]},fn(e,t,n,r,i){e=m({date:e,properties:n,context:i});t=m({date:t,properties:n,context:i});return v(e,t)}},is_empty:{description:" is empty",section:"Other Operators",ret_btype:"sys.bool",build_pg_constraint:s.is_empty,fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",section:"Other Operators",ret_btype:"sys.bool",build_pg_constraint:s.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}},format_json_encode:l("date")},display(){return"date"},runmode_display(e,t){return r.format_date(c.mk_date(e),"mmm d, yyyy h:MM tt",null,f().current_timezone())},export_to_string(e,t){if(!t.date_formatting||t.date_formatting==="spreadsheet_compatible"){return r.format_date(c.mk_date(e),"mmm d, yyyy h:MM tt",null,f().current_timezone())}else if(t.date_formatting==="universal"){return c.mk_date(e)}else{return r.format_date(c.mk_date(e),t.date_formatting)}},equals(e,t){var n,r;return((n=c.mk_date(e))==null?void 0:n.valueOf())===((r=c.mk_date(t))==null?void 0:r.valueOf())},get_sample(){return new Date},cast(e){return c.mk_date(e)},from_human(e,t){if(e===""){return this.get_bubble_null()}return c.mk_date(e,f().current_timezone())},get_JS_object(e){var t,n;if(((t=(n=f()).api_version)==null?void 0:t.call(n))===1){return e}return c.mk_date(e)},JS_to_bubble(e){if(e==null){return this.get_bubble_null()}const t=this.cast(e);if(!t){a("date",e)}return t},convert_to_bubble_instance:c.mk_date,can_sort:true,storable:true,bindable:false})},{"../../../lang/timezone_override_settings":729,"../../../u":823,"../../../u/shared/b_date":836,"../../../u/shared/mode_check":851,"../../custom_tz_utilities":380,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203,"./../../../db/postgres_constraints":459,"./../../../lang/appquery":651,"./../../../lib":741,"core-js/modules/web.dom-collections.iterator.js":1123}],180:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const{create_range_btype_messages:i,get_array_from_range:s,create_range_btype_messages_reorg:o}=e("../utilities/range_utilities");const{build_simple:a}=e("../utilities/generate_utilities");const{generate_JS_to_bubble_error:l}=e("../utilities/misc_utilities");const c=e("./../../../lib");const u=e("../../../u/shared/b_date");function d(e){var t;return(t=u.mk_date(e))==null?void 0:t.getTime()}function p(e){return r.format_date(e,"mmm d, yyyy h:MM tt",null,c().current_timezone())}t.exports=a("date_range",{messages:i("date",d,u.mk_date),messages_reorganized:o("date",d,u.mk_date),display(){return"date range"},runmode_display:null,export_to_string(e){const[t,n]=this.cast(e);return JSON.stringify([p(t),p(n)])},debugging_display(e){const[t,n]=this.cast(e);return"("+p(t)+" -> "+p(n)+")"},equals(e,t){var n,r,i,o;e=s(e);t=s(t);const a=d(u.mk_date((n=e)==null?void 0:n[0]));const l=d(u.mk_date((r=e)==null?void 0:r[1]));const c=d(u.mk_date((i=t)==null?void 0:i[0]));const p=d(u.mk_date((o=t)==null?void 0:o[1]));const _=[a,l].sort();const f=[c,p].sort();return(_==null?void 0:_[0])===(f==null?void 0:f[0])&&(_==null?void 0:_[1])===(f==null?void 0:f[1])},get_sample(){const e=new Date;const t=(new Date).setDate(e.getDate()-2);return[e,t]},get_bubble_null(){return[]},cast(e){if(!e){return this.get_bubble_null()}e=s(e);const t=d(u.mk_date(e[0]));const n=d(u.mk_date(e[1]));if(t==null||n==null){return this.get_bubble_null()}return[u.mk_date(Math.min(t,n)),u.mk_date(Math.max(t,n))]},get_JS_object(e){var t,n;if(!e){return null}if(((t=(n=c()).api_version)==null?void 0:t.call(n))===1){return s(e)}return this.cast(e)},JS_to_bubble(e){if(e==null){return this.get_bubble_null()}if(!Array.isArray(e)||u.mk_date(e[0])==null||u.mk_date(e[1])==null){l("date range",e)}return this.cast(e)},storable:true,bindable:false})},{"../../../u":823,"../../../u/shared/b_date":836,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203,"../utilities/range_utilities":205,"./../../../lib":741,"core-js/modules/web.dom-collections.iterator.js":1123}],181:[function(e,t,n){"use strict";const r=e("../../../u");const{build_simple:i}=e("../utilities/generate_utilities");const{generate_JS_to_bubble_error:s}=e("../utilities/misc_utilities");const o=e("../../../u/shared/b_number");t.exports=i("dateinterval",{messages:{to_days:{description:":format as days",ret_btype:"number",arg_btype:null,fn(e,t){return r.format_date_interval(e,"days")}},to_hours:{description:":format as hours",ret_btype:"number",arg_btype:null,fn(e,t){return r.format_date_interval(e,"hours")}},to_minutes:{description:":format as minutes",ret_btype:"number",arg_btype:null,fn(e,t){return r.format_date_interval(e,"minutes")}},to_seconds:{description:":format as seconds",ret_btype:"number",arg_btype:null,fn(e,t){return r.format_date_interval(e,"seconds")}}},messages_reorganized:{to_days:{description:"formatted as days",ret_btype:"number",section:"Other Operators",arg_btype:null,fn(e,t){return r.format_date_interval(e,"days")}},to_hours:{description:"formatted as hours",ret_btype:"number",section:"Other Operators",arg_btype:null,fn(e,t){return r.format_date_interval(e,"hours")}},to_minutes:{description:"formatted as minutes",ret_btype:"number",section:"Other Operators",arg_btype:null,fn(e,t){return r.format_date_interval(e,"minutes")}},to_seconds:{description:"formatted as seconds",ret_btype:"number",section:"Other Operators",arg_btype:null,fn(e,t){return r.format_date_interval(e,"seconds")}}},display(){return"date interval"},runmode_display:null,export_to_string(e){return r.print_date_interval(e)},debugging_display(e){return r.print_date_interval(e)},equals:o.num_equals,get_sample(){return 252e8},cast(e){return r.to_num(e)},get_JS_object(e){return this.cast(e)},JS_to_bubble(e){if(e==null){return this.get_bubble_null()}if(typeof e!=="number"){s("date interval",e)}return e},storable:true,bindable:false})},{"../../../u":823,"../../../u/shared/b_number":838,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203}],182:[function(e,t,n){"use strict";const{build_simple:r}=e("../utilities/generate_utilities");const{get_file_messages:i,get_file_messages_reorg:s,generate_JS_to_bubble_error:o}=e("../utilities/misc_utilities");const{COMPOSER_INPUT_TYPES:a}=e("../../../constants/composer");const l=e("../../../u/shared/b_string");t.exports=r("file",{messages:i("file"),messages_reorganized:s("file"),display(){return"file"},equals(e,t){return e===t},get_sample(){return"file_name.png"},get_bubble_null(){return""},cast:l.cast_to_string,runmode_display:l.cast_to_string,get_JS_object(e){if(!e){return null}return l.cast_to_string(e)},JS_to_bubble(e){if(!e){return this.get_bubble_null()}if(typeof e!=="string"){o("file url as a string",e)}return e},convert_to_bubble_instance:l.cast_to_string,composer_input_type:a.TEXT,synonyms:["text","image"],storable:true,bindable:false,can_sort:true})},{"../../../constants/composer":54,"../../../u/shared/b_string":841,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203}],183:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=e("../../../u");const i=e("../../../u/shared/mode_check");const s=e("../../../constants/geolocation");const{build_simple:o}=e("../utilities/generate_utilities");const{generate_JS_to_bubble_error:a}=e("../utilities/misc_utilities");const l=e("./../../../lib");const c=e("./../../../geolocation/b_location");const u=e("./../../../geolocation/shared/b_location_utils");const d=e("./../../../geolocation/location_lookups");const{COMPOSER_INPUT_TYPES:p}=e("../../../constants/composer");const _=null;function f(e){e=c.ensure_valid_location(e);if(!e){return _}return c.get_address(e)}function h(e){e=c.ensure_valid_location(e);if(!e){return _}return e.lat}function m(e){e=c.ensure_valid_location(e);if(!e){return _}return e.lng}t.exports=o("geographic_address",{display(){return"geographic address"},equals(e,t){return e===t||c.is_equal(e,t)},get_bubble_null(){return _},messages:{formatted_address:{description:"'s formatted address",ret_btype:"text",fn:f},google_map_link:{description:"'s link to Google Maps",ret_btype:"text",fn(e,t){e=c.ensure_valid_location(e);if(!e){return _}const n="https://www.google.com/maps/place";if(e.placeId!=null){return`${n}/?q=place_id:${e.placeId}`}const r=`${e.lat},${e.lng}`;if(e.address!=null){const t=e.address.split(" ").join("+").replace(",","");return`${n}/${t}/@${r},15z`}else{return`${n}/${r}`}}},distance_from:{ret_btype:"number",arg_btype:null,field_names:{origin_address:{},unit:{default:"miles"}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.property("origin_address");if(n&&!n.is_empty()){t=" "+n.get_tree_display()}else{t="..."}return" distance from"+t},description_for_sliding_palette:"Distance to an address",fields(){return[{name:"origin_address",caption:"Origin address",editor:"Basic",value:"geographic_address"},{name:"unit",caption:"Unit",editor:"Dropdown",set:l().sets.get_set("Object")({kms:"kms",miles:"miles"})}]},fn(e,t,n){e=c.ensure_valid_location(e);if(!e){return _}n.origin_address=c.ensure_valid_location(n.origin_address);if(!n.origin_address){return _}const r={lat:n.origin_address.lat,lng:n.origin_address.lng};const i={lat:e.lat,lng:e.lng};if(!e||!n.origin_address){return _}return u.geographic_distance(i,r,n.unit)}},is_empty:{description:" is empty",ret_btype:"sys.bool",fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",ret_btype:"sys.bool",fn(e,t){return e!==undefined&&e!==null&&e!==""}},extract_from_address:{ret_btype:"text",arg_btype:null,field_names:{component_to_extract:{}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.property("component_to_extract");if(n&&!n.is_empty()){t=" "+n.get_static()}else{t="..."}return":extract"+t},description_for_sliding_palette:"Extract from address",fields(){return[{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:l().sets.get_set("List")(Object.keys(u.google_fields))}]},fn(e,t,n){var r;e=c.ensure_valid_location(e);if(!e){return _}const i=c.get_components(e);return(r=i==null?void 0:i[n.component_to_extract])!=null?r:""}},equals:{description:" is ",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return c.is_equal(e,t)}},not_equals:{description:" is not ",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return!c.is_equal(e,t)}},latitude:{description:"'s latitude",ret_btype:"number",fn:h},longitude:{description:"'s longitude",ret_btype:"number",fn:m},timezone:{description:"'s time zone ID",ret_btype:"text",fn(e,t){var n;if(!e){return _}return((n=d.get_timezone_for_location(e))==null?void 0:n.timeZoneId)||""}},timezone_name:{description:"'s time zone name",ret_btype:"text",fn(e,t){var n;e=c.ensure_valid_location(e);if(!e){return _}return((n=d.get_timezone_for_location(e))==null?void 0:n.timeZoneName)||""}},daysaving_offset:{description:"'s daylight saving time offset",ret_btype:"number",fn(e,t){var n;e=c.ensure_valid_location(e);if(!e){return _}return(n=d.get_timezone_for_location(e))==null?void 0:n.dstOffset}},raw_offset:{description:"'s offset from UTC",ret_btype:"number",fn(e,t){var n;e=c.ensure_valid_location(e);if(!e){return _}const r=(n=d.get_timezone_for_location(e))==null?void 0:n.rawOffset;if(!r){return _}return r/60}}},messages_reorganized:{formatted_address:{description:"'s formatted address",section:"Operators",ret_btype:"text",fn:f},google_map_link:{description:"'s link to Google Maps",section:"Operators",ret_btype:"text",fn(e,t){e=c.ensure_valid_location(e);if(!e){return _}const n="https://www.google.com/maps/place";if(e.placeId!=null){return`${n}/?q=place_id:${e.placeId}`}const r=`${e.lat},${e.lng}`;if(e.address!=null){const t=e.address.split(" ").join("+").replace(",","");return`${n}/${t}/@${r},15z`}else{return`${n}/${r}`}}},distance_from:{ret_btype:"number",section:"Operators",arg_btype:null,field_names:{origin_address:{},unit:{default:"miles"}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.property("origin_address");if(n&&!n.is_empty()){t=" "+n.get_tree_display()}else{t="..."}return" distance from"+t},description_for_sliding_palette:"Distance to an address",fields(){return[{name:"origin_address",caption:"Origin address",editor:"Basic",value:"geographic_address"},{name:"unit",caption:"Unit",editor:"Dropdown",set:l().sets.get_set("Object")({kms:"kms",miles:"miles"})}]},fn(e,t,n){e=c.ensure_valid_location(e);if(!e){return _}n.origin_address=c.ensure_valid_location(n.origin_address);if(!n.origin_address){return _}const r={lat:n.origin_address.lat,lng:n.origin_address.lng};const i={lat:e.lat,lng:e.lng};if(!e||!n.origin_address){return _}return u.geographic_distance(i,r,n.unit)}},equals:{description:" is ",section:"Operators",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return c.is_equal(e,t)}},not_equals:{description:" is not ",section:"Operators",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return!c.is_equal(e,t)}},extract_from_address:{ret_btype:"text",section:"Other Operators",arg_btype:null,field_names:{component_to_extract:{}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.property("component_to_extract");if(n&&!n.is_empty()){t=" "+n.get_static()}else{t="..."}return":extract"+t},description_for_sliding_palette:"Extract from address",fields(){return[{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:l().sets.get_set("List")(Object.keys(u.google_fields))}]},fn(e,t,n){var r;e=c.ensure_valid_location(e);if(!e){return _}const i=c.get_components(e);return(r=i==null?void 0:i[n.component_to_extract])!=null?r:""}},latitude:{description:"'s latitude",section:"Other Operators",ret_btype:"number",fn:h},longitude:{description:"'s longitude",section:"Other Operators",ret_btype:"number",fn:m},timezone:{description:"'s time zone ID",section:"Other Operators",ret_btype:"text",fn(e,t){var n;if(!e){return _}return((n=d.get_timezone_for_location(e))==null?void 0:n.timeZoneId)||""}},timezone_name:{description:"'s time zone name",section:"Other Operators",ret_btype:"text",fn(e,t){var n;e=c.ensure_valid_location(e);if(!e){return _}return((n=d.get_timezone_for_location(e))==null?void 0:n.timeZoneName)||""}},daysaving_offset:{description:"'s daylight saving time offset",section:"Other Operators",ret_btype:"number",fn(e,t){var n;e=c.ensure_valid_location(e);if(!e){return _}return(n=d.get_timezone_for_location(e))==null?void 0:n.dstOffset}},raw_offset:{description:"'s offset from UTC",section:"Other Operators",ret_btype:"number",fn(e,t){var n;e=c.ensure_valid_location(e);if(!e){return _}const r=(n=d.get_timezone_for_location(e))==null?void 0:n.rawOffset;if(!r){return _}return r/60}},is_empty:{description:" is empty",section:"Other Operators",ret_btype:"sys.bool",fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",section:"Other Operators",ret_btype:"sys.bool",fn(e,t){return e!==undefined&&e!==null&&e!==""}}},cast(e){var t;if(((t=e)==null?void 0:t.raw)!=null){e=e.raw()}if(typeof e==="function"){e=e()}return c.from_address(e)},runmode_display(e){if(!e){return""}else{var t;if(((t=e)==null?void 0:t.raw)!=null){e=e.raw()}return c.get_address(e)}},get_JS_object(e){var t,n;if(!e){return null}if(((t=(n=l()).api_version)==null?void 0:t.call(n))===1){return c.convert_to_old_format(e)}return{address:f(e),lat:h(e),lng:m(e)}},JS_to_bubble(e){if(e==null){return this.get_bubble_null()}let t;if(typeof e==="string"){t=()=>c.from_address(e)}else if(typeof e==="object"){if(typeof e.address==="string"){t=()=>c.from_address(e.address)}else if(typeof e.lat==="number"&&typeof e.lng==="number"){if(r.to_num(e.lat)==null||r.to_num(e.lng)==null){return this.get_bubble_nul()}t=()=>c.from_address({lat:e.lat,lng:e.lng})}else if(e.lat==null||e.lng==null){return this.get_bubble_null()}}if(t!=null){if(i.on_server()){return t()}else{return t}}return a("geographic address as either a string or an object with lat and lng",e)},get_sample(){return s.SAMPLE_VALUE},synonyms:["text"],composer_input_type:p.GEOGRAPHIC_ADDRESS,can_sort:false,storable:true,bindable:false})},{"../../../constants/composer":54,"../../../constants/geolocation":69,"../../../u":823,"../../../u/shared/mode_check":851,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203,"./../../../geolocation/b_location":621,"./../../../geolocation/location_lookups":625,"./../../../geolocation/shared/b_location_utils":626,"./../../../lib":741,"core-js/modules/es.string.replace.js":1121}],184:[function(e,t,n){"use strict";const r=e("../../../u");const{build_simple:i}=e("../utilities/generate_utilities");const{get_file_messages:s,get_file_messages_reorg:o,generate_JS_to_bubble_error:a}=e("../utilities/misc_utilities");const l=e("../../../u/shared/b_string");const c=e("./../../../lib");const u=e("./../../../imgix");const{COMPOSER_INPUT_TYPES:d}=e("../../../constants/composer");t.exports=i("image",{messages:r.extend({},s("image"),{imgix_treatment:{ret_btype:"image",section:"Other Operators",arg_btype:null,field_names:{auto_enhance:{},q:{default:75,optional:true},fm:{optional:true},extract_face:{default:false},facepad:{default:false},crop_to_fit:{default:false},red_eye:{default:false},blur:{default:false},blur_level:{default:100},mask:{default:false},pixel:{default:false},pixel_level:{default:10},sepia:{default:false},sepia_level:{default:50},mono:{default:false},mono_level:{default:"#3498db"}},spot_data:"SlidableAtom",description(e){return":processed with Imgix"},description_for_sliding_palette:"Imgix processing",fields(){return[{name:"information",editor:"Label",label_text:"Note that Imgix options are only applied to images hosted on your application's storage."},{name:"auto_enhance",caption:"Auto enhance the image",editor:"Checkbox"},{name:"q",caption:"Quality (0 - 100)",editor:"Dropdown",numerical_step:25,set:c().sets.get_set("Numeric")([0,25,50,75,100])},{name:"fm",caption:"File format",editor:"Dropdown",set:c().sets.get_set("List")(["png","png8","png32","jpg","pjpg"])},{name:"extract_face",caption:"Auto crop around the face",editor:"Checkbox"},{name:"facepad",caption:"Padding around face",editor:"Dropdown",optional:true,default:1,numerical_step:.1,set:c().sets.get_set("Numeric")([1,2,3,5,8]),condition:"extract_face"},{name:"crop_to_fit",caption:"Resize to fit the dimensions by cropping",editor:"Checkbox",condition:"extract_face is false"},{name:"mask",caption:"Apply a circle/ellipse mask",editor:"Checkbox"},{name:"red_eye",caption:"Remove red eyes",editor:"Checkbox"},{name:"blur",caption:"Apply some blur",editor:"Checkbox"},{name:"blur_level",caption:"Blur level",condition:"blur",editor:"Dropdown",numerical_step:100,set:c().sets.get_set("Numeric")([0,100,500,1e3,1500,2e3])},{name:"pixel",caption:"Apply some pixellation",editor:"Checkbox"},{name:"pixel_level",caption:"Pixellation level",condition:"pixel",editor:"Dropdown",numerical_step:10,set:c().sets.get_set("Numeric")([0,20,40,60,80,100])},{name:"sepia",caption:"Apply some sepia effect",editor:"Checkbox"},{name:"sepia_level",caption:"Sepia level",condition:"sepia",editor:"Dropdown",numerical_step:10,set:c().sets.get_set("Numeric")([0,20,40,60,80,100])},{name:"mono",caption:"Applies an overall monochromatic hue change",editor:"Checkbox"},{name:"mono_level",caption:"Monochromatic color",condition:"mono",editor:"Color"}]},fn(e,t,n){if(!e||typeof e!=="string"){return this.ret_btype_null()}if(u.ignore_imgix_fn(e)){return e}return u.add_processing_options(e,n)}}}),messages_reorganized:{...o("file"),imgix_treatment:{ret_btype:"image",arg_btype:null,field_names:{auto_enhance:{},q:{default:75,optional:true},fm:{optional:true},extract_face:{default:false},facepad:{default:false},crop_to_fit:{default:false},red_eye:{default:false},blur:{default:false},blur_level:{default:100},mask:{default:false},pixel:{default:false},pixel_level:{default:10},sepia:{default:false},sepia_level:{default:50},mono:{default:false},mono_level:{default:"#3498db"}},spot_data:"SlidableAtom",description(e){return":processed with Imgix"},description_for_sliding_palette:"Imgix processing",fields(){return[{name:"information",editor:"Label",label_text:"Note that Imgix options are only applied to images hosted on your application's storage."},{name:"auto_enhance",caption:"Auto enhance the image",editor:"Checkbox"},{name:"q",caption:"Quality (0 - 100)",editor:"Dropdown",numerical_step:25,set:c().sets.get_set("Numeric")([0,25,50,75,100])},{name:"fm",caption:"File format",editor:"Dropdown",set:c().sets.get_set("List")(["png","png8","png32","jpg","pjpg"])},{name:"extract_face",caption:"Auto crop around the face",editor:"Checkbox"},{name:"facepad",caption:"Padding around face",editor:"Dropdown",optional:true,default:1,numerical_step:.1,set:c().sets.get_set("Numeric")([1,2,3,5,8]),condition:"extract_face"},{name:"crop_to_fit",caption:"Resize to fit the dimensions by cropping",editor:"Checkbox",condition:"extract_face is false"},{name:"mask",caption:"Apply a circle/ellipse mask",editor:"Checkbox"},{name:"red_eye",caption:"Remove red eyes",editor:"Checkbox"},{name:"blur",caption:"Apply some blur",editor:"Checkbox"},{name:"blur_level",caption:"Blur level",condition:"blur",editor:"Dropdown",numerical_step:100,set:c().sets.get_set("Numeric")([0,100,500,1e3,1500,2e3])},{name:"pixel",caption:"Apply some pixellation",editor:"Checkbox"},{name:"pixel_level",caption:"Pixellation level",condition:"pixel",editor:"Dropdown",numerical_step:10,set:c().sets.get_set("Numeric")([0,20,40,60,80,100])},{name:"sepia",caption:"Apply some sepia effect",editor:"Checkbox"},{name:"sepia_level",caption:"Sepia level",condition:"sepia",editor:"Dropdown",numerical_step:10,set:c().sets.get_set("Numeric")([0,20,40,60,80,100])},{name:"mono",caption:"Applies an overall monochromatic hue change",editor:"Checkbox"},{name:"mono_level",caption:"Monochromatic color",condition:"mono",editor:"Color"}]},fn(e,t,n){if(!e||typeof e!=="string"){return this.ret_btype_null()}if(u.ignore_imgix_fn(e)){return e}return u.add_processing_options(e,n)}}},display(){return"image"},equals(e,t){return e===t},get_sample(){return"image_name.png"},get_bubble_null(){return""},cast:l.cast_to_string,runmode_display:l.cast_to_string,export_to_string(e,t){if(!t.always_return_text&&e){return r.img("img-preview",undefined,t.optimize_image(e,30,30))}else{return l.cast_to_string(e)}},get_JS_object(e){if(!e){return null}return l.cast_to_string(e)},JS_to_bubble(e){if(e==null){return this.get_bubble_null()}if(typeof e!=="string"){a("image url as a string",e)}return e},convert_to_bubble_instance:l.cast_to_string,composer_input_type:d.TEXT,synonyms:["text"],storable:true,bindable:false})},{"../../../constants/composer":54,"../../../u":823,"../../../u/shared/b_string":841,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203,"./../../../imgix":628,"./../../../lib":741}],185:[function(e,t,n){"use strict";const{build_simple:r}=e("../utilities/generate_utilities");const i=e("../../../u/shared/b_string");const{COMPOSER_INPUT_TYPES:s}=e("../../../constants/composer");t.exports=r("key_combination",{messages:{equals:{description:" is ",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return e===t}}},display(){return"keyboard shortcut"},equals(e,t){return e===t},cast:i.cast_to_string,runmode_display:i.cast_to_string,get_sample(){return"Shift"},composer_input_type:s.KEY_COMBINATION,synonyms:["text"]})},{"../../../constants/composer":54,"../../../u/shared/b_string":841,"../utilities/generate_utilities":201}],186:[function(e,t,n){"use strict";const{build_simple:r}=e("../utilities/generate_utilities");t.exports=r("null",{messages:{},messages_reorganized:{},runmode_display:null,export_to_string(e){return""},debugging_display(e){return"(null)"},get_sample(){return null},equals(e,t){return e!=null===(t!=null)},cast(e){return e},display(){return""},get_JS_object(e){return null},JS_to_bubble(e){return null},storable:false,bindable:false,convert_to_bubble_instance(){return null}})},{"../utilities/generate_utilities":201}],187:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=e("../../../u");const i=e("../../../constants/currency");const s=e("./../../../db/postgres_constraints");const o=e("../../../lib");const{format_number_names:a,format_number_fields:l,thousand_separators:c,decimal_separators:u}=e("../utilities/numeric_format_utilities");const{build_simple:d}=e("../utilities/generate_utilities");const{generate_JS_to_bubble_error:p}=e("../utilities/misc_utilities");const _=e("../../../u/shared/b_number");const{COMPOSER_INPUT_TYPES:f}=e("../../../constants/composer");const h=e("../../../lang/evaluation/node_eval");const m=30;const g=-30;const v=1e30;function b(e,t){const n=Math.min(v,Math.max(-v,e));const r=Math.min(m,Math.max(g,t));return Math.round(n*Math.pow(10,r))/Math.pow(10,r)}t.exports=d("number",{messages:{format_number:{ret_btype:"text",fn(e,t,n){e=r.to_num(e);if(e==null){return this.ret_btype_null()}const s=e=>n[e];if(s("formatting_type")==="percentage"){e=e*100}const o=s("negative_parenthese")&&e<0;const a=o?Math.abs(e):e;let l=s("decimal_place");let d;if(l!=null){const e=0;const t=100;l=Math.max(Math.min(l,t),e);d=a.toFixed(l)}else{d=r.dec_to_string(a)}const p=u[s("decimal_separator")];d=d.replace(".",p);if(s("thousand_separator")){let e=c[s("thousand_separator")];if(e==="Space"){e=" "}const t=d.split(p);t[0]=r.add_thousand_sep(t[0],e);d=t.join(p)}if(s("formatting_type")==="percentage"){d=d+"%"}if(o){d="("+d+")"}const _=s("formatting_type")==="currency"&&s("currency_symbol");if(_){let t=s("currency_symbol");const n=i.legacy_currency_symbols[t];if(n){t=n}if(e<0&&!o){d="-"+t+d.replace("-","")}else{d=t+d}}return d},spot_data:"SlidableAtom",description(e){let t;const n=h.evaluate_properties(e);if(n){t=" "+this.fn("1028.58",undefined,n)}else{t="..."}return":formatted as"+t},description_for_sliding_palette:"Number Formatting",fields(){return l()},field_names:a},equals:{description:" is ",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return _.num_equals(e,t)},build_pg_constraint:s.equals,build_pg_r_constraint:s.equals,build_pg_relationship:s.equals_both},not_equals:{description:" is not ",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return!_.num_equals(e,t)},build_pg_constraint:s.not_equals,build_pg_r_constraint:s.not_equals,build_pg_relationship:s.not_equals_both},greater_than:{description:" > ",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return!_.num_equals(e,t)&&r.to_num(e)>r.to_num(t)}},greater_or_equal_than:{description:"  ",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return _.num_equals(e,t)||r.to_num(e)>=r.to_num(t)}},less_than:{description:" < ",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return!_.num_equals(e,t)&&r.to_num(e)<r.to_num(t)}},less_or_equal_than:{description:"  ",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return _.num_equals(e,t)||r.to_num(e)<=r.to_num(t)}},plus:{description:" + ",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)+r.to_num(t))}},minus:{description:" - ",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)-r.to_num(t))}},times:{description:" * ",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)*r.to_num(t))}},divide:{description:" / ",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)/r.to_num(t))}},round:{description:":rounded to ",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(b(r.to_num(e),r.to_num(t)))},editor:{static:true,default:1}},floor:{description:":floor ",ret_btype:"number",fn(e,t){return Math.floor(r.to_num(e))}},ceil:{description:":ceiling ",ret_btype:"number",fn(e,t){return Math.ceil(r.to_num(e))}},power:{description:" ^ ",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(Math.pow(r.to_num(e),r.to_num(t)))}},to_range:{description:"<- range ->",arg_btype:"number",ret_btype:"number_range",fn(e,t){e=r.to_num(e);t=r.to_num(t);if(e==null||t==null){return[]}return[Math.min(e,t),Math.max(e,t)]}},max:{description:" <- max -> ",ret_btype:"number",arg_btype:"number",fn(e,t){return Math.max(r.to_num(e),r.to_num(t))}},min:{description:" <- min -> ",ret_btype:"number",arg_btype:"number",fn(e,t){return Math.min(r.to_num(e),r.to_num(t))}},modulo:{description:" <- modulo -> ",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)%r.to_num(t))}},is_empty:{description:" is empty",ret_btype:"sys.bool",build_pg_constraint:s.is_empty,fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",ret_btype:"sys.bool",build_pg_constraint:s.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}}},messages_reorganized:{format_number:{ret_btype:"text",fn(e,t,n){e=r.to_num(e);if(e==null){return this.ret_btype_null()}const s=e=>n[e];if(s("formatting_type")==="percentage"){e=e*100}const o=s("negative_parenthese")&&e<0;const a=o?Math.abs(e):e;let l=s("decimal_place");let d;if(l!=null){const e=0;const t=100;l=Math.max(Math.min(l,t),e);d=a.toFixed(l)}else{d=r.dec_to_string(a)}const p=u[s("decimal_separator")];d=d.replace(".",p);if(s("thousand_separator")){let e=c[s("thousand_separator")];if(e==="Space"){e=" "}const t=d.split(p);t[0]=r.add_thousand_sep(t[0],e);d=t.join(p)}if(s("formatting_type")==="percentage"){d=d+"%"}if(o){d="("+d+")"}const _=s("formatting_type")==="currency"&&s("currency_symbol");if(_){let t=s("currency_symbol");const n=i.legacy_currency_symbols[t];if(n){t=n}if(e<0&&!o){d="-"+t+d.replace("-","")}else{d=t+d}}return d},spot_data:"SlidableAtom",description(e){let t;const n=h.evaluate_properties(e);if(n){t=" "+this.fn("1028.58",undefined,n)}else{t="..."}return":formatted as"+t},section:"Operators",description_for_sliding_palette:"Number Formatting",fields(){return l()},field_names:a},equals:{description:" is ",section:"Operators",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return _.num_equals(e,t)},build_pg_constraint:s.equals,build_pg_r_constraint:s.equals,build_pg_relationship:s.equals_both},not_equals:{description:" is not ",section:"Operators",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return!_.num_equals(e,t)},build_pg_constraint:s.not_equals,build_pg_r_constraint:s.not_equals,build_pg_relationship:s.not_equals_both},greater_than:{description:" > ",section:"Operators",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return!_.num_equals(e,t)&&r.to_num(e)>r.to_num(t)}},greater_or_equal_than:{section:"Operators",description:"  ",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return _.num_equals(e,t)||r.to_num(e)>=r.to_num(t)}},less_than:{section:"Operators",description:" < ",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return!_.num_equals(e,t)&&r.to_num(e)<r.to_num(t)}},less_or_equal_than:{section:"Operators",description:"  ",ret_btype:"sys.bool",arg_btype:"number",fn(e,t){return _.num_equals(e,t)||r.to_num(e)<=r.to_num(t)}},plus:{description:" + ",section:"Operators",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)+r.to_num(t))}},minus:{description:" - ",section:"Operators",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)-r.to_num(t))}},times:{description:" * ",section:"Operators",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)*r.to_num(t))}},divide:{description:" / ",section:"Operators",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)/r.to_num(t))}},power:{description:" ^ ",section:"Operators",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(Math.pow(r.to_num(e),r.to_num(t)))}},round:{description:"rounded to ",section:"Operators",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(b(r.to_num(e),r.to_num(t)))},editor:{static:true,default:1}},floor:{description:":floor ",section:"Operators",ret_btype:"number",fn(e,t){return Math.floor(r.to_num(e))}},ceil:{description:":ceiling ",section:"Operators",ret_btype:"number",fn(e,t){return Math.ceil(r.to_num(e))}},to_range:{description:"<- range ->",section:"Other Operators",arg_btype:"number",ret_btype:"number_range",fn(e,t){e=r.to_num(e);t=r.to_num(t);if(e==null||t==null){return[]}return[Math.min(e,t),Math.max(e,t)]}},max:{description:" <- max -> ",section:"Other Operators",ret_btype:"number",arg_btype:"number",fn(e,t){return Math.max(r.to_num(e),r.to_num(t))}},min:{description:" <- min -> ",section:"Other Operators",ret_btype:"number",arg_btype:"number",fn(e,t){return Math.min(r.to_num(e),r.to_num(t))}},modulo:{description:" <- modulo -> ",section:"Other Operators",ret_btype:"number",arg_btype:"number",fn(e,t){return r.to_num(r.to_num(e)%r.to_num(t))}},is_empty:{description:" is empty",section:"Other Operators",ret_btype:"sys.bool",build_pg_constraint:s.is_empty,fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",section:"Other Operators",ret_btype:"sys.bool",build_pg_constraint:s.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}}},composer_input_type:f.NUMBER,display(){return"number"},runmode_display(e){e=r.to_num(e);if(e===null){return""}else{return o().locale().format_decimal(e)}},export_to_string(e,t){if(t.preserve_numbers){return e}e=r.to_num(e);if(e===null){return""}else{return o().locale().format_decimal(e)}},equals:_.num_equals,get_sample(){return 42},cast(e){return r.to_num(e)},get_JS_object(e){return r.to_num(e)},JS_to_bubble(e){if(e==null){return this.get_bubble_null()}const t=r.to_num(e);if(typeof t!=="number"){p("number",e)}return t},convert_to_bubble_instance:r.to_num,can_sort:true,storable:true,bindable:false})},{"../../../constants/composer":54,"../../../constants/currency":56,"../../../lang/evaluation/node_eval":697,"../../../lib":741,"../../../u":823,"../../../u/shared/b_number":838,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203,"../utilities/numeric_format_utilities":204,"./../../../db/postgres_constraints":459,"core-js/modules/es.string.replace.js":1121}],188:[function(e,t,n){"use strict";const r=e("../../../u");const{build_simple:i}=e("../utilities/generate_utilities");const{generate_JS_to_bubble_error:s}=e("../utilities/misc_utilities");const{create_range_btype_messages:o,get_array_from_range:a,create_range_btype_messages_reorg:l}=e("../utilities/range_utilities");t.exports=i("number_range",{messages:o("number",r.to_num,(e=>e)),messages_reorganized:l("number",r.to_num,(e=>e)),display(){return"numeric range"},runmode_display:null,export_to_string(e){return JSON.stringify(this.cast(e))},debugging_display(e){return JSON.stringify(this.cast(e))},equals(e,t){var n,r,i,s;e=a(e);t=a(t);const o=(n=e)==null?void 0:(r=n.sort)==null?void 0:r.call(n);const l=(i=t)==null?void 0:(s=i.sort)==null?void 0:s.call(i);return(o==null?void 0:o[0])===(l==null?void 0:l[0])&&(o==null?void 0:o[1])===(l==null?void 0:l[1])},get_sample(){return[1,30]},get_bubble_null(){return[]},cast(e){if(!e){return this.get_bubble_null()}e=a(e);const t=r.to_num(e[0]);const n=r.to_num(e[1]);if(t==null||n==null){return this.get_bubble_null()}return[Math.min(t,n),Math.max(t,n)]},get_JS_object(e){if(!e){return null}return this.cast(e)},JS_to_bubble(e){if(!e){return this.get_bubble_null()}if(!Array.isArray(e)||typeof e[0]!=="number"||typeof e[1]!=="number"){s("number range",e)}return this.cast(e)},storable:true,bindable:false})},{"../../../u":823,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203,"../utilities/range_utilities":205}],189:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=e("../../../u");const i=e("../../../lib");const s=e("../../../lang/btypes");const o=e("../../../lang/btype_ids");const a=e("../../../u/shared/mode_check");const l=e("../../input_mask");const c=e("../../../db/postgres_constraints");const{build_simple:u}=e("../utilities/generate_utilities");const{generate_JS_to_bubble_error:d,get_json_encode_msg:p}=e("../utilities/misc_utilities");const _=e("../../../u/shared/b_string");let f,h;if(a.on_server()){const t=e;f=t("crypto");h=t("../../../server/utility/safe_regex")}const{COMPOSER_INPUT_TYPES:m}=e("../../../constants/composer");t.exports=u("text",{messages:{equals:{description:" is ",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return e===t},build_pg_constraint:c.equals,build_pg_r_constraint:c.equals,build_pg_relationship:c.equals_both},not_equals:{description:" is not ",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return e!==t},build_pg_constraint:c.not_equals,build_pg_r_constraint:c.not_equals,build_pg_relationship:c.not_equals_both},contains:{description:" contains ",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){var n,r;return(n=e==null?void 0:(r=e.includes)==null?void 0:r.call(e,t))!=null?n:false}},not_contains:{description:" doesn't contain ",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){var n,r;return(n=!(e!=null&&(r=e.includes)!=null&&r.call(e,t)))!=null?n:true}},is_empty:{description:" is empty",ret_btype:"sys.bool",build_pg_constraint:c.is_empty,fn(e){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",ret_btype:"sys.bool",build_pg_constraint:c.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}},to_capitalized_words:{description:":capitalized words",ret_btype:"text",fn(e){var t,n;return(t=(n=r.toTitleCase(e,true))==null?void 0:n.toString())!=null?t:this.ret_btype_null()}},to_uppercase:{description:":uppercase",ret_btype:"text",fn(e){var t,n;return(t=e==null?void 0:(n=e.toUpperCase)==null?void 0:n.call(e))!=null?t:this.ret_btype_null()}},to_lowercase:{description:":lowercase",ret_btype:"text",fn(e){var t,n;return(t=e==null?void 0:(n=e.toLowerCase)==null?void 0:n.call(e))!=null?t:this.ret_btype_null()}},append:{description:":append",ret_btype:"text",arg_btype:"text",fn(e,t){return[e,t].map((e=>_.cast_to_string(e))).join("")}},format_json_encode:p("text"),format_text:{ret_btype:"text",field_names:{formatting_type:{},replace_space:{default:true},hmac_key:{},encode_b64:{}},spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.get_static_property("formatting_type");let n;if(t!=null){switch(t){case"url_encode":n=" URL";break;case"md5_hash":n=" MD5 hash";break;case"hmac":n=" HMAC SHA256 digest";break;case"hmac_sha1":n=" HMAC SHA1 digest";break;default:n=" "+l.masks[t].caption}}else{n="..."}return":formatted as"+n},description_for_sliding_palette:"Text Formatting",fields(e){const t={us_phone:l.masks.us_phone.caption,url_encode:"URL Encoded",md5_hash:"MD5 Hash",hmac:"HMAC SHA256 Digest",hmac_sha1:"HMAC SHA1 Digest"};const n=e("formatting_type");return[{name:"formatting_type",caption:"Format type",editor:"Dropdown",set:i().sets.get_set("Object")(t)},{name:"replace_space",caption:"Replace spaces by +",editor:"Checkbox",condition:"formatting_type is url_encode"},{name:"hmac_key",caption:"HMAC Secret",editor:"ShortText",condition:()=>["hmac","hmac_sha1"].includes(n)},{name:"encode_b64",caption:"Base64-encode the result",editor:"Checkbox",condition:()=>["hmac","hmac_sha1"].includes(n)},{name:"information",label_text:"Note that this conversion will only happen server-side. The key will be kept secret if used in an API workflow, it is not safe if used in a regular workflow in a page.",editor:"Label",condition:()=>["hmac","hmac_sha1"].includes(n)}]},fn(e,t,n){const{formatting_type:i}=n;if(e==null){return this.ret_btype_null()}if(i==="us_phone"){let t;if(e.length===11){t=e[0];e=e.slice(1)}else{t=null}if(e.length===10){let n="("+e.slice(0,3)+") "+e.slice(3,6)+"-"+e.slice(6);if(t){n=t+" "+n}return n}else{return e}}else if(i==="us_ssn"){if(e.length===9){return e.slice(0,3)+"-"+e.slice(3,5)+"-"+e.slice(5)}else{return e}}else if(i==="url_encode"){if(n.replace_space){return encodeURIComponent(e.replace(/\s/g,"+"))}else{return encodeURIComponent(e)}}else if(i==="md5_hash"){return r.digest(e)}else if(["hmac","hmac_sha1"].includes(i)){let t;if(!a.on_server()){return"HMAC Digest computation on the client"}if(!n.hmac_key){return"HMAC Secret missing"}if(i==="hmac"){t="SHA256"}else{t="SHA1"}const r=f.createHmac(t,n.hmac_key).update(e);if(n.encode_b64){return r.digest("base64")}else{return r.digest("hex")}}else{return"unrecognized format type: "+i}}},use_text_as:{ret_btype(e){var t,n,r;(t=e)!=null?t:e={};return(n=(r=e["%p"])==null?void 0:r.data_type)!=null?n:"text"},field_names:{data_type:{}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.get_static_property("data_type");if(n!=null){switch(n){case"file":t=" a file";break;case"image":t=" an image";break;default:t=" [invalid type]"}}else{t="..."}return":used as"+t},description_for_sliding_palette:"Text URL used as",fields(){const e={file:"File",image:"Image"};return[{name:"data_type",caption:"Used as type",editor:"Dropdown",set:i().sets.get_set("Object")(e)}]},fn(e,t,n){var r,i;return(r=(i=s.get(n.data_type))==null?void 0:i.cast(e))!=null?r:e}},trimmed:{description:":trimmed",ret_btype:"text",arg_btype:null,fn(e,t){var n,r;return(n=e==null?void 0:(r=e.trim)==null?void 0:r.call(e))!=null?n:this.ret_btype_null()}},length:{description:":number of characters",ret_btype:"number",arg_btype:null,fn(e,t){if(!e){return 0}return e.length}},truncated:{description:":truncated to ",ret_btype:"text",arg_btype:"number",fn(e,t){if(typeof e!=="string"){return this.ret_btype_null()}if(!t){return e}else{return e.slice(0,r.to_num(t))}}},truncated_right:{description:":truncated from end to ",ret_btype:"text",arg_btype:"number",fn(e,t){if(typeof e!=="string"){return this.ret_btype_null()}if(!t){return e}else{let n=e.length-r.to_num(t);if(n<0){n=0}return e.slice(n)}}},extract_from_text:{ret_btype:"text",field_names:{text_type:{},component_to_extract:{}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.property("component_to_extract");if(n&&!n.is_empty()){t=" "+n.get_static()}else{t="..."}return":extract"+t},description_for_sliding_palette:"Extract from text",fields(e){const t=e("text_type");const n={email:["domain","top domain","alias"]};let r;if(t){r=n[t]}else{r=[]}return[{name:"text_type",caption:"Text type",editor:"Dropdown",set:i().sets.get_set("List")(["email"])},{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:i().sets.get_set("List")(r),condition(){return t}}]},fn(e,t,n){if(!e){return this.ret_btype_null()}switch(n.text_type){case"email":if(!r.is_email(e)){return this.ret_btype_null()}else{switch(n.component_to_extract){case"domain":return e.split("@")[1];case"alias":return e.split("@")[0];case"top domain":{const t=e.split("@")[1];const n=t.split(".");const{length:r}=n;return n[r-2]+"."+n[r-1]}}}break;default:return this.ret_btype_null()}}},convert_to_number:{description:":converted to number",ret_btype:"number",arg_btype:null,fn(e){var t;const n=r.remove_invalid_from_num(_.cast_to_string(e));const s=(t=i().browser_locale())!=null?t:i().locale();const o=s.parse_float(n);return r.to_num(o)}},split_by:{ret_btype:o.list_type("text"),field_names:{separator:{}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.property("separator").get_tree_display();if(!n){t="..."}else{if(n.length>5){t=` (${n.slice(0,5)})`}else{t=` (${n})`}}return":split by"+t},description_for_sliding_palette:"Split text into a list by",fields(e){return[{name:"separator",caption:"Text separator",editor:"LongText"}]},fn(e,t,n){if(!e||e.split==null){return i().db_instance().static_list("text",[])}const{separator:r}=n;if([undefined,null,""].includes(r)){return i().db_instance().static_list("text",e.split("\n"))}return i().db_instance().static_list("text",e.split(r))}},find_replace:{ret_btype:"text",field_names:{find:{},use_regex:{default:false},replace:{optional:true}},spot_data:"SlidableAtom",description:":find & replace",description_for_sliding_palette:"Find and Replace",fields(e){return[{name:"use_regex",caption:"Use a regex pattern",editor:"Checkbox"},{name:"find",caption:e("use_regex")?"Regex pattern":"Text to find",editor:"LongText"},{name:"replace",caption:"Replace by",editor:"LongText"}]},fn(e,t,n){var i;if(!e||e.split==null){return this.ret_btype_null()}const{find:s}=n;if([undefined,null,""].includes(s)){return e}const o=(i=n.replace)!=null?i:"";if(!n.use_regex){return e.split(s).join(o)}else{let t;try{t=new RegExp(s,"g")}catch(e){throw new r.OwnerError("Bad regex format",{display:"Bad Regex format: "+e.message})}if(a.on_server()){return h.replace({regex_string:s,string:e,replace_with:o})}return e.replace(t,o)}}},extract_regex:{ret_btype:o.list_type("text"),field_names:{regex:{}},spot_data:"SlidableAtom",description:":extract with Regex",description_for_sliding_palette:"Extract with Regex",fields(e){return[{name:"regex",caption:"Regex pattern",editor:"ShortText"}]},fn(e,t,n){if(!e||typeof e!=="string"||[undefined,null,""].includes(n.regex)){return i().db_instance().static_list("text",[])}let s;try{s=new RegExp(n.regex,"g")}catch(e){throw new r.OwnerError("Bad regex format",{display:"Bad Regex format: "+e.message})}const o=a.on_server()?h.match({regex_string:n.regex,string:e}):e.match(s);return i().db_instance().static_list("text",o)}},defaulting_to:{description:":defaulting to ",ret_btype:"text",arg_btype:"text",fn(e,t){if(e){return e}return t!=null?t:""}}},messages_reorganized:{equals:{description:" is ",section:"Operators",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return e===t},build_pg_constraint:c.equals,build_pg_r_constraint:c.equals,build_pg_relationship:c.equals_both},not_equals:{description:" is not ",section:"Operators",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return e!==t},build_pg_constraint:c.not_equals,build_pg_r_constraint:c.not_equals,build_pg_relationship:c.not_equals_both},contains:{description:" contains ",section:"Operators",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){var n,r;return(n=e==null?void 0:(r=e.includes)==null?void 0:r.call(e,t))!=null?n:false}},not_contains:{description:" doesn't contain ",ret_btype:"sys.bool",section:"Operators",arg_btype:"text",fn(e,t){var n,r;return(n=!(e!=null&&(r=e.includes)!=null&&r.call(e,t)))!=null?n:true}},is_empty:{description:" is empty",section:"Operators",ret_btype:"sys.bool",build_pg_constraint:c.is_empty,fn(e){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",section:"Operators",ret_btype:"sys.bool",build_pg_constraint:c.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}},to_capitalized_words:{description:":capitalized words",section:"Other Operators",ret_btype:"text",fn(e){var t,n;return(t=(n=r.toTitleCase(e,true))==null?void 0:n.toString())!=null?t:this.ret_btype_null()}},to_uppercase:{description:":uppercase",section:"Other Operators",ret_btype:"text",fn(e){var t,n;return(t=e==null?void 0:(n=e.toUpperCase)==null?void 0:n.call(e))!=null?t:this.ret_btype_null()}},to_lowercase:{description:":lowercase",section:"Other Operators",ret_btype:"text",fn(e){var t,n;return(t=e==null?void 0:(n=e.toLowerCase)==null?void 0:n.call(e))!=null?t:this.ret_btype_null()}},format_text:{section:"Other Operators",ret_btype:"text",field_names:{formatting_type:{},replace_space:{default:true},hmac_key:{},encode_b64:{}},spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.get_static_property("formatting_type");let n;if(t!=null){switch(t){case"url_encode":n=" URL";break;case"md5_hash":n=" MD5 hash";break;case"hmac":n=" HMAC SHA256 digest";break;case"hmac_sha1":n=" HMAC SHA1 digest";break;default:n=" "+l.masks[t].caption}}else{n="..."}return":formatted as"+n},description_for_sliding_palette:"Text Formatting",fields(e){const t={us_phone:l.masks.us_phone.caption,url_encode:"URL Encoded",md5_hash:"MD5 Hash",hmac:"HMAC SHA256 Digest",hmac_sha1:"HMAC SHA1 Digest"};const n=e("formatting_type");return[{name:"formatting_type",caption:"Format type",editor:"Dropdown",set:i().sets.get_set("Object")(t)},{name:"replace_space",caption:"Replace spaces by +",editor:"Checkbox",condition:"formatting_type is url_encode"},{name:"hmac_key",caption:"HMAC Secret",editor:"ShortText",condition:()=>["hmac","hmac_sha1"].includes(n)},{name:"encode_b64",caption:"Base64-encode the result",editor:"Checkbox",condition:()=>["hmac","hmac_sha1"].includes(n)},{name:"information",label_text:"Note that this conversion will only happen server-side. The key will be kept secret if used in an API workflow, it is not safe if used in a regular workflow in a page.",editor:"Label",condition:()=>["hmac","hmac_sha1"].includes(n)}]},fn(e,t,n){const{formatting_type:i}=n;if(e==null){return this.ret_btype_null()}if(i==="us_phone"){let t;if(e.length===11){t=e[0];e=e.slice(1)}else{t=null}if(e.length===10){let n="("+e.slice(0,3)+") "+e.slice(3,6)+"-"+e.slice(6);if(t){n=t+" "+n}return n}else{return e}}else if(i==="us_ssn"){if(e.length===9){return e.slice(0,3)+"-"+e.slice(3,5)+"-"+e.slice(5)}else{return e}}else if(i==="url_encode"){if(n.replace_space){return encodeURIComponent(e.replace(/\s/g,"+"))}else{return encodeURIComponent(e)}}else if(i==="md5_hash"){return r.digest(e)}else if(["hmac","hmac_sha1"].includes(i)){let t;if(!a.on_server()){return"HMAC Digest computation on the client"}if(!n.hmac_key){return"HMAC Secret missing"}if(i==="hmac"){t="SHA256"}else{t="SHA1"}const r=f.createHmac(t,n.hmac_key).update(e);if(n.encode_b64){return r.digest("base64")}else{return r.digest("hex")}}else{return"unrecognized format type: "+i}}},use_text_as:{section:"Other Operators",ret_btype(e){var t,n,r;(t=e)!=null?t:e={};return(n=(r=e["%p"])==null?void 0:r.data_type)!=null?n:"text"},field_names:{data_type:{}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.get_static_property("data_type");if(n!=null){switch(n){case"file":t=" a file";break;case"image":t=" an image";break;default:t=" [invalid type]"}}else{t="..."}return":used as"+t},description_for_sliding_palette:"Text URL used as",fields(){const e={file:"File",image:"Image"};return[{name:"data_type",caption:"Used as type",editor:"Dropdown",set:i().sets.get_set("Object")(e)}]},fn(e,t,n){var r,i;return(r=(i=s.get(n.data_type))==null?void 0:i.cast(e))!=null?r:e}},trimmed:{description:":trimmed",section:"Other Operators",ret_btype:"text",arg_btype:null,fn(e,t){var n,r;return(n=e==null?void 0:(r=e.trim)==null?void 0:r.call(e))!=null?n:this.ret_btype_null()}},length:{description:":number of characters",section:"Other Operators",ret_btype:"number",arg_btype:null,fn(e,t){if(!e){return 0}return e.length}},extract_from_text:{ret_btype:"text",section:"Other Operators",field_names:{text_type:{},component_to_extract:{}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.property("component_to_extract");if(n&&!n.is_empty()){t=" "+n.get_static()}else{t="..."}return":extract"+t},description_for_sliding_palette:"Extract from text",fields(e){const t=e("text_type");const n={email:["domain","top domain","alias"]};let r;if(t){r=n[t]}else{r=[]}return[{name:"text_type",caption:"Text type",editor:"Dropdown",set:i().sets.get_set("List")(["email"])},{name:"component_to_extract",caption:"Component",editor:"Dropdown",set:i().sets.get_set("List")(r),condition(){return t}}]},fn(e,t,n){if(!e){return this.ret_btype_null()}switch(n.text_type){case"email":if(!r.is_email(e)){return this.ret_btype_null()}else{switch(n.component_to_extract){case"domain":return e.split("@")[1];case"alias":return e.split("@")[0];case"top domain":{const t=e.split("@")[1];const n=t.split(".");const{length:r}=n;return n[r-2]+"."+n[r-1]}}}break;default:return this.ret_btype_null()}}},convert_to_number:{description:":converted to number",section:"Other Operators",ret_btype:"number",arg_btype:null,fn(e){var t;const n=r.remove_invalid_from_num(_.cast_to_string(e));const s=(t=i().browser_locale())!=null?t:i().locale();const o=s.parse_float(n);return r.to_num(o)}},split_by:{ret_btype:o.list_type("text"),section:"Other Operators",field_names:{separator:{}},spot_data:"SlidableAtom",description(e){let t;const n=e==null?void 0:e.property("separator").get_tree_display();if(!n){t="..."}else{if(n.length>5){t=` (${n.slice(0,5)})`}else{t=` (${n})`}}return":split by"+t},description_for_sliding_palette:"Split text into a list by",fields(e){return[{name:"separator",caption:"Text separator",editor:"LongText"}]},fn(e,t,n){if(!e||e.split==null){return i().db_instance().static_list("text",[])}const{separator:r}=n;if([undefined,null,""].includes(r)){return i().db_instance().static_list("text",e.split("\n"))}return i().db_instance().static_list("text",e.split(r))}},find_replace:{ret_btype:"text",section:"Other Operators",field_names:{find:{},use_regex:{default:false},replace:{optional:true}},spot_data:"SlidableAtom",description:":find & replace",description_for_sliding_palette:"Find and Replace",fields(e){return[{name:"use_regex",caption:"Use a regex pattern",editor:"Checkbox"},{name:"find",caption:e("use_regex")?"Regex pattern":"Text to find",editor:"LongText"},{name:"replace",caption:"Replace by",editor:"LongText"}]},fn(e,t,n){var i;if(!e||e.split==null){return this.ret_btype_null()}const{find:s}=n;if([undefined,null,""].includes(s)){return e}const o=(i=n.replace)!=null?i:"";if(!n.use_regex){return e.split(s).join(o)}else{let t;try{t=new RegExp(s,"g")}catch(e){throw new r.OwnerError("Bad regex format",{display:"Bad Regex format: "+e.message})}if(a.on_server()){return h.replace({regex_string:s,string:e,replace_with:o})}return e.replace(t,o)}}},extract_regex:{ret_btype:o.list_type("text"),section:"Other Operators",field_names:{regex:{}},spot_data:"SlidableAtom",description:":extract with Regex",description_for_sliding_palette:"Extract with Regex",fields(e){return[{name:"regex",caption:"Regex pattern",editor:"ShortText"}]},fn(e,t,n){if(!e||typeof e!=="string"||[undefined,null,""].includes(n.regex)){return i().db_instance().static_list("text",[])}let s;try{s=new RegExp(n.regex,"g")}catch(e){throw new r.OwnerError("Bad regex format",{display:"Bad Regex format: "+e.message})}const o=a.on_server()?h.match({regex_string:n.regex,string:e}):e.match(s);return i().db_instance().static_list("text",o)}},append:{description:"append",section:"Other Operators",ret_btype:"text",arg_btype:"text",fn(e,t){return[e,t].map((e=>_.cast_to_string(e))).join("")}},defaulting_to:{description:"defaulting to ",section:"Other Operators",ret_btype:"text",arg_btype:"text",fn(e,t){if(e){return e}return t!=null?t:""}},truncated:{description:"truncated to ",section:"Other Operators",ret_btype:"text",arg_btype:"number",fn(e,t){if(typeof e!=="string"){return this.ret_btype_null()}if(!t){return e}else{return e.slice(0,r.to_num(t))}}},truncated_right:{description:"truncated from end to ",section:"Other Operators",ret_btype:"text",arg_btype:"number",fn(e,t){if(typeof e!=="string"){return this.ret_btype_null()}if(!t){return e}else{let n=e.length-r.to_num(t);if(n<0){n=0}return e.slice(n)}}},format_json_encode:p("text")},display(){return"text"},equals(e,t){return e===t},get_sample(){return"Lorem ipsum..."},get_bubble_null(){return""},cast:_.cast_to_string,runmode_display:_.cast_to_string,export_to_string:_.cast_to_string,debugging_display:_.cast_to_string,get_JS_object(e){if(!e){return null}return _.cast_to_string(e)},JS_to_bubble(e){if(e==null){return this.get_bubble_null()}if(typeof e!=="string"){d("string",e)}return e},can_sort:true,composer_input_type:m.TEXT,convert_to_bubble_instance:_.cast_to_string,storable:true,bindable:false})},{"../../../constants/composer":54,"../../../db/postgres_constraints":459,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lib":741,"../../../u":823,"../../../u/shared/b_string":841,"../../../u/shared/mode_check":851,"../../input_mask":383,"../utilities/generate_utilities":201,"../utilities/misc_utilities":203,"core-js/modules/es.string.replace.js":1121}],190:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../u/shared/async/b_fiber");const s=e("./../../../lang/appquery");const o=e("../../../services");const a=e("../../../external");const l=e("../../../services/client/editor_utils");const c=e("../../../constants/db");const{create_custom_btype:u}=e("../utilities/generate_utilities");function d(){return["Created By"]}function p(){const e=["email"];const t={email:{description:"'s email",section:"Data Fields",ret_btype:"text",public_for_plugins:true,fn(e,t){if(!e){return""}else{var n,r;return(n=(r=e.get_email)==null?void 0:r.call(e))!=null?n:""}}},logged_in:{description(e,t){var r,i,s,o,a,l,c,u;(r=t)!=null?r:t={};const{parent_node:d}=t;const p=(e==null?void 0:(i=e.parent_expression)==null?void 0:(s=(o=i.call(e)).type)==null?void 0:s.call(o))==="CurrentUser";const _=(d==null?void 0:(a=d.type)==null?void 0:a.call(d))==="CurrentUser";const f=d==null?void 0:(l=d.json)==null?void 0:(c=l.raw)==null?void 0:(u=c.call(l))==null?void 0:u.condition;let h=false;if(f){if(f.next!=null){h=n(f)==="CurrentUser"}else{h=f.type==="CurrentUser"}}if(p||_||h){return" is logged in"}else{return" has an account"}},section:"Other Operators",ret_btype:"sys.bool",fn(e,t){if(!e){return this.ret_btype_null()}else{var n;return(n=e.is_logged_in)==null?void 0:n.call(e)}},is_lookup:"user_signed_up"},not_logged_in:{description(e,t){var n,r,i,s,o;(n=t)!=null?n:t={};const{parent_node:a}=t;const l=(e==null?void 0:(r=e.parent_expression)==null?void 0:(i=(s=r.call(e)).type)==null?void 0:i.call(s))==="CurrentUser";const c=(a==null?void 0:(o=a.type)==null?void 0:o.call(a))==="CurrentUser";if(l||c){return" is logged out"}else{return" doesn't have an account"}},section:"Other Operators",ret_btype:"sys.bool",fn(e,t){if(!e){return this.ret_btype_null()}else{var n;return!((n=e.is_logged_in)!=null&&n.call(e))}}}};function n(e){var t,r;let i=e;while(i.next!=null){i=i.next}if(((t=i.args)==null?void 0:t.next)!=null){return n(i.args)}else if(((r=i.args)==null?void 0:r.type)!=null){return i.args.type}else{return null}}function u(n,i,s){var o,c;t[n]={ret_btype:i.get_value_id(),hidden:s,no_composer(e){return e.type()!=="CurrentUser"&&i.is_reflective},fn:a.make_call_fn(i),field_names:r.extend({},i.parameters,{element_id:{}}),description:(o="'s "+i.display())!=null?o:r.toTitleCase(n),section:"Data Fields"};const u=(c=i.fields)!=null?c:l.add_fields_from_parameters(i.parameters,[]);r.extend(t[n],{spot_data:u.length?"SlidableAtom":undefined,description_for_sliding_palette:"Call parameters",fields(){return u}});e.push(n)}i.optional_pause();const d=o.get_user_calls();for(const e in d){const t=d[e];u(e,t);i.optional_pause("add_oauth_message "+e)}r.extend(t,{email_confirmed:{description:"'s email confirmed",ret_btype:"boolean",section:"Data Fields",fn(e,t){if(!e){return this.ret_btype_null()}else{var n;return[true,"true"].includes((n=e.child)==null?void 0:n.call(e,"authentication").child("email").child("email_confirmed").get())}}},uses_pw:{description:" uses password",ret_btype:"boolean",section:"Other Operators",fn(e,t){if(!e){return this.ret_btype_null()}else{var n;return((n=e.child)==null?void 0:n.call(e,"authentication").child("email").child("email").get())!=null}}},uses_2fa:{description:" uses 2FA",ret_btype:"boolean",section:"Other Operators",no_composer:()=>!s.get_public_setting("twofa_auth"),fn(e,t){if(!e||e._id()===c.NO_USER){return this.ret_btype_null()}else{var n,r,i,s;return((n=e.child)==null?void 0:(r=n.call(e,"authentication"))==null?void 0:(i=r.child("2fa"))==null?void 0:(s=i.child("uses_2fa"))==null?void 0:s.get())==="true"}}},has_2fa_backup:{description:" has 2FA backup codes",ret_btype:"boolean",section:"Other Operators",no_composer:()=>!s.get_public_setting("twofa_auth"),fn(e,t){if(!e||e._id()===c.NO_USER){return this.ret_btype_null()}else{var n,r,i,s;return((n=e.child)==null?void 0:(r=n.call(e,"authentication"))==null?void 0:(i=r.child("2fa"))==null?void 0:(s=i.child("has_codes"))==null?void 0:s.get())==="true"}}},is_using_cookies:{description:" is using cookies",ret_btype:"boolean",section:"Other Operators",no_composer:()=>!s.get_public_setting("cookie_opt_in"),fn(e,t){if(!e){return this.ret_btype_null()}else{var n;return((n=e._id)==null?void 0:n.call(e))!==c.NO_USER}}}});return[t,[...e.map((e=>({value:e,high_priority:true}))),{value:"email_confirmed",high_priority:false},{value:"logged_in",high_priority:false},{value:"not_logged_in",high_priority:false},{value:"uses_pw",high_priority:false},{value:"uses_2fa",high_priority:false},{value:"has_2fa_backup",high_priority:false},{value:"is_using_cookies",high_priority:false}]]}t.exports=function(){const e=s.custom_type("user");return u("user",e,p,d,false)}},{"../../../constants/db":58,"../../../external":618,"../../../services":780,"../../../services/client/editor_utils":778,"../../../u":823,"../../../u/shared/async/b_fiber":833,"../utilities/generate_utilities":201,"./../../../lang/appquery":651,"core-js/modules/web.dom-collections.iterator.js":1123}],191:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=e("../../../services");const i=e("../../../services/shared/plugin_getter");t.exports={get(e){var t;const n=e.split(".")[0];const r=e.split(".").slice(1).join(".");return(t=i.get_plugin(n))==null?void 0:t.get_values()[r]},list(){return r.get_value_ids().map((e=>e.replace("api.","")))},display(){return"external data"}}},{"../../../services":780,"../../../services/shared/plugin_getter":783,"core-js/modules/es.string.replace.js":1121}],192:[function(e,t,n){"use strict";const r=e("./../../../lang/appquery");t.exports={get(e){const t=e.split(".")[0];const n=r.workflow_item(t);if(!(n!=null&&n.exists())){return null}return n.get_value()[e]},list(){return[]},display(){return"API Event data"}}},{"./../../../lang/appquery":651}],193:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../lang/btype_ids");const s=e("./../../../lang/appquery");const{create_custom_btype:o}=e("../utilities/generate_utilities");t.exports={get(e){if(!e){throw new r.UnexpectedError("custom btype created without id.  Namespace: custom")}const t=s.custom_type(e);const n=i.custom_type(e);return o(n,t)},list(){return s.custom_types(undefined,undefined,true).filter((e=>e.id()!=="user")).map((e=>e.id()))},display(){return"custom type"}}},{"../../../lang/btype_ids":652,"../../../u":823,"../utilities/generate_utilities":201,"./../../../lang/appquery":651}],194:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("./../../../lang/appquery");const s=e("../../../lang/btype_ids");const{add_basic_element_messages:o}=e("../utilities/misc_utilities");const a=e("./../../core_events/event_element_mapping");t.exports={get(e){const t=i.element(e);const n={};if(t!=null&&t.exists()){const e=t.get_states();t.add_specific_messages(n);o(e,n,a.has_event("ButtonClicked",t.type()));r.extend(n,{is_visible:{description:" is visible",section:"States",ret_btype:"sys.bool",fn(e,t){return e==null?void 0:e.is_visible()},filter_context(e){return e.is_state||e.is_event_condition},filter_context_new(e){return e.owner_type==="State"||(e.owner_type==="Workflow"||e.owner_type==="BackendWorkflow")&&e.in_event_condition}},isnt_visible:{description:" isn't visible",section:"States",ret_btype:"sys.bool",fn(e){return!(e!=null&&e.is_visible())},filter_context(e){return e.is_state||e.is_event_condition},filter_context_new(e){return e.owner_type==="State"||(e.owner_type==="Workflow"||e.owner_type==="BackendWorkflow")&&e.in_event_condition}}});for(const e of t.element_custom_states()){n[e.name()]={description:"'s "+e.display(),section:"Custom States",ret_btype:e.value(),fn(t){var n;if(t==null){return this.ret_btype().get_bubble_null()}return this.ret_btype().cast((n=t.state(e.name()))!=null?n:e.default_val())},delete_cb(){if(window.confirm(`Delete custom state ${e.display()}?`)){return e.delete()}}}}}for(const e in n){const t=n[e];if(s.is_custom_type(e)){t.documentation_id="Documentation.Elements.GeneralConcepts.States.CustomStates"}else{t.documentation_id="Documentation.Elements.GeneralConcepts.States."+e}}return{display(){return"element"},get_message_names(){return Object.keys(n)},get_message(e){return n[e]},cast(e){return e},get_bubble_null(){return null},storable:false,bindable:false}},list(){return[]},display(){return"element"}}},{"../../../lang/btype_ids":652,"../../../u":823,"../utilities/misc_utilities":203,"./../../../lang/appquery":651,"./../../core_events/event_element_mapping":376,"core-js/modules/web.dom-collections.iterator.js":1123}],195:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../logger");const s=e("../../../u/shared/incremental");const o=e("../../../constants/db");const a=e("../../../constants/special_keys");const l=e("../../../db/postgres_constraints");const c=e("../utilities/list_utilities");const u=e("../../../constants/core");const d=e("../../../db/values/db_values");const p=e("../../../constants/eval");const _=e("../../../lang/btype_ids");const f=e("../../../db/db_utils");const h=e("../../../db/values/TransformList");const m=e("../../../db/values/IntersectList");const g=e("../../../db/values/ConcatList");const v=e("../../../db/values/UniqueList");const b=e("../../../db/values/SortedList");const y=e("./../../../lang/btypes");const w=e("../../../lib");const x=e("../../../db/sample");const j=e("../../../lang/shrink");const{S:A}=j;const M=e("../../../lang/lang");const E=e("../../../lang/evaluation/evaluate");const k=e("../../../u/shared/decaf");const O=e("../../core_datasources/utilities/core_ds_field_names");const S=e("../../core_datasources/utilities/core_ds_editor_utilities");const D=e("../../core_datasources/utilities/core_ds_db_ops_utilities");const C=["greater_or_equal_than","greater_than","less_or_equal_than","less_than","not_equals","equals"];function T(e,t,n){var r,i;const o=((r=t==null?void 0:(i=t.all)==null?void 0:i.call(t))!=null?r:[]).map((t=>{s.optional_pause_tick(10);return e(t)}));if(n==="line_break"){n="\n"}return o.join(n)}function N(e){const t=e.id();const n={count:{description:":count",can_be_cached:true,ret_btype:"number",fn:(e,t,n,r,i,s)=>I(e,t,n,r,s),message_cache_id:e=>{let{raw:t}=e;return R(t)}},contains:{description:" contains ",ret_btype:"sys.bool",arg_btype:t,build_pg_constraint:l.contains,build_pg_r_constraint:l.in,build_pg_relationship:l.contains_both,fn:(t,n)=>{var r;if(!t){return false}return(r=t.contains)==null?void 0:r.call(t,n,e)}},not_contains:{description:" doesn't contain ",ret_btype:"sys.bool",arg_btype:t,build_pg_constraint:l.not_contains,build_pg_r_constraint:l.not_in,build_pg_relationship:l.not_contains_both,fn:(t,n)=>{var r;if(!t){return true}return!((r=t.contains)!=null&&r.call(t,n,e))}},first_element:{description:":first item",ret_btype:t,fn(e){var t;if(!(e!=null&&e.get_children)){return this.ret_btype_null()}return(t=e.get_children(0,1)[0])!=null?t:this.ret_btype_null()}},last_element:{description:":last item",ret_btype:t,fn(e){var t;if(!(e!=null&&e.get_children)){return this.ret_btype_null()}const n=e.length();if(!n){return this.ret_btype_null()}return(t=e.get_children(n-1,1)[0])!=null?t:this.ret_btype_null()}},random_element:{description:":random item",ret_btype:t,fn(e,t,n,r,i){var s;if(!(e!=null&&e.get_children)||!e.length()){return this.ret_btype_null()}const o=e.length();let a;if(i!=null&&i.random_generator){a=e=>i.random_generator.random(0,o)}else{a=e=>Math.random()*o}const l=Math.floor(a());return(s=e.get_children(l,1)[0])!=null?s:this.ret_btype_null()}},specific_item:{description:":item #",ret_btype:t,arg_btype:"number",fn(e,t,n,r){var s;if(!(e!=null&&e.get_children)||!t||t<1){return this.ret_btype_null()}const o=Math.ceil(t-1);if(o!==t-1)i.verbose("user trying to offset list from decimal value",{b:t,b_string:String(t),_raw:r});return(s=e.get_children(o,1)[0])!=null?s:this.ret_btype_null()}},limit_to:{description:":items until #",ret_btype:_.list_type(t),arg_btype:"number",fn(e,n,r,s){if(!(e!=null&&e.get_children)||n==null){return w().db_instance().static_list(t,[])}const o=Math.floor(n);if(o!==n)i.verbose("user trying to cap list at decimal value",{b:n,b_string:String(n),_raw:s});return e.capped(o)}},list_from:{description:":items from #",ret_btype:_.list_type(t),arg_btype:"number",fn(e,n,r,s){if(!(e!=null&&e.get_children)||n==null){return w().db_instance().static_list(t,[])}const o=Math.ceil(n-1);if(o!==n-1)i.verbose("user trying to offset list from decimal value",{b:n,b_string:String(n),_raw:s});return e.offset(o)}},contains_list:{description:" contains list ",ret_btype:"sys.bool",arg_btype:_.list_type(t),fn:(t,n)=>{for(const o of(r=n==null?void 0:(i=n.all)==null?void 0:i.call(n))!=null?r:[]){var r,i,s;if(!(t!=null&&(s=t.contains)!=null&&s.call(t,o,e))){return false}}return true}}};if(e.has_runmode_display()){n.join={description:" join with ",ret_btype:"text",arg_btype:"text",fn:(n,r)=>{if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}return T((t=>e.runmode_display(t)),n,r)},editor:{static:true,default:", "}}}if(e.matches("date")){r.extend(n,{average:{description:":average",can_be_cached:true,ret_btype:"date",fn(e,t,n,r,i,s){if(!d.registry.is(e,d.LIST_WRAPPER)||e.length_or_zero()<=0){return this.ret_btype_null()}return e.average(s)}},median:{description:":median",can_be_cached:true,ret_btype:"date",fn(e,t,n,r,i,s){if(!d.registry.is(e,d.LIST_WRAPPER)||e.length_or_zero()<=0){return this.ret_btype_null()}return e.median(s)}},min:{description:":min",can_be_cached:true,ret_btype:"date",fn(e,t,n,r,i,s){if(!d.registry.is(e,d.LIST_WRAPPER)||e.length_or_zero()<=0){return this.ret_btype_null()}return e.min(s)}},max:{description:":max",can_be_cached:true,ret_btype:"date",fn(e,t,n,r,i,s){if(!d.registry.is(e,d.LIST_WRAPPER)||e.length_or_zero()<=0){return this.ret_btype_null()}return e.max(s)}}})}if(e.matches("number")){r.extend(n,{sum:{description:":sum",can_be_cached:true,ret_btype:"number",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}return e.sum(o)}},product:{description:":product",can_be_cached:true,ret_btype:"number",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}return e.product(o)}},average:{description:":average",can_be_cached:true,ret_btype:"number",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[0])}const a=e.average(o);if(a!=null)return a;if(e.length()===0)return 0;return a}},median:{description:":median",can_be_cached:true,ret_btype:"number",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[0])}const a=e.median(o);if(a!=null)return a;if(e.length()===0)return 0;return a}},min:{description:":min",can_be_cached:true,ret_btype:"number",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[0])}const a=e.min(o);if(a!=null)return a;if(e.length()===0)return 0;return a}},max:{description:":max",can_be_cached:true,ret_btype:"number",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[0])}const a=e.max(o);if(a!=null)return a;if(e.length()===0)return 0;return a}}})}n.approximate_count={description:":approximate count",can_be_cached:true,ret_btype:"number",fn:(e,t,n,i,s,o)=>I(e,t,n,i,r.extend({should_approx:true},o)),message_cache_id:e=>{let{raw:t}=e;return R(t)}};n.cached_aggregation={description(e){const t=e==null?void 0:e.get_static_property("operation");return":cached "+(t!=null?t:"aggregation")},field_names:{operation:{}},spot_data:"SlidableAtom",ret_btype:function(e){var t,r,i;const s=(t=n[e==null?void 0:(r=e[A.properties])==null?void 0:r.operation])==null?void 0:t.ret_btype;return(i=typeof s==="function"?s():s)!=null?i:"null"},description_for_sliding_palette:"Cached Aggregation",fields(){const e=Object.entries(n).filter((e=>{let[t,n]=e;return n.can_be_cached})).map((e=>{var t;let[n,r]=e;return[n,(t=typeof r.description==="function"?r.description():r.description)==null?void 0:t.substring(1)]}));return[{name:"operation",caption:"Operation",editor:"Dropdown",set:w().sets.get_set("Object")(Object.fromEntries(e))}]},fn(e,t,r,i,s){var o;const a=r.operation;return(o=n[a])==null?void 0:o.fn(e,t,r,i,s,{cacheable:true})},message_cache_id:e=>{var t,r;let{raw:i,properties:s}=e;return(t=n[s.operation])==null?void 0:(r=t.message_cache_id)==null?void 0:r.call(t,{raw:i})}};for(const r of e.get_messages()){const e=["function","object"];const i={convert_to_list:true};const s=":each item";const o=[null,[]];const a=()=>i[r.name()];if(!r.M.arg_btype&&(!e.includes(typeof r.M.ret_btype)||o.includes(typeof r.M.ret_btype))){let e;if(_.is_list(r.M.ret_btype)){e=r.M.ret_btype}else{e=_.list_type(r.M.ret_btype)}n[r.name()]={description(e,t){var n,i,o;(n=t)!=null?n:t={};if(t.for_consumer===u.DROPDOWN_DESCRIPTION_CONTEXT){return s+r.description(e)}const a=(i=t.parent_node)!=null?i:e==null?void 0:e.prior();if(a instanceof M.DataSource||!(a!=null&&(o=a.prior)!=null&&o.call(a).get_value().is_list())){return s+r.description(e)}return r.description(e)},ret_btype:e,spot_data:r.M.spot_data,description_for_sliding_palette:r.M.description_for_sliding_palette,field_names:r.M.field_names,fields:r.M.fields,compound_message:true,no_composer:a,arg_btype:null,fn:(e,n,i,s)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}let o=new h(e,{value_id:t,message:r.name(),properties:i,_raw:s,arg:n});if(_.is_list(r.M.ret_btype)){o=o.flatten()}return o}}}}if(e.matches(y.compound)){n.group_by={ret_btype(e){var t;(t=e)!=null?t:e={};e=r.json_deep_copy(e);for(const t of["groupings","aggregations"]){for(const s in(n=e["%p"])==null?void 0:n[t]){var n,i;const o=(i=e["%p"])==null?void 0:i[t][s];for(const e in o){const t=o[e];if(t["%x"]==="Empty"){delete o[e]}}if(r.is_empty(o)){delete e["%p"][t][s]}}}try{var s;const t=this.fn(undefined,undefined,(s=e["%p"])!=null?s:{});return _.list_type(t.get_item_btype_id())}catch{return"list.null"}},field_names:{groupings:{},aggregations:{}},spot_data:"SlidableAtom",description(t){var n;if(t==null){return":group by... "}const r=Object.values((n=t.property("groupings").raw())!=null?n:{}).map((e=>e.message)).map((t=>e.get_message(t).description(undefined,true))).join(", ");return":grouped by "+r},description_for_sliding_palette:"Group By",fields(){return[{name:"groupings",editor:"ObjectList",button_caption:"Add a new grouping",add_move_up_down_btn:true,remove_caption:"remove this grouping",move_up_caption:"move up",move_down_caption:"move down",has_rows:true,sub_properties:(e,n,r)=>{var i,s,a,l,c;const u=e==null?void 0:(i=e.entry)==null?void 0:i.call(e,"message").get_static();const d=u?y.get(t).get_message(u).ret_btype_id():null;const p=e==null?void 0:(s=e.entry)==null?void 0:s.call(e,"fn").get_static();const _=r===((a=n.property("groupings"))==null?void 0:(l=a.entries)==null?void 0:(c=l.call(a))==null?void 0:c.length)-1;const h=["date","number"].includes(d);let m;if(d==="date"){m="date"}else if(d==="number"){m="value"}let g="Interval";if(d==="date"&&o.CALENDAR_GROUPINGS.includes(p)){g+=" ("+p+"s)"}const v=[{name:"message",caption:"Field "+(r+1)+" to group by",editor:"Dropdown",set:w().sets.get_set("Filtered")(w().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>f.can_group_on(t).includes(e.value))),include_in_redesign:false},{name:"fn",caption:"Type of grouping",editor:"Dropdown",set:w().sets.get_set("List")(f.can_group_with(t,u)),condition(){return u},include_in_redesign:false},{name:"information",editor:"Label",label_text:"As this field is not a number or a date, the grouping will be done based on each exact value.",condition(){return u&&!h},include_in_redesign:false},{name:"interval",caption:g,condition:()=>h&&o.BUCKET_GROUPINGS.includes(p),editor:"Basic",value:"number",include_in_redesign:false},{name:"start",caption:"Starting "+m,editor:"Basic",condition:()=>h&&o.BUCKET_GROUPINGS.includes(p),value:d,include_in_redesign:false},{name:"filling_gaps",caption:"Do not skip empty groups",editor:"Checkbox",condition:()=>_&&h,include_in_redesign:false},{name:"end",caption:"Ending "+m,editor:"Basic",condition:()=>{var t;return h&&_&&(e==null?void 0:(t=e.entry)==null?void 0:t.call(e,"filling_gaps").get_static())},value:d,include_in_redesign:false},{name:"message",caption:"Field "+(r+1)+" to group by",editor:"Dropdown",set:w().sets.get_set("Filtered")(w().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>f.can_group_on(t).includes(e.value))),include_in_redesign:true,pretty:{row_id:1}},{name:"fn",caption:"Type of grouping",editor:"Dropdown",set:w().sets.get_set("List")(f.can_group_with(t,u)),condition:()=>u,include_in_redesign:true,pretty:{row_id:2}},{name:"information",editor:"Label",label_text:"As this field is not a number or a date, the grouping will be done based on each exact value.",condition:()=>u&&!h,include_in_redesign:true,pretty:{row_id:3}},{name:"interval",caption:g,condition:()=>h&&o.BUCKET_GROUPINGS.includes(p),editor:"Basic",value:"number",include_in_redesign:true,pretty:{row_id:4}},{name:"start",caption:"Starting "+m,editor:"Basic",condition:()=>h&&o.BUCKET_GROUPINGS.includes(p),value:d,include_in_redesign:true,pretty:{row_id:5}},{name:"filling_gaps",caption:"Do not skip empty groups",editor:"Checkbox",condition:()=>_&&h,include_in_redesign:true,pretty:{row_id:6}},{name:"end",caption:"Ending "+m,editor:"Basic",condition:()=>{var t;return h&&_&&(e==null?void 0:(t=e.entry)==null?void 0:t.call(e,"filling_gaps").get_static())},value:d,include_in_redesign:true,pretty:{row_id:7}}];return v}},{name:"aggregations",editor:"ObjectList",button_caption:"Add a new aggregation",add_move_up_down_btn:true,remove_caption:"remove this aggregation",move_up_caption:"move up",move_down_caption:"move down",has_rows:true,sub_properties:(e,n,r)=>{var i;const s=e==null?void 0:(i=e.entry)==null?void 0:i.call(e,"fn").get_static();const a=f.can_aggregate_on(s,t);const l=[{name:"fn",caption:"Aggregation "+(r+1),editor:"Dropdown",set:w().sets.get_set("List")(o.SUPPORTED_AGGREGATIONS),include_in_redesign:false},{name:"message",caption:"Field to calculate on",editor:"Dropdown",condition:()=>s!=null&&a.length,set:w().sets.get_set("Filtered")(w().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>a.includes(e.value))),include_in_redesign:false},{name:"fn",caption:"Aggregation "+(r+1),editor:"Dropdown",set:w().sets.get_set("List")(o.SUPPORTED_AGGREGATIONS),include_in_redesign:true,pretty:{row_id:1}},{name:"message",caption:"Field to calculate on",editor:"Dropdown",condition:()=>s!=null&&a.length,set:w().sets.get_set("Filtered")(w().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>a.includes(e.value))),include_in_redesign:true,pretty:{row_id:2}}];return l}}]},check_for_errors(e,t){var n;const r=(n=e.property("groupings").raw())!=null?n:{};if(Object.keys(r).length===0){t("Group By operator requires at least one grouping")}},fn(e,n,r,i){if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}for(const e of k.object_values(r.groupings)){if(o.CALENDAR_GROUPINGS.includes(e.fn)){e.timezone_string=w().current_timezone();if(typeof e.start!=="number"&&!(e.start instanceof Date)){if(e.end!=null){e.start=e.end-1}else{e.start=Date.now()}}if(typeof e.interval!=="number"||e.interval<1){e.interval=1}}else if(e.fn==="bucket"&&typeof e.start!=="number"){e.start=0;if(typeof e.interval!=="number"||e.interval<=0){e.interval=1}}}const s=k.object_values(r.aggregations);for(const e of s){if(!f.can_aggregate_on(e.fn,t).includes(e.message)){delete e.message}}const a=f.can_group_on(t);const l={groupings:k.object_values(r.groupings).filter((e=>a.includes(e.message))),aggregations:s};return e.group_by(l)}}}n.filtered={ret_btype:_.list_type(t),field_names:r.extend({ignore_empty_constraints:{}},O.constraints_field_names,O.sorting_field_names),spot_data:"SlidableAtom",description:":filtered",description_for_sliding_palette:"List filter",fields(n){if(e.matches(y.compound)){const e=n("sort_field");return[...S.get_constraints_fields(t),...S.get_sorting_fields(t,false,e),S.ignore_empty_constraints_checkbox]}else{return[...S.get_constraints_fields(t,undefined,true),S.ignore_empty_constraints_checkbox]}},fn(n,r,i,s,o){if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}i.type_to_find=t;const l=!i.ignore_empty_constraints;const c=k.object_values(i.constraints).map(((n,r)=>{if(n.key===a.ADVANCED_SEARCH_CONSTRAINT){const i=s[A.properties][A.constraints][r][A.value];n.value=E.reduce(i,o);if(!e.matches(y.compound)){n.self=t}}return n}));return n.filter(c,l).sort(D.get_sorts_list(i))},no_frozen_state:true,properties_for_pre_evaluation(e){let{_properties:t}=e;if(!(t!=null&&t[A.constraints])){return t}const n=r.extend({},t);n[A.constraints]={};for(const e in t[A.constraints]){const i=t[A.constraints][e];if(i==null){continue}else if(typeof i!=="object"){n[A.constraints][e]=i}else{n[A.constraints][e]=r.extend({},i);if(i[A.key]===a.ADVANCED_SEARCH_CONSTRAINT){n[A.constraints][e][A.value]=null}}}return n}};n.format_as_text={description:":format as text",spot_data:"SlidableAtom",ret_btype:"text",field_names:{content:{prop_type:p.EVAL_TYPE.thunk},delimiter:{prop_type:p.EVAL_TYPE.thunk}},description_for_sliding_palette:"Format content as text",fields(){return[{name:"content",caption:"Content to show per list item",editor:"LongText"},{name:"delimiter",caption:"Delimiter",editor:"LongText"}]},fn(e,t,n,i,s){if(!(e!=null&&e.get_children)||!e.length()||i==null){return this.ret_btype_null()}let o="";const a=e.length();e.all().forEach(((t,l)=>{var c,u;const d=r.extend({},s);d.datasources=r.extend({},d.datasources);d.datasources.injected_value=()=>t;const p=(c=e.get_item_btype_id())!=null?c:"text";d.datasources.injected_value_btype=()=>p;const _=n.content(d);const f=(u=i[A.properties])==null?void 0:u.delimiter;let h;if(l===a-1||!f){h=""}else{h=n.delimiter(d)}o+=_+h}));return o},no_frozen_state:true};if(e.matches(y.compound)||e.option_set()!=null){n.sorted={ret_btype:_.list_type(t),field_names:r.extend({},O.sorting_field_names),spot_data:"SlidableAtom",description(e){const n=e==null?void 0:e.property("sort_field").raw();let r=":sorted";if(n===a.DYNAMIC_SORTING_FIELD){r+=" by dynamic field"}else if(n===a.RANDOM_SORTING){r+=" randomly"}else if(n){var i;const e=y.get(t);let a;if(e.custom_type()!=null){a=e.custom_type().field(n).display()}else if(e.option_set()!=null){a=e.option_set().attribute(n).display()}else{var s,o;a=(s=e.get_message(n))==null?void 0:(o=s.description)==null?void 0:o.call(s,undefined,true)}r+=" by "+((i=a)!=null?i:n)}return r},description_for_sliding_palette:"List sorting order",fields(e){const n=S.get_sorting_fields(t,false,e("sort_field"));n[0].optional=false;return n},fn(e,n,r){if(Array.isArray(e)){e=c.array_to_static_list(t,e)}else if(!e||!e.all){return w().db_instance().static_list(t,[])}r.type_to_find=t;const i=D.get_sorts_list(r);return new b(e,{sorts_list:i})}};n.ranked_by={ret_btype:_.list_type(t),field_names:{target_item:{},method:{}},spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.property("target_item");const n=e==null?void 0:e.get_static_property("method");let r=":ranked by";if(!n){r+="..."}else{r+=" ";if(n==="similar"){r+="numerical similarity to "}else if(n==="different"){r+="numerical difference from "}if(!(t!=null&&t.exists())){r+="..."}else{r+=t.get_tree_display()}}return r},description_for_sliding_palette:"Ranking",fields(){return[{name:"method",caption:"Rank by",editor:"Dropdown",set:w().sets.get_set("Object")({similar:"numerical similarity to...",different:"numerical difference from..."})},{name:"target_item",caption:"Target",editor:"Basic",value:t}]},fn(e,n,r){var i,s;const o=(i=e==null?void 0:(s=e.all)==null?void 0:s.call(e))!=null?i:[];if(d.registry.is(e,d.LIST_WRAPPER)&&e.get_item_btype_id()!==t){return[]}const a=y.get(t).option_set();if(r.target_item!=null&&(a||r.target_item.child)){const l=y.get(t).get_messages().filter((e=>e.ret_btype().matches("number")));const c={};for(const _ of l){const f=_.name();if(a){c[f]=a.value(r.target_item).attr(f)}else{c[f]=r.target_item.child(f).get()}}function u(e){if(e==null||a==null&&!e.child){return Infinity}let t=0;for(const i of l){var n,r;const s=i.name();const o=(n=a==null?void 0:a.value(e).attr(s))!=null?n:e==null?void 0:(r=e.child)==null?void 0:r.call(e,s).get();if(o!=null){t+=Math.pow(c[s]-o,2)}else{return Infinity}}return t}const p=r.method==="different"?-1:1;o.sort(((e,t)=>(u(e)-u(t))*p))}return w().db_instance().static_list(t,o)}}}else if(e.can_sort()){n.sorted={ret_btype:_.list_type(t),field_names:{random:{},descending:{optional:true}},spot_data:"SlidableAtom",description:()=>":sorted",description_for_sliding_palette:"List sorting order",fields(e){const t=e("random");return[{name:"random",caption:"Randomized list",editor:"Checkbox"},{name:"descending",caption:"Descending",editor:"Basic",value:"boolean",condition:()=>!t}]},fn(e,n,r){var i;if(Array.isArray(e)){e=c.array_to_static_list(t,e)}else if(!e||!e.all){return w().db_instance().static_list(t,[])}(i=r)!=null?i:r={};r.sorts_list=[{sort_field:r.random?a.RANDOM_SORTING:undefined,descending:r.descending,self:true}];return new b(e,r)}}}n.merged_with={description:" merged with ",ret_btype:_.list_type(t),arg_btype:_.list_type(t),fn(e,n){if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}return new v(new g(w().db_instance().static_list(_.list_type(t),[e,n])))}};n.intersect_with={description:" intersect with ",ret_btype:_.list_type(t),arg_btype:_.list_type(t),fn(e,n){if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}return new m(w().db_instance().static_list(_.list_type(t),[e,n]))}};n.unique={description:":unique elements",ret_btype:_.list_type(t),fn(e,n){if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}return new v(e)}};n.plus_element={description:":plus item ",ret_btype:_.list_type(t),arg_btype:t,fn(n,r){if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}r=e.cast(r);if(r==null){r=w().db_instance().static_list(t,[])}else{r=w().db_instance().static_list(t,[r])}return new v(new g(w().db_instance().static_list(_.list_type(t),[n,r])))}};if(t!=="geographic_address"){n.minus_element={description:":minus item ",ret_btype:_.list_type(t),arg_btype:t,fn(n,i){if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}i=e.cast(i);if(i==null){return n}let s;if(i._id!=null){s=[{key:a.UNIQUE_ID,constraint_type:"not equal",value:i._id()}]}else{const n=!e.get_message("not_equals").is_not_found();const o=typeof i==="string"&&e.plugin.uid_field!=null;if(!n&&!o){throw new r.UnexpectedError("minus_element called on a btype that doesn't have not_equals: "+t)}s=[{key:a.ADVANCED_SEARCH_CONSTRAINT,value:{"%x":"InjectedValue","%n":{"%nm":"not_equals","%a":i,"%x":"Message"}},self:n?t:"text"}]}return n.filter(s)}};n.minus_list={description:":minus list ",ret_btype:_.list_type(t),arg_btype:_.list_type(t),fn(e,n){e=c.process_list_arg(t,e);n=c.process_list_arg(t,n);return e.minus_list(n)}}}n.make_static={description:":make static ",ret_btype:_.list_type(t),fn(e,n){if(!d.registry.is(e,d.LIST_WRAPPER)||!y.get(e.get_item_btype_id()).matches(t)){e=w().db_instance().static_list(t,[])}return w().db_instance().static_list(t,e.all())}};for(const e in n){const t=n[e];if(!t.compound_message){t.documentation_id="Documentation.Data.Messages.list."+e}}return n}function P(e){const t=e.id();let n=null;const s={count:{description:":count",section:"Operators",can_be_cached:true,ret_btype:"number",fn:(e,t,n,r,i,s)=>I(e,t,n,r,s),message_cache_id:e=>{let{raw:t}=e;return R(t)}},contains:{description:" contains ",section:"Operators",ret_btype:"sys.bool",arg_btype:t,build_pg_constraint:l.contains,build_pg_r_constraint:l.in,build_pg_relationship:l.contains_both,fn:(t,n)=>{var r;if(!t){return false}return(r=t.contains)==null?void 0:r.call(t,n,e)}},not_contains:{description:" doesn't contain ",section:"Operators",ret_btype:"sys.bool",arg_btype:t,build_pg_constraint:l.not_contains,build_pg_r_constraint:l.not_in,build_pg_relationship:l.not_contains_both,fn:(t,n)=>{var r;if(!t){return true}return!((r=t.contains)!=null&&r.call(t,n,e))}},first_element:{description:":first item",section:"Operators",ret_btype:t,fn(e){var t;if(!(e!=null&&e.get_children)){return this.ret_btype_null()}return(t=e.get_children(0,1)[0])!=null?t:this.ret_btype_null()}},last_element:{description:":last item",section:"Operators",ret_btype:t,fn(e){var t;if(!(e!=null&&e.get_children)){return this.ret_btype_null()}const n=e.length();if(!n){return this.ret_btype_null()}return(t=e.get_children(n-1,1)[0])!=null?t:this.ret_btype_null()}},random_element:{description:":random item",section:"Operators",ret_btype:t,fn(e,t,n,r,i){var s;if(!(e!=null&&e.get_children)||!e.length()){return this.ret_btype_null()}const o=e.length();let a;if(i!=null&&i.random_generator){a=e=>i.random_generator.random(0,o)}else{a=e=>Math.random()*o}const l=Math.floor(a());return(s=e.get_children(l,1)[0])!=null?s:this.ret_btype_null()}},specific_item:{description:":item #",section:"Operators",ret_btype:t,arg_btype:"number",fn(e,t,n,r){var s;if(!(e!=null&&e.get_children)||!t||t<1){return this.ret_btype_null()}const o=Math.ceil(t-1);if(o!==t-1)i.verbose("user trying to offset list from decimal value",{b:t,b_string:String(t),_raw:r});return(s=e.get_children(o,1)[0])!=null?s:this.ret_btype_null()}},limit_to:{description:":items until #",section:"Operators",ret_btype:_.list_type(t),arg_btype:"number",fn(e,n,r,s){if(!(e!=null&&e.get_children)||n==null){return w().db_instance().static_list(t,[])}const o=Math.floor(n);if(o!==n)i.verbose("user trying to cap list at decimal value",{b:n,b_string:String(n),_raw:s});return e.capped(o)}},list_from:{section:"Operators",description:":items from #",ret_btype:_.list_type(t),arg_btype:"number",fn(e,n,r,s){if(!(e!=null&&e.get_children)||n==null){return w().db_instance().static_list(t,[])}const o=Math.ceil(n-1);if(o!==n-1)i.verbose("user trying to offset list from decimal value",{b:n,b_string:String(n),_raw:s});return e.offset(o)}},contains_list:{description:" contains list ",section:"Operators",ret_btype:"sys.bool",arg_btype:_.list_type(t),fn:(t,n)=>{for(const o of(r=n==null?void 0:(i=n.all)==null?void 0:i.call(n))!=null?r:[]){var r,i,s;if(!(t!=null&&(s=t.contains)!=null&&s.call(t,o,e))){return false}}return true}},join:{description:" join with ",section:"Operators",ret_btype:"text",arg_btype:"text",should_include:e.has_runmode_display(),fn:(n,r)=>{if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}return T((t=>e.runmode_display(t)),n,r)},editor:{static:true,default:", "}},sum:{description:":sum",section:"Operators",can_be_cached:true,ret_btype:"number",should_include:e.matches("number"),fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}return e.sum(o)}},product:{description:":product",section:"Operators",can_be_cached:true,ret_btype:"number",should_include:e.matches("number"),fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}return e.product(o)}},average:{description:":average",section:"Operators",can_be_cached:true,should_include:e.matches("number")||e.matches("date"),ret_btype:e.matches("number")?"number":"date",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[0])}const a=e.average(o);if(a!=null)return a;if(e.length()===0)return 0;return a}},median:{description:":median",section:"Operators",can_be_cached:true,should_include:e.matches("number")||e.matches("date"),ret_btype:e.matches("number")?"number":"date",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[0])}const a=e.median(o);if(a!=null)return a;if(e.length()===0)return 0;return a}},min:{description:":min",section:"Operators",can_be_cached:true,should_include:e.matches("number")||e.matches("date"),ret_btype:e.matches("number")?"number":"date",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[0])}const a=e.min(o);if(a!=null)return a;if(e.length()===0)return 0;return a}},max:{description:":max",section:"Operators",can_be_cached:true,should_include:e.matches("number")||e.matches("date"),ret_btype:e.matches("number")?"number":"date",fn:(e,n,r,i,s,o)=>{if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[0])}const a=e.max(o);if(a!=null)return a;if(e.length()===0)return 0;return a}},...Object.fromEntries(e.get_messages_reorg().filter((e=>{const t=["function","object"];const n=[null,[]];return!e.M.arg_btype&&(!t.includes(typeof e.M.ret_btype)||n.includes(typeof e.M.ret_btype))})).map((e=>{const n={convert_to_list:true};const r=":each item";const i=()=>n[e.name()];let s;if(_.is_list(e.M.ret_btype)){s=e.M.ret_btype}else{s=_.list_type(e.M.ret_btype)}const o={description(t,n){var i,s;(i=n)!=null?i:n={};if(n.for_consumer===u.DROPDOWN_DESCRIPTION_CONTEXT){return r+e.description(t)}const o=(s=n.parent_node)!=null?s:t==null?void 0:t.prior();if(o instanceof M.DataSource||!(o!=null&&o.prior().get_value().is_list())){return r+e.description(t)}return e.description(t)},ret_btype:s,spot_data:e.M.spot_data,description_for_sliding_palette:e.M.description_for_sliding_palette,field_names:e.M.field_names,section:e.M.section,fields:e.M.fields,compound_message:true,no_composer:i,arg_btype:null,fn:(n,r,i,s)=>{if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}let o=new h(n,{value_id:t,message:e.name(),properties:i,_raw:s,arg:r});if(_.is_list(e.M.ret_btype)){o=o.flatten()}return o}};return[e.name(),o]}))),plus_element:{description:":plus item ",ret_btype:_.list_type(t),section:"Other Operators",arg_btype:t,fn(n,r){if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}r=e.cast(r);if(r==null){r=w().db_instance().static_list(t,[])}else{r=w().db_instance().static_list(t,[r])}return new v(new g(w().db_instance().static_list(_.list_type(t),[n,r])))}},minus_element:{description:":minus item ",section:"Other Operators",should_include:t!=="geographic_address",ret_btype:_.list_type(t),arg_btype:t,fn(n,i){if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}i=e.cast(i);if(i==null){return n}let s;if(i._id!=null){s=[{key:a.UNIQUE_ID,constraint_type:"not equal",value:i._id()}]}else{const n=!e.get_message("not_equals").is_not_found();const o=typeof i==="string"&&e.plugin.uid_field!=null;if(!n&&!o){throw new r.UnexpectedError("minus_element called on a btype that doesn't have not_equals: "+t)}s=[{key:a.ADVANCED_SEARCH_CONSTRAINT,value:{"%x":"InjectedValue","%n":{"%nm":"not_equals","%a":i,"%x":"Message"}},self:n?t:"text"}]}return n.filter(s)}},minus_list:{description:":minus list ",section:"Other Operators",should_include:t!=="geographic_address",ret_btype:_.list_type(t),arg_btype:_.list_type(t),fn(e,n){e=c.process_list_arg(t,e);n=c.process_list_arg(t,n);return e.minus_list(n)}},merged_with:{description:" merged with ",section:"Other Operators",ret_btype:_.list_type(t),arg_btype:_.list_type(t),fn(e,n){if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}return new v(new g(w().db_instance().static_list(_.list_type(t),[e,n])))}},intersect_with:{description:" intersect with ",section:"Other Operators",ret_btype:_.list_type(t),arg_btype:_.list_type(t),fn(e,n){if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}return new m(w().db_instance().static_list(_.list_type(t),[e,n]))}},group_by:{should_include:e.matches(y.compound),ret_btype(e){var t;(t=e)!=null?t:e={};e=r.json_deep_copy(e);for(const t of["groupings","aggregations"]){for(const s in(n=e["%p"])==null?void 0:n[t]){var n,i;const o=(i=e["%p"])==null?void 0:i[t][s];for(const e in o){const t=o[e];if(t["%x"]==="Empty"){delete o[e]}}if(r.is_empty(o)){delete e["%p"][t][s]}}}try{var s;const t=this.fn(undefined,undefined,(s=e["%p"])!=null?s:{});return _.list_type(t.get_item_btype_id())}catch{return"list.null"}},field_names:{groupings:{},aggregations:{}},spot_data:"SlidableAtom",description(t){var n;if(t==null){return":group by... "}const r=Object.values((n=t.property("groupings").raw())!=null?n:{}).map((e=>e.message)).map((t=>e.get_message(t).description(undefined,true))).join(", ");return":grouped by "+r},section:"Other Operators",description_for_sliding_palette:"Group By",fields(){return[{name:"groupings",editor:"ObjectList",button_caption:"Add a new grouping",add_move_up_down_btn:true,remove_caption:"remove this grouping",move_up_caption:"move up",move_down_caption:"move down",has_rows:true,sub_properties:(e,n,r)=>{var i,s,a,l,c;const u=e==null?void 0:(i=e.entry)==null?void 0:i.call(e,"message").get_static();const d=u?y.get(t).get_message(u).ret_btype_id():null;const p=e==null?void 0:(s=e.entry)==null?void 0:s.call(e,"fn").get_static();const _=r===((a=n.property("groupings"))==null?void 0:(l=a.entries)==null?void 0:(c=l.call(a))==null?void 0:c.length)-1;const h=["date","number"].includes(d);let m;if(d==="date"){m="date"}else if(d==="number"){m="value"}let g="Interval";if(d==="date"&&o.CALENDAR_GROUPINGS.includes(p)){g+=" ("+p+"s)"}const v=[{name:"message",caption:"Field "+(r+1)+" to group by",editor:"Dropdown",set:w().sets.get_set("Filtered")(w().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>f.can_group_on(t).includes(e.value))),include_in_redesign:false},{name:"fn",caption:"Type of grouping",editor:"Dropdown",set:w().sets.get_set("List")(f.can_group_with(t,u)),condition(){return u},include_in_redesign:false},{name:"information",editor:"Label",label_text:"As this field is not a number or a date, the grouping will be done based on each exact value.",condition(){return u&&!h},include_in_redesign:false},{name:"interval",caption:g,condition:()=>h&&o.BUCKET_GROUPINGS.includes(p),editor:"Basic",value:"number",include_in_redesign:false},{name:"start",caption:"Starting "+m,editor:"Basic",condition:()=>h&&o.BUCKET_GROUPINGS.includes(p),value:d,include_in_redesign:false},{name:"filling_gaps",caption:"Do not skip empty groups",editor:"Checkbox",condition:()=>_&&h,include_in_redesign:false},{name:"end",caption:"Ending "+m,editor:"Basic",condition:()=>{var t;return h&&_&&(e==null?void 0:(t=e.entry)==null?void 0:t.call(e,"filling_gaps").get_static())},value:d,include_in_redesign:false},{name:"message",caption:"Field "+(r+1)+" to group by",editor:"Dropdown",set:w().sets.get_set("Filtered")(w().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>f.can_group_on(t).includes(e.value))),include_in_redesign:true,pretty:{row_id:1}},{name:"fn",caption:"Type of grouping",editor:"Dropdown",set:w().sets.get_set("List")(f.can_group_with(t,u)),condition:()=>u,include_in_redesign:true,pretty:{row_id:2}},{name:"information",editor:"Label",label_text:"As this field is not a number or a date, the grouping will be done based on each exact value.",condition:()=>u&&!h,include_in_redesign:true,pretty:{row_id:3}},{name:"interval",caption:g,condition:()=>h&&o.BUCKET_GROUPINGS.includes(p),editor:"Basic",value:"number",include_in_redesign:true,pretty:{row_id:4}},{name:"start",caption:"Starting "+m,editor:"Basic",condition:()=>h&&o.BUCKET_GROUPINGS.includes(p),value:d,include_in_redesign:true,pretty:{row_id:5}},{name:"filling_gaps",caption:"Do not skip empty groups",editor:"Checkbox",condition:()=>_&&h,include_in_redesign:true,pretty:{row_id:6}},{name:"end",caption:"Ending "+m,editor:"Basic",condition:()=>{var t;return h&&_&&(e==null?void 0:(t=e.entry)==null?void 0:t.call(e,"filling_gaps").get_static())},value:d,include_in_redesign:true,pretty:{row_id:7}}];return v}},{name:"aggregations",editor:"ObjectList",button_caption:"Add a new aggregation",add_move_up_down_btn:true,remove_caption:"remove this aggregation",move_up_caption:"move up",move_down_caption:"move down",has_rows:true,sub_properties:(e,n,r)=>{var i;const s=e==null?void 0:(i=e.entry)==null?void 0:i.call(e,"fn").get_static();const a=f.can_aggregate_on(s,t);const l=[{name:"fn",caption:"Aggregation "+(r+1),editor:"Dropdown",set:w().sets.get_set("List")(o.SUPPORTED_AGGREGATIONS),include_in_redesign:false},{name:"message",caption:"Field to calculate on",editor:"Dropdown",condition:()=>s!=null&&a.length,set:w().sets.get_set("Filtered")(w().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>a.includes(e.value))),include_in_redesign:false},{name:"fn",caption:"Aggregation "+(r+1),editor:"Dropdown",set:w().sets.get_set("List")(o.SUPPORTED_AGGREGATIONS),include_in_redesign:true,pretty:{row_id:1}},{name:"message",caption:"Field to calculate on",editor:"Dropdown",condition:()=>s!=null&&a.length,set:w().sets.get_set("Filtered")(w().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>a.includes(e.value))),include_in_redesign:true,pretty:{row_id:2}}];return l}}]},check_for_errors(e,t){var n;const r=(n=e.property("groupings").raw())!=null?n:{};if(Object.keys(r).length===0){t("Group By operator requires at least one grouping")}},fn(e,n,r,i){if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}for(const e of k.object_values(r.groupings)){if(o.CALENDAR_GROUPINGS.includes(e.fn)){e.timezone_string=w().current_timezone();if(typeof e.start!=="number"&&!(e.start instanceof Date)){if(e.end!=null){e.start=e.end-1}else{e.start=Date.now()}}if(typeof e.interval!=="number"||e.interval<1){e.interval=1}}else if(e.fn==="bucket"&&typeof e.start!=="number"){e.start=0;if(typeof e.interval!=="number"||e.interval<=0){e.interval=1}}}const s=k.object_values(r.aggregations);for(const e of s){if(!f.can_aggregate_on(e.fn,t).includes(e.message)){delete e.message}}const a=f.can_group_on(t);const l={groupings:k.object_values(r.groupings).filter((e=>a.includes(e.message))),aggregations:s};return e.group_by(l)}},filtered:{ret_btype:_.list_type(t),field_names:r.extend({ignore_empty_constraints:{}},O.constraints_field_names,O.sorting_field_names),spot_data:"SlidableAtom",description:":filtered",section:"Other Operators",description_for_sliding_palette:"List filter",fields(n){if(e.matches(y.compound)){const e=n("sort_field");return[...S.get_constraints_fields(t),...S.get_sorting_fields(t,false,e),S.ignore_empty_constraints_checkbox]}else{return[...S.get_constraints_fields(t,undefined,true),S.ignore_empty_constraints_checkbox]}},fn(n,r,i,s,o){if(!d.registry.is(n,d.LIST_WRAPPER)){n=w().db_instance().static_list(t,[])}i.type_to_find=t;const l=!i.ignore_empty_constraints;const c=k.object_values(i.constraints).map(((n,r)=>{if(n.key===a.ADVANCED_SEARCH_CONSTRAINT){const i=s[A.properties][A.constraints][r][A.value];n.value=E.reduce(i,o);if(!e.matches(y.compound)){n.self=t}}return n}));return n.filter(c,l).sort(D.get_sorts_list(i))},no_frozen_state:true,properties_for_pre_evaluation(e){let{_properties:t}=e;if(!(t!=null&&t[A.constraints])){return t}const n=r.extend({},t);n[A.constraints]={};for(const e in t[A.constraints]){const i=t[A.constraints][e];if(i==null){continue}else if(typeof i!=="object"){n[A.constraints][e]=i}else{n[A.constraints][e]=r.extend({},i);if(i[A.key]===a.ADVANCED_SEARCH_CONSTRAINT){n[A.constraints][e][A.value]=null}}}return n}},sorted:{should_include:e.matches(y.compound)||e.option_set()!=null||e.can_sort(),ret_btype:_.list_type(t),field_names:e.matches(y.compound)||e.option_set()!=null?{...O.sorting_field_names}:{random:{},descending:{optional:true}},spot_data:"SlidableAtom",description(e){const n=e==null?void 0:e.property("sort_field").raw();let r=":sorted";if(n===a.DYNAMIC_SORTING_FIELD){r+=" by dynamic field"}else if(n===a.RANDOM_SORTING){r+=" randomly"}else if(n){var i;const e=y.get(t);let a;if(e.custom_type()!=null){a=e.custom_type().field(n).display()}else if(e.option_set()!=null){a=e.option_set().attribute(n).display()}else{var s,o;a=(s=e.get_message(n))==null?void 0:(o=s.description)==null?void 0:o.call(s,undefined,true)}r+=" by "+((i=a)!=null?i:n)}return r},section:"Other Operators",description_for_sliding_palette:"List sorting order",fields(n){if(e.matches(y.compound)||e.option_set()!=null){const e=S.get_sorting_fields(t,false,n("sort_field"));e[0].optional=false;return e}else{const e=n("random");return[{name:"random",caption:"Randomized list",editor:"Checkbox"},{name:"descending",caption:"Descending",editor:"Basic",value:"boolean",condition:()=>!e}]}},fn(n,r,i){if(Array.isArray(n)){n=c.array_to_static_list(t,n)}else if(!n||!n.all){return w().db_instance().static_list(t,[])}if(e.matches(y.compound)||e.option_set()!=null){i.type_to_find=t;const e=D.get_sorts_list(i);return new b(n,{sorts_list:e})}else{var s;(s=i)!=null?s:i={};i.sorts_list=[{sort_field:i.random?a.RANDOM_SORTING:undefined,descending:i.descending,self:true}];return new b(n,i)}}},ranked_by:{should_include:e.matches(y.compound)||e.option_set()!=null,ret_btype:_.list_type(t),field_names:{target_item:{},method:{}},spot_data:"SlidableAtom",description(e){const t=e==null?void 0:e.property("target_item");const n=e==null?void 0:e.get_static_property("method");let r=":ranked by";if(!n){r+="..."}else{r+=" ";if(n==="similar"){r+="numerical similarity to "}else if(n==="different"){r+="numerical difference from "}if(!(t!=null&&t.exists())){r+="..."}else{r+=t.get_tree_display()}}return r},section:"Other Operators",description_for_sliding_palette:"Ranking",fields(){return[{name:"method",caption:"Rank by",editor:"Dropdown",set:w().sets.get_set("Object")({similar:"numerical similarity to...",different:"numerical difference from..."})},{name:"target_item",caption:"Target",editor:"Basic",value:t}]},fn(e,n,r){var i,s;const o=(i=e==null?void 0:(s=e.all)==null?void 0:s.call(e))!=null?i:[];if(d.registry.is(e,d.LIST_WRAPPER)&&e.get_item_btype_id()!==t){return[]}const a=y.get(t).option_set();if(r.target_item!=null&&(a||r.target_item.child)){const l=y.get(t).get_messages().filter((e=>e.ret_btype().matches("number")));const c={};for(const _ of l){const f=_.name();if(a){c[f]=a.value(r.target_item).attr(f)}else{c[f]=r.target_item.child(f).get()}}function u(e){if(e==null||a==null&&!e.child){return Infinity}let t=0;for(const i of l){var n,r;const s=i.name();const o=(n=a==null?void 0:a.value(e).attr(s))!=null?n:e==null?void 0:(r=e.child)==null?void 0:r.call(e,s).get();if(o!=null){t+=Math.pow(c[s]-o,2)}else{return Infinity}}return t}const p=r.method==="different"?-1:1;o.sort(((e,t)=>(u(e)-u(t))*p))}return w().db_instance().static_list(t,o)}},unique:{description:":unique elements",section:"Other Operators",ret_btype:_.list_type(t),fn(e,n){if(!d.registry.is(e,d.LIST_WRAPPER)){e=w().db_instance().static_list(t,[])}return new v(e)}},approximate_count:{description:":approximate count",section:"Other Operators",can_be_cached:true,ret_btype:"number",fn:(e,t,n,i,s,o)=>I(e,t,n,i,r.extend({should_approx:true},o)),message_cache_id:e=>{let{raw:t}=e;return R(t)}},cached_aggregation:{description(e){const t=e==null?void 0:e.get_static_property("operation");return":cached "+(t!=null?t:"aggregation")},section:"Other Operators",field_names:{operation:{}},spot_data:"SlidableAtom",ret_btype:function(e){var t,r,i;const s=(t=n[e==null?void 0:(r=e[A.properties])==null?void 0:r.operation])==null?void 0:t.ret_btype;return(i=typeof s==="function"?s():s)!=null?i:"null"},description_for_sliding_palette:"Cached Aggregation",fields(){const e=Object.entries(n).filter((e=>{let[t,n]=e;return n.can_be_cached})).map((e=>{var t;let[n,r]=e;return[n,(t=typeof r.description==="function"?r.description():r.description)==null?void 0:t.substring(1)]}));return[{name:"operation",caption:"Operation",editor:"Dropdown",set:w().sets.get_set("Object")(Object.fromEntries(e))}]},fn(e,t,r,i,s){var o;const a=r.operation;return(o=n[a])==null?void 0:o.fn(e,t,r,i,s,{cacheable:true})},message_cache_id:e=>{var t,r;let{raw:i,properties:s}=e;return(t=n[s.operation])==null?void 0:(r=t.message_cache_id)==null?void 0:r.call(t,{raw:i})}},format_as_text:{description:":format as text",section:"Other Operators",spot_data:"SlidableAtom",ret_btype:"text",field_names:{content:{prop_type:p.EVAL_TYPE.thunk},delimiter:{prop_type:p.EVAL_TYPE.thunk}},description_for_sliding_palette:"Format content as text",fields(){return[{name:"content",caption:"Content to show per list item",editor:"LongText"},{name:"delimiter",caption:"Delimiter",editor:"LongText"}]},fn(e,t,n,i,s){if(!(e!=null&&e.get_children)||!e.length()||i==null){return this.ret_btype_null()}let o="";const a=e.length();e.all().forEach(((t,l)=>{var c,u;const d=r.extend({},s);d.datasources=r.extend({},d.datasources);d.datasources.injected_value=()=>t;const p=(c=e.get_item_btype_id())!=null?c:"text";d.datasources.injected_value_btype=()=>p;const _=n.content(d);const f=(u=i[A.properties])==null?void 0:u.delimiter;let h;if(l===a-1||!f){h=""}else{h=n.delimiter(d)}o+=_+h}));return o},no_frozen_state:true},make_static:{description:":make static ",section:"Other Operators",ret_btype:_.list_type(t),fn(e,n){if(!d.registry.is(e,d.LIST_WRAPPER)||!y.get(e.get_item_btype_id()).matches(t)){e=w().db_instance().static_list(t,[])}return w().db_instance().static_list(t,e.all())}}};const x=Object.entries(s).filter((e=>{var t;let[n,r]=e;return(t=r.should_include)!=null?t:true}));x.forEach((e=>{let[t,n]=e;if(!n.compound_message){n.documentation_id="Documentation.Data.Messages.list."+t}delete n.should_include}));n=Object.fromEntries(x);return n}t.exports={list(){},display(){return"list"},get(e){const t=y.get(e);let n=null;if(t.has_runmode_display()){n=e=>T((e=>t.runmode_display(e)),e,", ")}let i=null;if(t.has_export_to_string()){i=function(e,n){var i,s;n.always_return_text=true;return((i=e==null?void 0:(s=e.all)==null?void 0:s.call(e))!=null?i:[]).map((e=>{const i=new Map(n.visited_field_types);const s=r.extend({},n,{visited_field_types:i});return t.export_to_string(e,s)})).join(" , ")}}let o=null;if(t.has_debugging_display()){o=e=>T((e=>t.debugging_display(e)),e,", ")}const a=N(t);const l=P(t);return{get_message_names:()=>Object.keys(a),get_message_names_reorg:()=>Object.keys(l),get_message(e){return a[e]},get_message_reorg(e){return l[e]},display(){var e;let n=t.display();if(((e=n)==null?void 0:e.slice(-1))==="s"){n+="es"}else{n+="s"}return"List of "+n},inner(){return t},is_list:true,equals(e,t){return false},get_sample(){return new x.SampleList(e)},get_bubble_null:c.list_get_bubble_null,cast(t){return c.cast_to_list(e,t)},storable:false,bindable:false,runmode_display:n,export_to_string:i,debugging_display:o,get_JS_object(e){let n;if(Array.isArray(e)){n=e}else if((e==null?void 0:e.all)!=null){n=e.all()}else{n=[]}return n.map((e=>t.get_JS_object(e)))},JS_to_bubble(n){const r=[];for(const e of k.array_from(n)){s.optional_pause_tick(10);const n=t.JS_to_bubble(e);if(n!=null){r.push(n)}}return w().db_instance().static_list(e,r)}}}};function I(e,t,n,r,i){var s,o;if(typeof(e==null?void 0:e.length)!=="function"){return 0}const a=r==null?void 0:(s=r["%n"])==null?void 0:s["%nm"];if(C.includes(a)){var l;const t=(l=r["%n"])==null?void 0:l["%a"];if(typeof t==="number"){const n=e==null?void 0:e["length_"+a](t,i);const r={greater_than:{true:+1,false:-1},greater_or_equal_than:{true:+1,false:-1},less_than:{true:-1,false:+1},less_or_equal_than:{true:-1,false:+1},equals:{true:+0,false:-1},not_equals:{true:-1,false:+0}};if(n){return t+r[a].true}else{return t+r[a].false}}}return(o=e.length(i))!=null?o:0}function R(e){const t=e["%n"];const n=t==null?void 0:t["%nm"];const r=t==null?void 0:t["%a"];const i=C.includes(n);if(i&&typeof r==="number"){return`${r}_${n}`}else{return""}}},{"../../../constants/core":55,"../../../constants/db":58,"../../../constants/eval":64,"../../../constants/special_keys":87,"../../../db/db_utils":428,"../../../db/postgres_constraints":459,"../../../db/sample":461,"../../../db/values/ConcatList":464,"../../../db/values/IntersectList":466,"../../../db/values/SortedList":470,"../../../db/values/TransformList":474,"../../../db/values/UniqueList":475,"../../../db/values/db_values":476,"../../../lang/btype_ids":652,"../../../lang/evaluation/evaluate":695,"../../../lang/lang":714,"../../../lang/shrink":728,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../../u/shared/decaf":844,"../../../u/shared/incremental":848,"../../core_datasources/utilities/core_ds_db_ops_utilities":232,"../../core_datasources/utilities/core_ds_editor_utilities":233,"../../core_datasources/utilities/core_ds_field_names":235,"../utilities/list_utilities":202,"./../../../lang/btypes":653,"core-js/modules/web.dom-collections.iterator.js":1123}],196:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("./../../../lang/appquery");const s=e("./../../../documentation_id_getter");const o=e("../../../lang/btype_ids");const a=e("./../../../db/postgres_constraints");const l=e("./../../../logger");const c=e("../utilities/list_utilities");const u=e("../../../option_sets");const d=e("./../../../lang/btypes");const p=e("./../../../lib");function _(e){if(!e){throw new r.UnexpectedError("custom option set created without id.")}const t=o.option_set_type(e);const n=i.option_set(e);return f(t,n)}function f(e,t){const n={};r.extend(n,{display:{description:"'s Display",section:"Attributes",public_for_plugins:true,ret_btype:"text",fn(e,n){var r,i;if(!e){return""}return(r=(i=t.value(e))==null?void 0:i.display())!=null?r:""}},equals:{description:" is ",ret_btype:"sys.bool",section:"Operators",arg_btype:e,fn(e,t){return h(e,t)},build_pg_constraint:a.equals,build_pg_r_constraint:a.equals,build_pg_relationship:a.equals_both},not_equals:{description:" is not ",section:"Operators",ret_btype:"sys.bool",arg_btype:e,fn(e,t){return!h(e,t)},build_pg_constraint:a.not_equals,build_pg_r_constraint:a.not_equals,build_pg_relationship:a.not_equals_both},is_empty:{description:" is empty",section:"Operators",ret_btype:"sys.bool",fn(e,t){return!e},build_pg_constraint:a.is_empty},is_not_empty:{description:" is not empty",section:"Operators",ret_btype:"sys.bool",fn(e,t){return!!e},build_pg_constraint:a.is_not_empty},defaulting_to:{description:":defaulting to ",section:"Operators",ret_btype:e,arg_btype:e,fn(e,t){if(e){return e}return t}},is_not_contained_by_list:c.build_is_not_contained_by_list(e),convert_to_list:{description:":converted to list",section:"Operators",ret_btype:o.list_type(e),fn(t,n,r){t=d.get(e).cast(t);if(t==null||t===""){return p().db_instance().static_list(e,[])}else{return p().db_instance().static_list(e,[t])}}}});for(const e in n){const t=n[e];t.documentation_id=s.for_value_messages_option_sets(e)}return{get_message_names(){const e=Object.entries(n).filter((e=>{let[t,n]=e;return!n.hidden})).map((e=>{let[t,n]=e;return t}));const r=t.attributes().filter((e=>!e.deleted())).map((e=>e.name()));return[...r,...e]},get_message_names_reorg(){const e=Object.entries(n).filter((e=>{let[t,n]=e;return!n.hidden&&t!=="display"})).map((e=>{let[t,n]=e;return t}));const r=t.attributes().filter((e=>!e.deleted())).map((e=>e.name()));return["display",...r,...e]},get_message(e){var r,i;const s=n[e];if(s){return s}const a=t.attribute(e);if(!a){return{description:"[missing: "+e+"]",ret_btype:"null",fn(){}}}const c=(r=a.value())!=null?r:"null";let u=false;let _=null;return{description:(i="'s "+a.display())!=null?i:e,section:"Attributes",ret_btype:c,public_for_plugins:true,fn(n,r){var i,s;const a=(i=t.value(n))==null?void 0:(s=i.attr)==null?void 0:s.call(i,e);if(o.is_list(c)){const e=o.list_element_type(c);return p().db_instance().static_list(e,a!=null?a:[])}const f=d.get(c);if(!f){l.owner_error("Missing field on option set",{display:"Missing field in Option Set used for dynamic property"});return a!=null?a:null}if(a!=null){return f.cast(a)}if(!u){_=f.get_bubble_null();u=true}return _},delete_cb(){if(window.confirm("Delete attribute "+a.display()+"?")){return a.set_deleted(true)}}}},display(){return t.display()},debugging_display(e){e=this.cast(e);if(!e){return""}else{var n,r;const s=t.value(e);if(s!=null&&(n=s.deleted)!=null&&n.call(s)){return`(Deleted Option with ID: "${e}")`}else if(s!=null&&(r=s.display)!=null&&r.call(s)){var i;return s==null?void 0:(i=s.display)==null?void 0:i.call(s)}else{return`(Option with invalid id "${e}" for option set "${t.display()}")`}}},option_set(){return t},is_option_set:true,equals:h,from_human(e){return this.JS_to_bubble(e)},get_sample(){var e,n;return(e=(n=t.values()[0])==null?void 0:n.name())!=null?e:null},get_bubble_null(){return null},storable:true,bindable:false,export_to_string(e,n){const r=t.value(e);if(r!=null&&r.deleted()&&n.option_show_if_deleted){return"(deleted option)"}return r==null?void 0:r.display()},get_JS_object(e){var n,r,i;if(typeof e!=="string"||e===""){return null}return(n=(r=t.value(e))==null?void 0:(i=r.display)==null?void 0:i.call(r))!=null?n:null},JS_to_bubble(e){if(typeof e!=="string"||e===""){return null}for(const n of t.values()){if(n.display()===e&&!n.deleted()){return n.id()}}return null},cast(e){if(e==null){return null}if(typeof e==="string"){var n;if((n=t.value(e))!=null&&n.exists()){return e}else{return u.get_safe_id(e,{reserved:t.reserved_values()})}}else{return null}}}}t.exports={get:_,list(){return i.option_sets(undefined,true).map((e=>e.name()))},display(){return"option set"}};function h(e,t){return e===t}},{"../../../lang/btype_ids":652,"../../../option_sets":748,"../../../u":823,"../utilities/list_utilities":202,"./../../../db/postgres_constraints":459,"./../../../documentation_id_getter":486,"./../../../lang/appquery":651,"./../../../lang/btypes":653,"./../../../lib":741,"./../../../logger":744,"core-js/modules/web.dom-collections.iterator.js":1123}],197:[function(e,t,n){"use strict";const r=e("../../../u");const{generate_JS_to_bubble_error:i}=e("../utilities/misc_utilities");const s=e("../utilities/list_utilities");const o=e("../../../db/hydrate");const a=e("../../../db/values/StaticObject");const l=e("./../../../lang/btypes");const c=e("./../../../lib");const u=e("../../../u/shared/decaf");t.exports={list(){},display(){return"struct"},get(e){const{caption:t,definition:n}=JSON.parse(r.base64decode(e));const d="struct."+e;if(typeof n!=="object"){throw new r.UnexpectedError("Bad struct val: "+e)}const p={};for(const e in n){const t=n[e];p[t[0]]=e}return{get_message_names(){return u.object_keys(n)},get_message_names_reorg(){return u.object_keys(n)},get_message(e){var t,r,i,s;return{description:(t="'s "+((r=n[e])==null?void 0:r[0]))!=null?t:"[Missing: "+e,ret_btype:(i=(s=n[e])==null?void 0:s[1])!=null?i:"null",is_lookup:true}},get_message_reorg(e){var t,r,i,s;return{description:(t="'s "+((r=n[e])==null?void 0:r[0]))!=null?t:"[Missing: "+e,section:"Field Data",ret_btype:(i=(s=n[e])==null?void 0:s[1])!=null?i:"null",is_lookup:true}},display(){return t},equals(e,t){for(const r in n){const i=n[r];const s=e.child(r).get();const o=t.child(r).get();if(!l.get(i[1]).equals(s,o)){return false}}return true},is_not_contained_by_list:s.build_is_not_contained_by_list(d),get_sample(){const e={};for(const t in n){const r=n[t];e[t]=l.get(r[1]).get_sample()}return new a(e,null,d)},get_bubble_null(){return null},cast(e){if(typeof e!=="object"||!e){return this.get_bubble_null()}else if(typeof e.raw==="function"){if(e.value_id===d){return e}else{return new a(e,e.db,d)}}else{try{return new a(JSON.parse(JSON.stringify(e)),null,d)}catch(e){return this.get_bubble_null()}}},storable:false,bindable:true,is_aggregate:t==="Grouping",get_JS_object(e){if(typeof(e==null?void 0:e.raw)!=="function"){return null}const t=e.raw();if(typeof t!=="object"){return null}const r={};for(const e in n){const i=n[e];const s=o.rehydrate_tree(c().db_instance(),t[e]);r[i[0]]=l.get(i[1]).get_JS_object(s)}return r},JS_to_bubble(e){if(e==null){return this.get_bubble_null()}if(typeof e!=="object"){i(this.display(),e)}const t={};for(const i in e){const s=e[i];if(!n[i]){throw new r.UnexpectedError("the key "+i+" is not part of the btype definition")}t[i]=l.get(n[i][1]).JS_to_bubble(s)}return new a(t,null,d)}}}}},{"../../../db/hydrate":429,"../../../db/values/StaticObject":473,"../../../u":823,"../../../u/shared/decaf":844,"../utilities/list_utilities":202,"../utilities/misc_utilities":203,"./../../../lang/btypes":653,"./../../../lib":741}],198:[function(e,t,n){"use strict";const{add_basic_element_messages:r}=e("../utilities/misc_utilities");const i=e("./../../core_elements/core_elements_utilities/element_registry");const s=e("./../../core_events/event_element_mapping");t.exports={get(e){const t={};const n=i.get_element_object(e);if(n!=null){r(n.get_states(),t,s.has_event("ButtonClicked",e))}for(const e in t){const n=t[e];n.documentation_id="Documentation.Elements.GeneralConcepts.States."+e}return{display(){return"style"},get_message_names(){return Object.keys(t)},get_message(e){return t[e]},cast(e){return e},storable:false,bindable:false}},list(){return[]},display(){return"style"}}},{"../utilities/misc_utilities":203,"./../../core_elements/core_elements_utilities/element_registry":284,"./../../core_events/event_element_mapping":376}],199:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("./../../../db/postgres_constraints");const s=e("../../../u/shared/b_string");const o=e("../../../db/values/StaticObject");const{render_bool:a,bool_equals:l,to_bool:c,format_boolean_message:u,format_boolean_number_message:d}=e("../utilities/boolean_utilities");const{build_simple:p}=e("../utilities/generate_utilities");const{COMPOSER_INPUT_TYPES:_}=e("../../../constants/composer");t.exports={get(e){if(e==="error"){return p(e,{messages:{code:{description:"'s code",ret_btype:"text",fn(e,t){return e==null?void 0:e.child("code").get()}},message:{description:"'s message",ret_btype:"text",fn(e,t){return e==null?void 0:e.child("message").get()}}},messages_reorganized:{code:{description:"'s code",section:"Data Fields",ret_btype:"text",fn(e,t){return e==null?void 0:e.child("code").get()}},message:{description:"'s message",section:"Data Fields",ret_btype:"text",fn(e,t){return e==null?void 0:e.child("message").get()}}},display(){return"Error"},runmode_display(e){return e==null?void 0:e.child("message").get()},equals(){return false},storable:false,bindable:false,get_sample(){return new o({code:"SAMPLE",message:"THIS IS A SAMPLE"},null,"sys.error")},convert_to_bubble_instance(e){return e},cast(e){return e}})}else if(e==="json"){return p(e,{display(){return"json"},runmode_display(e){return JSON.stringify(e)},equals(e,t){return JSON.stringify(e)===JSON.stringify(t)},storable:false,bindable:false,get_sample(){return{}},cast(e){return e},messages:{},messages_reorganized:{}})}else if(e==="bool"){return p(e,{messages:{and_:{description:" and ",ret_btype:"sys.bool",arg_btype:"sys.bool",fn(e,t){return c(e)&&c(t)},can_shortcircuit_args(e){var t;return((t=c(e))!=null?t:false)===false}},or_:{description:" or ",ret_btype:"sys.bool",arg_btype:"sys.bool",fn(e,t){return c(e)||c(t)},can_shortcircuit_args(e){return c(e)===true}},format_boolean:u,format_boolean_number:d},messages_reorganized:{and_:{description:" and ",section:"Operators",ret_btype:"sys.bool",arg_btype:"sys.bool",fn(e,t){return c(e)&&c(t)},can_shortcircuit_args(e){var t;return((t=c(e))!=null?t:false)===false}},or_:{description:" or ",section:"Operators",ret_btype:"sys.bool",arg_btype:"sys.bool",fn(e,t){return c(e)||c(t)},can_shortcircuit_args(e){return c(e)===true}},format_boolean:u,format_boolean_number:d},display(){return"yes / no"},composer_input_type:_.BOOLEAN,runmode_display:a,export_to_string(e,t){if(t.booleans_yes_no){return a(e)}else{return e!=null?e:false}},equals:l,storable:false,bindable:false,synonyms:["boolean"],get_sample(){return true},convert_to_bubble_instance:c,cast(e){return c(e)},get_JS_object(e){var t;return(t=this.cast(e))!=null?t:false}})}else if(e==="uid"){return p(e,{display(){return"unique identifier"},composer_input_type:_.TEXT,equals(e,t){return e===t},storable:false,bindable:false,synonyms:["text"],get_sample(){return"asdf234sdz"},cast:s.cast_to_string,runmode_display:s.cast_to_string,messages:{equals:{description:" is ",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return e===t},build_pg_constraint:i.equals,build_pg_r_constraint:i.equals,build_pg_relationship:i.equals_both},not_equals:{description:" is not ",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return e!==t},build_pg_constraint:i.not_equals,build_pg_r_constraint:i.not_equals,build_pg_relationship:i.not_equals_both},is_empty:{description:" is empty",ret_btype:"sys.bool",build_pg_constraint:i.is_empty,fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",ret_btype:"sys.bool",build_pg_constraint:i.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}},trimmed:{description:":trimmed",ret_btype:"text",arg_btype:null,fn(e,t){var n;return e==null?void 0:(n=e.trim)==null?void 0:n.call(e)}},length:{description:":number of characters",ret_btype:"number",arg_btype:null,fn(e,t){if(!e){return 0}return e.length}},truncated:{description:":truncated to ",ret_btype:"text",arg_btype:"number",fn(e,t){if(typeof e!=="string"){return this.ret_btype_null()}if(!t){return e}else{return e.slice(0,r.to_num(t))}}},truncated_right:{description:":truncated from end to ",ret_btype:"text",arg_btype:"number",fn(e,t){if(typeof e!=="string"){return this.ret_btype_null()}if(!t){return e}else{let n=e.length-r.to_num(t);if(n<0){n=0}return e.slice(n)}}}},messages_reorganized:{equals:{description:" is ",section:"Operators",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return e===t},build_pg_constraint:i.equals,build_pg_r_constraint:i.equals,build_pg_relationship:i.equals_both},not_equals:{description:" is not ",section:"Operators",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){return e!==t},build_pg_constraint:i.not_equals,build_pg_r_constraint:i.not_equals,build_pg_relationship:i.not_equals_both},is_empty:{description:" is empty",section:"Operators",ret_btype:"sys.bool",build_pg_constraint:i.is_empty,fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",section:"Operators",ret_btype:"sys.bool",build_pg_constraint:i.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}},trimmed:{description:":trimmed",section:"Other Operators",ret_btype:"text",arg_btype:null,fn(e,t){var n;return e==null?void 0:(n=e.trim)==null?void 0:n.call(e)}},length:{description:":number of characters",section:"Other Operators",ret_btype:"number",arg_btype:null,fn(e,t){if(!e){return 0}return e.length}},truncated:{description:"truncated to ",section:"Other Operators",ret_btype:"text",arg_btype:"number",fn(e,t){if(typeof e!=="string"){return this.ret_btype_null()}if(!t){return e}else{return e.slice(0,r.to_num(t))}}},truncated_right:{description:"truncated from end to ",section:"Other Operators",ret_btype:"text",arg_btype:"number",fn(e,t){if(typeof e!=="string"){return this.ret_btype_null()}if(!t){return e}else{let n=e.length-r.to_num(t);if(n<0){n=0}return e.slice(n)}}}}})}},list(){return[]},display(){return"sys"}}},{"../../../constants/composer":54,"../../../db/values/StaticObject":473,"../../../u":823,"../../../u/shared/b_string":841,"../utilities/boolean_utilities":200,"../utilities/generate_utilities":201,"./../../../db/postgres_constraints":459}],200:[function(e,t,n){"use strict";const r=n;const i=e("../../../lib");r.format_boolean_message={section:"Other Operators",ret_btype:"text",arg_btype:null,fn(e,t,n){if(e){var r;return(r=n.formatting_for_true)!=null?r:""}else{var i;return(i=n.formatting_for_false)!=null?i:""}},spot_data:"SlidableAtom",description(e){return":formatted as text"},description_for_sliding_palette:"Boolean Formatting",fields(){return[{name:"formatting_for_true",caption:"Formatting for yes",editor:"LongText",optional:true},{name:"formatting_for_false",caption:"Formatting for no",editor:"LongText",optional:true}]},field_names:{formatting_for_true:{default:"yes"},formatting_for_false:{default:"no"}}};r.format_boolean_number_message={section:"Other Operators",ret_btype:"number",arg_btype:null,fn(e,t,n){if(e){var r;return(r=n.formatting_for_true)!=null?r:0}else{var i;return(i=n.formatting_for_false)!=null?i:0}},spot_data:"SlidableAtom",description(e){return":formatted as number"},description_for_sliding_palette:"Boolean Formatting",fields(){return[{name:"formatting_for_true",caption:"Formatting for yes",editor:"StaticNumber"},{name:"formatting_for_false",caption:"Formatting for no",editor:"StaticNumber"}]},field_names:{formatting_for_true:{default:1},formatting_for_false:{default:0}}};r.to_bool=function(e){if(typeof e==="boolean"){return e}else if(typeof e==="string"){e=e.toLowerCase();switch(e){case"yes":case"true":return true;case"no":case"false":return false;default:return null}}else{return null}};r.render_bool=function(e){e=r.to_bool(e);if(e==null){return""}else{if(e){return i().get_text("BUILT_IN","YES")}else{return i().get_text("BUILT_IN","NO")}}};r.bool_equals=(e,t)=>r.to_bool(e)===r.to_bool(t)},{"../../../lib":741}],201:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../u");const s=e("../../../lang/appquery");const o=e("../../../documentation_id_getter");const a=e("../../../lang/btype_ids");const l=e("../../../constants/eval");const c=e("../../../logger");const u=e("../../../shared/slug");const d=e("../../url_data");const p=e("../../../lang/btypes");const _=e("../../../lib");const f=e("../../../db/sample");const h=e("../../../db/hydrate");const m=e("./list_utilities");r.add_basic_displays=function(e){if(!("export_to_string"in e)){e.export_to_string=e.runmode_display}if(!("debugging_display"in e)){e.debugging_display=e.runmode_display}return e};r.build_simple=function(e,t){var n,i;const{messages:s,messages_reorganized:a}=t;let l=e;if(l==="bool"){l="sys.bool"}if(!["null","geographic_address","key_combination"].includes(l)){s.is_not_contained_by_list=m.build_is_not_contained_by_list(l);a.is_not_contained_by_list=m.build_is_not_contained_by_list(l)}for(const t in s){const n=s[t];n.documentation_id=o.for_value_messages(e,t)}for(const t in a){const n=a[t];n.documentation_id=o.for_value_messages(e,t)}delete t.messages;t.get_message_names=()=>Object.keys(s);t.get_message=e=>s[e];t.get_message_names_reorg=()=>Object.keys(a);t.get_message_reorg=e=>a[e];t.name=e;(n=t.is_simple)!=null?n:t.is_simple=true;(i=t.get_bubble_null)!=null?i:t.get_bubble_null=()=>null;r.add_basic_displays(t);return t};function g(e){if(typeof(e==null?void 0:e._id)==="function"){return e._id()}else if(typeof(e==null?void 0:e.get)==="function"){const t=e.get();if(typeof(t==null?void 0:t.replace)==="function"){return t.replace(l.HYDRATE_STRING,"")}}else{return undefined}}function v(e,t){return g(e)===g(t)}r.create_custom_btype=function(e,t,n,r,m){const g={};let x;if(n){const[e,t]=n();x=t;i.extend(g,e)}if(!m){i.extend(g,{"Created By":{description:"'s Creator",ret_btype:"user",section:"Data Fields",is_lookup:true},Slug:{description:"'s Slug",ret_btype:"text",section:"Other Operators",is_lookup:true},equals:{description:" is ",ret_btype:"sys.bool",section:"Operators",arg_btype:e,fn(e,t){return v(e,t)},build_pg_constraint:b.equals,build_pg_r_constraint:b.equals,build_pg_relationship:b.equals_both},not_equals:{description:" is not ",ret_btype:"sys.bool",section:"Operators",arg_btype:e,fn(e,t){return!v(e,t)},build_pg_constraint:b.not_equals,build_pg_r_constraint:b.not_equals,build_pg_relationship:b.not_equals_both},is_empty:{description:" is empty",ret_btype:"sys.bool",section:"Other Operators",fn(e,t){var n;return!(e!=null&&(n=e.exists)!=null&&n.call(e))},build_pg_constraint:b.is_empty},is_not_empty:{description:" is not empty",section:"Other Operators",ret_btype:"sys.bool",fn(e,t){var n,r;return(n=e==null?void 0:(r=e.exists)==null?void 0:r.call(e))!=null?n:false},build_pg_constraint:b.is_not_empty},slug_can_be:{description:" can have the slug value ",section:"Other Operators",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){var n;if(e!=null&&(n=e.exists)!=null&&n.call(e)){return u.is_slug_valid(_().appname(),_().app_version(),e._type(),t,e)}}},slug_cannot_be:{description:" cannot have the slug value ",section:"Other Operators",ret_btype:"sys.bool",arg_btype:"text",fn(e,t){var n;if(e!=null&&(n=e.exists)!=null&&n.call(e)){return!u.is_slug_valid(_().appname(),_().app_version(),e._type(),t,e)}}},"Created Date":{description:"'s Creation Date",section:"Data Fields",ret_btype:"date",is_lookup:true,privacy_condition_okay:false},"Modified Date":{description:"'s Modified Date",section:"Data Fields",ret_btype:"date",is_lookup:true,privacy_condition_okay:false},_id:{description:"'s unique id",section:"Data Fields",public_for_plugins:true,ret_btype:"text",fn(e,t){var n;if(e!=null&&(n=e.exists)!=null&&n.call(e)){var r;return e==null?void 0:(r=e._id)==null?void 0:r.call(e)}else{return""}}},id_link:{ret_btype:"text",section:"Data Fields",field_names:{element_id:{}},spot_data:"SlidableAtom",description:"'s link",description_for_sliding_palette:"Link Destination",fields(){return[{name:"element_id",caption:"Page to send this to",editor:"Dropdown",set:_().sets.get_set("Filtered")(_().sets.get_set("Pages")(),(t=>{if(w.get_sorted_list_of_pages().length>120){return true}const n=s.element(t.value);return(n==null?void 0:n.get_static_property("page_item_type"))===e}))}]},fn(e,t,n){var r;const i=e==null?void 0:(r=e._id)==null?void 0:r.call(e);if(!i){return this.ret_btype_null()}const o=s.element(n.element_id);if(!o||o.name==null){return this.ret_btype_null()}const a=o.get_static_property("readable_field");const l=d.get_data_to_send(e,a);return _().location.get_page_url(o.name()+"/"+l)}},convert_to_list:{description:":converted to list",section:"Other Operators",ret_btype:a.list_type(e),fn(t,n,r){t=p.get(e).cast(t);if(t==null){return _().db_instance().static_list(e,[])}else{return _().db_instance().static_list(e,[t])}}}})}if(r){for(const e of r()){delete g[e]}}const j=e==="user"?"user":"custom";for(const e in g){const t=g[e];t.documentation_id=o.for_value_messages_custom_types(j,e)}function A(){if(!t.exists()&&a.is_custom_type(e)){return`[missing type: ${e.slice(7)}]`}if(t.display()==null){return`[Type with missing display: ${e.slice(7)}]`}return t.display()}let M=null;if(!t.exists()&&a.is_custom_type(e)){M=e=>`(Value is of an unknown type ${A()} and cannot be displayed)`}function E(e){var n,r,i,s,o,a;const l=g[e];if(l){return l}const c=t.field(e);if(!c){return{description:"[missing: "+e+"]",ret_btype:"null",fn(){}}}let u="";const d=(n=c.value())==null?void 0:n.replace(/^list\./,"");if(d&&(r=p.get(d))!=null&&(i=r.custom_type)!=null&&(s=i.call(r))!=null&&s.deleted()){u=" (deleted)"}const _=(o=c.value())!=null?o:"null";return{description:(a="'s "+c.display()+u)!=null?a:e,section:"Data Fields",ret_btype:_,is_lookup:true,delete_cb(){if(window.confirm("Delete field "+c.display()+"?")){c.set_deleted(true)}}}}return{get_message_names(){const e=t.fields().filter((e=>!e.deleted())).map((e=>e.name()));if(t.no_special_messages){return e}const n=Object.keys(g).filter((e=>!g[e].hidden));return e.concat(n)},get_message_names_reorg(){var e,n,r,i;const s=t.fields().filter((e=>!e.deleted())).map((e=>e.name()));if(t.no_special_messages){return s}return["equals","not_equals",...s,...(e=(n=x)==null?void 0:n.filter((e=>e.high_priority)).map((e=>e.value)))!=null?e:[],"Created By","Slug","Created Date","Modified Date","_id","id_link",...(r=(i=x)==null?void 0:i.filter((e=>!e.high_priority)).map((e=>e.value)))!=null?r:[],"is_empty","is_not_empty","slug_can_be","slug_cannot_be","convert_to_list"].filter((e=>s.includes(e)||Object.keys(g).includes(e)))},get_message:E,get_message_reorg:E,display:A,custom_type(){return t},equals:v,from_human(e){return this.JS_to_bubble(e)},get_sample(){return new f.SampleObject(e)},get_bubble_null(){return null},storable:true,bindable:true,debugging_display:M,export_to_string(t,n){var r,i;if(!n.custom_use_primary_field){if(e==="user"||t!=null&&t.exists()){return t==null?void 0:t._id()}else{return""}}(r=n.visited_field_types)!=null?r:n.visited_field_types=new Map;if(e==="user"){var o,a;const e=_().db_instance(s.appname(),s.app_version());if(t.id===e.get_admin_user_id()||(o=(a=_()).app_owners)!=null&&o.call(a)[t.id]){return"(App admin)"}}if(!(t!=null&&(i=t.exists)!=null&&i.call(t))){return"(deleted thing)"}const l=n.get_primary_field(e);const c=new p.Message(l,E(l),e);const u=c.ret_btype();if(n.visited_field_types.get(e)){const t=n.visited_field_types.keys().next().value;return`(Circular reference between primary fields for ${p.get(t).display()} and ${p.get(e).display()}. Change primary fields)`}else{n.visited_field_types.set(e,true);return u.export_to_string(c.evaluate(t),n)}},get_JS_object(t){if(t==null){return null}if(typeof t==="string"){if(i.starts_with(t,l.HYDRATE_STRING)){t=t.replace(l.HYDRATE_STRING,"")}return t}const n={};for(const r of this.get_message_names()){if(y.can_use_message(e,r)){const i=new p.Message(r,this.get_message(r),e);const s=i.evaluate_without_cast(t);if(s){const e=i.ret_btype();if(e.is_missing()){n[r]=null}else if(e.custom_type()){n[r]=s._id()}else if(e.is_list()&&e.inner().custom_type()){n[r]=s.all().map((e=>e._id()))}else{n[r]=p.get(e).get_JS_object(s)}}}}n._type=e;return n},JS_to_bubble(e){if(typeof e==="string"&&e!==""){return _().db_instance().get(e)}return null},cast(e){if(typeof(e==null?void 0:e.child)==="function"){return e}else if(typeof e==="string"&&i.starts_with(e,l.HYDRATE_STRING)){c.error("Got dehydrated object in cast; should probably be hydrated here",{val:e});return this.cast(h.rehydrate_tree(_().db_instance(),e))}else{return null}}}};const b=e("../../../db/postgres_constraints");const y=e("../../../pluginservice");const w=e("../../../lang/application")},{"../../../constants/eval":64,"../../../db/hydrate":429,"../../../db/postgres_constraints":459,"../../../db/sample":461,"../../../documentation_id_getter":486,"../../../lang/application":650,"../../../lang/appquery":651,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lib":741,"../../../logger":744,"../../../pluginservice":756,"../../../shared/slug":808,"../../../u":823,"../../url_data":416,"./list_utilities":202,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],202:[function(e,t,n){"use strict";const r=n;const i=e("../../../db/values/db_values");const s=e("../../../lang/btypes");const o=e("../../../lang/btype_ids");const a=e("../../../u/shared/async/b_fiber");const l=e("../../../lib");r.build_is_not_contained_by_list=e=>({description:" is not in ",section:"Other Operators",ret_btype:"sys.bool",arg_btype:o.list_type(e),fn:(t,n)=>{const i=s.get(e);t=i.cast(t);return!r.process_list_arg(e,n).contains(t,i)}});r.process_list_arg=(e,t)=>{var n;return(n=r.cast_to_list(e,t))!=null?n:r.array_to_static_list(e,[])};r.cast_to_list=(e,t)=>{if(i.registry.is(t,i.LIST_WRAPPER)){if(s.get(t.get_item_btype_id()).matches(e)){return t}else{return r.list_get_bubble_null()}}else if(Array.isArray(t)){return r.array_to_static_list(e,t)}else{return r.list_get_bubble_null()}};r.array_to_static_list=(e,t)=>{const n=s.get(e);const r=t.map(((e,t)=>{if(t%10===9)a.optional_pause();return n.cast(e)})).filter((e=>e!=null));return l().db_instance().static_list(e,r)};r.list_get_bubble_null=()=>null},{"../../../db/values/db_values":476,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lib":741,"../../../u/shared/async/b_fiber":833}],203:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../u");const s=e("../../../client_config");const o=e("../../../u/shared/mode_check");const a=e("../../../u/shared/b_string");const l=e("../../../u/shared/b_file_shared");const c=e("../../../db/postgres_constraints");const u=e("../../../constants/redis");const d=e("../../core_elements/core_elements_utilities/element_workflows");const p=e("../../../lang/btypes");const _=e("../../../lib");const f=e("../../../lang/evaluation/FrozenState");const h=e("../../../lang/evaluation/page_state");const m=e("../../../lang/evaluation/element_eval");let g;if(o.on_server()){const t=e;g=t("./../../../server/fileupload")}r.generate_JS_to_bubble_error=function(e,t){throw new i.UnexpectedError(`Expected a ${e}, but got a `+typeof t+" (original data: "+i.json_stringify(t,true)+")")};r.get_json_encode_msg=e=>({description:":formatted as JSON-safe",section:"Other Operators",ret_btype:"text",fn(t){var n;let r=p.get(e).cast(t);(n=r)!=null?n:r=null;const s=i.json_stringify(r);return s}});r.get_file_messages=function(e){return{is_empty:{description:" is empty",ret_btype:"sys.bool",build_pg_constraint:c.is_empty,fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",ret_btype:"sys.bool",build_pg_constraint:c.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}},file_name:{description:"'s file name",ret_btype:"text",arg_btype:null,fn(e,t){if(!(e!=null&&e.split)){return this.ret_btype_null()}const n=e.split("/");return decodeURIComponent(n[n.length-1])}},url:{description:"'s URL",ret_btype:"text",arg_btype:null,fn(e,t){return a.cast_to_string(e)}},saved_s3:{description:":saved to S3",ret_btype:e,arg_btype:null,spot_data:"SlidableAtom",field_names:{file_name_override:{optional:true}},description_for_sliding_palette:"Saving to S3",fields(){return[{name:"file_name_override",caption:"New file name",editor:"ShortText",value:"text"},{name:"information",editor:"Label",label_text:"If a new name is not set, the file will be named based on the original URL"}]},filter_context(e){return e.is_workflow},filter_context_new(e){return e.owner_type==="Workflow"||e.owner_type==="BackendWorkflow"},fn(e,t,n){if(e==null||!e.split){return this.ret_btype_null()}e=e.replace("/../","/");if(e.includes(s.user_file_url)||e.includes(l.get_file_cdn_url(_().appname()))){return e}if(!i.is_url(e)){return this.ret_btype_null()}if(e.indexOf("blob:")===0){return this.ret_btype_null()}if(!o.on_server()||o.running_test()){return e}const r=_().KeyValueDB().get(u.INSTANCE_NAMES.SMALL,e);if(r!=null){return r}let a;if(n.file_name_override){a=n.file_name_override.split("/").pop()}else{a=e.split("/").pop()}const c={file_url:e,filename:a,appname:_().appname(),app_version:_().app_version()};const d=g.upload_by_url(c);_().KeyValueDB().put(u.INSTANCE_NAMES.SMALL,e,d,5*60);return d}},to_base64:{description:":encoded in base64",ret_btype:"text",arg_btype:null,filter_context(e){return e.is_workflow},filter_context_new(e){return e.owner_type==="Workflow"||e.owner_type==="BackendWorkflow"},fn(e,t){if(e==null||!e.split){return this.ret_btype_null()}if(!o.on_server()){return this.ret_btype_null()}if(e.slice(0,2)==="//"){e="http:"+e}if(e.indexOf("http")!==0){return this.ret_btype_null()}const n=_().http_request({url:e,encoding:null}).block().body;return i.base64(n)}},not_equals:{description:" is not ",ret_btype:"sys.bool",arg_btype:"date",no_composer(){return true},fn(e,t){return!(e===t)}}}};r.get_file_messages_reorg=function(e){return{is_empty:{description:" is empty",section:"Operators",ret_btype:"sys.bool",build_pg_constraint:c.is_empty,fn(e,t){return e===undefined||e===null||e===""}},is_not_empty:{description:" is not empty",section:"Operators",ret_btype:"sys.bool",build_pg_constraint:c.is_not_empty,fn(e,t){return e!==undefined&&e!==null&&e!==""}},file_name:{description:"'s file name",section:"Operators",ret_btype:"text",arg_btype:null,fn(e,t){if(!(e!=null&&e.split)){return this.ret_btype_null()}const n=e.split("/");return decodeURIComponent(n[n.length-1])}},url:{description:"'s URL",section:"Operators",ret_btype:"text",arg_btype:null,fn(e,t){return a.cast_to_string(e)}},saved_s3:{description:":saved to S3",section:"Other Operators",ret_btype:e,arg_btype:null,spot_data:"SlidableAtom",field_names:{file_name_override:{optional:true}},description_for_sliding_palette:"Saving to S3",fields(){return[{name:"file_name_override",caption:"New file name",editor:"ShortText",value:"text"},{name:"information",editor:"Label",label_text:"If a new name is not set, the file will be named based on the original URL"}]},filter_context(e){return e.is_workflow},filter_context_new(e){return e.owner_type==="Workflow"||e.owner_type==="BackendWorkflow"},fn(e,t,n){if(e==null||!e.split){return this.ret_btype_null()}e=e.replace("/../","/");if(e.indexOf(s.user_file_url)!==-1){return e}if(!i.is_url(e)){return this.ret_btype_null()}if(e.indexOf("blob:")===0){return this.ret_btype_null()}if(!o.on_server()||o.running_test()){return e}const r=_().KeyValueDB().get(u.INSTANCE_NAMES.SMALL,e);if(r!=null){return r}let a;if(n.file_name_override){a=n.file_name_override.split("/").pop()}else{a=e.split("/").pop()}const l={file_url:e,filename:a,appname:_().appname(),app_version:_().app_version()};const c=g.upload_by_url(l);_().KeyValueDB().put(u.INSTANCE_NAMES.SMALL,e,c,5*60);return c}},to_base64:{description:":encoded in base64",section:"Other Operators",ret_btype:"text",arg_btype:null,filter_context(e){return e.is_workflow},filter_context_new(e){return e.owner_type==="Workflow"||e.owner_type==="BackendWorkflow"},fn(e,t){if(e==null||!e.split){return this.ret_btype_null()}if(!o.on_server()){return this.ret_btype_null()}if(e.slice(0,2)==="//"){e="http:"+e}if(e.indexOf("http")!==0){return this.ret_btype_null()}const n=_().http_request({url:e,encoding:null}).block().body;return i.base64(n)}},not_equals:{description:" is not ",section:"Other Operators",ret_btype:"sys.bool",arg_btype:"date",no_composer(){return true},fn(e,t){return!(e===t)}}}};const v={};const b={};r.add_basic_element_messages=function(e,t,n){if(n){function r(e){if(!v[e.element_id()]){v[e.element_id()]=e.element.get_related_workflows("ButtonClicked")}return v[e.element_id()]}i.extend(t,{isnt_clickable:{description:" isn't clickable",section:"States",ret_btype:"boolean",fn(e,t){if(!e){return this.ret_btype_null()}if(o.on_server()){return e.state("client_eval_isnt_clickable")}function n(){if(m.evaluate_property(e,"button_disabled")){return true}else{let t=false;const n=e.toUniqueString();if(b[n]){delete b[n];t=true}b[n]=true;const i={element:e,datasources:h.get_basic_datasources(e.element.root())};const s=r(e);const o=d.find_inputs_to_check(e,s,i,t);for(const e of o.input_instances){if(e.element.get_states().includes("is_invalid")&&e.state("is_invalid")){return true}}return false}}const i=n();if(!e.is_fake_instance){var s,a;(s=f.dehydrate_context)==null?void 0:(a=s.save_to_state)==null?void 0:a.call(s,e,"client_eval_isnt_clickable",i)}return i},filter_context(e){return e.is_state||e.is_event_condition},filter_context_new(e){return e.owner_type==="State"||(e.owner_type==="Workflow"||e.owner_type==="BackendWorkflow")&&e.in_event_condition}}})}if(e.includes("is_link_disabled")){i.extend(t,{is_clickable:{description:" is clickable",section:"States",ret_btype:"sys.bool",fn(e,t){return!(e!=null&&e.state("link_disabled"))}},isnt_clickable:{description:" isn't clickable",section:"States",ret_btype:"sys.bool",fn(e,t){return e==null?void 0:e.state("link_disabled")}}})}if(e.includes("display_invalid")){i.extend(t,{is_valid:{description:" is valid",section:"States",ret_btype:"sys.bool",fn(e,t){return!(e!=null&&e.state("display_invalid"))}},isnt_valid:{description:" isn't valid",section:"States",ret_btype:"sys.bool",fn(e,t){return e==null?void 0:e.state("display_invalid")}}})}i.extend(t,{get_width:{description:"'s width",section:"States",ret_btype:"number",fn(e,t){return e==null?void 0:e.state("current_width")}},get_height:{description:"'s height",section:"States",ret_btype:"number",fn(e,t){return e==null?void 0:e.state("current_height")}}});if(e.includes("is_hovered")){i.extend(t,{is_hovered:{description:" is hovered",section:"States",ret_btype:"sys.bool",fn(e,t){return e==null?void 0:e.state("is_hovered")},filter_context(e){var t,n;if(e.is_state){return e.is_state}const r=["ConditionTrue","DoInterval","interactions-PageScrolled"];const i=(t=(n=e.node.owner).type)==null?void 0:t.call(n);const s=r.includes(i);return e.is_event_condition&&s},filter_context_new(e){if(e.owner_type==="State"){return true}const t=["ConditionTrue","DoInterval","interactions-PageScrolled"];return e.owner_type==="Workflow"&&e.in_event_condition&&t.includes(e.owner_node.type())}},isnt_hovered:{description:" isn't hovered",section:"States",ret_btype:"sys.bool",fn(e,t){return!(e!=null&&e.state("is_hovered"))},filter_context(e){var t,n;if(e.is_state){return e.is_state}const r=["ConditionTrue","DoInterval","interactions-PageScrolled"];const i=(t=(n=e.node.owner).type)==null?void 0:t.call(n);const s=r.includes(i);return e.is_event_condition&&s},filter_context_new(e){if(e.owner_type==="State"){return true}const t=["ConditionTrue","DoInterval","interactions-PageScrolled"];return e.owner_type==="Workflow"&&e.in_event_condition&&t.includes(e.owner_node.type())}},is_pressed:{description:" is pressed",section:"States",ret_btype:"sys.bool",fn(e,t){return e==null?void 0:e.state("is_pressed")},filter_context(e){return e.is_state},filter_context_new(e){return e.owner_type==="State"}},isnt_pressed:{description:" isn't pressed",section:"States",ret_btype:"sys.bool",fn(e,t){return!(e!=null&&e.state("is_pressed"))},filter_context(e){return e.is_state},filter_context_new(e){return e.owner_type==="State"}}})}if(e.includes("is_focused")){return i.extend(t,{is_focused:{description:" is focused",section:"States",ret_btype:"sys.bool",fn(e,t){return e==null?void 0:e.state("is_focused")},filter_context(e){return e.is_state},filter_context_new(e){return e.owner_type==="State"}},isnt_focused:{description:" isn't focused",section:"States",ret_btype:"sys.bool",fn(e,t){return!(e!=null&&e.state("is_focused"))},filter_context(e){return e.is_state},filter_context_new(e){return e.owner_type==="State"}}})}}},{"../../../client_config":41,"../../../constants/redis":81,"../../../db/postgres_constraints":459,"../../../lang/btypes":653,"../../../lang/evaluation/FrozenState":687,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/page_state":698,"../../../lib":741,"../../../u":823,"../../../u/shared/b_file_shared":837,"../../../u/shared/b_string":841,"../../../u/shared/mode_check":851,"../../core_elements/core_elements_utilities/element_workflows":288,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],204:[function(e,t,n){"use strict";const r=n;const i=e("../../../constants/currency");const s=e("../../../lib");const o=e("../../../safe_require");o.safe_register("./core/core_btypes/utilities/numeric_format_utilities",r);r.thousand_separators={comma:",",space:"Space",dot:"."};r.decimal_separators={point:".",comma:","};r.format_number_names={formatting_type:{default:"number",no_states:true},decimal_place:{},decimal_separator:{default:"point"},thousand_separator:{},currency_symbol:{},negative_parenthese:{}};r.format_number_fields=()=>[{name:"formatting_type",caption:"Number type",editor:"Dropdown",set:s().sets.get_set("Object")({number:"Number",currency:"Currency",percentage:"Percentage"})},{name:"decimal_place",caption:"Decimal place",editor:"Dropdown",set:s().sets.get_set("Integer")([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),numerical_step:1,optional:true,pretty:{dropdown_width:"short"}},{name:"decimal_separator",caption:"Decimal separator",editor:"Dropdown",set:s().sets.get_set("Object")(r.decimal_separators),pretty:{dropdown_width:"short"}},{name:"thousand_separator",caption:"Thousand separator",editor:"Dropdown",set:s().sets.get_set("Object")(r.thousand_separators),optional:true,pretty:{dropdown_width:"short"}},{name:"currency_symbol",caption:"Currency",editor:"Dropdown",set:s().sets.get_set("List")(i.currency_symbols,"text"),optional:true,condition:"formatting_type is currency",pretty:{dropdown_width:"short"}},{name:"negative_parenthese",caption:"Use parentheses for negative numbers",editor:"Checkbox"}]},{"../../../constants/currency":56,"../../../lib":741,"../../../safe_require":777}],205:[function(e,t,n){"use strict";const r=n;const i=e("../../../db/constraint_defs");const s=e("../../../lang/btypes");r.get_array_from_range=function(e){if(e==null){return null}if(e.all){return e.all()}if(e.length===0){return[]}return[e[0],e[1]]};r.create_range_btype_messages=function(e,t,n){const o=e+"_range";const a={min:{description:e==="date"?":start":":min",ret_btype:e,fn(e,i){if(!e){return}e=r.get_array_from_range(e);return n(Math.min(t(e[0]),t(e[1])))}},max:{description:e==="date"?":end":":max",ret_btype:e,fn(e,i){if(!e){return}e=r.get_array_from_range(e);return n(Math.max(t(e[0]),t(e[1])))}},average:{description:e==="date"?":center":":average",ret_btype:e,fn:(e,i)=>{if(!e){return}e=r.get_array_from_range(e);return n((t(e[0])+t(e[1]))/2)}},is_empty:{description:" is empty",ret_btype:"sys.bool",fn(e,t){e=r.get_array_from_range(e);return e===undefined||e===null||e.length===0}},is_not_empty:{description:" is not empty",ret_btype:"sys.bool",fn(e,t){e=r.get_array_from_range(e);return e!==undefined&&e!==null&&e.length!==0}},equals:{description:" is ",ret_btype:"sys.bool",arg_btype:e,no_composer:()=>true,fn(e,t){return s.get(o).equals(e,t)}},not_equals:{description:" is not ",ret_btype:"sys.bool",arg_btype:e,no_composer:()=>true,fn(e,t){return!s.get(o).equals(e,t)}}};let l,c;if(e==="date"){c="before";l="after"}else{c="smaller";l="greater"}const u={range_contains:{description:" contains range "},range_contains_point:{description:" contains point "},range_contained_by:{description:" is contained by "},range_overlaps:{description:" overlaps with "},range_greater_than:{description:" is "+l},range_greater_than_point:{description:" is "+l+" (point) "},range_less_than:{description:" is "+c},range_less_than_point:{description:" is "+c+" (point) "}};for(const n in u){const s=u[n];const o=n.indexOf("_point")!==-1;a[n]={description:s.description,ret_btype:"sys.bool",arg_btype:o?e:e+"_range",fn:(e,s)=>{if(!e){return false}e=r.get_array_from_range(e);function a(e){const n=t(e==null?void 0:e[0]);const r=t(e==null?void 0:e[1]);return[Math.min(n,r),Math.max(n,r)]}const l=a(e);let c;if(o){c=t(s)}else{s=r.get_array_from_range(s);c=a(s)}return i.all_search_constraints[n](c,l)}}}return a};r.create_range_btype_messages_reorg=function(e,t,n){const o=e+"_range";const a={equals:{description:" is ",ret_btype:"sys.bool",arg_btype:e,no_composer:()=>true,fn(e,t){return s.get(o).equals(e,t)}},not_equals:{description:" is not ",ret_btype:"sys.bool",arg_btype:e,no_composer:()=>true,fn(e,t){return!s.get(o).equals(e,t)}},min:{description:e==="date"?":start":":min",ret_btype:e,fn(e,i){if(!e){return}e=r.get_array_from_range(e);return n(Math.min(t(e[0]),t(e[1])))}},max:{description:e==="date"?":end":":max",ret_btype:e,fn(e,i){if(!e){return}e=r.get_array_from_range(e);return n(Math.max(t(e[0]),t(e[1])))}},average:{description:e==="date"?":center":":average",ret_btype:e,fn:(e,i)=>{if(!e){return}e=r.get_array_from_range(e);return n((t(e[0])+t(e[1]))/2)}},is_empty:{description:" is empty",ret_btype:"sys.bool",fn(e,t){e=r.get_array_from_range(e);return e===undefined||e===null||e.length===0}},is_not_empty:{description:" is not empty",ret_btype:"sys.bool",fn(e,t){e=r.get_array_from_range(e);return e!==undefined&&e!==null&&e.length!==0}}};let l,c;if(e==="date"){c="before";l="after"}else{c="smaller than";l="greater than"}const u={range_contains:{description:" contains range "},range_contains_point:{description:` contains ${e} `},range_contained_by:{description:" is contained by "},range_overlaps:{description:" overlaps with "},range_greater_than:{description:` is ${l} range `},range_greater_than_point:{description:` is ${l} ${e} `},range_less_than:{description:` is ${c} range `},range_less_than_point:{description:` is ${c} ${e} `}};for(const n in u){const s=u[n];const o=n.endsWith("_point");a[n]={description:s.description,ret_btype:"sys.bool",arg_btype:o?e:e+"_range",fn:(e,s)=>{if(!e){return false}e=r.get_array_from_range(e);function a(e){const n=t(e==null?void 0:e[0]);const r=t(e==null?void 0:e[1]);return[Math.min(n,r),Math.max(n,r)]}const l=a(e);let c;if(o){c=t(s)}else{s=r.get_array_from_range(s);c=a(s)}return i.all_search_constraints[n](c,l)}}}return a}},{"../../../db/constraint_defs":426,"../../../lang/btypes":653}],206:[function(e,t,n){"use strict";const r=e("../../../db/hydrate");const i=e("../../../lib");t.exports={field_names:{val:{},value_id:{}},display(){return"Dehydrated"},check_for_errors(){},fields(){return[{name:"val"},{name:"value_id"}]},get_value(e){return e("value_id")},get_runmode_value(e,t,n){const{value_id:r}=n;return r},evaluate(e,t,n){return n.cast(r.rehydrate_tree(i().db_instance(),e.val))},get_unique_string(){return null}}},{"../../../db/hydrate":429,"../../../lib":741}],207:[function(e,t,n){"use strict";const r=e("../utilities/core_ds_db_ops_utilities");const i=e("../utilities/core_ds_api_utilities");const s=e("../../../services/client/editor_utils");const o=e("../../../lang/lang");const a=e("../../../lib");const l=e("../../../lang/evaluation/state_keys");t.exports={field_names:o.DETECT_FIELD_NAMES,light_evaluation:false,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,get_spot(){return"SlidableAtom"},display(e,t){var n,r;return(n=(r=i.get_call(e("provider")))==null?void 0:r.display())!=null?n:"Get data from an external API"},fields(e,t){let n=[{name:"provider",caption:"API provider",editor:"Dropdown",set:a().sets.get_set("APIList")()}];const r=e("provider");const o=i.get_call(r);if(!o){return n}if(o.fields){n=n.concat(o.fields(e,t))}else{s.add_fields_from_parameters(o.parameters,n)}s.add_key_button(o.service_name,n);return n},evaluate(e,t,n,s){const o=i.get_call(e.provider);if(!o||t.responsive_mode){return n.get_bubble_null()}if(o.is_authenticated()){const n=o.execute(null,e,null,s,t);return r.convert_api_call_to_db_object(n,o)}},get_value(e){return i.get_api_value_from_provider(e("provider"))},get_runmode_value(e,t,n){return i.get_api_value_from_provider(n.provider)},get_unique_string(e,t){return l.GetDataFromAPI(e)}}},{"../../../lang/evaluation/state_keys":699,"../../../lang/lang":714,"../../../lib":741,"../../../services/client/editor_utils":778,"../utilities/core_ds_api_utilities":230,"../utilities/core_ds_db_ops_utilities":232}],208:[function(e,t,n){"use strict";const r=e("../../../logger");function i(e){const t=["filtered","format_as_text"];let n=e;while((r=n)!=null&&r.exists()&&n.path().indexOf(".")!==-1){var r;if(n.json.name()==="properties"){var i;const e=n.parent_expression();if(t.includes(e==null?void 0:(i=e.name)==null?void 0:i.call(e))){const t=e.parent_expression().get_value().inner();return t}}n=n.parent_expression()}return null}t.exports={field_names:{},get_value(e,t){var n,r,s,o,a,l;const c=(n=i(t))==null?void 0:n.id();if(c){return c}if(typeof(t==null?void 0:(r=t.owner)==null?void 0:r.get_injected_value)==="function"){const e=t.owner.get_injected_value(t);if(e){return e}}return(s=t==null?void 0:(o=t.owner)==null?void 0:(a=o.E)==null?void 0:(l=a.get_injected_value)==null?void 0:l.call(a,t.owner))!=null?s:"null"},allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,allowed_on_privacy_role:true,fields(e,t){return[]},display(e,t){var n;const r=i(t);if(r){return"This "+r.display()}if(typeof t.owner.get_injected_display==="function"){const e=t.owner.get_injected_display(t);if(e){return e}}if(((n=t.owner.E)==null?void 0:n.get_injected_display)!=null){return t.owner.E.get_injected_display(t)}},context_key:"injected_value",evaluate(e,t,n){if(typeof t.datasources.injected_value!=="function"){r.info("non-null injected_value passed through",{injected_value_string:String(t.datasources.injected_value)});return n.cast(null)}return n.cast(t.datasources.injected_value(e,t))},get_runmode_value(e,t,n){var r,i,s;return(r=(i=(s=t.datasources).injected_value_btype)==null?void 0:i.call(s,n,t))!=null?r:"null"},get_unique_string(e,t){return null}}},{"../../../logger":744}],209:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../utilities/core_ds_field_names");const i=e("../utilities/core_ds_editor_utilities");const s=e("../utilities/core_ds_db_ops_utilities");const o=e("../../../lang/btypes");const a=e("../../../lib");const l=e("../../../constants/special_keys");const c=e("../../../lang/evaluation/state_keys");const u=e("../../../lang/btype_ids");const d=e("../../../lang/appquery");const{customTypes:p}=e("../../../lang/btypes_dropdowns");function _(e){if(!e){return"null"}return u.list_type(e)}t.exports={field_names:{type_to_find:{},ignore_empty_constraints:{},...r.constraints_field_names,...r.sorting_field_names},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,display(e,t){var n;let r=e("type_to_find");if(r){r=o.get(r)}let i=(n=r)==null?void 0:n.display();if(i){var s;i=" "+i+"s";if((s=r.custom_type())!=null&&s.deleted()){i=i+" (deleted)"}return"Search for"+i}else{return"Do a search for"}},get_spot(){return"SlidableAtom"},fields(e,t){let n;if(d.has_feature_enabled("reorg_component_selection")){n=p()}else{n=a().sets.get_set("CustomTypes")(true,false)}const r=[{name:"type_to_find",caption:"Type",editor:"Dropdown",set:n}];const s=i.get_constraints_fields(e("type_to_find"),true);s.push(...i.get_sorting_fields(e("type_to_find"),true,e("sort_field")));for(const e of s){var o;(o=e.condition)!=null?o:e.condition="type_to_find"}r.push(...s);r.push(i.ignore_empty_constraints_checkbox);return r},get_value(e){return _(e("type_to_find"))},get_runmode_value(e,t,n){return _(n.type_to_find)},get_unique_string(e,t){const{type_to_find:n,constraints:r}=e;return c.Search(n,r,s.get_sorts_list(e,true))},evaluate(e,t,n){const{type_to_find:r,constraints:i,ignore_empty_constraints:c}=e;if(a().is_edit_mode()){return n.get_bubble_null()}const u=!c;let d=a().bv().resolve_constraints(i,u);const p=o.get(r).custom_type();if(!(p!=null&&p.exists())){return n.get_bubble_null()}d=d.filter((e=>s.is_field_okay(e.key,r)));const _=s.get_sorts_list(e,true);let f=null;for(const e of d){if(e.key===l.UNIQUE_ID&&e.constraint_type==="equals"){if(f==null){f=e.value}else if(f!==e.value){return n.get_bubble_null()}}if(e.constraint_type==="return_empty_set"){return a().db_instance().static_list(r,[])}}if(f==null||typeof f!=="string"||f===""){return a().db_instance().find(r,d,_)}else{var h;const e=a().db_instance().get(f);if(!e.exists()||((h=e._type)==null?void 0:h.call(e))!==r){return n.get_bubble_null()}const t=a().db_instance().static_list(r,[e]);return t.filter(d)}}}},{"../../../constants/special_keys":87,"../../../lang/appquery":651,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lang/btypes_dropdowns":654,"../../../lang/evaluation/state_keys":699,"../../../lib":741,"../utilities/core_ds_db_ops_utilities":232,"../utilities/core_ds_editor_utilities":233,"../utilities/core_ds_field_names":235,"core-js/modules/web.dom-collections.iterator.js":1123}],210:[function(e,t,n){"use strict";const r=e("../utilities/core_ds_element_utilities");const i=e("../../../lang/evaluation/state_keys");t.exports={field_names:{},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:false,additional_context_filter(e,t){var n,r,i,s,o,a;if(t.owner_type==="unknown"){return false}let l=(n=(r=t.owner_node).context_element)==null?void 0:(i=n.call(r))==null?void 0:i.parent();while(l&&l.type()!=="RepeatingGroup"&&l.type()!=="TableCrossAxis"){l=l.parent()}return((s=(o=l)==null?void 0:(a=o.get_states)==null?void 0:a.call(o))!=null?s:[]).includes("list_data")},fields(){return[]},_get_parent_element(e){let t=e.context_element().parent();while(t&&t.type()!=="RepeatingGroup"&&t.type()!=="TableCrossAxis"){t=t.parent()}return t},display(e,t){const n=this._get_parent_element(t);if((n==null?void 0:n.type())==="TableCrossAxis"){const e=n.parent().get_static_property("table_direction")==="vertical"?"row":"column";return`Current ${e}'s index`}return"Current cell's index"},get_value(){return"number"},get_runmode_value(){return"number"},evaluate(e,t,n){let i=r.get_runtime_parent(t);if(!i){return n.get_bubble_null()}else{var s,o;while(i!=null&&i.element.type()!=="GroupItem"){var a,l;i=(a=(l=i).parent)==null?void 0:a.call(l)}return(s=(o=i)==null?void 0:o.state("cell_index"))!=null?s:n.get_bubble_null()}},get_unique_string(){return i.CurrentCellsIndex()},check_for_errors(e,t){const n=t.context_element();if(n.parents==null||n.parents("RepeatingGroup").length===0&&n.parents("TableCrossAxis").length===0){return"You are trying to get the cell index, but this is not in the context of a repeating group"}}}},{"../../../lang/evaluation/state_keys":699,"../utilities/core_ds_element_utilities":234}],211:[function(e,t,n){"use strict";const r=e("../../../lang/appquery");const i=e("../../../lang/btypes");const s=e("../../../lang/evaluation/state_keys");const o=e("../utilities/core_ds_element_utilities");t.exports={field_names:{fetch_data:{},ancestor_type:{}},_get_value_type(e){return i.get(e.get_static_property("group_type"))},get_value(e,t){var n,r;const s=o.get_ancestor_element(e("ancestor_type"),t);if(e("fetch_data")){if(s.type()==="TableCrossAxis"){return this._get_value_type(s.parent())}return this._get_value_type(s)}return i.get((n=(r=s.get_value_id)==null?void 0:r.call(s))!=null?n:"null")},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:false,additional_context_filter(e,t){var n,r,i;if(t.owner_type==="unknown"||!e.properties.ancestor_type){return false}let s=e.properties.ancestor_type;const o=e.properties.fetch_data;if(s==="TableMainAxis")s="TableCrossAxis";let a=(n=(r=t.owner_node).context_element)==null?void 0:(i=n.call(r))==null?void 0:i.parent();while(a!=null&&a.type()!==s){a=a.parent()}if(!a)return false;return!o||e.properties.ancestor_type==="TableCrossAxis"},fields(e,t){return[{name:"fetch_data"},{name:"ancestor_type"}]},_get_ancestor_element(e,t){if(e==="TableMainAxis"){const e=this._get_ancestor_element("Table",t);const n=this._get_ancestor_element("TableCell",t);const r=n.get_static_property("cell_main_axis_id");return e.elements("TableMainAxis").find((e=>e.id()===r))}let n=t.context_element();while(n&&n.type()!==e){n=n.parent()}return n},display(e,t){const n=o.get_ancestor_element(e("ancestor_type"),t);if(e("fetch_data")){const s=this.get_value(e,t);let o;if(s.id()==="null"){o=r.has_feature_enabled("reorg_component_selection")?"thing":"Thing"}else{var i;o=s.display();if((i=s.custom_type())!=null&&i.deleted()){o=o+" (deleted)"}}if((n==null?void 0:n.type())==="RepeatingGroup"){return"Current cell's "+o}else if(n.type()==="TableCrossAxis"){const e=n.parent().get_static_property("table_direction")==="vertical"?"row":"column";return`Current ${e}'s `+o}}const s=e=>{var t;if((e==null?void 0:e.type())==="TableCrossAxis"){const t=e.parent().get_static_property("table_direction")==="vertical"?"Row":"Column";return t}else if((e==null?void 0:e.type())==="TableMainAxis"){const t=e.parent().get_static_property("table_direction")==="vertical"?"Column":"Row";return t}return(t=e==null?void 0:e.type())!=null?t:"[missing element]"};return"This "+s(n)},check_for_errors(e,t){const n=t.context_element();const r=o.get_ancestor_element(e("ancestor_type"),t);if(!r){return"You are trying to get the data for the ancestor of "+n.get_name()+" of type "+e("ancestor_type")+", but there is no ancestor of that type!"}if(this.get_value(e,t).id()==="null"){if(n){return"You are trying to get the data for the ancestor of "+n.get_name()+".  However, the ancestor is "+r.get_name()+", which does not have a type of data set on it."}}},thumbnail_id(e,t){var n,r;return(n=o.get_ancestor_element(e("ancestor_type"),t))==null?void 0:(r=n.id)==null?void 0:r.call(n)},_get_runmode_element_instance(e,t){if(e==="TableMainAxis"){const e=this._get_runmode_element_instance("Table",t);const n=this._get_runmode_element_instance("TableCell",t);const r=n.get_static_property("cell_main_axis_id");return e.find_instance_by_id(r)}while(t&&t.element.type()!==e){if(e==="TableCrossAxis"&&t.element.type()==="GroupItem"){return t}t=t.parent()}return t},get_runmode_value(e,t,n){var r,i;const s=t.element;if(n.fetch_data){var o;const e=n.ancestor_type!=="TableCrossAxis"?n.ancestor_type:"Table";const t=this._get_runmode_element_instance(e,s);return(o=t.get_static_property("group_type"))!=null?o:null}const a=this._get_runmode_element_instance(n.ancestor_type,s);return(r=a==null?void 0:(i=a.element)==null?void 0:i.get_value_id())!=null?r:null},evaluate(e,t,n){let r=t.element;if(e.fetch_data){var i,s;while(r!=null&&r.element.type()!=="GroupItem"){var o,a;r=(o=(a=r).parent)==null?void 0:o.call(a)}return(i=(s=r)==null?void 0:s.state("group_data"))!=null?i:n.get_bubble_null()}r=this._get_runmode_element_instance(e.ancestor_type,t.element);if(!r){return n.get_bubble_null()}return r},get_unique_string(e,t){return s.ElementAncestor()+e.ancestor_type}}},{"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/evaluation/state_keys":699,"../utilities/core_ds_element_utilities":234}],212:[function(e,t,n){"use strict";const r=e("../utilities/core_ds_element_utilities");const i=e("../../../lang/evaluation/state_keys");const s=e("../../../lang/appquery");t.exports={field_names:{},get_runmode_value(e,t){return r.context_parent_value(t.element.element)},evaluate(e,t,n){const i=r.get_runtime_parent(t);if(!i){return n.get_bubble_null()}return n.cast(i.state("group_data"))},get_value(e,t){return r.element_parent_value(e,t)},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:false,additional_context_filter(e,t){var n,r,i,s,o;if(t.owner_type==="unknown"){return false}const a=(n=(r=t.owner_node).context_element)==null?void 0:(i=n.call(r))==null?void 0:i.parent();const l=(s=a==null?void 0:(o=a.get_states)==null?void 0:o.call(a))!=null?s:[];if((a==null?void 0:a.type())==="Table"||(a==null?void 0:a.type())==="TableCell"||(a==null?void 0:a.type())==="TableCrossAxis")return false;return l.includes("group_data")||l.includes("list_data")||l.includes("currently_selected_event")||l.includes("currently_selected_marker")},fields(){return[]},_get_parent_element(e){let t=e.context_element().parent();while(t&&t.type()!=="RepeatingGroup"&&!t.get_states().includes("group_data")){t=t.parent()}return t},display(e,t){const n=this.get_value(e,t);let r;if(n.id()==="null"){r=s.has_feature_enabled("reorg_component_selection")?"thing":"Thing"}else{var i;r=n.display();if((i=n.custom_type())!=null&&i.deleted()){r=r+" (deleted)"}}const o=this._get_parent_element(t);let a;if((o==null?void 0:o.type())==="RepeatingGroup"){a="Current cell's "}else if((o==null?void 0:o.type())==="TableCrossAxis"){const e=o.parent().get_static_property("table_direction")==="vertical"?"row":"column";a=`Current ${e}'s `}else{a="Parent group's "}return a+r},thumbnail_id(e,t){var n,r;return(n=this._get_parent_element(t))==null?void 0:(r=n.id)==null?void 0:r.call(n)},check_for_errors(e,t){if(r.element_parent_value(e,t).id()==="null"){const e=t.context_element();if(e){var n;const t=(n=e.parent)==null?void 0:n.call(e);if(!t){return"You are trying to get the data for the parent of "+e.get_name()+", but this is the top-most element!"}return"You are trying to get the data for the parent of "+e.get_name()+".  However, the parent is "+t.get_name()+", which does not have a type of data set on it."}}},get_unique_string(e,t){return i.ElementParent()}}},{"../../../lang/appquery":651,"../../../lang/evaluation/state_keys":699,"../utilities/core_ds_element_utilities":234}],213:[function(e,t,n){"use strict";const r=e("../../../lang/appquery");const i=e("../utilities/core_ds_element_utilities");function s(e,t){var n,s,o,a;const l=r.element(e("element_id"));if((n=t.context_element())!=null&&(s=n.root)!=null&&(o=s.call(n))!=null&&o.id()&&(l==null?void 0:(a=l.root())==null?void 0:a.id())!==t.context_element().root().id()){return null}if(!i.is_element_visible(l,t.context_element())){return null}return l}t.exports={field_names:{element_id:{}},get_value(e,t){var n;const r=(n=s(e,t))==null?void 0:n.id();if(r){return"element."+r}else{return"null"}},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:false,check_btype(e){const t=r.by_id(e.get_static_property("element_id"));return t!=null&&!t.is_input()},get_required_visible_id(e){var t;return(t=e.properties)==null?void 0:t.element_id},fields(e,t){return[{name:"element_id"}]},display(e,t){var n;const i=r.element(e("element_id"));return(n=i==null?void 0:i.name_for_datasource())!=null?n:"[missing element]"},check_for_errors(e,t){const n=s(e,t);if(!n){var i,o,a,l;const n=r.element(e("element_id"));const s=(i=t.context_element())==null?void 0:(o=i.root)==null?void 0:(a=o.call(i))==null?void 0:a.id();if(n&&s!=null&&(n==null?void 0:(l=n.root())==null?void 0:l.id())===s){return"This element cannot be seen by the current element as it is in a cell of a Repeating Group"}return"It looks like the element this used to refer to was deleted or is on a different page"}},thumbnail_id(e,t){var n,r;return(n=s(e,t))==null?void 0:(r=n.id)==null?void 0:r.call(n)},get_runmode_value(e,t,n){var r,i;const s=(r=(i=t.element).find_instance_by_id)==null?void 0:r.call(i,n.element_id);if(s==null){return"null"}const o=s.element.get_value_id();return o},evaluate(e,t,n){var r,i,s;return(r=(i=(s=t.element).find_instance_by_id)==null?void 0:i.call(s,e.element_id))!=null?r:n.get_bubble_null()},get_unique_string(e,t){return null}}},{"../../../lang/appquery":651,"../utilities/core_ds_element_utilities":234}],214:[function(e,t,n){"use strict";const r=e("../../../lang/btypes");const i=e("../../../lang/evaluation/state_keys");const s=e("../../../lib");t.exports={field_names:{},fields(){return[]},display(e,t){return"This "+t.context_element().get_type_display()},thumbnail_id(e,t){var n,r;return(n=t.context_element())==null?void 0:(r=n.id)==null?void 0:r.call(n)},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:false,allowed_in_style_conditionals:()=>true,additional_context_filter(e,t){var n;if(((n=e.properties)==null?void 0:n.element_id)==null){return t.owner_type==="State"}else{var r;return t.owner_type==="Workflow"&&((r=t.owner_node.context_element())==null?void 0:r.id())===e.properties.element_id}},get_unique_string(){return i.ThisElement()},get_value(e,t){var n,i,s;return r.get((n=(i=(s=t.context_element()).get_value_id)==null?void 0:i.call(s))!=null?n:"null")},evaluate(e,t,n){var r,i;if((r=(i=s()).is_api)!=null&&r.call(i)){return n.get_bubble_null()}return t.element},get_runmode_value(e,t){var n,r,i;return(n=(r=(i=t.element.element).get_value_id)==null?void 0:r.call(i))!=null?n:"null"}}},{"../../../lang/btypes":653,"../../../lang/evaluation/state_keys":699,"../../../lib":741}],215:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const{S:r}=e("../../../lang/shrink");const i=e("../../core_actions/utilities/generic_actions_utilities");const s=e("../../core_formulas");const o=e("../../../lib");const a=e("../../../lang/lang");const l=e("../../../u/shared/decaf");function c(e,t,n){const s=e(t);if(s[r.type]==="GetElement"){const e=s[r.properties][r.element_id];if(e){i._apply_content_format_to_input(e,n)}}}t.exports={light_evaluation:false,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,get_spot(){return"SlidableAtom"},display(e){const t=e("formula_type");if(t){return"Calculate "+t}else{return"Calculate formula"}},fields(e){const t=[{name:"formula_type",caption:"Type",editor:"Dropdown",set:o().sets.get_set("Object")(s.list_of_formulas)}];const n=e("formula_type");if(!n){return t}const r=s[n];for(const[n,s]of l.object_entries(r.fields)){var i,a,u;t.push({name:n,caption:(i=s.caption)!=null?i:n,editor:(a=s.editor)!=null?a:"Basic",value:(u=s.value)!=null?u:"number",value_setter:{property_modifier(){var t;c(e,n,(t=s.content_format)!=null?t:"float_number")},no_need_to_show_message(){return true}}})}return t},get_value(e){var t,n;const r=e("formula_type");return(t=(n=s[r])==null?void 0:n.ret_btype)!=null?t:"number"},field_names:a.DETECT_FIELD_NAMES,get_runmode_value(e,t,n){var r,i;const o=n.formula_type;return(r=(i=s[o])==null?void 0:i.ret_btype)!=null?r:"number"},get_unique_string(e,t){},evaluate(e,t,n){var r;const i=s[e.formula_type];return(r=i==null?void 0:i.evaluate(e,t))!=null?r:n.get_bubble_null()}}},{"../../../lang/lang":714,"../../../lang/shrink":728,"../../../lib":741,"../../../u/shared/decaf":844,"../../core_actions/utilities/generic_actions_utilities":175,"../../core_formulas":379,"core-js/modules/web.dom-collections.iterator.js":1123}],216:[function(e,t,n){"use strict";const r=e("../../../u/shared/b_object");const i=e("../../../shared/apps_utilities");const s=e("../../../lang/appquery");t.exports={get_spot(){return"SlidableAtom"},field_names:r.extend({setting_name:{},private:{}}),light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,additional_context_filter(){return i.is_hardcoded(s.appname())||s.appname()==="Meta"},fields(e,t){return[{name:"setting_name",caption:"Setting name",editor:"StaticText"},{name:"private",caption:"Private",editor:"Checkbox"}]},get_value(e){return"text"},get_runmode_value(e,t,n){return"text"},get_unique_string(e,t){},evaluate(e,t,n){if(!e.setting_name){return n.get_bubble_null()}if(e.private){return s.get_private_setting(e.setting_name)}else{return s.get_public_setting(e.setting_name)}},display(e,t){const n=e("setting_name");const r=e("private");if(!n){return"Setting: [TBD]"}else if(r){return"Private Setting: "+n}else{return"Public Setting: "+n}}}},{"../../../lang/appquery":651,"../../../shared/apps_utilities":788,"../../../u/shared/b_object":839}],217:[function(e,t,n){"use strict";const r=e("../../../lib");const i=e("../../../lang/appquery");const{SETTINGS_TAB:s}=e("../../../editor/css");t.exports={field_names:{text_id:{},information:{}},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,check_btype:()=>true,get_spot(){return"SlidableAtom"},fields(e,t){const n=[{name:"text_id",caption:"Text ID",editor:"Dropdown",set:r().sets.get_set("AppTexts")()}];const o=e("text_id");if(o){const e=r().app_language();if(e&&i.get_public_setting("text."+e+".USER_TEXTS."+o)){n.push({name:"information",label_text:"Content in "+e+": "+i.get_public_setting("text."+e+".USER_TEXTS."+o),editor:"Label"})}n.push({name:"information",label_text:"Define the value of the text in a different language in the Settings Tab.",click_cb(){$(s).click();r().settings_editor.settings_canvas.open_tab("Language");window.HideSlidable()},editor:"Label"})}return n},display(e,t){let n;const r=e("text_id");const s=i.get_public_setting("user_text_ids."+r);if(s===true){n=r}else{n=s}if(i.has_feature_enabled("reorg_component_selection")){n=n?` (${n})`:"";return`App Text${n}`}else{var o;(o=n)!=null?o:n="?";return`App Text (${n})`}},get_value(e){return"text"},get_runmode_value(e,t,n){return"text"},get_unique_string(e,t){},evaluate(e,t,n){var i;if(!e.text_id){return n.get_bubble_null()}return(i=r().get_text("USER_TEXTS",e.text_id))!=null?i:n.get_bubble_null()}}},{"../../../editor/css":560,"../../../lang/appquery":651,"../../../lib":741}],218:[function(e,t,n){"use strict";const r=e("../../../lang/evaluation/state_keys");t.exports={field_names:{},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,allowed_on_privacy_role:true,allowed_in_style_conditionals:()=>true,fields(e){return[]},get_value(e){return"user"},get_unique_string(e,t){return r.CurrentUser()},display(){return"Current User"},context_key:"current_user",evaluate(e,t,n){var r,i;return n.cast((r=(i=t.datasources).current_user)==null?void 0:r.call(i,e,t))},get_runmode_value(){return"user"}}},{"../../../lang/evaluation/state_keys":699}],219:[function(e,t,n){"use strict";const r=e("../utilities/core_ds_db_ops_utilities");const i=e("../utilities/core_ds_api_utilities");const s=e("../../../services/is_installed");t.exports={field_names:{},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,additional_context_filter(){return s("interactions")},display(e,t){return"Get mouse data"},fields(e){return[{name:"name"}]},evaluate(e,t,n,s){const o=i.get_call("interactions.get_mouse_data");if(!o){return n.get_bubble_null()}if(o.is_authenticated()){const n=o.execute(null,e,null,s,t);return r.convert_api_call_to_db_object(n,o)}},get_value(){return i.get_api_value_from_provider("interactions.get_mouse_data")},get_runmode_value(){return i.get_api_value_from_provider("interactions.get_mouse_data")},get_unique_string(e,t){}}},{"../../../services/is_installed":781,"../utilities/core_ds_api_utilities":230,"../utilities/core_ds_db_ops_utilities":232}],220:[function(e,t,n){"use strict";const r=t.exports;const i=e("../../safe_require");i.safe_register("./core/core_datasources",r);r.GetParamFromUrl=e("./page/get_param_from_url");r.CurrentUser=e("./general/current_user");r.PageData=e("./page/page_data");r.ThisElement=e("./elements/this_element");r.CurrentPageItem=e("./page/current_page_item");r.CurrentWorkflowItem=e("./workflows/current_workflow_item");r.CurrentDataItem=e("./workflows/current_data_item");r.OldDataItem=e("./workflows/old_data_item");r.APIEventParameter=e("./workflows/api_event_parameter");r.Search=e("./db/search");r.OptionValue=e("./literals/option_value");r.ArbitraryText=e("./literals/arbitrary_text");r.DateTime=e("./literals/arbitrary_datetime");r.OneOptionValue=e("./literals/one_optionvalue");r.AllOptionValue=e("./literals/all_optionvalue");r.PrimitiveLiteral=e("./literals/primitive_literal");r.GetDataFromAPI=e("./db/get_data_from_api");r.GetMouseData=e("./general/get_mouse_data");r.ElementParent=e("./elements/element_parent");r.CurrentCellsIndex=e("./elements/current_cells_index");r.PreviousStep=e("./workflows/previous_step");r.GetElement=e("./elements/get_element");r.ElementAncestor=e("./elements/element_ancestor");r.Dehydrated=e("./db/dehydrated");r.InjectedValue=e("./db/injected_value");r.Formulas=e("./formulas/formulas_datasource");r.AppSetting=e("./general/app_setting");r.AppText=e("./general/app_text")},{"../../safe_require":777,"./db/dehydrated":206,"./db/get_data_from_api":207,"./db/injected_value":208,"./db/search":209,"./elements/current_cells_index":210,"./elements/element_ancestor":211,"./elements/element_parent":212,"./elements/get_element":213,"./elements/this_element":214,"./formulas/formulas_datasource":215,"./general/app_setting":216,"./general/app_text":217,"./general/current_user":218,"./general/get_mouse_data":219,"./literals/all_optionvalue":221,"./literals/arbitrary_datetime":222,"./literals/arbitrary_text":223,"./literals/one_optionvalue":224,"./literals/option_value":225,"./literals/primitive_literal":226,"./page/current_page_item":227,"./page/get_param_from_url":228,"./page/page_data":229,"./workflows/api_event_parameter":237,"./workflows/current_data_item":238,"./workflows/current_workflow_item":239,"./workflows/old_data_item":240,"./workflows/previous_step":241}],221:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../lang/btypes");const i=e("../../../lib");const s=e("../../../option_sets");const o=e("../../../lang/btype_ids");t.exports={field_names:{option_set:{}},light_evaluation:true,allowed_when_restricted:true,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,allowed_on_privacy_role:true,additional_context_filter(e,t,n){let r;if(typeof(n==null?void 0:n.id)==="function"){r=n.id()}else{r=n}return r===o.list_type(e.properties.option_set)},fields(){return[{name:"option_set"}]},display(e){const t=r.get(e("option_set")).option_set();if(t!=null&&t.exists()){return`All ${t.display()}`}return"All values"},get_value(e){const t=e("option_set");if(t!=null){return o.list_type(t)}else{return"null"}},get_runmode_value(e,t,n){const{option_set:r}=n;if(r!=null){return o.list_type(r)}else{return"null"}},get_unique_string(e,t){return null},evaluate(e,t,n){const o=r.get(e.option_set).option_set();if(o!=null&&o.exists()){return i().db_instance().static_list(e.option_set,o.values().sort(s.sort_options_fn).filter((e=>!e.deleted())).map((e=>e.name())))}return null}}},{"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lib":741,"../../../option_sets":748,"core-js/modules/web.dom-collections.iterator.js":1123}],222:[function(e,t,n){"use strict";t.exports={field_names:{parsed_date:{}},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,fields(e){return[{name:"parsed_date",caption:"Date/time",editor:"StaticDate"}]},get_spot(){return"SlidableAtom"},display(e){return"Arbitrary date/time"},get_value(e){return"date"},get_runmode_value(e,t,n){return"date"},get_unique_string(e,t){},evaluate(e,t,n){return n.cast(e.parsed_date)}}},{}],223:[function(e,t,n){"use strict";const r=e("../../../lang/evaluation/state_keys");t.exports={field_names:{arbitrary_text:{}},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,fields(){return[{name:"arbitrary_text",caption:"Text",editor:"LongText"}]},get_spot(){return"SlidableAtom"},display(){return"Arbitrary text"},get_value(){return"text"},get_runmode_value(e,t,n){return"text"},get_unique_string(e,t){return r.ArbitraryText(e)},evaluate(e,t,n){var r;return(r=e.arbitrary_text)!=null?r:""}}},{"../../../lang/evaluation/state_keys":699}],224:[function(e,t,n){"use strict";const r=e("../../../lang/btypes");const{is_option_set:i}=e("../../../lang/btype_ids");t.exports={field_names:{option_set:{},option_value:{}},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,allowed_on_privacy_role:true,additional_context_filter(e,t,n){let r;if(typeof(n==null?void 0:n.option_set)==="function"){r=n.id()}else if(typeof n==="string"&&i(n)){r=n}return r===e.properties.option_set},fields(){return[{name:"option_set"},{name:"option_value"}]},display(e){const t=r.get(e("option_set")).option_set();if(t!=null&&t.exists()){const n=e("option_value");const r=t.value(n);if(r!=null&&r.exists()){return r.display()}}return"Option"},get_value(e){const t=e("option_set");if(t!=null){return t}else{return"null"}},get_runmode_value(e,t,n){const{option_set:r}=n;if(r!=null){return r}else{return"null"}},get_unique_string(){return null},evaluate(e){return e.option_value}}},{"../../../lang/btype_ids":652,"../../../lang/btypes":653}],225:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../lib");const i=e("../../../lang/btypes");const s=e("../../../constants/option_sets");const o=e("../../../option_sets");const a=e("../../../lang/btype_ids");t.exports={field_names:{option_set:{},option_value:{}},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,fields(e){const t=[{name:"option_set",caption:"Option set",editor:"Dropdown",set:r().sets.get_set("OptionSets")(false)}];const n=i.get(e("option_set")).option_set();if(n!=null&&n.exists()){t.push({name:"option_value",caption:"Option",editor:"Dropdown",set:r().sets.get_set("OptionValues")(n,true)})}return t},get_spot(){return"SlidableAtom"},display(e){const t=i.get(e("option_set")).option_set();if(t!=null&&t.exists()){const n=e("option_value");if(n===s.ALL_OPTIONS){return`All ${t.display()}`}const r=t.value(n);if(r!=null&&r.exists()){return r.display()}}return"Get an option"},get_value(e){const t=e("option_set");if(t!=null){if(e("option_value")===s.ALL_OPTIONS){return a.list_type(t)}else{return t}}else{return"null"}},get_runmode_value(e,t,n){const{option_set:r}=n;if(r!=null){if(n.option_value===s.ALL_OPTIONS){return a.list_type(r)}else{return r}}else{return"null"}},get_unique_string(e,t){return null},evaluate(e,t,n){if(e.option_value===s.ALL_OPTIONS){const t=i.get(e.option_set).option_set();if(t!=null&&t.exists()){const n=t.values().sort(o.sort_options_fn).filter((e=>!e.deleted())).map((e=>e.name()));return r().db_instance().static_list(e.option_set,n)}else if(e.option_value===s.ALL_OPTIONS){return r().db_instance().static_list(e.option_set,[])}}return e.option_value}}},{"../../../constants/option_sets":77,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lib":741,"../../../option_sets":748,"core-js/modules/web.dom-collections.iterator.js":1123}],226:[function(e,t,n){"use strict";const r=e("../../../lang/btypes");t.exports={field_names:{btype:{},value:{}},light_evaluation:true,allowed_when_restricted:true,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,allowed_on_privacy_role:true,fields(){return[{name:"btype"},{name:"value"}]},display(e){const t=r.get(e("btype"));return`"${t.export_to_string(e("value"),{booleans_yes_no:true})}"`},get_value(e){return e("btype")},get_runmode_value(e){return e.btype},get_unique_string(e){return String(e.value)},evaluate(e){return e.value}}},{"../../../lang/btypes":653}],227:[function(e,t,n){"use strict";const r=e("../../../lang/btypes");const i=e("../../../lang/evaluation/state_keys");const s=e("../../../lang/appquery");function o(e){var t,n,i,s;return r.get((t=(n=(i=e.owner).root)==null?void 0:(s=n.call(i))==null?void 0:s.get_static_property("page_item_type"))!=null?t:"null")}t.exports={field_names:{},context_key:"current_page_item",evaluate(e,t,n){var r,i;return n.cast((r=(i=t.datasources).current_page_item)==null?void 0:r.call(i,e,t))},get_runmode_value(e,t,n){var r,i,s;return(r=(i=(s=t.datasources).current_page_item_btype)==null?void 0:i.call(s,n,t))!=null?r:"null"},get_value(e,t){return o(t)},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:false,additional_context_filter(e,t){if(["Workflow","State","CustomDefinition","Element"].includes(t.owner_type)){var n,r,i,s;return((n=(r=(i=t.owner_node).root)==null?void 0:(s=r.call(i))==null?void 0:s.get_static_property("page_item_type"))!=null?n:"null")!=="null"}},display(e,t){let n;const r=o(t);if(r.id()==="null"){n="thing"}else{n=r.display()}if(s.has_feature_enabled("reorg_component_selection")){return"Current page's "+n}else{return"Current Page "+n}},check_for_errors(e,t){if(o(t).id()==="null"){var n;const e=(n=t.root)==null?void 0:n.call(t);return"Trying to get the current thing for "+(e==null?void 0:e.name())+" but this page does not accept data..."}},fields(e,t){return[]},get_unique_string(e,t){return i.CurrentPageItem()}}},{"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/evaluation/state_keys":699}],228:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../lib");const i=e("../../../lang/btype_ids");const s=e("../../../logger");const{displayableInListBtypes:o,filters:a}=e("../../../lang/btypes_dropdowns");const l=e("../../../lang/appquery");t.exports={field_names:{parameter_name:{},type:{default:"parameter"},value:{default:"text"}},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:false,fields(e,t){let n;if(l.has_feature_enabled("reorg_component_selection")){n=o().filter(a().no_plugins)}else{n=r().sets.get_set("DisplayableInListValues")(true,true,null,true)}return[{name:"type",caption:"Type",editor:"Dropdown",set:r().sets.get_set("Object")({parameter:"Parameter",path:"Path",path_segment:"Path segments as list"})},{name:"parameter_name",caption:"Parameter name",editor:"ShortText",condition:"type is parameter"},{name:"value",caption:"Type",editor:"Dropdown",set:n}]},display(e,t){var n,r;let i="";const s=(n=(r=t.property("parameter_name").raw())==null?void 0:r.entries)!=null?n:{};for(const e of Object.values(s)){if(e!=null&&typeof e==="object"){i=null;break}i+=e}const o=e("type");if(o==="path"){return"Get path from page URL"}else{if(i){return`Get ${i} from page URL`}}return"Get data from page URL"},get_spot(){return"SlidableAtom"},get_value(e){const t=e("value");const n=e("type");if(n==="path_segment"){return i.list_type(t)}return t},get_runmode_value(e){var t,n,r;const s=(t=(n=e["%p"])==null?void 0:n["%v"])!=null?t:"text";const o=(r=e["%p"])==null?void 0:r["%x"];if(o==="path_segment"){return i.list_type(s)}return s},evaluate(e,t,n){if(t!=null&&t.__investigate_post_changed_page_url_reads){var i,o;s.warn("url data read after a change page",{properties:e,element:(i=t.element)==null?void 0:(o=i.id)==null?void 0:o.call(i)});delete t.__investigate_post_changed_page_url_reads}r().pageparam._dependency.register();let a;if(e.type==="path"){a=r().location.get_pieces().path[1]}else if(e.type==="path_segment"){a=r().location.get_pieces().path}else{a=r().location.get_query()[e.parameter_name]}function l(e,t){if(e.custom_type()!=null){if(typeof t!=="string"||!t){return e.get_bubble_null()}return r().db_instance().get(t)}else if(e.option_set()!=null){return e.from_human(t)}else if(e.is_list()){const n=Array.isArray(t)?t.map((t=>l(e.inner(),t))):[];return r().db_instance().static_list(e.inner().id(),n)}else{return e.cast(t)}}return l(n,a)},get_unique_string(e,t){}}},{"../../../lang/appquery":651,"../../../lang/btype_ids":652,"../../../lang/btypes_dropdowns":654,"../../../lib":741,"../../../logger":744,"core-js/modules/web.dom-collections.iterator.js":1123}],229:[function(e,t,n){"use strict";const r=e("../../../u/shared/b_string");const i=e("../../../lang/evaluation/page_state");const s=e("../../../lang/evaluation/state_keys");const o=e("../../../lang/appquery");const a={"Current Position":"Current geographic position","Website Home":"Website home URL",CurrentLanguage:"Current language",AppIsTest:"Isn't live version",AppVersion:"App version"};const l={"This Url":"This URL","Page Loaded (Entire)":"Page loaded entirely"};t.exports={field_names:{name:{}},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,check_btype:()=>true,allowed_in_style_conditionals:e=>["Current Page Width","Current Page Scrolling Position"].includes(e.value.properties.name),additional_context_filter(e,t){return i.get_page_data_names_new(t).includes(e.properties.name)},fields(e){return[{name:"name"}]},display(e){const t=e("name");if(o.has_feature_enabled("reorg_component_selection")){var n,i,s;return(n=(i=(s=l[t])!=null?s:a[t])!=null?i:r.FirstLetterCapitalize(t==null?void 0:t.toLowerCase()))!=null?n:"null"}else{var c,u;return(c=(u=a[t])!=null?u:r.FirstLetterCapitalize(t==null?void 0:t.toLowerCase()))!=null?c:"null"}},check_for_errors(e){if(i.get_page_data_type(e("name"))==="null"){return"Missing data... please double-check"}},get_value(e){var t;return(t=i.get_page_data_type(e("name")))!=null?t:"null"},context_key:"page_data",evaluate(e,t,n){var r,i;return n.cast((r=(i=t.datasources).page_data)==null?void 0:r.call(i,e,t))},get_runmode_value(e,t,n){var r,i,s;return(r=(i=(s=t.datasources).page_data_btype)==null?void 0:i.call(s,n,t))!=null?r:"null"},get_unique_string(e,t){return s.PageData(e.name)}}},{"../../../lang/appquery":651,"../../../lang/evaluation/page_state":698,"../../../lang/evaluation/state_keys":699,"../../../u/shared/b_string":841}],230:[function(e,t,n){"use strict";const r=t.exports;const i=e("../../../services/shared/plugin_getter");r.get_call=function(e){var t;if(!e){return}const n=e.split(".")[0];const r=e.split(".").slice(1).join(".");return(t=i.get_plugin(n))==null?void 0:t.get_call(r)};r.get_api_value_from_provider=function(e){const t=r.get_call(e);if(!t){return"null"}return t.get_value_id()}},{"../../../services/shared/plugin_getter":783}],231:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=t.exports;const i=e("../../../constants/special_keys");const s=e("../../../lang/lang");const o=e("../../../lang/evaluation/page_state");const a=e("../../../services/is_installed");const l=e("../../../documentation_id_getter");const{S:c}=e("../../../lang/shrink");const u=e("../../../lang/appquery");const d=e("../../../shared/apps_utilities");const p=e("../../../u/shared/async/autorun");const _=e("../../../u/shared/errors");const f=e("../../../u/shared/decaf");const h=e("../../../lang/btypes");const m=e("../../../lib");const g=e("../../../lang/btype_ids");const v=e("../../../constants/core");const b=e("./core_ds_element_utilities");const y=e("../../../option_sets");r.get_composer_context=function(e){var t,n,r,o,a,l,c,u;if(e.owner.get_composer_context){const t=e.owner.get_composer_context(e);if(t!=null){return t}}const d=e.context_element();let p,_;if(e.owner instanceof s.GenericEvent){p=false;_=e;while(_!=null){if(_.node_name()==="condition"){p=true;break}_=_.parent_expression()}}let f;if(e.owner instanceof s.GenericElement){const{field_names:t}=e.owner.E;_=e;while(_!=null){if(t[_.node_name()]!=null){if(t[_.node_name()].in_pageservice){f=true;break}}_=_.parent_expression()}}_=e;let h,m;while(_!=null){var g,v,b,y;if(((g=(v=_).name)==null?void 0:g.call(v))==="filtered"){var w,x,j,A;const t=(w=(x=_.property("constraints"))==null?void 0:(j=(A=x).entries)==null?void 0:j.call(A))!=null?w:[];for(const n of t){if(n.get_static_property("key")===i.ADVANCED_SEARCH_CONSTRAINT&&e.path().indexOf(n.path())===0){h=true;m=true;break}}}if(((b=(y=_).name)==null?void 0:b.call(y))==="format_as_text"){h=true;m=true;break}if(h){break}_=_.parent_expression()}if(!h){var M;if((d==null?void 0:(M=d.E)==null?void 0:M.use_injected_datasource)!=null){var E,k;h=(E=(k=d.E).use_injected_datasource)==null?void 0:E.call(k,e,d)}if(!h&&typeof e.owner.use_injected_datasource==="function"){[h,m]=e.owner.use_injected_datasource(e)}}return{node:e,is_state:e.owner instanceof s.State,is_event_condition:p,is_workflow:e.owner instanceof s.WorkflowObject,is_api:(t=(n=e.owner).root)==null?void 0:(r=t.call(n))==null?void 0:r.is_api(),has_parameters:Object.keys((o=(a=(l=e.owner).event)==null?void 0:(c=a.call(l))==null?void 0:c.field_names())!=null?o:{}).includes("parameters"),element_node:d,injected_value:h,full_list_of_datasources:m,is_style:d==null?void 0:(u=d.is_style)==null?void 0:u.call(d),in_pageservice:f}};r.get_visible_elements=function(e,t){if(!e){return[]}if(t==="Element"){t=undefined}const n=e.root();if(!n||n.is_api()){return[]}const r=[n,...n.find_elements(t)||[]];return r.filter((t=>b.is_element_visible(t,e)))};const w=["Input","MultiLineInput","RichTextInput","Dropdown","SliderInput","DateInput","PictureInput","FileInput","Checkbox","Group","Popup","RepeatingGroup","FloatingGroup","CustomElement","Image","Button","Icon","Text","Link"];const x=w.reduce(((e,t,n)=>{e[t]=n;return e}),{});r.sort_elements_by_type=function(e){const t={};const n={};for(const r of e){const e=r.id();t[e]=r.json._child(c.type).get();n[e]=r.name_for_datasource()}function r(e,r){const i=e.id();const s=r.id();const o=t[i];const a=t[s];if(e.incompatible_type&&!r.incompatible_type){return 1}else if(!e.incompatible_type&&r.incompatible_type){return-1}if(o===a){if(n[i]<n[s]){return-1}else{return 1}}else{const e=x[o];const t=x[a];if(e!=null&&t==null){return-1}else if(e==null&&t!=null){return 1}if(e!=null){if(t!=null){if(e<t){return-1}else{return 1}}else{return-1}}else if(o<a){return-1}else{return 1}}}return e.sort(r)};r.sort_elements_by_containers=function(e,t){const n=t==null?void 0:t.parent();if(!n||n instanceof s.Root){return e}const r=[];const i=[];const o=n.json._path();for(const t of e){const e=t.json._path();if(e.indexOf(o)!==-1){r.push(t)}else{i.push(t)}}return r.concat(i)};r.get_datasources_for_context=function(e,t){var n,i,l,c,p,_,f,h,m,v,b,w,x,A,M,E,k,O,S,D;const C=[];if(((n=t.node.owner)==null?void 0:(i=n.type)==null?void 0:i.call(n))==="interactions-KeyPressed"&&e==="key_combination"){return C}let T,N;if(typeof e.option_set==="function"){T=e.option_set();N=e.id()}else if(typeof e==="string"&&g.is_option_set(e)){T=u.option_set(g.option_set_name(e));N=e}if(T!=null){for(const e of T.values().sort(y.sort_options_fn)){if(!e.deleted()){C.push(s.RAW.DataSource("OneOptionValue",{option_set:N,option_value:e.name()}))}}}let P;if(typeof e.id==="function"){P=e.id()}else{P=e}if((l=(c=P).startsWith)!=null&&l.call(c,g.list_type(g.option_set_type("")))){C.push(s.RAW.DataSource("AllOptionValue",{option_set:g.list_element_type(P)}))}if(t.privacy_condition){C.push(s.RAW.DataSource("InjectedValue"));C.push(s.RAW.DataSource("CurrentUser"));return C}if(t.data_trigger){C.push(s.RAW.DataSource("OldDataItem"));C.push(s.RAW.DataSource("CurrentDataItem"));return C}if(t.is_style){C.push(s.RAW.DataSource("ThisElement"));for(const e of["Current Page Width","Current Page Scrolling Position"]){C.push(s.RAW.DataSource("PageData",{name:e}))}C.push(s.RAW.DataSource("CurrentUser"));return C}const I=(p=(_=t.node.owner).event)==null?void 0:p.call(_);if(t.has_parameters){for(const e of(R=I==null?void 0:I.get_custom_parameters())!=null?R:[]){var R;let t;if(I.type()==="CustomEvent"){t="CurrentWorkflowItem"}else{t="APIEventParameter"}C.push(s.RAW.DataSource(t,e))}}if(((f=I==null?void 0:I.get_static_property("custom_event_data_type"))!=null?f:"null")!=="null"){C.push(s.RAW.DataSource("CurrentWorkflowItem"))}if(t.injected_value){C.push(s.RAW.DataSource("InjectedValue"));if(!t.full_list_of_datasources){return C}}if(t.element_node&&!(t.is_api||t.in_pageservice)&&(t.is_state||t.is_workflow)){var L;const e=s.RAW.DataSource("ThisElement",{element_id:t.element_node.id()});const n=r.simulate_insert(e,t).get_value();if((L=r.get_messages_for_context(n,t))!=null&&L.length){C.push(e)}}if(["OnError","OnPageError"].includes((h=(m=t.node.owner).event)==null?void 0:(v=h.call(m))==null?void 0:v.type())){C.push(s.RAW.DataSource("CurrentWorkflowItem"))}const z=(b=(w=(x=t.node.owner).event)==null?void 0:(A=w.call(x))==null?void 0:A.get_static_property("data_trigger_type"))!=null?b:"null";if(z!=="null"){C.push(s.RAW.DataSource("OldDataItem"));C.push(s.RAW.DataSource("CurrentDataItem"))}if(!t.is_api&&!t.in_pageservice){var B,q,U,F,W,$,G,V,H,X;let e=(B=t.element_node)==null?void 0:B.parent();const n=(q=(U=e)==null?void 0:U.get_states())!=null?q:[];if(((F=e)==null?void 0:F.type())!=="Table"&&((W=e)==null?void 0:W.type())!=="TableCell"&&(n.includes("group_data")||n.includes("list_data")||n.includes("currently_selected_event")||n.includes("currently_selected_marker"))){C.push(s.RAW.DataSource("ElementParent"))}if((($=e)==null?void 0:$.type())==="TableCell"){C.push(s.RAW.DataSource("ElementAncestor",{fetch_data:true,ancestor_type:"TableCrossAxis"}))}const r=[];while(e){if(e.type()==="TableCrossAxis"){r.push(e.type());r.push("TableMainAxis")}else if(e.type()==="Table"){r.push(e.type());break}e=e.parent()}e=(G=t.element_node)==null?void 0:G.parent();while(e&&e.type()!=="RepeatingGroup"&&e.type()!=="TableCrossAxis"){e=e.parent()}if(((V=(H=e)==null?void 0:(X=H.get_states)==null?void 0:X.call(H))!=null?V:[]).includes("list_data")){C.push(s.RAW.DataSource("CurrentCellsIndex"))}for(const e of r){C.push(s.RAW.DataSource("ElementAncestor",{fetch_data:false,ancestor_type:e}))}}let Y=(M=(E=t.node.owner).previous)==null?void 0:M.call(E);while(Y instanceof s.Action){if(Y.return_value().id()!=="null"){C.push(s.RAW.DataSource("PreviousStep",{action_id:Y.id()}))}Y=Y.previous()}C.push(s.RAW.DataSource("CurrentUser"));if(!t.is_api&&((k=(O=t.node.owner).root)==null?void 0:(S=k.call(O))==null?void 0:S.get_static_property("page_item_type"))!=null){C.push(s.RAW.DataSource("CurrentPageItem"))}C.push(s.RAW.DataSource("Search"));C.push(s.RAW.DataSource("OptionValue"));if(u.get_private_setting("general_keys.has_valid_algolia")){C.push(s.RAW.DataSource("AlgoliaSearch"))}if(!t.in_pageservice){C.push(s.RAW.DataSource("GetDataFromAPI"));C.push(s.RAW.DataSource("Formulas"))}if(!t.is_api&&!t.in_pageservice){const n=[];for(const i of r.get_visible_elements(t.element_node)){if(!i.can_reference())continue;const r=s.RAW.DataSource("GetElement",{element_id:i.id()});if(i.is_input()){if(i.type()==="Input"||j(r,e,t)){delete i.incompatible_type}else{i.incompatible_type=true}n.push(i)}else if(j(r,e,t)){n.push(i)}}r.sort_elements_by_type(n);const i=r.sort_elements_by_containers(n,t.element_node);for(const e of i){C.push(s.RAW.DataSource("GetElement",{element_id:e.id(),incompatible_type:e.incompatible_type}))}}if(j(s.RAW.DataSource("AppText",{}),e,t)){C.push(s.RAW.DataSource("AppText"))}C.push(s.RAW.DataSource("ArbitraryText"));C.push(s.RAW.DataSource("DateTime"));if(!t.in_pageservice){for(const n of o.get_page_data_names(t)){const r=s.RAW.DataSource("PageData",{name:n});if(j(r,e,t)){C.push(r)}}}if(a("interactions")){C.push(s.RAW.DataSource("GetMouseData"))}if(!t.is_api){C.push(s.RAW.DataSource("GetParamFromUrl"))}if(d.is_hardcoded(u.appname())||u.appname()==="meta"){C.push(s.RAW.DataSource("AppSetting",{}))}if(((D=e.get_name)==null?void 0:D.call(e))==="saveable"){return C.filter((n=>j(n,e,t)))}return C};r.get_messages_for_context=(e,t)=>e.get_messages().filter((e=>e.filter_context(t)));r.simulate_insert=(e,t)=>s.new_expression(s.VirtualJSON(t.node.json,e),t.node.owner);function j(e,t,n){if(e.type==="Search"){return true}const i=r.simulate_insert(e,n).get_value();return E(i,t,n,{})}const A={};function M(e){if(e&&typeof e==="object"){if(e.toUniqueString){return e.toUniqueString()}else{const t={};for(const n in e){const r=e[n];t[n]=M(r)}return t}}else{return e}}function E(e,t,n){var r;let i;if(n){i=JSON.stringify(M(n))}else{i=""}let s;if(typeof t.display==="function"){s=t.display()}else{s=t}const o=(e==null?void 0:e.id())+"_"+s+" "+i;(r=A[o])!=null?r:A[o]=p.Watcher((()=>{if(!(e!=null&&e.id())){return}return k(h.get(e.id()),t,n)}));return A[o].get()}function k(e,t,n,i){var s;(s=i)!=null?s:i=new Set;if(i.has(e.id())){return false}i.add(e.id());if(e.matches(t)){return true}const o=r.get_messages_for_context(e,n);const a=o.map((e=>e.ret_btype()));for(const e of a){if(k(e,t,n,i)){return true}}return false}function O(e,t){if(e.type()==="ThisElement"){return 60}if(e.type()==="PreviousStep"){return 80}if(e.type()==="CurrentUser"){return 40}if(["ElementParent","CurrentCellsIndex"].includes(e.type())){return 70}return 30}r.datasource_to_option=function(e,t,n){var i;const o=r.simulate_insert(e,t);let a,c;if((i=e.properties)!=null&&i.element_id){if(e.properties.incompatible_type){c="Documentation.Data.DataSources.IncompatibleType";a="Incompatible type"}else{c=e.properties.element_id}}else{if(n.includes(e.type)){c=l.for_datasource(e)}}if(!t.list_only&&o.get_spot()==="SlidableAtom"){const n=o.type();e={type:n,cb_fn:e=>e({node:t.node,stay_on_this_node:true,val:s.RAW.DataSource(n)})}}return new(m().sets.Option)(o.display(),e,c,O(o,t),a!=null,a)};r.message_to_option=function(e,t){var n;const r=s.RAW.Message(e.name());let i=null;if(e.spot_data()==="SlidableAtom"){i={cb_fn:e=>e({stay_on_this_node:true,node:t.node.next(),val:r})}}const o=e.description(undefined,undefined,{parent_node:t.node,for_consumer:v.DROPDOWN_DESCRIPTION_CONTEXT});return new(m().sets.Option)(o,(n=i)!=null?n:r,e.M.documentation_id,undefined,undefined,undefined,e.M.delete_cb)};r.assign_to_sections=function(e,t){const n=t.is_workflow?"This Workflow":"This Element";const r={APIEventParameter:n,ThisElement:n,InjectedValue:n,CurrentUser:"DB Data",CurrentPageItem:"DB Data",CurrentWorkflowItem:n,CurrentDataItem:n,OldDataItem:n,Search:"DB Data",AlgoliaSearch:"DB Data",GetDataFromAPI:"DB Data",GetMouseData:"General Info",Formulas:"DB Data",ArbitraryText:"General Info",DateTime:"General Info",OptionValue:"DB Data",OneOptionValue:"Literals",AllOptionValue:"Literals",ElementParent:n,CurrentCellsIndex:n,PreviousStep:n,ElementAncestor:n,PageData:"General Info",GetElement:"Page Elements",boolean:"Literals",GetParamFromUrl:"General Info",AppText:"General Info",AppSetting:"General Info"};const i={};for(const c of f.array_from(e)){var s,o,a,l;let e;if(typeof c.value==="object"){e=c.value.type}else{e=typeof c.value}if(!r[e]){throw new _.UnexpectedError("missing section for datasource "+e)}let u=r[e];if(t.element_node&&t.element_node.type()!=="CustomDefinition"&&((s=t.element_node.root())==null?void 0:s.type())==="CustomDefinition"&&((o=t.element_node.root())==null?void 0:o.get_name())===c.display){u=n}(l=i[a=u])!=null?l:i[a]=[];i[u].push(c)}return i}},{"../../../constants/core":55,"../../../constants/special_keys":87,"../../../documentation_id_getter":486,"../../../lang/appquery":651,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lang/evaluation/page_state":698,"../../../lang/lang":714,"../../../lang/shrink":728,"../../../lib":741,"../../../option_sets":748,"../../../services/is_installed":781,"../../../shared/apps_utilities":788,"../../../u/shared/async/autorun":830,"../../../u/shared/decaf":844,"../../../u/shared/errors":846,"./core_ds_element_utilities":234,"core-js/modules/web.dom-collections.iterator.js":1123}],232:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=t.exports;const i=e("../../../safe_require");i.safe_register("./core/core_datasources/utilities/core_ds_db_ops_utilities",r);const s=e("../../../u/shared/errors");const o=e("../../../logger");const a=e("../../../u/shared/decaf");const l=e("../../../db/constraint_defs");const c=e("../../../lang/btypes");const u=e("../../../constants/special_keys");const d=e("../../../geolocation/b_location");const p=e("lodash/map");const _=e("lodash/compact");const f=e("../../../lang/appquery");const h=e("../../../lib");const m=e("../../../lang/application/builtins");const g=e("../../core_actions/utilities/generic_actions_utilities");r._get_sortable_btypes=function(e){const t=["boolean","text","number","date","dateinterval","file","image"];if(e){t.push("geographic_address")}return t};r.is_field_okay=function(e,t){const n=c.get(t);if(e===u.RANDOM_SORTING){return true}const r=n.option_set();if(r!=null&&r.exists()){if(e==="display"||r.attribute(e).exists()){return true}return false}const i=n.custom_type();if([u.ALL_DB_FIELDS,u.UNIQUE_ID].includes(e)){return true}if(i!=null&&i.exists()){if(e==="email"&&i.id()==="user"){return true}if(i.field(e).exists()){return true}if(m.get_special_fields(i).map((e=>e.name())).includes(e)){return true}}if(t.startsWith("api")){if(n.plugin.get_message_names().includes(e)){return true}}if(n.is_aggregate()){return true}o.warn("bad field name in search",{field_name:e,value_id:t});return false};r.get_sorts_list=function(e,t){const n=[];const i=c.get(e.type_to_find);const s=i.custom_type();const o=c.get("boolean");if(i.is_missing()){return[{sort_field:v(e,e.type_to_find,t),descending:o.cast(e.descending)}]}function l(n){let i=v(n,e.type_to_find,t);let a=o.cast(n.descending);if(s!=null&&s.exists()&&s.field(i).value()==="geographic_address"){if(d.ensure_valid_location(n.geo_reference)){i={location_field:i,geo_reference:n.geo_reference}}else{i=null}}else if(i&&!r.is_field_okay(i,e.type_to_find)){i=null;a=null}else if(i===u.RANDOM_SORTING){a=null}else if([null,undefined].includes(i)){a=null}return{sort_field:i,descending:a}}n.push(l(e));if(e.sort_field===u.RANDOM_SORTING){return n}for(const t of a.object_values(e.additional_sort_fields)){n.push(l(t))}return n};function v(e,t,n){if(e.sort_field!==u.DYNAMIC_SORTING_FIELD){return e.sort_field}if(!e.dynamic_sort_field){return null}const i=c.get(t);if(i.is_missing()){return null}let o=e.dynamic_sort_field.toLowerCase();const a=[];if(n){const e=i.custom_type();for(const t of e.fields()){a.push({display:t.display(),name:t.name(),value:t.value()})}a.push({display:"Created Date",name:"Created Date",value:"date"});a.push({display:"Modified Date",name:"Modified Date",value:"date"})}else{const e=i.get_messages();for(const t of e){if((t==null?void 0:t.arg_btype())==null){a.push({display:t.description(undefined,true),name:t.name(),value:t.ret_btype_id()})}}if(o==="created date"){o="creation date"}}const l=r._get_sortable_btypes(n);for(const t of a){if(t.display.toLowerCase()===o){if(!l.includes(t.value)){throw new s.OwnerError("The dynamic sort field "+e.dynamic_sort_field+" on the type "+i.display()+" cannot be used for sorting")}return t.name}}throw new s.OwnerError("Dynamic sort field not recognized",{display:"The dynamic sort field "+e.dynamic_sort_field+" is not recognized as a field on the type "+i.display()})}r.resolve_constraints=(e,t)=>_(p(e!=null?e:{},(e=>s.error_append_args({entry:e},(()=>{if(!e){return}if(e.key===u.ADVANCED_SEARCH_CONSTRAINT){return e}if(e.key===u.UNIQUE_ID){var n;(n=e.constraint_type)!=null?n:e.constraint_type="equals"}if(!e.constraint_type){return}const r=l.get(e.constraint_type);return r.resolve_constraint({entry:e,null_not_dropped:t})})))));r.convert_api_call_to_db_object=function(e,t){const n=c.get(t.value_id);if(!n.plugin.convert_to_bubble_instance){throw new s.UnexpectedError("value "+n.id()+" missing convert_to_bubble_instance",{value_id:n.id(),appname:f.appname(),result:e})}if(t.is_list){const r=a.array_from(e!=null?e:[]).map((e=>n.plugin.convert_to_bubble_instance(e)));return h().db_instance().static_list(t.value_id,r)}return n.plugin.convert_to_bubble_instance(e)};r.get_key_value=function(e,t){const n=t?c.get(t):null;let r,i;if(e==="email"&&t==="user"){r="email"}else if(![u.ALL_DB_FIELDS,u.ADVANCED_SEARCH_CONSTRAINT,u.UNIQUE_ID,"StripeCustomerID"].includes(e)){var s;r=g.sub_node_key_to_value(n,e);i=(s=r)!=null&&s.is_list()?r.inner():r}else{r=e}return{key_value_delisted:i,key_value:r}};r.constraints_without_values=l.all().filter((e=>e.takes_no_value())).map((e=>e.name))},{"../../../constants/special_keys":87,"../../../db/constraint_defs":426,"../../../geolocation/b_location":621,"../../../lang/application/builtins":649,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lib":741,"../../../logger":744,"../../../safe_require":777,"../../../u/shared/decaf":844,"../../../u/shared/errors":846,"../../core_actions/utilities/generic_actions_utilities":175,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/compact":1310,"lodash/map":1330}],233:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=t.exports;const i=e("./core_ds_db_ops_utilities");const s=e("../../../lang/btype_ids");const o=e("../../../lang/appquery");const a=e("../../../constants/db");const l=e("../../../lang/btypes");const c=e("../../../lib");const u=e("../../../services/is_installed");const d=e("../../../constants/special_keys");const p=e("../../../u/shared/decaf");r.get_fields_set=function(e){var t;let{to_find_name:n,db_fields_only:r,sortable_fields_only:s,show_dynamic_sort_option:o,hide_unique_id:l,exclude_fields:d}=e;(t=d)!=null?t:d=[];if(n==="user"&&s){d.push("email")}let p;if(s){p=i._get_sortable_btypes(r)}else{p=null}let _;if(r){_=a.NO_DB_CONSTRAINTS}else{_=null}let f;if(r){f=c().sets.get_set("CustomFields")({white_list_btypes:p,btypes_to_filter_out:_,btype_name:n,include_all_fields:!s,add_email_field_for_user_type:n==="user"&&!s,add_unique_id:!s&&!l,show_dynamic_sort_option:o,show_random_sort_option:s,add_stripe_customer_id:n==="user"&&u("stripe")})}else{f=c().sets.get_set("MessagesWithoutArguments")({white_list_btypes:p,btypes_to_filter_out:_,btype_name:n,add_advanced:!s,show_dynamic_sort_option:o,show_random_sort_option:s})}if(d.length>0){return c().sets.get_set("Filtered")(f,(e=>!d.includes(e.value)))}else{return f}};r.get_constraints_fields=(e,t,n)=>{var o;return[{name:"constraints",editor:"ObjectList",button_caption:"Add a new constraint",remove_caption:(o=window)!=null&&o.is_maison?"delete":null,optional:true,sub_properties:o=>{var a;const u=o==null?void 0:(a=o.entry)==null?void 0:a.call(o,"key").get_static();const{key_value_delisted:_,key_value:f}=i.get_key_value(u,e);let h;if(f===d.ADVANCED_SEARCH_CONSTRAINT){h="advanced_search_constraint"}else if(f){h=o==null?void 0:o.entry("constraint_type").get_static();if(h){var m;if(!p.array_from((m=window)!=null&&m.composer_revamp?c().sets.get_set("SearchOperators")(f).all():c().sets.get_set("SearchOperators")(f).get_options_raw()).includes(h)){h=null}}}const g=["in","not in"].includes(h)?f===d.UNIQUE_ID?l.get(s.list_type("text")):l.get(s.list_type(f.id())):h==="contains_all_fields"||[d.UNIQUE_ID,"StripeCustomerID"].includes(f)?l.get("text"):h==="advanced_search_constraint"?l.get("sys.bool"):["range_contains_point","range_greater_than_point","range_less_than_point"].includes(h)?f.id().split("_range")[0]:_!=null?_:l.get("null");let v;if(n){v=c().sets.get_set("Object")({[d.ADVANCED_SEARCH_CONSTRAINT]:"Constraint: "})}else{v=r.get_fields_set({to_find_name:e,db_fields_only:t})}const b=[{name:"key",editor:u!=null?"Label":"Dropdown",label_text(){var e,t;return(e=window)!=null&&e.composer_revamp?(t=v.find((e=>e.value===u)))==null?void 0:t.display:v.get_display(u)},check_for_error:(e,t,n,r)=>{if(!e.label_text()){const e=`${n()}: the constraint field is empty`;return r(e,t)}},set:v,pretty:{arrowless:true}},{name:"constraint_type",editor:f===d.ADVANCED_SEARCH_CONSTRAINT?"Label":"Dropdown",set:f?c().sets.get_set("SearchOperators")(f):c().sets.get_set("NullSet")(),default:f===d.UNIQUE_ID&&t?"equals":undefined,label_text(){return""},only_edit_mode:f===d.ADVANCED_SEARCH_CONSTRAINT,width_class:"width-170",condition(){return f!=null},pretty:{arrowless:true}}];if(!i.constraints_without_values.includes(h)){b.push({name:"value",editor:h==="geographic_search"?"GeographicSearch":["in","not in"].includes(h)?"Basic":_!=null&&_.matches("text")||["contains_all_fields","email_equals","email_contains_string"].includes(h)?"ShortText":"Basic",value:g,condition(){return h!=null||(_==null?void 0:_._id)==="geographic_address"||f===d.UNIQUE_ID},pretty:{arrowless:true}})}return b}}]};function _(e,t,n,i,s){var o;(o=i)!=null?o:i=[];return[{name:"sort_field",caption:"Sort by",editor:"Dropdown",set:r.get_fields_set({to_find_name:e,db_fields_only:t,sortable_fields_only:true,show_dynamic_sort_option:true,exclude_fields:i}),optional:!s},{name:"dynamic_sort_field",caption:"Dynamic field name",editor:"ShortText",value:"text",condition:"sort_field is "+d.DYNAMIC_SORTING_FIELD,optional:true},{name:"geo_reference",caption:"Distance from",editor:"Basic",value:"geographic_address",condition(){var t;return((t=l.get(e).get_message(n))==null?void 0:t.ret_btype().id())==="geographic_address"}},{name:"descending",caption:"Descending",editor:"Basic",value:"boolean",condition(){return n!=null&&n!==d.RANDOM_SORTING},optional:true}]}r.get_sorting_fields=(e,t,n)=>_(e,t,n).concat({name:"additional_sort_fields",editor:"ObjectList",button_caption:"Add another sort field",sub_properties:(n,r)=>{var i,s,o,a;const l=[d.RANDOM_SORTING];function c(e){if(e&&e!==d.DYNAMIC_SORTING_FIELD){l.push(e)}}c((i=r.property("sort_field"))==null?void 0:i.raw());const u=n==null?void 0:(s=n.raw())==null?void 0:s.sort_field;const p=(o=(a=r.property("additional_sort_fields"))==null?void 0:a.raw())!=null?o:{};for(const e of Object.values(p)){if(e.sort_field!==u){c(e.sort_field)}}return _(e,t,u,l,true)},condition(){return n!=null&&n!==d.RANDOM_SORTING},optional:true});r.ignore_empty_constraints_checkbox={name:"ignore_empty_constraints",caption:"Ignore empty constraints",editor:"Checkbox",condition(){return o.get_public_setting("bubble_version")>=5}}},{"../../../constants/db":58,"../../../constants/special_keys":87,"../../../lang/appquery":651,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lib":741,"../../../services/is_installed":781,"../../../u/shared/decaf":844,"./core_ds_db_ops_utilities":232,"core-js/modules/web.dom-collections.iterator.js":1123}],234:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=t.exports;const i=e("../../../lang/btypes");const s=e("../../../lang/appquery");r.get_element_parent=e=>{var t;return(t=e.context_element())==null?void 0:t.parent()};r.get_runtime_parent=function(e){var t;let n=(t=e.element)==null?void 0:t.parent();while(n&&n.element.type()!=="RepeatingGroup"&&n.element.type()!=="Table"&&!n.element.get_states().includes("group_data")){n=n.parent()}return n};r.get_ancestor_element=function(e,t){if(e==="TableMainAxis"){const e=r.get_ancestor_element("TableCell",t);const n=e.get_static_property("cell_main_axis_id");return s.element(n)}let n=t.context_element();while(n&&n.type()!==e){n=n.parent()}return n};r.context_parent_value=e=>{var t,n,r;if((e==null?void 0:(t=e.type)==null?void 0:t.call(e))==="TableCell"){var i,s,o;return(i=(s=e.parent())==null?void 0:(o=s.parent())==null?void 0:o.get_static_property("group_type"))!=null?i:null}return(n=e==null?void 0:(r=e.parent())==null?void 0:r.get_static_property("group_type"))!=null?n:null};r.element_parent_value=(e,t)=>i.get(r.context_parent_value(t.context_element()));function o(e){return e.draws_own_children()}r.is_element_visible=function(e,t){var n,r,i;if(!t){return false}if(((n=e.root())==null?void 0:n.id())!==((r=t.root())==null?void 0:r.id())){return false}const s=(i=t.parents)==null?void 0:i.call(t,o).map((e=>e.id()));function a(e){for(const t of e.parents(o)){if(!s.includes(t.id())){return false}}return true}return a(e)}},{"../../../lang/appquery":651,"../../../lang/btypes":653,"core-js/modules/web.dom-collections.iterator.js":1123}],235:[function(e,t,n){"use strict";const r=t.exports;const i=e("../../../safe_require");i.safe_register("./core/core_datasources/utilities/core_ds_field_names",r);r.constraints_field_names={constraints:{}};r.sorting_field_names={sort_field:{},dynamic_sort_field:{},geo_reference:{},descending:{optional:true},additional_sort_fields:{optional:true}}},{"../../../safe_require":777}],236:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=t.exports;const i=e("../../../safe_require");i.safe_register("./core/core_datasources/utilities/core_ds_workflow_utilities",r);const s=e("../../../constants/core");const o=e("../../../u/shared/uuid");const a=e("../../../u/shared/decaf");const l="__ALL__";r.generate_wf_param_datasource=e=>function(t){if(t.param_id===l){return e}else{if(typeof e[t.param_id]==="function"){return e[t.param_id]()}else{return e[t.param_id]}}};r.dehydrate_wf_params=function(e,t){var n,r,i;const s={};const o=(n=(r=e.datasources)==null?void 0:(i=r.get_wf_param)==null?void 0:i.call(r,{param_id:l}))!=null?n:{};for(const[e,n]of Object.entries(o)){if(typeof n==="function"){s[e]=t(n())}else{s[e]=t(n)}}return s};r.rehydrate_wf_params=function(e,t){const n={};if(e.current_wf_item!=null){n[s.LEGACY_PARAM_ID]=t(e.current_wf_item)}for(const[r,i]of a.object_entries(e.current_wf_params)){n[r]=t(i)}return n};r.wf_params_from_properties=function(e){const t={};if(e.arguments){for(const{param_id:n,arg_value:r}of Object.values(e.arguments)){t[n]=r}}else{t[s.LEGACY_PARAM_ID]=e.workflow_thing}return t};r.build_duplicate_per_item_context=function(e,t){const n={...e};e.duplicated_from_context=e.object_id;e.object_id=o.UUID();e.duplicated_at="core_ds_workflow_utilities.build_duplicate_per_item_context";n.datasources={...e.datasources,get_wf_param:r.generate_wf_param_datasource(t)};return n}},{"../../../constants/core":55,"../../../safe_require":777,"../../../u/shared/decaf":844,"../../../u/shared/uuid":855,"core-js/modules/web.dom-collections.iterator.js":1123}],237:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../lang/evaluation/state_keys");const i=e("../../../lang/appquery");function s(e,t){var n,r;const i=(n=e==null?void 0:(r=e.get_custom_parameters)==null?void 0:r.call(e))!=null?n:[];for(const{param_id:e,btype_id:n}of i){if(e===t){return n}}return"null"}t.exports={field_names:{param_id:{},key:{}},get_value(e,t){var n,r,i;const o=(n=e("param_id"))!=null?n:e("key");const a=(r=(i=t.owner).event)==null?void 0:r.call(i);return s(a,o)},light_evaluation:true,allowed_when_restricted:false,allowed_on_element:true,allowed_on_workflow:true,allowed_on_backend:true,get_required_visible_id(e){var t,n;return`${(t=e.properties)==null?void 0:t.event_id}.${(n=e.properties)==null?void 0:n.param_id}`},fields(e){return[{param_id:"param_id"}]},display(e){var t;const n=(t=e("param_id"))!=null?t:e("key");if(n==="_wf_request_data"){return"Request Data"}else{return n}},evaluate(e,t,n){var r,i;const s=(r=e.param_id)!=null?r:e.key;const o=(i=t.call_parameters)==null?void 0:i[s];const a=n.cast(o);return a},get_runmode_value(e,t,n){var r;if(!t.event_id){return"null"}const o=i.workflow_item(t.event_id);const a=(r=n.param_id)!=null?r:n.key;const l=s(o,a);return l},get_unique_string(e,t){var n;return r.APIEventParameter((n=e.param_id)!=null?n:e.key)}}},{"../../../lang/appquery":651,"../../../lang/evaluation/state_keys":699,"core-js/modules/web.dom-collections.iterator.js":1123}],238:[function(e,t,n){"use strict";const r=e("../../../lang/btypes");const i=e("../../../lang/appquery");t.exports={field_names:{},get_value(e,t){var n,i,s;const o=(n=(i=t.owner).event)==null?void 0:n.call(i);let a=o?["OnError","OnPageError"].includes(o.type())?"sys.error":o.get_static_property("data_trigger_type"):undefined;(s=a)!=null?s:a="null";return r.get(a)},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:false,allowed_on_workflow:true,allowed_on_backend:true,additional_context_filter(e,t){var n,r,i;return t.owner_type==="BackendWorkflow"&&(t.owner_node.type()==="DatabaseTriggerEvent"||((n=t.owner_node.event())==null?void 0:n.type())==="DatabaseTriggerEvent"&&((r=(i=t.owner_node.event())==null?void 0:i.get_static_property("data_trigger_type"))!=null?r:"null")!=="null")},fields(e,t){return[]},display(e,t){const n=this.get_value(e,t);let r;if(n.id()==="null"){r="Thing"}else{r=n.display()}if(i.has_feature_enabled("reorg_component_selection")){return r+" now"}else{return r+" Now"}},context_key:"current_data_item",evaluate(e,t,n){var r,i;return n.cast((r=(i=t.datasources).current_data_item)==null?void 0:r.call(i,e,t))},get_runmode_value(e,t,n){var r,i,s;return(r=(i=(s=t.datasources).current_data_item_btype)==null?void 0:i.call(s,n,t))!=null?r:"null"},get_unique_string(){}}},{"../../../lang/appquery":651,"../../../lang/btypes":653}],239:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../lang/btypes");const i=e("../../../constants/core");const s=e("../../../lang/appquery");const o=e("../../../logger");function a(e,t){var n,r;const i=(n=e==null?void 0:(r=e.get_custom_parameters)==null?void 0:r.call(e))!=null?n:[];for(const{param_id:e,btype_id:n}of i){if(e===t){return n}}return"null"}function l(e,t){if(["OnError","OnPageError"].includes(e==null?void 0:e.type())){return"sys.error"}let n=a(e,t);if(n==="null"){var r;n=(r=e==null?void 0:e.get_static_property("custom_event_data_type"))!=null?r:"null"}return n}t.exports={field_names:{param_id:{default:i.LEGACY_PARAM_ID}},get_value(e,t){var n,i;const s=(n=(i=t.owner).event)==null?void 0:n.call(i);const o=e("param_id");return r.get(l(s,o))},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:false,allowed_on_workflow:true,allowed_on_backend:true,get_required_visible_id(e){if(e.properties){return`${e.properties.event_id}.${e.properties.param_id}`}},additional_context_filter(e,t){if(e.properties){return true}else if(t.owner_type==="Workflow"){var n;const e=t.owner_node.event();return["OnError","OnPageError"].includes(e==null?void 0:e.type())||((n=e==null?void 0:e.get_static_property("custom_event_data_type"))!=null?n:"null")!=="null"}else if(t.owner_type==="BackendWorkflow"){var r;return((r=t.owner_node.event())==null?void 0:r.type())==="RecurringEvent"}else{return false}},fields(e,t){return[{param_id:"param_id"}]},display(e,t){var n,i,s;const o=(n=(i=t.owner).event)==null?void 0:n.call(i);if(["OnError","OnPageError"].includes(o==null?void 0:o.type())){return"Current Workflow Error"}let a=null;const l=(s=o==null?void 0:o.get_custom_parameters())!=null?s:[];for(const{param_id:t,param_name:n}of l){if(t===e("param_id")){a=n}}if(!a&&o!=null&&o.get_static_property("custom_event_data_type")){const e=o.get_static_property("custom_event_data_type");const t=r.get(e);a="Current Workflow's "+t.display()}if(!a){var c;a="[not found: properties.";a+=(c=e("param_name"))!=null?c:"Workflow Thing";a+="]"}return a},evaluate(e,t,n){var r,i;return n.cast((r=(i=t.datasources).get_wf_param)==null?void 0:r.call(i,e))},get_runmode_value(e,t,n){var r;if(!t.event_id&&!t.event){return"null"}if(!t.event){o.verbose("Missing event!!",{event_id:t.event_id})}const i=(r=t.event)!=null?r:s.workflow_item(t.event_id);return l(i,n.param_id)},get_unique_string(e,t){}}},{"../../../constants/core":55,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../logger":744,"core-js/modules/web.dom-collections.iterator.js":1123}],240:[function(e,t,n){"use strict";const r=e("../../../lang/btypes");const i=e("../../../lang/appquery");t.exports={field_names:{},get_value(e,t){var n,i;const s=(n=(i=t.owner).event)==null?void 0:n.call(i);const o=s?["OnError","OnPageError"].includes(s.type())?"sys.error":s.get_static_property("data_trigger_type"):undefined;return r.get(o!=null?o:"null")},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:false,allowed_on_workflow:true,allowed_on_backend:true,additional_context_filter(e,t){var n,r,i;return t.owner_type==="BackendWorkflow"&&(t.owner_node.type()==="DatabaseTriggerEvent"||((n=t.owner_node.event())==null?void 0:n.type())==="DatabaseTriggerEvent"&&((r=(i=t.owner_node.event())==null?void 0:i.get_static_property("data_trigger_type"))!=null?r:"null")!=="null")},fields(e,t){return[]},display(e,t){const n=this.get_value(e,t);let r;if(n.id()==="null"){r="Thing"}else{r=n.display()}if(i.has_feature_enabled("reorg_component_selection")){return r+" before change"}else{return r+" Before Change"}},context_key:"old_data_item",evaluate(e,t,n){var r,i;return n.cast((r=(i=t.datasources).old_data_item)==null?void 0:r.call(i,e,t))},get_runmode_value(e,t,n){var r,i,s;return(r=(i=(s=t.datasources).old_data_item_btype)==null?void 0:i.call(s,n,t))!=null?r:"null"},get_unique_string(e,t){}}},{"../../../lang/appquery":651,"../../../lang/btypes":653}],241:[function(e,t,n){"use strict";const r=e("../../../lang/appquery");const i=e("../../../lang/evaluation/state_keys");function s(e,t){if(t.length<=e){return t}else{return t.slice(0,e-3)+"..."}}function o(e,t){const n=r.action(e("action_id"));if(!n||!n.exists()){return null}let i=n.next();while(i){if(t.owner.id()===i.id()){return n}else{i=i.next()}}return null}t.exports={field_names:{action_id:{}},light_evaluation:false,allowed_when_restricted:false,allowed_on_element:false,allowed_on_workflow:true,allowed_on_backend:true,get_required_visible_id(e){return e.properties.action_id},get_runmode_value(e,t,n){const{action_id:r}=n;return t.frozen_state.get(this.get_unique_string({action_id:r})+"_value")},evaluate(e,t,n){var r;return(r=t.frozen_state.get(this.get_unique_string(e)))!=null?r:n.get_bubble_null()},get_value(e,t){var n,r;return(n=(r=o(e,t))==null?void 0:r.return_value())!=null?n:"null"},fields(){return[{name:"action_id"}]},display(e,t){const n=o(e,t);if(!n){return"Result of missing step"}let i=0;let a=r.action(e("action_id"));while(a.is_action()){a=a.previous();i+=1}return"Result of step "+i+" ("+s(20,n.display())+")"},check_for_errors(e,t){if(!o(e,t)){return"It looks like the action this used to refer to was deleted or moved"}},get_unique_string(e){return i.PreviousStep(e.action_id)}}},{"../../../lang/appquery":651,"../../../lang/evaluation/state_keys":699}],242:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../u/shared/async/autorun");var i=c(e("../../lang/app_json/runtime_json"));var s=c(e("../../lang/elements/Element"));var o=c(e("../../shared/responsive/responsive_layout"));var a=c(e("./core_elements_utilities/element_registry"));var l=c(e("../../lang/appquery"));function c(e){return e&&e.__esModule?e:{default:e}}t.exports=class e extends s.default{constructor(e,t,n,r){const s=new i.default(e.repeating_layout_type==="Table"?e.element.json._raw():undefined,null,"",undefined,l.default.appname(),l.default.app_version());super(s,false,{_type:"GroupItem"});this.repeating_instance=void 0;this.height=void 0;this.num=void 0;this.data_instance=void 0;this.repeating_layout=void 0;this.instance=void 0;this.id_watcher=void 0;this.repeating_instance=e;this.height=t;this.num=n;this.E=a.default.get_element_object("GroupItem");this.data_instance=r!=null?r:e;this.repeating_layout=e.repeating_layout_type}exists(){return true}id(){var e;(e=this.id_watcher)!=null?e:this.id_watcher=(0,r.Watcher)((()=>{var e,t,n;const r=this.repeating_instance.element.id();const i=(e=this.instance)==null?void 0:(t=e.state("group_data"))==null?void 0:(n=t._id)==null?void 0:n.call(t);return`${r}_group_item_${i!=null?i:"undefined"}_${this.num}`}));const[t,n]=this.id_watcher.get_current();if(t){return n}else{const e=this.repeating_instance.element.id();return`${e}_group_item_null`}}ssr_key(){const e=this.repeating_instance.element.id();return`${e}-cell`}parent(){return this.repeating_instance.element}elements(){return this.repeating_instance.element.elements()}get_height(){return this.height}get_responsive_data(){return this.repeating_instance.element.get_responsive_data()}get_static_property(e,t){if(o.default.CONTAINER_PROPERTIES.includes(e)){return this.repeating_instance.get_static_property(e,t)}else{return super.get_static_property(e,t)}}container_layout(){return this.repeating_instance.element.container_layout()}get_property_applications(){return this.repeating_layout==="Table"?this.repeating_instance.element.get_property_applications():super.get_property_applications()}_fields(e){return this.repeating_layout==="Table"?this.repeating_instance.element._fields(e):super._fields(e)}field_names(){return this.repeating_layout==="Table"?this.repeating_instance.element.field_names():super.field_names()}get_value_id(){return this.repeating_layout==="Table"?this.repeating_instance.element.get_value_id():super.get_value_id()}can_fit_width(){return this.repeating_layout==="Table"?this.repeating_instance.element.can_fit_width():super.can_fit_width()}can_fit_height(){return this.repeating_layout==="Table"?this.repeating_instance.element.can_fit_height():super.can_fit_height()}}},{"../../lang/app_json/runtime_json":632,"../../lang/appquery":651,"../../lang/elements/Element":668,"../../shared/responsive/responsive_layout":804,"../../u/shared/async/autorun":830,"./core_elements_utilities/element_registry":284,"core-js/modules/web.dom-collections.iterator.js":1123}],243:[function(e,t,n){(function(t){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.RepeatingGroupLayoutStyle=void 0;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.immediate.js");const r=e("../../../u");const i=e("../../../lang/elements");const s=e("../../property_applications");const o=e("../../../lib");const a=e("../../../languages");const l=e("../../status_bar");const c=e("../../../logger");const u=e("../../../db/sample");const d=e("../../../lang/btypes");const p=e("../core_elements_utilities/element_utils");const _=e("../../../client/epoch");const f=e("events");const h=e("../../../constants/epoch");const m=e("../shared/repeating_group_utils");const g=e("../shared/repeating_groups");const v=e("../GroupItem");const b=e("../../../shared/responsive/responsive_layout");const y=e("../../../shared/responsive/responsive_css");const w=e("../../../lang/evaluation/element_eval");const x=e("../../../lang/evaluation/element_props");const j=1;const A="#CCCCCC";const M=5e3;const E=h.SPANS.rg_display_data_in_cells;const k=h.SPANS.rg_add_cells;function O(e,t){let n;const i=r.Dependency();if(typeof ResizeObserver!=="undefined"){n=new ResizeObserver((e=>{i.invalidate()}));n.observe(e[0],t)}return{register(){return i.register()},disconnect(){var e;return(e=n)==null?void 0:e.disconnect()}}}class S extends f.EventEmitter{constructor(e,t){super();this.owner_instance=e;this.container_canvas=t;this.children=[]}destroy(){for(const e of this.children){e.destroy()}this.children=[]}resize_width(){}add_to_instances(e){}ready_key(){return this.flow_created}get_canvas(){return this.container_canvas}get_owner(){return this.owner_instance}render(e){const t=$(e);t.addClass("bubble-element");return t}to_canvas(e){}set_height(e,t){e.canvas.css("height",t)}add(e){this.container_canvas.append(e.get_canvas())}create_child(e,t){const n=this.owner_instance.container.create_child(e,t);this.children.push(n);return n}initialize(){}detach(e){}}class D{constructor(e){let{instance:t}=e;this.type="RepeatingGroup";t.repeating_layout_type="RepeatingGroup";this.instance=t;this.mode=this.instance.mode;this.has_written_a_list=false;this.max_index=this.add_cells=null;this.previous_search=null;this.started_adding_cells=false;this.spinner=null;this.list_item=null;this.old_max_index=0;this.last_cell_add_timeout=null;this.first_unused_cell=null;this.finished_loading_switch=r.MakeSwitch(null,"loading_switch");this.extra_fields=[]}instance_children(){return this.instance.children}is_on_window(){var e,t;return((e=window)==null?void 0:(t=e.BrowserDetect)==null?void 0:t.OS)==="Windows"}is_rtl(){return a.is_rtl(o().app_language())}separator_width(){return this.instance.get_static_property("separator_width")}separator_style(){return this.instance.get_static_property("separator_style")}separator_color(){return this.instance.get_static_property("separator_color")}is_fixed_width(){return this.instance.get_static_property("fixed_width")}stable_pagination(){return this.instance.get_static_property("stable_pagination")}group_type(){return this.instance.get_static_property("group_type")}show_all_items(){return this.instance.get_static_property("show_all_items")}auto_fit_row(){return this.instance.get_static_property("auto_fit_row")}auto_fit_column(){return this.instance.get_static_property("auto_fit_column")}scroll_direction(){if(!this.fixed_rows()&&!this.fixed_columns()){return this.instance.get_static_property("scroll_direction")}if(this.fixed_columns()){return"vertical"}else{return"horizontal"}}is_rg_flex(){return this.scroll_direction()==="flex_row"}is_masonry(){return!this.fixed_rows()&&this.scroll_direction()==="vertical"&&!this.instance.get_static_property("auto_fit_row")&&!!this.instance.get_static_property("masonry")}row_cell_gap(){return w.evaluate_property(this.instance,"row_cell_gap")}column_cell_gap(){return w.evaluate_property(this.instance,"column_cell_gap")}fixed_rows(){return this.instance.get_static_property("fixed_rows")}fixed_columns(){return this.instance.get_static_property("fixed_columns")}fixed_list(){return this.fixed_rows()&&this.fixed_columns()}columns(){var e;(e=this._column_watcher)!=null?e:this._column_watcher=r.Watcher((()=>{if(this.fixed_columns()){return w.evaluate_property(this.instance,"columns")}else{this.register_resize();w.evaluate_property(this.instance,"cell_min_width_css");this.instance.get_static_property("scroll_direction");return this.instance.canvas.css("grid-template-columns").split(" ").length}}));return this._column_watcher.get()}rows(){var e;(e=this._row_watcher)!=null?e:this._row_watcher=r.Watcher((()=>{if(this.fixed_rows()){return w.evaluate_property(this.instance,"rows")}else{this.register_resize();w.evaluate_property(this.instance,"cell_min_height_css");this.instance.get_static_property("scroll_direction");return this.instance.canvas.css("grid-template-rows").split(" ").length}}));return this._row_watcher.get()}estimate_one_row(){const e=this.scroll_direction();if(e==="vertical"){return this.columns()}else if(e==="horizontal"){return this.rows()}else{const e=this.instance_children()[0].canvas.width();return this.instance.canvas.width()/e}}data_source(){return w.evaluate_property(this.instance,"data_source")}total_number_of_cells(){return this.rows()*this.columns()}guess_number_of_cells(){if(this.fixed_list()){return this.total_number_of_cells()}const e=e=>{const t=w.evaluate_property(this.instance,`cell_min_${e}_css`);if(this.instance.run_mode()&&t.indexOf("%")!==-1){const e=Math.max(parseInt(t),1);return Math.max(Math.ceil(100/e),1)}else{let n;if(!this.instance.run_mode()){this.register_first_cell_resize();n=this.list_item[e]()}else{const r=this.instance_children()[0];if(!r){n=parseInt(t)}else{const t=[];if(e==="height"&&this.auto_fit_row()||e==="width"&&this.auto_fit_column()){const e=document.createElement("div");for(let n=0;n<50;n++){t.push(e.cloneNode())}this.instance.canvas[0].append(...t)}const i=!r.is_visible();r.do_show();if(e==="height"){n=r.canvas.outerHeight()}else{n=r.canvas.outerWidth()}if(i)r.do_hide();for(const e of t){this.instance.canvas[0].removeChild(e)}}}n=Math.max(n,1);this.register_resize();let r=0;if(e==="height"){if(this.instance.run_mode()&&x.is_fitting_height(this.instance)){r=Math.max(window.innerHeight-this.instance.canvas[0].getBoundingClientRect().top,0)}r=Math.max(r,this.instance.canvas.innerHeight());x.min_height_css(this.instance)}else{if(this.instance.run_mode()&&x.is_fitting_width(this.instance)){r=Math.max(window.innerWidth-this.instance.canvas[0].getBoundingClientRect().left,0)}r=Math.max(r,this.instance.canvas.innerWidth());x.min_width_css(this.instance)}if(this.instance.run_mode()){return Math.max(Math.ceil(r/n),1)}else{let t;if(this.is_rg_flex()){if(e==="width"){t=this.column_cell_gap()}else{t=this.row_cell_gap()}}else{t=this.separator_width()}return Math.max(Math.floor((r+t)/(n+t)),1)}}};if(this.scroll_direction()==="vertical"){let t;if(this.fixed_rows()){t=this.rows()}else{t=e("height")}return this.columns()*t}else if(this.scroll_direction()==="horizontal"){let t;if(this.fixed_columns()){t=this.columns()}else{t=e("width")}return this.rows()*t}else{return e("width")*e("height")}}value_id(){var e;return(e=this.group_type())!=null?e:"user"}floating_group_parents(){return this.instance.element.parents("FloatingGroup")}show_range(){return this.instance.state("show_range")}list_data(){return this.instance.state("list_data")}loading(){return this.instance.state("loading")}set_list_data(e){this.instance.state("list_data",e)}set_show_range(e){this.instance.state("show_range",e)}set_loading(e){this.instance.state("loading",e);if(e){this.finished_loading_switch.turn_off()}else{this.finished_loading_switch.turn_on()}}register_resize(){var e;(e=this._rg_resize_observer)!=null?e:this._rg_resize_observer=O(this.instance.canvas);this._rg_resize_observer.register()}register_first_cell_resize(){var e;(e=this._cell_resize_observer)!=null?e:this._cell_resize_observer=O(this.list_item,{box:"border-box"});this._cell_resize_observer.register()}num_to_row(e){if(this.scroll_direction()==="vertical"){return Math.floor((e-1)/this.columns())+1}else{return(e-1)%this.rows()+1}}num_to_col(e){if(this.scroll_direction()==="vertical"){return(e-1)%this.columns()+1}else{return Math.floor((e-1)/this.rows())+1}}has_top_border(e){if(this.is_rg_flex())return false;return this.num_to_row(e)>1}has_left_border(e){if(this.is_rg_flex())return false;return this.num_to_col(e)>1}cell_width_px(){var e;(e=this._cell_width_watcher)!=null?e:this._cell_width_watcher=r.Watcher((()=>{const e=w.evaluate_property(this.instance,"cell_min_width_css");if(e.indexOf("%")!==-1){if(x.is_fitting_width(this.instance)){return""}const t=Math.max(parseInt(e),1);this.register_resize();const n=Math.floor(this.instance.canvas.width()*t/100);return`${n}px`}else{return e}}));return this._cell_width_watcher.get()}cell_height_px(){var e;(e=this._cell_height_watcher)!=null?e:this._cell_height_watcher=r.Watcher((()=>{const e=w.evaluate_property(this.instance,"cell_min_height_css");if(e.indexOf("%")!==-1){if(x.is_fitting_height(this.instance)){return""}const t=Math.max(parseInt(e),1);this.register_resize();const n=Math.floor(this.instance.canvas.height()*t/100);return`${n}px`}else{return e}}));return this._cell_height_watcher.get()}cell_sizing(e){w.on_property_change(this.instance,"container_layout",(t=>{if(t==="fixed"){e.addClass("fixed")}else{e.removeClass("fixed")}}));this.instance.autorun((()=>{if(this.is_rg_flex()){e.css({"box-sizing":"border-box","min-width":w.evaluate_property(this.instance,"cell_min_width_css"),"min-height":w.evaluate_property(this.instance,"cell_min_height_css"),"flex-grow":this.auto_fit_column()?1:0})}else{e.css({"box-sizing":"content-box","min-width":this.fixed_columns()||this.scroll_direction()!=="horizontal"?"":this.cell_width_px(),"min-height":this.fixed_rows()||this.scroll_direction()!=="vertical"?"":this.cell_height_px()})}}))}observe_masonry_cell(e){var t;const n=e=>{for(const t of e){let e;if(t.borderBoxSize&&t.borderBoxSize.length>0){e=t.borderBoxSize[0].blockSize}else{e=t.target.offsetHeight}const n=`span ${Math.ceil(e)}`;t.target.style.setProperty("grid-row-end",n)}};(t=this._masonry_resize_observer)!=null?t:this._masonry_resize_observer=new ResizeObserver(n);this._masonry_resize_observer.observe(e,{box:"border-box"})}create_cell(e,t){const n=new v(this.instance,0,e);const s=i.ElementInstance(n,this.instance.mode);s.state("group_data",i.STATE_NOT_READY);s.drawn_key=r.MakeKey(null,"cell_drawn");n.instance=s;this.instance_children().push(s);s.state("cell_index",e);s._is_visible_me=false;s.register(this.instance);s.create_skeleton(this.container);s.start_draw_tree();this.cell_sizing(s.canvas);this.add_sep(e,s.canvas);s.do_hide();s.drawn_key.turn();if(this.instance.run_mode()&&this.is_masonry()){this.observe_masonry_cell(s.canvas[0])}}add_spinner(){if(!this.instance.is_visible()){var e;(e=this.spinner)==null?void 0:e.call(this);return}if(!this.spinner){this.spinner=l.spinner(this.instance)}}remove_spinner(){var e;(e=this.spinner)==null?void 0:e.call(this);this.spinner=null}init_raw_list_watcher(e,t){var n;(n=this._raw_list_data_watcher)==null?void 0:n.destroy();this._raw_list_data_watcher=r.Watcher((()=>{var n,r,i,s,o;const a=e();const l=t();return(n=(r=this.list_data())==null?void 0:(i=r.with_extra_fields)==null?void 0:(s=(o=i.call(r,this.extra_fields)).get_children)==null?void 0:s.call(o,a,l))!=null?n:[]}));this._raw_list_data_watcher.on_value((()=>{this.set_loading(true)}))}raw_list_data(){var e;return(e=this._raw_list_data_watcher)==null?void 0:e.get()}send_data_to_children(){this.add_spinner();let e=this.raw_list_data();this.remove_spinner();if(this.mode!=="responsive"){e=e.filter((e=>e!=null))}for(let t=0;t<e.length;t++){const n=e[t];if(this.instance_children()[t]==null){r.autorun_top((()=>{this.create_cell(t+1,this.instance.canvas)}))}const i=this.instance_children()[t];r.WaitFor(r.page_loaded_key,(()=>i.can_register_workflows().turn()));i.message("set_group_data",n);i.do_show()}this.first_unused_cell=e.length;this.instance.last_cell=e.length;return e.length}hide_unused_cells(){this.instance.autorun((()=>{const e=this.instance_children();for(let n=this.first_unused_cell;n<e.length;n++){var t;(t=e[n])==null?void 0:t.do_hide()}}))}end_of_list(){if(this.list_data()!=null&&this.fixed_list()&&this.columns()===1&&this.rows()===1){var e;if(this.show_range()===((e=this.list_data())==null?void 0:e.length())&&this.list_data().length()>1){this.set_show_range(this.list_data().length()-1)}}}display_data_in_cells(e){_.traceSpan(E.name,E.type,(()=>{this.instance.autorun((()=>{if(!this.instance.is_visible()){return}this.set_loading(true);let t,n;if(!r.is_on_mobile_or_tablet()){t=$("html");n=t[0].scrollTop}const i=this.send_data_to_children();if(!r.is_on_mobile_or_tablet()){t.scrollTop(n)}this.hide_unused_cells();this.end_of_list();if(this.has_written_a_list){r.wait_for_updates((()=>{this.instance.mark_children_registered();this.instance.get_children_drawn_key().turn()}))}r.wait_for_updates((()=>{const[t,n]=this._raw_list_data_watcher.get_current_status_array();this.set_loading(!n||t!=null);if(e){this.watch_lazy_loader(i-1)}}))}))}))}show_border_outline(){return this.mode==="edit"&&this.instance.state("show_borders")&&(this.separator_width()===0||this.separator_style()==="none")}get_separator_width(){if(this.show_border_outline()){return j}else{return g._get_separator_width(this.instance.element)}}add_sep(e,t){this.instance.autorun((()=>{t.css({"border-top-style":"none","margin-top":""});if(this.has_top_border(e)){if(this.is_masonry()){if(this.instance.run_mode()){t.css({"padding-top":`${this.row_cell_gap()}px`})}}else{t.css({"border-top-width":this.get_separator_width()+"px","border-top-color":this.show_border_outline()?A:this.separator_color(),"border-top-style":this.show_border_outline()?"solid":this.separator_style(),"margin-top":-this.get_separator_width()+"px"})}}}));this.instance.autorun((()=>{if(!this.is_masonry()&&this.has_left_border(e)){let e;if(this.is_rtl()){e={"border-right":this.get_separator_width()+"px","border-right-color":this.show_border_outline()?A:this.separator_color(),"border-right-style":this.show_border_outline()?"solid":this.separator_style(),"margin-right":-this.get_separator_width()+"px"}}else{e={"border-left":this.get_separator_width()+"px","border-left-color":this.show_border_outline()?A:this.separator_color(),"border-left-style":this.show_border_outline()?"solid":this.separator_style(),"margin-left":-this.get_separator_width()+"px"}}s.apply_css_style(t,e)}else{if(this.is_rtl()){t.css({"border-right-style":"none","margin-right":""})}else{t.css({"border-left-style":"none","margin-left":""})}}}))}get_edit_mode_dummies(){const e=this.instance.get_canvas();return $("> .list-dummy",e)}setup_grid_css(){const e=this.instance.get_canvas();this.instance.autorun((()=>{e.removeClass("bubble-rg bubble-rg-flex-row");if(this.is_rg_flex()){e.addClass("bubble-rg-flex-row");this.instance.autorun((()=>{e.css({"row-gap":`${this.row_cell_gap()}px`,"column-gap":`${this.column_cell_gap()}px`,"align-content":this.auto_fit_row()?"stretch":"flex-start"})}))}else{e.addClass("bubble-rg");this.instance.autorun((()=>{e.toggleClass("masonry",this.is_masonry());if(this.is_masonry()){e.css({"column-gap":`${this.column_cell_gap()}px`,"row-gap":this.instance.run_mode()?"":`${this.row_cell_gap()}px`})}else{e.css({gap:this.get_separator_width()})}const t=this.auto_fit_row()?"auto-fit":"auto-fill";const n=this.auto_fit_column()?"auto-fit":"auto-fill";if(this.fixed_rows()){if(x.is_fitting_height(this.instance)){e.css({"grid-template-rows":`repeat(${this.rows()}, minmax(max-content, auto))`,"grid-auto-rows":""})}else{e.css({"grid-template-rows":`repeat(${this.rows()}, minmax(0, 1fr))`,"grid-auto-rows":""})}}else{if(this.scroll_direction()==="vertical"){if(this.auto_fit_row()){e.css({"grid-template-rows":"","grid-auto-rows":"minmax(max-content, 1fr)"})}else{e.css({"grid-template-rows":"","grid-auto-rows":this.is_masonry()&&this.instance.run_mode()?"1px":`minmax(max-content, ${w.evaluate_property(this.instance,"cell_min_height_css")})`})}}else{e.css({"grid-template-rows":`repeat(${t}, minmax(${w.evaluate_property(this.instance,"cell_min_height_css")}, 1fr))`,"grid-auto-rows":""})}}if(this.fixed_columns()){if(x.is_fitting_width(this.instance)){e.css({"grid-template-columns":`repeat(${this.columns()}, max-content)`,"grid-auto-columns":""})}else{e.css({"grid-template-columns":`repeat(${this.columns()}, minmax(0, 1fr))`,"grid-auto-columns":""})}}else{if(this.scroll_direction()==="horizontal"){if(this.auto_fit_column()){e.css({"grid-template-columns":"","grid-auto-columns":"minmax(max-content, 1fr)"})}else{e.css({"grid-template-columns":"","grid-auto-columns":`minmax(max-content, ${w.evaluate_property(this.instance,"cell_min_width_css")})`})}}else{e.css({"grid-template-columns":`repeat(${n}, minmax(${w.evaluate_property(this.instance,"cell_min_width_css")}, 1fr))`,"grid-auto-columns":""})}}e.css({"grid-auto-flow":this.scroll_direction()==="vertical"?"row":"column"})}))}}))}create_provisional_cell(){this.instance.autorun((()=>{const e=this.instance.get_canvas();if(this.mode!=="run"){if(e.find(".list-item").length===0){this.list_item=r.div("list-item",e)}else{this.list_item=e.find(".list-item")}}}))}setup_scrolling(){const e=this.instance.get_canvas();e.css({overflow:"auto","overflow-scrolling":"touch","-webkit-overflow-scrolling":"touch"})}add_cells_cb(e,t){var n;(n=e)!=null?n:e=1;this.started_adding_cells=true;r.run_once(30,(()=>{var t,n,r;return(t=(n=this.list_data())==null?void 0:(r=n.with_extra_fields)==null?void 0:r.call(n,this.extra_fields).get_children(this.max_index(),e))!=null?t:[]}),((n,i)=>{if(n){c.log(n);this.started_adding_cells=false;return}if(i.length){const t=Math.min(i.length,e);const n=this.estimate_one_row();this.add_cells(this.max_index()+t+n);this.max_index(this.max_index()+t+n-1);r.wait_for_updates((()=>{this.started_adding_cells=false}))}else{this.started_adding_cells=false;t==null?void 0:t()}}))}full_display_add_cells(){this.max_index=r.Box(null,true);this.init_raw_list_watcher((()=>0),(()=>this.max_index()));this.display_data_in_cells();this.instance.autorun((()=>{var e,t;const n=Math.min((e=(t=this.list_data())==null?void 0:t.length())!=null?e:0,M);if(n>100){c.owner_warn(new r.OwnerError("repeating group showing more than 100 items",{display:"This repeating group is showing more than 100 items, which can considerably slow down your page. You should consider not showing all items at once",element_instance:this.instance}))}r.autorun_top((()=>{this.add_cells(n);this.max_index(n)}))}))}page_style_add_cells(){const e=this.total_number_of_cells();for(let t=1;t<=e;t++){this.create_cell(t,this.instance.canvas)}this.init_raw_list_watcher((()=>this.show_range()),(()=>this.total_number_of_cells()));this.display_data_in_cells()}load_more_cells(e){let t,n;if(this.scroll_direction()!=="horizontal"){t=this.estimate_one_row();let r;if(e){r=window.innerHeight*3-this.instance.canvas[0].getBoundingClientRect().bottom}else{r=this.instance.canvas[0].clientHeight*3-(this.instance.canvas[0].scrollHeight-this.instance.canvas[0].scrollTop)}const i=this.instance_children()[0].canvas.height();n=Math.ceil(Math.max(r/i,1))+2}else{n=this.rows();let r;if(e){r=window.innerWidth*2-this.instance.canvas[0].getBoundingClientRect().right}else{r=this.instance.canvas[0].clientWidth*3-(this.instance.canvas[0].scrollWidth-this.instance.canvas[0].scrollLeft)}const i=this.instance_children()[0].canvas.width();t=Math.ceil(Math.max(r/i,1))+2}this.add_cells_cb(n*t)}watch_lazy_loader(e){var t,n,r;(t=this._root_intersection_observer)==null?void 0:t.disconnect();(n=this._canvas_intersection_observer)==null?void 0:n.disconnect();let i;if(this.scroll_direction()!=="horizontal"){i=this.instance.canvas[0].scrollHeight>this.instance.canvas[0].clientHeight&&this.instance.canvas[0].clientHeight<window.innerHeight}else{i=this.instance.canvas[0].scrollWidth>this.instance.canvas[0].clientWidth&&this.instance.canvas[0].clientWidth<window.innerWidth}let s;if(i){var o;s=(o=this._canvas_intersection_observer)!=null?o:this._canvas_intersection_observer=new IntersectionObserver((e=>{if(!this.started_adding_cells&&e[0].isIntersecting){this.load_more_cells()}}),{root:this.instance.canvas[0],rootMargin:"100%"})}else{var a;s=(a=this._root_intersection_observer)!=null?a:this._root_intersection_observer=new IntersectionObserver((e=>{if(!this.started_adding_cells&&e[0].isIntersecting){this.load_more_cells(true)}}),{rootMargin:"100%"})}const l=(r=this.instance_children()[e])==null?void 0:r.canvas;if(l!=null){s.observe(l[0])}}populate_data(){r.autorun_once((()=>{this.setup_scrolling();if(this.fixed_list()){this.page_style_add_cells()}else if(this.show_all_items()){this.full_display_add_cells()}else{this.started_adding_cells=false;this.add_cells(1);this.max_index=r.Box(Math.min(this.guess_number_of_cells(),100));this.add_cells(this.max_index()+1);this.init_raw_list_watcher((()=>0),(()=>this.max_index()+1));this.display_data_in_cells(true)}}))}copy_html(e){if(this.copy_scheduled)return;this.copy_scheduled=true;const t=()=>{if(["edit","thumbnail"].includes(this.mode)){const e=this.get_edit_mode_dummies();const t=this.list_item.clone();t.find(".resize-handle").remove();t.find(".visual-indicator-wrapper").remove();t.find(".r-margin-show, .r-margin-side").remove();t.find(".element").css({"-webkit-box-shadow":"none","box-shadow":"none","-moz-box-shadow":"none"});t.find(".element").removeClass("element").addClass("dummy-element");t.find(".container").removeClass("container");e.html(t.html())}this.copy_scheduled=false};if(e){r.wait_for_updates((()=>{this.instance.setTimeout((()=>{t()}),100)}))}else{t()}}create_dummy_list(){var e;const t=this.instance.get_canvas();this.cell_sizing(this.list_item);this.add_sep(1,this.list_item);t.find("> .list-dummy").remove();(e=this._item_watcher)!=null?e:this._item_watcher=r.Watcher((()=>{const e=t.find("> .list-dummy");e.detach();t.addClass("bubble-rg-edit-guess");const n=Math.min(this.guess_number_of_cells(),100);t.removeClass("bubble-rg-edit-guess");t.append(e);return n}));const n=this._item_watcher.get();for(let e=2;e<=n;e++){const n=r.div("list-dummy",t);this.cell_sizing(n);this.add_sep(e,n)}this.copy_html()}redraw_dummy_list(){for(const n of this.instance.element.elements()){var e,t;n.json.register_dependency();(e=n.get_style())==null?void 0:(t=e.json)==null?void 0:t.register_dependency();o().visual_edit.turned_on(n.id())}this.copy_html(true);const n=this.instance.element.container_layout();const{container_properties:r}=b.LAYOUT_PROPERTIES[n];const i={};for(const e in r){const t=r[e];i[t]=w.evaluate_property(this.instance,e)}this.get_edit_mode_dummies().css(y.container_properties(i))}thumbnail_and_edit_mode_logic(){var e,t,n;if(this.mode==="thumbnail"&&!((e=o().styles_editor)!=null&&(t=e.element_styles_editor())!=null&&(n=t.owner)!=null&&n.is_active())){r.run_once(60,(()=>{this.instance.start_child_drawing()}))}this.instance.setTimeout((()=>{this.instance.autorun((()=>{this.create_dummy_list()}));this.instance.autorun((()=>{this.redraw_dummy_list()}))}),100)}do_scroll(e,t){const n=this.instance_children()[e];if(this.scroll_direction()==="horizontal"){let e=this.instance.get_canvas();while(e.length&&(e[0].scrollWidth<=e[0].clientWidth||["hidden","visible"].includes(e.css("overflow-x")))){e=e.parent();if(e.is("body")){break}}let r;if(e.length===0||e.is("body")){e=$("html");r=n.get_canvas().offset().left+t.offset}else{r=n.get_canvas().offset().left-e.offset().left+e[0].scrollLeft+t.offset}if(t.animate){e.animate({scrollLeft:r},300)}else{e.scrollLeft(r)}}else{let e=this.instance.get_canvas();while(e.length&&(e[0].scrollHeight<=e[0].clientHeight||["hidden","visible"].includes(e.css("overflow-y")))){e=e.parent();if(e.is("body")){break}}let r;if(e.length===0||e.is("body")){e=$("html");r=n.get_canvas().offset().top+t.offset}else{r=n.get_canvas().offset().top-e.offset().top+e[0].scrollTop+t.offset}if(t.animate){e.animate({scrollTop:r},300)}else{e.scrollTop(r)}}}setup_messages(){this.set_list_data(i.STATE_NOT_READY);const e=new Map;this.instance.autorun((()=>{if(!this.instance.state("datasource_changed_by_workflow_action")){g.check_astable_loop(this.instance,this.data_source(),e);this.write_data(this.data_source())}}));this.instance.on_message("set_list_data",(e=>{this.instance.state("datasource_changed_by_workflow_action",true);this.write_data(e)}));this.instance.on_message("clear_list",(()=>{this.instance.state("datasource_changed_by_workflow_action",false);if(this.fixed_list()){this.set_show_range(0)}else{var e,t;(e=this.instance.get_canvas())==null?void 0:e.scrollLeft(0);(t=this.instance.get_canvas())==null?void 0:t.scrollTop(0)}for(const e of(n=this.instance_children())!=null?n:[]){var n;p.reset_inputs_and_groups(e)}}));this.instance.on_message("show_next",(e=>{var t;(t=e)!=null?t:e=false;r.run_once(30,(()=>{var e;return(e=this.list_data())==null?void 0:e.length()}),((t,n)=>{if(t){c.log(t);return}let r=this.show_range();r+=this.total_number_of_cells();if(this.stable_pagination()){const t=r>=n;if(t&&e){r=0}else if(t){return}}else{const t=r===n;const i=r+this.total_number_of_cells()>n;if(t&&e){r=0}else if(i){r=Math.max(n-this.total_number_of_cells(),0)}}this.set_show_range(r)}))}));this.instance.on_message("show_previous",(e=>{var t;(t=e)!=null?t:e=false;r.run_once(30,(()=>{var e;return(e=this.list_data())==null?void 0:e.length()}),((t,n)=>{if(t){c.log(t);return}let r=this.show_range();if(r===0&&e){if(this.stable_pagination()){r=Math.max(n-this.total_number_of_cells()+n%this.total_number_of_cells(),0)}else{r=Math.max(n-this.total_number_of_cells(),0)}}else{r=Math.max(r-this.total_number_of_cells(),0)}this.set_show_range(r)}))}));this.instance.on_message("go_to_page",(e=>{r.run_once(30,(()=>{var e;return(e=this.list_data())==null?void 0:e.length()}),((t,n)=>{if(t){c.log(t);return}let r=(e-1)*this.total_number_of_cells();if(r+this.total_number_of_cells()>n&&!this.stable_pagination()){r=Math.max(0,n-this.total_number_of_cells())}this.set_show_range(r)}))}));this.instance.on_message("scroll_to",(e=>{if(this.fixed_list()){return}r.WaitFor(this.instance.get_children_drawn_key(),(()=>{r.run_once(30,(()=>{var t;if(this.list_data()==null&&!this.loading()){return-1}return(t=this.list_data())==null?void 0:t.position(e.entry,d.get(this.group_type()))}),((t,n)=>{var i,s;if(t){c.log(t);return}if(n===-1){return}if(!((i=this.instance_children())!=null&&(s=i[n])!=null&&s.is_visible())){r.wait_for_updates((()=>{this.instance.message("draw_till",n);const t=()=>{this.instance.setTimeout((()=>{var r,i,s;if((r=this.instance_children())!=null&&(i=r[n])!=null&&i.is_visible()&&(s=this.instance_children())!=null&&s[n].canvas.is(":visible")){this.do_scroll(n,e)}else{t()}}),50)};t()}))}else{this.do_scroll(n,e)}}))}))}))}populate_sample_list(){t((()=>{this.write_data(o().db_instance().static_list(this.value_id(),[new u.SampleObject(this.value_id())]))}))}write_data(e){if(e!==undefined){this.has_written_a_list=true}let t;if(e&&e.dehydrate){t=e.dehydrate()}else{t="no data";e=null}if(t!==this.previous_search){this.previous_search=t;this.set_list_data(e);this.set_show_range(0)}}reset_class_data(){const e=this.instance.get_canvas();this.instance.children=[];this.add_cells=t=>{_.traceSpan(k.name,k.type,(()=>{for(let n=this.old_max_index+1;n<=t;n++){this.create_cell(n,e)}if(this.old_max_index<t){this.old_max_index=t;this.instance.last_cell=this.old_max_index}}))}}do_register(){if(this.mode==="run"){this.setup_messages()}}do_create_container(){this.container=new S(this.instance,this.instance.canvas)}compute_extra_fields(){this.extra_fields=m.evaluate_extra_fields(this.instance.element)}do_initialize(){this.instance.on_message("draw_till",(e=>{if(this.scroll_style==="none"||!this.max_index){return}if(this.max_index()>e){return}this.add_cells(e+1);this.max_index(e)}));this.reset_class_data();this.setup_grid_css();this.create_provisional_cell();this.instance.wait_for_visible_lite((()=>{if(this.instance.run_mode()){this.compute_extra_fields()}if(["run","responsive"].includes(this.mode)){this.populate_data()}else{this.thumbnail_and_edit_mode_logic()}}))}destroy(){var e,t,n,r,i,s,o,a,l,c,u;(e=this._root_intersection_observer)==null?void 0:e.disconnect();(t=this._canvas_intersection_observer)==null?void 0:t.disconnect();(n=this._rg_resize_observer)==null?void 0:n.disconnect();(r=this._cell_resize_observer)==null?void 0:r.disconnect();(i=this._masonry_resize_observer)==null?void 0:i.disconnect();(s=this._row_watcher)==null?void 0:s.destroy();(o=this._column_watcher)==null?void 0:o.destroy();(a=this._cell_width_watcher)==null?void 0:a.destroy();(l=this._cell_height_watcher)==null?void 0:l.destroy();(c=this._item_watcher)==null?void 0:c.destroy();(u=this.container)==null?void 0:u.destroy()}}n.RepeatingGroupLayoutStyle=D}).call(this)}).call(this,e("timers").setImmediate)},{"../../../client/epoch":25,"../../../constants/epoch":63,"../../../db/sample":461,"../../../lang/btypes":653,"../../../lang/elements":680,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../languages":739,"../../../lib":741,"../../../logger":744,"../../../shared/responsive/responsive_css":803,"../../../shared/responsive/responsive_layout":804,"../../../u":823,"../../property_applications":412,"../../status_bar":415,"../GroupItem":242,"../core_elements_utilities/element_utils":286,"../shared/repeating_group_utils":370,"../shared/repeating_groups":371,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,events:978,timers:2334}],244:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.TableLayout=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../../u/shared/async/autorun");var i=d(e("../../../lang/evaluation/element_eval"));var s=c(e("../../../lang/elements"));var o=d(e("../../../lang/evaluation/element_props"));var a=c(e("../../status_bar"));var l=e("../../../u");function c(e){return e&&e.__esModule?e:{default:e}}function u(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=u(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}class p{constructor(e){this.instance=void 0;this._raw_list_data_watcher=void 0;this.extra_fields=void 0;this.previous_search=void 0;this.type=void 0;this.spinner=void 0;this.finished_loading_switch=void 0;this.type="Table";this.instance=e;e.repeating_layout_type="Table";this.finished_loading_switch=(0,l.MakeSwitch)(undefined,"loading_switch");this.extra_fields=[];this.spinner=null;this.setup_messages()}add_spinner(){if(!this.instance.is_visible()){var e;(e=this.spinner)==null?void 0:e.call(this);return}if(!this.spinner){this.spinner=a.default.spinner(this.instance)}}remove_spinner(){var e;(e=this.spinner)==null?void 0:e.call(this);this.spinner=null}estimate_one_row(){return 1}compute_extra_fields(){this.extra_fields=[]}set_loading(e){this.instance.state("loading",e);if(e){this.finished_loading_switch.turn_off()}else{this.finished_loading_switch.turn_on()}}columns(){return 1}table_direction(){return this.instance.get_static_property("table_direction")}guess_number_of_cells(e){const t=t=>{var n;let r;if(t==="height"){var s,a;r=(s=(a=this.instance.canvas)==null?void 0:a.innerHeight())!=null?s:0}else{var l,c;r=(l=(c=this.instance.canvas)==null?void 0:c.innerWidth())!=null?l:0}let u=0;for(const n of this.instance.children){if(n.element.type()==="TableCrossAxis"&&n!==e&&n.is_visible_me()){if(n.get_static_property(`single_${t}`)||!n.get_static_property(`fit_${t}`)){var d;const e=(d=i.evaluate_property(n,`min_${t}_css`))!=null?d:"0px";if(e.includes("%")){const t=parseInt(e);u+=t/100*r}else{u+=parseInt(e)}}else{var p,_;u+=(p=(_=n.canvas)==null?void 0:_.outerHeight())!=null?p:0}}}const f=this.instance.edit_mode()?e:e.children[0];const h=(n=i.evaluate_property(e,`min_${t}_css`))!=null?n:"100%";if(this.instance.run_mode()&&h.includes("%")){const e=Math.max(parseInt(h),1);return Math.max(Math.ceil(100-u/r*100/e),1)}else{var m;let n;if(e.get_static_property(`single_${t}`)){n=parseInt(h)}else{if(f==null||!e.get_static_property(`fit_${t}`)){n=parseInt(h)}else{const e=!f.is_visible();f.do_show();if(t==="height"){var g;n=(g=f.canvas)==null?void 0:g.outerHeight()}else{var v;n=(v=f.canvas)==null?void 0:v.outerWidth()}if(e)f.do_hide()}}n=Math.max((m=n)!=null?m:1,1);let s=0;if(t==="height"){if(this.instance.run_mode()&&o.is_fitting_height(this.instance)){var b,y;s=Math.max(window.innerHeight-((b=(y=e.canvas)==null?void 0:y[0].getBoundingClientRect().top)!=null?b:0),0)}o.min_height_css(this.instance)}else{if(this.instance.run_mode()&&o.is_fitting_width(this.instance)){var w,x;s=Math.max(window.innerWidth-((w=(x=e.canvas)==null?void 0:x[0].getBoundingClientRect().left)!=null?w:0),0)}o.min_width_css(this.instance)}s=Math.max(s,r-u);if(this.instance.run_mode()){return Math.max(Math.ceil(s/n),1)}else{var j;const e=t==="height"?"horizontal_separator":"vertical_separator";const r=i.evaluate_property(this.instance,`${e}_style`)==="none"?0:(j=i.evaluate_property(this.instance,`${e}_width`))!=null?j:0;return Math.max(Math.floor((s+r)/(n+r)),1)}}};if(this.table_direction()==="vertical"){return t("height")}return t("width")}data_source(){return i.evaluate_property(this.instance,"data_source")}set_list_data(e){this.instance.state("list_data",e)}set_show_range(e){this.instance.state("show_range",e)}write_data(e){var t;if(e!==undefined){}let n;if((t=e)!=null&&t.dehydrate){n=e.dehydrate()}else{n="no data";e=null}if(n!==this.previous_search){this.previous_search=n;this.set_list_data(e);this.set_show_range(0)}}setup_messages(){this.set_list_data(s.default.STATE_NOT_READY);this.instance.autorun((()=>{if(!this.instance.state("datasource_changed_by_workflow_action")){this.write_data(this.data_source())}}));this.instance.on_message("set_list_data",(e=>{this.instance.state("datasource_changed_by_workflow_action",true);this.write_data(e)}))}list_data(){return this.instance.state("list_data")}init_raw_list_watcher(e,t){var n;(n=this._raw_list_data_watcher)==null?void 0:n.destroy();this._raw_list_data_watcher=(0,r.Watcher)((()=>{var n,r,i,s,o;const a=e();const l=t();return(n=(r=this.instance.state("list_data"))==null?void 0:(i=r.with_extra_fields)==null?void 0:(s=(o=i.call(r,this.extra_fields)).get_children)==null?void 0:s.call(o,a,l))!=null?n:[]}));this._raw_list_data_watcher.on_value((()=>{this.set_loading(true)}));return this._raw_list_data_watcher}raw_list_data(){var e;return(e=this._raw_list_data_watcher)==null?void 0:e.get()}}n.TableLayout=p},{"../../../lang/elements":680,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../u":823,"../../../u/shared/async/autorun":830,"../../status_bar":415,"core-js/modules/web.dom-collections.iterator.js":1123}],245:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");const i=(0,r.template)(`<div></div>`,2);const s=e("../../../u/client/b_ui");const o=e("../../../u/shared/mode_check");const{onMount:a,createSignal:l}=e("solid-js");const{createElement:c}=e("./utils/createElement");const u=e("./utils/element_styles");const{defaultEventHandlers:d}=e("./utils/directives");const{Style:p,Property:_}=e("./utils/properties");const f=e("../../../lang/evaluation/element_eval");const h=e("../../../lang/evaluation/element_props");function m(e){const t=e.instance;const[n,c]=l(null);a((()=>{if(t.run_mode()){t.canvas.css("display","none");let e=0;t.on_message("do_show_alert",(function(n){var r;const i=++e;c(n.message);t._display_me();t._is_visible_me=true;t._update_visible();const a=t.canvas;a.css({display:"",opacity:(r=n.fin_starting_opacity)!=null?r:0});if(o.running_test())return;s.velocity(a,{opacity:1},{duration:n.fade_in,complete_cb:()=>{t.setTimeout((()=>{var r;a.css("opacity",(r=n.fout_starting_opacity)!=null?r:1);s.velocity(a,{opacity:0},{duration:n.fade_out,complete_cb:()=>{a.css("display","none");t._hide_me();t._is_visible_me=false;t._update_visible();if(i===e){c(null)}},display:""})}),n.hold)}})}));t.manual_position=false;t.on_message("position_element",(e=>{t.manual_position=true;t.state("manual_position",{top:`${e.Y}px`,left:`${e.X}px`,position:e.position})}))}}));const u=()=>{var t;const r=s.bbcode_to_html((t=n())!=null?t:e.text);if(e.verticalCenter){return`<div>${r}</div>`}else{return r}};return(()=>{const t=i.cloneNode(true);(0,r.use)(d,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.effect)((n=>{const i=e.id,s=e.style,o={...e.classList,"bubble-r-vertical-center":e.verticalCenter},a=u();i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);a!==n._v$4&&(t.innerHTML=n._v$4=a);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined});return t})()}t.exports=c(m,(e=>({attachToTop:e.get_static_property("at_to_top")})),((e,t)=>{let{attachToTop:n}=t;return{properties:{text:new _((e=>f.evaluate_property(e,"text"))),verticalCenter:new _((e=>f.evaluate_property(e,"vertical_centering")))},styles:n?[new p((t=>{const n={position:t.run_mode()?"fixed":"absolute","margin-left":"auto","margin-right":"auto","margin-top":"","margin-bottom":"","min-width":h.min_width_css(t),"min-height":h.min_height_css(t),"max-height":h.max_height_css(t),"z-index":2e4};for(const e of["left","right","top","bottom"]){n[e]=f.evaluate_property(t,`margin_${e}`)}const r=h.max_width_css(t);if(e.fit_width()){n.width="auto";const e=`calc(100% - ${n.left+n.right}px)`;if(r!=null){n["max-width"]=[`min(${r}, ${e})`,r]}else{n["max-width"]=e}}else{n.width="initial";n["max-width"]=r}if(e.fit_height()){n.bottom="unset";n.height="auto"}else{n.height="initial"}return n}),{outerPositioning:true}),new p((e=>{var t;return(t=e.state("manual_position"))!=null?t:{}}),{alwaysDynamic:true}),...u.basicStyling(e)]:u.placedStyling(e)}}))},{"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../u/client/b_ui":813,"../../../u/shared/mode_check":851,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],246:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=c(e("./utils/createElement"));var s=e("./utils/element_styles");var o=e("./utils/directives");var a=e("./utils/properties");var l=e("../../../lang/evaluation/element_eval");function c(e){return e&&e.__esModule?e:{default:e}}const u=(0,r.template)(`<button> </button>`,2);t.exports=(0,i.default)(d,undefined,(e=>({properties:{text:new a.Property((e=>(0,l.evaluate_property)(e,"text")),{fallback:""})},styles:[new a.Style((e=>{if((0,l.evaluate_property)(e,"background_style")==="none"){return{"-webkit=touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","user-select":"none"}}else{return{}}})),...(0,s.placedStyling)(e)]})));function d(e){return(()=>{const t=u.cloneNode(true),n=t.firstChild;(0,r.use)(o.defaultEventHandlers,t,(()=>e.instance));const i=e.ref;typeof i==="function"?(0,r.use)(i,t):e.ref=t;(0,r.effect)((i=>{const s=e.id,o=e.style,a=e.classList,l=e.text;s!==i._v$&&(0,r.setAttribute)(t,"id",i._v$=s);i._v$2=(0,r.style)(t,o,i._v$2);i._v$3=(0,r.classList)(t,a,i._v$3);l!==i._v$4&&(n.data=i._v$4=l);return i}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined});return t})()}},{"../../../lang/evaluation/element_eval":690,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js/web":2315}],247:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");const i=(0,r.template)(`<div><input type="checkbox"><label></label></div>`,5);const s=e("../../../u/shared/uuid");const o=e("../../../constants/runmode");const{createElement:a}=e("./utils/createElement");const l=e("./utils/element_styles");const{defaultEventHandlers:c}=e("./utils/directives");const{Property:u}=e("./utils/properties");const{onMount:d}=e("solid-js");const p=e("./utils/input_utils");const _=e("../../../lang/evaluation/element_eval");const f=" input";t.exports=a(h,null,(e=>({properties:{isDisabled:new u((e=>_.evaluate_property(e,"disabled"))),label:new u((e=>_.evaluate_property(e,"label")))},styles:[...l.placedStyling(e)]})));function h(e){const t=e.instance.run_mode();const n=String(s.LUID());let a;d((()=>{if(t){$(a).change((t=>{var n;e.instance.message("user_submit",(n=t.target.checked)!=null?n:false)}))}}));p.createInputChange(e.instance,(e=>{if(typeof e==="string"&&["false","no","null","none","undefined"].includes(e.toLowerCase()))e=false;a.checked=Boolean(e)}));return(()=>{const s=i.cloneNode(true),l=s.firstChild,u=l.nextSibling;(0,r.use)(c,s,(()=>e.instance));const d=e.ref;typeof d==="function"?(0,r.use)(d,s):e.ref=s;const p=a;typeof p==="function"?(0,r.use)(p,l):a=l;(0,r.setAttribute)(l,"id",n);(0,r.setAttribute)(u,"for",n);(0,r.insert)(u,(()=>e.label));(0,r.effect)((n=>{const i=e.id,a=e.style,c={...e.classList,[o.CLICKABLE_ELEMENT]:t},u={...e.childStyles[f],"background-color":"white"},d=t&&e.isDisabled;i!==n._v$&&(0,r.setAttribute)(s,"id",n._v$=i);n._v$2=(0,r.style)(s,a,n._v$2);n._v$3=(0,r.classList)(s,c,n._v$3);n._v$4=(0,r.style)(l,u,n._v$4);d!==n._v$5&&(l.disabled=n._v$5=d);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined,_v$5:undefined});return s})()}},{"../../../constants/runmode":83,"../../../lang/evaluation/element_eval":690,"../../../u/shared/uuid":855,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/input_utils":276,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],248:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=e("solid-js");var s=e("../../../constants/server_rendering");var o=w(e("../../../lib"));var a=e("./utils/container_utils");var l=e("./utils/createElement");var c=y(e("./utils/element_styles"));var u=e("./utils/directives");var d=e("./utils/properties");var p=e("../../../renderer/solid_utils/autorun_signals");var _=e("../../../lang/font_tokens");var f=e("../../../lang/evaluation/element_eval");var h=e("../../../u/shared/async/autorun");var m=w(e("../../../lang/appquery"));var g=y(e("../../../logger"));var v=e("../../../u/shared/errors");function b(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(b=function(e){return e?n:t})(e)}function y(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=b(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function w(e){return e&&e.__esModule?e:{default:e}}const x=(0,r.template)(`<div></div>`,2);function j(e){const t=e.instance;if(t.edit_mode()){(0,p.createAutorun)((()=>{(0,_.load_font_tokens_default)();(0,_.load_font_tokens_user)()}));if(t.get_static_property("element_type")==="Popup"){(0,f.on_property_change)(t,["width","height"],(e=>{let{width:n,height:r}=e;void(0,h.run_once)(30,(()=>{const e=t.element_id();m.default.find_elements("CustomElement").forEach((t=>{if(t.get_static_property("custom_id")===e&&t.root()!=null){t.set_property("width",n);t.set_property("height",r)}}))}),(e=>{if(e){g.log((0,v.ensure_bubble_error)(e));return}m.default.commit_merge()}))}))}}(0,i.createEffect)((t=>{const n=e.childStyles[s.AT_ROOT];(0,r.style)(document.documentElement,n,t);return n}));return(()=>{const n=x.cloneNode(true);(0,r.use)(u.defaultEventHandlers,n,(()=>e.instance));const i=e.ref;typeof i==="function"?(0,r.use)(i,n):e.ref=n;(0,r.insert)(n,(0,r.createComponent)(a.ChildWrapper,(0,r.mergeProps)(e,{get children(){return e.children}})));(0,r.effect)((i=>{const s=e.id,o=e.style,a={...e.classList,[e.containerClass]:true,"page-element":t.edit_mode()};s!==i._v$&&(0,r.setAttribute)(n,"id",i._v$=s);i._v$2=(0,r.style)(n,o,i._v$2);i._v$3=(0,r.classList)(n,a,i._v$3);return i}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return n})()}t.exports=(0,l.createElement)(j,(e=>({shouldAddWrapper:e.should_add_extra_wrapper()})),((e,t)=>{let{shouldAddWrapper:n}=t;return{properties:(0,a.containerProperties)(n),styles:[new d.Style((t=>{const n=e.root_max_width();const r=e.root_max_height();const i={"min-width":`${e.root_min_width()}px`,"max-width":n!=null?`${n}px`:"","min-height":`${e.root_min_height()}px`,"max-height":r!=null?`${r}px`:""};i.width=`${o.default.or_throw().visual_edit.root_width()}px`;return i}),{noWaitVisible:true,outerPositioning:true}),c.tokenStyling(),...(0,a.containerStyling)(n),...c.basicStyling(e)]}}))},{"../../../constants/server_rendering":86,"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../lang/font_tokens":713,"../../../lib":741,"../../../logger":744,"../../../renderer/solid_utils/autorun_signals":774,"../../../u/shared/async/autorun":830,"../../../u/shared/errors":846,"./utils/container_utils":271,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],249:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");const i=(0,r.template)(`<div></div>`,2);const s=e("../../../constants/runmode");const o=e("../../property_applications");const{onMount:a}=e("solid-js");const{createElement:l}=e("./utils/createElement");const c=e("./utils/element_styles");const{defaultEventHandlers:u}=e("./utils/directives");const{containerStyling:d,containerProperties:p,ChildWrapper:_}=e("./utils/container_utils");const{Style:f}=e("./utils/properties");const h=e("../../../lang/evaluation/element_eval");const m=e("../../../lang/evaluation/element_props");const g=s.POPUP_ZINDEX-1;function v(e){const t=e.instance;a((()=>{if(t.run_mode()){const e=t.get_static_property("parallax");if(e!=null&&e!==1){$(window).on("scroll",(function(){window.requestAnimationFrame((function(){o.apply_css_style(t.canvas,{transform:"translate3d(0,"+(1-e)*$(window).scrollTop()+"px, 0)"})}))}))}t.manual_position=false;t.on_message("position_element",(e=>{t.manual_position=true;t.state("manual_position",{top:`${e.Y}px`,left:`${e.X}px`,position:e.position})}))}}));return(()=>{const t=i.cloneNode(true);(0,r.use)(u,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(_,e));(0,r.effect)((n=>{const i=e.id,s=e.style,o={...e.classList,"floating-group":true,[e.containerClass]:true};i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t})()}t.exports=l(v,(e=>({shouldAddWrapper:e.should_add_extra_wrapper()})),((e,t)=>{let{shouldAddWrapper:n}=t;function r(){if(e.get_static_property("float_zindex")==="back"){return 0}else{const t=g-s.FLOATING_GROUP_ZINDEX_OFFSET;return t+e.get_zindex()}}const i=e.parent();return{properties:p(n),styles:[new f((t=>{const n={width:"initial","min-width":m.min_width_css(t),"min-height":m.min_height_css(t)};const s=m.max_width_css(t);const o=m.max_height_css(t);for(const e of["left","right","top","bottom"]){n[e]=h.evaluate_property(t,`margin_${e}`)}if(e.fit_width()){n.width="auto";const e=`calc(100% - ${n.left+n.right}px)`;if(s!=null){n["max-width"]=[`min(${s}, ${e})`,s]}else{n["max-width"]=e}}else{n.width="initial";n["max-width"]=s}if(e.fit_height()){n.height="auto";const e=`calc(100% - ${n.top+n.bottom}px)`;if(o!=null){if(t.run_mode()){n["max-height"]=[`min(${o}, ${e})`,o]}else{n["max-height"]=o}}else if(t.run_mode()){n["max-height"]=e}}else{n.height="initial";n["max-height"]=o}switch(e.get_static_property("floating_reference_horizontal_resp")){case"left":if(e.fit_width()){n.right="unset"}else{n["margin-right"]="auto"}break;case"right":if(e.fit_width()){n.left="unset"}else{n["margin-left"]="auto"}}const a=e.get_static_property("floating_reference");n.position=a==="none"||!t.run_mode()||i.type()!=="Page"?"absolute":"fixed";switch(a){case"top":if(e.fit_height()){n.bottom="unset"}break;case"bottom":if(e.fit_height()){n.top="unset"}else if(i.type()==="Page"){n.height=`calc(100${t.run_mode()?"vh":"%"} - ${n.top+n.bottom}px)`;n.top="unset"}else{n["margin-top"]="auto"}break;case"both":if(i.type()==="Page"){n["margin-top"]=n["margin-bottom"]="auto"}n["overflow-y"]="auto";break;case"none":n.bottom="unset"}n["z-index"]=r();return n}),{outerPositioning:true,noWaitVisible:true}),new f((e=>{var t;return(t=e.state("manual_position"))!=null?t:{}}),{alwaysDynamic:true}),new f((e=>{if(!e.is_visible()){return{display:"none"}}}),{alwaysDynamic:true,noWaitVisible:true,notInStylesheet:true,outerPositioning:true}),...d(n),...c.basicStyling(e)]}}))},{"../../../constants/runmode":83,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../property_applications":412,"./utils/container_utils":271,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],250:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=u(e("./utils/createElement"));var s=e("./utils/element_styles");var o=e("./utils/directives");var a=e("./utils/container_utils");var l=e("./utils/properties");var c=e("../../../lang/evaluation/element_eval");function u(e){return e&&e.__esModule?e:{default:e}}const d=(0,r.template)(`<div></div>`,2);function p(e){return(()=>{const t=d.cloneNode(true);(0,r.use)(o.defaultEventHandlers,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(a.ChildWrapper,e));(0,r.effect)((n=>{const i=e.id,s=e.style,o={...e.classList,[e.containerClass]:true};i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t})()}t.exports=(0,i.default)(p,(e=>({shouldAddWrapper:e.should_add_extra_wrapper()})),((e,t)=>{let{shouldAddWrapper:n}=t;return{properties:(0,a.containerProperties)(n),styles:[new l.Style((e=>({overflow:e.state("collapsing")?"hidden":(0,c.evaluate_property)(e,"overflow_scroll")?e.run_mode()?"hidden auto":"hidden":"visible"}))),...(0,a.containerStyling)(n),...(0,s.placedStyling)(e)]}}))},{"../../../lang/evaluation/element_eval":690,"./utils/container_utils":271,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js/web":2315}],251:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");const i=(0,r.template)(`<div></div>`,2);const{onMount:s}=e("solid-js");const{onAfterMount:o}=e("../../../renderer/solid_utils/autorun_signals");const a=e("../../../lib");const l=e("../../../lang/appquery");const c=e("../../../u/client/b_ui");const u=e("../../../u/shared/async/b_async");const d=e("../../../u/shared/uuid");const{createElement:p}=e("./utils/createElement");const _=e("./utils/element_styles");const{defaultEventHandlers:f}=e("./utils/directives");const{containerStyling:h,containerProperties:m,ChildWrapper:g}=e("./utils/container_utils");const{Style:v}=e("./utils/properties");const b=e("../../../lang/evaluation/element_props");const y=e("../../../u/shared/mode_check");const w=20;function x(e){const t=e.instance;s((()=>{t.do_hide()}));o((()=>{const e=t.canvas;let n=e.parent();if(t.edit_mode()){n=n.parent()}let r=false;let i=null;let s=null;if(t.run_mode()){const n=`click.groupfocus${d.LUID()}`;i=()=>{$("body").on(n,(n=>{var i;const s=$(".tt-dropdown-menu");const o=()=>{for(let e=0;e<s.length;e++){if($.contains(s[e],n.target)){return true}}return false};const l=t.is_visible()&&!e.data("GroupWithFocus_loading")&&e[0]!==n.target&&!$.contains(e[0],n.target)&&!((i=$(n.target).attr("class"))!=null&&i.match(/\bselect2-/))&&!o();if(l){if(y.running_test()){t.do_hide()}else{r=true;t.setTimeout((()=>{u.WaitFor(a().workflow.everything_done_key(),(()=>{r=false;t.do_hide()}))}),10)}}}))};s=()=>{$("body").off(n)}}const o=`resize.groupfocus${d.LUID()}`;let p=null;let _=null;let f=null;function h(){var e,t;(e=p)==null?void 0:e.disconnect();(t=_)==null?void 0:t.disconnect();$(window).off(o);p=null;_=null;f=null}const m=t.autorun((()=>{if(!t.is_visible()){var e;(e=s)==null?void 0:e();h();return}t.autorun((()=>{var e,s;const u=t.get_static_property("offset_left");const d=t.get_static_property("offset_top");function m(){var e;if(t.manual_position){return}if(!((e=f)!=null&&e.is(":visible"))){if(!r){t.state("gf_reference_position",{position:"absolute",top:"0px",left:"0px"})}h();return}const i=t.run_mode()&&c.is_fixed(f);const s=f.offset();const o=n.offset();let a=s.left-o.left;let _=s.top-o.top;if(i){a-=window.scrollX;_-=window.scrollY}const g=l.get_public_setting("bubble_version")>=20;const v=g?f.outerHeight():f.height();const b=g?f.outerWidth():f.width();const y=a+u;const w=_+d+v;t.state("gf_reference_position",{position:i?"fixed":"absolute",left:`${y}px`,top:`${w}px`});const x=-_;const j=-a;const A=_-n.height()+v;const M=a-n.width()+b;if(typeof IntersectionObserver!=="undefined"){var E;(E=p)==null?void 0:E.disconnect();p=new IntersectionObserver((e=>{if(e[0].intersectionRatio<1){m()}}),{root:i?null:n[0],rootMargin:`${x}px ${M}px ${A}px ${j}px`,threshold:1});p.observe(f[0])}}const g=t.get_static_property("reference");if(t.edit_mode()){f=a().visual_edit.current_editor_canvas.getWrapper(g)}else{var v;f=(v=t.find_instance_by_id(g))==null?void 0:v.canvas}(e=i)==null?void 0:e();if(!((s=f)!=null&&s.is(":visible"))){t.state("gf_reference_position",{position:"absolute",top:"0px",left:"0px"});h();return}m();$(window).off(o);$(window).on(o,(()=>{m()}));if(typeof ResizeObserver!=="undefined"){var b;(b=_)==null?void 0:b.disconnect();_=new ResizeObserver((e=>{m()}));_.observe(f[0],{box:"border-box"})}}))}),(()=>{var e;h();(e=s)==null?void 0:e()}));m.set_run_immediately(true)}));s((()=>{t.manual_position=false;t.on_message("position_element",(e=>{t.manual_position=true;t.state("gf_reference_position",{top:`${e.Y}px`,left:`${e.X}px`,position:e.position})}))}));return(()=>{const t=i.cloneNode(true);(0,r.use)(f,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(g,e));(0,r.effect)((n=>{const i=e.id,s=e.style,o={...e.classList,[e.containerClass]:true};i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t})()}t.exports=p(x,(e=>({shouldAddWrapper:e.should_add_extra_wrapper()})),((e,t)=>{let{shouldAddWrapper:n}=t;return{properties:m(n),styles:[new v((e=>{var t,n;return{"min-width":b.min_width_css(e),"max-width":(t=b.max_width_css(e))!=null?t:"","min-height":b.min_height_css(e),"max-height":(n=b.max_height_css(e))!=null?n:"",height:e.element.fit_height()?"auto":"initial",right:w,bottom:e.element.fit_height()?"unset":w,"z-index":a().bv().MAX_POPUP_ZINDEX+e.element.get_zindex(),"margin-right":e.run_mode()?"auto":undefined,"overflow-y":e.run_mode()?"auto":"hidden"}}),{noWaitVisible:true,outerPositioning:true}),new v((e=>{var t;return(t=e.state("gf_reference_position"))!=null?t:{position:"absolute"}}),{alwaysDynamic:true,outerPositioning:true}),...h(n),..._.basicStyling(e)]}}))},{"../../../lang/appquery":651,"../../../lang/evaluation/element_props":691,"../../../lib":741,"../../../renderer/solid_utils/autorun_signals":774,"../../../u/client/b_ui":813,"../../../u/shared/async/b_async":832,"../../../u/shared/mode_check":851,"../../../u/shared/uuid":855,"./utils/container_utils":271,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],252:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=m(e("../../../renderer/solid_utils/autorun_signals"));var s=e("./utils/createElement");var o=e("solid-js");var a=e("./utils/container_utils");var l=e("./utils/repeating_border_styles");var c=m(e("../../../u/shared/mode_check"));var u=e("../Layouts/RepeatingGroupLayout");var d=e("../../../u");var p=e("./utils/properties");var _=e("./utils/table_element");var f=e("./utils/directives");function h(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(h=function(e){return e?n:t})(e)}function m(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=h(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const g=(0,r.template)(`<div></div>`,2);function v(e){var t;const n=e.instance;const s=n.element.repeating_instance.repeating_layout_type==="Table";const p=s?(t=n.element.data_instance)==null?void 0:t.table_element_layout:n.element.repeating_instance.repeating_group_layout;if(!p){throw new d.UnexpectedError("Layout not found")}const _=i.createWatcher((()=>`entry-${n.state("cell_index")}`),{fallback:""});const h=(0,l.createBorderStyle)((0,o.mergeProps)({includeMargin:!s},e));const m=()=>({display:e.hidden?"none":""});(0,o.createEffect)((()=>{if(c.on_server()){if(e.hidden){n.do_hide()}else{n.do_show()}}else{if(e.hidden){queueMicrotask((()=>n.do_hide()))}else{queueMicrotask((()=>n.do_show()))}}}));n.parent().add_to_namespace(n);(0,o.createEffect)((()=>{const t=e.intersectionObserver;if(t!=null){t.observe(n.canvas[0]);(0,o.onCleanup)((()=>{t.unobserve(n.canvas[0])}))}}));(0,o.onMount)((()=>{var e;if(n.run_mode()&&p instanceof u.RepeatingGroupLayoutStyle&&(e=p.is_masonry)!=null&&e.call(p)){var t;(t=p.observe_masonry_cell)==null?void 0:t.call(p,n.canvas[0])}}));return(()=>{const t=g.cloneNode(true);(0,r.use)(f.defaultEventHandlers,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(a.ChildWrapper,e));(0,r.effect)((n=>{const i={...m(),...e.cellSizing,...h(),...e.style},s={"bubble-element":true,"group-item":true,[_()]:true,[e.containerClass]:true};n._v$=(0,r.style)(t,i,n._v$);n._v$2=(0,r.classList)(t,s,n._v$2);return n}),{_v$:undefined,_v$2:undefined});return t})()}t.exports=(0,s.createElement)(v,(e=>({shouldAddWrapper:e.repeating_layout==="Table"&&e.should_add_extra_wrapper()})),((e,t)=>{let{shouldAddWrapper:n}=t;if(e.repeating_layout==="Table"){return{properties:{containerClass:new p.Property((()=>"bubble-cross-axis"),{fallback:"bubble-cross-axis"})},styles:(0,_.crossAxisStyling)(e)}}return{properties:(0,a.containerProperties)(n),styles:(0,a.containerStyling)(n)}}))},{"../../../renderer/solid_utils/autorun_signals":774,"../../../u":823,"../../../u/shared/mode_check":851,"../Layouts/RepeatingGroupLayout":243,"./utils/container_utils":271,"./utils/createElement":272,"./utils/directives":273,"./utils/properties":278,"./utils/repeating_border_styles":279,"./utils/table_element":281,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],253:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");const i=(0,r.template)(`<iframe src="about:blank"></iframe>`,2),s=(0,r.template)(`<div></div>`,2);const{createSignal:o,Show:a,onMount:l,onCleanup:c,createEffect:u}=e("solid-js");const d=e("../shared/video_elements");const{createElement:p}=e("./utils/createElement");const _=e("./utils/element_styles");const{defaultEventHandlers:f,jqueryHTML:h}=e("./utils/directives");const{Property:m}=e("./utils/properties");const{isServer:g}=e("solid-js/web");const v=e("../../../lang/evaluation/element_eval");const b=e("../../../u/shared/mode_check");t.exports=p(y,(e=>({deferDrawing:e.get_static_property("defer_drawing")})),((e,t)=>{let{deferDrawing:n}=t;return{properties:{html:new m((e=>v.evaluate_property(e,"html")),{noWaitVisible:!n}),useIframe:new m((e=>v.evaluate_property(e,"useiframe")),{noWaitVisible:true})},styles:_.placedStyling(e)}}));function y(e){let t=()=>e.html;if(e.deferDrawing){const[n,r]=o(false);l((()=>{e.instance.wait_for_visible_lite((()=>{r(true)}))}));t=()=>n()?e.html:""}function n(){let n,s;const o=t=>{if(n.contentWindow){n.contentWindow.contents=t;if(b.running_test()){n.contents=t}n.src='javascript:window["contents"]'}else{s=e.instance.setTimeout((()=>o(t)),100)}};u((()=>{o(t());c((()=>e.instance.clearTimeout(s)))}));return(()=>{const e=i.cloneNode(true);const t=n;typeof t==="function"?(0,r.use)(t,e):n=e;e.style.setProperty("width","100%");e.style.setProperty("height","100%");(0,r.effect)((()=>(0,r.setAttribute)(e,"sandbox",d.should_block_cookies()?"allow-scripts allow-same-origin":undefined)));return e})()}return(0,r.createComponent)(a,{get when(){return e.useIframe},get fallback(){return(()=>{const n=s.cloneNode(true);(0,r.use)(h,n,(()=>t()));(0,r.use)(f,n,(()=>e.instance));const i=e.ref;typeof i==="function"?(0,r.use)(i,n):e.ref=n;(0,r.effect)((t=>{const i=e.id,s=e.style,o=e.classList,a=g?e.html:undefined;i!==t._v$4&&(0,r.setAttribute)(n,"id",t._v$4=i);t._v$5=(0,r.style)(n,s,t._v$5);t._v$6=(0,r.classList)(n,o,t._v$6);a!==t._v$7&&(n.innerHTML=t._v$7=a);return t}),{_v$4:undefined,_v$5:undefined,_v$6:undefined,_v$7:undefined});return n})()},get children(){const t=s.cloneNode(true);(0,r.use)(f,t,(()=>e.instance));const i=e.ref;typeof i==="function"?(0,r.use)(i,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(n,{}));(0,r.effect)((n=>{const i=e.id,s=e.style,o=e.classList;i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t}})}},{"../../../lang/evaluation/element_eval":690,"../../../u/shared/mode_check":851,"../shared/video_elements":374,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],254:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");const i=(0,r.template)(`<button><svg viewbox="0 -18 50 50"><text class="fa" x="50%" y="50%" text-anchor="middle"></text></svg></button>`,6);const s=e("../shared/icons");const{createElement:o}=e("./utils/createElement");const a=e("./utils/element_styles");const{defaultEventHandlers:l}=e("./utils/directives");const{Property:c,Style:u}=e("./utils/properties");const d=e("../../../lang/evaluation/element_eval");function p(e){return(()=>{const t=i.cloneNode(true),n=t.firstChild,s=n.firstChild;(0,r.use)(l,t,(()=>e.instance));const o=e.ref;typeof o==="function"?(0,r.use)(o,t):e.ref=t;n.style.setProperty("width","100%");n.style.setProperty("height","100%");s.style.setProperty("font-size","50px");s.style.setProperty("fill","currentColor");(0,r.insert)(s,(()=>e.icon));(0,r.effect)((n=>{const i=e.id,s={display:"block",...e.style},o={...e.classList,"fa-spin":e.spin},a=e.tabIndex;i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);a!==n._v$4&&(0,r.setAttribute)(t,"tabindex",n._v$4=a);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined});return t})()}t.exports=o(p,null,(e=>({properties:{icon:new c((e=>{const t=d.evaluate_property(e,"icon");if(t==null)return undefined;const n=`${t.split(" ")[1]}`;return s.get_static_icon(n)})),spin:new c((e=>d.evaluate_property(e,"spin_icon"))),tabIndex:new c((e=>{if(d.evaluate_property(e,"button_disabled")){return"-1"}else{return""}}))},styles:[new u((e=>({color:d.evaluate_property(e,"icon_color")}))),...a.placedStyling(e)]})))},{"../../../lang/evaluation/element_eval":690,"../shared/icons":362,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js/web":2315}],255:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");const i=(0,r.template)(`<div class="aspect-ratio"></div>`,2),s=(0,r.template)(`<div><img></div>`,3);const{Show:o,createSignal:a,createEffect:l,createMemo:c,onCleanup:u}=e("solid-js");const{createElement:d}=e("./utils/createElement");const p=e("./utils/element_styles");const{defaultEventHandlers:_}=e("./utils/directives");const{Property:f,Style:h}=e("./utils/properties");const m=e("../shared/image_utils");const{createWatcher:g}=e("../../../renderer/solid_utils/autorun_signals");const v=e("../../../u/shared/b_object");const b=e("../../../shared/apps_utilities");const y=e("../../../lang/appquery");const w=e("../../../lang/evaluation/element_eval");const x=e("../../../lang/evaluation/element_props");const j="aspect-ratio";const A=` .${j}`;const M=" img";function E(e){const t=e.property("src");return!t.is_empty()&&t.is_static()&&e.get_static_property("src",true)!==""}function k(e){const t=e.instance;const[n,d]=a(m.transparent_image());const p=g((()=>t.current_width()));const f=g((()=>t.current_height()));const h=g((()=>x.is_fitting_height(t)));let w=null;l((n=>{if(p()==null||f()==null)return;let r;if(t.run_mode()||!e.editorPreviewImage||!e.src){r=e.src}else{r=e.editorPreviewImage}if(!r||v.is_empty(r)){d(m.transparent_image());return null}function i(e,r,i,s){const o=m.optimize_image(e,r,i,s);function a(){w=o;m.download_image(o,t,(e=>{if(w!==o)return;d(e)}))}if(e===n&&!m.downloaded_images[o]&&!b.is_test(y.appname())){const e=t.setTimeout(a,300);u((()=>{t.clearTimeout(e)}))}else{a()}}if(e.isStatic){i(r,p(),f(),{})}else{if(h()==null){return}if(!e.useAspectRatio&&h()){i(r,p())}else{i(r,p(),f())}}return r}),null);const j=c((()=>{if(e.isStatic&&e.cropData){return{"margin-top":`${e.cropData.top_offset*f()}px`}}else{return{}}}));return(()=>{const t=s.cloneNode(true),a=t.firstChild;(0,r.use)(_,t,(()=>e.instance));const l=e.ref;typeof l==="function"?(0,r.use)(l,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(o,{get when(){return e.useAspectRatio},get children(){const t=i.cloneNode(true);(0,r.effect)((n=>(0,r.style)(t,e.childStyles[A],n)));return t}}),a);(0,r.effect)((i=>{const s=e.id,o=e.style,l=e.classList,c=n(),u=e.altTag,d={...e.childStyles[M],...j()};s!==i._v$&&(0,r.setAttribute)(t,"id",i._v$=s);i._v$2=(0,r.style)(t,o,i._v$2);i._v$3=(0,r.classList)(t,l,i._v$3);c!==i._v$4&&(0,r.setAttribute)(a,"src",i._v$4=c);u!==i._v$5&&(0,r.setAttribute)(a,"alt",i._v$5=u);i._v$6=(0,r.style)(a,d,i._v$6);return i}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined,_v$5:undefined,_v$6:undefined});return t})()}t.exports=d(k,(e=>({isStatic:E(e),useAspectRatio:e.has_fixed_aspect_ratio()})),((e,t)=>{let{isStatic:n,useAspectRatio:r}=t;return{properties:{altTag:new f((e=>w.evaluate_property(e,"alt_tag"))),src:new f((e=>w.evaluate_property(e,"src"))),cropData:new f((e=>w.evaluate_property(e,"crop_data"))),editorPreviewImage:new f((e=>w.evaluate_property(e,"editor_preview_image")))},styles:[new h((e=>{const t={top:"0px",left:"0px",display:"block",width:"100%",height:"100%"};if(n){t.position="absolute";const i=w.evaluate_property(e,"crop_data");if(i!=null){function s(e){return`${Math.floor(e*100)}%`}Object.assign(t,{width:s(i.width_factor),height:s(i.height_factor),"margin-left":s(i.left_offset)})}}else{const o={rescale:"contain",adjust_height:"contain",stretch:"fill",zoom:"cover"};const a=w.evaluate_property(e,"stretch_or_rescale");t["object-fit"]=o[a];if(!r&&x.is_fitting_height(e)){t.position="relative";t.height="auto"}else{t.position="absolute"}}return t}),{selector:M}),new h((e=>{if(w.evaluate_property(e,"four_border_style")){const t={};for(const n in["top","right","bottom","left"]){t[`border-radius-${n}`]=`${w.evaluate_property(e,`border_roundness_${n}`)}px`}}else{return{"border-radius":`${w.evaluate_property(e,`border_roundness`)}px`}}}),{selector:M}),new h((e=>{if(r){const t=e.get_static_property("aspect_ratio_height")/e.get_static_property("aspect_ratio_width");return{position:"relative",height:0,"padding-top":`${t*100}%`}}else{return{}}}),{selector:A}),...p.placedStyling(e)]}}))},{"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../renderer/solid_utils/autorun_signals":774,"../../../shared/apps_utilities":788,"../../../u/shared/b_object":839,"../shared/image_utils":363,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],256:[function(e,t,n){"use strict";var r=e("solid-js/web");const i=(0,r.template)(`<input>`,1);const s=e("../../../u/client/b_ui");const o=e("../../../u/client/b_window");const a=e("../../../u/shared/async/autorun");const l=e("../../../lang/evaluation/page_state");const c=e("../../input_mask");const u=e("../../../lang/btypes");const d=e("../../../lib");const p=e("../../../geolocation/b_location");const _=e("../../custom_tz_utilities");const f=e("../../../u/shared/b_date");const h=e("../../../lang/evaluation/element_eval");const{createElement:m}=e("./utils/createElement");const g=e("./utils/element_styles");const{defaultEventHandlers:v,inputChangeKeyupHandlers:b,enterHandler:y}=e("./utils/directives");const{Property:w}=e("./utils/properties");const{onMount:x,onCleanup:j}=e("solid-js");const{has_input_timezone_controls_on:A}=e("../../../lang/timezone_override_settings");function M(e){if(A()){return _.get_custom_tz({static_eval:t=>e.get_static_property(t),dynamic_eval:t=>h.evaluate_property(e,t),not_overridden:true})}else{return d().current_timezone()}}function E(e){return e==="date"||e==="date_2"}function k(e,t){let n;const r=e.get_static_property("content_format");switch(r){case"int_number":n=parseInt(d().locale().parse_float(t));break;case"float_number":case"percentage":case"currency":n=d().locale().parse_float(t);break;case"geographic_address":n=function(){return p.from_address(t)};break;case"date":case"date_2":{const r=M(e);n=f.mk_date(t,r);break}default:n=t;if(r==null||r==="text"||r==="numerical_ref"){if(e.get_static_property("limit_number_of_characters")){const t=e.get_static_property("character_limit");if(t!=null&&n!=null&&n.length>t){n=n.slice(0,t)}}}}if(typeof n==="number"&&isNaN(n)){return null}else{return n}}function O(e){if(o.is_on_mobile_or_tablet()){if(e==="int_number"||e==="us_phone"||e==="numerical_ref"){return"tel"}if(e==="float_number"){return"number"}}switch(e){case"password":return"password";case"email":return"email";default:return"input"}}function S(e){const t=e.instance;function n(e){const n={clearMaskOnLostFocus:true,showMaskOnHover:false,greedy:false,rightAlign:false,inputEventOnly:true};if(e==="currency"){n.prefix=h.evaluate_property(t,"currency_symbol");if(t.get_static_property("always_show_decimals")){n.digitsOptional=false;n.placeholder="0"}else{n.digitsOptional=true;n.placeholder=""}}if(e==="float_number"||e==="percentage"){const r=t.get_static_property("decimal_place");if(r!=null&&r>=0){n.digits=r;n.digitsOptional=false;n.placeholder="0";n._radixDance=true;n.inputEventOnly=false}if(e==="float_number"&&!t.get_static_property("show_thousands")){n.autoGroup=false;n.groupSeparator=""}}if(E(e)){n.timezone=M(t)}return n}const o=()=>t.get_static_property("show_thousands");const p=()=>t.get_static_property("decimal_place")!=null;function _(e){if(!(e in c.masks)){return false}if(e==="int_number"){return o()}if(e==="float_number"){return o()||p()}return true}x((()=>{const e=undefined;const r=t.autorun((()=>{const r=t.get_static_property("content_format");const i=t.state("current_tz");if(t.state("has_been_changed")&&i===e){return}if(t.state("is_focused")){return}let s=t.state("value");if(r==="geographic_address"){s=u.get("geographic_address").runmode_display(s)}else if(t.run_mode()){if(_(r)){s=c.masks[r].format_val(s,n(r))}else if(typeof s==="number"){if(r==="int_number"){s=parseInt(s).toString()}else if(r==="float_number"){s=d().locale().format_decimal(s)}}}t.canvas.val(s!=null?s:"")}));j((()=>{r.destroy()}))}));function f(){const e=t.get_static_property("content_format");if(e in c.masks){const n={};if(E(e)){n.timezone=t.state("current_tz")}return c.masks[e].get_val(t.get_canvas(),n)}else{return k(t,t.get_canvas().val())}}x((()=>{if(t.run_mode()){t.on_message("set_focus",(()=>{t.canvas.focus()}));const e=t.get_static_property("content_format");if(E(e)){const e=t.autorun((()=>{t.state("current_tz",M(t))}));j((()=>{e.destroy()}))}if(e==="password"){t.canvas.passMeter({events:"keyup input change",afterTest:e=>{if(e===0&&t.canvas.val()===""){e=null}t.state("pw_strength",e)}})}if(e==="int_number"&&!o()){s.make_numeric(t.canvas,true)}else if(e==="float_number"&&!o()&&!p()){s.make_numeric(t.canvas)}else{if(e in c.masks){const r=a.autorun((function(){const r=c.masks[e].get_mask(n(e));t.canvas.inputmask(r);t.canvas.off("click.inputmask");t.canvas.on("click.inputmask",(e=>{$(e.target).trigger("inputmaskclick")}))}));j((()=>{r.destroy()}))}}}}));x((()=>{t.canvas.blur((()=>{l.input_focused(false)}));t.canvas.focus((()=>{l.input_focused(true)}))}));return(()=>{const n=i.cloneNode(true);(0,r.use)(y,n,(()=>[t,e.needsMetaKey]));(0,r.use)(b,n,(()=>[t,f]));(0,r.use)(v,n,(()=>e.instance));const s=e.ref;typeof s==="function"?(0,r.use)(s,n):e.ref=n;(0,r.effect)((i=>{const s=e.id,o=e.style,a=e.classList,l=e.type==="number"?"input":e.type,c=e.placeholder,u=!t.run_mode(),d=e.maxlength,p=e.disabled,_=e.type==="number"?"decimal":undefined,f=e.type==="password"?"new-password":undefined;s!==i._v$&&(0,r.setAttribute)(n,"id",i._v$=s);i._v$2=(0,r.style)(n,o,i._v$2);i._v$3=(0,r.classList)(n,a,i._v$3);l!==i._v$4&&(0,r.setAttribute)(n,"type",i._v$4=l);c!==i._v$5&&(0,r.setAttribute)(n,"placeholder",i._v$5=c);u!==i._v$6&&(n.readOnly=i._v$6=u);d!==i._v$7&&(0,r.setAttribute)(n,"maxlength",i._v$7=d);p!==i._v$8&&(n.disabled=i._v$8=p);_!==i._v$9&&(0,r.setAttribute)(n,"inputmode",i._v$9=_);f!==i._v$10&&(0,r.setAttribute)(n,"autocomplete",i._v$10=f);return i}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined,_v$5:undefined,_v$6:undefined,_v$7:undefined,_v$8:undefined,_v$9:undefined,_v$10:undefined});return n})()}t.exports=m(S,null,(e=>({properties:{type:new w((e=>O(e.get_static_property("content_format"))),{alwaysDynamic:true}),placeholder:new w((e=>h.evaluate_property(e,"placeholder"))),maxlength:new w((e=>{if(e.get_static_property("limit_number_of_characters")){const t=h.evaluate_property(e,"character_limit");const n=h.evaluate_property(e,"content_format");if(t&&[null,undefined,"text","numerical_ref"].includes(n)){return t}}return null})),disabled:new w((e=>h.evaluate_property(e,"disabled"))),needsMetaKey:new w((e=>h.evaluate_property(e,"not_submit_on_enter"))),tz_dynamic:new w((e=>h.evaluate_property(e,"tz_dynamic")))},styles:g.placedStyling(e)})))},{"../../../geolocation/b_location":621,"../../../lang/btypes":653,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/page_state":698,"../../../lang/timezone_override_settings":729,"../../../lib":741,"../../../u/client/b_ui":813,"../../../u/client/b_window":814,"../../../u/shared/async/autorun":830,"../../../u/shared/b_date":836,"../../custom_tz_utilities":380,"../../input_mask":383,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"solid-js":2313,"solid-js/web":2315}],257:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=u(e("./utils/createElement"));var s=e("./utils/element_styles");var o=e("./utils/directives");var a=e("./utils/container_utils");var l=e("solid-js");var c=u(e("../../../safe_require"));function u(e){return e&&e.__esModule?e:{default:e}}const d=(0,r.template)(`<div></div>`,2);function p(e){(0,l.onMount)((()=>{var t,n;return(t=(n=e.instance.element.E).legacy_container_mount)==null?void 0:t.call(n,e.instance)}));return(()=>{const t=d.cloneNode(true);(0,r.use)(o.defaultEventHandlers,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(a.ChildWrapper,e));(0,r.effect)((n=>{const i=e.id,s=e.style,o={...e.classList,[e.containerClass]:true};i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t})()}t.exports=(0,i.default)(p,(e=>({shouldAddWrapper:e.should_add_extra_wrapper()})),((e,t)=>{let{shouldAddWrapper:n}=t;return{properties:(0,a.containerProperties)(n),styles:[...(0,a.containerStyling)(n),...(0,s.placedStyling)(e)]}}));c.default.safe_register("./core/core_elements/components/LegacyContainerComponent",t.exports)},{"../../../safe_require":777,"./utils/container_utils":271,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],258:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");const i=(0,r.template)(`<a></a>`,2);const s=e("../../../u/client/b_ui");const o=e("../../../u/shared/b_object");const a=e("../../../u/shared/mode_check");const l=e("../shared/text_elements");const c=e("../shared/links");const{createEffect:u,onCleanup:d,onMount:p}=e("solid-js");const{createElement:_}=e("./utils/createElement");const f=e("./utils/element_styles");const{Property:h,Style:m}=e("./utils/properties");const{defaultEventHandlers:g}=e("./utils/directives");const v=e("../../../constants/runmode");const b=e("../../../lang/application");const y=e("../../../lang/appquery");const w=e("../../url_data");const x=e("../../../lib");const j=e("../../../constants/lang");const A=e("../../../lang/evaluation/evaluate");const M=e("../../../lang/evaluation/eval_node_state");const E=e("../../../lang/evaluation/element_eval");const k=e("../../../client/internal_navigation");const O=e("querystring");const{createWatcher:S}=e("../../../renderer/solid_utils/autorun_signals");function D(e){const t=E.evaluate_property(e,"linktype");function n(e){var t,n;return(t=b.page_id_to_name(e))!=null?t:(n=y.get_page_by_name(e))==null?void 0:n.name()}if(t==="pagelink"){var r;const t=E.evaluate_property(e,"page");let i=(r=n(t))!=null?r:"";const s=E.evaluate_property(e,"data_to_send");if(s){const e=y.get_page_by_name(i);if(e!=null){const t=w.get_data_to_send(s,e.get_static_property("readable_field"));if(t){i+="/"+t}}}const l={};if(e.get_static_property("keep_current_page_params")){Object.assign(l,x().location.get_query())}if(a.is_debug_mode()){l.debug_mode=true}if(E.evaluate_property(e,"add_parameters")){const t=e.element.property("url_parameters");M.with_eval_node(t,(function(){const n=A.evaluate_properties(t.json._raw(),e.prop_eval_context(),j.DETECT_FIELD_NAMES,[],t.json._path());for(const{key:e,value:t}of Object.values(n)){if(!c.forbidden_url_keys.includes(e)){l[e]=t}}}))}if(i==="index"){i=""}let u=x().location.get_server_base()+i;if(!o.is_empty(l)){u+="?"+O.stringify(l)}return u}else{var i;let t=E.evaluate_property(e,"url");if(((i=t)==null?void 0:i.indexOf("//"))===-1&&!c.href_attributes.includes(t.split(":")[0])&&t[0]!=="#"){t="//"+t}return t}}function C(e){const t=e.instance;u((()=>{if(!e.showIcon&&e.backgroundStyle!=="image"&&e.useDotDotDot){l.apply_dotdotdot(t,t.edit_mode()?"letter":"words");d((()=>l.remove_dotdotdot(t)))}}));const n=n=>{if(e.verticalCenter||t.run_mode()&&e.useDotDotDot){return`<div>${n}</div>`}else{return n}};u((()=>{const r=t.canvas;if(e.backgroundStyle==="image"){r.text("");return}if(e.showIcon){r.empty();const t=s.div(e.icon+" inner-element");t.css({"font-family":"FontAwesome","padding-left":"3px"});r.append(t)}else{r.html(n(e.noHtml?s.bbcode_to_html(e.text,true).trim():e.text))}t.canvas[0].addEventListener("click",(e=>{k.internal_navigation_handler(e)}))}));const o=S((()=>D(t)));if(t.run_mode()){p((()=>{E.on_property_change(t,"link_disabled",(e=>{t.state("link_disabled",e)}))}));p((()=>{if(a.on_phonegap()){t.canvas.on("touchend",(()=>{window.open(o(),"_blank","location=yes,enableViewportScale=yes")}));t.canvas.on("click",(e=>{e.preventDefault();return false}))}}))}return(()=>{const t=i.cloneNode(true);(0,r.use)(g,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.effect)((n=>{const i=e.id,s=e.style,a={...e.classList,[v.CLICKABLE_ELEMENT]:true,"bubble-r-vertical-center":e.verticalCenter},l=e.target,c=e.rel,u=o();i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,a,n._v$3);l!==n._v$4&&(0,r.setAttribute)(t,"target",n._v$4=l);c!==n._v$5&&(0,r.setAttribute)(t,"rel",n._v$5=c);u!==n._v$6&&(0,r.setAttribute)(t,"href",n._v$6=u);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined,_v$5:undefined,_v$6:undefined});return t})()}t.exports=_(C,(e=>({showIcon:e.get_styleable_static_property("show_icon")})),((e,t)=>{let{showIcon:n}=t;return{properties:{...n?{icon:new h((e=>E.evaluate_property(e,"icon")))}:{text:new h((e=>E.evaluate_property(e,"text"))),useDotDotDot:new h(l.could_clip),noHtml:new h((e=>E.evaluate_property(e,"no_html")))},backgroundStyle:new h((e=>E.evaluate_property(e,"background_style"))),verticalCenter:new h((e=>E.evaluate_property(e,"vertical_centering"))),target:new h((e=>E.evaluate_property(e,"open_in_new_tab")?"_blank":"_self")),rel:new h((e=>E.evaluate_property(e,"nofollow")?"nofollow":null))},styles:[new m((e=>({"word-break":"break-word",...E.evaluate_property(e,"background_style")==="none"?{"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","user-select":"none"}:{}}))),new m((e=>{if(E.evaluate_property(e,"link_disabled")){return{cursor:"not-allowed","pointer-events":"none"}}else{return{cursor:"pointer","pointer-events":"auto"}}})),...f.placedStyling(e)]}}))},{"../../../client/internal_navigation":26,"../../../constants/lang":73,"../../../constants/runmode":83,"../../../lang/application":650,"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/eval_node_state":694,"../../../lang/evaluation/evaluate":695,"../../../lib":741,"../../../renderer/solid_utils/autorun_signals":774,"../../../u/client/b_ui":813,"../../../u/shared/b_object":839,"../../../u/shared/mode_check":851,"../../url_data":416,"../shared/links":365,"../shared/text_elements":373,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,querystring:2279,"solid-js":2313,"solid-js/web":2315}],259:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");const i=(0,r.template)(`<div></div>`,2);const s=e("../../../lib");const{createEffect:o,createSignal:a,onCleanup:l,onMount:c}=e("solid-js");const u=e("../../../lang/evaluation/page_state");const d=e("../../../u/shared/mode_check");const p=e("../../../u/client/b_window");const _=e("../../../u/client/color");const f=e("../shared/image_utils");const{createElement:h}=e("./utils/createElement");const m=e("./utils/element_styles");const{defaultEventHandlers:g}=e("./utils/directives");const{containerStyling:v,containerProperties:b,ChildWrapper:y}=e("./utils/container_utils");const w=e("../../../lang/evaluation/element_eval");const{Property:x,Style:j}=e("./utils/properties");const{style:A}=e("solid-js/web");const{AT_ROOT:M}=e("../../../constants/server_rendering");const{createAutorun:E}=e("../../../renderer/solid_utils/autorun_signals");const{load_font_tokens_default:k,load_font_tokens_user:O}=e("../../../lang/font_tokens");const S=`${M} body`;const D=["background_style","bgcolor","background_gradient_direction","background_gradient_from","background_gradient_mid","background_gradient_to","background_image","center_background","background_size_cover","repeat_background_vertical","repeat_background_horizontal","background_color_if_empty_image","background_gradient_style","background_radial_gradient_shape","background_radial_gradient_size","background_radial_gradient_xpos","background_radial_gradient_ypos","background_gradient_custom_angle"];const C=e=>{const t={};for(const n of D){t[n]=w.evaluate_property(e,"backdrop_"+n)}if(e.run_mode()){t.backdrop_paralax_speed=w.evaluate_property(e,"backdrop_paralax_speed");t.backdrop_image_paralax=w.evaluate_property(e,"backdrop_image_paralax")}return{...{is_backdrop:true},...t}};const T=e=>{if(e.repeat_background_vertical&&e.repeat_background_horizontal){return"repeat"}else if(e.repeat_background_vertical){return"repeat-y"}else if(e.repeat_background_horizontal){return"repeat-x"}else{return"no-repeat"}};const N=e=>[null,undefined,"linear"].includes(e.background_gradient_style);const P=e=>{let t,n,r;t=e.background_gradient_from;n=e.background_gradient_to;let i,s;if(N(e)){if(e.background_gradient_direction==="custom"){var o;i=((o=e.background_gradient_custom_angle)!=null?o:45)+"deg"}else{var a;i=(a=e.background_gradient_direction)!=null?a:"top";if(i==="top"||i==="bottom"){r=0;if(i==="bottom"){s=t;t=n;n=s;i="top"}}else if(i==="left"||i==="right"){r=1;if(i==="right"){s=t;t=n;n=s;i="left"}}}}return[t,n,r,i]};t.exports=h(I,(e=>({shouldAddWrapper:e.should_add_extra_wrapper()})),((e,t)=>{let{shouldAddWrapper:n}=t;return{properties:{title:new x((e=>w.evaluate_property(e,"title")),{mayContainDynamic:true}),backdropBackgroundData:new x((e=>C(e)),{fallback:{}}),...b(n)},styles:[new j((t=>{const n=C(t);if(n.background_style!=="video"){const t={};if(n.background_style==="bgcolor"){t["background-color"]=n.bgcolor}else if(n.background_style==="none"){t["background-color"]="transparent"}else if(n.background_style==="image"){if(!n.backdrop_image_paralax){t["background-color"]=n.background_color_if_empty_image}if(n.background_image){var r;t["background-repeat"]=T(n);if(n.center_background){if(n.is_backdrop){t["background-position"]="center top"}else{t["background-position"]="center"}}else{t["background-position"]=""}if(n.background_size_cover||(r=e.root())!=null&&r.use_responsive_algorithm()&&n.crop_responsive){t["background-size"]="cover";t["-webkit-background-size"]="cover";t["-moz-background-size"]="cover";t["-o-background-size"]="cover"}else{t["background-size"]=""}if(n.backdrop_image_paralax){if(!p.is_on_mobile_or_tablet()){t["background-image"]="none"}}}}return t}else{return{}}})),new j((e=>{const t=C(e);if(t.background_style==="gradient"){const[e,o,a,l]=P(t);const c=t.background_gradient_mid;let u,d;let p=["-webkit-","-moz-","-o-","-ms-",""];if(c){u=`${e} 0%, ${c} 50%, ${o} 100%`}else{u=`${e} 0%, ${o} 100%`}if(N(t)){d=`linear-gradient(${l}, ${u})`}else{var n,r,i,s;p=["","-webkit-","-moz-","-o-","-ms-"];(n=t.background_radial_gradient_shape)!=null?n:t.background_radial_gradient_shape="ellipse";(r=t.background_radial_gradient_size)!=null?r:t.background_radial_gradient_size="farthest-corner";(i=t.background_radial_gradient_xpos)!=null?i:t.background_radial_gradient_xpos=10;(s=t.background_radial_gradient_ypos)!=null?s:t.background_radial_gradient_ypos=10;d=`radial-gradient(${t.background_radial_gradient_shape} ${t.background_radial_gradient_size} at ${t.background_radial_gradient_xpos}% ${t.background_radial_gradient_ypos}%, ${u})`}const f=[];for(const e of p)f.push(e+d);f.push(e);const h=_.RGBA_to_ARGB(e);const m=_.RGBA_to_ARGB(o);return{background:f,filter:`progid:DXImageTransform.Microsoft.gradient( startColorstr='${h}', endColorstr='${m}',GradientType=${a})`}}else{return{}}})),new j((t=>{var n,r;const i={"min-width":e.root_min_width(),"max-width":(n=e.root_max_width())!=null?n:"","min-height":e.root_min_height(),"max-height":(r=e.root_max_height())!=null?r:""};if(t.run_mode()){const e=t.element.root_min_height();Object.assign(i,{width:t.element.container_layout()==="fixed"?`${t.element.get_width()}px`:"100%","min-height":[`max(${e}px, 100%)`,"100%"],"margin-right":"auto","margin-left":"auto",position:"relative","z-index":2});if(t.element.container_layout()==="column"){i.height="max-content";i["flex-shrink"]=0}}else{i.width=s().visual_edit.root_width()}return i}),{noWaitVisible:true,outerPositioning:true}),new j((e=>{if(e.run_mode()){const t={height:"100%"};if(e.element.container_layout()==="column"){t.display="flex";t["flex-direction"]="column"}return t}else{return{}}}),{noWaitVisible:true,selector:S}),m.tokenStyling(),...v(n),...m.basicStyling(e)]}}));function I(e){const t=e.instance;const[n,s]=a();const _=(e,t,r)=>{e.data("_last_downloaded_image",t);f.download_image(t,r,(()=>{if(t===e.data("_last_downloaded_image")){s(`url("${t}")`)}}));e.css("background-image",n())};c((()=>{if(t.run_mode()){t.register_workflows(t.element.events());u.page_width($(window).width());$(window).on("resize",(()=>{u.page_width($(window).width())}));u.page_current_scroll_position($(window).scrollTop());$(window).on("scroll wheel touchmove",(()=>{u.page_current_scroll_position($(window).scrollTop())}))}}));o((()=>{if(t.run_mode()){if(e.title){window.document.title=e.title}}}));c((()=>{if(d.is_debug_mode()){const e=300;if(t.element.container_layout()==="fixed"){t.canvas.css("height",t.canvas.height()+e)}else{t.canvas.css("padding-bottom",e)}}}));let h;o((()=>{if(e.backdropBackgroundData.background_style==="video"){if(t.run_mode()&&!p.is_on_mobile_or_tablet()){if(!h){h=new $.BigVideo;h.init()}$("#big-video-wrap").css("background","black");const e=$("#big-video-wrap video");e.attr("muted","");const n=f.optimize_image(w.evaluate_property(t,"backdrop_video_source"),undefined,undefined,undefined,true);Promise.resolve().then((()=>{h.show(n,{forceAutoplay:true,doLoop:true,ambient:true})}));const r=t.autorun((function(){if(w.evaluate_property(t,"backdrop_video_silence")){e.attr("muted","");h.getPlayer().muted(true)}else{h.getPlayer().volume(.8);e.removeAttr("muted");h.getPlayer().muted(false)}}));l((()=>{r.destroy()}))}else{const e=t.get_canvas();e.css("background","black");const n=w.evaluate_property(t,"backdrop_video_image_fallback");if(n){e.css({"background-image":`url(${f.optimize_image(n,e.width())})`,"background-position":"center top"})}}}}));o((()=>{const n=t.canvas;const r=t.element;if(e.backdropBackgroundData.background_style==="image"){if(e.backdropBackgroundData.background_image){if(e.backdropBackgroundData.background_size_cover){if(!e.backdropBackgroundData.backdrop_image_paralax){const r=f.optimize_image(e.backdropBackgroundData.background_image,n.width());_(n,r,t)}}else if(e.backdropBackgroundData.crop_responsive){if(t.run_mode()){let e,i;const s=t.autorun((function(){const s=w.evaluate_property(t,"width");const o=w.evaluate_property(t,"height");const a=w.evaluate_property(t,"background_image");const l=t.responsive_mode()&&s===r.get_width();function c(){const e=f.optimize_image(a,s,o,{fit:"crop"});_(n,e,t)}e=f.optimize_image(a,s,o);if(a===i&&!f.downloaded_images[e]||l){t.setTimeout((()=>{if(e===f.optimize_image(a,s,o)){c()}}),300)}else{i=a;c()}}));l((()=>{s.destroy()}))}}else if(!e.backdropBackgroundData.backdrop_image_paralax){const r=f.optimize_image(e.backdropBackgroundData.background_image);_(n,r,t)}if(e.backdropBackgroundData.backdrop_image_paralax){if(!p.is_on_mobile_or_tablet()){const t=f.optimize_image(e.backdropBackgroundData.background_image,n.width());n.parallax({imageSrc:t,speed:e.backdropBackgroundData.backdrop_paralax_speed});$(".parallax-slider").attr({src:t})}else{_(n,f.optimize_image(e.backdropBackgroundData.background_image),t)}}}}}));c((()=>{if(t.run_mode()){$("html, body").css("height","100%")}}));if(t.edit_mode()){E((()=>{k();O()}))}o((t=>{const n=e.childStyles[S];A(document.body,n,t);return n}));o((t=>{const n=e.childStyles[M];A(document.documentElement,n,t);return n}));return(()=>{const n=i.cloneNode(true);(0,r.use)(g,n,(()=>e.instance));const s=e.ref;typeof s==="function"?(0,r.use)(s,n):e.ref=n;(0,r.insert)(n,(0,r.createComponent)(y,(0,r.mergeProps)(e,{get children(){return e.children}})));(0,r.effect)((i=>{const s=e.id,o=e.style,a={...e.classList,[e.containerClass]:true,"main-page":true,"page-element":t.edit_mode()};s!==i._v$&&(0,r.setAttribute)(n,"id",i._v$=s);i._v$2=(0,r.style)(n,o,i._v$2);i._v$3=(0,r.classList)(n,a,i._v$3);return i}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return n})()}},{"../../../constants/server_rendering":86,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/page_state":698,"../../../lang/font_tokens":713,"../../../lib":741,"../../../renderer/solid_utils/autorun_signals":774,"../../../u/client/b_window":814,"../../../u/client/color":817,"../../../u/shared/mode_check":851,"../shared/image_utils":363,"./utils/container_utils":271,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],260:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");const i=(0,r.template)(`<div class="greyout"></div>`,2),s=(0,r.template)(`<div></div>`,2);const{createElement:o}=e("./utils/createElement");const a=e("./utils/element_styles");const{defaultEventHandlers:l}=e("./utils/directives");const{containerStyling:c,containerProperties:u,ChildWrapper:d}=e("./utils/container_utils");const{Style:p}=e("./utils/properties");const{HORIZONTAL_SPACING:_,INITIAL_POPUP_TOP:f,FILL_POPUP_BOTTOM:h}=e("../../../constants/popups");const m=e("../../../constants/runmode");const{createAutorun:g,onAfterMount:v}=e("../../../renderer/solid_utils/autorun_signals");const b=e("../shared/popups");const y=e("../../../u/shared/async/autorun");const w=e("../../../shared/server_rendering/server_css");const x=e("../../../lang/evaluation/element_eval");const j=e("../../../lang/evaluation/element_props");const{onMount:A,onCleanup:M}=e("solid-js");const E=e("../../../renderer/BodyPortal");const{remove_blur_effect_to_greyout:k}=e("../shared/popups");const O="greyout";const S=`.${O}`;function D(e){const t=e.instance;A((()=>{if(t.run_mode()){t.canvas.css({display:"none",top:f,position:"fixed"});t.manual_position=false;t.on_message("position_element",(e=>{t.manual_position=true;t.state("manual_position",{top:`${e.Y}px`,left:`${e.X}px`,position:e.position})}))}else if(!t.thumbnail_mode()){let e=t.canvas;if(t.edit_mode())e=e.parent();e.css({top:f,position:"absolute"})}t.state("greyout").css("display","none")}));M((()=>{k(t)}));if(t.run_mode()){g((()=>{if(t.is_visible()){const e=t.current_height();y.autorun_top((()=>b.get_popup_positioning(t,e)))}}));v((()=>{let e=null;$(window).on("resize.popup_"+t.element_id(),(()=>{const n=window.innerHeight;if(e!==n){e=n;b.get_popup_positioning(t)}}));return()=>{$(window).off("resize.popup_"+t.element_id())}}))}const n=()=>(()=>{const n=i.cloneNode(true);(0,r.use)((e=>t.state("greyout",$(e))),n);(0,r.effect)((i=>{const s={[w.toClass(t.element.ssr_key())]:true},o=e.childStyles[S];i._v$=(0,r.classList)(n,s,i._v$);i._v$2=(0,r.style)(n,o,i._v$2);return i}),{_v$:undefined,_v$2:undefined});return n})();const o=()=>(()=>{const t=s.cloneNode(true);(0,r.use)(l,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(d,e));(0,r.effect)((n=>{const i=e.id,s=e.style,o={...e.classList,[e.containerClass]:true};i!==n._v$3&&(0,r.setAttribute)(t,"id",n._v$3=i);n._v$4=(0,r.style)(t,s,n._v$4);n._v$5=(0,r.classList)(t,o,n._v$5);return n}),{_v$3:undefined,_v$4:undefined,_v$5:undefined});return t})();if(t.edit_mode()){return[(0,r.createComponent)(E,{get children(){return n()}}),(0,r.memo)(o)]}else{return[(0,r.memo)(n),(0,r.memo)(o)]}}t.exports=o(D,(e=>({shouldAddWrapper:e.should_add_extra_wrapper()})),((e,t)=>{let{shouldAddWrapper:n}=t;return{properties:u(n),styles:[...c(n),...a.basicStyling(e),new p((e=>{var t;return{left:0,right:0,"z-index":m.POPUP_ZINDEX+((t=e.state("popup_zindex"))!=null?t:0),"margin-left":"auto","margin-right":"auto",width:`calc(100% - ${_*2}px)`,height:e.element.fit_height()?"auto":"initial",bottom:e.element.fit_height()?"":h,"overflow-y":"auto","grid-template-rows":e.element.fit_height()?"minmax(100%, max-content)":undefined}}),{noWaitVisible:true,outerPositioning:true}),new p((e=>{var t,n;return{"min-width":j.min_width_css(e),"max-width":(t=j.max_width_css(e))!=null?t:"","min-height":j.min_height_css(e),"max-height":(n=j.max_height_css(e))!=null?n:""}}),{outerPositioning:true}),new p((e=>{var t;return(t=e.state("manual_position"))!=null?t:{}}),{alwaysDynamic:true}),new p((e=>{var t;return{position:e.run_mode()?"fixed":"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":x.evaluate_property(e,"greyout_color"),"z-index":!e.run_mode()?m.POPUP_ZINDEX-1:m.POPUP_ZINDEX+((t=e.state("popup_zindex"))!=null?t:0)}}),{selector:S})]}}))},{"../../../constants/popups":79,"../../../constants/runmode":83,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../renderer/BodyPortal":765,"../../../renderer/solid_utils/autorun_signals":774,"../../../shared/server_rendering/server_css":807,"../../../u/shared/async/autorun":830,"../shared/popups":368,"./utils/container_utils":271,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],261:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=y(e("../../../shared/responsive/responsive_layout"));var s=y(e("../shared/repeating_groups"));var o=e("./utils/createElement");var a=b(e("./utils/element_styles"));var l=e("./utils/directives");var c=e("./utils/properties");var u=b(e("../../../lang/evaluation/element_props"));var d=b(e("../../../lang/evaluation/element_eval"));var p=e("solid-js");var _=y(e("../../../renderer/EditorContext"));var f=y(e("./RunRepeatingGroup"));var h=y(e("../../../lang/elements/ServerElementInstance"));var m=e("../../../u");var g=y(e("../../../renderer/ThumbnailContext"));function v(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(v=function(e){return e?n:t})(e)}function b(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=v(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function y(e){return e&&e.__esModule?e:{default:e}}const w=(0,r.template)(`<div></div>`,2);const x="> .group-item";function j(e){var t,n,i,s;const o=e.instance;const a=o.repeating_group_layout;if(!a){throw new m.UnexpectedError("Repeating group layout not found")}const c=()=>a.is_rg_flex();const u=()=>a.is_masonry();const d=(t=(n=(i=(0,p.useContext)(_.default))==null?void 0:i.repeatingGroupImplementation)!=null?n:(s=(0,p.useContext)(g.default))==null?void 0:s.repeatingGroupImplementation)!=null?t:f.default;return(()=>{const t=w.cloneNode(true);(0,r.use)(l.defaultEventHandlers,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(d,(0,r.mergeProps)(e,{get cellSizing(){return e.childStyles[x]},get children(){return e.children}})));(0,r.effect)((n=>{const i=e.id,s={...e.classList,"bubble-rg":!c(),"bubble-rg-flex-row":c(),masonry:u()},a={overflow:o.run_mode()?"auto":undefined,"-webkit-overflow-scrolling":o.run_mode()?"auto":undefined,...e.style};i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.classList)(t,s,n._v$2);n._v$3=(0,r.style)(t,a,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t})()}t.exports=(0,o.createElement)(j,undefined,(e=>({properties:{separatorWidth:new c.Property((e=>s.default._get_separator_width(e.element)),{fallback:0}),separatorColor:new c.Property((e=>e.get_static_property("separator_color")),{fallback:""}),separatorStyle:new c.Property((e=>e.get_static_property("separator_style")),{fallback:"none"})},styles:[new c.Style((e=>{const t=e.get_static_property("fixed_rows");const n=e.get_static_property("fixed_columns");const r=!t&&!n?e.get_static_property("scroll_direction"):n?"vertical":"horizontal";const o=e.get_static_property("auto_fit_row");const a=e.get_static_property("auto_fit_column");const l=o?"auto-fit":"auto-fill";const c=a?"auto-fit":"auto-fill";const p=r==="flex_row";const _=!t&&r==="vertical"&&!e.get_static_property("auto_fit_row")&&e.get_static_property("masonry");const f={};if(p||_){var h;f["column-gap"]=`${(h=d.evaluate_property(e,"column_cell_gap"))!=null?h:0}px`;if(!(_&&e.run_mode())){var m;f["row-gap"]=`${(m=d.evaluate_property(e,"row_cell_gap"))!=null?m:0}px`}if(p){f["align-content"]=o?"stretch":"flex-start";return f}}else{f.gap=`${s.default._get_separator_width(e.element)}px`}if(t){var g;const t=(g=d.evaluate_property(e,"rows"))!=null?g:0;if(u.is_fitting_height(e)){f["grid-template-rows"]=`repeat(${t}, minmax(max-content, auto))`}else{f["grid-template-rows"]=`repeat(${t}, minmax(0, 1fr))`}}else{if(r==="vertical"){if(o){f["grid-auto-rows"]="minmax(max-content, 1fr)"}else{var v;f["grid-auto-rows"]=_&&e.run_mode()?"1px":`minmax(max-content, ${(v=d.evaluate_property(e,"cell_min_height_css"))!=null?v:"0px"})`}}else{var b;f["grid-template-rows"]=`repeat(${l}, minmax(${(b=d.evaluate_property(e,"cell_min_height_css"))!=null?b:"1fr"}, 1fr))`}}if(n){var y;const t=(y=d.evaluate_property(e,"columns"))!=null?y:0;if(u.is_fitting_width(e)){f["grid-template-columns"]=`repeat(${t}, minmax(max-content, auto))`}else{f["grid-template-columns"]=`repeat(${t}, minmax(0, 1fr))`}}else{if(r==="horizontal"){if(e.element.container_layout()===i.default.FIXED_LAYOUT){f["grid-auto-columns"]=d.evaluate_property(e,"cell_min_width_css")}else{if(a){f["grid-auto-columns"]="minmax(max-content, 1fr)"}else{var w;f["grid-auto-columns"]=`minmax(max-content, ${(w=d.evaluate_property(e,"cell_min_width_css"))!=null?w:"0px"})`}}}else{var x;f["grid-template-columns"]=`repeat(${c}, minmax(${(x=d.evaluate_property(e,"cell_min_width_css"))!=null?x:"1fr"}, 1fr))`}}f["grid-auto-flow"]=r==="vertical"?"row":"column";return f})),new c.Style((e=>{var t;const n=e.get_static_property("fixed_rows");const r=e.get_static_property("fixed_columns");const i=!n&&!r?e.get_static_property("scroll_direction"):r?"vertical":"horizontal";const s=i==="flex_row";const o=!n&&i==="vertical"&&!e.get_static_property("auto_fit_row")&&e.get_static_property("masonry");const a=()=>{if(r||i==="vertical")return"";const t=d.evaluate_property(e,"cell_min_width_css");if(s)return t;if(t!=null&&t.includes("%")){if(u.is_fitting_width(e))return"";const r=Math.max(parseInt(t),1);let i;if(e instanceof h.default){e.dynamic_catcher=true;const t=u.min_width_css(e);if(t.includes("px")){i=parseInt(t)}else{return""}}else{var n,o,a;(n=e.repeating_group_layout)==null?void 0:n.register_resize();i=(o=(a=e.canvas)==null?void 0:a.width())!=null?o:0}const s=Math.floor(i*r/100);return`${s}px`}else{return t}};const l=()=>{var t;if(n||i==="horizontal")return"";const r=(t=d.evaluate_property(e,"cell_min_height_css"))!=null?t:"";if(s)return r;if(r!=null&&r.includes("%")){if(u.is_fitting_height(e))return"";const t=Math.max(parseInt(r),1);let n;if(e instanceof h.default){e.dynamic_catcher=true;const t=u.min_height_css(e);if(t.includes("px")){n=parseInt(t)}else{return""}}else{var o,a,l;(o=e.repeating_group_layout)==null?void 0:o.register_resize();n=(a=(l=e.canvas)==null?void 0:l.height())!=null?a:0}const i=Math.floor(n*t/100);return`${i}px`}else{return r}};return{"min-width":a(),"min-height":l(),"padding-top":o?`${(t=d.evaluate_property(e,"row_cell_gap"))!=null?t:0}px`:undefined,"box-sizing":s?"border-box":"content-box","flex-grow":s?e.get_static_property("auto_fit_column")?1:0:undefined}}),{selector:x,alwaysDynamic:true}),...a.placedStyling(e)]})))},{"../../../lang/elements/ServerElementInstance":673,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../renderer/EditorContext":766,"../../../renderer/ThumbnailContext":771,"../../../shared/responsive/responsive_layout":804,"../../../u":823,"../shared/repeating_groups":371,"./RunRepeatingGroup":263,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],262:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=y;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=v(e("../../../renderer/solid_utils/autorun_signals"));var o=m(e("../GroupItem"));var a=m(e("../../../lang/elements"));var l=v(e("../../../u/shared/mode_check"));var c=v(e("../../../logger"));var u=e("../../../u/shared/errors");var d=e("../../../u/shared/async/autorun");var p=e("../../../u/shared/async/b_async");var _=e("../../../u/client/b_ui");var f=e("../../../u/shared/async/dependency");var h=e("../../../renderer/RenderElement");function m(e){return e&&e.__esModule?e:{default:e}}function g(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(g=function(e){return e?n:t})(e)}function v(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=g(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const b=5e3;function y(e){var t,n,m;const g=e.instance;const v=(t=e.dataInstance)!=null?t:g;const y=e.layout;const w=(n=e.dataInstance)!=null?n:g;const x=()=>{if(e.fixedList){var t;return(t=g.state("show_range"))!=null?t:0}else{return 0}};const j=()=>{if(e.fixedList){return e.totalCells}else{var t;const n=(t=g.state("max_index"))!=null?t:0;if(e.showAllItems){return n}else{return n+1}}};const[A,M]=(0,i.createSignal)(false);const E=(0,f.Dependency)();(0,i.createEffect)((()=>{if(!e.turnedVisible)return;if(g.run_mode()){y.compute_extra_fields()}const t=()=>{const t=g.autorun((()=>{if(!e.fixedList){if(e.showAllItems){var t;const e=(t=w.state("list_data"))==null?void 0:t.length();const n=Math.min(e!=null?e:0,b);g.state("max_index",n)}else{(0,d.autorun_once)((()=>{g.state("max_index",Math.min(y.guess_number_of_cells(g)*2,100))}))}}}));y.init_raw_list_watcher((()=>x()),(()=>j()));E.invalidate();const n=g.autorun((()=>{if(w.state("list_data")!==undefined){(0,d.wait_for_updates)((()=>{g.mark_children_registered();g.get_children_drawn_key().turn()}));g.setTimeout((()=>n.destroy()))}}));const r=g.autorun((()=>{y.add_spinner();y.raw_list_data();y.remove_spinner()}));(0,i.onCleanup)((()=>{t.destroy();n.destroy();r.destroy()}));M(true)};if(l.on_server()){t()}else{queueMicrotask(t)}}));const k=s.createWatcher((()=>{var e,t;E.register();return(e=(t=y.raw_list_data())==null?void 0:t.filter((e=>e!=null)))!=null?e:[]}),{fallback:[]});g.children=[];(m=g.child_container)!=null?m:g.child_container=g.container.create_child(g);const O=()=>{if(!A()){if(!e.fixedList&&!e.showAllItems){if(g.children.length<1)t();g.children[0].state("group_data",a.default.STATE_NOT_READY)}return g.children}function t(){const t=g.children.length;const n=new o.default(g,0,t,e.dataInstance);let i;if(r.isServer){i=a.default.ServerElementInstance(n)}else{i=a.default.ElementInstance(n,g.mode)}i._is_visible_me=true;n.instance=i;g.children.push(i);i.state("cell_index",t+1);i.register(w);i.set_containers(w.child_container);i.start_draw_tree()}y.set_loading(true);(0,d.wait_for_updates)((()=>{const[e,t]=y._raw_list_data_watcher.get_current_status_array();y.set_loading(!t||e!=null)}));while(g.children.length<k().length){t()}k().forEach(((e,t)=>{const n=g.children[t];if(l.on_client()){(0,p.WaitFor)(_.page_loaded_key,(()=>{var e;return(e=n.can_register_workflows())==null?void 0:e.turn()}))}n.message("set_group_data",e)}));return g.children};function S(e){const t=g.state("max_index");g.state("loading_cells",true);(0,d.run_once)(30,(()=>{var n,r,i;return(n=(r=w.state("list_data"))==null?void 0:(i=r.with_extra_fields)==null?void 0:i.call(r,y.extra_fields).get_children(t,e))!=null?n:[]}),((n,r)=>{if(n){c.log((0,u.ensure_bubble_error)(n));g.state("loading_cells",false);return}if(r!=null&&r.length){const n=Math.min(r.length,e);g.state("max_index",t+n);(0,d.wait_for_updates)((()=>{g.state("loading_cells",false)}))}else{g.state("loading_cells",false)}}))}function D(t){if(g.state("loading_cells"))return;let n,r;if(e.scrollDirection!=="horizontal"){r=y.estimate_one_row();let e;if(t){e=window.innerHeight*3-v.canvas[0].getBoundingClientRect().bottom}else{e=v.canvas[0].clientHeight*3-(v.canvas[0].scrollHeight-v.canvas[0].scrollTop)}const i=g.children[0].canvas.height();n=Math.ceil(Math.max(e/i,1))+2}else{n=e.rows;let i;if(t){i=window.innerWidth*2-v.canvas[0].getBoundingClientRect().right}else{i=v.canvas[0].clientWidth*3-(v.canvas[0].scrollWidth-v.canvas[0].scrollLeft)}const s=g.children[0].canvas.width();r=Math.ceil(Math.max(i/s,1))+2}const i=n*r;S(i)}let C=()=>null;if(!r.isServer){const t=(0,i.createMemo)((()=>{if(!g.run_mode()||k().length===0||e.fixedList||e.showAllItems){return null}let t;if(e.scrollDirection!=="horizontal"){t=v.canvas[0].scrollHeight>v.canvas[0].clientHeight}else{t=v.canvas[0].scrollWidth>v.canvas[0].clientWidth}return t?"self":"root"}));C=(0,i.createMemo)((()=>{if(t()==null){return null}else if(t()==="self"){return new IntersectionObserver((e=>{if(e[0].isIntersecting){D()}}),{root:v.canvas[0],rootMargin:"100%"})}else{return new IntersectionObserver((e=>{if(e[0].isIntersecting){D(true)}}),{rootMargin:"100%"})}}))}s.onAfterMount((()=>{g.on_message("draw_till",(t=>{if(e.fixedList){return}if(g.state("max_index")>t){return}S(t+1-g.state("max_index"))}))}));const T=s.createWatcher((()=>!g.state("loading_cells")));return(0,r.createComponent)(i.For,{get each(){return O()},children:(t,n)=>(0,r.createComponent)(h.RenderElement,(0,r.mergeProps)({instance:t},(()=>{var t;return(t=e.childProps)==null?void 0:t.call(e,n)}),{get cellSizing(){return e.cellSizing},get hidden(){return n()>=k().length},get intersectionObserver(){return(0,r.memo)((()=>!!(T()&&n()===k().length-1)))()?C():null}}))})}},{"../../../lang/elements":680,"../../../logger":744,"../../../renderer/RenderElement":769,"../../../renderer/solid_utils/autorun_signals":774,"../../../u/client/b_ui":813,"../../../u/shared/async/autorun":830,"../../../u/shared/async/b_async":832,"../../../u/shared/async/dependency":834,"../../../u/shared/errors":846,"../../../u/shared/mode_check":851,"../GroupItem":242,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],263:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=a;var r=e("solid-js/web");var i=o(e("./RunRepeatingComponent"));var s=e("./utils/repeating_groups");function o(e){return e&&e.__esModule?e:{default:e}}function a(e){const t=e.instance;const n=t.repeating_group_layout;if(!n)return[];const o=()=>n.fixed_list();const a=()=>t.get_static_property("show_all_items");const l=()=>n.is_masonry();const c=()=>n.scroll_direction();const u=()=>n.columns();const d=()=>n.rows();const p=()=>n.total_number_of_cells();const _=(0,s.createIndexFns)({get rows(){return d()},get columns(){return u()},get scrollDirection(){return c()}});return(0,r.createComponent)(i.default,(0,r.mergeProps)(e,{layout:n,get fixedList(){return o()},get showAllItems(){return a()},get scrollDirection(){return c()},get rows(){return d()},get totalCells(){return p()},childProps:t=>({get hasTopBorder(){return!l()&&_().indexToRow(t())>0},get hasLeftBorder(){return!l()&&_().indexToColumn(t())>0},get firstRow(){return l()&&_().indexToRow(t())===0},get cellSizing(){return e.cellSizing},separatorStyle:e.separatorStyle,separatorWidth:e.separatorWidth,separatorColor:e.separatorColor})}))}},{"./RunRepeatingComponent":262,"./utils/repeating_groups":280,"solid-js/web":2315}],264:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=e("solid-js");var s=c(e("./utils/createElement"));var o=e("./utils/directives");var a=e("./utils/element_styles");var l=e("./utils/properties");function c(e){return e&&e.__esModule?e:{default:e}}const u=(0,r.template)(`<div class="aspect-ratio"></div>`,2),d=(0,r.template)(`<div></div>`,2);const p="aspect-ratio";const _=` .${p}`;const f=e=>(()=>{const t=d.cloneNode(true);(0,r.use)(o.defaultEventHandlers,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(i.Show,{get when(){return e.useAspectRatio},get children(){const t=u.cloneNode(true);(0,r.effect)((n=>(0,r.style)(t,e.childStyles[_],n)));return t}}));(0,r.effect)((n=>{const i=e.id,s=e.style,o=e.classList;i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t})();t.exports=(0,s.default)(f,undefined,(e=>({properties:{useAspectRatio:new l.Property((e=>e.element.has_fixed_aspect_ratio()),{fallback:false})},styles:[new l.Style((e=>{if(e.element.has_fixed_aspect_ratio()){const t=e.get_static_property("aspect_ratio_height")/e.get_static_property("aspect_ratio_width");return{height:0,"padding-top":`${t*100}%`}}else{return{}}}),{selector:_}),...(0,a.placedStyling)(e)]})))},{"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],265:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=c;var r=e("solid-js/web");var i=e("solid-js");var s=e("../utils/table_element");var o=l(e("../RunRepeatingComponent"));var a=e("../../../../lang/evaluation/element_eval");function l(e){return e&&e.__esModule?e:{default:e}}function c(e){var t;const n=e.instance.parent();const l=(0,i.useContext)(s.TableContext);if(!n||!l)return[];(t=n.canvas)==null?void 0:t.css({overflow:"auto","overflow-scrolling":"touch","-webkit-overflow-scrolling":"touch"});const c=n.table_element_layout;if(!c)return[];const u=()=>e.instance.get_static_property("fixed_number_repeating_axis");const d=()=>{var t;return(t=(0,a.evaluate_property)(e.instance,"fixed_number_repeating_axis_count"))!=null?t:0};return(0,r.createComponent)(o.default,(0,r.mergeProps)(e,{layout:c,get fixedList(){return u()},showAllItems:false,get scrollDirection(){return l.direction},rows:1,get totalCells(){return d()},dataInstance:n,childProps:t=>({get hasTopBorder(){return l.direction==="vertical"&&t()>0},get hasLeftBorder(){return l.direction==="horizontal"&&t()>0},get firstRow(){return t()===0},get cellIndex(){return t()},separatorStyle:e.separatorStyle,separatorWidth:e.separatorWidth,separatorColor:e.separatorColor})}))}},{"../../../../lang/evaluation/element_eval":690,"../RunRepeatingComponent":262,"../utils/table_element":281,"solid-js":2313,"solid-js/web":2315}],266:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=e("solid-js");var s=e("../utils/directives");var o=e("../utils/container_utils");var a=e("../utils/table_element");var l=u(e("../utils/createElement"));var c=e("../utils/element_styles");function u(e){return e&&e.__esModule?e:{default:e}}const d=(0,r.template)(`<div></div>`,2);function p(e){var t;const n=(0,i.useContext)(a.TableContext);if(n==null){return(()=>{const t=d.cloneNode(true);const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(o.ChildWrapper,e));(0,r.effect)((n=>{const i=e.id,s={...e.style},o={...e.classList,[e.containerClass]:true};i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t})()}const l=e.instance;(0,i.onMount)((()=>{n.registerTableCell(l);(0,i.onCleanup)((()=>{n.deregisterTableCell(l)}))}));const c=(0,i.createMemo)((()=>{const t=`border-${n.direction==="horizontal"?"bottom":"right"}`;return{position:"relative","box-sizing":"border-box",display:e.hidden?"none":"",[t]:n.lastMainAxis===e.mainAxisId?"none":n.mainAxesSeparator.css,"z-index":a.CELL_ZINDEX,...n.mainAxisSizingStyling(e.mainAxisId),...n.tableCellSizing(e.instance)}}));const u=(t=e.wrapper)!=null?t:e=>e.children;return(0,r.createComponent)(u,{get style(){return{...c()}},get children(){const t=d.cloneNode(true);(0,r.use)(s.defaultEventHandlers,t,(()=>l));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(o.ChildWrapper,e));(0,r.effect)((n=>{const i=e.id,s={...e.style,...l.edit_mode()?{}:{...c()}},o={...e.classList,[e.containerClass]:true};i!==n._v$4&&(0,r.setAttribute)(t,"id",n._v$4=i);n._v$5=(0,r.style)(t,s,n._v$5);n._v$6=(0,r.classList)(t,o,n._v$6);return n}),{_v$4:undefined,_v$5:undefined,_v$6:undefined});return t}})}var _=(0,l.default)(p,(e=>{var t,n;return{shouldAddWrapper:e.should_add_extra_wrapper(),mainAxisId:e.get_static_property("cell_main_axis_id"),crossAxisId:(t=(n=e.parent())==null?void 0:n.id())!=null?t:"auto"}}),((e,t)=>{let{shouldAddWrapper:n}=t;return{properties:(0,o.containerProperties)(n),styles:[...(0,o.containerStyling)(n),...(0,c.basicStyling)(e)]}}));n.default=_},{"../utils/container_utils":271,"../utils/createElement":272,"../utils/directives":273,"../utils/element_styles":274,"../utils/table_element":281,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],267:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=void 0;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("../utils/directives");var o=p(e("../utils/createElement"));var a=e("../utils/table_element");var l=e("../utils/properties");var c=p(e("./RunRepeatingTable"));var u=p(e("../../../../renderer/EditorContext"));var d=p(e("../../../../renderer/ThumbnailContext"));function p(e){return e&&e.__esModule?e:{default:e}}const _=(0,r.template)(`<div></div>`,2);function f(e){var t,n,o,l;const p=(0,i.useContext)(a.TableContext);if(p==null){return undefined}const f=e.instance;const[h,m]=(0,i.createSignal)(1);(0,i.onMount)((()=>{p.registerCrossAxis(f.element_id(),{get size(){return f[`current_${p.direction==="horizontal"?"width":"height"}`]()},get index(){return e.index},get repeating(){return e.repeating},get count(){return e.repeating?h():1},get visible(){return f.is_visible_me()}});(0,i.onCleanup)((()=>{p.deregisterCrossAxis(f.element_id())}))}));const g=(0,i.createMemo)((()=>({[`border-${p.direction==="vertical"?"bottom":"right"}`]:p.lastCrossAxis===f.element_id()&&h()===1?"none":p.crossAxesSeparator.css})));const v=(0,i.createMemo)((()=>{if(!e.stickyAxis){return{}}const t={position:"sticky",top:"0px","z-index":a.CELL_ZINDEX+1};return t}));const b=(t=e.wrapper)!=null?t:e=>e.children;const y=(n=(o=(0,i.useContext)(u.default))==null?void 0:o.editRepeatingTable)!=null?n:(l=(0,i.useContext)(d.default))==null?void 0:l.editRepeatingTable;const w=y!=null;const x=(t,n)=>{const r=(0,a.crossAxisStyling)(e.instance.element).filter((e=>t.run_mode()||n==null||e.outerPositioning===n)).map((e=>e.createClientWatcher(t,undefined,{turnedVisible:true})));return()=>Object.assign({},...r.map((e=>e())))};const j=x(e.instance,true);const A=x(e.instance,f.edit_mode()?false:undefined);return[(0,r.createComponent)(b,{get style(){return{...g(),...e.repeating?j():{},"box-sizing":"content-box"}},get children(){const t=_.cloneNode(true);(0,r.use)(s.defaultEventHandlers,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(()=>!e.repeating||w?e.children:undefined));(0,r.effect)((n=>{const i=e.id,s={position:"relative",...e.style,...!e.instance.edit_mode()&&(w||!e.repeating)?g():{},...w&&e.repeating?A():!e.instance.edit_mode()&&!e.repeating?v():{}},o={...e.classList,"bubble-cross-axis":true};i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t}}),(0,r.memo)((()=>{const t=(0,r.memo)((()=>!!e.repeating));return()=>t()?y!=null?(0,r.createComponent)(y,(0,r.mergeProps)({get dummySeparatorCss(){return p.mainAxesSeparator.css},get separatorStyle(){return p.crossAxesSeparator.style},get separatorColor(){return p.crossAxesSeparator.color},get separatorWidth(){return p.crossAxesSeparator.width},get cellSizing(){return{...j(),...A()}},setNumDummies:e=>m(e+1)},e)):(0,r.createComponent)(c.default,{get instance(){return e.instance},get separatorStyle(){return p.crossAxesSeparator.style},get separatorColor(){return p.crossAxesSeparator.color},get separatorWidth(){return p.crossAxesSeparator.width},get turnedVisible(){return e.turnedVisible},cellSizing:{}}):undefined})())]}var h=(0,o.default)(f,undefined,(e=>{const t=e.get_static_property("cross_axis_repeat");return{properties:{index:new l.Property((t=>e.get_static_property("axis_index")),{fallback:0,noWaitVisible:true}),repeating:new l.Property((e=>t),{fallback:false,noWaitVisible:true}),stickyAxis:new l.Property((t=>e.get_static_property("make_sticky")),{fallback:false})},styles:t?[]:(0,a.crossAxisStyling)(e)}}));n.default=h},{"../../../../renderer/EditorContext":766,"../../../../renderer/ThumbnailContext":771,"../utils/createElement":272,"../utils/directives":273,"../utils/properties":278,"../utils/table_element":281,"./RunRepeatingTable":265,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],268:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=void 0;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("../utils/directives");var o=m(e("../utils/createElement"));var a=e("../utils/element_styles");var l=e("../utils/properties");var c=e("../utils/table_element");var u=h(e("../../../../renderer/EditorContext"));var d=e("solid-js/store");var p=m(e("../../../../lang/appquery"));var _=e("../../../../lang/evaluation/element_eval");function f(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(f=function(e){return e?n:t})(e)}function h(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=f(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function m(e){return e&&e.__esModule?e:{default:e}}const g=(0,r.template)(`<div></div>`,2);function v(e){var t,n;const[o,a]=(0,i.createSignal)({});const[l,_]=(0,d.createStore)({});const[f,h]=(0,i.createSignal)({});const[m,v]=(0,d.createStore)({});const b=(0,i.useContext)(u.default);function y(t,n){if(t==null)return"";if(F()===n)return t;return`calc(${t} + ${e.direction==="vertical"?M.width:E.width}px)`}function w(e){const t=o()[e];if(t==null||!t.visible){return{display:"none"}}const n=P();const r=y(t.minLength,e);return{[`min-${n}`]:r,[`max-${n}`]:t.mode==="fixed"?r:y(t.maxLength,e),[n]:t.mode==="fit"?"max-content":r,"flex-grow":t.mode==="stretch"?1:0,"flex-shrink":0}}function x(){var t,n,r,i,s;if(!e.instance.edit_mode())return false;const o=(t=b==null?void 0:(n=b.state.elements[e.id])==null?void 0:n.hovered)!=null?t:false;const a=(r=b==null?void 0:b.state.descendantSelected(e.id))!=null?r:false;const l=(i=b==null?void 0:(s=b.state.elements[e.id])==null?void 0:s.descendantDraggedOver())!=null?i:false;return o||a||l}const j=(0,i.createMemo)((()=>`${e.verticalSeparatorStyle} ${e.verticalSeparatorWidth}px ${e.verticalSeparatorColor}`));const A=(0,i.createMemo)((()=>`${e.horizontalSeparatorStyle} ${e.horizontalSeparatorWidth}px ${e.horizontalSeparatorColor}`));const M={get css(){return j()},get width(){return e.verticalSeparatorWidth},get color(){return e.verticalSeparatorColor},get style(){return e.verticalSeparatorStyle}};const E={get css(){return A()},get width(){return e.horizontalSeparatorWidth},get color(){return e.horizontalSeparatorColor},get style(){return e.horizontalSeparatorStyle}};const[k,O]=(0,d.createStore)({[u.FIRST_DIVIDER]:{show:false,type:"DraggingIndicator"}});let S=false;const D=t=>{if(S)return;for(const a of Object.keys(o())){var n,r,i,s;const o=b==null?void 0:(n=b.state.elements[a].instance)==null?void 0:(r=n.canvas)==null?void 0:r[0];const l=(i=e.instance)==null?void 0:(s=i.canvas)==null?void 0:s[0];if(o===undefined||l===undefined)return;const c=b==null?void 0:b.state.descendantSelected(e.id);if(e.direction==="horizontal"){const e=o.getBoundingClientRect().bottom;const n=l.getBoundingClientRect().left-40;if(c&&t.clientX>n&&t.clientY>e-10&&t.clientY<e+10){O({[a]:{show:true,type:"AddDivider"}})}else{O({[a]:{show:false,type:"AddDivider"}})}}else{const e=o.getBoundingClientRect().right;const n=l.getBoundingClientRect().top-40;if(c&&t.clientY>n&&t.clientX>e-10&&t.clientX<e+10){O({[a]:{show:true,type:"AddDivider"}})}else{O({[a]:{show:false,type:"AddDivider"}})}}}};(0,i.onMount)((()=>{if(e.instance.edit_mode()){document.addEventListener("mousemove",D);(0,i.onCleanup)((()=>{document.removeEventListener("mousemove",D)}))}}));const C=(t=(0,i.useContext)(u.default))==null?void 0:t.tableMainAxisDividers;const T=(n=(0,i.useContext)(u.default))==null?void 0:n.tableIndexMarkers;let N=[];function P(){return e.direction==="horizontal"?"height":"width"}const I=new Map;function R(e){const t=P();const n={};for(const[r,i]of I.entries()){if(e==null||e.has(i)){const e=r.getBoundingClientRect()[t];if(n[i]==null||Math.floor(n[i].max*100)<e*100){n[i]={max:e,cell:r}}}}for(const[e,t]of Object.entries(n)){_(e,t.max);v(e,t.cell)}}const L=new ResizeObserver((e=>{const t=P();const n=new Set;(0,i.batch)((()=>{for(const i of e){const e=I.get(i.target);if(e==null)return;const s=i.target.getBoundingClientRect()[t];const a=o()[e];if((a==null?void 0:a.mode)==="fit"){var r;const t=(r=l[e])!=null?r:0;if(i.target===m[e]||Math.floor(s*100)>t*100){_(e,s);v(e,i.target);if(s<t){n.add(e)}}}else if(i.target.offsetParent!=null){_(e,s);v(e,i.target)}}}));if(n.size>0){R(n)}}));if(e.instance.edit_mode()){(0,i.createEffect)((()=>{const e=P();Object.keys(o()).forEach((t=>{const n=p.default.element(t);n.get_static_property(`fit_${e}`)}));R()}))}const[z,B]=(0,d.createStore)({});const q=(0,i.createMemo)((()=>Object.entries(o()).sort(((e,t)=>e[1].index-t[1].index))));const U=(0,i.createMemo)((()=>Object.entries(f()).sort(((e,t)=>e[1].index-t[1].index))));const F=(0,i.createMemo)((()=>{const e=q();for(let t=e.length-1;t>=0;t--){const[n,r]=e[t];if(r.visible){return n}}return undefined}));const W=(0,i.createMemo)((()=>{const e=U();for(let t=e.length-1;t>=0;t--){const[n,r]=e[t];if(r.visible&&r.count>0){return n}}return undefined}));return(0,r.createComponent)(c.TableContext.Provider,{value:{get direction(){return e.direction},get shouldShowDivider(){return k},setShouldShowDivider:O,registerMainAxis(t,n){a((e=>({...e,[t]:n})));return()=>{var r;const i=e.direction==="vertical"?e.verticalSeparatorWidth:e.horizontalSeparatorWidth;const s=Object.entries(o()).filter((e=>{let[,t]=e;return t.index<n.index})).reduce(((e,t)=>{var n;let[r]=t;return e+((n=l[r])!=null?n:i)}),0);const a=((r=l[t])!=null?r:i)-(t!==F()?i:0);if(e.direction==="horizontal"){return{top:`${s+e.paddingTop}px`,height:`${a}px`,width:`calc(100% - ${e.paddingLeft+e.paddingRight}px)`}}else{return{left:`${s+e.paddingLeft}px`,width:`${a}px`,height:`calc(100% - ${e.paddingTop+e.paddingBottom}px)`}}}},deregisterMainAxis(e){a((t=>Object.fromEntries(Object.entries(t).filter((t=>t[0]!==e)))))},get mainAxes(){return o()},registerTableCell(e){const t=e.get_outer_canvas()[0];const n=e.get_static_property("cell_main_axis_id");I.set(t,n);L.observe(t,{box:"border-box"});if(T!=null){B(n,{[e.element_id()]:e})}},deregisterTableCell(e){const t=e.get_outer_canvas()[0];L.unobserve(t);I.delete(t);B(e.get_static_property("cell_main_axis_id"),{[e.element_id()]:undefined})},tableCellSizing(e){var t;const n=e.get_static_property("cell_main_axis_id");const r=e.get_outer_canvas();if(((t=o()[n])==null?void 0:t.mode)!=="fit"||r!=null&&m[n]===r[0]||l[n]==null){return{}}return{[`min-${P()}`]:`max(${y(o()[n].minLength,n)}, ${l[n]}px)`}},registerCrossAxis(e,t){h((n=>({...n,[e]:t})))},setMainAxisDragging(e){S=e},deregisterCrossAxis(e){h((t=>Object.fromEntries(Object.entries(t).filter((t=>{let[n]=t;return n!==e})))))},mainAxisSizingStyling:w,get mainAxesSeparator(){return e.direction==="vertical"?M:E},get crossAxesSeparator(){return e.direction==="vertical"?E:M},get lastMainAxis(){return F()},get lastCrossAxis(){return W()}},get children(){const t=g.cloneNode(true);t.$$mousemove=t=>{if(e.instance.run_mode()){const e=document.elementsFromPoint(t.clientX,t.clientY).filter((e=>e.classList.contains("TableMainAxis")));for(const t of N){if(!e.includes(t)){$(t).mouseleave()}}for(const t of e){if(!N.includes(t)){$(t).mouseenter()}}N=e}};(0,r.use)(s.defaultEventHandlers,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.insert)(t,(0,r.createComponent)(i.Show,{get when(){return x()},get children(){return T!==undefined&&(0,r.createComponent)(T,{mainAxesSizes:l,mainAxesCells:z,get sortedMainAxes(){return q()},get sortedCrossAxes(){return U()},get tableInstance(){return e.instance}})}}),null);(0,r.insert)(t,(()=>{const t=(0,r.memo)((()=>!!(e.instance.edit_mode()&&C!==undefined)));return()=>t()&&(0,r.createComponent)(C,{id:u.FIRST_DIVIDER,get tableElement(){return e.instance.element},get placementStyling(){return{position:"absolute",left:"0px",top:"0px",[e.direction==="horizontal"?"width":"height"]:"100%"}}})})(),null);(0,r.insert)(t,(()=>e.children),null);(0,r.effect)((n=>{const i=e.id,s=e.style,o={...e.classList,"bubble-table":true};i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t}})}var b=(0,o.default)(v,undefined,(e=>({properties:{direction:new l.Property((e=>e.get_static_property("table_direction")),{fallback:"vertical"}),verticalSeparatorStyle:new l.Property((e=>e.get_static_property("vertical_separator_style")),{fallback:"none"}),verticalSeparatorWidth:new l.Property((e=>e.get_static_property("vertical_separator_width")),{fallback:0}),verticalSeparatorColor:new l.Property((e=>e.get_static_property("vertical_separator_color")),{fallback:"black"}),horizontalSeparatorStyle:new l.Property((e=>e.get_static_property("horizontal_separator_style")),{fallback:"none"}),horizontalSeparatorWidth:new l.Property((e=>e.get_static_property("horizontal_separator_width")),{fallback:0}),horizontalSeparatorColor:new l.Property((e=>e.get_static_property("horizontal_separator_color")),{fallback:"black"}),paddingLeft:new l.Property((e=>(0,_.evaluate_property)(e,"padding_left")),{fallback:0}),paddingRight:new l.Property((e=>(0,_.evaluate_property)(e,"padding_right")),{fallback:0}),paddingTop:new l.Property((e=>(0,_.evaluate_property)(e,"padding_top")),{fallback:0}),paddingBottom:new l.Property((e=>(0,_.evaluate_property)(e,"padding_bottom")),{fallback:0})},styles:[...(0,a.placedStyling)(e),new l.Style((t=>({"flex-direction":(0,c.isTableDirectionHorizontal)(e)?"row":"column"})))]})));n.default=b;(0,r.delegateEvents)(["mousemove"])},{"../../../../lang/appquery":651,"../../../../lang/evaluation/element_eval":690,"../../../../renderer/EditorContext":766,"../utils/createElement":272,"../utils/directives":273,"../utils/element_styles":274,"../utils/properties":278,"../utils/table_element":281,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/store":2314,"solid-js/web":2315}],269:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=e("solid-js");var s=e("../utils/table_element");var o=e("../utils/directives");var a=_(e("../utils/createElement"));var l=e("../utils/element_styles");var c=e("../utils/properties");var u=e("../../../../lang/evaluation/element_eval");var d=_(e("../../../../renderer/EditorContext"));var p=e("../../../../renderer/solid_utils/autorun_signals");function _(e){return e&&e.__esModule?e:{default:e}}const f=(0,r.template)(`<div></div>`,2);function h(e){var t,n;const a=(0,i.useContext)(s.TableContext);if(a==null){return undefined}const l=e.instance;const c=(0,p.createWatcher)((()=>l.is_visible_me()),{fallback:true});const u=a.registerMainAxis(l.element_id(),{get index(){return e.index},get minLength(){return e.minLength},get maxLength(){return e.maxLength},get mode(){return e.mode},get visible(){return c()}});(0,i.onCleanup)((()=>{a.deregisterMainAxis(l.element_id())}));const _=(0,i.createMemo)((()=>({"z-index":s.MAIN_AXIS_ZINDEX,position:"absolute",display:c()?"":"none",...u()})));const h=(t=e.wrapper)!=null?t:e=>e.children;const m=(n=(0,i.useContext)(d.default))==null?void 0:n.tableMainAxisDividers;const g=m!==undefined?(0,r.createComponent)(m,{get tableElement(){return l.element.parent()},get id(){return e.id},get placementStyling(){return _()}}):[];return[(0,r.createComponent)(h,{get style(){return{..._()}},get children(){const t=f.cloneNode(true);(0,r.use)(o.defaultEventHandlers,t,(()=>e.instance));const n=e.ref;typeof n==="function"?(0,r.use)(n,t):e.ref=t;(0,r.effect)((n=>{const i=e.id,s={...e.style,...l.edit_mode()?{}:_()},o=e.classList;i!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=i);n._v$2=(0,r.style)(t,s,n._v$2);n._v$3=(0,r.classList)(t,o,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t}}),g]}var m=(0,a.default)(h,undefined,(e=>{const t=()=>(0,s.isTableDirectionHorizontal)(e.parent())?"height":"width";return{properties:{minLength:new c.Property((e=>{const n=t()==="height"?"min_height_css":"min_width_css";return(0,u.evaluate_property)(e,n)}),{fallback:"0px"}),maxLength:new c.Property((e=>{var n;const r=t()==="height"?"max_height_css":"max_width_css";return(n=(0,u.evaluate_property)(e,r))!=null?n:null}),{fallback:null}),mode:new c.Property((n=>{if(e.get_static_property(`single_${t()}`)){return"fixed"}else if(e.get_static_property(`fit_${t()}`)){return"fit"}else{return"stretch"}}),{fallback:"fixed",noWaitVisible:true}),index:new c.Property((e=>(0,u.evaluate_property)(e,"axis_index")),{fallback:0,noWaitVisible:true})},styles:[...(0,l.basicStyling)(e)]}}));n.default=m},{"../../../../lang/evaluation/element_eval":690,"../../../../renderer/EditorContext":766,"../../../../renderer/solid_utils/autorun_signals":774,"../utils/createElement":272,"../utils/directives":273,"../utils/element_styles":274,"../utils/properties":278,"../utils/table_element":281,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],270:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");const i=e("../../../lang/appquery");const s=e("../../../u/client/b_ui");const o=e("../shared/text_elements");const{createEffect:a,onCleanup:l,onMount:c}=e("solid-js");const u=e("../../../renderer/solid_utils/ServerHTML");const{createElement:d}=e("./utils/createElement");const p=e("./utils/element_styles");const{defaultEventHandlers:_}=e("./utils/directives");const{Property:f,Style:h}=e("./utils/properties");const{Dynamic:m,isServer:g}=e("solid-js/web");const v=e("../../../lang/evaluation/element_eval");const b=e("../../../client/internal_navigation");function y(e){const t=i.get_public_setting("bubble_version")>=10;const n=e.get_static_property("recognize_links");const r=e.get_static_property("no_bbcode");const a={};for(const t of["text","editor_preview_text","link_color","nofollow"]){a[t]=v.evaluate_property(e,t)}let l;if(e.run_mode()||!a.editor_preview_text||!a.text||e.element.property("text").is_static()){l=a.text}else{l=a.editor_preview_text}if(r){if(n&&!s.has_bbcode(l)){return{html:s.bbcode_to_html(o.replace_links_emails(e,a),t)}}else{return{text:l,cssStyle:{"white-space":"pre-wrap"}}}}else{let r=l;if(n){r=o.replace_links_emails(e,a)}return{html:s.bbcode_to_html(r,t)}}}function w(e){var t;const n=e.instance;a((()=>{if(e.useDotDotDot){o.apply_dotdotdot(n,n.edit_mode()?"letter":"words");l((()=>o.remove_dotdotdot(n)))}}));const i=()=>{if(e.verticalCenter||n.run_mode()&&e.useDotDotDot){return`<div>${e.textData.html}</div>`}else{return e.textData.html}};a((()=>{if(e.textData.html!=null){n.canvas.html(i());b.add_internal_navigation_handlers(n.canvas[0])}else if(n.run_mode()&&e.useDotDotDot){const t=document.createElement("div");t.innerText=e.textData.text;n.canvas.html(t.outerHTML)}else{n.canvas.text(e.textData.text)}}));const s=n.edit_mode()?"div":(t=e.tagName)!=null?t:null;c((()=>{_(n.canvas[0],(()=>n))}));const d=()=>({...e.classList,"bubble-r-vertical-center":e.verticalCenter});if(!g){return(0,r.createComponent)(m,{get id(){return e.id},component:s,ref(t){const n=e.ref;typeof n==="function"?n(t):e.ref=t},get style(){return{...e.style,...e.textData.cssStyle}},get classList(){return d()}})}else{return(0,r.createComponent)(m,{get id(){return e.id},component:s,get style(){return{...e.style,...e.textData.cssStyle}},get classList(){return d()},get children(){return(0,r.memo)((()=>!!e.textData.html))()?(0,r.createComponent)(u,{get html(){return i()}}):e.textData.text}})}}t.exports=d(w,(e=>{const t=e.get_styleable_static_property("tag_type");return{tagName:t==="normal"||!i.get_public_setting("expose_text_tags")||t==null?"div":t}}),(e=>({properties:{textData:new f(y,{fallback:{text:""}}),useDotDotDot:new f(o.could_clip),verticalCenter:new f((e=>v.evaluate_property(e,"vertical_centering")))},styles:[new h((e=>({"white-space":i.get_public_setting("bubble_version")>=10?"pre-wrap":"",overflow:e.edit_mode()?"hidden":"visible"}))),...p.placedStyling(e)]})))},{"../../../client/internal_navigation":26,"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../renderer/solid_utils/ServerHTML":773,"../../../u/client/b_ui":813,"../shared/text_elements":373,"./utils/createElement":272,"./utils/directives":273,"./utils/element_styles":274,"./utils/properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],271:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ChildWrapper=d;n.containerProperties=u;n.containerStyling=c;var r=e("solid-js/web");var i=e("../../../../renderer/solid_utils/perf_tools");var s=e("./properties");const o=(0,r.template)(`<div></div>`,2);const a="bubble-r-container";const l=`> .${a}`;function c(e){return[new s.Style((e=>{var t;return(t=e.child_container)==null?void 0:t.get_container_props()}),{selector:e?l:undefined})]}function u(e){if(e){return{containerClass:new s.Property((e=>"bubble-r-container-wrapper"),{noWaitVisible:true,fallback:""}),wrappedClass:new s.Property((e=>`${a} ${e.child_container.layout().classes}`),{noWaitVisible:true})}}else{return{containerClass:new s.Property((e=>{var t;return`${a} ${(t=e.child_container)==null?void 0:t.layout().classes}`}),{noWaitVisible:true,fallback:""})}}}function d(e){return(0,r.createComponent)(i.OptimizedShow,{get when(){return e.shouldAddWrapper},get fallback(){return e.children},get isStatic(){return e.instance.run_mode()},get children(){const t=o.cloneNode(true);(0,r.insert)(t,(()=>e.children));(0,r.effect)((n=>{var i;const s={[(i=e.wrappedClass)!=null?i:""]:true},o=e.childStyles[l];n._v$=(0,r.classList)(t,s,n._v$);n._v$2=(0,r.style)(t,o,n._v$2);return n}),{_v$:undefined,_v$2:undefined});return t}})}},{"../../../../renderer/solid_utils/perf_tools":775,"./properties":278,"solid-js/web":2315}],272:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.createElement=v;n.default=void 0;var r=e("solid-js/web");e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=m(e("../../../../shared/server_rendering/server_css"));var o=e("./properties");var a=e("../../../../lang/evaluation/element_eval");var l=e("../../../../u/shared/errors");var c=f(e("../../../../renderer/BodyPortal"));var u=f(e("../../../../renderer/EditorContext"));var d=e("./element_utils");var p=f(e("../../../../lang/appquery"));var _=e("../../../../u/shared/async/autorun");function f(e){return e&&e.__esModule?e:{default:e}}function h(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(h=function(e){return e?n:t})(e)}function m(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=h(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const g=new o.Property((e=>{if(e.edit_mode()){return e.element_id().replace(/[^a-zA-Z0-9]/g,"_")}if(e.run_mode()&&p.default.has_advanced_feature_enabled("expose_id_option")){return(0,a.evaluate_property)(e,"unique_id")}return undefined}),{noWaitVisible:true});function v(e,t,n){return{buildComponent:(o,p)=>{var f;const h=(f=p==null?void 0:p.preCached)!=null?f:t==null?void 0:t(o);const m=n(o,h);const v={...m.properties,id:g};const b=m.styles;const y={};const w={};const x={};const j=[];const A={};for(const e in v){if(p!=null&&p.statics[e]){y[e]=v[e].computeStaticClient(p.props[e])}else{j.push(e)}}b.forEach(((e,t)=>{if(p==null||p.styles[t]!=null){A[t]=e}if(e.notInStylesheet&&(p==null?void 0:p.styles[t])!=null){if(e.selector){var n,r;Object.assign((r=x[n=e.selector])!=null?r:x[n]={},p.styles[t])}else{Object.assign(w,p.styles[t])}}}));return t=>{const n=t.instance;const f=(0,d.createVisibilityLatch)(n);const m={get turnedVisible(){return f()}};const g={};function b(e,t){Object.defineProperty(g,e,{get:t})}for(const e of j){const t=v[e].createClientWatcher(n,p==null?void 0:p.props[e],m);b(e,t)}const M={};const E=[];const k=[];for(const e in A){const t=A[e];const r=t.createClientWatcher(n,p==null?void 0:p.styles[e],m);if(t.selector){var O,S;(S=M[O=t.selector])!=null?S:M[O]=[];M[t.selector].push(r)}else{if(t.outerPositioning){if(n.edit_mode()){k.push(r)}else if(!n.thumbnail_mode()||n.parent()!=null){E.push(r)}}else{E.push(r)}}}const D=()=>Object.assign({},w,...E.map((e=>e())));const C={};for(const e in M){Object.defineProperty(C,e,{get:()=>Object.assign({},x[e],...M[e].map((e=>e())))})}const T=n.element.get_property_applications().filter((e=>e.no_solid_support));if(T.length>0){(0,i.onMount)((()=>{for(const e of T){let t;if(n.element.E.additional_uses_properties){t=e.uses_properties.concat(n.element.E.additional_uses_properties)}else{t=e.uses_properties}let r=true;(0,a.on_property_change)(n,t,(t=>{e.apply(Object.assign(t,{_first_time:r}),n.canvas,n);r=false}))}}))}(0,i.onMount)((()=>{n.mark_drawn();if(!n.element.draws_own_children()){n.get_children_drawn_key().turn()}}));function N(i,s){return(0,r.createComponent)(e,(0,r.mergeProps)(h,y,m,g,t,{ref(e){const t=(0,d.createCanvasRef)(n);typeof t==="function"&&t(e)},classList:i,get style(){return D()},childStyles:C,wrapper:s,get children(){return n.element.type()==="CustomElement"&&n.is_self_nested_custom()?"This is a circular Reusable Element... Reusable Elements cannot contain themselves (or other Reusable Elements that contain them).":t.children}}))}if(n.edit_mode()){const e={"inner-element":true};const t=(0,i.children)((()=>{var t;if(n.destroy_started())return null;const s=(0,i.createMemo)((()=>Object.assign({},...k.map((e=>e())))));const o=(t=(0,i.useContext)(u.default))==null?void 0:t.wrapper;if(o==null)throw new l.UnexpectedError("Edit-mode should define the context");if(n.element.E.manual_wrapper){return(0,_.autorun_top)((()=>N(e,(e=>(0,r.createComponent)(o,{instance:n,get style(){return{...s(),...e.style}},get children(){return e.children}})))))}else{return(0,r.createComponent)(o,{instance:n,get style(){return s()},get children(){return(0,_.autorun_top)((()=>N(e)))}})}}));return(0,r.createComponent)(i.Show,{get when(){return n.attach_to_body()},get fallback(){return t()},get children(){return(0,r.createComponent)(c.default,{get children(){return t()}})}})}else{const e={"bubble-element":true,[o.type()]:true,[s.toClass(o.ssr_key())]:true};if(n.attach_to_body()&&!n.thumbnail_mode()){return(0,r.createComponent)(c.default,{get children(){return N(e)}})}return N(e)}}}}}var b=v;n.default=b},{"../../../../lang/appquery":651,"../../../../lang/evaluation/element_eval":690,"../../../../renderer/BodyPortal":765,"../../../../renderer/EditorContext":766,"../../../../shared/server_rendering/server_css":807,"../../../../u/shared/async/autorun":830,"../../../../u/shared/errors":846,"./element_utils":275,"./properties":278,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],273:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.defaultEventHandlers=g;n.enterHandler=b;n.inputChangeKeyupHandlers=v;n.jqueryHTML=y;e("core-js/modules/web.dom-collections.iterator.js");var r=m(e("../../../../u/client/b_window"));var i=m(e("../../../../u/client/b_ui"));var s=m(e("../../../../u/shared/mode_check"));var o=f(e("lodash/debounce"));var a=m(e("../../../../renderer/solid_utils/autorun_signals"));var l=e("solid-js");var c=m(e("../../../../constants/runmode"));var u=f(e("../../../../lib"));var d=f(e("../../core_elements_utilities/element_workflows"));var p=m(e("../../../../logger"));var _=e("../../shared/hover_state_manager");function f(e){return e&&e.__esModule?e:{default:e}}function h(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(h=function(e){return e?n:t})(e)}function m(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=h(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function g(e,t){const n=t();const i=$(e);if(n.run_mode()&&!n.element.E.dont_add_hover_pressed){if(!r.is_on_mobile_or_tablet()){n.state("is_hovered",_.setup_hover,true);i.mousedown((()=>{n.state("is_pressed",true);$(document).one("mouseup",(()=>{n.state("is_pressed",false)}))}))}else{i.on("touchstart",(()=>{n.state("is_pressed",true);$(document).one("touchend",(()=>{const e=n.setTimeout((()=>{n.state("is_pressed",false)}),100);$(document).one("scroll",(()=>{n.state("is_pressed",false);n.clearTimeout(e)}))}))}))}}const s=n.run_mode()&&n.element.get_related_workflows("ButtonClicked").length;if(s&&n.element.E.change_cursor_style_if_clickable){i.addClass(c.CLICKABLE_ELEMENT)}if(s){i.focus((()=>{i.addClass("show-outline")}));i.blur((()=>{i.removeClass("show-outline")}));if(!n.element.E.specific_click_handler){i.click((e=>{const t=(0,u.default)().workflow.debugger;let r=false;if(t){r=t.element_clicked(n,n.get_partial())}if(!r){d.default.run_element_workflow(n,"ButtonClicked",e)}}))}}}function v(e,t){const[n,r]=t();const i=$(e);if(s.on_phonegap()){i.css("-webkit-user-select","text")}let a=null;let l=false;const c=()=>{l=true;if(a){n.clearTimeout(a)}let e;if(n.get_static_property("content_format")==="geographic_address"){e=3e3}else{const t=n.canvas.val();if(!t||t.length===1){e=0}else{e=1500}}a=n.setTimeout((function(){n.message("user_change",r());a=null}),e);return true};i.on("input",c);i.on("paste",c);const u=n.get_static_property("content_format");const d=n.get_static_property("show_thousands");const p=n.get_static_property("decimal_place");const _=(u==="int_number"||u==="float_number")&&(d||p);let f="";if(_){i.on("keyup",(function(e){const t=e.key==="Backspace";const n=f[0]==="-";f=i.val();const r=i[0].selectionStart===0&&i[0].selectionEnd===0;if(t&&r&&n){return c()}}))}i.on("keydown",(e=>{const t=13;const n=i.hasClass("MultiLineInput");if(e.keyCode!==t||n){return}i.blur()}));const h=function(){n.message("user_submit",r())};i.focus((()=>{n.state("is_focused",true)}));const m=(0,o.default)(h,50);i.blur((()=>{n.state("is_focused",false);if(l){l=false;h()}m.flush();if(a!=null){n.message("user_change",r());n.clearTimeout(a);a=null}}));i.change((()=>{if(s.running_test()){return h()}return m()}))}function b(e,t){const n=$(e);const r=t()[0];const s=a.createWatcher((()=>{var e,t,n;let i=null;const s=(e=(t=(n=r.element).get_visible_workflows)==null?void 0:t.call(n))!=null?e:[];const o=r.element_id();for(const e of s){var a;if(e.find_expressions(`GetElement.element_id=${o}`).length<1){continue}const t=r.find_instance_by_id((a=e.element_id)==null?void 0:a.call(e));if(t!=null&&t.is_visible()){var l;(l=i)!=null?l:i=t;if(t!==i){i=null;break}}}return i}));(0,l.createEffect)((()=>{if(s()){n.on("keydown.click_the_button",(e=>{if(e.shiftKey){return}if(t()[1]&&!i.meta(e)){return}const r=13;if(e.keyCode===r){if(!n.hasClass("MultiLineInput")){n.blur()}const e=s().canvas;if(e.is(":visible")){i.trigger_blur(n);e.click()}}}));(0,l.onCleanup)((()=>{n.off("keydown.click_the_button")}))}}))}function UNMANGLED_html_wrap(e){return e()}function y(e,t){const n=$(e);(0,l.createEffect)((e=>{const r=t();if(!l.sharedConfig.context&&e!==r){try{UNMANGLED_html_wrap((()=>{n.html(r)}))}catch(e){p.owner_only_error("html bug",{display:"Bug in custom html:\n"+e.stack,prop_name:"html",element:n[0].outerHTML})}}return r}),undefined)}},{"../../../../constants/runmode":83,"../../../../lib":741,"../../../../logger":744,"../../../../renderer/solid_utils/autorun_signals":774,"../../../../u/client/b_ui":813,"../../../../u/client/b_window":814,"../../../../u/shared/mode_check":851,"../../core_elements_utilities/element_workflows":288,"../../shared/hover_state_manager":361,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/debounce":1311,"solid-js":2313}],274:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.basicStyling=y;n.clickabilityStyles=b;n.placedStyling=x;n.positioningStyle=w;n.propertyApplicationStyles=g;n.tokenStyling=j;n.transitionStyles=v;n.visibilityStyles=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("./jquery_wrapper");var i=f(e("../../../../logger"));var s=e("./properties");var o=e("../../../../lang/evaluation/element_eval");var a=e("../../../../lang/font_tokens");var l=e("../../../../lang/color_tokens");var c=e("../../../../constants/server_rendering");var u=p(e("../../../../lib"));var d=e("solid-js/web");function p(e){return e&&e.__esModule?e:{default:e}}function _(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(_=function(e){return e?n:t})(e)}function f(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=_(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const h=[new s.Style((e=>!e.is_visible_me()&&!(e.is_animating()&&e._is_animating_me)?{visibility:"hidden"}:{}),{alwaysDynamic:true,noWaitVisible:true})];n.visibilityStyles=h;function m(e){return new s.Style((t=>{const n=(0,r.withMockCanvas)((n=>{if(e.apply_once){e.apply_directly({},n)}else{let r;if(t.element.E.additional_uses_properties){r=e.uses_properties.concat(t.element.E.additional_uses_properties)}else{r=e.uses_properties}const i={};for(const e of r){i[e]=(0,o.evaluate_property)(t,e)}i._first_time=true;e.apply_directly(i,n,t)}}));return n.style}),{selector:e.sel_fn!=null?` ${String(e.sel_fn)}`:undefined})}function g(e){return e.get_property_applications().filter((e=>!e.no_solid_support)).map((e=>m(e)))}function v(e){const t={};if(u.default.or_throw().is_edit_mode())return[];for(const n of e.get_property_applications()){if(n.sel_fn){if(typeof n.sel_fn==="function"){i.error("Property applications no longer support functions as selectors",{class_name:n.class_name})}else{t[n.sel_fn]=true}}}const n=e=>t=>{const n=[];for(const r of t.element.get_property_applications()){if(Boolean(e)&&r.sel_fn===e||!e&&!r.sel_fn){n.push(r.get_transition_styling(t.element))}}if(!e){n.push(t.get_transition_styling())}const r=n.filter((e=>!!e)).join(", ");return{"-webkit-transition":r,"-moz-transition":r,"-o-transition":r,"-ms-transition":r,transition:r}};return[new s.Style(n(undefined),{noWaitVisible:true}),...Object.keys(t).map((e=>new s.Style(n(e),{selector:e,noWaitVisible:true})))]}function b(e){if(!u.default.or_throw().is_edit_mode()&&e.E.change_cursor_style_if_clickable&&e.get_related_workflows("ButtonClicked").length){return[new s.Style((e=>({cursor:(0,o.evaluate_property)(e,"button_disabled")?"default":"pointer"})))]}else{return[]}}function y(e){return[...h,...g(e),...v(e),...b(e)]}function w(e){return[new s.Style((t=>{const n=t.container.element_css(t);const i={};for(const e in n){i[(0,r.convertStyle)(e)]=n[e]}if(e){var s,o;if(t.run_mode()&&!t.state("flickered")&&(d.isServer||((s=window)==null?void 0:(o=s.BrowserDetect)==null?void 0:o.browser)==="Safari")){queueMicrotask((()=>t.state("flickered",true)));return{...i,height:"0px"}}}return i}),{noWaitVisible:true,outerPositioning:true,alwaysDynamic:e}),new s.Style((e=>{var t;return{"z-index":(t=e.element.get_zindex())!=null?t:undefined}}),{noWaitVisible:true,outerPositioning:true}),new s.Style((e=>e.get_static_property("collapse_when_hidden")&&e.container.should_collapse(e)?{display:"none"}:{}),{alwaysDynamic:true,noWaitVisible:true,notInStylesheet:true,outerPositioning:true})]}function x(e){return[...y(e),...w(e.can_have_children()&&e.should_add_extra_wrapper())]}function j(){return new s.Style((()=>({...(0,a.default_font_tokens_to_property)(),...(0,a.user_font_tokens_to_property)(),...(0,l.default_color_tokens_to_property)(),...(0,l.user_color_tokens_to_property)()})),{noWaitVisible:true,selector:c.AT_ROOT})}},{"../../../../constants/server_rendering":86,"../../../../lang/color_tokens":657,"../../../../lang/evaluation/element_eval":690,"../../../../lang/font_tokens":713,"../../../../lib":741,"../../../../logger":744,"./jquery_wrapper":277,"./properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js/web":2315}],275:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.createCanvasRef=a;n.createVisibilityLatch=o;e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js");var i=s(e("../../core_elements_utilities/element_transformer"));function s(e){return e&&e.__esModule?e:{default:e}}function o(e){const[t,n]=(0,r.createSignal)(false);(0,r.onMount)((()=>{e.wait_for_visible_lite((()=>n(true)))}));return t}function a(e){return t=>{if(t!=null){e.canvas=$(t);e.setup_canvas_hooks();e._observe_canvas();if(e.run_mode()){i.default.run_transformers(e)}}}}},{"../../core_elements_utilities/element_transformer":285,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],276:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.createInputChange=i;var r=e("solid-js");function i(e,t){(0,r.onMount)((()=>{const n=e.autorun((()=>{if(!e.state("has_been_changed")){t(e.state("value"))}}));(0,r.onCleanup)((()=>{n.destroy()}))}))}},{"solid-js":2313}],277:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.convertStyle=r;n.withMockCanvas=o;e("core-js/modules/es.string.replace.js");function r(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}function i(){const e={};const t=Object.assign([{style:{},className:""}],{css(e,t){if(typeof e==="object")Object.assign(this[0].style,e);else this[0].style[e]=t},data(t,n){if(arguments.length>1){e[t]=n}return e[t]},width(){return 0},find(){return this},addClass(e){this[0].className+=" "+e},removeClass(e){this[0].className=this[0].className.replace(e.trim(),"")},attr(){}});return t}function s(e){const t=e[0].style;const n={};for(const e in t){n[r(e)]=t[e]}return n}function o(e){const t=i();e(t);return{style:s(t),className:t[0].className.trim()}}},{"core-js/modules/es.string.replace.js":1121}],278:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Style=n.Property=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js");var i=c(e("../../../../u/shared/async/autorun"));var s=c(e("../../../../shared/server_rendering/server_css"));var o=c(e("../../../../u/client/b_ui"));var a=e("../../../../logger");function l(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(l=function(e){return e?n:t})(e)}function c(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=l(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}class u{constructor(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.fn=void 0;this.fallback=void 0;this.alwaysDynamic=void 0;this.mayContainDynamic=void 0;this.noWaitVisible=void 0;this.fn=e;this.fallback=t.fallback;this.alwaysDynamic=t.alwaysDynamic;this.mayContainDynamic=t.mayContainDynamic;this.noWaitVisible=t.noWaitVisible}computeCache(e){e.dynamic_catcher=false;try{const t=this.fn(e);const n=!e.dynamic_catcher&&!this.alwaysDynamic;if(this.mayContainDynamic&&!n){return{value:undefined,isStatic:false}}return{value:t,isStatic:!e.dynamic_catcher&&!this.alwaysDynamic}}catch(e){(0,a.propagated_error)("Error computing property",e);return{value:undefined,isStatic:false}}}createClientWatcher(e,t,n){const[s,o]=(0,r.createSignal)(t!=null?t:this.fallback);(0,r.createEffect)((()=>{if(!this.noWaitVisible&&!n.turnedVisible)return;const t=i.Watcher((()=>{var t;return(t=this.fn(e))!=null?t:this.fallback}));t.on_value(o);(0,r.onCleanup)((()=>t.destroy()))}));return s}computeStaticClient(e){return e!=null?e:this.fallback}}n.Property=u;function d(e){const t={};for(const n in e){const r=e[n];if(Array.isArray(r)){t[n]=o.apply_css_fallbacks(s.toDashes(n),r.map((e=>s.fixValue(n,e))))}else{t[n]=s.fixValue(n,r)}}return t}class p extends u{constructor(e){var t;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};super(e,{fallback:{},alwaysDynamic:n.alwaysDynamic,noWaitVisible:n.noWaitVisible});this.selector=void 0;this.notInStylesheet=void 0;this.outerPositioning=void 0;this.fn=e;this.selector=n.selector;this.notInStylesheet=n.notInStylesheet;this.outerPositioning=(t=n.outerPositioning)!=null?t:false}createClientWatcher(e,t,n){const r=super.createClientWatcher(e,t,n);return()=>{const e=r();const n=d(e);const i=n;if(this.notInStylesheet){for(const e in t){const t=n[e];if(t==null||t===""){i[e]=undefined}}}else{for(const e in t){const r=n[e];if(r==null||r===""){i[e]="unset"}else{const n=t[e];if(Array.isArray(n)){if(n.includes(r)){i[e]=undefined}}else{if(n===r){i[e]=undefined}}}}}return n}}computeStaticClient(){return{}}}n.Style=p},{"../../../../logger":744,"../../../../shared/server_rendering/server_css":807,"../../../../u/client/b_ui":813,"../../../../u/shared/async/autorun":830,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],279:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.createBorderStyle=l;var r=e("solid-js");var i=o(e("../../../../languages"));var s=o(e("../../../../lib"));function o(e){return e&&e.__esModule?e:{default:e}}function a(){return i.default.is_rtl(s.default.or_throw().app_language())}function l(e){return(0,r.createMemo)((()=>{const t={};if(e.hasTopBorder){t["border-top-width"]=`${e.separatorWidth}px`;t["border-top-color"]=e.separatorColor;t["border-top-style"]=e.separatorStyle;if(e.includeMargin){t["margin-top"]=`${-e.separatorWidth}px`}}if(e.hasLeftBorder){if(a()){t["border-right-width"]=`${e.separatorWidth}px`;t["border-right-color"]=e.separatorColor;t["border-right-style"]=e.separatorStyle;if(e.includeMargin){t["margin-right"]=`${-e.separatorWidth}px`}}else{t["border-left-width"]=`${e.separatorWidth}px`;t["border-left-color"]=e.separatorColor;t["border-left-style"]=e.separatorStyle;if(e.includeMargin){t["margin-left"]=`${-e.separatorWidth}px`}}}if(e.hasBottomBorder){t["border-bottom-width"]=`${e.separatorWidth}px`;t["border-bottom-color"]=e.separatorColor;t["border-bottom-style"]=e.separatorStyle}if(e.hasRightBorder){t["border-right-width"]=`${e.separatorWidth}px`;t["border-right-color"]=e.separatorColor;t["border-right-style"]=e.separatorStyle}if(e.firstRow){t["padding-top"]="0px"}return t}))}},{"../../../../languages":739,"../../../../lib":741,"solid-js":2313}],280:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.createIndexFns=i;var r=e("../../../../renderer/solid_utils/autorun_signals");function i(e){return(0,r.createWatcher)((()=>{if(e.scrollDirection==="vertical"){const t=e.columns;return{indexToRow:e=>Math.floor(e/t),indexToColumn:e=>e%t}}else if(e.scrollDirection==="horizontal"){const t=e.rows;return{indexToRow:e=>e%t,indexToColumn:e=>Math.floor(e/t)}}else{return{indexToRow:()=>0,indexToColumn:()=>0}}}),{fallback:{indexToRow:e=>0,indexToColumn:e=>0}})}},{"../../../../renderer/solid_utils/autorun_signals":774}],281:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.createAxisReorderingOverlay=n.TableContext=n.PSEUDO_TABLE_ELEMENTS=n.NUM_DEFAULT_ROWS_EDITOR=n.NUM_DEFAULT_COLUMNS=n.MAIN_AXIS_ZINDEX=n.DIVIDER_ZINDEX=n.DEFAULT_REPEATING_ROW_HEIGHT=n.DEFAULT_HEADER_ROW_HEIGHT=n.DEFAULT_COLUMN_WIDTH=n.CROSS_AXIS_ZINDEX=n.CELL_ZINDEX=void 0;n.crossAxisStyling=P;n.deleteCells=void 0;n.getAxes=O;n.getAxisNames=A;n.getLetterIndex=void 0;n.getRelativeIndex=S;n.updateIndicesOnDelete=n.updateIndicesOnCreate=n.isTableDirectionHorizontal=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js");var i=p(e("../../../../lang/appquery"));var s=e("../../../../u/shared/sorting");var o=e("./properties");var a=e("./element_styles");var l=e("../../../../lang/evaluation/element_eval");var c=d(e("../../../../lang/evaluation/element_props"));function u(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=u(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function p(e){return e&&e.__esModule?e:{default:e}}const _=3;n.NUM_DEFAULT_COLUMNS=_;const f=3;n.NUM_DEFAULT_ROWS_EDITOR=f;const h=77;n.DEFAULT_REPEATING_ROW_HEIGHT=h;const m=43;n.DEFAULT_HEADER_ROW_HEIGHT=m;const g=158;n.DEFAULT_COLUMN_WIDTH=g;const v=2;n.CELL_ZINDEX=v;const b=1;n.CROSS_AXIS_ZINDEX=b;const y=0;n.MAIN_AXIS_ZINDEX=y;const w=1e5;n.DIVIDER_ZINDEX=w;const x=["TableMainAxis","TableCrossAxis","TableCell"];n.PSEUDO_TABLE_ELEMENTS=x;const j=(0,r.createContext)();n.TableContext=j;function A(e){if(e==="horizontal"){return{main:"row",cross:"column"}}else{return{main:"column",cross:"row"}}}const M=e=>(e==null?void 0:e.get_static_property("table_direction"))==="horizontal";n.isTableDirectionHorizontal=M;const E=e=>String.fromCharCode("A".charCodeAt(0)+e);n.getLetterIndex=E;const k=e=>e.sort(((e,t)=>e.get_static_property("axis_index")-t.get_static_property("axis_index")||(0,s.compare)(e.id(),t.id())));function O(e,t){var n;return(n=e==null?void 0:e.elements().filter((e=>e.type()===t)))!=null?n:[]}function S(e){const t=e.type();const n=k(O(e.parent(),t));return n.findIndex((t=>t.id()===e.id()))}const D=function(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"after";const r=i.default.element(e);const s=k(O(r.parent(),t));const o=s.indexOf(r)+(n==="before"?0:1);for(let e=0;e<s.length;e++){const t=s[e];t.set_property("axis_index",e+(e>=o?1:0))}return o};n.updateIndicesOnCreate=D;const C=(e,t)=>{const n=i.default.element(e);const r=k(O(n.parent(),t));let s=0;for(let t=0;t<r.length;t++){const n=r[t];if(n.id()===e){s=1;continue}n.set_property("axis_index",t-s)}};n.updateIndicesOnDelete=C;const T=(e,t)=>{const n=O(e,"TableCrossAxis");for(const e of n){for(const n of e.elements()){if(n.get_static_property("cell_main_axis_id")===t){n.delete({user_action:"Delete TableCell"});n.commit_merge();break}}}};n.deleteCells=T;const N=()=>{const e=document.createElement("div");e.style.position="absolute";e.style.top="0";e.style.left="0";e.style.width="100%";e.style.height="100%";e.style.backgroundColor="rgba(0, 0, 0, 0)";e.style.cursor="move";return e};n.createAxisReorderingOverlay=N;function P(e){const t=()=>{var t,n;return M(((t=(n=e.repeating_instance)==null?void 0:n.element)!=null?t:e).parent())?"width":"height"};return[...(0,a.basicStyling)(e),new o.Style((e=>({"flex-direction":t()==="height"?"row":"column","box-sizing":"content-box"}))),new o.Style((e=>{var n;const r=(n=(0,l.evaluate_property)(e,`min_${t()}_css`))!=null?n:"0px";const i=(0,l.evaluate_property)(e,`single_${t()}`);if(i){return{"z-index":b,[t()]:r,"flex-grow":0,"flex-shrink":0}}const s=(0,l.evaluate_property)(e,`max_${t()}_css`);const o=c[`is_fitting_${t()}`](e);return{"z-index":b,[`min-${t()}`]:r,[`max-${t()}`]:s!=null?s:"",[t()]:o?"max-content":r,"flex-grow":o?0:1,"flex-shrink":0}}),{outerPositioning:true}),new o.Style((e=>!e.is_visible_me()?{display:"none"}:{}),{alwaysDynamic:true,noWaitVisible:true,notInStylesheet:true,outerPositioning:true})]}},{"../../../../lang/appquery":651,"../../../../lang/evaluation/element_eval":690,"../../../../lang/evaluation/element_props":691,"../../../../u/shared/sorting":853,"./element_styles":274,"./properties":278,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],282:[function(e,t,n){"use strict";const r=n;const i=e("../../../client/analytics");const s=e("../../../lib");const o=e("../../../lang/appquery");const{PSEUDO_TABLE_ELEMENTS:a,deleteCells:l}=e("../components/utils/table_element");function c(){var e;if(!((e=window)!=null&&e.is_maison)){var t,n,r;return((t=s().visual_edit)==null?void 0:t.responsive_version())>0&&((n=s().visual_edit)==null?void 0:n.is_active())&&((r=s().visual_edit)==null?void 0:r.responsive_mode_box())==="responsive"}else{return false}}function u(e){return a.includes(e.type())||e.type()==="Table"}r.delete_element_property=e=>({name:"delete_element",button_caption:e.type()==="Table"?"Delete table":"Delete",editor:"Button",optional:true,condition(){return!c()&&!e.get_static_property("cross_axis_repeat")},click_cb(){const t=e.type();if(t==="TableMainAxis"){const t=e.id();const n=e.parent();e.delete({user_action:"Delete Element Button"});e.commit();l(n,t)}else{e.delete({user_action:"Delete Element Button"});e.commit();s().visual_edit.select_to_edit(null)}i.track("PE Delete Element clicked",{app:o.appname()})},pretty:{section:"ElementMetaActions",no_caption:true,width:e.type()==="Table"?"":"small"}});r.select_parent_property=e=>({name:"select_parent",caption:"Select parent/child",editor:"Dropdown",no_write_child:true,optional:true,set:s().sets.get_set("ParentElements")(e),on_change(e){s().visual_edit.select_to_edit(e);i.track("PE Parent selected",{app:o.appname()})},pretty:{section:"ElementMetaActions"}});r.reveal_in_tree_property=e=>({name:"reveal_in_tree",button_caption:"Reveal in the Elements tree",editor:"Button",optional:true,click_cb(){s().visual_edit.reveal_in_element_tree(e);i.track("PE Reveal in Elements Tree clicked",{app:o.appname()})},pretty:{section:"ElementMetaActions",no_caption:true}});r.lock_in_editor_property=e=>{var t;return{name:"lock_in_editor",caption:"Lock this element (not draggable in editor)",editor:"Checkbox",optional:true,default:(t=s().edit_canvas)==null?void 0:t.locked_elements[e.id()],condition(){return!c()},on_change(t){var n,r;(n=(r=s().visual_edit.current_editor_canvas).lockElement)==null?void 0:n.call(r,e.id(),t);i.track("PE Lock in Editor clicked",{app:o.appname()})},pretty:{section:"ElementMetaActions"}}};r.replace_element_property=e=>({name:"switch_element",button_caption:"Replace",editor:"Button",optional:true,condition(){return!c()&&!u(e)},click_cb(){window.ReplaceTypePanel(e);i.track("PE Replace Element clicked",{app:o.appname()})},pretty:{section:"ElementMetaActions",no_caption:true,width:"small"}})},{"../../../client/analytics":20,"../../../lang/appquery":651,"../../../lib":741,"../components/utils/table_element":281}],283:[function(e,t,n){"use strict";const r=n;const i=e("../../../safe_require");i.safe_register("./core/core_elements/core_elements_utilities/element_optional_utils",r)},{"../../../safe_require":777}],284:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../safe_require");const s=e("../../../lang/plugins");const o=e("../../../services/shared/service_type_parser");const a=e("../../../services/shared/plugin_getter");const l=e("../../../u/shared/decaf");i.safe_register("./core/core_elements/core_elements_utilities/element_registry",r);r.registered_elements={};r.get_element_object=function(e,t){var n;(n=t)!=null?n:t=false;if(e==="CustomElement"){return}if(r.registered_elements[e]){return r.registered_elements[e]}else{var i;const[n]=o.get_plugin_and_type(e);return(i=a.get_plugin(n))==null?void 0:i.get_element(e,t)}};r.elements_list={CustomElement:true};r.get_full_list_elements=function(){const e=l.object_keys(r.registered_elements).filter((e=>r.elements_list[e]));for(const r of s.get_app_plugins_by_tags("element")){for(const s of(t=(n=(i=r.get_service()).get_elements_visual_edit)==null?void 0:n.call(i))!=null?t:[]){var t,n,i;e.push(s.name())}}return e};r.get_autobindable_elements=()=>r.get_full_list_elements().filter((e=>r.get_element_object(e).field_names.bind_field!=null));r.get_glyph_id_for_element_type=function(e){if(["CustomDefinition","CustomElement"].includes(e)){return"template"}const t=r.get_element_object(e);if(t!=null&&t.is_plugin){return t.icon}return t==null?void 0:t.glyph_id};r.get_element_display=function(e){var t;const n=r.get_element_object(e);if(!n)return"Missing type: "+e;else return(t=n.display)!=null?t:n.plugin_name}},{"../../../lang/plugins":726,"../../../safe_require":777,"../../../services/shared/plugin_getter":783,"../../../services/shared/service_type_parser":785,"../../../u/shared/decaf":844,"core-js/modules/web.dom-collections.iterator.js":1123}],285:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../u");const s=e("../../../safe_require");const o=e("../../core_events/event_element_mapping");const a=e("../../core_actions/utilities/core_actions_consts");const l=e("../../property_applications");const{apply_css_style:c}=l;const u=e("../../../constants/runmode");const d=e("../../../client/analytics");const p=e("../../../lib");const _=e("../../../lang/appquery");const f=e("../../../editor/css");const h=e("./element_meta_actions");const m=e("./element_visibility");const g=e("./element_workflows");const v=e("../shared/inputs");const b=e("../shared/hover_state_manager");const y=e("../legacy/responsive_versioning_wrapper");const w=e("../../../u/shared/mode_check");const x=e("./element_registry");const j=e("./element_utils");const A=e("../../../lang/evaluation/element_eval");const{VERSION_STYLE_OVERRIDES:M}=e("../../../constants/elements");const{PSEUDO_TABLE_ELEMENTS:E}=e("../components/utils/table_element");s.safe_register("./core/core_elements/core_elements_utilities/element_transformer",r);r.make_element=function(e,t,n){var i,s,l;const c=r.transform_element(e,t);if(!n){x.registered_elements[e]=c}if((i=t.events)!=null&&i.length){t.events=t.events.concat("OnError")}if((s=t.events)!=null&&s.length){for(const n of t.events){o.add_event(n,e)}}if((l=t.actions)!=null&&l.length){for(const n of t.actions){var u,d;(d=(u=a.action_element_mapping)[n])!=null?d:u[n]=[];if(a.action_element_mapping&&!a.action_element_mapping[n].includes(e)){a.action_element_mapping[n].push(e)}}}x.elements_list[e]=true};r.add_fields=(e,t)=>t.fields=function(n,r){var i,s,o,a,l,c,u,g;const v=[];const b=n.get_style_id();const y=!t.starts_hidden&&!t.always_visible;if(!((i=n.is_style)!=null&&i.call(n))&&y){v.push(...m.visibility_property(n)||[])}let w;const x=n.get_property_applications();if(!r&&b&&n.element_version()<M){w=x.filter((e=>e.not_in_style||e.style_allows_overrides))}else if((s=n.is_style)!=null&&s.call(n)){w=x.filter((e=>!e.not_in_style))}else{w=x}for(const e of w){v.push(...e.get_properties()||[])}let j;if(!r&&b&&n.element_version()<M){var A;j=((A=e==null?void 0:e(n))!=null?A:[]).filter((e=>{var n;return!((n=t.field_names[e.name])!=null&&n.in_style)}))}else if((o=n.is_style)!=null&&o.call(n)){var k;j=((k=e==null?void 0:e(n))!=null?k:[]).filter((e=>{var n;return(n=t.field_names[e.name])==null?void 0:n.in_style}))}else{var O;j=(O=e==null?void 0:e(n))!=null?O:[]}v.push(...j||[]);let S;if(!((a=n.is_style)!=null&&a.call(n))){if(["CustomDefinition"].includes(n.type())){S=n.get_static_property("element_type")}else{S=n.type()}v.push(...[{name:"element_style",caption:"Style Attribute",editor:"Dropdown",optional:true,empty_display:"None (Custom)",no_write_child:true,prop_node(e){return e.get_style_node()},condition(e){return!E.includes(e.type())},on_change(e){n.set_style(e);n.commit();if(e!=null){n.clear_style_overrides()}d.track("PE Element Style changed",{app:_.appname()})},set:p().sets.get_set("Styles")(S,n.id(),null,(()=>n.has_overridden_style())),pretty:{section:"ElementStyle",dropdown_width:"extra_extra_large"}},{name:"edit_style",button_caption:"Edit style",editor:"Button",optional:true,condition(e){return e.get_style_id()!=null},click_cb(){var e,t;p().styles_canvas.open_tab("Element Styles");if(n.type()!==p().styles_editor.element_styles_editor().element_type_node.get()){p().styles_editor.element_styles_editor().element_type_node.set(null)}if(((e=(t=p().styles_editor.element_styles_editor()).search_box)==null?void 0:e.call(t))!=null){p().styles_editor.element_styles_editor().search_box("")}p().styles_editor.element_styles_editor().currently_displayed_style(n.get_style_id());$(f.STYLES_TAB).click();d.track("PE Edit Style clicked",{app:_.appname()})},pretty:{section:"ElementStyle",no_caption:true,width:"tiny"},include_in_redesign:false},{name:"delete_style",button_caption:"Detach style",editor:"Button",optional:true,condition(e){return e.get_style_id()!=null},click_cb(){n.set_style(null);n.commit();d.track("PE Remove Style clicked",{app:_.appname()})},pretty:{section:"ElementStyle",no_caption:true,width:"tiny"},include_in_redesign:false},{name:"delete_style",button_caption:"Remove attached style",editor:"Button",optional:true,condition(e){return e.get_style_id()!=null},click_cb(){n.set_style(null);n.commit();d.track("PE Remove Style clicked",{app:_.appname()})},pretty:{section:"ElementStyle",no_caption:true,variant:"gray-link"},include_in_redesign:true},{name:"reset_overrides_label",label_text:"Appearance Settings",editor:"Label",condition:e=>e.get_style_id()!=null,pretty:{short_caption:false,section:"Appearance Settings"},include_in_redesign:false},{name:"reset_overrides",button_caption:"Reset",editor:"Button",optional:true,condition:e=>e.element_version()>=M&&e.get_style_id()!=null&&e.num_style_overrides()>0,click_cb:e=>{e.clear_style_overrides();e.commit();d.track("PE Reset Style clicked",{app:_.appname()})},pretty:{section:"Appearance Settings",no_caption:true,width:"tiny"},include_in_redesign:false}])}if(!["Page","CustomDefinition","CustomElement"].includes(n.type())&&!E.includes(n.type())&&!((l=n.is_style)!=null&&l.call(n))){v.push(h.replace_element_property(n))}if(!["Page","CustomDefinition","CustomElement"].includes(n.type())&&n.type()!=="TableCell"&&!((c=n.is_style)!=null&&c.call(n))){v.push(h.delete_element_property(n))}if(!["Page","CustomDefinition"].includes(n.type())&&!((u=n.is_style)!=null&&u.call(n))){v.push(h.select_parent_property(n));v.push(h.reveal_in_tree_property(n))}if(!["Page","CustomDefinition"].includes(n.type())&&!((g=n.is_style)!=null&&g.call(n))&&!E.includes(n.type())){v.push(h.lock_in_editor_property(n))}return v};const k={};r.register_hook_transformer=(e,t)=>k[e]=t;r.run_transformers=function(e){for(const t in k){const n=k[t];n(e)}};r.transform_element=function(e,t){var n,s,a,l,d;t.plugin_name=e;t=y.wrap_core_element(t);for(const n of["is_input","is_container","change_cursor_style_if_clickable","initialize","add_an_invisible_div_on_the_top"]){if(t[n]==null){throw new i.UnexpectedError("Error building "+e+": no value for "+n)}}const _=!t.starts_hidden&&!t.always_visible;(s=(n=t).field_names)!=null?s:n.field_names={};const f=typeof t.property_applications==="function"?t.property_applications():t.property_applications;for(const e of f){var h;const n=(h=e.field_names)!=null?h:{};for(const e in n){const r=n[e];t.field_names[e]=i.json_deep_copy(r)}}if(!["Page"].includes(e)){t.field_names.delete_element={no_states:true,only_edit_mode:true}}if(!["CustomDefinition","CustomElement","Page"].includes(e)&&!E.includes(e)){t.field_names.switch_element={no_states:true,only_edit_mode:true}}if(!["CustomDefinition","Page"].includes(e)){t.field_names.select_parent={no_states:true,only_edit_mode:true};t.field_names.reveal_in_tree={no_states:true,only_edit_mode:true};t.field_names.lock_in_editor={no_states:true,only_edit_mode:true}}t.field_names.element_style={no_states:true};t.field_names.delete_style={no_states:true,only_edit_mode:true};t.field_names.edit_style={no_states:true,only_edit_mode:true};if(_){i.extend(t.field_names,m.visibility_field_names)}if(t._fields){r.add_fields(t._fields,t)}if(t.defaults){for(const e in t.field_names){const n=t.field_names[e];const r=t.defaults[e];if(r!=null){n.default=r}}}if(t.starts_hidden){t.is_visible_on_page_load=e=>false}else if(t.always_visible){t.is_visible_on_page_load=e=>true}else if(_){t.is_visible_on_page_load=e=>e.get_static_property("is_visible",true)}else{throw new i.UnexpectedError("should not get here")}let x;if(t.dont_add_hover_pressed){x=[]}else{x=["is_hovered","is_pressed","force_pressed"]}if(t.plugin_name==="Link"){x.push("is_link_disabled")}const M=["invisible_div_drawn"];const k=["add_tab_index"];const O=[];const S=t.add_specific_messages;if(t.is_container){x.push(...["group_data"]);t.add_specific_messages=function(e,t){const n=t.get_state_value("group_data");if(n&&n.id()!=="null"){i.extend(e,{get_group_data:{description:"'s "+n.display(),section:"States",ret_btype:n,fn(e,t){return this.ret_btype().cast(e==null?void 0:e.state("group_data"))}}})}return S==null?void 0:S(e,t)};M.push(...["datasource_changed_by_workflow_action"]);k.push(...["set_group_data","reset_group"]);O.push(...[])}if(t.is_pseudo){t.add_specific_messages=function(e,t){if(t.type()==="TableMainAxis"){var n,r,s;i.extend(e,{get_data:{description:"'s Table",section:"States",ret_btype:(n=(r=(s=t.parent()).get_value_id)==null?void 0:r.call(s))!=null?n:"null",fn(e,t){return e.parent()}}});return S==null?void 0:S(e,t)}}}if(t.is_input){x.push("value");t.add_specific_messages=function(e,n){i.extend(e,{get_data:{description:t.is_checkbox?" is checked":"'s value",section:"States",ret_btype:n.get_state_value("value"),fn(e,t,n,r,i){if(i!=null&&i.inputs_must_be_valid&&e!=null&&e.is_visible()){e==null?void 0:e.state("value_that_is_valid")}return this.ret_btype().cast(e==null?void 0:e.state("value"))}}});if(t.is_checkbox){i.extend(e,{get_not_data:{description:" isn't checked",section:"States",ret_btype:n.get_state_value("value"),fn(e,t){return!(e!=null&&e.state("value"))}}})}return S==null?void 0:S(e,n)};x.push("value_that_is_valid");x.push("currently_binding");if(!t.no_is_focused){x.push("is_focused")}M.push(...["has_been_changed","force_display_validity"]);k.push(...["reset_input","set_focus"]);if(t.content_validated){x.push(...["display_invalid","is_invalid"]);k.push("display_validity")}O.push(...["user_change","user_submit"]);o.add_event("InputChanged",e)}if(t.is_file_uploader){k.push("cancel_upload")}function D(e){if(!e.edit_mode){return false}const t=e.element.root();return t!=null&&t.type()==="CustomDefinition"&&t.get_responsive_version()>0}const C=t.register;t.register=function(e){C==null?void 0:C.call(t,e);if(e.run_mode()){e.on_message("add_tab_index",(t=>{e.state("tab_index",t)}));if(t.is_container){j.register_group_data(t,e)}}if(_&&!w.on_server()&&(e.run_mode()||e.responsive_mode()||D(e))){let n=false;function r(){n=false;if(e._is_visible_me){e.do_show()}else if(e.is_drawn){e.do_hide()}else{e._hide_me();e.wait_for_first_draw((()=>{if(!e._is_visible_me){e.do_hide()}}))}}const s=e.parent();A.on_property_change(e,"is_visible",(t=>{e._is_visible_me=t;if(!n){n=true;i.WaitFor(e.get_skeleton_ready_key(),(()=>{if(s){i.WaitFor(s._has_become_visible,r)}else{r()}}))}}))}if(t.is_input){v.register_input_states(t,x,e)}};const T=t.initialize;t.initialize=function(e){let n,s;T.call(t,e);s=n=false;if(e.edit_mode()){A.on_property_change(e,"margin_top",(t=>{if(s){if(e.get_static_property("top")<t){e.element.set_property("top",t);e.element.commit_merge()}}s=true}));A.on_property_change(e,"margin_left",(t=>{if(n){if(e.get_static_property("left")<t){e.element.set_property("left",t);e.element.commit_merge()}}n=true}))}function o(){for(const n of e.element.get_property_applications()){(function(n){if(n.apply_once){return n.apply({},e.canvas)}else{let r;if(t.additional_uses_properties){r=n.uses_properties.concat(t.additional_uses_properties)}else{r=n.uses_properties}let i=true;return A.on_property_change(e,r,(t=>{t._first_time=i;n.apply(t,e.canvas,e);i=false}))}})(n)}}e.wait_for_visible_lite((()=>o()));if(e.run_mode()){e.wait_for_visible_lite((()=>{const t={};for(const n of e.element.get_property_applications()){n.get_transition_css(e.element,e.canvas,t)}e.get_transition_css(t);e.setTimeout((()=>{for(const e in t){let{target:n,css_prop:r}=t[e];if(![undefined,""].includes(r)){r=r.slice(0,r.length-2);c(n,{"-webkit-transition":r,"-moz-transition":r,"-o-transition":r,"-ms-transition":r,transition:r})}}}),0)}))}if(t.change_cursor_style_if_clickable&&e.run_mode()){if(e.element.get_related_workflows("ButtonClicked").length){j.register_tab_index_listener(e,(t=>{e.get_canvas().attr("tabindex",t)}));e.get_canvas().addClass(u.CLICKABLE_ELEMENT);e.wait_for_visible_lite((()=>A.on_property_change(e,"button_disabled",(t=>{if(t){e.get_canvas()[0].style.cursor="default";e.get_canvas()[0].tabindex="-1"}else{e.get_canvas()[0].style.cursor="pointer"}}))))}}if(e.run_mode()&&e.element.get_related_workflows("ButtonClicked").length){e.get_canvas().focus((()=>{e.get_canvas().addClass("show-outline")}));e.get_canvas().blur((()=>{e.get_canvas().removeClass("show-outline")}));if(!t.specific_click_handler){e.get_canvas().click((t=>{let n;const r=p().workflow.debugger;if(r!=null){n=r.element_clicked(e,e.get_partial())}if(!n){return g.run_element_workflow(e,"ButtonClicked",t)}}))}}if(t.add_an_invisible_div_on_the_top&&!e.run_mode()){j.do_add_an_invisible_div_on_the_top(e)}if(e.run_mode()&&!t.dont_add_hover_pressed){if(!i.is_on_mobile_or_tablet()){e.state("is_hovered",b.setup_hover,true);e.canvas.mousedown((()=>{e.state("is_pressed",true);$(document).one("mouseup",(()=>{e.state("is_pressed",false)}))}))}else{e.canvas.on("touchstart",(()=>{e.state("is_pressed",true);$(document).one("touchend",(()=>{const t=e.setTimeout((()=>e.state("is_pressed",false)),100);$(document).one("scroll",(()=>{e.state("is_pressed",false);return e.clearTimeout(t)}))}))}))}}if(e.run_mode()){r.run_transformers(e)}if(t.always_visible){e._display_me()}};const N=(a=t.get_states)!=null?a:()=>[];t.get_states=e=>x.concat(N(e));const P=(l=t.get_messages)!=null?l:()=>[];t.get_messages=e=>k.concat(P(e));const I=(d=t.get_private_messages)!=null?d:()=>[];t.get_private_messages=e=>O.concat(I(e));return t}},{"../../../client/analytics":20,"../../../constants/elements":61,"../../../constants/runmode":83,"../../../editor/css":560,"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../safe_require":777,"../../../u":823,"../../../u/shared/mode_check":851,"../../core_actions/utilities/core_actions_consts":173,"../../core_events/event_element_mapping":376,"../../property_applications":412,"../components/utils/table_element":281,"../legacy/responsive_versioning_wrapper":355,"../shared/hover_state_manager":361,"../shared/inputs":364,"./element_meta_actions":282,"./element_registry":284,"./element_utils":286,"./element_visibility":287,"./element_workflows":288,"core-js/modules/web.dom-collections.iterator.js":1123}],286:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../u");const s=e("../../../safe_require");const o=e("../../../lang/elements");const a=e("../../../lang/evaluation/element_eval");s.safe_register("./core/core_elements/core_elements_utilities/element_utils",r);r.reset_inputs_and_groups=function(e){for(const t of["reset_input","reset_group","clear_list"]){for(const n of e.current_children){if(n.element.get_messages().includes(t)){n.message(t)}}}};r.do_add_an_invisible_div_on_the_top=function(e){var t,n,r;(t=(n=e.canvas).find)==null?void 0:(r=t.call(n,".invisible-draggable-div"))==null?void 0:r.remove();const s=i.div("invisible-draggable-div");const o=e.get_canvas();if(o==="destroyed"){return}o.prepend(s);s.css({top:0,left:0});o.append(s.clone());return e.state("invisible_div_drawn",true)};r.register_tab_index_listener=function(e,t){e.autorun((()=>{const n=e.state("tab_index");if(n!=null){t(n)}}))};r.register_group_data=function(e,t){t.state("group_data",o.STATE_NOT_READY);function n(){if(!t.state("datasource_changed_by_workflow_action")){let n;if(e.default_group_data){n=e.default_group_data()}else{n=()=>{var e;return(e=a.evaluate_property(t,"data_source"))!=null?e:null}}return t.state("group_data",n)}}t.on_message("reset_group",(()=>{t.state("datasource_changed_by_workflow_action",false);n();return r.reset_inputs_and_groups(t)}));t.on_message("set_group_data",(e=>{var n;(n=e)!=null?n:e=null;t.state("datasource_changed_by_workflow_action",true);t.state("group_data",e);return l()}));t.autorun(n);let s=null;function l(){const e=t.state("group_data");if(!i.compare(e,s)){s=e;return r.reset_inputs_and_groups(t)}}t.autorun(l)}},{"../../../lang/elements":680,"../../../lang/evaluation/element_eval":690,"../../../safe_require":777,"../../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],287:[function(e,t,n){"use strict";const r=n;const i=e("../../../lang/appquery");const s=e("../../../client/analytics");const o=e("../../../lib");r.visibility_property=e=>{var t;return[{name:"is_visible",caption:(t=window)!=null&&t.is_maison?"Visible on page load":"This element is visible on page load",long_caption:"This element is visible",editor:"Checkbox",on_change(t){if(t===false){o().visual_edit.turn_element_on(e.id(),true)}s.track("PE Visible on Page Load toggled",{app:i.appname(),new_value:t})},pretty:{section:"Position"}},{name:"information",label_text:"This element is not visible on page load, you can show it to edit it in the Element Tree.",click_cb(){return $(".layers-box").find("h2").click()},editor:"Label",condition(e){return!e.get_static_property("is_visible",true)},pretty:{section:"Position"}}]};r.visibility_field_names={is_visible:{default:true}}},{"../../../client/analytics":20,"../../../lang/appquery":651,"../../../lib":741}],288:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../u");const s=e("../../../safe_require");const o=e("../../../logger");const a=e("../../core_events");const l=e("../../core_datasources/utilities/core_ds_workflow_utilities");const c=e("../../../lang/evaluation/FrozenState");const u=e("../../../lang/evaluation/page_state");const d=e("../../../constants/runmode");const p=e("../../../constants/workflow");const _=e("../../../constants/core");const f=e("../../../lib");const h=e("../../../db/values/StaticObject");const m=e("../../status_bar");const g=e("../../../lang/evaluation/element_eval");const v=e("../../../db/hydrate");const b=e("../../../lang/appquery");s.safe_register("./core/core_elements/core_elements_utilities/element_workflows",r);r.start_workflow_field_names={start_workflow:{no_states:true},button_disabled:{}};r.run_element_workflow=function(e,t,n,s,v,b){if(!b){if(n&&i.did_event_pass_through(n,"."+d.CLICKABLE_ELEMENT)){return}if(e.state("force_pressed")){return}}const y=s!=null?s:e.element.get_related_workflows(t);if(!(y!=null&&y.length)){return}const w=i.Promise(null,"button press evaluation");if(!b){e.state("force_pressed",true)}const x=m.show_progress_line(w);const j=t=>function(n){if(!n){t();return}const r=e.element.get_related_workflows("OnError");if(r.length===0){t(n);return}const s=a.build_wf_error_object(n);const o={element:e,datasources:u.get_basic_datasources(e.element.root())};const d={};d[_.LEGACY_PARAM_ID]=new h(s,null,"sys.error");o.datasources.get_wf_param=l.generate_wf_param_datasource(d);if(v!=null){i.extend(o.datasources,v)}const p=new c(o);p.freeze_workflows(r,(e=>{if(e){t(e);return}const i=f().workflow.run_workflows(o,r,true);i.callback(((e,r)=>{if(e){t(e);return}if(r.length===0){t(n);return}return t()}))}))};w.callback(j((t=>a.handle_uncaught_error({original_error:t,caught_from:p.ERROR_SOURCES.ELEMENT_WORKFLOW,cb(t){if(t){window.alert(o.human_friendly(t))}if(!b){e.state("force_pressed",false)}return x()}}))));i.run_once(5,(()=>{if(b){return false}return g.evaluate_property(e,"button_disabled")}),((t,n)=>{if(t){w.reject(t);return}if(n){w.resolve();return}if(!b){e.get_canvas().removeClass("show-outline")}const s={element:e,inputs_must_be_valid:true,datasources:u.get_basic_datasources(e.element.root())};if(v!=null){i.extend(s.datasources,v)}const o=new c(s);o.freeze_workflows(y,(t=>{if(t){w.reject(t);return}return i.run_once(30,(()=>r.find_invalid_inputs(e,y,s)),((e,t)=>{if(e){w.reject(e);return}const{validation_fail:n,min_top:r}=t;if(!n){return w.resolve(f().workflow.run_workflows(s,y,true))}else{var o;w.resolve(true);if(!i.isScrolledIntoView((o=r.instance)==null?void 0:o.get_canvas()).status){var a;return i.velocity((a=r.instance)==null?void 0:a.get_canvas(),"scroll",{duration:200,offset:-100,complete_cb(){return r.instance.message("set_focus")}})}else{return r.instance.message("set_focus")}}}))}))}));return w};r.find_inputs_to_check=function(e,t,n,r){const s=[];const o=[];for(const c of t){if(!r&&!f().workflow.should_workflow_run(n,c)){continue}s.push(c);function u(e){var t,n;if(((t=e.next())==null?void 0:(n=t.name)==null?void 0:n.call(t))==="isnt_valid"){return true}else{return false}}const d=[];for(const _ of c.find_expressions("GetElement")){if(!u(_)){d.push({instance_id:_.element_id()})}}for(const h of c.find_expressions("ThisElement")){if(!u(h)){d.push({instance_id:e.element_id()})}}function p(t,n){var r;const s=b.event(t.get_static_property("custom_event"));(r=n)!=null?r:n={};if(n[s.id()]){return}n[s.id()]=true;const o=e.find_instance_by_id(t.element_id());if(!(s!=null&&s.exists())){return}for(const e of s.find_expressions("GetElement")){if(!u(e)){d.push({instance_id:e.element_id(),parent_instance:o})}}for(const e of s.actions("TriggerCustomEvent").concat(s.actions("TriggerCustomEventFromReusable"))){p(e,i.extend({},n))}}for(const m of c.actions("TriggerCustomEvent").concat(c.actions("TriggerCustomEventFromReusable"))){p(m)}for(const{instance_id:g,parent_instance:v}of d){const y=(v!=null?v:e).find_instance_by_id(g);if(y&&y.is_visible()){o.push(y)}}}const a={};const l=[];for(const w of o){if(!a[w.toUniqueString()]){a[w.toUniqueString()]=true;l.push(w)}}return{input_instances:l,to_run:s}};r.find_invalid_inputs=function(e,t,n){const i={top:0,left:0,instance:null};let s=false;const{input_instances:o,to_run:a}=r.find_inputs_to_check(e,t,n);for(const e of o){if(e.get_messages().includes("display_validity")){var l,c;e.message("display_validity");if(e.state("display_invalid")||(l=n.frozen_state.element_state[v.dehydrate_tree(e)])!=null&&(c=l.value_that_is_valid)!=null&&c.not_valid){s=true;if(i.top>e.element.get_top()||!i.instance){if(i.left>=e.element.get_left()||!i.instance){i.top=e.element.get_top();i.left=e.element.get_left();i.instance=e}}}}}return{validation_fail:s,min_top:i,to_run:a}}},{"../../../constants/core":55,"../../../constants/runmode":83,"../../../constants/workflow":95,"../../../db/hydrate":429,"../../../db/values/StaticObject":473,"../../../lang/appquery":651,"../../../lang/evaluation/FrozenState":687,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/page_state":698,"../../../lib":741,"../../../logger":744,"../../../safe_require":777,"../../../u":823,"../../core_datasources/utilities/core_ds_workflow_utilities":236,"../../core_events":377,"../../status_bar":415,"core-js/modules/web.dom-collections.iterator.js":1123}],289:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../logger");const{GROUP_TYPES:s}=e("../../constants/custom_elements");const{default_color_tokens_to_property:o,user_color_tokens_to_property:a,variable_to_token_variant:l,token_variant_to_properties:c}=e("../../lang/color_tokens");const u=e("../../lang/font_tokens");const d=e("../../constants/colors");const p=e("../property_applications");const _=e("../core_elements/core_elements_utilities/element_transformer");const f=e("../core_elements/core_elements_utilities/element_registry");const h=e("../../lang/evaluation/element_eval");const m=e("../core_elements/shared/floating_groups");const g=e("../core_elements/shared/groups");const v=e("./components/CustomDefinitionComponent");const b=e("../../lang/btype_ids");const{reusableElementProps:y}=e("../../editor/flag_check");const{FirstLetterCapitalize:w}=e("../../u/shared/b_string");const x=e("../../lang/evaluation/evaluate");const j=e("../../lang/shrink");const{displayableInListBtypes:A,filters:M}=e("../../lang/btypes_dropdowns");const E=e("../../lib");const k=e("../../lang/appquery");const O=_.transform_element("Custom Element",{field_names:r.extend({element_type:{default:"Group",no_states:true},group_type:{no_states:true},delete_custom_definition:{no_states:true},new_responsive:{no_states:true},responsive_version:{no_states:true},upgrade_responsive_version:{no_states:true,only_edit_mode:true},element_version:{default:0,no_states:true},min_width:{no_states:true,default:0,optional:true},use_max_width:{no_states:true},max_width:{no_states:true,default:100,optional:true},page_folder:{optional:true,no_states:true,only_edit_mode:true}},m.floating_field_names),_fields(e){var t;const n=(t=E().visual_edit)==null?void 0:t.get_root();let i;if(k.has_feature_enabled("reorg_component_selection")){i=A()}else{i=E().sets.get_set("DisplayableInListValues")(true)}const o=[{name:"element_type",caption:"Type of element",editor:"Dropdown",set:E().sets.get_set("Object")(s),pretty:{section:"GroupType"}},{name:"group_type",caption:"Type of content",editor:"Dropdown",optional:true,set:i,pretty:{section:"GroupType"}},{name:"parameters",editor:"FlyoutObjectList",create_caption:"Add new property",edit_caption:"Edit property",confirm_caption:"Save",id_field:"param_id",has_rows:true,do_not_scroll_to_down:true,condition(){return e.get_responsive_version()>0&&y()},pretty:{section:"GroupType"},display_data(e){var t,n;const i={title:e==null?void 0:(t=e.json)==null?void 0:t.child("param_name").raw()};let s=e==null?void 0:e.property("default_value").get_tree_display();const o=e==null?void 0:(n=e.json)==null?void 0:n.child("editor_type").raw();if(s){if(o==="Color"){var a,u,p,_;if((a=s)!=null&&(u=a.includes)!=null&&u.call(a,d.VAR_IDENTIFIER)){const{token_set:e,variant:t}=l(s);const{rgba:n}=c(e,t);s=r.rgb_to_hex(n).code.toUpperCase()}else if((p=s)!=null&&(_=p.includes)!=null&&_.call(p,"rgb")){s=r.rgb_to_hex(s).code.toUpperCase()}}else if(o==="Checkbox"){s=s==="yes"?"True":"False"}s=w(s);i.context_info=s}else{i.placeholder_text="(no default value)"}let f;if(o!=="DynamicValue"){f=o}else{var h;let t=e==null?void 0:(h=e.json)==null?void 0:h.child("btype_id").raw();if(t==="boolean"){t="Yes / No"}f=t}if(f){i.subtitle=f.split("_").map((e=>w(e))).join(" ")}i.context_type=f;return i},sub_properties(e){var t,n,r,i,s;const o={DynamicValue:"Dynamic value",Color:"Color picker",Checkbox:"Checkbox"};const a=e==null?void 0:(t=e.property("editor_type"))==null?void 0:t.get_literal();const l=e==null?void 0:(n=e.property("optional"))==null?void 0:n.get_literal();let c=e==null?void 0:(r=e.property("btype_id"))==null?void 0:r.get_literal();const u=[{name:"param_name",caption:"Label",editor:"StaticText",include_in_redesign:false},{name:"editor_type",caption:"Input Type",editor:"Dropdown",set:E().sets.get_set("Object")(o),condition:"param_name",pretty:{dropdown_width:"medium-large"},include_in_redesign:false,disabled_value:o[a]},{name:"btype_id",caption:"Field Type",condition(){return a==="DynamicValue"},editor:"Dropdown",set:k.has_feature_enabled("reorg_component_selection")?A().filter(M().no_data_types):E().sets.get_set("AllowableValues")(true),disabled_value:c?w(c):null},{name:"is_list",caption:"Is a list/array",editor:"Checkbox",default:false,condition(){return a==="DynamicValue"&&c},include_in_redesign:false,optional:true}];let d;if((e==null?void 0:(i=e.property("is_list"))==null?void 0:i.get_literal())===true){d="Basic";c=b.list_type(c)}else{if(c==="text"){var p;u.push({name:"long_text",caption:"Long Text",editor:"Checkbox",condition(){return c==="text"}});if((e==null?void 0:(p=e.property("long_text"))==null?void 0:p.get_literal())===true){d="LongText"}else{d="ShortText"}}else if(c==="image"){d="DynamicImage"}else if(c==="file"){d="DynamicFile"}else{d="Basic"}}u.push(...[{name:"optional",caption:"Optional",editor:"Checkbox",default:true,condition(){return(c||a==="Color")&&a!=="Checkbox"}},{name:"default_value",caption:"Default Value",editor:"Checkbox",condition(){return a==="Checkbox"&&l},optional:true},{name:"default_value",caption:"Default Value",editor:"Color",condition(){return a==="Color"&&l},optional:true,dynamic:true},{name:"default_value",caption:"Default Value",editor:d,value:(s=c)!=null?s:"null",optional:true,condition(){return c&&l}}]);return u}}];if(e.get_static_property("element_type")==="FloatingGroup"){o.push(...m.floating_group_fields(e))}o.push(...[{name:"delete_custom_definition",button_caption:"Delete this reusable element",editor:"Button",optional:true,click_cb(){const e=window.confirm(`Delete reusable element ${n.get_name()}?`);if(e){n.delete({user_action:"Delete Reusable Prompt"});n.commit()}},pretty:{section:"ElementMetaActions",no_caption:true}},{name:"new_responsive",caption:"Enable new page rendering engine",editor:"Checkbox",condition(e){var t;return((t=e.root())==null?void 0:t.get_responsive_version())<1&&!k.get_public_setting("no_legacy_responsive")},pretty:{section:"ShortPosition"}},{name:"upgrade_responsive_version",button_caption:"Upgrade responsive",editor:"Button",optional:true,condition(e){var t,n;return((t=e.root())==null?void 0:t.get_responsive_version())<1&&((n=e.root())==null?void 0:n.use_responsive_algorithm())},click_cb(){window.start_responsive_upgrade(e)},pretty:{section:"ShortPosition",no_caption:true}},{name:"min_width",caption:"Minimum width (% of current width)",editor:"StaticNumber",integer:true,condition(e){var t;return((t=e.root())==null?void 0:t.get_responsive_version())<1&&(e==null?void 0:e.use_responsive_algorithm())},pretty:{section:"Position"}},{name:"use_max_width",caption:"Apply a max width when the page is stretched",editor:"Checkbox",condition(e){var t,n;return((t=e.root())==null?void 0:t.get_responsive_version())<1&&((n=e.root())==null?void 0:n.use_responsive_algorithm())&&!e.get_static_property("fixed_width")&&e.max_width_adjustable_legacy()},pretty:{section:"Position"}},{name:"max_width",caption:"Maximum width (% of current width)",editor:"StaticNumber",integer:true,condition(e){var t,n;return((t=e.root())==null?void 0:t.get_responsive_version())<1&&((n=e.root())==null?void 0:n.use_responsive_algorithm())&&!e.get_static_property("fixed_width")&&e.max_width_adjustable_legacy()&&e.get_static_property("use_max_width")},pretty:{section:"Position"}},{name:"page_folder",caption:"Page folder",editor:"Dropdown",set:E().sets.get_set("PageFolders")(),pretty:{section:"PageFolder"}}]);return o},can_defer_drawing(){return true},initialize(e){if(e.edit_mode()&&e.element.use_responsive_algorithm()&&e.get_static_property("element_type")==="Popup"){h.on_property_change(e,["width","height"],(t=>{let{width:n,height:s}=t;return r.run_once(30,(()=>{const t=e.element_id();k.find_elements("CustomElement").forEach((e=>{if(e.get_static_property("custom_id")===t&&e.root()!=null){e.set_property("width",n);e.set_property("height",s)}}))}),(e=>{if(e){i.log(e);return}k.commit_merge()}))}))}const t=document.documentElement;if(e.edit_mode()){e.autorun((()=>{u.load_font_tokens_default();u.load_font_tokens_user()}))}e.autorun((()=>{for(const[e,n]of Object.entries(o())){t.style.setProperty(e,n)}}));e.autorun((()=>{for(const[e,n]of Object.entries(a())){t.style.setProperty(e,n)}}));e.autorun((()=>{for(const[e,n]of Object.entries(u.default_font_tokens_to_property())){t.style.setProperty(e,n)}}));e.autorun((()=>{for(const[e,n]of Object.entries(u.user_font_tokens_to_property())){t.style.setProperty(e,n)}}))},property_applications(e){return[new p.ShortDimensions,new p.Background,new p.Border,new p.BoxShadow,new p.RootSizing,new p.ResponsiveContainer(e),new p.PaddingFields,new p.Opacity]},uses_css_responsive:true,solid_component:v,attach_to_body(){return false},no_margins(){return true},defaults:{bgcolor:"#FFFFFF",background_style:"bgcolor"},get_html(){return"<div></div>"},get_min_width(e){return 0},position_canvas(e,t){if(t.responsive_mode()){t.container.add(t);return}$(".canvas").append(e);if(t.element.get_responsive_version()<1){return e.css({"margin-right":"auto","margin-left":"auto",position:"relative"})}},always_visible:true,can_have_children(){return true},add_specific_messages(e,t){var n,i,s;const o=(n=(i=(s=t.property("parameters")).entries)==null?void 0:i.call(s))!=null?n:[];for(const t of o){var a;const n=t.raw();let i=(a=n.btype_id)!=null?a:n.editor_type==="Checkbox"?"boolean":"text";let s=t.property("default_value").get_tree_display();if(n.editor_type==="Color"){var u,p,_,f,h,m;if((u=s)!=null&&(p=(_=u).includes)!=null&&p.call(_,d.VAR_IDENTIFIER)){const{token_set:e,variant:t}=l(s);const{rgba:n}=c(e,t);s=r.rgb_to_hex(n).code.toUpperCase()}else if((f=s)!=null&&(h=(m=f).includes)!=null&&h.call(m,"rgb")){s=r.rgb_to_hex(s).code.toUpperCase()}}if(n.is_list){i=b.list_type(i)}r.extend(e,{[`param_${n.param_id}`]:{description:"'s "+n.param_name,section:"Properties",ret_btype:i,caption:s,fn(e){return x.evaluate(j.shrink_object(n.default_value),e.prop_eval_context())[0]}}})}},get_children_canvas(e){return e.get_canvas()},get_state_value(e,t){return g.state_value_helper_for_group(e,t)},is_input:false,is_container:true,change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,not_draggable(){return true}});f.registered_elements.CustomDefinition=O},{"../../constants/colors":53,"../../constants/custom_elements":57,"../../editor/flag_check":575,"../../lang/appquery":651,"../../lang/btype_ids":652,"../../lang/btypes_dropdowns":654,"../../lang/color_tokens":657,"../../lang/evaluation/element_eval":690,"../../lang/evaluation/evaluate":695,"../../lang/font_tokens":713,"../../lang/shrink":728,"../../lib":741,"../../logger":744,"../../u":823,"../../u/shared/b_string":841,"../core_elements/core_elements_utilities/element_registry":284,"../core_elements/core_elements_utilities/element_transformer":285,"../core_elements/shared/floating_groups":359,"../core_elements/shared/groups":360,"../property_applications":412,"./components/CustomDefinitionComponent":248,"core-js/modules/web.dom-collections.iterator.js":1123}],290:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../u");const s=e("../../u/shared/decaf");const o=e("../../lang/app_json");const a=e("../../logger");const l=e("../../lang/nodes");const c=e("../../lang/elements/ElementInstance");const u=e("../../lang/elements/ServerElementInstance");const d=e("../../lang/elements/Transition");const p=e("../../lang/evaluation/element_eval");const _=e("../../lang/evaluation/element_props");const f=e("./shared/groups");const{ON_ELEMENT:h}=e("../../constants/custom_elements");const m=e("../property_applications");const g=e("../core_elements/core_elements_utilities/element_visibility");const v=e("../core_elements/core_elements_utilities/element_meta_actions");const b=e("../core_elements/shared/popups");const y=e("../core_elements/shared/floating_groups");const w=e("../core_elements/shared/groups");const x=e("../shared_fields");const{allow_overrides_check:j}=e("../../lang/evaluation/allow_overrides_check");const{FirstLetterCapitalize:A}=e("../../u/shared/b_string");const M=e("../../lang/btype_ids");const E=e("../../lang/evaluation/evaluate");const k=e("../../lang/shrink");const O=e("../../lib");const S=e("../../lang/appquery");const D={missing:true,get_static_property(){},get_default(){},events(){return[]},property(e){return l.new_expression(o.EmptyJSON(S.app().json,null,"property on missing def"),this)},id(){return"missing"},can_have_children(){return false},toUniqueString(){return"MissingDef"},get_style_if_exists(){},element_custom_states(){return[]},element_custom_state(){return null},add_specific_messages(){},get_responsive_version(){return 0},raw(){return{}}};function C(e){return{get_html(){return"<div>Deleted reusable element</div>"},initialize(){},get_messages(){return[]},get_states(){return[]},get_private_messages(){return[]},can_have_children(){return false},is_visible_on_page_load(){return true},add_specific_messages(){},property_applications:[]}}function T(e){const t=e.property("custom_id").get_static();const n=e.app().custom_definition(t);if(!(n!=null&&n.exists())){return D}return n}function N(e,t){var n,r;(n=t)!=null?n:t=T(e);if(t.missing){return C(e.property("custom_id").get_static())}const i=(r=t.property("element_type").get_static())!=null?r:"Group";return O().load_plugin(O().plugin_prefixes.element+i)}function P(e){const t=e.json.child("properties").child("custom_id").get();const n=O().derived("CustomByName").content();return s.object_values(n).some((e=>e.id===t))}function I(){var e;if(!((e=window)!=null&&e.is_maison)){var t,n,r;return((t=O().visual_edit)==null?void 0:t.responsive_version())>0&&((n=O().visual_edit)==null?void 0:n.is_active())&&((r=O().visual_edit)==null?void 0:r.responsive_mode_box())==="responsive"}else{return false}}function R(e){var t,n;const r=T(e);const s=N(e,r);if(r.missing&&P(e)){a.error("custom element exists but not found while rendering. possible id_to_path issue",{custom_id:e.json.child("properties").child("custom_id").get(),id_to_path_keys:O().app().json.child("_index").child("id_to_path").child_names(),element_definitions_keys:O().app().json.child("element_definitions").child_names(),run_js_page_generation_fiber_id:O().app().json.child("generation_fiber_id").get()})}const o=r.property("element_type").get_static();const S=o!=="Popup";const D=o==="FloatingGroup";const C=o==="Group";let R={data_source:{},edit_custom_definition:{only_edit_mode:true},min_width:{default:30,no_states:true},fixed_width:{no_states:true,default:false},responsive_alignment:{default:"center",no_states:true},use_max_width:{no_states:true,default:false},max_width:{default:100,optional:true,no_states:true},collapse_margin:{default:0,optional:true,no_states:true},delete_element:{no_states:true,only_edit_mode:true},select_parent:{no_states:true,only_edit_mode:true},reveal_in_tree:{no_states:true,only_edit_mode:true},lock_in_editor:{no_states:true,only_edit_mode:true}};const L=Object.values((t=(n=r.property("parameters"))==null?void 0:n.raw())!=null?t:{});for(const e of L){R={...R,[`param_${e.param_id}`]:{no_states:false,only_edit_mode:true,optional:e.optional}}}if(S){i.extend(R,(new m.PositionOnly).field_names,g.visibility_field_names,(new m.Dimensions).field_names,{use_max_width:{no_states:true,default:false},max_width:{optional:true,no_states:true,default:100},collapse_margin:{default:375,optional:true,no_states:true}})}else{i.extend(R,b.greyout_field_names,(new m.ShortDimensions).field_names)}if(D){i.extend(R,y.floating_field_names)}i.extend(R,new m.ResponsiveElement(e).field_names);if(C){i.extend(R,w.group_field_names)}const z={base_name:s.plugin_retrieved_name,property_transformer(e,t){return function(n){if(h.includes(n)){if(["height","width"].includes(n)){if(e.not_resizable()){return r.property(n)}else{return t(n)}}else{return t(n)}}if(e.get_styleable_properties()[n]&&r.get_style_if_exists()&&(!j(e,n,r.field_names())||r.property(n).raw()==null)){return r.get_style().property(n)}else{return r.property(n)}}},get_static_property_transformer(e,t){return function(n,i){if(h.includes(n)){if(["height","width"].includes(n)){if(e.not_resizable()){return r.get_static_property(n,i)}else{var s;return(s=t(n,i))!=null?s:r.get_static_property(n,i)}}else{return t(n,i)}}if(e.get_styleable_properties()[n]&&r.get_style_if_exists()&&(!j(e,n,r.field_names())||r.property(n).raw()==null)){return r.get_style().get_static_property(n,i)}else{return r.get_static_property(n,i)}}},get_style_if_exists_transformer(){return()=>r.get_style_if_exists()},default_transformer(e,t){return function(n){if(h.includes(n)){return t(n)}const i=e.get_styleable_properties()[n]&&r.get_style_if_exists()&&(!j(e,n,r.field_names())||r.property(n).raw()==null);if(i){return r.get_style().get_default(n)}else{return r.get_default(n)}}},states_transformer(e){return()=>{var e,t;return(e=(t=r.states)==null?void 0:t.call(r))!=null?e:[]}},primary_field(e){},field_names:R,styleable_properties:{greyout_color:false,greyout_blur:false},fields(e){var t,n,s;const o=[];const l=r.get_static_property("group_type");o.push({name:"data_source",caption:"Data source",editor:"Basic",value:l,optional:true,pretty:{short_caption:false,section:"GroupType"},condition:()=>l!=null});const c=Object.values((t=(n=r.property("parameters"))==null?void 0:n.raw())!=null?t:{});o.push({name:"custom_parameters_label",label_text:"Properties",editor:"Label",condition:()=>c.length>0,pretty:{short_caption:false,section:"Parameters"}});const u=(e,t)=>{if(e==="text"){if(t.long_text){return"LongText"}else{return"ShortText"}}else if(e==="image"){return"DynamicImage"}else if(e==="file"){return"DynamicFile"}else{return"Basic"}};const d=(e,t)=>{let n;if(e!=="DynamicValue"){n=e}else{if(t==="boolean"){t="Yes / No"}n=t}return n};for(const e of c){o.push({name:`param_${e.param_id}`,caption:e.param_name,subcaption:d(e.editor_type,e.btype_id).split("_").map((e=>A(e))).join(" "),editor:e.editor_type==="DynamicValue"?u(e.btype_id,e):e.editor_type,value:u(e.btype_id,e)==="Basic"?e.is_list?M.list_type(e.btype_id):e.btype_id:null,optional:e.optional,pretty:{short_caption:false,section:"Parameters"}})}o.push(...g.visibility_property(e));function p(t){if(r.get_responsive_version()<1){const n=r.get_width();const i=r.get_height();return o.push({name:"information",label_text:`Original element dimensions ${n}x${i} (click to apply)`,editor:"Label",condition:()=>!I(),click_cb(){e.set_property("height",i);e.set_property("width",n);e.commit()},pretty:{section:t}})}}if(S){if(e.not_resizable()){o.push(...(new m.PositionOnly).get_properties())}else{o.push(...(new m.Dimensions).get_properties());p("Position")}}else{if(!e.not_resizable()){o.push(...(new m.ShortDimensions).get_properties());p("ShortPosition")}o.push(...b.get_greyout_properties())}if(D){o.push(...y.floating_group_fields(e))}if(((s=e.root())==null?void 0:s.get_responsive_version())>0){o.push(...new m.ResponsiveElement(e).get_properties())}if(r.get_responsive_version()<1){o.push(...(new m.MinWidth).get_properties())}if(C){o.push(...x.group_element_fields(e))}o.push({name:"edit_custom_definition",button_caption:"Edit element",editor:"Button",optional:true,click_cb(){return i.run_once(30,(()=>r.name()),((e,t)=>{if(e){a.log(e);return}if(t){window.change_to_custom(t);return true}}))},pretty:{section:"ElementMetaActions",no_caption:true,width:!I()?"small":undefined}});o.push(v.delete_element_property(e));o.push(v.select_parent_property(e));o.push(v.reveal_in_tree_property(e));o.push(v.lock_in_editor_property(e));o.push(...(new m.UniqueID).get_properties());return o},property_applications:s==null?void 0:s.property_applications,custom_states(){var e,t;return(e=(t=r.states)==null?void 0:t.call(r))!=null?e:l.enhance_array([])},element_custom_states(){return r.element_custom_states()},element_custom_state(e){return r.element_custom_state(e)},get_default(){},transition(t){const n=e.json.child("transitions").child(t);if(n.exists()){return new d(n,e)}const i=r.transition(t);if(i){return i}const s=r.get_style_if_exists();if(s){return s.transition(t)}},get_messages(e){return s.get_messages(e)},get_states(e){return s.get_states(e)},add_specific_messages(e,t){for(const s of Object.values((n=(r=t.E.custom_definition())==null?void 0:(o=r.property("parameters"))==null?void 0:o.raw())!=null?n:{})){var n,r,o,a;let l=(a=s.btype_id)!=null?a:s.editor_type==="Checkbox"?"boolean":"text";if(s.is_list){l=M.list_type(l)}i.extend(e,{[`param_${s.param_id}`]:{description:"'s "+s.param_name,section:"Properties",ret_btype:l,fn(e){var n,r,i,o;const a=(n=(r=e.prop_eval_context)==null?void 0:r.call(e))!=null?n:e.find_instance_by_id(e.element_id()).prop_eval_context();return E.evaluate(k.shrink_object((i=(o=t.property(`param_${s.param_id}`))==null?void 0:o.raw())!=null?i:s.default_value),a)[0]}}})}return s.add_specific_messages(e,t)},get_state_value(e,t){return s.get_state_value(e,t)},get_private_messages(e){return s.get_private_messages(e)},mandatory_sections(e){return["GroupType","Background"]},get_html(e){return s.get_html(e)},is_popup(e){return!S},not_max_adjustable:s.not_max_adjustable,property_supports_states:true,property_supports_transitions:false,can_copy_style:false,uses_css_responsive:r.get_responsive_version()>0,can_fit_width:S,can_fit_height:true,solid_component:r.get_responsive_version()>0?s.solid_component:undefined,use_legacy_in_editor:true,edit_fallback_component:s.solid_component,check_for_errors(e,t){f._check_for_errors_datasource_set_to_self(e,"get_group_data",t);if(D){y.check_error_floating_group(e,t)}if(r.missing){t(e.display()+": This reusable element cannot be found in the application.")}},register(e){var t;if(e.is_self_nested_custom()){return}e.split_namespace();e.add_to_namespace(e,r.id());if(e.run_mode()){i.WaitFor(e.can_register_workflows(),(()=>e.register_workflows(r.events())))}(t=s.register)==null?void 0:t.call(s,e)},register_children(e){if(e.is_self_nested_custom()||!s.can_have_children()){return}if(s.register_children){s.register_children(e)}else{e._default_register_children(r.elements())}},can_defer_drawing(e){var t,n;return(t=(n=s.can_defer_drawing)==null?void 0:n.call(s,e))!=null?t:false},initialize(e){s.initialize(e);if(e.responsive_mode()||e.run_mode()){var t;if(r.get_responsive_version()>0&&((t=e.element.root())==null?void 0:t.get_responsive_version())<1){e.canvas.css({height:"max-content","grid-template-rows":"max-content"});if(e.element.added_to_container()){e.autorun((()=>{const t=e.current_height();e.set_height(t,{no_css_update:true});e.canvas.css("height","max-content")}))}}}if(e.is_self_nested_custom()){e.canvas.text("This is a circular Reusable Element... Reusable Elements cannot contain themselves (or other Reusable Elements that contain them).");return}if(e.edit_mode()){return e.autorun((()=>{var t;(t=r.json)==null?void 0:t._raw();const n=c.modes.REUSABLE_EDIT;e.canvas.find(".sub-elements").remove();const s=i.div("sub-elements");s.css("height","100%");e.canvas.append(s);e.children=[];if(e.get_static_property("overflow_scroll")&&_.is_fitting_height(e)&&(p.evaluate_property(e,"vert_alignment")||p.evaluate_property(e,"horiz_alignment"))){e.canvas.css("height","100%")}const o=i.div("sub-element-container");s.append(o);const a=e.container.create_child(e,o);if(r.can_have_children()){for(const t of r.elements()){const r=new c(t,n);e.children.push(r);r.register(e);r.create_skeleton(a);r.start_draw_tree();e.on_destroy((()=>r.destroy()))}}if(r.get_responsive_version()>0){var l;const t=e.canvas.find(">.sub-elements>.sub-element-container");if(((l=e.element.root())==null?void 0:l.get_responsive_version())>0){e.autorun((()=>{t.css({position:"relative",width:_.is_fitting_width(e)?"max-content":"100%",height:_.is_fitting_height(e)?"max-content":"100%","min-width":"100%","min-height":"100%"})}))}else{t.css({position:"relative",width:"100%",height:"100%"})}}const u=i.div("compound-cover",s);const d=i.div("compound-outertable",s);const f=["top","right","bottom","left"];e.autorun((()=>{const t=f.map((t=>`${-p.evaluate_property(e,"padding_"+t)}px`)).join(" ");u.css("inset",t);d.css("inset",t)}));const h=i.div("compound-cover-label",d);e.autorun((()=>h.text(e.element.get_name())));if(e.get_static_property("overflow_scroll")){e.canvas.css("transform","rotate(0)");h.css({position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"})}}))}},can_have_children(e){return s.can_have_children(e)},get_children_canvas(e){return s.get_children_canvas(e)},create_server_children(e){const t=e.container.create_child(e);i.incremental_for_each(r.elements(),(t=>{if(t.exists()){e.children.push(new u(t))}}));e.child_container=t},attach_to_body(e){var t;return(t=s.attach_to_body)==null?void 0:t.call(s,e)},goes_on_document(e){var t,n;return(t=(n=s.goes_on_document)==null?void 0:n.call(s,e))!=null?t:false},goes_on_document_for_drawing(e){var t,n;return(t=(n=s.goes_on_document_for_drawing)==null?void 0:n.call(s,e))!=null?t:this.goes_on_document(e)},no_edit_draw_children(){return true},is_visible_on_page_load(e){return s.is_visible_on_page_load(e)},not_resizable(e){var t,n;if(!((t=e.root())!=null&&t.use_responsive_algorithm())||!((n=r.use_responsive_algorithm)!=null&&n.call(r))){return true}else if(r.get_responsive_version()>0&&r.container_layout()==="fixed"){return true}else{return false}},not_draggable(e){var t,n;return(t=(n=s.not_draggable)==null?void 0:n.call(s,e))!=null?t:false},modal(e){var t;return(t=s.modal)==null?void 0:t.call(s,e)},get_definition_workflows(e){return r.events()},get_visible_workflows(e){return l.enhance_array([...e.parents().events(),...this.get_definition_workflows(e)])},get_related_workflows(e){return function(t){const n=e.parents().events();const i=r.events();const s=e=>n=>n.element_id()===e&&n.type()===t;return l.enhance_array([...n.filter(s(e.id())),...i.filter(s(r.id()))])}},custom_definition(){return r}};if(s.can_animate){z.can_animate=()=>s.can_animate(e)}if(s.position_canvas){z.position_canvas=s.position_canvas}if(s.do_show){z.do_show=s.do_show}if(s.do_hide){z.do_hide=s.do_hide}if(s.notify_width){z.notify_width=s.notify_width}if(s.get_min_width&&r.use_responsive_algorithm()){z.get_min_width=s.get_min_width}if(s.uses_inset_instead_of_margin){z.uses_inset_instead_of_margin=true}return z}r.load_custom=i.autorun_cache(R);r.CustomDefinition=T},{"../../constants/custom_elements":57,"../../lang/app_json":629,"../../lang/appquery":651,"../../lang/btype_ids":652,"../../lang/elements/ElementInstance":669,"../../lang/elements/ServerElementInstance":673,"../../lang/elements/Transition":677,"../../lang/evaluation/allow_overrides_check":688,"../../lang/evaluation/element_eval":690,"../../lang/evaluation/element_props":691,"../../lang/evaluation/evaluate":695,"../../lang/nodes":721,"../../lang/shrink":728,"../../lib":741,"../../logger":744,"../../u":823,"../../u/shared/b_string":841,"../../u/shared/decaf":844,"../core_elements/core_elements_utilities/element_meta_actions":282,"../core_elements/core_elements_utilities/element_visibility":287,"../core_elements/shared/floating_groups":359,"../core_elements/shared/groups":360,"../core_elements/shared/popups":368,"../property_applications":412,"../shared_fields":414,"./shared/groups":360,"core-js/modules/web.dom-collections.iterator.js":1123}],291:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../property_applications");const s=e("../core_elements_utilities/element_transformer");const o=e("../../../lang/evaluation/element_eval");const a=e("../../../lang/evaluation/element_props");const{PADDING_VERSION:l}=e("../../../constants/elements");const c=e("../components/AlertComponent");s.make_element("Alert",{category:"visual elements",glyph_id:"alert",list_order:6,keyboard_shortcut:null,defaults:{font_color:"#947739",background_style:"bgcolor",bgcolor:"#FFF6B2",border_style:"none",border_width:1,border_color:"#FFDFC2",boxshadow_style:"none",padding_vertical:10,padding_horizontal:0,font_alignment:"center",width:200,height:37,fixed_width:true},updated_default_sizing:{width:280,height:48},field_names:{text:{default:"...edit me..."},at_to_top:{no_states:true,default:false}},property_applications(e){return[new i.Dimensions,new i.PaddingText,new i.PaddingFields({minimum_element_version:l,no_vertical_if_legacy_center:true,allow_legacy:true}),new i.Border,new i.BoxShadow,new i.Font,new i.FontShadow,new i.FontSpacing,new i.Background,new i.ResponsiveElement(e),new i.Opacity]},uses_css_responsive:true,solid_component:c,can_fit_width:true,can_fit_height:true,get_html(e){return"<div></div>"},can_defer_drawing(){return true},get_messages(e){return["show_alert"]},register(e){e.on_message("show_alert",(t=>{if(e.run_mode()){e.ensure_drawn()}if(e.is_drawn){e.message("do_show_alert",t);return}e.state("pending_alert",{orig_props:t,start_time:Date.now()})}))},initialize(e){const t=e.get_canvas();const n=()=>e.get_static_property("at_to_top")||e.get_static_property("collapse_when_hidden");if(e.edit_mode()){t.css("visibility","hidden")}else if(e.run_mode()||e.responsive_mode()){e._hide_me();if(n()){t.css("display","none")}if(e.responsive_mode()){e._has_been_hidden=true}}let i=null;e.autorun((()=>{const n=r.bbcode_to_html(o.evaluate_property(e,"text"));if(o.evaluate_property(e,"vertical_centering")){if(i==null){t.empty();i=r.div("",t)}i.html(n)}else{i=null;t.html(n)}}));e.on_message("do_show_alert",(s=>{var o,a;((o=i)!=null?o:t).html(r.bbcode_to_html(s.message));e._display_me();e._is_visible_me=true;e._update_visible();t.css({display:"",opacity:(a=s.fin_starting_opacity)!=null?a:0});r.velocity(t,{opacity:1},{duration:s.fade_in,complete_cb:()=>{e.setTimeout((()=>{var i;t.css("opacity",(i=s.fout_starting_opacity)!=null?i:1);r.velocity(t,{opacity:0},{duration:s.fade_out,complete_cb:()=>{if(n()){t.css("display","none")}e._hide_me();e._is_visible_me=false;e._update_visible()},display:""})}),s.hold)}})}));const s=e.state("pending_alert");if(s){e.message("do_show_alert",this._convert_pending_alert(s))}},starts_hidden:true,manual_position:false,change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,is_input:false,is_container:false,get_min_width(e){return 0},position_canvas(e,t){const{element:n}=t;if(t.get_static_property("at_to_top")){t.autorun((()=>{var i;const s={position:t.run_mode()?"fixed":"absolute","margin-left":"auto","margin-right":"auto","margin-top":"","margin-bottom":"","min-width":a.min_width_css(t),"min-height":a.min_height_css(t),"max-height":(i=a.max_height_css(t))!=null?i:"","z-index":2e4};const l=a.max_width_css(t);for(const e of["left","right","top","bottom"]){s[e]=o.evaluate_property(t,`margin_${e}`)}if(n.fit_width()){s.width="auto";const e=`calc(100% - ${s.left+s.right}px)`;if(l!=null){s["max-width"]=r.apply_css_fallbacks("max-width",[`min(${l}, ${e})`,l])}else{s["max-width"]=e}}else{s.width="initial";s["max-width"]=l!=null?l:""}if(n.fit_height()){s.bottom="unset";s.height="auto"}else{s.height="initial"}e.css(s)}));if(t.run_mode()){$("body").append(e)}else if(t.edit_mode()){t.container.setup_margins(t);$(".canvas").append(e)}else{t.container.container_canvas.append(e)}}else{t.container.add(t)}},added_to_container(e){return!e.get_static_property("at_to_top")},goes_on_document(e){var t;if(e==null){return false}return((t=e.root())==null?void 0:t.get_responsive_version())>0&&e.get_static_property("at_to_top")},not_draggable(e){return this.goes_on_document(e)},_convert_pending_alert(e){let{start_time:t,orig_props:n}=e;const i=e=>Math.min(Math.max(e,0),1);const s=Date.now();const o=i((s-t)/n.fade_in);const a=t+n.fade_in;const l=i((s-a)/n.hold);const c=a+n.hold;const u=i((s-c)/n.fade_out);return r.extend(n,{fin_starting_opacity:o,fade_in:n.fade_in*(1-o),hold:n.hold*(1-l),fout_starting_opacity:1-u,fade_out:n.fade_out*(1-u)})},get_private_messages(){return["do_show_alert","position_element"]},update_show(e){}})},{"../../../constants/elements":61,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../u":823,"../../property_applications":412,"../components/AlertComponent":245,"../core_elements_utilities/element_transformer":285,"core-js/modules/web.dom-collections.iterator.js":1123}],292:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("lodash/isEqual");const i=e("lodash/escape");const s=e("../../../u");const o=e("../../../db/hydrate");const a=e("../../../u/shared/mode_check");const l=e("../../../lib");const c=e("../../property_applications");const u=e("../../../lang/btypes");const d=e("../../../geolocation/b_location");const p=e("../../../geolocation/client/google_maps");const _=e("../../../geolocation/location_lookups");const f=e("../../../languages");const h=e("../../../logger");const m=e("../../../webfonts");const g=e("../core_elements_utilities/element_utils");const v=e("../core_elements_utilities/element_workflows");const b=e("../core_elements_utilities/element_optional_utils");const y=e("../../../lang/evaluation/page_state");const w=e("../shared/inputs");const x=e("../../../lang/evaluation/element_eval");const j=e("../../../lang/evaluation/element_props");const{PADDING_VERSION:A}=e("../../../constants/elements");const M=e("../../../lang/color_tokens");const E=e("../core_elements_utilities/element_transformer");E.make_element("AutocompleteDropdown",{category:"input forms",display:"Search Box",glyph_id:"search",list_order:5,defaults:s.extend({},w.default_for_inputs,{width:400,height:45,use_max_width:true,max_width:150}),updated_default_sizing:{width:250,height:48},default_states:w.default_states_for_inputs,properties_for_new:{no_language:true},field_names:s.extend({placeholder:{default:"Start typing..."},choices_style:{default:"dynamic",no_states:true},choices:{no_states:true},data_source:{no_states:true},field_to_search:{no_states:true},no_language:{no_states:true},location:{optional:true},radius:{optional:true},default:{optional:true},allow_not_in_list:{no_states:true},mandatory:{},ac_list_max:{default:10}},w.get_disabled_field_name,w.get_auto_binding_field_names),property_applications(e){return[new c.Dimensions,new c.Background("input:first-of-type"),new c.Border("input"),new c.BoxShadow("input"),new c.Font("input"),new c.FontSpacing("input",["line_height"]),new c.InputPadding("input"),new c.PaddingFields({selector:"input",minimum_element_version:A,allow_legacy:true}),new c.PlaceholderColor("input"),new c.ResponsiveElement(e),new c.Opacity]},uses_css_responsive:true,get_html(e){return"<div></div>"},get_min_width(e){return 0},can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{var t;const n=e.get_canvas();const A=$('<input type="text"></input>');w.reset_input_div(A);A[0].style["box-sizing"]="border-box";n.append(A);n[0].style.overflow="visible";if(((t=e.element.root())==null?void 0:t.get_responsive_version())>0){A.css({height:"100%",width:"100%"})}else{x.pre_cache(e,["height","width"]);e.autorun((()=>{const t={};for(const n of["height","width"]){t[n]=x.evaluate_property(e,n)}n.find("input").css({height:t.height,width:t.width})}));g.register_tab_index_listener(e,(e=>{A.attr("tabindex",e)}))}const E={};const k={};let O=e.get_static_property("choices_style");let S=e.get_static_property("field_to_search");const D=e.get_static_property("field_to_display");let C={};let T={};const N=(t,n)=>{if(t==null){return""}if(O==="geographic_places"){if(e.edit_mode()&&!e.element.property("default").is_static()){return e.element.property("default").get_tree_display()}else{return u.get("geographic_address").runmode_display(t)}}else if(O==="dynamic"){let e=t.child(S).get();if(E[e]!=null&&E[e]!==t){let n=false;let i=0;for(const[s,a]of Object.entries(E)){if(s===e||s.indexOf(e+" (")===0){i++;if(r(o.dehydrate_tree(t),o.dehydrate_tree(a))){e=s;n=true;break}}}if(!n){e=e+" ("+i+")"}}E[e]=t;return e}else if(O==="algolia_search"){return t.child(n!=null?n:D).get()}else{return t}};const P=t=>{O=e.get_static_property("choices_style");if(O==="geographic_places"){let e;const n=C[t];if(n){e=function(){const e=T[n];const t=d.from_place_id(n);if(t){t.name=e}return t};e.toUniqueString=()=>n}else{e=()=>d.from_address(t);e.toUniqueString=()=>t}return e}else if(["dynamic","algolia_search"].includes(O)){return E[t]}else{if(this._get_static_choices(e).includes(t)){return t}else{return null}}};e.autorun((()=>{A.focus((()=>{y.input_focused(true)}));A.blur((()=>{y.input_focused(false)}));A.attr("placeholder",x.evaluate_property(e,"placeholder"))}));e.autorun((()=>{if(f.is_rtl(l().app_language())){n.find("input").attr("dir","rtl")}else{n.find("input").attr("dir","ltr")}}));if(e.run_mode()){var I;let R;O=e.get_static_property("choices_style");switch(O){case"static":{const G=this._get_static_choices(e).map((e=>({value:e})));R=function(e,t){const n=G.filter((t=>t.value.toLowerCase().indexOf(e.trim().toLowerCase())!==-1));return t(n)};break}case"dynamic":{R=(t,n)=>{if(!S){n([]);return}s.run_once(30,(()=>{const n=x.evaluate_property(e,"data_source");if(!n){return[]}const r={constraint_type:/[^a-zA-Z0-9]/.exec(t)!=null?"match_phrase_prefix":"prefix_search",key:S,value:t.trim().toLowerCase(),opts:{no_language:e.get_static_property("no_language")}};const i=n._creation_eval_node;const s=n.filter([r]);s._creation_eval_node=i;const o=s.get_children(0,x.evaluate_property(e,"ac_list_max"));return o.map((e=>({value:N(e)})))}),((e,t)=>{if(e){h.log(e);return}return n(t)}))};break}case"geographic_places":{p.load_google_map_api();const V=["geocode"];R=(t,n)=>s.run_once(30,(()=>({location:x.evaluate_property(e,"location"),radius:x.evaluate_property(e,"radius")})),((e,r)=>{let{location:i,radius:s}=r;C={};T={};return _.get_address_place_autocomplete({input:t,types:V,location:i,radius:s},(e=>{for(const t of e){C[t.description]=t.place_id;T[t.place_id]=t.structured_formatting.main_text}return n(e.map((e=>({value:e.description}))))}))}));break}case"algolia_search":{const H=e.element.property("algolia_source");const X=H.property("type_to_find").get_static();S=H.property("field_to_search").get_static();if((b==null?void 0:b.optional_modules.algolia_autocomplete_source)==null){throw new s.UnexpectedError("Missing algolia autocomplete source")}R=(e,t)=>b.optional_modules.algolia_autocomplete_source({query:e,type_to_find:X,field_to_display:D,field_to_search:S,cb:t,cache_text_to_object:E,cache_text_to_field_name:k});break}default:{throw new s.UnexpectedError("Invalid choices_style property in Autocomplete Dropdown",{choices_style:O})}}const L=x.evaluate_property(e,"font_alignment")==="left";const z=(t,n)=>R(t,(t=>{var r;const i=t.slice(0,(r=x.evaluate_property(e,"ac_list_max"))!=null?r:undefined);n(i);return q()}));A.typeahead({minLength:2,highlight:true,hint:L},{source:z,templates:{suggestion(e){return`<p>${i(e.value)}</p>`}}});if(((I=e.element.root())==null?void 0:I.get_responsive_version())>0){n.find(".twitter-typeahead").css("height","100%")}w.register_focus(e,A);n.find("input:first-of-type").css("border-radius",x.evaluate_property(e,"border_roundness"));e.on_message("set_focus",(()=>A.focus()));let B=null;const q=()=>s.run_once(30,(()=>({font_color:x.evaluate_property(e,"font_color"),font_face:j.get_font_face(e),font_size:x.evaluate_property(e,"font_size"),width:x.evaluate_property(e,"width"),border_radius:x.evaluate_property(e,"border_roundness"),is_rtl:f.is_rtl(l().app_language())})),((e,t)=>{if(e){h.log(e);return}const r=s.lighten_color(s.rgb_to_hex(M.color_property_to_rgba(t.font_color)).code,.5);n.find(".tt-hint").css("color",r);let{left:i,top:o}=n.offset();if(s.is_fixed(A)){o=o+n.height()-1-$(window).scrollTop()}else{o=o+n.height()-1}const a={"font-family":m.get_face_and_variant(t.font_face).font_family,"font-size":t.font_size+"px","min-width":t.width+"px","border-radius":t.border_radius+"px",top:o+"px",left:i+"px",right:"initial","z-index":1e4,position:s.is_fixed(n)?"fixed":"absolute","text-align":t.is_rtl?"right":"left"};c.apply_css_style(B,a);if(s.is_on_mobile_or_tablet()){B.off("touchend");B.on("click",(e=>{var t;e.stopPropagation();const n=$(e.target);const r=n.prop("tagName")==="STRONG"?n.parent().text():n.text();const i=P(r);if(i){W(i);if(O==="geographic_places"){var o;(o=A.typeahead)==null?void 0:o.call(A,"val",r)}else{s.run_once(30,(()=>N(i,k[r])),((e,t)=>{var n;if(e){h.log(e);return}(n=A.typeahead)==null?void 0:n.call(A,"val",t)}))}}else{U();W(null)}return(t=A.typeahead)==null?void 0:t.call(A,"close")}))}}));e.wait_for_visible((()=>{B=n.find(".tt-dropdown-menu");B.detach();$("body").append(B);q()}));A.on("typeahead:opened touchstart",(()=>q()));function U(){if(!e.get_static_property("allow_not_in_list")){A.typeahead("val","")}}e.on_message("reset_input",(()=>{if(e.get_static_property("allow_not_in_list")){e.state("typed_content",null)}}));function F(){const t=A.typeahead("val");if(!t){s.run_once(10,(()=>({existing_val:e.state("value"),typed_content:e.state("typed_content")})),((e,t)=>{if(e){h.log(e);return}const{existing_val:n,typed_content:r}=t;if(n||r){W(null)}}));return}const n=P(t);if(n==null){U();W(null)}else{W(n)}}function W(t){if(["dynamic","static","algolia_search"].includes(O)&&!t&&e.get_static_property("allow_not_in_list")){if(e.state("typed_content")!==A.typeahead("val")){e.state("typed_content",A.typeahead("val"));e.state("has_been_changed",true);e.state("value",null);v.run_element_workflow(e,"InputChanged")}}else{e.state("typed_content",null);e.message("user_submit",t)}}if(!s.is_on_mobile_or_tablet()){let Y=Date.now();A.on("typeahead:closed",(()=>{if(Date.now()-Y>200||a.running_test()){Y=Date.now();F()}}));A.on("blur.autocomplete",(()=>{if(Date.now()-Y>200||a.running_test()){Y=Date.now();F()}}))}else{A.on("blur",(()=>{F()}))}A.on("keydown",(e=>{if(e.keyCode===13){A.blur()}}));e.autorun((()=>{const t=x.evaluate_property(e,"not_submit_on_enter");w.assign_enter_handler_in_input(e,t)}));if(O==="dynamic"){const K=s.Watcher((()=>{if(!e.state("has_been_changed")){return false}const t=e.state("value");if(t==null){return false}const n=x.evaluate_property(e,"data_source");if(!n){return true}const r=u.get(e.element.property("data_source").property("type_to_find").json.get());return!n.contains(t,r)}));e.on_destroy((()=>K.destroy()));K.on_value((t=>{if(t){e.message("reset_input")}}))}e.on_destroy((()=>{var e;return(e=A.typeahead)==null?void 0:e.call(A,"destroy")}));x.on_property_change(e,"disabled",(e=>A[0].disabled=e))}w.input_change_autorun(e,(t=>{const n=N(t);if(e.run_mode()){var r;(r=A.typeahead)==null?void 0:r.call(A,"val",n)}else{A.val(n)}}))}))},_get_static_choices(e){let t=e.get_static_property("choices");if(typeof t!=="string"){t=""}return t.split("\n").map((e=>e.trim()))},get_starting_content(e){let t;if(e.run_mode()&&e.get_static_property("auto_binding")){t=w.get_input_parent_thing_field(e)}else{t=x.evaluate_property(e,"default")}if(t==null){return null}const n=e.get_static_property("choices_style");if(n==="geographic_places"){if(!e.run_mode()&&!e.element.property("default").is_static()){t={address:t}}if(!u.get("geographic_address").runmode_display(t)){t=d.from_address(t);if(!u.get("geographic_address").runmode_display(t)){return null}}}else if(n==="static"){if(this._get_static_choices(e).indexOf(t)===-1){return null}}else{const n=x.evaluate_property(e,"data_source");const r=u.get(e.element.property("data_source").property("type_to_find").get_static());if(!n||!n.contains(t,r)){return null}}return t},content_validated(e,t){if(!x.evaluate_property(t,"mandatory")){return true}if(e!=null){return true}if(t.get_static_property("allow_not_in_list")){return t.state("typed_content")!=null}},get_state_value(e,t){var n,r;if(t==="value"){const t=e.get_static_property("choices_style");switch(t){case"static":return"text";case"geographic_places":return"geographic_address";case"dynamic":return(n=e.property("data_source").property("type_to_find").json.get())!=null?n:"text";case"algolia_search":return(r=e.property("algolia_source").property("type_to_find").json.get())!=null?r:"text"}}else if(t==="typed_content"){return"text"}},get_states(e){return["typed_content"]},add_specific_messages(e,t){if(t.get_static_property("choices_style")!=="geographic_places"){s.extend(e,{get_typed_content:{description:"'s typed text",section:"States",ret_btype:"text",fn(e,t,n,r,i){var s;return(s=e==null?void 0:e.state("typed_content"))!=null?s:this.ret_btype_null()}}})}if(t.get_static_property("choices_style")==="geographic_places"){return s.extend(e,{get_place_name:{description:"'s place name",section:"States",ret_btype:"text",fn(e,t,n,r,i){var s;const o=e==null?void 0:e.state("value");if(!o){return this.ret_btype_null()}return(s=e==null?void 0:e.state("value").name)!=null?s:this.ret_btype_null()}}})}},change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:true,is_input:true,is_container:false,only_send_to_client_in_runmode:true,jquery_plugins(){return["jquery_plugins/typeahead.jquery.min"]},css_files:["css/optional/typeahead.css"]})},{"../../../constants/elements":61,"../../../db/hydrate":429,"../../../geolocation/b_location":621,"../../../geolocation/client/google_maps":623,"../../../geolocation/location_lookups":625,"../../../lang/btypes":653,"../../../lang/color_tokens":657,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../lang/evaluation/page_state":698,"../../../languages":739,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../../u/shared/mode_check":851,"../../../webfonts":858,"../../property_applications":412,"../core_elements_utilities/element_optional_utils":283,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_utils":286,"../core_elements_utilities/element_workflows":288,"../shared/inputs":364,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/escape":1313,"lodash/isEqual":1321}],293:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../property_applications");const s=e("../core_elements_utilities/element_transformer");const o=e("../core_elements_utilities/element_workflows");const a=e("../../../lang/evaluation/element_eval");const l=e("../components/ButtonComponent");s.make_element("Button",{category:"visual elements",glyph_id:"button",list_order:2,keyboard_shortcut:null,defaults:{font_alignment:"center",font_color:"#FFFFFF",background_style:"bgcolor",bgcolor:"#7F95EB",border_style:"none",border_roundness:3,border_width:1,border_color:"#7F95EB",boxshadow_style:"none",border_style_top:"none",border_roundness_top:3,border_width_top:1,border_color_top:"#7F95EB",border_style_left:"none",border_roundness_left:3,border_width_left:1,border_color_left:"#7F95EB",border_style_bottom:"none",border_roundness_bottom:3,border_width_bottom:1,border_color_bottom:"#7F95EB",border_style_right:"none",border_roundness_right:3,border_width_right:1,border_color_right:"#7F95EB",width:150,height:45,use_max_width:true,max_width:100,min_width:50},default_states:[{condition:{type:"ThisElement",next:{type:"Message",name:"is_hovered"}},properties:{bgcolor:"#9DA9E8",border_color:"#9DA9E8"}},{condition:{type:"ThisElement",next:{type:"Message",name:"is_pressed"}},properties:{bgcolor:"#6C7FEB",border_color:"#6C7FEB"}}],field_names:r.extend({text:{default:"...edit me..."}},o.start_workflow_field_names),uses_css_responsive:true,can_fit_width:true,can_fit_height:true,property_applications(e){return[new i.Dimensions,new i.Font,new i.FontShadow,new i.FontSpacing,new i.Border,new i.BoxShadow,new i.Background,new i.ResponsiveElement(e),new i.ToolTip,new i.Rotation,new i.PaddingFields,new i.Opacity]},get_html(e){return"<button></button>"},change_cursor_style_if_clickable:true,can_defer_drawing(){return true},initialize(e){const t=e.get_canvas();i.apply_css_style(t,{padding:"0px",cursor:"inherit",background:"none",border:"none","text-align":"left"});e.wait_for_visible_lite((()=>a.on_property_change(e,["text","background_style"],(e=>{let{text:n,background_style:r}=e;t.text(n);if(r==="none"){(new i.NoSelect)._apply(true,t)}}))))},is_input:false,is_container:false,add_an_invisible_div_on_the_top:false,events:["ButtonClicked"],get_min_width(e){return 0},solid_component:l})},{"../../../lang/evaluation/element_eval":690,"../../../u":823,"../../property_applications":412,"../components/ButtonComponent":246,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_workflows":288}],294:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../property_applications");const s=e("../../../constants/runmode");const o=e("../core_elements_utilities/element_transformer");const a=e("../shared/inputs");const l=e("../../../lang/evaluation/element_eval");const c=e("../components/CheckboxComponent");o.make_element("Checkbox",{category:"input forms",glyph_id:"checkbox",list_order:3,keyboard_shortcut:null,defaults:{width:180,height:20,min_width:50},default_states:[{condition:{type:"ThisElement",next:{type:"Message",name:"isnt_valid"}},properties:{border_color:"#FF0000",boxshadow_color:"#FF0000",boxshadow_style:"outset",boxshadow_horizontal:0,boxshadow_vertical:0,boxshadow_blur:4}}],field_names:r.extend({label:{default:"...edit me...",optional:true},contents:{default:"unchecked"},dynamic:{},mandatory:{}},a.get_disabled_field_name,a.get_auto_binding_field_names),property_applications(e){return[new i.Dimensions,new i.Font,new i.FontShadow,new i.FontSpacing,new i.BoxShadow("input"),new i.ResponsiveElement(e),new i.PaddingFields,new i.Opacity]},uses_css_responsive:true,can_fit_width:true,can_fit_height:true,can_defer_drawing(){return true},solid_component:c,use_legacy_in_editor:true,use_legacy_in_thumbnail:true,get_html(e){return"<div></div>"},get_min_width(e){return 0},initialize(e){return e.wait_for_visible_lite((()=>{const t=e.get_canvas();t[0].style.overflow="visible";const n=r.LUID();const i=$(`<input type="checkbox" id="${n}" style="background-color: white;"></input>`);const o=$(`<label for="${n}"></label>`);t.append(i);t.append(o);a.register_focus(e,i);e.on_message("set_focus",(()=>i.focus()));if(e.run_mode()){t.addClass(s.CLICKABLE_ELEMENT);i.change((()=>{var t;e.message("user_submit",(t=i[0].checked)!=null?t:false);return true}));l.on_property_change(e,"disabled",(e=>{i[0].disabled=e}))}l.on_property_change(e,"label",(e=>{o.text(e)}));a.input_change_autorun(e,(e=>{if(typeof e==="string"&&["false","no","null","none","undefined"].includes(e.toLowerCase())){e=false}if(e){i[0].checked=true}else{i[0].checked=false}}))}))},get_starting_content(e){if(e.run_mode()&&e.get_static_property("auto_binding")){return a.get_input_parent_thing_field(e)}const t=l.evaluate_property(e,"contents");if(t==="checked"){return true}else if(t==="unchecked"){return false}else{return l.evaluate_property(e,"dynamic")}},get_state_value(e,t){if(t==="value"){return"sys.bool"}return undefined},content_validated(e,t){if(!e&&l.evaluate_property(t,"mandatory")){return false}else{return true}},change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:true,is_input:true,is_checkbox:true,is_container:false})},{"../../../constants/runmode":83,"../../../lang/evaluation/element_eval":690,"../../../u":823,"../../property_applications":412,"../components/CheckboxComponent":247,"../core_elements_utilities/element_transformer":285,"../shared/inputs":364}],295:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../lang/appquery");const i=e("../../../lang/btypes");const s=e("../core_elements_utilities/element_transformer");const o=e("../shared/inputs");const a=e("../../../languages");const l=e("../../../lib");const c=e("../../../logger");const u=e("../../property_applications");const d=e("../../../constants/runmode");const p=e("../../../u/client/datepickerTranslationsList");const{PADDING_VERSION:_}=e("../../../constants/elements");const f=e("../../../u");const h=e("../../../u/shared/b_date");const m=e("../../custom_tz_utilities");const g=e("../../../webfonts");const v=e("../../../lang/evaluation/element_eval");const b=e("../../../lang/evaluation/element_props");const{has_input_timezone_controls_on:y}=e("../../../lang/timezone_override_settings");const w=f.require_moment();e("core-js/modules/web.queue-microtask.js");function x(e,t){if(!t){return}const n=i.get("date").cast(t);if(!n){return}const r=j(e);const s=w(n).tz(r);return[s.year(),s.month(),s.date()]}function j(e){if(y()){return m.get_custom_tz({static_eval:t=>e.get_static_property(t),dynamic_eval:t=>v.evaluate_property(e,t),not_overridden:true})}else{return l().current_timezone()}}function A(e,t){let n="";switch(t){case"number1":n+="d/mm/yyyy";break;case"number2":n+="m/dd/yyyy";break;case"alpha":n+="d mmmm, yyyy";break;case"alphalong":n+="dddd, d mmmm, yyyy";break;case"alphashort":n+="d-mmm-yyyy";break;case"us_short":n+="mmmm d, yyyy";break;case"us_long":n+="dddd, mmmm d, yyyy";break;case"custom":n+=e.get_static_property("custom_format");break}return n}s.make_element("DateInput",{display:"Date/Time Picker",category:"input forms",glyph_id:"datetime",list_order:8,keyboard_shortcut:null,defaults:{font_size:14,font_color:"#3D3D3D",background_style:"bgcolor",border_style:"solid",border_color:"#BDBDBD",border_roundness:3,border_width:1,border_roundness_top:3,border_style_left:"solid",border_width_left:1,border_color_left:"#BDBDBD",border_roundness_left:3,border_style_bottom:"solid",border_width_bottom:1,border_color_bottom:"#BDBDBD",border_roundness_bottom:3,border_style_right:"solid",border_width_right:1,border_color_right:"#BDBDBD",border_roundness_right:3,padding_horizontal:4,padding_vertical:0,width:250,height:45,use_max_width:true,max_width:150},updated_default_sizing:{height:48},default_states:o.default_states_for_inputs,field_names:f.extend({input_type:{default:"date",no_states:true},content:{},overwrite_placeholder:{no_states:true},placeholder:{optional:true},date_format:{default:"number2",no_states:true,in_style:true},custom_format:{default:"ddd, m/dd/yy, mmmm (mmm) dS, yyyy",no_states:true,in_style:true},start_monday:{no_states:true},time_interval:{default:30,no_states:true},time_format:{default:"full",no_states:true},min_date:{},max_date:{},min_hour:{},max_hour:{},show_month_year_picker:{no_states:true},mandatory:{}},o.get_disabled_field_name,o.get_auto_binding_field_names,m.custom_tz_field_names),property_applications(e){return[new u.Dimensions,new u.Background("input"),new u.Border("input"),new u.BoxShadow("input"),new u.Font("input"),new u.FontSpacing("input",["line_height"]),new u.InputPadding("input"),new u.PaddingFields({selector:"input",minimum_element_version:_,allow_legacy:true}),new u.PlaceholderColor("input"),new u.ResponsiveElement(e),new u.Opacity]},uses_css_responsive:true,additional_uses_properties:["input_type"],get_html(e){return"<div></div>"},get_min_width(){return 0},can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{let t,n;const i=e.get_canvas();i.addClass("date_picker_element");i[0].style.overflow="visible";const s=$('<input type="text" class="date_div"></input>');o.reset_input_div(s);i.append(s);const a=$('<input type="text" class="time_div"></input>');o.reset_input_div(a);v.on_property_change(e,"input_type",(e=>{if(e==="date_time"){i.append(a)}else{a.detach()}}));v.on_property_change(e,"disabled",(e=>{u.apply_css_style(s,{cursor:e?"default":"pointer"});u.apply_css_style(a,{cursor:e?"default":"pointer"})}));v.pre_cache(e,["input_type","padding_horizontal","date_format","time_format","placeholder","overwrite_placeholder"]);e.autorun((()=>{let t,n;const i={};for(const t of["input_type","padding_horizontal","date_format","time_format","placeholder","overwrite_placeholder","padding_top","padding_bottom","padding_left","padding_right"]){i[t]=v.evaluate_property(e,t)}const o=u.calculate_border_height(e);const c=u.calculate_border_width(e);const d=e.element.element_version(true)<_?2*i.padding_horizontal:i.padding_left+i.padding_right;const p=e.element.element_version(true)<_?0:i.padding_top+i.padding_bottom;const f=r.get_public_setting("bubble_version")<18;const m=f?`calc(100% - ${o}px)`:`calc(100% - ${p+o}px)`;u.apply_css_style(s,{height:m,"box-sizing":"content-box"});if(i.input_type==="date_time"){const e=f?70:72;const t=f?5:8;u.apply_css_style(s,{width:`calc(100% - ${2*d+2*c}px - ${e+t}px)`,float:"left"});u.apply_css_style(a,{width:`${e}px`,float:"right",height:`calc(100% - ${p+o}px)`,"box-sizing":"content-box"})}else{s[0].style.width=`calc(100% - ${d+c}px)`}if(i.input_type==="date"&&i.overwrite_placeholder){t=i.placeholder}else{let n;if(r.app().id()==="test_app"){var g;const t=(g=j(e))!=null?g:l().current_timezone();n=w.tz("1/15/2013",t).toDate()}else{n=new Date}const s=A(e,i.date_format);t=h.format_date(n,s,l().get_text("BUILT_IN","DATE_FORMAT"),j(e))}s.attr("placeholder",t);switch(i.time_format){case"full":n="12:00";break;case"ampm":n="12:00 AM";break}return a==null?void 0:a.attr("placeholder",n)}));if(e.run_mode()){i.addClass(d.CLICKABLE_ELEMENT);function p(){var r;if((r=t)!=null&&r.get()){const r=t.get("select");const o={year:r.year,month:r.month,day:r.date};if(e.get_static_property("input_type")==="date_time"){const e=n.get("select");if(!e){return undefined}else{var i,s;o.hour=(i=e==null?void 0:e.hour)!=null?i:"";o.minute=(s=e==null?void 0:e.mins)!=null?s:""}}return w.tz(o,j(e)).toDate()}else{return null}}function m(){this.$holder.blur();f.run_once(30,p,((t,n)=>{e.state("is_focused",false);if(n!==undefined){e.message("user_submit",n)}}));return true}function y(t){let{$holder:n,$root:r}=t;n.css("transition","0.05s ease-in-out");n.position({my:"left top",at:"left bottom",of:e.get_canvas(),collision:"fit flip"});if(l().bubble_version()<19){r.addClass("datepicker-legacy-font")}}function M(){return y(this)}function E(r){queueMicrotask((()=>{y(r);e.setTimeout((()=>y(r)),100)}));$(window).on("resize",(()=>y(r)));const i=e.get_canvas();f.run_once(30,(()=>({width:i.width(),"font-family":g.get_face_and_variant(b.get_font_face(e)).font_family,top:0})),((e,r)=>{var i;if(e){c.log(e)}t.$root.css(r);(i=n)==null?void 0:i.$root.css(r)}))}function k(){e.state("is_focused",true);E(this)}const O=e.get_static_property("show_month_year_picker");s.pickadate({container:"html",firstDay:e.get_static_property("start_monday"),selectMonths:O,selectYears:O&&200,onOpen:k,onClose:m,format:A(e,e.get_static_property("date_format"))});t=s.pickadate("picker");e.wait_for_visible((()=>{E(t);e.setTimeout((()=>E(t)),100)}));let S=false;const D={};if(e.get_static_property("input_type")==="date_time"){S=true;D.container="html";D.interval=e.get_static_property("time_interval");switch(e.get_static_property("time_format")){case"full":D.format="H:i";break;case"ampm":D.format="h:i A";break}D.onClose=m;D.onOpen=k;D.onRender=M;a.pickatime(D);n=a.pickatime("picker")}function C(e){if(!e){return false}const t=Math.floor(e);const n=Math.round((e-t)*60);return[t,n]}e.autorun((()=>{var r,i;const s=v.evaluate_property(e,"min_date");const o=v.evaluate_property(e,"max_date");t.set({min:(r=x(e,s))!=null?r:-Infinity,max:(i=x(e,o))!=null?i:Infinity});if(S){const t=v.evaluate_property(e,"min_hour");const r=v.evaluate_property(e,"max_hour");n.set({min:C(t),max:C(r)})}let a;e.autorun((()=>{const r=j(e);if(e.state("has_been_changed")&&r===a){return}a=r;const i=e.state("value");if(f.autorun_top((()=>e.state("is_focused")))){return}if(i){t.set("select",x(e,i));if(S){const t=j(e);const r=w(i).tz(t);n.set("select",[r.hours(),r.minutes()])}}else{t.clear();if(S){n.clear()}}}))}));e.autorun((()=>{const n=v.evaluate_property(e,"min_date");const r=v.evaluate_property(e,"max_date");const i=e.state("value");if(t.get("select")){if(n!=null&&i<n){t.set("select",x(e,n));e.state("value",n)}else if(r!=null&&i>r){const s=r>=n?r:n!=null?n:i;t.set("select",x(e,s));e.state("value",s)}}}));e.autorun((()=>{t.$root.css({"margin-top":e.current_height(),"max-width":e.current_width()});if(e.get_static_property("input_type")==="date_time"){n.$root.css({"margin-top":e.current_height(),"max-width":e.current_width()})}}));v.on_property_change(e,"disabled",(e=>{s[0].disabled=e;if(a!=null){a[0].disabled=e}}))}o.register_focus(e,i.find("input"));e.on_message("set_focus",(()=>{if(!s[0].disabled){t.open()}}));if(!e.run_mode()){s.attr("readonly","true");a==null?void 0:a.attr("readonly","true")}}))},get_starting_content(e){if(e.run_mode()&&e.get_static_property("auto_binding")){return o.get_input_parent_thing_field(e)}return v.evaluate_property(e,"content")},content_validated(e,t){return e||!v.evaluate_property(t,"mandatory")},change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,is_input:true,is_container:false,get_state_value(e,t){if(t==="value"){return"date"}},jquery_plugins(e,t,n){const r=["jquery_plugins/datepicker/picker","jquery_plugins/datepicker/picker.date","jquery_plugins/datepicker/picker.time","jquery_plugins/jquery-ui.position.min"];if(typeof l().appname==="function"){var i;let e=a.get_iso_code(n);const t=(i=e.split(/[-_]/))==null?void 0:i[0];if(t==="en"){return r}const s=p[t];if(s==null){c.warn("Missing datepicker translation",{lang_file:e});return r}if(!s.includes(e)){e=s[0]}r.push(`jquery_plugins/datepicker/${e}`)}return r},css_files:["css/optional/datepicker.css"]})},{"../../../constants/elements":61,"../../../constants/runmode":83,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../lang/timezone_override_settings":729,"../../../languages":739,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../../u/client/datepickerTranslationsList":819,"../../../u/shared/b_date":836,"../../../webfonts":858,"../../custom_tz_utilities":380,"../../property_applications":412,"../core_elements_utilities/element_transformer":285,"../shared/inputs":364,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.queue-microtask.js":1125}],296:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../db/hydrate");const s=e("../../../lib");const o=e("../../../lang/appquery");const a=e("../../property_applications");const l=e("create-hash");const c=e("../../../logger");const u=e("../../../lang/btypes");const d=e("../core_elements_utilities/element_utils");const p=e("../core_elements_utilities/element_transformer");const _=e("../shared/inputs");const f=e("../shared/dropdowns");const h=e("../../../lang/evaluation/element_eval");const m="BLANK_1427118194589";const g="PLACEHOLDER_1427118222253";const v=5e3;p.make_element("Dropdown",{category:"input forms",glyph_id:"dropdown",list_order:4,keyboard_shortcut:null,defaults:{font_size:14,background_style:"bgcolor",bgcolor:"#E6E6E6",border_style:"solid",border_width:1,border_color:"#858585",border_roundness:3,border_style_top:"solid",border_width_top:1,border_color_top:"#858585",border_roundness_top:3,border_style_left:"solid",border_width_left:1,border_color_left:"#858585",border_roundness_left:3,border_style_bottom:"solid",border_width_bottom:1,border_color_bottom:"#858585",border_roundness_bottom:3,border_style_right:"solid",border_width_right:1,border_color_right:"#858585",border_roundness_right:3,width:250,height:45,placeholder:"Choose an option...",use_max_width:true,max_width:150,placeholder_color:"#9C9C9C",padding_left:5,padding_right:15},updated_default_sizing:{height:48},default_states:_.default_states_for_inputs,field_names:r.extend({placeholder:{},choices_style:{default:"static",no_states:true},choices:{},dynamic_type:{no_states:true},data_source:{},option_display_expression:{},default:{},mandatory:{},placeholder_color:{in_style:true},computed_value:{optional:true,no_states:true}},_.get_disabled_field_name,_.get_auto_binding_field_names),property_applications(e){return[new a.Dimensions,new a.Font(null,null,["font_color"]),new a.Background,new a.Border,new a.BoxShadow,new a.ResponsiveElement(e),new a.ToolTip,new a.FontSpacing(null,["line_height"]),new a.PaddingFields,new a.Opacity]},get_html(e){return"<select></select>"},get_min_width(e){return 0},_get_display_option:f._get_display_option,can_defer_drawing(){return true},register(e){const t=r.Watcher((()=>{if(!e.state("has_been_changed")){return false}const t=e.state("value");if(t==null){return false}return!this._choice_list_contains(e,t)}));e.on_destroy((()=>t.destroy()));t.on_value((t=>{if(t){return e.message("reset_input")}}))},initialize(e){return e.wait_for_visible_lite((()=>{var t;const n=e.get_canvas();if(o.get_public_setting("bubble_version")>=16){n.addClass("dropdown-chevron")}if(((t=e.element.root())==null?void 0:t.get_responsive_version())>0){n.css("display","block")}else{n.css({"padding-left":5,"padding-right":15});if(e.run_mode()){d.register_tab_index_listener(e,(e=>{n.attr("tabindex",e)}))}}_.reset_input_div(n);let a=[];let u=null;function p(e){if(typeof e==="object"){const t=l("md5");t.update(JSON.stringify(e));const n=t.digest("hex");return n}return e}let b=null;function y(e){const t=$('<option class="dropdown-choice"></option>');t.text(e.display);const n=e.value;const r=i.dehydrate_tree(n);t.attr("value",JSON.stringify(r));if(u!=null){t[0].style.color=u}return t}const w=r.Box();r.autorun((()=>{u=h.evaluate_property(e,"font_color");if(w()){n[0].style.color=h.evaluate_property(e,"placeholder_color")}else{n[0].style.color=u}n.find("option").css("color",u)}));if(e.run_mode()){_.switch_disabled_or_not(e);n.on("click",(e=>e.stopPropagation()));const x=()=>{const t=this._get_raw_choice_list(e);const n=this._get_display_option(e);const i=t.get_children(0,v);r.run_once(30,(()=>i.map((e=>n(e)))));a=[];for(const e of i){a.push({display:n(e),value:e})}if(!h.evaluate_property(e,"mandatory")){a=[{display:"",value:m}].concat(a)}return a};function j(t){if(t==null){if(h.evaluate_property(e,"mandatory")||!e.state("has_been_changed")){t=g}else{t=m}}return JSON.stringify(i.dehydrate_tree(t))}let A=null;function M(e){A=e;return E(e)}function E(e){const t=j(e);const r=n.find(".dropdown-placeholder")[0];if(t===JSON.stringify(g)){w(true);if(r!=null){r.disabled=false}}else{w(false);if(r!=null){r.disabled=true}}return n.val(t)}function k(){let e=n.find(".dropdown-placeholder");if(e.length===0){e=y({display:"",value:g});e.addClass("dropdown-placeholder");e[0].style.display="none";n.prepend(e)}return e}e.autorun((()=>{const t=h.evaluate_property(e,"choices_style");if(t!=="static"){const t=h.get_property_watcher(e,"data_source");return t.on_not_ready((()=>r.run_once(30,(()=>s().get_text("CORE","LOADING")),((e,t)=>{if(e){c.log(e)}const n=k();n.text(t!=null?t:"");return E(g)}))))}}));const O=()=>{a=x();const t=h.evaluate_property(e,"placeholder");const s=[];for(const e of a){const t=e.value;const n=i.dehydrate_tree(t);const r=p(n);s.push([r,e.display])}let o;if(b!=null&&r.compare(s,b)){o=k();o.text(t);return}else{b=s}n.empty();o=k();o.text(t);let l=o;const c={};for(const e of a){const t=p(i.dehydrate_tree(e.value));if(c[t]){continue}else{c[t]=true}const n=y(e);l.after(n);l=n}return M(A)};n.change((()=>{let t=f.rehydrate_dropdown_value(JSON.parse(n.find("option:selected").attr("value")));if([g,m].includes(t)){t=null}e.message("user_submit",t);return M(t)}));_.input_change_autorun(e,(e=>M(e)));const S=r.Box(false);n.on("focus",(()=>S(true)));n.on("blur",(()=>S(false)));_.register_focus(e,n);const D=r.Box(false);e.autorun((()=>{if(e.is_visible()&&(!D()||!S())){O();return D(true)}}));e.on_message("set_focus",(()=>n.focus()))}else{r.autorun((()=>{let t=h.evaluate_property(e,"default");if(h.evaluate_property(e,"choices_style")==="static"&&!this._choice_list_contains(e,t)){t=null}if(t){w(false)}else{var r;t=(r=h.evaluate_property(e,"placeholder"))!=null?r:"Choose an option...";w(true)}n.empty();const i=y({display:t});i.attr("value","default_edit_mode");n.append(i);n.val("default_edit_mode");if(e.responsive_mode()){n[0].style["pointer-events"]="none"}}))}}))},_get_raw_btype(e){return f._get_raw_btype_dropdown(e)},_get_raw_choice_list(e){return f._get_raw_choice_list_dropdown(e,this)},_choice_list_contains(e,t){const n=u.get(this._get_raw_btype(e.element));return this._get_raw_choice_list(e).contains(t,n)},get_starting_content(e){let t;if(e.run_mode()&&e.get_static_property("auto_binding")){t=_.get_input_parent_thing_field(e)}else{t=h.evaluate_property(e,"default")}if(typeof t==="string"&&this._get_raw_btype(e.element)==="number"){t=s().locale().parse_float(t)}if(t==null||!this._choice_list_contains(e,t)){return null}return t},get_state_value(e,t){if(t==="value"){return this._get_raw_btype(e)}},get_injected_value(e){return e.get_static_property("dynamic_type")},get_injected_display(){return"Current option"},use_injected_datasource(e){return f.use_injected_datasource("option_display_expression",e)},content_validated(e,t){return e!=null||!h.evaluate_property(t,"mandatory")},uses_css_responsive:true,change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:true,is_input:true,is_container:false})},{"../../../db/hydrate":429,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../property_applications":412,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_utils":286,"../shared/dropdowns":358,"../shared/inputs":364,"core-js/modules/web.dom-collections.iterator.js":1123,"create-hash":1129}],297:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../property_applications");const s=e("../../../constants/runmode");const o=e("../../../constants/workflow");const a=e("../../core_events");const l=e("../../widgets");const c=e("../../widgets/fileupload");const u=e("../core_elements_utilities/element_utils");const d=e("../core_elements_utilities/element_transformer");const p=e("../shared/inputs");const _=e("../shared/sliderinputs");const f=e("../shared/pictureinputs");const h=e("../../../logger");const m=e("../../../lang/evaluation/element_eval");const{PADDING_VERSION:g}=e("../../../constants/elements");d.make_element("FileInput",{display:"File Uploader",category:"input forms",glyph_id:"file_uploader",list_order:10,keyboard_shortcut:null,defaults:{font_size:14,font_color:"#3D3D3D",background_style:"bgcolor",border_style:"solid",border_color:"#BDBDBD",border_roundness:3,border_style_top:"solid",border_width_top:1,border_color_top:"#BDBDBD",border_roundness_top:3,border_style_left:"solid",border_width_left:1,border_color_left:"#BDBDBD",border_roundness_left:3,border_style_bottom:"solid",border_width_bottom:1,border_color_bottom:"#BDBDBD",border_roundness_bottom:3,border_style_right:"solid",border_width_right:1,border_color_right:"#BDBDBD",border_roundness_right:3,border_width:1,font_alignment:"center",padding_horizontal:0,padding_vertical:15,width:200,height:45,use_max_width:true,max_width:150},updated_default_sizing:{height:48},default_states:p.default_states_for_inputs,field_names:r.extend({src:{},placeholder:{default:"Click to upload a file"},mandatory:{},private:{no_states:true},attach_to:{},service:{no_states:true},destination:{}},p.get_disabled_field_name,p.get_auto_binding_field_names,p.get_max_file_size_field_name),property_applications(e){return[new i.Dimensions,new i.Background,new i.Border,new i.BoxShadow,new i.Font(".file-input-text"),new i.FontSpacing(".file-input-text"),new i.PaddingText(".file-input-text"),new i.PaddingFields({selector:".file-input-text",minimum_element_version:g,no_vertical_if_legacy_center:true,allow_legacy:true}),new i.ResponsiveElement(e),new i.Opacity]},uses_css_responsive:true,get_html(e){return"<div></div>"},get_min_width(){return 0},can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{_.show_message_for_ios_8_upload_bug();const t=e.get_canvas();const n=$('<div class="file-input-text"></div>');i.apply_css_style(n,{"-moz-box-sizing":"border-box",position:"absolute",top:"0px",overflow:"hidden",width:"100%",height:"100%"});t.append(n);const d=r.Box();let g=null;function v(e){var t;if(!e){var r;d(true);(r=g)==null?void 0:r.attr("title",null);return}d(false);const i=e.split("/");const s=i[-1+i.length];n.text(s);(t=g)==null?void 0:t.attr("title",s)}r.autorun((()=>{if(d()){n.text(m.evaluate_property(e,"placeholder"))}}));p.input_change_autorun(e,(e=>{v(e)}));if(e.run_mode()){var b;let y;g=$('<input type="file"></input>');t.addClass(s.CLICKABLE_ELEMENT);function w(t){r.run_once(30,(()=>f.process_upload_security(e)),((e,n)=>{if(e){t(e)}else if(!n.public&&!n.attach_to){t(new r.UserError("PRIVATE_FILE"))}else{t(null,n)}}))}t.append(g);i.apply_css_style(g,{opacity:0,position:"absolute","z-index":1+n.css("z-index"),top:"0px",width:"100%",height:"100%","font-size":0});function x(){e.state("loading",true);e.state("upload_percent",0)}function j(t){var n;e.state("file_size",(n=g[0].files[0])==null?void 0:n.size);e.state("loading",false);e.state("upload_percent",100);v(t);e.message("user_submit",t);g[0].value=null}function A(t){a.handle_uncaught_error({original_error:t,caught_from:o.ERROR_SOURCES.ELEMENT,cb(t){if(t){window.alert(h.human_friendly(t))}e.state("loading",false);e.state("upload_percent",0)}})}function M(t){e.state("upload_percent",Math.min(Math.round(t*1e4)/100,100))}const E=e.get_static_property("service");function k(){var t;const n=(t=m.evaluate_property(e,"max_size"))!=null?t:0;const r=n*1e3*1e3;return r}if(E&&E!=="bubble"){l.MakeImageUploader({input:g,get_additional_data:w,cb_success:j,cb_start:x,cb_fail:A,max_file_size_fn:k})}else{y=c.make_presigned_uploader({instance:e,input:g,get_additional_data:w,cb_success:j,cb_start:x,cb_fail:A,cb_progress:M,max_file_size_fn:k})}if(((b=e.element.root())==null?void 0:b.get_responsive_version())===0){u.register_tab_index_listener(e,(e=>{g.attr("tabindex",e)}))}function O(){var t;(t=y)==null?void 0:t();e.state("loading",false);e.state("upload_percent",0);g[0].value=null}m.on_property_change(e,"disabled",(t=>{g[0].disabled=t;i.apply_css_style(g,{cursor:t?"default":"pointer"});i.apply_css_style(n,{cursor:t?"default":"pointer"});if(e.state("loading")&&t){O()}}));p.register_focus(e,g);e.on_message("set_focus",(()=>g.focus()));e.on_message("cancel_upload",(()=>{O()}))}m.on_property_change(e,"placeholder",(e=>{var t;if(((t=g)==null?void 0:t.val())!=null){return}n.text(e)}))}))},get_starting_content(e){if(e.run_mode()&&e.get_static_property("auto_binding")){return p.get_input_parent_thing_field(e)}return m.evaluate_property(e,"src")},get_state_value(e,t){if(t==="value"){return"file"}},get_states(e){return["loading","file_size","upload_percent"]},add_specific_messages(e,t){r.extend(e,f.file_inputs_additional_messages,{get_upload_percent:{description:"'s upload percentage",section:"States",ret_btype:"number",fn(e,t){return e==null?void 0:e.state("upload_percent")}}})},need_to_wait_before_checking_validity:true,content_validated(e,t){return e||!m.evaluate_property(t,"mandatory")},change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,is_input:true,is_file_uploader:true,is_container:false})},{"../../../constants/elements":61,"../../../constants/runmode":83,"../../../constants/workflow":95,"../../../lang/evaluation/element_eval":690,"../../../logger":744,"../../../u":823,"../../core_events":377,"../../property_applications":412,"../../widgets":421,"../../widgets/fileupload":420,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_utils":286,"../shared/inputs":364,"../shared/pictureinputs":367,"../shared/sliderinputs":372}],298:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../property_applications");const s=e("../core_elements_utilities/element_transformer");const o=e("../core_elements_utilities/element_workflows");const a=e("../../../constants/runmode");const l=e("../shared/groups");const c=e("../shared/floating_groups");const u=e("../../../lang/evaluation/element_eval");const d=e("../../../lang/evaluation/element_props");const p=e("../components/FloatingGroupComponent");const _=a.POPUP_ZINDEX-1;s.make_element("FloatingGroup",{display:"Floating Group",category:"containers",glyph_id:"floating_group",list_order:5,keyboard_shortcut:null,defaults:{floating_reference:"top",width:400,height:250},updated_default_sizing:{width:320},field_names:r.extend({},c.floating_field_names,o.start_workflow_field_names,l.container_field_names),property_applications(e){return[new i.Dimensions,new i.Background,new i.Border,new i.BoxShadow,new i.ResponsiveContainer(e),new i.ResponsiveElement(e),new i.PaddingFields,new i.Opacity]},uses_css_responsive:true,solid_component:p,attach_to_body(e){return e.run_mode()&&!this.added_to_container(e.element)},can_fit_width:true,can_fit_height:true,added_to_container(e){var t;return((t=e.parent())==null?void 0:t.type())!=="Page"},not_draggable(e){var t;return((t=e.root())==null?void 0:t.get_responsive_version())>0},goes_on_document(e){if(e==null){return true}return this.not_draggable(e)},get_min_width(){return 0},goes_on_document_for_drawing(){return true},position_canvas(e,t){const{element:n}=t;const s=t.element.parent();function o(){if(n.get_static_property("float_zindex")==="back"){return 0}else{let e;const n=$(".greyout");if(n.length===0){e=_-a.FLOATING_GROUP_ZINDEX_OFFSET}else{e=n.css("z-index")-a.FLOATING_GROUP_ZINDEX_OFFSET}if(!e||e<=0){e=2}const r=e+t.element.get_zindex();return r}}t.wait_for_visible_lite((()=>{t.autorun((()=>{const i={"margin-left":"","margin-right":"","margin-top":"","margin-bottom":"",width:"initial","min-width":d.min_width_css(t),"min-height":d.min_height_css(t)};const a=d.max_width_css(t);const l=d.max_height_css(t);for(const e of["left","right","top","bottom"]){i[e]=u.evaluate_property(t,`margin_${e}`)}if(n.fit_width()){i.width="auto";const e=`calc(100% - ${i.left+i.right}px)`;if(a!=null){i["max-width"]=r.apply_css_fallbacks("max-width",[`min(${a}, ${e})`,a])}else{i["max-width"]=e}}else{i.width="initial";i["max-width"]=a!=null?a:""}if(n.fit_height()){i.height="auto";const e=`calc(100% - ${i.top+i.bottom}px)`;if(l!=null){i["max-height"]=r.apply_css_fallbacks("max-height",[`min(${l}, ${e})`,l])}else{i["max-height"]=e}}else{i.height="initial";i["max-height"]=l!=null?l:""}switch(n.get_static_property("floating_reference_horizontal_resp")){case"left":if(n.fit_width()){i.right="unset"}else{i["margin-right"]="auto"}break;case"right":if(n.fit_width()){i.left="unset"}else{i["margin-left"]="auto"}break}const c=n.get_static_property("floating_reference");i.position=c==="none"||!t.run_mode()||s.type()!=="Page"?"absolute":"fixed";let p="";switch(c){case"top":if(n.fit_height()){i.bottom="unset"}break;case"bottom":if(n.fit_height()){i.top="unset"}else if(s.type()==="Page"){i.height=`calc(100${t.run_mode()?"vh":"%"} - ${i.top+i.bottom}px)`;i.top="unset"}else{i["margin-top"]="auto"}break;case"both":if(s.type()==="Page"){i["margin-top"]=i["margin-bottom"]="auto"}p="auto";break;case"none":i.bottom="unset";break}if(t.run_mode()){e.css("overflow-y",p)}i["z-index"]=o();e.css(i)}));if(!t.run_mode()||s.type()!=="Page"){t.container.container_canvas.append(e);if(t.edit_mode()){t.container.setup_margins(t);t.container.setup_padding(t)}}else{$("body").append(e)}e.addClass("floating-group");if(t.run_mode()){const n=t.get_static_property("parallax");if(![null,undefined,1].includes(n)){$(window).on("scroll",(()=>{window.requestAnimationFrame((()=>{i.apply_css_style(e,{transform:"translate3d(0,"+(1-n)*$(window).scrollTop()+"px, 0)"})}))}))}}}))},can_defer_drawing(){return true},register(e){},initialize(e){},check_for_errors(e,t){return c.check_error_floating_group(e,t)},is_input:false,is_container:true,uses_inset_instead_of_margin:true,add_an_invisible_div_on_the_top:false,get_html(e){return"<div></div>"},change_cursor_style_if_clickable:true,can_have_children(){return true},get_children_canvas(e){return e.get_canvas()},get_state_value(e,t){return l.state_value_helper_for_group(e,t)},get_private_messages(){return["child_movement","position_element"]},events:["ButtonClicked"]})},{"../../../constants/runmode":83,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../u":823,"../../property_applications":412,"../components/FloatingGroupComponent":249,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_workflows":288,"../shared/floating_groups":359,"../shared/groups":360,"core-js/modules/web.dom-collections.iterator.js":1123}],299:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../property_applications");const s=e("../../../geolocation/b_location");const o=e("../../../geolocation/location_lookups");const a=e("../../../geolocation/client/google_maps");const l=e("../../../constants/geolocation");const c=e("../../../logger");const u=e("../../../lib");const d=e("../../../lang/appquery");const p=e("../../../lang/btypes");const _=e("../core_elements_utilities/element_workflows");const f=e("../core_elements_utilities/element_utils");const h=e("../core_elements_utilities/element_transformer");const m=e("../core_elements_utilities/element_optional_utils");const g=e("lodash/debounce");const v=e("../../../shared/apps_utilities");const b=e("../shared/dropdowns");const y=e("../shared/image_utils");const w=e("../../../lang/evaluation/element_eval");const{PADDING_VERSION:x}=e("../../../constants/elements");let j=false;const A=[];const M=l.SAMPLE_VALUE;const E=10;const k="use_evaled_props";function O(e){const t=p.get("geographic_address");e=t.cast(e);if(!s.ensure_valid_location(e)){return undefined}e=s.ensure_valid_location(e,true);return e}function S(e){if(e==null){return undefined}const{lat:t,lng:n}=e;if(t!=null&&n!=null){return new window.google.maps.LatLng(t,n)}else{return undefined}}function D(e){let t;if(v.is_test(d.app().id())){t=O(M);return t}let n=l.SAMPLE_VALUE;if(e){try{n=o.get_current_geographic_position()}catch(e){n=l.SAMPLE_VALUE}}if(n){t=O(n)}else{t=O(M)}return t}function C(e){let{position:t,id:n,icon:r}=e;return(t==null?void 0:t.toString())+(n!=null?n:"")+(r!=null?r:"")}h.make_element("GoogleMap",{display:"Map",category:"visual elements",glyph_id:"map",list_order:9,keyboard_shortcut:null,defaults:{width:450,height:350,collapse_margin:500},field_names:{marker_type:{default:"single",no_states:true},marker_data_type:{no_states:true},data_source:{no_states:true},location_field:{no_states:true},show_info_window:{default:"no",no_states:true},marker_caption_expression:{},autoclose:{no_states:true},map_type:{default:"ROADMAP",no_states:true,in_style:true},map_style:{default:"normal",in_style:true},custom_style:{in_style:true},allow_zoom_drag:{default:true},disable_zoom_scroll:{default:false,no_states:true},manual_setting:{default:false,no_states:true},center:{no_states:true},initial_zoom:{default:10,no_states:true},use_customized_marker_icon:{default:false,no_states:true},use_customized_marker_icon_for_list:{default:"no",no_states:true},custom_marker_icon:{no_states:true},custom_marker_field:{no_states:true},custom_selected_icon:{no_states:true,default:"no"},custom_selected_icon_image:{no_states:true},custom_selected_icon_field:{no_states:true},keep_proportion_resize:{no_states:true}},property_applications(e){return[new i.Dimensions,new i.Border,new i.BoxShadow,new i.Padding,new i.PaddingFields({minimum_element_version:x,allow_legacy:true}),new i.ResponsiveElement(e),new i.Opacity]},uses_css_responsive:true,can_fix_aspect_ratio(){return true},get_html(e){return"<div></div>"},get_min_width(){return 0},can_defer_drawing(){return true},register(e){const t=a.load_google_map_api();e.currently_displayed_markers={};e.draw_the_list_once=false;if(e.run_mode()){e.on_message("set_marker_data",(t=>{e.state("datasource_changed_by_workflow_action",true);e.draw_the_list_once=false;e.state("marker_data",t)}));e.on_message("clear_marker_data",(()=>{e.state("datasource_changed_by_workflow_action",false);e.draw_the_list_once=false}));e.autorun((()=>{if(!e.state("datasource_changed_by_workflow_action")){let r;if(e.run_mode()){var t;r=(t=w.evaluate_property(e,"data_source"))!=null?t:null}else if(e.element.property("data_source").is_static()){var n;r=(n=w.evaluate_property(e,"data_source"))!=null?n:null}e.state("marker_data",r)}}));w.on_property_change(e,"use_customized_marker_icon_for_list",(t=>{if(t==="upload"){w.evaluate_property(e,"custom_marker_icon")}}));w.on_property_change(e,"custom_selected_icon",(t=>{if(t==="upload"){w.evaluate_property(e,"custom_selected_icon_image")}}));e.state(k,true);e.on_message("map_adjust_zoom",(t=>{if(t.manual_setting){e.state(k,false);e.state("manual_setting",null);e.state("manual_setting",true);e.state("initial_zoom",t.initial_zoom);e.state("center",t.center)}else{e.state(k,true)}}));e.autorun((()=>{if(!e.state(k)){return}const t=w.evaluate_property(e,"manual_setting");const n=w.evaluate_property(e,"initial_zoom");const r=w.evaluate_property(e,"center");e.draw_the_list_once=false;e.state("manual_setting",null);e.state("manual_setting",t);e.state("initial_zoom",n);e.state("center",r)}));r.WaitFor(t,(()=>{e.autorun((()=>{this._process_markers(e)}));e.original_state_saver=e.autorun((()=>{const{center:t,zoom:n}=this._get_center_and_zoom(e);e.state("map_center_address",t);e.state("zoom_level",n)}))}));e.on_message("set_marker_selection",(t=>{e.state("currently_selected_marker",t)}))}},initialize(e){e.wait_for_visible_lite((()=>{var t;const n=a.load_google_map_api();(t=e.currently_displayed_markers)!=null?t:e.currently_displayed_markers={};const i=e.get_canvas();if(e.thumbnail_mode()){i.css({"background-color":"#E6E6E6"});return}let s=null;r.WaitFor(n,(()=>{const t=()=>{s=this._get_map(e,{height:"100%",width:"100%",position:"absolute",top:0,left:0,right:0,bottom:0});if(e.edit_mode()){f.do_add_an_invisible_div_on_the_top(e)}const t=new ResizeObserver((e=>window.google.maps.event.trigger(s,"resize")));t.observe(i[0]);e.on_destroy((()=>t.disconnect()));let n=null;e.autorun((()=>{if(e.element.has_fixed_aspect_ratio()){var t;(t=n)!=null?t:n=r.div("",i);n.css("height",0);e.autorun((()=>{const t=e.element.get_static_property("aspect_ratio_height")/e.element.get_static_property("aspect_ratio_width");n.css("padding-top",`${t*100}%`)}))}else{var s;(s=n)==null?void 0:s.remove();n=null}}));w.pre_cache(e,["four_border_style","border_width","border_style","padding_vertical","padding_horizontal"]);e.autorun((()=>{this._refresh_border(e,s)}));w.on_property_change(e,["allow_zoom_drag","map_style","custom_style","disable_zoom_scroll"],(e=>{this._handle_map_option_change(s,e)}));w.on_property_change(e,"map_type",(e=>{s.setMapTypeId(window.google.maps.MapTypeId[e])}));e.autorun((()=>{this._render_markers(e,s)}));e.autorun((()=>{this._set_center_and_zoom(e,s)}))};e.wait_for_visible((()=>{e.setTimeout(t,1)}))}))}))},change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:true,is_input:false,is_container:false,events:["MapMarkerClicked"],get_states(e){return["currently_selected_marker","map_center_address","zoom_level"]},add_specific_messages(e,t){const n=t.get_state_value("currently_selected_marker");if(n){r.extend(e,{get_currently_selected_marker:{description:"'s current marker",section:"States",ret_btype:n,fn(e,t){var n;return(n=e==null?void 0:e.state("currently_selected_marker"))!=null?n:this.ret_btype_null()}}})}r.extend(e,{get_map_center_address:{description:"'s center address",section:"States",ret_btype:"geographic_address",fn(e,t){var n;return(n=e==null?void 0:e.state("map_center_address"))!=null?n:this.ret_btype_null()}},get_zoom_level:{description:"'s zoom level",section:"States",ret_btype:"number",fn(e,t){var n;return(n=e==null?void 0:e.state("zoom_level"))!=null?n:this.ret_btype_null()}}})},get_messages(e){return["set_marker_data","clear_marker_data","map_adjust_zoom","set_marker_selection"]},get_state_value(e,t){switch(t){case"currently_selected_marker":return e.get_static_property("marker_data_type");case"map_center_address":return"geographic_address";case"get_zoom_level":return"number"}},get_injected_value(e){return e.get_static_property("marker_data_type")},get_injected_display(){return"Current marker"},use_injected_datasource(e){return b.use_injected_datasource("marker_caption_expression",e)},check_for_errors(e,t){if(e.get_static_property("map_style",true)==="_custom"&&e.get_static_property("custom_style",true)!=null){try{return r.json_parse(e.get_static_property("custom_style",true))}catch(n){return t(e.display()+": the custom style cannot be parsed as a JSON object")}}},jquery_plugins(){return["google_map_styles.js"]},_refresh_border(e,t){for(const t of["four_border_style","border_width","border_style","padding_vertical","padding_horizontal"]){w.evaluate_property(e,t)}for(const t of["_top","_right","_bottom","_left"]){w.evaluate_property(e,"border_style"+t);w.evaluate_property(e,"border_width"+t)}return window.google.maps.event.trigger(t,"resize")},_handle_map_option_change(e,t){let{allow_zoom_drag:n,disable_zoom_scroll:i,map_style:s,custom_style:o}=t;const a={};if(s&&!["normal","_custom"].includes(s)){a.styles=m.google_map_styles[s].data}else if(s==="_custom"){try{a.styles=r.json_parse(o)}catch(e){a.styles=null}}else{a.styles=null}a.disableDefaultUI=!n;a.scrollwheel=n&&!i;a.draggable=n;a.disableDoubleClickZoom=!n;return e.setOptions(a)},_get_map(e,t){let n;const{canvas:o}=e;let d=null;if(A.length){const h=A.pop();d=h.map;n=h.map_wrapper;o.append(n)}else{function m(){n=r.div("map-wrapper",o);i.apply_css_style(n,t);d=new window.google.maps.Map(n[0],{streetViewControl:false})}if(a.using_bubble_key()){if(window.glrl_key_status){c.owner_error(l.RATE_MAP_LIMIT_MESSAGE);return}m();u().location.post("server://user/m/gmap",{appname:u().appname(),mode:r.is_edit_mode()?"edit":"run",first:j?"no":"yes"},((e,t)=>{if(e){return c.log(e)}else if(!t){window.glrl_key_status=true}}));j=true}else{m()}}n[0].id=e.element_id()+"_"+r.LUID()+"_map_wrapper_"+e.responsive_mode();function p(e,t){const n=e.getCenter();if(n){const e=new window.google.maps.LatLng(n.lat(),n.lng(),false);return t.state("map_center_address",(()=>s.from_address({lat:e.lat(),lng:e.lng()})))}}const _=g(p,300);if(e.run_mode()){var f;(f=e.original_state_saver)==null?void 0:f.destroy();window.google.maps.event.addListener(d,"click",(()=>e.state("currently_selected_marker",null)));window.google.maps.event.addListener(d,"idle",(()=>_(d,e)));window.google.maps.event.addListener(d,"center_changed",(()=>_(d,e)));window.google.maps.event.addListener(d,"zoom_changed",(()=>e.state("zoom_level",d.getZoom())))}e.on_destroy((()=>A.push({map:d,map_wrapper:n})));return d},_get_center_and_zoom(e){let t;if(e.state("manual_setting")){var n;t=O(e.state("center"));(n=t)!=null?n:t=D(false);return{center:t,zoom:e.state("initial_zoom"),recenter_ui:true}}const i=w.evaluate_property(e,"marker_type");const o=i==="none"||e.edit_mode();let a;if(i==="none"||i==="single"){var l;a=O(e.state("marker_data"));(l=a)!=null?l:a=D(o);const t=e.get_static_property("initial_zoom");return{center:a,zoom:t,recenter_ui:true}}else{const t=e.state("processed_markers");if(t==null||r.is_empty(t)){a=D(o);return{center:a,zoom:E,recenter_ui:!e.draw_the_list_once}}else{var c;const e=Object.keys(t)[0];a=t[e].position;if(a){a=s.from_address({lat:a.lat(),lng:a.lng()})}(c=a)!=null?c:a=D(o);let n=false;let r=null;if(Object.keys(t).length===1){n=true;r=E}return{center:a,zoom:r,recenter_ui:n}}}},_set_center_and_zoom(e,t){const{center:n,zoom:r,recenter_ui:i}=this._get_center_and_zoom(e);if(i){const e=S(n);if(e!=null){if(!t.getCenter()){t.setCenter(e)}else{t.panTo(e)}}t.setZoom(r)}else if(e.get_static_property("marker_type")==="list"){const n=w.evaluate_property(e,"manual_setting");const r=e.state("bounds");if(!n&&!e.draw_the_list_once){e.draw_the_list_once=true;t.fitBounds(r);if(t.getZoom()>18){t.setZoom(16)}}}window.google.maps.event.trigger(t,"center_changed");window.google.maps.event.trigger(t,"zoom_changed")},_process_markers(e){const t=w.evaluate_property(e,"marker_data_type");const n=p.get(t);let r,i,s;if(t==="geographic_address"){r=e=>n.cast(e)}else{const t=w.evaluate_property(e,"location_field");if(t){const e=n.get_message(t);r=e==null?void 0:e.evaluate}i=n.get_message(w.evaluate_property(e,"custom_marker_field"));s=n.get_message(w.evaluate_property(e,"custom_selected_icon_field"))}const o=e.state("marker_data");const a={};if(r!=null){for(const d of(l=o==null?void 0:(c=o.all)==null?void 0:c.call(o))!=null?l:[]){var l,c;const o=r(d);if(o){var u;const r={position:S(O(o)),bubble_object:d,id:(u=d._id)==null?void 0:u.call(d),bubble_marker_equals:e=>n.equals(d,e)};if(!r.position){continue}if(t!=="geographic_address"){if(["on_click","always"].includes(e.get_static_property("show_info_window"))){const t=e.get_injected_context(d,this.get_injected_value(e.element));r.title=w.eval_property_with_states(e.element,"marker_caption_expression",t)}}if(e.get_static_property("use_customized_marker_icon_for_list")==="upload"){r.icon=w.evaluate_property(e,"custom_marker_icon")}else if(e.get_static_property("use_customized_marker_icon_for_list")==="field"&&t!=="geographic_address"){r.icon=y.optimize_image(i.evaluate(d),30,30,{},false,true)}if(e.get_static_property("custom_selected_icon")==="upload"){r.selected_icon=w.evaluate_property(e,"custom_selected_icon_image")}else if(e.get_static_property("custom_selected_icon")==="field"&&t!=="geographic_address"){r.selected_icon=y.optimize_image(s.evaluate(d),30,30,{},false,true)}else{r.selected_icon=null}a[C(r)]=r}}}e.state("processed_markers",a)},_add_marker(e,t,n,i){const{position:s,icon:o}=n;const{animation:a,add_event_listener:l}=i;const c={position:s,map:t};if(a&&!v.is_test(d.app().id())){c.animation=window.google.maps.Animation.DROP}if(o){c.icon=o}const u=new window.google.maps.Marker(c);const p=C(n);e.currently_displayed_markers[p]={marker:u};if(l){var f,h;let i=null;if(n!=null&&n.title){if(!e.currently_displayed_markers[p].infowindow){i=new window.google.maps.InfoWindow;e.currently_displayed_markers[p].infowindow=i}else{i=e.currently_displayed_markers[p].infowindow}const s=r.div("infowindow-content");s.text(n.title);s[0].style.padding="3px";s[0].style["font-family"]="Lato";s[0].style.color="rgb(39, 39, 39)";i.setContent(s[0]);const o=e.get_static_property("show_info_window");const a=e.get_static_property("autoclose");if(o==="always"){i.open(t,u)}r.autorun_top((()=>{e.currently_displayed_markers[p].infowindow_ar=e.autorun((()=>{if(n.bubble_marker_equals(e.state("currently_selected_marker"))){if(o!=="no"){i.open(t,u)}}else if(o==="on_click"&&a){if(i!=null){i.close()}}}))}))}(h=(f=e.currently_displayed_markers[p]).event_listener)!=null?h:f.event_listener=window.google.maps.event.addListener(u,"click",(()=>{e.state("currently_selected_marker",n.bubble_object);if(i){i.open(t,u)}_.run_element_workflow(e,"MapMarkerClicked")}))}return u},_remove_markers(e,t){for(const r in t){var n;const i=t[r];i.marker.setMap(null);if(i.event_listener){window.google.maps.event.removeListener(i.event_listener)}(n=e.currently_displayed_markers[r].infowindow_ar)==null?void 0:n.destroy();delete e.currently_displayed_markers[r]}},_render_markers(e,t){const n=w.evaluate_property(e,"marker_type");if(n==="none"){this._remove_markers(e.currently_displayed_markers)}let r;if(n==="single"){this._remove_markers(e,e.currently_displayed_markers);const n=S(O(e.state("marker_data")));if(e.get_static_property("use_customized_marker_icon")){r=w.evaluate_property(e,"custom_marker_icon")}if(n){this._add_marker(e,t,{position:n,icon:r},{animation:false,add_event_listener:true})}else if(e.edit_mode()){this._add_marker(e,t,{position:S(D(true)),icon:r},{animation:true})}}if(n==="list"){if(e.run_mode()){const n=e.state("processed_markers");const r={};for(const t in e.currently_displayed_markers){const i=e.currently_displayed_markers[t];if(!n[t]){r[t]=i}}this._remove_markers(e,r);const i=new window.google.maps.LatLngBounds;for(const r in n){const s=n[r];let o;if(!e.currently_displayed_markers[r]){o=this._add_marker(e,t,s,{animation:false,add_event_listener:true})}else{o=e.currently_displayed_markers[r].marker}i.extend(o.position);if(s.selected_icon!=null){let t=false;e.autorun((()=>{if(s.bubble_marker_equals(e.state("currently_selected_marker"))){if(!t){t=true;o.setIcon(s.selected_icon)}}else if(t){t=false;o.setIcon(s.icon)}}))}}e.state("bounds",i)}else{this._remove_markers(e,e.currently_displayed_markers);if(e.get_static_property("use_customized_marker_icon_for_list")==="upload"){r=w.evaluate_property(e,"custom_marker_icon")}this._add_marker(e,t,{position:S(D(true)),icon:r},{animation:true})}}}})},{"../../../constants/elements":61,"../../../constants/geolocation":69,"../../../geolocation/b_location":621,"../../../geolocation/client/google_maps":623,"../../../geolocation/location_lookups":625,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../logger":744,"../../../shared/apps_utilities":788,"../../../u":823,"../../property_applications":412,"../core_elements_utilities/element_optional_utils":283,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_utils":286,"../core_elements_utilities/element_workflows":288,"../shared/dropdowns":358,"../shared/image_utils":363,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/debounce":1311}],300:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../core_elements_utilities/element_transformer");const s=e("../../../lang/elements");const o=e("../shared/groups");const a=e("../components/GroupComponent");const l=e("../../../lang/elements/elements_utils");const c=e("../../../lang/evaluation/element_props");const u=15;i.make_element("Group",r.extend({},o.group_element_definition,{glyph_id:"group",list_order:1,keyboard_shortcut:"G",get_private_messages(e){return["child_movement"]},uses_css_responsive:true,solid_component:a,can_fit_width:true,can_fit_height:true,starts_variable_width:true,can_defer_drawing(){return true},register(e){e.state("collapsing",false)},attempt_size_only_draw(e){return e.element.no_size_when_hidden()},initialize(e){const t=e.get_canvas();e.autorun((()=>{if(e.state("collapsing")){t.css("overflow","hidden")}else if(e.get_static_property("overflow_scroll")){if(e.run_mode()){t.css({"overflow-x":"hidden","overflow-y":"auto"})}else{t.css({overflow:"hidden"})}}else{t.css({overflow:"visible"})}}))},check_for_errors(e,t){return o._check_for_errors_datasource_set_to_self(e,"get_group_data",t)},can_animate(e){return true},do_show(e,t,n,i,o){e._is_visible_me=true;e._update_visible();if(!e.run_mode()){e._display_me();return}e.with_canvas((a=>{var l;e._display_me();(l=a.velocity)==null?void 0:l.call(a,"stop");if(e.group_slide_timeout!=null){e.clearTimeout(e.group_slide_timeout);e.group_slide_timeout=undefined}const d=e.get_static_property("collapse_when_hidden");a.css("display","");if(d&&!i){if(e.get_static_property("collapse_animation")&&!o){e.set_animating(true);e.state("collapsing",true);switch(e.get_static_property("animation_type")){case"slide":{const p=a.height();const _=p/u;a.css({"min-height":0,"max-height":0});function f(t){if(!e._is_visible_me){return}if(t>=p){r.autorun_once((()=>{var t;a.css({"min-height":c.min_height_css(e),"max-height":(t=c.max_height_css(e))!=null?t:""})}));e.state("collapsing",false);e.set_animating(false);e.group_slide_timeout=undefined;return}const n=t+_;a.css({"min-height":n,"max-height":n});e.group_slide_timeout=e.setTimeout((()=>f(n)),1)}f(0);break}case"slide_horiz":{const h=a.width();const m=h/u;const g=a.height();a.css({"min-width":0,"max-width":0});function v(t){if(!e._is_visible_me){return}if(t>=h){r.autorun_once((()=>{var t,n;a.css({"min-width":c.min_width_css(e),"max-width":(t=c.max_width_css(e))!=null?t:"","max-height":(n=c.max_height_css(e))!=null?n:""})}));e.state("collapsing",false);e.set_animating(false);e.group_slide_timeout=undefined;return}const n=t+m;a.css({"min-width":n,"max-width":n,"max-height":g});e.group_slide_timeout=e.setTimeout((()=>v(n)),1)}v(0);break}case"fade":{a.css({opacity:0});r.velocity(a,"fadeIn",{duration:400,complete_cb(){e.state("collapsing",false);e.set_animating(false)},display:""});break}default:e.set_animating(false)}}}else if(i){s.perform_animate_in(e,t,n)}}))},do_hide(e,t,n,i,s){e._is_visible_me=false;if(!e.run_mode()){e._hide_me();e._update_visible();return}e.with_canvas((o=>{var a;(a=o.velocity)==null?void 0:a.call(o,"stop");if(e.group_slide_timeout!=null){e.clearTimeout(e.group_slide_timeout);e.group_slide_timeout=undefined}const d=e.get_static_property("collapse_when_hidden");if(d&&!i){if(e.get_static_property("collapse_animation")&&!s){e.set_animating(true);e.state("collapsing",true);switch(e.get_static_property("animation_type")){case"slide":{const p=o.height();const _=p/u;function f(t){if(e._is_visible_me){return}if(t<=0){e._hide_me();r.autorun_once((()=>{var t;o.css({"min-height":c.min_height_css(e),"max-height":(t=c.max_height_css(e))!=null?t:""})}));o.css("display","none");e.set_animating(false);e.state("collapsing",false);e.group_slide_timeout=undefined;return}const n=t-_;o.css({"min-height":n,"max-height":n});e.group_slide_timeout=e.setTimeout((()=>f(n)),1)}f(p);break}case"slide_horiz":{const h=o.width();const m=h/u;const g=o.height();function v(t){if(e._is_visible_me){return}if(t<=0){e._hide_me();r.autorun_once((()=>{var t,n;o.css({"min-width":c.min_width_css(e),"max-width":(t=c.max_width_css(e))!=null?t:"","max-height":(n=c.max_height_css(e))!=null?n:""})}));o.css("display","none");e.set_animating(false);e.state("collapsing",false);e.group_slide_timeout=undefined;return}const n=t-m;o.css({"min-width":n,"max-width":n,"max-height":g});e.group_slide_timeout=e.setTimeout((()=>v(n)),1)}v(h);break}case"fade":{r.velocity(o,"fadeOut",{duration:400,complete_cb(){e.state("collapsing",false);e._hide_me();e.set_animating(false)},display:"none"});break}}}else{e._hide_me()}}else if(i){l.perform_animate_out(e,t,n)}else{e._hide_me()}}));e._update_visible()}}))},{"../../../lang/elements":680,"../../../lang/elements/elements_utils":679,"../../../lang/evaluation/element_props":691,"../../../u":823,"../components/GroupComponent":250,"../core_elements_utilities/element_transformer":285,"../shared/groups":360}],301:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../property_applications");const s=e("../../../lib");const o=e("../../../lang/appquery");const a=e("../core_elements_utilities/element_transformer");const l=e("../../../lang/elements");const c=e("../../../lang/elements/elements_utils");const u=e("../shared/groups");const d=e("../components/GroupFocusComponent");const p=e("../../../lang/evaluation/element_props");const _=e("../../../u/shared/mode_check");const f=20;a.make_element("GroupFocus",r.extend({},u.group_element_definition,{display:"Group Focus",glyph_id:"group_focus",list_order:6,keyboard_shortcut:null,field_names:r.extend({},u.container_field_names,{reference:{no_states:true},offset_left:{no_states:true,default:0},offset_top:{no_states:true,default:0},fixed_width:{no_states:true,default:true}}),defaults:{bgcolor:"#E8E8E8",background_style:"bgcolor",width:250,height:100},styleable_properties:{offset_top:false,offset_left:false},get_private_messages(e){return["child_movement","position_element"]},can_animate(e){return true},workflow_show(e,t,n,r){e.ensure_drawn();e.get_canvas().data("GroupWithFocus_loading",true);e.setTimeout((()=>e.get_canvas().data("GroupWithFocus_loading",false)),1);e.do_show(t,n,r)},workflow_hide(e,t,n,r){e.do_hide(t,n,r)},check_for_errors(e,t){u._check_for_errors_datasource_set_to_self(e,"get_group_data",t)},can_defer_drawing(){return true},register(e){e.state("manual_position",null);e.on_message("position_element",(t=>e.state("manual_position",{top:t.Y+"px",left:t.X+"px",position:t.position})))},initialize(e){e.wait_for_visible_lite((()=>{let t=e.get_canvas();if(e.edit_mode()){t=t.parent()}const n=t.parent();let a,l;let c=false;if(e.run_mode()){let n;if(r.is_on_mobile_or_tablet()){n=`touchend.groupfocus${r.LUID()}`}else{n=`click.groupfocus${r.LUID()}`}a=function(){$("body").on(n,(n=>{var i;const o=$(".tt-dropdown-menu");const a=()=>{for(let e=0;e<o.length;e++){if($.contains(o[e],n.target)){return true}}return false};const l=e.is_visible()&&!t.data("GroupWithFocus_loading")&&t[0]!==n.target&&!$.contains(t[0],n.target)&&!((i=$(n.target).attr("class"))!=null&&i.match(/\bselect2-/))&&!a();if(l){if(_.running_test()){e.do_hide()}else{c=true;e.setTimeout((()=>{r.WaitFor(s().workflow.everything_done_key(),(()=>{c=false;e.do_hide()}))}),10)}}}))};l=function(){$("body").off(n)}}const u=`resize.groupfocus${e.toUniqueString()}`;let d=null;let p=null;let f=null;function h(){var e,t;(e=d)==null?void 0:e.disconnect();(t=p)==null?void 0:t.disconnect();$(window).off(u);d=null;p=null;f=null}const m=e.autorun((()=>{if(!e.is_visible()){var i;(i=l)==null?void 0:i();h();return}e.autorun((()=>{var i;const l=e.get_static_property("offset_left");const _=e.get_static_property("offset_top");function m(){var i;if(e.state("manual_position")){return}if(!((i=f)!=null&&i.is(":visible"))){var s;if(!c){t.css({top:0,left:0})}(s=d)==null?void 0:s.disconnect();d=null;return}const a=e.run_mode()&&r.is_fixed(f);const u=f.offset();const p=n.offset();let h=u.left-p.left;let g=u.top-p.top;if(a){h-=window.scrollX;g-=window.scrollY}const v=o.get_public_setting("bubble_version")>=20;const b=v?f.outerHeight():f.height();const y=v?f.outerWidth():f.height();const w=h+l;const x=g+_+b;t.css({position:a?"fixed":"absolute",left:w,top:x});const j=-g;const A=-h;const M=g-n.height()+b;const E=h-n.width()+y;if(typeof IntersectionObserver!=="undefined"&&IntersectionObserver!==null){var k;(k=d)==null?void 0:k.disconnect();d=new IntersectionObserver((e=>{if(e[0].intersectionRatio<1){m()}}),{root:a?null:n[0],rootMargin:`${j}px ${E}px ${M}px ${A}px`,threshold:1});d.observe(f[0])}}const g=e.get_static_property("reference");if(e.edit_mode()){f=s.or_throw().visual_edit.current_editor_canvas.getWrapper(g)}else{var v;f=(v=e.find_instance_by_id(g))==null?void 0:v.canvas}(i=a)==null?void 0:i();if(f==null){t.css({top:0,left:0});h();return}m();$(window).off(u);$(window).on(u,(()=>{m()}));if(typeof ResizeObserver!=="undefined"&&ResizeObserver!==null){var b;(b=p)==null?void 0:b.disconnect();p=new ResizeObserver((e=>{m()}));p.observe(f[0],{box:"border-box"})}}))}),(()=>{var e;h();(e=l)==null?void 0:e()}));m.set_run_immediately(true);e.autorun((()=>{const t=e.state("manual_position");if(t){i.apply_css_style(e.get_canvas(),t)}}))}))},property_applications(e){return[new i.ShortDimensions,new i.Background,new i.Border,new i.BoxShadow,new i.ResponsiveElement(e),new i.ResponsiveContainer(e),new i.PaddingFields]},uses_css_responsive:true,solid_component:d,can_fit_height:true,no_margins(){return true},not_draggable(){return true},goes_on_document(){return true},starts_hidden:true,not_max_adjustable_legacy:true,must_be_fixed_size(e){var t;return((t=e.root())==null?void 0:t.get_responsive_version())<0},manual_position:false,position_canvas(e,t){let n;if(t.edit_mode()){n=$(".canvas")}else{n=$("body");e.css("display","none")}n.append(e);t.autorun((()=>{var n,r;e.css({position:"absolute","min-width":p.min_width_css(t),"max-width":(n=p.max_width_css(t))!=null?n:"","min-height":p.min_height_css(t),"max-height":(r=p.max_height_css(t))!=null?r:"",height:t.element.fit_height()?"auto":"initial",right:f,bottom:t.element.fit_height()?"unset":f,"z-index":s().bv().MAX_POPUP_ZINDEX+t.element.get_zindex()})}));if(t.edit_mode()){t.container.setup_padding(t)}if(t.run_mode()){e.css("margin-right","auto");e.css("overflow-y","auto")}else{e.css("overflow","hidden")}},do_show(e,t,n,r){e._is_visible_me=true;e._update_visible();e.with_canvas((i=>{var s;(s=i.velocity)==null?void 0:s.call(i,"stop",true);i.css("display","");if(!r){e._display_me()}else{l.perform_animate_in(e,t,n)}}))},do_hide(e,t,n,r){if(!e.is_drawn){if(!r){e._is_visible_me=false;e._update_visible();return}e.ensure_drawn()}e._is_visible_me=false;e._update_visible();e.with_canvas((i=>{var s;(s=i.velocity)==null?void 0:s.call(i,"stop",true);if(!r){e._hide_me();i.css("display","none")}else{n.display="none";c.perform_animate_out(e,t,n)}}))}}))},{"../../../lang/appquery":651,"../../../lang/elements":680,"../../../lang/elements/elements_utils":679,"../../../lang/evaluation/element_props":691,"../../../lib":741,"../../../u":823,"../../../u/shared/mode_check":851,"../../property_applications":412,"../components/GroupFocusComponent":251,"../core_elements_utilities/element_transformer":285,"../shared/groups":360}],302:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../core_elements_utilities/element_transformer");const s=e("../shared/groups");i.make_element("GroupWithFocus",r.extend({},s.group_element_definition,{display:"Group Focus (old)",field_names:r.extend({},s.group_element_definition.field_names,{information:{no_states:true}}),workflow_show(e,t,n,r){e.get_canvas().data("GroupWithFocus_loading",true);e.setTimeout((()=>e.get_canvas().data("GroupWithFocus_loading",false)),1);e.do_show(t,n,r)},workflow_hide(e,t,n,r){e.do_hide(t,n,r)},check_for_errors(e,t){s._check_for_errors_datasource_set_to_self(e,"get_group_data",t)},get_private_messages(e){return["child_movement","position_element"]},starts_hidden:true,initialize(e){throw new r.OwnerError("Old Group Focus is not supported in new responsive engine")}}))},{"../../../u":823,"../core_elements_utilities/element_transformer":285,"../shared/groups":360}],303:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../property_applications");const s=e("../../../logger");const o=e("base64url");const a=e("../../../lib");const l=e("../core_elements_utilities/element_utils");const c=e("../core_elements_utilities/element_transformer");const u=e("../shared/video_elements");const d=e("../../../lang/evaluation/element_eval");const{PADDING_VERSION:p}=e("../../../constants/elements");const{ignoreError:_}=e("../../../u/shared/callbacks");const f=e("../components/HTMLComponent");function UNMANGLED_html_wrap(e){return e()}c.make_element("HTML",{category:"visual elements",glyph_id:"html",list_order:8,keyboard_shortcut:null,defaults:{border_style:"none",border_color:"#6B6B6B",border_width:0,padding_vertical:2,padding_horizontal:2,width:200,height:100},updated_default_sizing:{width:280,height:150},field_names:{html:{default:"<i>edit me...</i>"},useiframe:{default:false},stretch_to_fit:{default:false,no_states:true},keep_proportion_resize:{no_states:true},defer_drawing:{no_states:true}},property_applications(e){return[new i.Dimensions,new i.Padding,new i.PaddingFields({minimum_element_version:p,allow_legacy:true}),new i.Border,new i.BoxShadow,new i.ResponsiveElement(e),new i.Opacity]},uses_css_responsive:true,solid_component:f,use_legacy_in_editor:true,use_legacy_in_thumbnail:true,get_html(){return"<div></div>"},wrapped_canvas_append(e,t){return UNMANGLED_html_wrap((()=>e.append(t)))},get_min_width(){return 0},can_fit_width(e){return!e.get_static_property("useiframe",true)},can_fit_height(e){return!e.get_static_property("useiframe",true)},add_an_invisible_div_on_the_top:true,change_cursor_style_if_clickable:false,can_defer_drawing(e){return e.get_static_property("defer_drawing")},register(e){var t;if(e.run_mode()&&(t=window)!=null&&t.bubble_safe_mode){return s.owner_warn(new r.OwnerError("This HTML element is not rendered in safe mode",{element_instance:e}))}},initialize(e){function t(){if(e.run_mode()&&window.bubble_safe_mode){return}const t=e.get_canvas();let n=null;let r=null;const i=()=>r[0].contentWindow;let c=false;d.pre_cache(e,["html","useiframe"]);e.autorun((()=>{var p;const f={};for(const t of["html","useiframe"]){f[t]=d.evaluate_property(e,t)}let{html:h,useiframe:m}=f;(p=h)!=null?p:h="";if(!e.run_mode()){const n=o.encode(h);a().location.post("server://appeditor/cache_iframe_content",{content:n},_((n=>{const i=n;const s=`${a().location.get_base_for_meta()}/appeditor/basic_iframe_service/${a().appname()}/test/${i}`;r=$(`<iframe src="${s}"\n    id='user_preview_iframe'\n    width="100%"\n    height="100%"\n    sandbox="allow-scripts"\n>\n    (this browser does not support HTML element preview rendering)\n</iframe>`);t.empty();t.append(r);l.do_add_an_invisible_div_on_the_top(e)})))}else{if(m){const s=o=>{e.clearTimeout(n);if(!r){r=$('<iframe src="about:blank"></iframe>');if(u.should_block_cookies()){r.attr("sandbox","allow-scripts allow-same-origin")}t.append(r)}r[0].style.width="100%";r[0].style.height="100%";if(i()){if(c!==o){r[0].contentWindow.contents=o;c=o}r[0].src='javascript:window["contents"]'}else{n=e.setTimeout((()=>s(o)),100)}};s(h);t.css("height",e.element.get_height())}else{try{if(c!==h){UNMANGLED_html_wrap((()=>t.html(h)));c=h}}catch(t){s.owner_only_error("html bug",{display:"Bug in custom html:\n"+t.stack,element_instance:e,prop_name:"html"})}}}}))}if(e.get_static_property("defer_drawing")){e.wait_for_visible_lite(t)}else{t()}},is_input:false,is_container:false})},{"../../../constants/elements":61,"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../../u/shared/callbacks":843,"../../property_applications":412,"../components/HTMLComponent":253,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_utils":286,"../shared/video_elements":374,base64url:957,"core-js/modules/web.dom-collections.iterator.js":1123}],304:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../property_applications");const s=e("../core_elements_utilities/element_transformer");const o=e("../core_elements_utilities/element_workflows");const a=e("../shared/icons");const l=e("../../../lang/evaluation/element_eval");const c=e("../components/IconComponent");s.make_element("Icon",{category:"visual elements",glyph_id:"icon",list_order:3,keyboard_shortcut:"I",defaults:{font_alignment:"center",color:"#6676F2",background_style:"none",border_style:"none",border_roundness:4,border_width:2,border_color:"#6B6B6B",boxshadow_style:"none",width:80,height:80},updated_default_sizing:{width:30,height:30},default_states:[],properties_for_new:{icon:"fa fa-bars"},field_names:r.extend({icon:{default:"fa fa-flag-checkered"},icon_color:{default:"#6676F2",in_style:true},spin_icon:{}},o.start_workflow_field_names),property_applications(e){return[new i.Dimensions,new i.FontShadow,new i.Border,new i.BoxShadow,new i.Background,new i.ResponsiveElement(e),new i.ToolTip,new i.PaddingFields,new i.Opacity]},uses_css_responsive:true,solid_component:c,get_html(e){return"<button></button>"},get_min_width(e){return 0},change_cursor_style_if_clickable:true,can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{const t=e.get_canvas();i.patch_user_agent_styles(t);t.css("display","block");$(document).ready((()=>{e.autorun((()=>{t.empty();const n=l.evaluate_property(e,"icon");t.append(a.get_icon_svg("fa",n));if(l.evaluate_property(e,"button_disabled")){t.attr("tabindex","-1")}}))}));l.on_property_change(e,"icon_color",(e=>{t[0].style.color=e}));l.on_property_change(e,"spin_icon",(e=>{if(!e){e=false}t.toggleClass("fa-spin",e)}))}))},transition_properties:{icon_color:"color"},is_input:false,is_container:false,events:["ButtonClicked"],add_an_invisible_div_on_the_top:false,css_files:["css/optional/font-awesome.min.css"]})},{"../../../lang/evaluation/element_eval":690,"../../../u":823,"../../property_applications":412,"../components/IconComponent":254,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_workflows":288,"../shared/icons":362}],305:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../property_applications");const s=e("../../../shared/apps_utilities");const o=e("../../../lang/appquery");const a=e("../core_elements_utilities/element_transformer");const l=e("../core_elements_utilities/element_workflows");const c=e("../shared/image_utils");const u=e("../shared/aspect_ratio");const d=e("../../../lang/evaluation/element_eval");const p=e("../../../lang/evaluation/element_props");const _=e("../components/ImageComponent");function f(e){const t=e.property("src");if(!t.is_empty()&&t.is_static()&&e.get_static_property("src",true)!==""){return true}}a.make_element("Image",{category:"visual elements",glyph_id:"image",list_order:4,keyboard_shortcut:null,defaults:{width:320,height:240},collapse_margin:500,keep_proportion_resize:true,field_names:r.extend({src:{},stretch_or_rescale:{default:"rescale",no_states:true},crop_data:{no_states:true},keep_proportion_resize:{no_states:true},alt_tag:{},editor_preview_image:{no_states:true,only_edit_mode:true}},l.start_workflow_field_names),uses_css_responsive:true,solid_component:_,use_legacy_in_editor:true,can_fix_aspect_ratio(){return true},can_fit_height(e){return!f(e)},property_applications(e){return[new i.Dimensions,new i.Border,new i.BoxShadow,new i.ResponsiveElement(e),new i.ToolTip,new i.Rotation,new i.Opacity]},get_html(){return"<div></div>"},can_defer_drawing(){return true},initialize(e){const t=e.get_canvas();e.wait_for_visible_lite((()=>{let n;const i=r.img(undefined,t);if(!e.run_mode()){n=r.div("display_text",t)}let a=null;let l=null;if(e.run_mode()){d.on_property_change(e,"alt_tag",(e=>{i[0].alt=e!=null?e:""}))}d.pre_cache(e,["src","stretch_or_rescale","crop_data","editor_preview_image"]);u.structure_fixed_aspect_ratio(e,t);let _=null;let h=null;e.autorun((()=>{var m,g;const v={};for(const t of["src","stretch_or_rescale","crop_data","keep_proportion_resize","editor_preview_image"]){v[t]=d.evaluate_property(e,t)}const b=f(e.element);i.css(u.element_css(b||e.element.has_fixed_aspect_ratio()||!p.is_fitting_height(e)));if(!e.run_mode()){if(!b&&!v.editor_preview_image){var y;n.html((y=v.src)!=null?y:"");n.show();n.css({display:"block",overflow:"hidden",width:"100%",color:"grey",position:"absolute"});t.css("overflow","hidden");i.hide();return}else{n.hide();i.show()}}(m=_)!=null?m:_=r.Box(t.width());(g=h)!=null?g:h=r.Box(t.height());function w(t,n,u,d){let p;a=p=r.LUID();function _(n){if(a!==p){return}c.download_image(n,e,(e=>{if(a!==p){return}l=t;i[0].src=e}))}const f=c.optimize_image(t,n,u,d);let h=t===l&&!c.downloaded_images[f];if(h&&s.is_test(o.appname())){h=false}if(h){e.setTimeout(_.bind(null,f),300)}else{_(f)}}if(!e.run_mode()&&v.editor_preview_image&&v.src){e.autorun((()=>{w(v.editor_preview_image,_(),h())}))}else if(v.src&&!r.is_empty(v.src)){if(!i[0].src){i[0].src=c.transparent_image();c.reset_img_settings(i)}c.reset_img_settings(i);if(b){let t;if(v.keep_proportion_resize){t={fit:"crop"}}else{t={}}if(v.crop_data!=null){const e=e=>`${Math.floor(e*100)}%`;i.css({width:e(v.crop_data.width_factor),height:e(v.crop_data.height_factor),"margin-left":e(v.crop_data.left_offset)})}e.autorun((()=>{w(v.src,_(),h(),t);if(v.crop_data!=null){i.css("margin-top",v.crop_data.top_offset*h())}}))}else{const t={rescale:"contain",adjust_height:"contain",stretch:"fill",zoom:"cover"};i.css({"object-fit":t[v.stretch_or_rescale]});if(!e.element.has_fixed_aspect_ratio()&&p.is_fitting_height(e)){i.css("height","auto");e.autorun((()=>{w(v.src,_())}))}else{e.autorun((()=>{w(v.src,_(),h())}))}}}else{i[0].src=c.transparent_image();l=null;c.reset_img_settings(i)}}));if(typeof ResizeObserver!=="undefined"&&ResizeObserver!==null&&!e.thumbnail_mode()){const n=new ResizeObserver((e=>{var t,n;(t=_)==null?void 0:t(e[0].contentRect.width);(n=h)==null?void 0:n(e[0].contentRect.height)}));n.observe(t[0]);e.on_destroy((()=>n.disconnect()))}e.autorun((()=>{if(d.evaluate_property(e,"four_border_style")){for(const t of["top","right","bottom","left"]){i[0].style[`border-radius-${t}`]=d.evaluate_property(e,"border_roundness_"+t)+"px"}}else{i[0].style["border-radius"]=d.evaluate_property(e,"border_roundness")+"px"}}))}))},get_min_width(e){return 0},change_cursor_style_if_clickable:true,add_an_invisible_div_on_the_top:false,is_input:false,is_container:false,events:["ButtonClicked"]})},{"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../shared/apps_utilities":788,"../../../u":823,"../../property_applications":412,"../components/ImageComponent":255,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_workflows":288,"../shared/aspect_ratio":356,"../shared/image_utils":363,"core-js/modules/web.dom-collections.iterator.js":1123}],306:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../geolocation/b_location");const s=e("../../input_mask");const o=e("../../property_applications");const a=e("../../../lang/btypes");const l=e("../../../shared/domain_utilities");const c=e("../../core_actions/utilities/account_actions_utilities");const u=e("../../../lib");const d=e("../core_elements_utilities/element_utils");const p=e("../core_elements_utilities/element_transformer");const _=e("../shared/inputs");const f=e("../../../lang/evaluation/page_state");const{PADDING_VERSION:h}=e("../../../constants/elements");const m=e("../../../u/shared/b_date");const g=e("../../custom_tz_utilities");const v=e("../components/InputComponent");const b=e("../../../lang/evaluation/element_eval");const{has_input_timezone_controls_on:y}=e("../../../lang/timezone_override_settings");function w(e){if(y()){return g.get_custom_tz({static_eval:t=>e.get_static_property(t),dynamic_eval:t=>b.evaluate_property(e,t),not_overridden:true})}else{return u().current_timezone()}}function x(e){return e==="date"||e==="date_2"}function j(e,t){let n;const r=e.get_static_property("content_format");switch(r){case"int_number":{const e=parseFloat(t);n=Number.isNaN(e)?null:Math.round(e);break}case"float_number":case"percentage":case"currency":n=t;break;case"geographic_address":n=()=>i.from_address(t);break;case"date":case"date_2":{const r=w(e);n=m.mk_date(t,r)}break;default:n=t;if([null,undefined,"text","numerical_ref"].includes(r)){if(e.get_static_property("limit_number_of_characters")){const t=e.get_static_property("character_limit");if(t!=null&&n!=null&&n.length>t){n=n.slice(0,t)}}}}if(typeof n==="number"&&isNaN(n)){return null}else{return n}}for(const e of["us_phone","percentage","currency","date","date_2","numerical_ref"]){var A;if(!(e in s.masks)){throw new r.UnexpectedError(`${e} should be a valid mask`)}_.input_content_options[e]=(A=s.masks[e].caption)!=null?A:r.toTitleCase(e)}p.make_element("Input",{category:"input forms",glyph_id:"text_input",list_order:1,keyboard_shortcut:null,defaults:r.extend({},_.default_for_inputs,{width:250,height:45,use_max_width:true,max_width:150}),updated_default_sizing:{height:48},default_states:_.default_states_for_inputs,field_names:r.extend({placeholder:{default:"Type here..."},content:{},content_format:{default:"text",no_states:true},currency_symbol:{default:"$"},show_thousands:{no_states:true},always_show_decimals:{no_states:true},decimal_place:{no_states:true},have_a_numerical_range:{no_states:true},min_range_value:{},max_range_value:{},check_password_policy:{no_states:true}},_.additional_field_names_for_text_inputs,g.custom_tz_field_names),property_applications(e){return[new o.Dimensions,new o.Background,new o.Border,new o.BoxShadow,new o.Font,new o.FontSpacing(null,["line_height"]),new o.InputPadding,new o.PaddingFields({minimum_element_version:h,allow_legacy:true}),new o.PlaceholderColor,new o.ResponsiveElement(e),new o.Opacity]},uses_css_responsive:true,solid_component:v,use_legacy_in_editor:true,use_legacy_in_thumbnail:true,can_defer_drawing(){return true},get_html(e){const t=this._format_to_type(e.get_static_property("content_format"));if(t==="number"){return'<input type="input" inputmode="decimal"></input>'}if(t==="password"){return'<input type="'+t+'" autocomplete="new-password"></input>'}else{return'<input type="'+t+'"></input>'}},_format_to_type(e){if(r.is_on_mobile_or_tablet()){if(["int_number","us_phone","numerical_ref"].includes(e)){return"tel"}if(e==="float_number"){return"number"}}switch(e){case"password":return"password";case"email":return"email";default:return"input"}},get_min_width(e){return 0},is_secure(e){return["password","us_ssn","bank_routing_number","credit_card_number","credit_card_cvc","credit_card_exp_month","credit_card_exp_year"].includes(e.get_static_property("content_format"))},initialize(e){e.wait_for_visible_lite((()=>{var t,n;const i=e.get_canvas();_.reset_input_div(i);i.focus((()=>{f.input_focused(true)}));i.on("blur",(()=>{f.input_focused(false)}));if(((t=e.element.root())==null?void 0:t.get_responsive_version())===0){d.register_tab_index_listener(e,(e=>{i.attr("tabindex",e)}))}function o(t){const n={clearMaskOnLostFocus:true,showMaskOnHover:false,greedy:false,rightAlign:false,inputEventOnly:true};if(t==="currency"){n.prefix=b.evaluate_property(e,"currency_symbol");if(e.get_static_property("always_show_decimals")){n.digitsOptional=false;n.placeholder="0"}else{n.digitsOptional=true;n.placeholder=""}}if(["float_number","percentage"].includes(t)){const t=e.get_static_property("decimal_place");if(t!=null&&t>=0){n.digits=t;n.digitsOptional=false;n.placeholder="0";n._radixDance=true;n.inputEventOnly=false}}if(["float_number","int_number"].includes(t)&&!e.get_static_property("show_thousands")){n.autoGroup=false;n.groupSeparator=""}if(x(t)){n.timezone=w(e)}return n}const l=e=>e in s.masks;e.autorun((()=>{const t=b.evaluate_property(e,"placeholder");i.attr("placeholder",t);if(i.get()[0].inputmask!=null){i.get()[0].inputmask.originalPlaceholder=t}}));if(e.edit_mode()){b.on_property_change(e,["content_format","content"],(t=>{let{edit_mode_content_format:n}=t;if(e.element.property("content").is_static()){i.attr("type",this._format_to_type(n))}else{i.attr("type","input")}}));b.on_property_change(e,["content_format","tz_type","tz_static"],(t=>{let{content_format:n,tz_type:r,tz_static:i}=t;if(x(n)){e.state("current_tz",w(e))}}))}if(((n=e.element.root())==null?void 0:n.get_responsive_version())>0){i.css("box-sizing","border-box")}_.set_character_limit_on_input(e);if(!e.run_mode()){i.attr("readonly","true")}let c;e.autorun((()=>{var t;const n=e.get_static_property("content_format");const r=e.state("current_tz");if(e.state("has_been_changed")&&r===c){return}c=r;if(e.state("is_focused")){return}let i=e.state("value");if(n==="geographic_address"){i=a.get("geographic_address").runmode_display(i)}else if(e.run_mode()){if(l(n)){i=s.masks[n].format_val(i,o(n))}}e.get_canvas().val((t=i)!=null?t:"")}));if(e.run_mode()){e.on_message("set_focus",(()=>i.focus()));const u=e.get_static_property("content_format");if(x(u)){e.autorun((()=>{e.state("current_tz",w(e))}))}function p(){if(u in s.masks){const t={};if(x(u)){t.timezone=e.state("current_tz")}return s.masks[u].get_val(e.get_canvas(),t)}else{return j(e,e.get_canvas().val())}}_.assign_change_keyup_handlers(e,p);_.switch_disabled_or_not(e);e.autorun((()=>{const t=b.evaluate_property(e,"not_submit_on_enter");return _.assign_enter_handler_in_input(e,t)}));if(u==="password"){i.passMeter({events:"keyup input change",afterTest:t=>{if(t===0&&i.val()===""){t=null}e.state("pw_strength",t)}})}if(u in s.masks){r.autorun((()=>{const e=s.masks[u].get_mask(o(u));i.inputmask(e);i.off("click.inputmask");i.on("click.inputmask",(e=>$(e.target).trigger("inputmaskclick")))}))}}}))},content_validated(e,t){var n;const o=t.get_static_property("content_format");function a(e){var n,r;if(!t.get_static_property("have_a_numerical_range")){return true}const i=(n=b.evaluate_property(t,"min_range_value"))!=null?n:-Infinity;const s=(r=b.evaluate_property(t,"max_range_value"))!=null?r:Infinity;if(s<i){return true}return i<=e&&e<=s}if(["",null,undefined].includes(e)||(e==null?void 0:(n=e.trim)==null?void 0:n.call(e))===""){return!b.evaluate_property(t,"mandatory")}switch(o){case"email":return r.is_email(e);case"geographic_address":return i.from_address(e)!=null;case"password":if(t.get_static_property("check_password_policy")){return _.is_pw_valid(e)}else{return true}case"appname_validate":return l.is_appname_valid(e==null?void 0:e.toLowerCase());default:if(o in s.masks){const t=s.masks[o];if(typeof e==="string"){if(!t.is_valid_text(e)){return false}}if(t.btype==="date"){if(isNaN(Date.parse(e))){return false}}if(t.btype==="number"){if(typeof e==="number"){return a(e)}const n=t.parse_val(e);if(n!=null){return a(n)}else{return false}}else{return true}}else{return true}}},get_starting_content(e){if(e.run_mode()&&e.get_static_property("auto_binding")){const{type:t,thing:n}=_.get_input_parent_thing(e);const r=e.get_static_property("bind_field");const i=j(e,a.get(t).get_message(r).evaluate(n));if(typeof i==="function"){return i()}else{return i}}else{const o=e.get_static_property("content_format");let a;if(!e.run_mode()){if(o==="geographic_address"&&!e.element.property("content").is_static()){a={address:b.evaluate_property(e,"content")}}else{a=b.evaluate_property(e,"content")}}else{a=j(e,b.evaluate_property(e,"content"))}if(typeof a==="function"){return a()}else{if(e.run_mode()&&!a&&o==="email"){var t;const o=(t=r.local_storage_get(c.get_remember_email_key()))==null?void 0:t.email;if(o&&!u().current_user().is_logged_in()){for(const t of(n=(i=(s=e.element).get_visible_workflows)==null?void 0:i.call(s))!=null?n:[]){var n,i,s;let r;let a=false;for(r of t.actions()){if(r.type()==="LogIn"){a=true;break}}if(a&&r.find_my_expressions("GetElement.element_id="+e.element_id()).length){return o}}}}return a}}},get_state_value(e,t){if(t==="value"){const t=e.get_static_property("content_format");if(t in s.masks){return s.masks[t].btype}else if(t==="geographic_address"){return"geographic_address"}else{return"text"}}if(t==="pw_strength"&&e.get_static_property("content_format")==="password"){return"number"}},add_specific_messages(e,t){if(t.get_static_property("content_format")==="password"){r.extend(e,{get_pw_strength:{description:"'s password strength",section:"States",ret_btype:"number",fn(e){var t;return(t=e==null?void 0:e.state("pw_strength"))!=null?t:this.ret_btype_null()}}})}},change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,is_input:true,is_container:false,jquery_plugins(){return["jquery_plugins/pass-meter.min"]},only_send_to_client_in_runmode:true})},{"../../../constants/elements":61,"../../../geolocation/b_location":621,"../../../lang/btypes":653,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/page_state":698,"../../../lang/timezone_override_settings":729,"../../../lib":741,"../../../shared/domain_utilities":792,"../../../u":823,"../../../u/shared/b_date":836,"../../core_actions/utilities/account_actions_utilities":172,"../../custom_tz_utilities":380,"../../input_mask":383,"../../property_applications":412,"../components/InputComponent":256,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_utils":286,"../shared/inputs":364,"core-js/modules/web.dom-collections.iterator.js":1123}],307:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../property_applications");const s=e("../../../constants/runmode");const o=e("../../../lang/application");const a=e("../../../lang/appquery");const l=e("../../url_data");const c=e("../../../constants/lang");const u=e("../../../lang/evaluation/evaluate");const d=e("../../../lang/evaluation/eval_node_state");const p=e("../../../lib");const _=e("querystring");const f=e("../core_elements_utilities/element_utils");const h=e("../core_elements_utilities/element_transformer");const m=e("../shared/text_elements");const g=e("../shared/links");const v=e("../../../lang/evaluation/element_eval");const{PADDING_VERSION:b}=e("../../../constants/elements");const y=e("../components/LinkComponent");h.make_element("Link",{category:"visual elements",glyph_id:"link",keyboard_shortcut:"L",defaults:{font_alignment:"left",font_color:"#4083a9",width:150,height:20,min_width:80,use_max_width:true,max_width:120},compute_initial_properties(e){e.properties.no_html=true},default_states:[{condition:{type:"ThisElement",next:{type:"Message",name:"is_hovered"}},properties:{font_color:"#205f82"}},{condition:{type:"ThisElement",next:{type:"Message",name:"is_pressed"}},properties:{font_color:"#134B70"}}],field_names:{text:{default:"...edit me..."},show_icon:{no_states:true,in_style:true},icon:{default:"fa fa-facebook-official"},linktype:{default:"pagelink",no_states:true},page:{default:"index",no_states:true},data_to_send:{no_states:true},url:{},link_disabled:{default:false},open_in_new_tab:{default:false},add_parameters:{no_states:true},url_parameters:{optional:true,no_states:true},keep_current_page_params:{no_states:true},wrap_when_squizzed:{no_states:true,default:true},no_html:{no_states:true},nofollow:{no_states:true}},property_applications(e){return[new i.Dimensions,new i.Font,new i.FontShadow,new i.FontSpacing,new i.PaddingText,new i.PaddingFields({minimum_element_version:b,no_vertical_if_legacy_center:true,allow_legacy:true}),new i.Border,new i.BoxShadow,new i.Background,new i.ResponsiveElement(e),new i.ToolTip,new i.Opacity]},solid_component:y,use_legacy_in_editor:true,use_legacy_in_thumbnail:true,uses_css_responsive:true,can_fit_width:true,can_fit_height:true,change_cursor_style_if_clickable:false,get_min_width(e){return 0},get_html(e){if(e.run_mode()){return"<a></a>"}else{return"<div></div>"}},can_defer_drawing(){return true},initialize(e){const t=e.get_canvas();e.wait_for_visible_lite((()=>{t.addClass(s.CLICKABLE_ELEMENT);i.apply_css_style(t,{"white-space":"pre-wrap","text-decoration":"none","word-break":"break-word"});let n=false;v.pre_cache(e,["text","font_size","icon","show_icon","background_style","no_html"]);e.autorun((()=>{const s={};for(const p of["text","font_size","icon","show_icon","background_style","no_html"]){s[p]=v.evaluate_property(e,p)}const{text:o,icon:a,show_icon:l,background_style:c,no_html:u}=s;if(c==="image"){t.text("")}else{if(l){var d;n=false;m.remove_dotdotdot(e);(d=t.trigger)==null?void 0:d.call(t,"destroy");t.empty();const _=r.div(a+" inner-element");i.apply_css_style(_,{"font-family":"FontAwesome","padding-left":"3px"});t.append(_)}else{function h(n){if(v.evaluate_property(e,"vertical_centering")||e.run_mode()&&m.could_clip(e)){t.html(`<div>${n}</div>`)}else{t.html(n)}}if(u){h(r.bbcode_to_html(o,true).trim())}else{h(o)}if(!n&&m.could_clip(e)){n=true;m.apply_dotdotdot(e,e.edit_mode()?"letter":"words")}if(!e.run_mode()){f.do_add_an_invisible_div_on_the_top(e)}}}if(c==="none"){return(new i.NoSelect)._apply(true,t)}}));if(e.run_mode()){v.on_property_change(e,"open_in_new_tab",(e=>{if(e){t[0].target="_blank"}else{t[0].target="_self"}}));v.on_property_change(e,"link_disabled",(t=>{e.state("link_disabled",t);if(t){e.get_canvas()[0].style.cursor="not-allowed";e.get_canvas()[0].style["pointer-events"]="none"}else{e.get_canvas()[0].style.cursor="pointer";e.get_canvas()[0].style["pointer-events"]="auto"}}));v.on_property_change(e,"nofollow",(e=>{if(e){t[0].rel="nofollow"}}));e.autorun((()=>{function n(e){var t,n;let r=o.page_id_to_name(e);(t=r)!=null?t:r=(n=a.get_page_by_name(e))==null?void 0:n.name();return r}const i=v.evaluate_property(e,"linktype");let s;if(i==="pagelink"){var f;const t=v.evaluate_property(e,"page");let i=(f=n(t))!=null?f:"";let o=v.evaluate_property(e,"data_to_send");if(o){const e=a.get_page_by_name(i);if(e!=null){o=l.get_data_to_send(o,e.get_static_property("readable_field"));if(o){i+="/"+o}}}const h={};if(e.get_static_property("keep_current_page_params")){r.extend(h,p().location.get_query())}if(r.is_debug_mode()){h.debug_mode=true}if(v.evaluate_property(e,"add_parameters")){const t=e.element.property("url_parameters");d.with_eval_node(t,(()=>{const n=u.evaluate_properties(t.json._raw(),e.prop_eval_context(),c.DETECT_FIELD_NAMES,[],t.json._path());for(const{key:e,value:t}of Object.values(n)){if(!g.forbidden_url_keys.includes(e)){h[e]=t}}}))}if(i==="index"){i=""}s=p().location.get_server_base()+i;if(!r.is_empty(h)){s+="?"+_.stringify(h)}}else{var h;s=v.evaluate_property(e,"url");if(((h=s)==null?void 0:h.indexOf("//"))===-1&&!g.href_attributes.includes(s.split(":")[0])&&s[0]!=="#"){s="//"+s}}t[0].href=s;if(r.on_phonegap()){t.on("touchend",(()=>window.open(s,"_blank","location=yes,enableViewportScale=yes")));t.on("click",(e=>{e.preventDefault();return false}))}}))}e.on_destroy((()=>{m.remove_dotdotdot(e)}))}))},check_for_errors(e,t,n){var r;if(!n&&e.get_static_property("linktype")==="pagelink"){t(undefined,e,e.id());return true}if((r=e.root())!=null&&r.get_static_property("native_app")){if(e.get_static_property("linktype")==="pagelink"){t(e.display()+": Links to another page should not be used in a native app page")}}return g.check_parameters(e,t)},is_input:false,is_container:false,add_an_invisible_div_on_the_top:false,css_files:["css/optional/font-awesome.min.css"]})},{"../../../constants/elements":61,"../../../constants/lang":73,"../../../constants/runmode":83,"../../../lang/application":650,"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/eval_node_state":694,"../../../lang/evaluation/evaluate":695,"../../../lib":741,"../../../u":823,"../../property_applications":412,"../../url_data":416,"../components/LinkComponent":258,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_utils":286,"../shared/links":365,"../shared/text_elements":373,"core-js/modules/web.dom-collections.iterator.js":1123,querystring:2279}],308:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../property_applications");const s=e("../../../lib");const o=e("../core_elements_utilities/element_transformer");const a=e("../shared/inputs");const l=e("../../../lang/evaluation/page_state");const c=e("../../../lang/btypes");const u=e("../../../lang/evaluation/element_eval");const d=e("../../../lang/evaluation/element_props");const{PADDING_VERSION:p}=e("../../../constants/elements");o.make_element("MultiLineInput",{display:"Multiline Input",category:"input forms",glyph_id:"multiline_input",list_order:2,keyboard_shortcut:null,defaults:{font_size:14,font_color:"#3D3D3D",background_style:"bgcolor",border_style:"solid",border_width:1,border_color:"#BDBDBD",border_roundness:3,border_style_top:"solid",border_width_top:1,border_color_top:"#BDBDBD",border_roundness_top:3,border_style_left:"solid",border_width_left:1,border_color_left:"#BDBDBD",border_roundness_left:3,border_style_bottom:"solid",border_width_bottom:1,border_color_bottom:"#BDBDBD",border_roundness_bottom:3,border_style_right:"solid",border_width_right:1,border_color_right:"#BDBDBD",border_roundness_right:3,padding_horizontal:4,padding_vertical:4,width:300,height:100},updated_default_sizing:{width:226},default_states:a.default_states_for_inputs,field_names:r.extend({placeholder:{default:"Type here..."},content:{},stretch_to_fit:{default:false,no_states:true}},a.additional_field_names_for_text_inputs),property_applications(e){return[new i.Dimensions,new i.Background,new i.Border,new i.BoxShadow,new i.Font,new i.FontSpacing,new i.Padding,new i.PaddingFields({minimum_element_version:p,allow_legacy:true}),new i.PlaceholderColor,new i.ResponsiveElement(e),new i.Opacity]},uses_css_responsive:true,can_fit_height:true,get_html(e){return"<textarea></textarea>"},get_min_width(e){return 0},can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{const t=e.get_canvas();a.reset_input_div(t);t.focus((()=>{l.input_focused(true)}));t.on("blur",(()=>{l.input_focused(false)}));t.attr("data-gramm_editor","false");if(!e.run_mode()){t.attr("readonly","true");t[0].style.resize="none"}a.set_character_limit_on_input(e);e.autorun((()=>{const t=true;a.assign_enter_handler_in_input(e,t)}));let n=false;let i="";function o(){window.optional_modules.autosize.update(t);i=t[0].style.cssText}e.autorun((()=>{t.attr("placeholder",u.evaluate_property(e,"placeholder"));o()}));const c=r.Box(0);a.input_change_autorun(e,(r=>{if(e.state("is_focused")){return}t.val(r!=null?r:"");if(n){if(!t[0].disabled){o()}else{c(c.dangerously_peek()+1);e.setTimeout((()=>{o();c(c.dangerously_peek()-1)}),5)}}}));if(e.run_mode()){e.on_message("set_focus",(()=>t.focus()));a.assign_change_keyup_handlers(e,(()=>e.get_canvas().val()));e.autorun((()=>{if(c()>0){t[0].disabled=false}else{t[0].disabled=u.evaluate_property(e,"disabled")}}));a.switch_disabled_or_not(e);let r=null;e.autorun((()=>{if(d.is_fitting_height(e)){if(!n){if(s().bubble_version()>=8){t.attr("rows",1)}window.optional_modules.autosize(t);e.wait_for_visible(o);r=new MutationObserver((()=>{if(i!==t[0].style.cssText){o()}}));r.observe(t[0],{attributes:true,attributeFilter:["style"]});n=true}e.autorun((()=>{e.current_width();o()}))}else{if(n){window.optional_modules.autosize.destroy(t);r.disconnect();n=false}}}));e.on_destroy((()=>{var e;window.optional_modules.autosize.destroy(t);(e=r)==null?void 0:e.disconnect()}));t.on("blur",(()=>{const t=20;e.setTimeout((()=>{o()}),t)}))}}))},content_validated(e,t){if(!e&&u.evaluate_property(t,"mandatory")){return false}else{return true}},get_starting_content(e){if(e.get_static_property("auto_binding")){if(e.run_mode()){return a.get_input_parent_thing_field(e)}else{const{type:t}=a.get_input_parent_thing(e,true);const n=e.get_static_property("bind_field");if(t==null||n==null){return"Parent Thing's field"}const r=c.get(t).custom_type();if(r==null){return"Cannot autobind on parent Thing"}const i=r.field(n);return`Parent ${r.display()}'s ${i.display()}`}}return u.evaluate_property(e,"content")},get_state_value(e,t){if(t==="value"){return"text"}},change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,is_input:true,is_container:false,jquery_plugins(){return["jquery_plugins/autosize.min"]},only_send_to_client_in_runmode:true})},{"../../../constants/elements":61,"../../../lang/btypes":653,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../lang/evaluation/page_state":698,"../../../lib":741,"../../../u":823,"../../property_applications":412,"../core_elements_utilities/element_transformer":285,"../shared/inputs":364}],309:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../property_applications");const s=e("../shared/image_utils");const o=e("../../../lang/evaluation/page_state");const a=e("../core_elements_utilities/element_transformer");const l=e("../shared/pages");const c=e("../../../lang/color_tokens");const u=e("../../../lang/font_tokens");const d=e("../../../lang/evaluation/element_eval");const p=e("../components/PageComponent");a.make_element("Page",{can_have_children(){return true},get_children_canvas(e){return e.get_canvas()},field_names:{page_item_type:{no_states:true},readable_field:{no_states:true},title:{default:"My Page"},native_app:{no_states:true},native_app_name:{no_states:true,default:"App"},mobile_page:{no_states:true},delete_page:{no_states:true},meta_title:{in_pageservice:true,no_states:true},meta_description:{in_pageservice:true,no_states:true},meta_image:{in_pageservice:true,no_states:true},backdrop_background_style:{default:"bgcolor",no_states:true,in_style:true},backdrop_bgcolor:{default:"#FFFFFF",in_style:true},backdrop_background_gradient_direction:{default:"top",in_style:true},backdrop_background_gradient_custom_angle:{default:45,in_style:true},backdrop_background_gradient_from:{default:"#FFFFFF",in_style:true},backdrop_background_gradient_to:{default:"#AAAAAA",in_style:true},backdrop_background_gradient_mid:{in_style:true,optional:true},backdrop_background_gradient_style:{in_style:true,default:"linear"},backdrop_background_radial_gradient_shape:{in_style:true,default:"ellipse"},backdrop_background_radial_gradient_size:{in_style:true,default:"farthest-corner"},backdrop_background_radial_gradient_xpos:{in_style:true,default:10},backdrop_background_radial_gradient_ypos:{in_style:true,default:10},backdrop_background_image:{in_style:true},backdrop_center_background:{in_style:true},backdrop_background_size_cover:{in_style:true},backdrop_repeat_background_vertical:{in_style:true},backdrop_repeat_background_horizontal:{in_style:true},backdrop_image_paralax:{no_states:true,default:false,in_style:true},backdrop_paralax_speed:{no_states:true,default:.2,in_style:true},backdrop_background_color_if_empty_image:{default:"rgba(255, 255, 255, 0.0)",no_states:true,in_style:true},backdrop_video_source:{default:"http://vjs.zencdn.net/v/oceans.mp4",in_style:true},backdrop_video_image_fallback:{in_style:true},backdrop_video_silence:{default:true,in_style:true},stripes:{no_states:true,in_style:true},preset_width:{no_states:true,default:"custom",in_style:false},html_header:{no_states:true,in_pageservice:true},new_responsive:{no_states:true},responsive_version:{no_states:true},element_version:{default:0,no_states:true},upgrade_responsive_version:{no_states:true},fixed_width:{no_states:true,default:false},min_width:{default:0,no_states:true},backdrop_crop_responsive:{no_states:true},page_folder:{optional:true,no_states:true,only_edit_mode:true},tz_type:{no_states:true},tz_static:{no_states:true},tz_type_overridden:{no_states:true},tz_static_overridden:{no_states:true}},always_visible:true,uses_css_responsive:true,solid_component:p,attach_to_body:()=>false,property_applications(e){return[new i.RootSizing,new i.ShortDimensions,new i.ResponsiveContainer(e),new i.Opacity]},get_html(e){return'<div class="main-page"></div>'},position_canvas(e,t){if(t.run_mode()){i.apply_css_style(e,{width:t.element.container_layout()==="fixed"?`${t.element.get_width()}px`:"100%","margin-right":"auto","margin-left":"auto",position:"relative","z-index":2});$("html, body").css("height","100%");$(window.document.body).append(e);const n=t.element.root_min_height();e[0].style["min-height"]=`max(${n}px, 100%)`;if(t.element.container_layout()==="column"){$("body").css({display:"flex","flex-direction":"column"});e.css({height:"max-content","flex-shrink":0})}}else{$(".canvas").append(e)}},transition_properties:{backdrop_background_style:"background"},get_min_width(){return 0},not_max_adjustable:true,can_register_workflows(){return r.FakeKey()},initialize(e){if(e.run_mode()){e.register_workflows(e.element.events())}d.on_property_change(e,"title",(t=>{if(e.edit_mode()){$(".edit-date").text(t)}else if(e.run_mode()){$(document).ready((()=>window.document.title=t))}}));function t(e,t){const n=e.get_static_property("preset_width");for(const r in l.preset_page_widths){const i=l.preset_page_widths[r];if(t===i.width){if(n!==r){e.element.set_property("preset_width",r)}return}}if(n!=="custom"){e.element.set_property("preset_width","custom")}}const n=document.documentElement;if(e.edit_mode()){e.autorun((()=>{u.load_font_tokens_default();u.load_font_tokens_user()}));d.on_property_change(e,"preset_width",(t=>{if(l.preset_page_widths[t].width!=null){e.element.set_property("width",l.preset_page_widths[t].width);e.element.set_property("default_width",l.preset_page_widths[t].width);e.element.commit_merge()}}));d.on_property_change(e,["width","default_width"],(n=>{let{width:r,default_width:i}=n;if(e.element.get_responsive_version()<1||e.element.container_layout()==="fixed"){t(e,r)}else{t(e,i)}e.element.commit_merge()}))}e.autorun((()=>{const e=c.default_color_tokens_to_property();for(const t in e){const r=e[t];n.style.setProperty(t,r)}}));e.autorun((()=>{const e=c.user_color_tokens_to_property();for(const t in e){const r=e[t];n.style.setProperty(t,r)}}));e.autorun((()=>{const e=u.default_font_tokens_to_property();for(const t in e){const r=e[t];n.style.setProperty(t,r)}}));e.autorun((()=>{const e=u.user_font_tokens_to_property();for(const t in e){const r=e[t];n.style.setProperty(t,r)}}));if(e.run_mode()){o.page_width($(window).width());$(window).on("resize",(()=>o.page_width($(window).width())));o.page_current_scroll_position($(window).scrollTop());$(window).on("scroll wheel touchmove",(()=>o.page_current_scroll_position($(window).scrollTop())))}const a=["background_style","bgcolor","background_gradient_direction","background_gradient_from","background_gradient_mid","background_gradient_to","background_image","center_background","background_size_cover","repeat_background_vertical","repeat_background_horizontal","background_color_if_empty_image","background_gradient_style","background_radial_gradient_shape","background_radial_gradient_size","background_radial_gradient_xpos","background_radial_gradient_ypos","background_gradient_custom_angle"];function p(){const t=e.get_canvas();if(e.thumbnail_mode()){t.css({"z-index":1,position:"absolute",top:0,width:e.element.get_width(),height:e.element.get_height(),overflow:"hidden"})}else{i.apply_css_style(t,{"z-index":1})}let n=null;d.pre_cache(e,a.map((e=>`backdrop_${e}`)));d.pre_cache(e,["backdrop_paralax_speed","backdrop_image_paralax"]);e.autorun((()=>{let o;const l={is_backdrop:true};for(o of a){l[o]=d.evaluate_property(e,"backdrop_"+o)}if(e.run_mode()){for(o of["backdrop_paralax_speed","backdrop_image_paralax"]){l[o]=d.evaluate_property(e,o)}}if(l.background_style==="video"){if(e.run_mode()&&!r.is_on_mobile_or_tablet()){if(n==null){n=new $.BigVideo;n.init()}$("#big-video-wrap").css("background","black");const t=$("#big-video-wrap video");t.attr("muted","");const r=s.optimize_image(d.evaluate_property(e,"backdrop_video_source"),undefined,undefined,undefined,true);n.show(r,{forceAutoplay:true,doLoop:true,ambient:true});e.autorun((()=>{if(d.evaluate_property(e,"backdrop_video_silence")){t.attr("muted","");return n.getPlayer().muted(true)}else{n.getPlayer().volume(.8);t.removeAttr("muted");return n.getPlayer().muted(false)}}))}else{t.css("background","black");const n=d.evaluate_property(e,"backdrop_video_image_fallback");if(n){t.css({"background-image":`url(${s.optimize_image(n,t.width())})`,"background-position":"center top"})}}}else{(new i.Background)._apply(l,t)}}))}if(e.edit_mode()){d.pre_cache(e,a);e.autorun((()=>{e.autorun((()=>{if(!e.is_destroyed()){const t={};for(const n of a){t[n]=d.evaluate_property(e,n)}(new i.Background)._apply(t,e.get_canvas())}}));p()}))}else if(e.thumbnail_mode()){e.autorun(p)}else{p()}},is_input:false,is_container:false,change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,get_private_messages(){return["movement_in_stripe","child_movement"]},required_js_files(e){if(e.get_static_property("backdrop_background_style")==="video"||e.get_style().get_static_property("backdrop_background_style")==="video"){return["jquery_plugins/jquery-ui-slider-draggable.min","jquery_plugins/video.js","jquery_plugins/bigvideo.js"]}else if(e.get_static_property("backdrop_background_style")==="image"&&e.get_static_property("backdrop_image_paralax")||e.get_style().get_static_property("backdrop_background_style")==="image"&&e.get_style().get_static_property("backdrop_image_paralax")){return["jquery_plugins/parallax.min"]}else{return[]}},required_css_files(e){if(e.get_static_property("backdrop_background_style")==="video"||e.get_style().get_static_property("backdrop_background_style")==="video"){return["css/optional/bigvideo.css"]}else{return[]}},not_draggable(){return true}})},{"../../../lang/color_tokens":657,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/page_state":698,"../../../lang/font_tokens":713,"../../../u":823,"../../property_applications":412,"../components/PageComponent":259,"../core_elements_utilities/element_transformer":285,"../shared/image_utils":363,"../shared/pages":366,"core-js/modules/web.dom-collections.iterator.js":1123}],310:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../logger");const s=e("../../property_applications");const o=e("../../../constants/runmode");const a=e("../../../constants/workflow");const l=e("../../widgets");const c=e("../../core_events");const u=e("../core_elements_utilities/element_utils");const d=e("../core_elements_utilities/element_transformer");const p=e("../shared/inputs");const _=e("../shared/sliderinputs");const f=e("../shared/pictureinputs");const h=e("../shared/image_utils");const m=e("../../../lang/evaluation/element_eval");const g=e("../../../lib");d.make_element("PictureInput",{display:"Picture Uploader",category:"input forms",glyph_id:"picture_uploader",list_order:9,keyboard_shortcut:null,defaults:{font_size:14,bold:true,background_style:"bgcolor",border_style:"solid",border_width:1,border_roundness:0,border_color:"#A6A6A6",border_style_top:"solid",border_width_top:1,border_roundness_top:0,border_color_top:"#A6A6A6",border_style_left:"solid",border_width_left:1,border_roundness_left:0,border_color_left:"#A6A6A6",border_style_bottom:"solid",border_width_bottom:1,border_roundness_bottom:0,border_color_bottom:"#A6A6A6",border_style_right:"solid",border_width_right:1,border_roundness_right:0,border_color_right:"#A6A6A6",padding_horizontal:0,padding_vertical:0,bgcolor:"#EBEBEB",font_alignment:"center",width:130,height:140},updated_default_sizing:{width:150,height:150},default_states:p.default_states_for_inputs,field_names:r.extend({src:{},placeholder:{default:"Click to upload an image"},mandatory:{},private:{no_states:true},attach_to:{},service:{no_states:true},destination:{},keep_proportion_resize:{no_states:true},limit_image_width:{no_states:true}},p.get_disabled_field_name,p.get_auto_binding_field_names),property_applications(e){var t;return[new s.Font(".button_for_file_uploader"),new s.Dimensions,new s.Border,new s.Background(".button_for_file_uploader"),new s.BoxShadow,new s.ResponsiveElement(e),new s.FontSpacing(".button_for_file_uploader",["line_height"]),new s.PaddingFields(((t=g())==null?void 0:t.app().get_public_setting("bubble_version"))<18?{}:{selector:"button,img"}),new s.Opacity]},get_html(e){return"<div></div>"},get_min_width(){return 0},can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{var t;_.show_message_for_ios_8_upload_bug();e.state("src_version",0);const n=5;const d=e.get_canvas();const g=r.img(undefined,d);const v={width:"100%",height:"100%","z-index":n,position:"absolute"};s.apply_css_style(g,v);if(((t=e.element.root())==null?void 0:t.get_responsive_version())>0){g.css({"object-fit":"contain"})}d.append(g);const b=$('<button class="button_for_file_uploader"></button>');p.reset_input_div(b);const y={"z-index":n-1,position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"};s.apply_css_style(b,y);d.append(b);m.on_property_change(e,"width",(e=>{if(e<80){s.apply_css_style(b,{padding:0})}}));function w(t){if(!t){return null}return h.optimize_image(t,m.evaluate_property(e,"width"),m.evaluate_property(e,"height"))}let x=null;function j(t){if(!t){var n;g[0].src=h.transparent_image();b.css("opacity",1);g.css("opacity",0);(n=x)==null?void 0:n.attr("title",null)}else{var i,s;if(((i=e.element.root())==null?void 0:i.get_responsive_version())>0){h.download_image(t,e,(e=>{g[0].src=e}))}else{e.autorun((()=>{let n=r.autorun_top((()=>e.state("src_version")));n+=1;e.state("src_version",n);h.rescale_image({src:t,img:g,instance:e,ref_version:n,cb(){g[0].src=t}})}))}const n=t.split("%2F");const o=n[-1+n.length];const a=o.split("?w=")[0];(s=x)==null?void 0:s.attr("title",a);b.css("opacity",0);g.css("opacity",1)}}if(e.run_mode()){var A;d.addClass(o.CLICKABLE_ELEMENT);function M(t){r.run_once(30,(()=>f.process_upload_security(e)),((e,n)=>{if(e){t(e)}else{t(null,n)}}))}x=$('<input type="file" accept="image/*"></input>');d.append(x);s.apply_css_style(x,{opacity:0,position:"absolute","z-index":1+g.css("z-index"),left:"0px",width:"100%",height:"100%","font-size":0});const E=t=>{var n,r;e.state("file_size",(n=(r=x[0].files[0])==null?void 0:r.size)!=null?n:null);e.state("loading",false);j(w(t));e.message("user_submit",t);x[0].value=null};function k(){e.state("loading",true)}function O(t){c.handle_uncaught_error({original_error:t,caught_from:a.ERROR_SOURCES.ELEMENT,cb(t){if(t){window.alert(i.human_friendly(t))}e.state("loading",false)}})}l.MakeImageUploader({input:x,get_additional_data:M,cb_success:E,cb_start:k,cb_fail:O,limit_size:e.get_static_property("limit_image_width")});if(((A=e.element.root())==null?void 0:A.get_responsive_version())===0){u.register_tab_index_listener(e,(e=>{x.attr("tabindex",e)}))}m.on_property_change(e,"disabled",(e=>{x[0].disabled=e;s.apply_css_style(x,{cursor:e?"default":"pointer"});s.apply_css_style(b,{cursor:e?"default":"pointer"})}));p.register_focus(e,x);e.on_message("set_focus",(()=>x.focus()))}m.on_property_change(e,"placeholder",(e=>{b.text(e)}));p.input_change_autorun(e,(t=>{var n,r,i,s;if(!e.run_mode()&&!e.element.property("src").is_static()){t=""}else{t=w(t)}j(t);e.state("file_size",(n=(r=x)==null?void 0:(i=r[0])==null?void 0:(s=i.files[0])==null?void 0:s.size)!=null?n:null)}))}))},get_starting_content(e){if(e.run_mode()&&e.get_static_property("auto_binding")){return p.get_input_parent_thing_field(e)}return m.evaluate_property(e,"src")},get_state_value(e,t){if(t==="value"){return"image"}},get_states(e){return["loading","file_size"]},uses_css_responsive:true,add_specific_messages(e,t){return r.extend(e,f.file_inputs_additional_messages)},need_to_wait_before_checking_validity:true,content_validated(e,t){return e||!m.evaluate_property(t,"mandatory")},change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,is_input:true,is_container:false})},{"../../../constants/runmode":83,"../../../constants/workflow":95,"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../core_events":377,"../../property_applications":412,"../../widgets":421,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_utils":286,"../shared/image_utils":363,"../shared/inputs":364,"../shared/pictureinputs":367,"../shared/sliderinputs":372}],311:[function(e,t,n){(function(t){(function(){"use strict";e("core-js/modules/web.immediate.js");e("core-js/modules/web.dom-collections.iterator.js");const n=e("../../../u");const r=e("../../../logger");const i=e("../../../lib");const s=e("../../../lang/elements");const o=e("../../property_applications");const a=e("../../status_bar");const l=e("../../core_events");const c=e("../core_elements_utilities/element_transformer");const u=e("../core_elements_utilities/element_workflows");const d=e("../../../constants/workflow");const p=e("../../../constants/runmode");const _=e("../shared/popups");const f=e("../shared/groups");const h=e("../components/PopupComponent");const m=e("../../../lang/evaluation/element_eval");const g=e("../../../lang/evaluation/element_props");const v=e("../../../lang/elements/elements_utils");const{HORIZONTAL_SPACING:b,INITIAL_POPUP_TOP:y,FILL_POPUP_BOTTOM:w}=e("../../../constants/popups");c.make_element("Popup",{category:"containers",glyph_id:"popup",list_order:4,keyboard_shortcut:null,defaults:{bgcolor:"#FFFFFF",background_style:"bgcolor",border_style:"none",border_roundness:3,boxshadow_style:"outset",boxshadow_horizontal:2,boxshadow_vertical:2,boxshadow_blur:4,boxshadow_color:"#000000",width:500,height:350},updated_default_sizing:{width:320,height:320},field_names:n.extend({},u.start_workflow_field_names,_.greyout_field_names,f.container_field_names),not_draggable(){return true},property_applications(e){return[new o.ShortDimensions,new o.Border,new o.BoxShadow,new o.Background,new o.ResponsiveElement(e),new o.ResponsiveContainer(e),new o.PaddingFields,new o.Opacity]},get_min_width(){return 0},not_max_adjustable_legacy:true,uses_css_responsive:true,no_margins(){return true},can_fit_height:true,get_html(e){return"<div></div>"},change_cursor_style_if_clickable:true,can_have_children(){return true},get_children_canvas(e){return e.get_canvas()},goes_on_document(){return true},can_animate(e){return true},can_defer_drawing(){return true},solid_component:h,register(e){function t(t){e.start_child_drawing();const n=e.element.get_related_workflows(t);const s={element:e};const o=i().workflow.run_workflows(s,n,true);const c=a.show_progress_line(o);o.then((()=>c()),(e=>{c();l.handle_uncaught_error({original_error:e,caught_from:d.ERROR_SOURCES.ELEMENT_WORKFLOW,cb(e){if(e){window.alert(r.human_friendly(e))}}})}))}e.on_message("popup_closed",(()=>t("PopupClosed")));e.on_message("popup_opened",(()=>t("PopupOpened")));e._has_been_hidden=true},initialize(e){e.wait_for_visible_lite((()=>{m.on_property_change(e,"greyout_color",(t=>_.apply_greyout_color(e,t)));m.on_property_change(e,"greyout_blur",(t=>{if(![null,undefined,0].includes(t)){e.wait_for_visible((()=>{_.apply_blur_effect_to_greyout(e,t)}))}}));e.on_destroy((()=>{if(![null,undefined,0].includes(e.get_static_property("greyout_blur"))||e.edit_mode()){_.remove_blur_effect_to_greyout(e)}}))}))},check_for_errors(e,t){return f._check_for_errors_datasource_set_to_self(e,"get_group_data",t)},is_input:false,is_container:true,add_an_invisible_div_on_the_top:false,events:["ButtonClicked","PopupClosed","PopupOpened"],get_state_value(e,t){return f.state_value_helper_for_group(e,t)},position_canvas(e,t){let n;if(t.edit_mode()){$(".canvas").append(e);n="absolute"}else{$(window.document.body).append(e);n="fixed"}e.css({top:y,left:0,right:0,position:n,"margin-left":"auto","margin-right":"auto"});t.autorun((()=>{var n,r,i;e.css({width:`calc(100% - ${b*2}px)`,"min-width":g.min_width_css(t),"max-width":(n=g.max_width_css(t))!=null?n:"","min-height":g.min_height_css(t),"max-height":(r=g.max_height_css(t))!=null?r:"",height:t.element.fit_height()?"auto":"initial",bottom:t.element.fit_height()?"":w,"overflow-y":"auto","z-index":p.POPUP_ZINDEX+((i=t.state("popup_zindex"))!=null?i:0)})}));if(t.edit_mode()){t.container.setup_padding(t)}if(t.run_mode()){e.css("display","none");let n=null;$(window).on("resize.popup_"+t.element_id(),(()=>{const e=$(window).height();if(n!==e){n=e;_.get_popup_positioning(t)}}));let r=null;queueMicrotask((()=>{t.autorun((()=>{const e=t.current_height();if(e!==r){r=e;_.get_popup_positioning(t,e)}}))}));t.on_destroy((()=>{$(window).off("resize.popup_"+t.element_id())}))}},do_show(e,r,o,a){e.with_canvas((l=>{e.state("has_been_absolutely_positioned",null);_.add_layer(e);const c=_.get_greyout(e);if(e.run_mode()){var u;c.css("z-index",p.POPUP_ZINDEX+((u=e.state("popup_zindex"))!=null?u:0))}if(![null,undefined,0].includes(e.get_static_property("greyout_blur"))||e.edit_mode()){_.apply_blur_effect_to_greyout(e,e.get_static_property("greyout_blur"))}if(e.run_mode()){var d,f;_.get_popup_positioning(e);l.css({"-webkit-filter":"none",filter:"none"});(d=l.velocity)==null?void 0:d.call(l,"stop");(f=c.velocity)==null?void 0:f.call(c,"stop");l.css("display","");if(a){s.perform_animate_in(e,r,o);t((()=>{_.resize_popup_if_legacy(e,l.innerWidth())}))}else{r={animation:"transition.fadeIn"};o={duration:300};s.perform_animate_in(e,r,o);t((()=>{_.resize_popup_if_legacy(e,l.innerWidth())}))}c.css("opacity",0);c.show();n.velocity(c,"fadeIn",{duration:300,complete_cb(){c[0].style.top="-1px";return e.setTimeout((()=>c[0].style.top="0px"),151)}});e.setTimeout((()=>{let t=[];let n=false;function r(e){for(const s of(i=e.children)!=null?i:[]){var i;if(s.element.get_messages().includes("set_focus")){if(!s.get_canvas()){continue}if(s.get_canvas().is(":focus")){n=true;return}t.push(s)}r(s)}}r(e);if(n){return}t=t.filter((e=>e.state("tab_index")&&e.is_visible()));t.sort(((e,t)=>{if(e.state("tab_index")<=t.state("tab_index")){return-1}else{return 1}}));for(const e of t){if(e.is_visible()){if(e.element.type()!=="DateInput"){e.message("set_focus")}break}}}),400);if(!e.get_static_property("prevent_user_from_closing_through_esc")){$(document).off("keydown.escape");$(document).on("keydown.escape",(t=>{if(t.keyCode===27){e.do_hide();$(document).off("keydown.escape")}}));c.off("click");c.on("click",(()=>e.do_hide()))}e.message("popup_opened")}else{l.css("display","");e._display_me();e._is_visible_me=true;e._update_visible();if(!e.thumbnail_mode()){c.show()}if(e.edit_mode()){c.click((()=>{i().visual_edit.turn_element_on(e.element_id(),false)}))}}}))},do_hide(e,t,r,i){var s,o;if(!e.is_drawn){return}e.set_animating(true);if(n.on_phonegap()){$(window).off("touchmove.popup_opened")}const a=e.get_canvas();const l=_.get_greyout(e);if(![null,undefined,0].includes(e.get_static_property("greyout_blur"))||e.edit_mode()){_.remove_blur_effect_to_greyout(e)}(s=a.velocity)==null?void 0:s.call(a,"stop");(o=l.velocity)==null?void 0:o.call(l,"stop",true);if(e.run_mode()&&a.is(":visible")&&a.css("visibility")!=="hidden"){if(i){r.transform="";v.perform_animate_out(e,t,r);n.velocity(l,"fadeOut",{duration:300,complete_cb(){l.hide()}});e.message("popup_closed")}else{e.set_animating(true);const i=300;t={animation:"transition.fadeOut"};r={duration:i};v.perform_animate_out(e,t,r,(()=>{a.css("display","none")}));n.velocity(l,"fadeOut",{duration:i,complete_cb(){l.hide()}});e.message("popup_closed")}}else{a.css("display","none");l.hide();e.set_animating(false)}e._is_visible_me=false;e._update_visible();_.remove_layer(e);_.set_body_overflow()},get_private_messages(e){return["popup_opened","popup_closed","child_movement","position_element"]},starts_hidden:true,modal(){return true}})}).call(this)}).call(this,e("timers").setImmediate)},{"../../../constants/popups":79,"../../../constants/runmode":83,"../../../constants/workflow":95,"../../../lang/elements":680,"../../../lang/elements/elements_utils":679,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../core_events":377,"../../property_applications":412,"../../status_bar":415,"../components/PopupComponent":260,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_workflows":288,"../shared/groups":360,"../shared/popups":368,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,timers:2334}],312:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../property_applications");const s=e("../core_elements_utilities/element_transformer");const o=e("../../../lang/evaluation/element_eval");s.make_element("PoweredByBubble",{category:"visual elements",display:"Built on Bubble",glyph_id:"bubble_logo",list_order:10,keyboard_shortcut:null,defaults:{width:79,height:42},field_names:{element_type:{default:"image_black",no_states:true},add_border:{in_style:true,no_states:true},text_color:{default:"#C9C9C9",in_style:true,no_states:true}},property_applications(e){return[new i.PositionOnly,new i.ResponsiveElement(e),new i.Opacity]},uses_css_responsive:true,get_html(e){if(e.run_mode()){return"<a></a>"}else{return"<div></div>"}},can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{const{element:t}=e;const n=e.get_canvas();const i=r.div("powered-by-bubble",n);if(e.run_mode()){n[0].href="https://bubble.io?utm_source=user_icon";n[0].target="_blank"}const s={image_blue:"#0205D3",image_white:"#FFFFFF",image_grey:"#C9C9C9",image_black:"#000000"};const a=[];for(const e in s){a.push(e)}const l=e=>`<?xml version="1.0" encoding="utf-8"?>\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n width="71px" height="100px" viewBox="0 0 612 792" enable-background="new 0 0 612 792" xml:space="preserve">\n<path fill="${e}" d="M298.97,123.2c-12.343,0-24.549,5.294-33.832,15.747V87.511h-18.395v86.608l0,0\nc0,28.125,22.795,50.92,50.92,50.92s50.919-22.795,50.919-50.92C348.583,145.995,327.095,123.2,298.97,123.2z M297.629,205.407\nc-17.294,0-31.288-14.028-31.288-31.288s14.028-31.288,31.288-31.288c17.293,0,31.288,14.028,31.288,31.288\nS314.924,205.407,297.629,205.407z"/>\n<path fill="${e}" d="M413.016,123.2c-12.344,0-24.549,5.294-33.832,15.747V87.511h-18.395v86.608l0,0\nc0,28.125,22.795,50.92,50.92,50.92c28.124,0,50.92-22.795,50.92-50.92C462.629,145.995,441.105,123.2,413.016,123.2z\n M411.675,205.407c-17.295,0-31.288-14.028-31.288-31.288s14.028-31.288,31.288-31.288c17.294,0,31.287,14.028,31.287,31.288\nS428.969,205.407,411.675,205.407z"/>\n<path fill="${e}" d="M143.185,183.024V125.95h19.735v56.902c0,14.543,8.424,23.861,22.624,23.861\nc14.372,0,22.623-8.974,22.623-23.861V125.95h19.907v57.074c0,26.371-15.987,41.98-42.53,41.98\nC159.688,225.039,143.185,208.88,143.185,183.024z"/>\n<path fill="${e}" d="M498.214,222.701h-19.735V87.511h19.735V222.701z"/>\n<path fill="${e}" d="M609.955,181.958h-75.537c2.889,15.06,13.443,25.306,32.113,25.306c10.934,0,24.239-4.126,32.835-10.418\nl8.251,14.544c-9.867,7.357-25.477,13.443-41.809,13.443c-36.238,0-51.848-25.306-51.848-50.782c0-14.544,4.47-26.543,13.649-36.067\nc9.146-9.524,21.18-14.372,35.723-14.372c13.822,0,25.306,4.298,34.107,13.1s13.271,20.629,13.271,35.723\nC610.644,175.15,610.472,178.383,609.955,181.958z M534.384,165.799h56.353c-1.616-15.266-12.928-25.133-27.472-25.133\nC548.377,140.666,537.271,150.74,534.384,165.799z"/>\n<path fill="${e}" d="M80.507,123.2c-12.343,0-24.549,5.294-33.832,15.747V87.511H28.246v86.608l0,0\nc0,28.125,22.795,50.92,50.92,50.92s50.919-22.795,50.919-50.92C130.085,145.995,108.597,123.2,80.507,123.2z M79.166,205.407\nc-17.294,0-31.288-14.028-31.288-31.288s14.028-31.288,31.288-31.288c17.294,0,31.288,14.028,31.288,31.288\nS96.46,205.407,79.166,205.407z"/>\n<g>\n<ellipse fill="${e==="#000000"?"#0205D3":e}" cx="14.872" cy="212.421" rx="12.584" ry="12.584"/>\n</g>\n<rect x="6.206" y="4.5" fill="none" width="602" height="63"/>\n<text transform="matrix(1 0 0 1 15.8643 58.4595)" fill="${e}" font-family="Arial" font-size="76">Built without code</text>\n</svg>`;return o.on_property_change(e,["element_type","add_border","text_color"],(n=>{let{element_type:r,add_border:o,text_color:c}=n;i.empty();const u={"border-radius":"3px",padding:"3px",height:"100%",width:"100%","text-align":"center"};switch(r){case"text":i.text("Built without code on Bubble");u["font-family"]="Arial";u["font-size"]=10;u.color=c;break;default:if(a.includes(r)){i.html(l(s[r]))}}if(o){let e;switch(r){case"text":e=c;break;default:if(a.includes(r)){e=s[r]}}u.border="1px solid "+e}else{u.border="1px solid transparent"}if(e.edit_mode()){if(a.includes(r)){t.set_property("width",81);t.set_property("height",42)}else{t.set_property("width",143);t.set_property("height",18)}}return i.css(u)}))}))},is_input:false,is_container:false,change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,not_resizable(){return true}})},{"../../../lang/evaluation/element_eval":690,"../../../u":823,"../../property_applications":412,"../core_elements_utilities/element_transformer":285}],313:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u/shared/uuid");const i=e("../../../u/shared/async/autorun");const s=e("../../property_applications");const o=e("../../../constants/runmode");const a=e("../../../db/hydrate");const l=e("../../../lang/btypes");const c=e("../core_elements_utilities/element_transformer");const u=e("../shared/inputs");const d=e("../shared/dropdowns");const p=e("../shared/radiobuttons");const _=e("../../../lang/evaluation/element_eval");const f=50;const h=20;const m=20;c.make_element("RadioButtons",{category:"input forms",display:"Radio Buttons",glyph_id:"radio_buttons",list_order:6,keyboard_shortcut:null,defaults:{width:200,height:75},field_names:{choices_style:{default:"static",no_states:true},choices:{no_states:true,default:"Choice 1"},dynamic_type:{no_states:true},data_source:{},option_display_expression:{},default:{},mandatory:{},columns:{no_states:true,default:1},use_dynamic_columns:{default:false,no_states:true},min_column_width_px:{no_states:true,default:100},color:{default:"black",in_style:true},computed_value:{optional:true,no_states:true},...u.get_disabled_field_name,...u.get_auto_binding_field_names},property_applications(e){return[new s.Dimensions,new s.Font,new s.Background,new s.ResponsiveElement(e),new s.FontSpacing(null,["line_height"]),new s.Opacity]},can_fit_width:true,can_fit_height:true,get_html(e){return"<div></div>"},get_min_width(e){return 0},_get_display_option:d._get_display_option,can_defer_drawing(){return true},register(e){const t=i.Watcher((()=>{if(!e.state("has_been_changed")){return false}const t=e.state("value");if(t==null){return false}return!this._choice_list_contains(e,t)}));e.on_destroy((()=>t.destroy()));t.on_value((t=>{if(t){e.message("reset_input")}}))},initialize(e){e.wait_for_visible_lite((()=>{const t=r.LUID();const n=e.get_canvas();n.addClass("radio");e.autorun((()=>{if(e.get_static_property("use_dynamic_columns")){const t=Math.max(m,e.get_static_property("min_column_width_px")-h);n.css("grid-template-columns",`repeat(auto-fill, minmax(${t}px, 1fr))`)}else{n.css("grid-template-columns",`repeat(${e.get_static_property("columns")}, 1fr)`)}}));if(e.run_mode()){n.addClass(o.CLICKABLE_ELEMENT)}e.on_message("set_focus",(()=>n.find("input:first").focus()));_.on_property_change(e,"color",(e=>{for(const e of p.bootstrap_colors){n.removeClass(`radio-${e}`)}n.addClass(`radio-${e}`)}));let s={};function l(e,n){const r=a.dehydrate_tree_to_string_safe(e.value);const i=$(`<input type="radio" value="${r}" name="${t}" id="${t}_option_${n}"><label for="${t}_option_${n}">${e.display}</label>`);i.data("bubble_val",r);s[r]=i;return i}const c=()=>{if(e.edit_mode()&&_.evaluate_property(e,"choices_style")==="dynamic"){const t=["Dynamic choice 1","Dynamic choice 2","Dynamic choice 3","Dynamic choice 4"];e.get_canvas().data("Dynamic choice 1");return t.map((e=>({display:e,value:e})))}const t=this._get_raw_choice_list(e);const n=this._get_display_option(e);const r=t.get_children(0,f);i.run_once(30,(()=>r.map((e=>n(e)))));return r.map((e=>({display:n(e),value:e})))};let g=null;function v(t){var r,i;g=t;s=n.data("options_div_mapping");if(!t){if(e.edit_mode()){for(const e of Object.values((o=s)!=null?o:{})){var o;e[0].checked=true;return}}else{for(const e of Object.values((l=s)!=null?l:{})){var l;e[0].checked=false}}}const c=a.dehydrate_tree_to_string_safe(t);const u=(r=s)==null?void 0:(i=r[c])==null?void 0:i[0];if(u!=null){u.checked=true}}const b=()=>{n.empty();s={};c().forEach(((e,t)=>{const r=l(e,t);n.append(r)}));n.data("options_div_mapping",s);n.find("input[type=radio]").on("change",(function(){const t=d.rehydrate_dropdown_value($(this).data("bubble_val"));e.message("user_submit",t);v(t)}));v(g);const t=_.evaluate_property(e,"disabled");for(const e of Object.values((r=s)!=null?r:{})){var r;e[0].disabled=t}};u.input_change_autorun(e,(e=>v(e)));e.autorun((()=>{const t=_.evaluate_property(e,"disabled");for(const e of Object.values((n=s)!=null?n:{})){var n;e[0].disabled=t}}));e.autorun((()=>{if(e.is_visible()){b()}}))}))},_get_raw_btype(e){return d._get_raw_btype_dropdown(e)},_get_raw_choice_list(e){return d._get_raw_choice_list_dropdown(e,this)},_choice_list_contains(e,t){const n=l.get(this._get_raw_btype(e.element));return this._get_raw_choice_list(e).contains(t,n)},get_starting_content(e){let t;if(e.run_mode()&&e.get_static_property("auto_binding")){t=u.get_input_parent_thing_field(e)}else{t=_.evaluate_property(e,"default")}if(t==null||!this._choice_list_contains(e,t)){return null}return t},get_state_value(e,t){if(t==="value"){return this._get_raw_btype(e)}},get_injected_value(e){return e.get_static_property("dynamic_type")},get_injected_display(){return"Current option"},use_injected_datasource(e){return d.use_injected_datasource("option_display_expression",e)},content_validated(e,t){return e!=null||!_.evaluate_property(t,"mandatory")},css_files:["css/optional/radio.css"],uses_css_responsive:true,change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:true,is_input:true,is_container:false,no_is_focused:true})},{"../../../constants/runmode":83,"../../../db/hydrate":429,"../../../lang/btypes":653,"../../../lang/evaluation/element_eval":690,"../../../u/shared/async/autorun":830,"../../../u/shared/uuid":855,"../../property_applications":412,"../core_elements_utilities/element_transformer":285,"../shared/dropdowns":358,"../shared/inputs":364,"../shared/radiobuttons":369,"core-js/modules/web.dom-collections.iterator.js":1123}],314:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../property_applications");const s=e("../../../db/values/StaticList");const o=e("../core_elements_utilities/element_transformer");const a=e("../shared/groups");const l=e("../shared/repeating_groups");const c=e("../components/RepeatingGroupComponent");const u=e("../../../lang/evaluation/element_eval");const d=e("../../../lang/elements/ElementInstance");const p=e("../../../lang/btype_ids");const _=e("../Layouts/RepeatingGroupLayout");o.make_element("RepeatingGroup",{display:"Repeating Group",category:"containers",glyph_id:"repeating_group",list_order:2,keyboard_shortcut:null,defaults:{width:300,height:350,fixed_columns:true,fixed_rows:true},updated_default_sizing:{width:280},field_names:{group_type:{no_states:true},data_source:{},rows:{default:4},columns:{default:1},separator_style:{default:"dashed",no_states:true,in_style:true},separator_width:{default:1,no_states:true,in_style:true},separator_color:{default:"#969696",no_states:true,in_style:true},row_cell_gap:{default:0},column_cell_gap:{default:0},layout_style:{default:"infinite_scroll",no_states:true},cell_min_width:{no_states:true,default:100},fixed_width:{no_states:true},use_max_width:{no_states:true,default:false},max_width:{default:100,optional:true,no_states:true},allow_more_than_one_colum:{default:false,no_states:true},responsive_alignment:{default:"center",no_states:true},fixed_columns:{default:false,no_states:true},fixed_rows:{default:false,no_states:true},cell_min_width_css:{default:"100px"},cell_min_height_css:{default:"100px"},auto_fit_row:{default:false,no_states:true},auto_fit_column:{default:false,no_states:true},scroll_direction:{default:"vertical",no_states:true},show_all_items:{default:false,no_states:true},masonry:{default:false,no_states:true}},property_applications(e){return[new i.Dimensions,new i.Border,new i.BoxShadow,new i.Background,new i.ResponsiveElement(e),new i.ResponsiveContainer(e),new i.Opacity]},uses_css_responsive:true,solid_component:c,no_fixed_sizing:true,can_fit_width(e){return e.get_static_property("fixed_columns")||e.get_static_property("fixed_rows")||e.get_static_property("scroll_direction")!=="vertical"},can_fit_height(e){return e.get_static_property("fixed_columns")||e.get_static_property("fixed_rows")||e.get_static_property("scroll_direction")!=="horizontal"},get_html(e){return"<div></div>"},change_cursor_style_if_clickable:true,is_input:false,is_container:false,add_an_invisible_div_on_the_top:false,show_overflow_on_drag:true,get_states(e){return["list_data","show_range","loading"]},new_namespace:true,use_element_search_data(){},show_borders(e){return e.state("show_borders",true)},hide_borders(e){return e.state("show_borders",false)},is_list:true,can_have_children(){return true},register_children(e){},create_child_skeletons(e){var t;(t=e.repeating_group_layout)==null?void 0:t.do_create_container()},draws_own_children(){return true},draw_children(e){},can_defer_drawing(){return true},register(e){e.repeating_group_layout=new _.RepeatingGroupLayoutStyle({instance:e});e.repeating_group_layout.do_register();e.repeating_layout_type="RepeatingGroup";e.on_destroy((()=>{var t;(t=e.repeating_group_layout)==null?void 0:t.destroy()}))},initialize(e){e.repeating_group_layout.do_initialize()},get_children_canvas(e){return $("> .list-item",e.get_canvas())},get_min_width(e){if(e.get_static_property("fixed_width")){return e.get_width()}else{var t;const n=e.get_static_property((t="cell_min_width")!=null?t:0);const r=l._get_cell_width(e);if(n>r){return r}else{return n}}},get_state_value(e,t){if(t==="list_data"){const t=e.get_static_property("group_type");if(!t){return"null"}else{return p.list_type(t)}}return undefined},check_for_errors(e,t){var n;if(((n=e.root())==null?void 0:n.get_responsive_version())<1){if(e.get_static_property("layout_style")==="vertical_extendable"){function r(n){var i,s;const o=n.parent();if(o==null||((i=o.type)==null?void 0:i.call(o))==="Page"){return}if(((s=o.type)==null?void 0:s.call(o))==="RepeatingGroup"){if(o.get_static_property("layout_style")==="vertical_extendable"){t(e.get_name()+": extendible vertical scrolling repeating group cannot be nested")}}else{r(o)}}r(e)}}a._check_for_errors_datasource_set_to_self(e,"get_list_data",t)},add_specific_messages(e,t){if(t.E.get_state_value(t,"list_data")!=null){const n=t.E.get_state_value(t,"list_data");const r=n.split(".");if(r[r.length-1]===t.id()){return e}}const n=t.get_state_value("list_data");if(n){var i;r.extend(e,{get_list_data:{description:"'s "+n.display(),section:"States",ret_btype:n,fn(e,t){var r,i,o,a;return(r=e==null?void 0:(i=e.state("list_data"))==null?void 0:i.list_cast((o=n.inner())==null?void 0:o.id()))!=null?r:new s([],null,(a=n.inner())==null?void 0:a.id())}},get_loading_status:{description:" is loading",section:"States",ret_btype:"boolean",fn(e,t){var n;return(n=e==null?void 0:e.state("loading"))!=null?n:this.ret_btype_null()}}});if(((i=t.root())==null?void 0:i.get_responsive_version(true))>0){if(t.get_static_property("fixed_rows")&&t.get_static_property("fixed_columns")){r.extend(e,{page_number:{description:"'s page number",section:"States",ret_btype:"number",fn(e){let n,r;const i=e==null?void 0:e.state("show_range");if(e instanceof d){r=u.evaluate_property(e,"rows");n=u.evaluate_property(e,"columns")}else{r=t.get_static_property("rows",true);n=t.get_static_property("columns",true)}const s=r*n;if(i==null||r==null||n==null){return null}return Math.ceil(i/s)+1}},is_first_page:{description:" is on the first page",section:"States",ret_btype:"boolean",fn(e,t){return(e==null?void 0:e.state("show_range"))===0}},is_last_page:{description:" is on the last page",section:"States",ret_btype:"boolean",fn(e){var t;const n=e==null?void 0:e.state("show_range");const r=u.evaluate_property(e,"rows")*u.evaluate_property(e,"columns");const i=e==null?void 0:(t=e.state("list_data"))==null?void 0:t.length();return r+n>=i}}})}}else{if(t.get_static_property("layout_style")==="limit_items"){r.extend(e,{page_number:{description:"'s page number",section:"States",ret_btype:"number",fn(e){const t=e==null?void 0:e.state("show_range");if(t==null){return null}const n=u.evaluate_property(e,"rows");const r=n*l.get_fixed_cell_rg_column_count(e,1);return Math.ceil(t/r+1)}},is_first_page:{description:" is on the first page",section:"States",ret_btype:"boolean",fn(e,t){var n;return(n=(e==null?void 0:e.state("show_range"))===0)!=null?n:this.ret_btype_null()}},is_last_page:{description:" is on the last page",section:"States",ret_btype:"boolean",fn(e){var n,r,i;const s=(n=t.get_static_property("rows",true))!=null?n:1;const o=e==null?void 0:e.state("show_range");const a=s*l.get_fixed_cell_rg_column_count(e,1);const c=e==null?void 0:(r=e.state("list_data"))==null?void 0:r.length();return(i=a+o>=c)!=null?i:this.ret_btype_null()}}})}}}},get_messages(e){return["set_list_data","clear_list","show_previous","show_next","draw_till","scroll_to","go_to_page","resize_cell","resize_dummies"]}})},{"../../../db/values/StaticList":471,"../../../lang/btype_ids":652,"../../../lang/elements/ElementInstance":669,"../../../lang/evaluation/element_eval":690,"../../../u":823,"../../property_applications":412,"../Layouts/RepeatingGroupLayout":243,"../components/RepeatingGroupComponent":261,"../core_elements_utilities/element_transformer":285,"../shared/groups":360,"../shared/repeating_groups":371}],315:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../property_applications");const s=e("../core_elements_utilities/element_transformer");const o=e("../core_elements_utilities/element_workflows");const a=e("../shared/aspect_ratio");const l=e("../components/ShapeComponent");s.make_element("Shape",{category:"visual elements",glyph_id:"rectangle",list_order:5,keyboard_shortcut:"R",defaults:{bgcolor:"#DEDEDE",background_style:"bgcolor",width:150,height:150},field_names:r.extend({keep_proportion_resize:{no_states:true}},o.start_workflow_field_names),property_applications(e){return[new i.Dimensions,new i.Background,new i.Border,new i.BoxShadow,new i.Rotation,new i.ResponsiveElement(e),new i.Opacity]},uses_css_responsive:true,can_fix_aspect_ratio(){return true},solid_component:l,change_cursor_style_if_clickable:true,get_min_width(e){return 0},get_html(e){return"<div></div>"},can_defer_drawing(){return true},initialize(e){a.structure_fixed_aspect_ratio(e,e.canvas)},is_input:false,is_container:false,add_an_invisible_div_on_the_top:false,events:["ButtonClicked"]})},{"../../../u":823,"../../property_applications":412,"../components/ShapeComponent":264,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_workflows":288,"../shared/aspect_ratio":356}],316:[function(e,t,n){(function(t){(function(){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.immediate.js");const n=e("../../../u/shared/async/b_async");const r=e("../../../u/client/b_ui");const i=e("../../property_applications");const s=e("../../../constants/runmode");const o=e("../core_elements_utilities/element_transformer");const a=e("../shared/inputs");const l=e("../../../lang/evaluation/element_eval");o.make_element("SliderInput",{display:"Slider Input",category:"input forms",glyph_id:"slider",list_order:7,keyboard_shortcut:null,defaults:{width:200,height:45},field_names:{min_value:{default:0},max_value:{default:10},step:{default:1},range_type:{default:"simple",no_states:true,in_style:true},content:{},orientation:{no_states:true,default:"horizontal"},border_color:{default:"#aaa",in_style:true},background_color:{default:"#fff",in_style:true},handle_color:{default:"#e6e6e6",in_style:true},range_area_color:{default:"#cccccc",in_style:true},...a.get_disabled_field_name,...a.get_auto_binding_field_names},property_applications(e){return[new i.Dimensions,new i.ResponsiveElement(e),new i.Opacity]},get_html(e){return"<div></div>"},get_min_width(e){return 0},can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{const i=e.get_canvas();const o=n.MakeKey(null,"slider_init");const c=r.div("jquery-slider",i);c.slider();i.css("padding",8);const u=()=>c.slider("instance");e.on_destroy((()=>{if(u()){c.slider("destroy")}}));if(!e.run_mode()){c.off()}if(e.run_mode()){i.addClass(s.CLICKABLE_ELEMENT);e.wait_for_visible((()=>{n.WaitFor(o,(()=>{l.on_property_change(e,"disabled",(e=>{c.slider("option","disabled",e)}));e.on_message("set_focus",(()=>i.find(".ui-slider-handle").focus()))}))}))}l.pre_cache(e,["min_value","max_value","step","range_type","orientation","handle_color","range_area_color","border_color","background_color"]);e.autorun((()=>{var n,r;let i;if(e.element.get_styleable_static_property("range_type")==="range"){i="values"}else{i="value"}const s={};for(const t of["min_value","max_value","step","range_type","orientation","handle_color","range_area_color","border_color","background_color"]){s[t]=l.evaluate_property(e,t)}const d={min:(n=s.min_value)!=null?n:0,max:(r=s.max_value)!=null?r:9,step:s.step,range:s.range_type==="range",orientation:s.orientation,slide:(n,r)=>{t((()=>{e.message("user_change",c.slider(i))}));return true},stop:(n,r)=>{t((()=>{e.message("user_submit",c.slider(i))}));return true}};if(!e.thumbnail_mode()||u()){for(const[e,t]of Object.entries(d)){c.slider("option",e,t)}}const p={"margin-left":3,"margin-right":3,cursor:l.evaluate_property(e,"disabled")?"default":"pointer",background:s.background_color,"border-color":s.border_color};const _={cursor:l.evaluate_property(e,"disabled")?"default":"pointer",outline:"none","border-color":s.border_color};if(s.orientation==="horizontal"){p.height="100%";p.width="calc(100% - 7px)";_.top=-8;_.height="calc(100% + 16px)";_.width=19;c.find(".ui-slider-range").css({height:"100%"})}else{p.width="calc(100% - 6px)";p.height="calc(100% - 2px)";_.width="calc(100% + 11px)";_.height=19;c.find(".ui-slider-range").css({width:"100%"})}_.background=s.handle_color;if(s.range_type==="range"){c.find(".ui-slider-range").css({background:s.range_area_color})}c.css(p);c.find(".ui-slider-handle").css(_);o.turn();if(e.thumbnail_mode()&&!u()){return}a.input_change_autorun(e,(e=>{if(i==="values"&&e==null){e=[]}c.slider(i,e)}))}))}))},get_starting_content(e){let t;if(e.run_mode()&&e.get_static_property("auto_binding")){t=a.get_input_parent_thing_field(e)}else{t=l.evaluate_property(e,"content")}if(e.element.get_styleable_static_property("range_type")==="range"){var n,r,i,s,o,c;t=(n=(r=t)==null?void 0:(i=r.all)==null?void 0:i.call(r))!=null?n:t;if((s=t)!=null&&s.length){return t}const a=(o=l.evaluate_property(e,"min_value"))!=null?o:0;const u=(c=l.evaluate_property(e,"max_value"))!=null?c:9;return[a,u]}else{var u,d;return(u=(d=t)!=null?d:l.evaluate_property(e,"min_value"))!=null?u:0}},get_state_value(e,t){if(t==="value"){if(e.get_styleable_static_property("range_type")==="range"){return"number_range"}else{return"number"}}},uses_css_responsive:true,change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:true,is_input:true,is_container:false,jquery_plugins(){return["jquery_plugins/jquery-ui-slider-draggable.min","jquery_plugins/jquery.ui.touch-punch.min.js"]},css_files:["css/optional/jquery-ui.slider.css"],only_send_to_client_in_runmode:true})}).call(this)}).call(this,e("timers").setImmediate)},{"../../../constants/runmode":83,"../../../lang/evaluation/element_eval":690,"../../../u/client/b_ui":813,"../../../u/shared/async/b_async":832,"../../property_applications":412,"../core_elements_utilities/element_transformer":285,"../shared/inputs":364,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,timers:2334}],317:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=f(e("../../../lang/appquery"));var i=f(e("../../property_applications"));var s=f(e("../components/TableElement/TableMainAxisComponent"));var o=f(e("../components/TableElement/TableCellComponent"));var a=f(e("../components/TableElement/TableElementComponent"));var l=f(e("../core_elements_utilities/element_transformer"));var c=f(e("../components/TableElement/TableCrossAxisComponent"));var u=e("../../../editor/flag_check");var d=e("../components/utils/table_element");var p=e("../Layouts/TableLayout");var _=f(e("../../../lang/lang"));function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(e==null){return t.get_name()}return`${e.get_name()}'s ${t.get_name()}`}l.default.make_element("Table",{display:"Table",category:"containers",glyph_id:"table",list_order:3,keyboard_shortcut:null,condition(e){return(0,u.tableElementOn)()&&r.default.get_public_setting("bubble_version")>=21&&e!=null&&e.get_responsive_version()>0},defaults:{width:d.NUM_DEFAULT_COLUMNS*d.DEFAULT_COLUMN_WIDTH,height:d.NUM_DEFAULT_ROWS_EDITOR*d.DEFAULT_REPEATING_ROW_HEIGHT+d.DEFAULT_HEADER_ROW_HEIGHT},generate_default_children(){function e(e,t,n){return{id:e,type:"TableMainAxis",properties:{axis_index:t},default_name:n}}const t=Array.from({length:d.NUM_DEFAULT_COLUMNS},(()=>r.default.uid()));function n(e,n,i){const s={fixed_number_repeating_axis:true,fixed_number_repeating_axis_count:d.NUM_DEFAULT_ROWS_EDITOR};return{id:r.default.uid(),type:"TableCrossAxis",properties:{axis_index:e,cross_axis_repeat:n,min_height_css:`${n?d.DEFAULT_REPEATING_ROW_HEIGHT:d.DEFAULT_HEADER_ROW_HEIGHT}px`,...n?s:{},min_width_css:`${n?d.DEFAULT_REPEATING_ROW_HEIGHT:d.DEFAULT_HEADER_ROW_HEIGHT}px`},default_name:i,elements:Object.fromEntries(t.map((e=>[r.default.uid(),{id:r.default.uid(),type:"TableCell",properties:{cell_main_axis_id:e},default_name:"Cell"}])))}}return{...Object.fromEntries(t.map(((t,n)=>[r.default.uid(),e(t,n,`Column ${(0,d.getLetterIndex)(n)}`)]))),[r.default.uid()]:n(0,false,"Row 0"),[r.default.uid()]:n(1,true,"Row 1 (Repeating)")}},standard_container_layout:"table",field_names:{table_direction:{no_states:true,default:"vertical"},group_type:{no_states:true},data_source:{},vertical_separator_style:{no_states:true,default:"solid",in_style:true},vertical_separator_width:{default:1,in_style:true,no_states:true},vertical_separator_color:{default:"#ECECEC",in_style:true,no_states:true},horizontal_separator_style:{default:"solid",in_style:true,no_states:true},horizontal_separator_width:{default:1,in_style:true,no_states:true},horizontal_separator_color:{default:"#ECECEC",in_style:true,no_states:true}},uses_css_responsive:true,can_fit_width:true,can_fit_height:true,property_applications(e){return[new i.default.Dimensions,new i.default.Border,new i.default.BoxShadow,new i.default.Background,new i.default.ResponsiveElement(e),new i.default.PaddingFields,new i.default.Opacity]},change_cursor_style_if_clickable:true,can_defer_drawing(){return true},get_min_width(){return 0},register(e){e.table_element_layout=new p.TableLayout(e)},get_html(e){return"<div></div>"},initialize(e){const t=e.canvas;t.addClass("bubble-legacy-table");t.append('<span class="incompatible-message">Incompatible: Table Element</span>')},is_container:true,is_restricted_container:true,can_have_children(){return true},get_children_canvas(e){return e.get_canvas()},is_input:false,add_an_invisible_div_on_the_top:false,solid_component:a.default});l.default.make_element("TableMainAxis",{field_names:{axis_index:{no_states:true}},property_applications(e){return[new i.default.ResponsiveElement(e)]},uses_css_responsive:true,can_fit_width:true,can_fit_height:true,is_input:false,is_container:false,should_not_be_brought_to_front_when_selected:true,get_min_width(){return 0},not_draggable(){return true},no_margins(){return true},is_pseudo:true,no_thumbnail:true,cant_delete(e){return(0,d.getAxes)(e.parent(),"TableMainAxis").length<=1},generate_name(e){const t=(0,d.getRelativeIndex)(e);const n=(0,d.isTableDirectionHorizontal)(e.parent())?"Row":"Column";return`${n} ${(0,d.getLetterIndex)(t)}`},name_for_datasource(e){return h(e.parent(),e)},get_type_display(e){return(0,d.isTableDirectionHorizontal)(e.parent())?"Row":"Column"},manual_wrapper:true,change_cursor_style_if_clickable:true,add_an_invisible_div_on_the_top:false,get_html(e){return"<div></div>"},initialize(e){},compute_initial_properties(e,t,n){if((n==null?void 0:n.neighborId)!==undefined){const t=r.default.element(n.neighborId).type();e.properties.axis_index=(0,d.updateIndicesOnCreate)(n.neighborId,t,n.direction)}},solid_component:s.default});l.default.make_element("TableCrossAxis",{field_names:{axis_index:{no_states:true},cross_axis_repeat:{no_states:true,default:false},fixed_number_repeating_axis:{no_states:true,default:false},fixed_number_repeating_axis_count:{default:1}},property_applications(e){return[new i.default.ResponsiveElement(e),new i.default.Opacity,new i.default.Background]},no_margins(){return true},get_states(){return["list_data"]},register(e){e.repeating_layout_type="Table"},compute_initial_properties(e,t,n){if((n==null?void 0:n.neighborId)!==undefined){const t=r.default.element(n.neighborId).type();e.properties.axis_index=(0,d.updateIndicesOnCreate)(n.neighborId,t,n.direction)}e.properties.cross_axis_repeat=false},generate_default_children(e){var t,n;const i=(t=e==null?void 0:(n=e.parent())==null?void 0:n.elements().filter((e=>e.type()==="TableMainAxis")).sort(((e,t)=>e.get_static_property("axis_index")-t.get_static_property("axis_index"))).map((e=>[e.get_static_property("axis_index"),e.id()])))!=null?t:[];return Object.fromEntries(i.map((e=>{let[t,n]=e;return[r.default.uid(),{id:r.default.uid(),type:"TableCell",properties:{cell_main_axis_id:n},default_name:"Cell"}]})))},autofix_issues(e){const t=e.parent();if(t==null)return;const n=new Set(t.elements().filter((e=>e.type()==="TableMainAxis")).map((e=>e.id())));let i=false;for(const t of e.elements()){const e=t.get_static_property("cell_main_axis_id");if(n.has(e)){n.delete(e)}else{t.delete();i=true}}for(const t of n){const n=r.default.uid();const s={id:n,type:"TableCell",properties:{cell_main_axis_id:t},default_name:"Cell"};e.new_child_element(n,s);i=true}if(i){_.default.wait_for_stable((()=>{r.default.commit_merge()}))}},uses_css_responsive:true,can_fit_width:true,can_fit_height:true,is_input:false,is_container:true,is_restricted_container:true,can_have_children(){return true},get_children_canvas(e){return e.get_canvas()},get_min_width(){return 0},not_draggable(){return true},is_pseudo:true,no_thumbnail:true,cant_delete(e){return e.get_static_property("cross_axis_repeat")},generate_name(e){const t=(0,d.getRelativeIndex)(e);const n=(0,d.isTableDirectionHorizontal)(e.parent())?"Column":"Row";const r=e.get_static_property("cross_axis_repeat")?" (Repeating)":"";return`${n} ${t}${r}`},name_for_datasource(e){return h(e.parent(),e)},get_type_display(e){return(0,d.isTableDirectionHorizontal)(e.parent())?"Column":"Row"},manual_wrapper:true,standard_container_layout:"table_cross_axis",change_cursor_style_if_clickable:true,add_an_invisible_div_on_the_top:false,can_reference(e){return!e.get_static_property("cross_axis_repeat")},register_children(e){if(e.get_static_property("cross_axis_repeat")&&e.run_mode()){return}e._default_register_children(e.element.elements())},draws_own_children(e){return e.get_static_property("cross_axis_repeat")},draw_children(e){},get_html(e){return"<div></div>"},initialize(e){},solid_component:c.default,get_messages(e){return["draw_till"]}});l.default.make_element("TableCell",{display:"Cell",field_names:{cell_main_axis_id:{no_states:true}},property_applications(e){return[new i.default.ResponsiveContainer(e),new i.default.PaddingFields,new i.default.Opacity,new i.default.Background]},uses_css_responsive:true,always_visible:true,is_input:false,is_container:true,can_have_children(){return true},get_children_canvas(e){return e.get_canvas()},get_min_width(){return 0},not_draggable(){return true},show_overflow_on_drag:true,not_resizable(){return true},no_margins(){return true},is_pseudo:true,cant_delete(){return true},generate_name(e){const t=e.parent();if(t==null)return"Cell";const n=(0,d.getRelativeIndex)(t);const i=e.get_static_property("cell_main_axis_id");const s=(0,d.getRelativeIndex)(r.default.element(i));return`Cell ${n}${(0,d.getLetterIndex)(s)}`},name_for_datasource(e){var t;return h((t=e.parent())==null?void 0:t.parent(),e)},manual_wrapper:true,change_cursor_style_if_clickable:true,add_an_invisible_div_on_the_top:false,can_fit_height:true,can_fit_width:true,get_html(e){return"<div></div>"},initialize(e){},solid_component:o.default})},{"../../../editor/flag_check":575,"../../../lang/appquery":651,"../../../lang/lang":714,"../../property_applications":412,"../Layouts/TableLayout":244,"../components/TableElement/TableCellComponent":266,"../components/TableElement/TableCrossAxisComponent":267,"../components/TableElement/TableElementComponent":268,"../components/TableElement/TableMainAxisComponent":269,"../components/utils/table_element":281,"../core_elements_utilities/element_transformer":285,"core-js/modules/web.dom-collections.iterator.js":1123}],318:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../lang/appquery");const s=e("../../property_applications");const o=e("../core_elements_utilities/element_utils");const a=e("../core_elements_utilities/element_transformer");const l=e("../core_elements_utilities/element_workflows");const c=e("../shared/text_elements");const u=e("../../../lang/evaluation/element_eval");const{PADDING_VERSION:d}=e("../../../constants/elements");const p=e("../components/TextComponent");a.make_element("Text",{category:"visual elements",glyph_id:"type",list_order:1,keyboard_shortcut:"T",defaults:{width:200,height:45},field_names:r.extend({text:{default:"...edit me..."},editor_preview_text:{no_states:true,only_edit_mode:true},stretch_to_fit:{default:false,no_states:true},cut_off_content:{no_states:true},shrink_if_less_high:{no_states:true},tag_type:{no_states:true,default:"normal",in_style:true},recognize_links:{no_states:true},link_color:{optional:true,no_states:true},nofollow:{no_states:true},no_bbcode:{no_states:true}},l.start_workflow_field_names),property_applications(e){return[new s.Dimensions,new s.Font,new s.FontShadow,new s.FontSpacing,new s.PaddingText,new s.PaddingFields({minimum_element_version:d,no_vertical_if_legacy_center:true,allow_legacy:true}),new s.Border,new s.BoxShadow,new s.Background,new s.ResponsiveElement(e),new s.ToolTip,new s.Rotation,new s.Opacity]},uses_css_responsive:true,can_fit_width:true,can_fit_height:true,solid_component:p,change_cursor_style_if_clickable:true,get_html(e){if(!e.run_mode()||e.get_static_property("tag_type")==="normal"||!i.get_public_setting("expose_text_tags")){return"<div></div>"}else{const t=e.get_static_property("tag_type");return"<"+t+"></"+t+">"}},get_min_width(e){return 0},can_defer_drawing(){return true},register(){},attempt_size_only_draw(e){return e.element.no_size_when_hidden()},initialize(e){const t=e.get_canvas();e.autorun((()=>{if(i.get_public_setting("bubble_version")>=10){s.apply_css_style(t,{"white-space":"pre-wrap"})}else{s.apply_css_style(t,{"white-space":""})}}));e.wait_for_visible_lite((()=>{let n;if(e.edit_mode()){n="letter";t[0].style.overflow="hidden"}else{n="words";t[0].style.overflow="visible"}u.pre_cache(e,["text","font_size","padding_vertical","line_height","word_spacing","letter_spacing","rotation_angle","vertical_centering","editor_preview_text"]);_(e);e.autorun((()=>{if(c.could_clip(e)){c.apply_dotdotdot(e,n)}else{c.remove_dotdotdot(e)}}));e.on_destroy((()=>{c.remove_dotdotdot(e)}))}))},is_input:false,is_container:false,add_an_invisible_div_on_the_top:false,events:["ButtonClicked"],css_files:["css/optional/font-awesome.min.css"]});function _(e){const t=e.get_canvas();e.autorun((()=>{const n=["text","font_size","font_face","padding_vertical","line_height","link_color","nofollow","vertical_centering","editor_preview_text"];const r={};for(const t of n){r[t]=u.evaluate_property(e,t)}if(e.is_animating()){return}if(e.run_mode()){if(e.element.element_version(true)<d){var i;t[0].style["padding-bottom"]=((i=r.padding_vertical)!=null?i:0)+"px"}if(!e.is_visible()){return}s.apply_css_style(t,{"word-break":"break-word"});c.apply_text(e,t,r)}else{c.apply_text(e,t,r);o.do_add_an_invisible_div_on_the_top(e)}}))}},{"../../../constants/elements":61,"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../u":823,"../../property_applications":412,"../components/TextComponent":270,"../core_elements_utilities/element_transformer":285,"../core_elements_utilities/element_utils":286,"../core_elements_utilities/element_workflows":288,"../shared/text_elements":373,"core-js/modules/web.dom-collections.iterator.js":1123}],319:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("../../../u/client/color");const i=e("../../../constants/known_plugins");const s=e("../../../u/shared/async/b_async");const o=e("../../../u/client/b_ui");const a=e("../../property_applications");const l=e("../../../services/shared/plugin_registry");const c=e("../core_elements_utilities/element_transformer");const u=e("../shared/video_elements");const d=e("../shared/image_utils");const{PADDING_VERSION:p}=e("../../../constants/elements");const _=e("../shared/aspect_ratio");const f=e("../../../lang/evaluation/element_eval");const h=e("../../../u");const m=e("../../../lib");const g=e("../../../client/analytics");const v=e("../../../constants/segment_events");const b="https://www.youtube.com/iframe_api";let y=s.MakeKey(null,"always turned");y.turn();function w(e,t){const n=s.MakeKey(null,"next video");s.WaitFor(y,(()=>setTimeout((()=>{if(!(t!=null&&t.is_destroyed())){e()}n.turn()}),10)));y=n}c.make_element("Video",{category:"visual elements",glyph_id:"video",list_order:7,keyboard_shortcut:null,defaults:{width:320,height:240,collapse_margin:500,use_max_width:true,max_width:100},field_names:{video_source:{default:"youtube",no_states:true},video_id:{},auth_token:{optional:true,no_states:true},autoplay:{default:false,no_states:true},loop:{default:false,no_states:true},control_color_vimeo:{default:"#00adef",no_states:true,in_style:true}},can_fix_aspect_ratio(){return true},property_applications(e){return[new a.Dimensions,new a.Padding,new a.PaddingFields({minimum_element_version:p,allow_legacy:true}),new a.Border,new a.BoxShadow,new a.ResponsiveElement(e),new a.Opacity]},uses_css_responsive:true,get_html(e){return"<div></div>"},get_min_width(){return 0},notify_width(e,t){return d.keep_proportions(e,t,true)},add_an_invisible_div_on_the_top:true,change_cursor_style_if_clickable:false,can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{const t="youtube_uuid_"+h.LUID();const n=e.get_canvas();e.setTimeout((()=>{f.pre_cache(e,["video_source","video_id","autoplay","control_color_vimeo","padding_horizontal","padding_vertical","loop","auth_token"]);const s={};e.autorun((()=>{const c={};const d={};for(const t of["video_source","video_id","autoplay","control_color_vimeo","padding_horizontal","padding_vertical","loop","auth_token"]){d[t]=f.evaluate_property(e,t);if(d[t]!==s[t]){c[t]=d[t];s[t]=d[t]}}d.width_to_subtract=2*d.padding_horizontal+a.calculate_border_width(e);d.height_to_subtract=2*d.padding_vertical+a.calculate_border_height(e);for(const e of["width_to_subtract","height_to_subtract"]){if(d[e]!==s[e]){c[e]=d[e];s[e]=d[e]}}let p=`<iframe allow="autoplay; fullscreen" width="100% - ${d.width_to_subtract}" height=" 100% - ${d.height_to_subtract}" `;if(u.should_block_cookies()){p+=' sandbox="allow-same-origin allow-presentation allow-scripts" '}let h;if(d.video_source==="youtube"){var g;p+=`id = ${t} `;if(((g=d.video_id)==null?void 0:g.indexOf)!=null&&d.video_id.indexOf("watch?v=")!==-1){d.video_id=d.video_id.split("watch?v=")[1]}h=`//www.youtube.com/embed/${d.video_id}?rel=0`;h+="&enablejsapi=1";if(d.autoplay&&e.run_mode()){h+="&autoplay=1"}if(d.loop&&e.run_mode()){h+="&loop=1&playlist="+d.video_id}p+=' frameborder="0" allowfullscreen modestbranding="1" autohide="1"'}if(d.video_source==="vimeo"){var v;if(((v=d.video_id)==null?void 0:v.indexOf)!=null&&d.video_id.indexOf("https://vimeo.com/")!==-1){d.video_id=d.video_id.split("https://vimeo.com/")[1]}const t=r.rgb_to_hex(d.control_color_vimeo).code.slice(1);h="//player.vimeo.com/video/"+d.video_id+"?title=0&byline=0&portrait=0&color="+t;if(d.autoplay&&e.run_mode()){h+="&autoplay=1"}if(d.loop&&e.run_mode()){h+="&loop=1"}p+=' frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'}let b,y;if(d.video_source===i.ZIGGEO){const e=l.get_hardcoded_plugin(i.ZIGGEO);y=d.auth_token||(e==null?void 0:e.get_key(e.key_for_html_header));if(y){var x,A,M;b=$("<ziggeoplayer/>");b.attr({video:(x=d.video_id)!=null?x:"no_video",application:y,auth:"true",width:"100%",height:"100%",autoplay:(A=d.autoplay)!=null?A:"false",loop:(M=d.loop)!=null?M:"false",theme:"modern"});const e=b[0].outerHTML.replace(/"/g,"'");p+=` frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen\nstyle='overflow:hidden'\nsrcdoc="\n<html style='overflow:hidden'>\n<head style='overflow:hidden'>\n    <meta http-equiv='Content-Security-Policy' content='upgrade-insecure-requests'>\n    <link rel='stylesheet' href='https://assets.ziggeo.com/v2-stable/ziggeo.css' />\n    <script src='https://assets.ziggeo.com/v2-stable/ziggeo.js'><\/script>\n</head>\n<body style='margin:0px'>\n    ${e}\n</body>\n</html>\n"`}else{h=`https://ziggeo.io/p/${d.video_id}`;p+=`height="100%"\nframeborder="0"\nscrolling="no"\nreferrerpolicy="no-referrer"\nallowspeakers ${d.autoplay?"allowautoplay":""} allowfullscreen\nallow="${d.autoplay?"autoplay *; ":""}  fullscreen *"\nstyle="width:100%;height:100%" `}}p+="></iframe>";if(d.video_source!=="ziggeo"||!y){b=$(p);b.attr("src",h)}let E=d.video_source!=="ziggeo";const k={width_to_subtract:true,height_to_subtract:true};for(const e in c){if(k[e]){continue}E=false;break}const O=e.element.has_fixed_aspect_ratio();if(e.run_mode()){if(E){_.structure_fixed_aspect_ratio(e,n);n.children().attr(_.element_css(O));return}if(d.video_id){w((()=>{n.empty();b.css(_.element_css(O));b.css("position","absolute");_.structure_fixed_aspect_ratio(e,n);n.append(b)}),e)}else{n.empty();_.structure_fixed_aspect_ratio(e,n)}}else{n.empty();const t=o.img("",n,"//s3.amazonaws.com/appforest_uf/f1665093563671x395094029933674050/video.png");t.css(_.element_css(O));_.structure_fixed_aspect_ratio(e,n)}const S=m().appname()==="meta"&&d.video_source==="youtube"&&e.run_mode();if(S){j(e,t,d.video_id)}}))}),20)}))},is_input:false,is_container:false});function x(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.src=e;r.addEventListener("load",t);r.addEventListener("error",(e=>n(e.error)));document.head.appendChild(r)}))}function j(e,t,n){x(b).then((()=>{let e;window.YT.ready((function(){r()}));function r(){e=new window.YT.Player(t,{videoId:n,events:{onStateChange:o,onPlaybackQualityChange:i,onPlaybackRateChange:s}})}function i(t){const r=E(n,e,"onPlaybackQualityChange");g.track(v.YOUTUBE_VIDEO_QUALITY_CHANGED,r)}function s(t){const r=E(n,e,"onPlaybackRateChange");g.track(v.YOUTUBE_VIDEO_RATE_CHANGED,r)}function o(t){const r=E(n,e,"onStateChange");const i=M(t.data);g.track(i,r)}})).catch((e=>{console.error(e)}))}const A={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"video cued"};const M=function(e){switch(k(e)){case"ended":return v.YOUTUBE_VIDEO_ENDED;case"playing":return v.YOUTUBE_VIDEO_PLAYING;case"paused":return v.YOUTUBE_VIDEO_PAUSED;case"buffering":return v.YOUTUBE_VIDEO_BUFFER;case"video cued":return v.YOUTUBE_VIDEO_CUED;default:return`Youtube video: unknown event ${e}`}};function E(e,t,n){return{video_id:e,video_title:t.videoTitle,video_timestamp_in_secs:t.getCurrentTime(),video_total_duration:t.getDuration(),video_playback_rate:t.getPlaybackRate(),video_playback_quality:t.getPlaybackQuality(),event_name:n,current_user_id:m().current_user()._id(),current_user_email:m().current_user().get_email()}}const k=function(e){return A[e==null?void 0:e.toString()]}},{"../../../client/analytics":20,"../../../constants/elements":61,"../../../constants/known_plugins":72,"../../../constants/segment_events":85,"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../services/shared/plugin_registry":784,"../../../u":823,"../../../u/client/b_ui":813,"../../../u/client/color":817,"../../../u/shared/async/b_async":832,"../../property_applications":412,"../core_elements_utilities/element_transformer":285,"../shared/aspect_ratio":356,"../shared/image_utils":363,"../shared/video_elements":374,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],320:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const{LATEST_ELEMENT_VERSION:r,OLD_VERSION_OVERRIDE_PROPERTIES:i}=e("../../constants/elements");const s=e("../../lib");const o=e("../../lang/appquery");const a=e("../../u/shared/async/autorun");const l=e("../../logger");const c=e("../../webfonts");const u=e("../../constants/fonts");const d=n;const p=[{font_family:"font_face",font_weight:"font_face"},{padding_left:"padding_horizontal",padding_right:"padding_horizontal",padding_top:"padding_vertical",padding_bottom:"padding_vertical"},{},{}];const _=[{font_face:["font_family","font_weight"]},{padding_horizontal:["padding_left","padding_right"],padding_vertical:["padding_bottom","padding_top"]},{},{}];const f=[(e,t)=>{const{font_family:n,variant:r}=c.get_unquoted_face_and_variant(t);if(e==="font_family"){return n}else{if(r==="custom"){return"400"}else{var i;return(i=u.NAMED_WEIGHTS[r])!=null?i:r}}},(e,t)=>t,()=>{}];d.get_mapped_property=function(e,t,n){for(let r=e;r<t;r++){if(p[r][n])return p[r][n]}return null};d.get_unmapped_properties=function(e,t,n){for(let r=e;r<t;r++){if(_[r][n])return _[r][n]}return[]};d.map_property=function(e,t,n,r){for(let i=e;i<t;i++){if(p[i][n]){return f[i](n,r)}}return r};function h(e){function t(e){const t=e.get_static_property("font_face",true);if(t!=null){const{font_family:r,variant:i}=c.get_unquoted_face_and_variant(t);if(i==="custom"){e.set_property("font_family",t)}else{var n;e.set_property("font_family",r);e.set_property("font_weight",(n=u.NAMED_WEIGHTS[i])!=null?n:i)}}else{e.set_property("font_family",null);e.set_property("font_weight",null)}}if(e.type()==="CustomElement"){return}t(e);for(const n of e.states()){if(n.property_names().includes("font_face")){t(n)}}}function m(e){function t(e){for(const t of["padding_vertical","padding_horizontal"]){const n=e.get_static_property(t,true);if(n!=null){let r=[];if(t==="padding_vertical"){r=["padding_top","padding_bottom"]}else{r=["padding_left","padding_right"]}for(const t of r){if(!e.get_style_if_exists()){e.set_property(t,n)}}}}}if(e.type()==="CustomElement"){return}t(e);for(const n of e.states()){if(n.property_names().includes("padding_vertical")||n.property_names().includes("padding_horizontal")){t(n)}}}function g(e){function t(e){const t={grey:"rgba(169, 169, 169, 1)",white:"rgba(255,255,255,1)",black:"rgba(0,0,0,1)",blue:"rgba(96, 174, 247, 1)",green:"rgba(105, 199, 101, 1)",red:"rgba(255, 133, 133, 1)"};const n=e.get_static_property("placeholder_color",true);if(n!=null&&n in t){e.set_property("placeholder_color",t[n])}}if(e.type()==="CustomElement"){return}t(e);for(const n of e.states()){if(n.property_names().includes("placeholder_color")){t(n)}}}function v(e){function t(e){if(e.get_style_if_exists()==null)return;const t=e.json.raw().properties;for(const n of Object.keys(t)){if(e.is_styleable_property(n)&&!i.includes(n)){e.set_property(n,null)}}}if(e.type()==="CustomElement"){return}t(e)}const b=[{element_upgrade_fn:h,style_upgrade_fn:h},{element_upgrade_fn:m,style_upgrade_fn:m},{element_upgrade_fn:g,style_upgrade_fn:g},{element_upgrade_fn:v}];d.upgrade_root=function(e){if(s().undostack.get_write_mode()!==s().undostack.WRITE){return}a.run_once(300,(()=>{const t=e.element_version();const n=[];if(t<r){function i(e){n.push(e);e.elements().forEach(i)}i(e)}return[t,n]}),((t,n)=>{if(t!=null){l.error("error upgrading page",{err:t});return}const[i,o]=n;if(i<r){e.commit();o.forEach((e=>{for(let s=i;s<r;s++){var t,n;(t=(n=b[s]).element_upgrade_fn)==null?void 0:t.call(n,e)}}));e.set_property("element_version",r);s().undostack.commit_without_undo()}}),true)};d.upgrade_styles=function(){a.run_once(300,(()=>{var e;const t=(e=o.get_public_setting("style_version"))!=null?e:0;if(t>=r)return;const n=o.styles();o.commit();n.forEach((e=>{for(let s=t;s<r;s++){var n,i;(n=(i=b[s]).style_upgrade_fn)==null?void 0:n.call(i,e)}}))}),(e=>{if(e!=null){l.error("error upgrading pages",{err:e});return}o.set_setting(true,"style_version",r);s().undostack.commit_without_undo()}),true)}},{"../../constants/elements":61,"../../constants/fonts":68,"../../lang/appquery":651,"../../lib":741,"../../logger":744,"../../u/shared/async/autorun":830,"../../webfonts":858,"core-js/modules/web.dom-collections.iterator.js":1123}],321:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../logger");const s=e("../../lang/elements");const o=e("../property_applications");const a=e("../../lang/evaluation/element_eval");const l=e("./core_elements_utilities/element_transformer");const c=e("./components/GroupItemComponent");const u={};const d={};l.make_element("GroupItem",{get_html(){return"<div></div>"},default_group_data(){return s.STATE_NOT_READY},can_register_workflows(e){var t;(t=e._can_register_workflow_key)!=null?t:e._can_register_workflow_key=r.MakeKey(null,"_can_register_workflow_key");return e._can_register_workflow_key},uses_css_responsive:true,always_visible:true,solid_component:c,register(e){e.split_namespace();e.autorun((()=>{const t=e.element_id();e.parent().add_to_namespace(e);if(t&&e.canvas){e.canvas[0].key=t}}))},initialize(e){var t;e.canvas.addClass("group-item entry-"+e.element.num+" ");const n=e.element.repeating_instance;if(((t=n.element.root())==null?void 0:t.get_responsive_version())<1){const s=n.get_static_property("layout_style");function l(){if(n.columns!=null){return n.columns}if(s==="show_all"&&n.children.length>0&&n.children[0].canvas.width()>0){const e=n.canvas.width();const t=n.children[0].canvas.width();return Math.floor(e/t)||1}return a.evaluate_property(n,"columns")}function c(e){if(e>1){const e=n.get_static_property("separator_width",true);const t=n.get_static_property("separator_style",true);return[undefined,null,"none"].includes(t)?0:e}else{return 0}}const{num:p}=e.element;function _(){if(s==="horizontal_scroll"){return 1}else{return Math.floor((p-1)/l())+1}}function f(){if(s==="limit_items"){return a.evaluate_property(n,"rows")}else if(["show_all","vertical_extendable"].includes(s)){return Math.ceil(n.last_cell/l())}else if(s==="horizontal_scroll"){return 1}}let h=null;e.autorun((()=>{var t,r;h=n.toUniqueString();(r=d[t=h])!=null?r:d[t]={};const i=_();if(e.is_visible()&&!d[h][i]){var s;d[h][i]=Math.max((s=d[h][i])!=null?s:0,e.get_canvas().height())}}));const m=()=>r.run_once(30,(()=>{const t=f();if(!t){return 0}let r=0;for(let n=1;n<=t;n++){var i;const t=c(n);const s=((i=d[h])==null?void 0:i[n])||e.element.get_height();r+=t+s}return r+o.calculate_border_height(n,true)}),((e,t)=>{if(e){i.log(e)}n.set_height(t)}));let g=null;e.on_message("child_movement",(t=>{g=t;return r.WaitFor(e.drawn_key,(()=>e.wait_for_visible((()=>{var t,r;const i=e.element_id();(r=u[t=h])!=null?r:u[t]={};let o;if(g==null){o=u[h][i]}else{o=e.element.get_height()+g;e.get_canvas().height(o);u[h][i]=o}e.get_canvas()[0].key=i;const a=(_()-1)*l()+1;const p=s==="horizontal_scroll"?n.last_cell:a+l()-1;const f=[];let v=o-c(_());for(let e=a;e<=p;e++){var b;const t=(b=n.children[e-1])==null?void 0:b.canvas;if(t){f.push(t);const e=u[h][t[0].key];if(e&&e>v){v=e}}}for(const e of f){e.height(v)}if(s!=="infinite_scroll"){d[h][_()]=v;return m()}}))))}));e.on_message("child_shown",(()=>{if(s!=="infinite_scroll"){return m()}}));e.on_resize((e=>{if(s==="show_all"){return m()}}))}},do_show(e,t,n,r){e.canvas.show();e._is_visible_me=true;e._update_visible()},do_hide(e,t,n,r){e._is_visible_me=false;e._update_visible();e.canvas.hide()},position_canvas(e,t){return t.container.get_canvas().append(e)},added_to_container(){return true},is_container:true,can_have_children(){return true},get_children_canvas(e){return e.get_canvas()},get_private_messages(){return["child_movement","child_shown"]},is_input:false,change_cursor_style_if_clickable:false,add_an_invisible_div_on_the_top:false,property_applications:[]})},{"../../lang/elements":680,"../../lang/evaluation/element_eval":690,"../../logger":744,"../../u":823,"../property_applications":412,"./components/GroupItemComponent":252,"./core_elements_utilities/element_transformer":285,"core-js/modules/web.dom-collections.iterator.js":1123}],322:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r;const i=e("../../lang/elements/style_properties");const s=e("./core_elements_utilities/element_registry");const o=e("./core_elements_utilities/element_optional_utils");(r=o.optional_modules)!=null?r:o.optional_modules={};e("./elements/Alert");e("./elements/AutocompleteDropdown");e("./elements/Button");e("./elements/Checkbox");e("./elements/DateInput");e("./elements/Dropdown");e("./elements/FileInput");e("./elements/FloatingGroup");e("./elements/GoogleMaps");e("./elements/Group");e("./elements/GroupFocus");e("./elements/GroupWithFocus");e("./elements/HTML");e("./elements/Icon");e("./elements/Image");e("./elements/Input");e("./elements/Link");e("./elements/MultiLineInput");e("./elements/Page");e("./elements/PictureInput");e("./elements/Popup");e("./elements/PoweredByBubble");e("./elements/RadioButtons");e("./elements/RepeatingGroup");e("./elements/Shape");e("./elements/SliderInput");e("./elements/TableElement");e("./elements/Text");e("./elements/VideoComponent");e("./group_item_plugin");e("./custom_definition");e("./components/LegacyContainerComponent");for(const e of Object.values(s.registered_elements)){if(e.field_names){for(const[t,n]of Object.entries(e.field_names)){if(n.in_style){i.register_style_property(t)}}}}},{"../../lang/elements/style_properties":684,"./components/LegacyContainerComponent":257,"./core_elements_utilities/element_optional_utils":283,"./core_elements_utilities/element_registry":284,"./custom_definition":289,"./elements/Alert":291,"./elements/AutocompleteDropdown":292,"./elements/Button":293,"./elements/Checkbox":294,"./elements/DateInput":295,"./elements/Dropdown":296,"./elements/FileInput":297,"./elements/FloatingGroup":298,"./elements/GoogleMaps":299,"./elements/Group":300,"./elements/GroupFocus":301,"./elements/GroupWithFocus":302,"./elements/HTML":303,"./elements/Icon":304,"./elements/Image":305,"./elements/Input":306,"./elements/Link":307,"./elements/MultiLineInput":308,"./elements/Page":309,"./elements/PictureInput":310,"./elements/Popup":311,"./elements/PoweredByBubble":312,"./elements/RadioButtons":313,"./elements/RepeatingGroup":314,"./elements/Shape":315,"./elements/SliderInput":316,"./elements/TableElement":317,"./elements/Text":318,"./elements/VideoComponent":319,"./group_item_plugin":321,"core-js/modules/web.dom-collections.iterator.js":1123}],323:[function(e,t,n){"use strict";const r=e("../../../../u");const i=e("../../../property_applications");const s=e("../../shared/image_utils");const o=e("../../../../lang/evaluation/element_eval");t.exports={property_applications:[new i.MinWidth],can_defer_drawing(){return true},register(e){if(!e.run_mode()){o.on_property_change(e,"at_to_top",(t=>{if(t){const{element:t}=e;t.set_property("width",t.root().get_width());t.set_property("top",0);t.set_property("left",0)}}))}if(e.edit_mode()){o.on_property_change(e,["top","left","width"],(t=>{let{top:n,left:r,width:i}=t;if(n!==0||r!==0||i!==e.element.root().get_width()){e.element.set_property("at_to_top",false)}}))}e.on_message("show_alert",(t=>{if(e.is_drawn){e.message("do_show_alert",t);return}e.state("pending_alert",{orig_props:t,start_time:Date.now()});if(e.run_mode()&&e.get_static_property("at_to_top")){e.ensure_drawn()}}))},initialize(e){const t=e.get_canvas();if(e.edit_mode()){t.empty()}else if(e.run_mode()||e.responsive_mode()){t[0].style.display="none";if(e.responsive_mode()){e._has_been_hidden=true}}o.on_property_change(e,"text",(e=>{t.html(r.bbcode_to_html(e))}));e.on_message("do_show_alert",(n=>{var s;i.apply_css_style(t,{display:"block",opacity:(s=n.fin_starting_opacity)!=null?s:0});e._is_visible_me=true;e._update_visible();t.html(r.bbcode_to_html(n.message));r.velocity(t,{opacity:1},{duration:n.fade_in,complete_cb:()=>{e.setTimeout((()=>{var i;t.css("opacity",(i=n.fout_starting_opacity)!=null?i:1);r.velocity(t,{opacity:0},{duration:n.fade_out,complete_cb:()=>{t[0].style.display="none";e._is_visible_me=false;e._update_visible()}})}),n.hold)}})}));const n=e.state("pending_alert");if(n){e.message("do_show_alert",this._convert_pending_alert(n))}},position_canvas(e,t){if(t.run_mode()&&t.get_static_property("at_to_top")){$("body").append(e);i.apply_css_style(e,{position:"fixed",top:"0px",left:"0px",width:"100%","min-height":t.element.get_height()+"px","z-index":"20000"})}else{t.container.add(t)}},additional_data:{notify_width(e,t){return s.keep_proportions(e,t)}}}},{"../../../../lang/evaluation/element_eval":690,"../../../../u":823,"../../../property_applications":412,"../../shared/image_utils":363}],324:[function(e,t,n){"use strict";const r=e("../../../property_applications");t.exports={property_applications:[new r.MinWidth]}},{"../../../property_applications":412}],325:[function(e,t,n){arguments[4][324][0].apply(n,arguments)},{"../../../property_applications":412,dup:324}],326:[function(e,t,n){"use strict";const r=e("../../../../u");const i=e("../../../property_applications");const s=e("../../../../constants/runmode");const o=e("../../core_elements_utilities/element_utils");const a=e("../../shared/inputs");const l=e("../../../../lang/evaluation/element_eval");t.exports={property_applications:[new i.MinWidth],can_defer_drawing(){return true},initialize(e){e.wait_for_visible_lite((()=>{const t=e.get_canvas();t[0].style.overflow="visible";const n=r.LUID();const i=$('<input type="checkbox" id="'+n+'" style="background-color: white;"></input>');const c=$('<label for="'+n+'"></label>');t.append(i);t.append(c);o.register_tab_index_listener(e,(e=>{i.attr("tabindex",e)}));a.register_focus(e,i);e.on_message("set_focus",(()=>i.focus()));if(e.run_mode()){t.addClass(s.CLICKABLE_ELEMENT);i.change((()=>{var t;e.message("user_submit",(t=i[0].checked)!=null?t:false);return true}));l.on_property_change(e,"disabled",(e=>{i[0].disabled=e}))}l.on_property_change(e,"label",(e=>{c.text(e)}));if(e.run_mode()||e.responsive_mode()){e.autorun((()=>{var t;if((t=e.element.root())!=null&&t.use_responsive_algorithm()){l.evaluate_property(e,"width");e.set_height(Math.max(e.element.get_height(),c.height()))}}))}a.input_change_autorun(e,(e=>{if(typeof e==="string"&&["false","no","null","none","undefined"].includes(e.toLowerCase())){e=false}if(e){i[0].checked=true}else{i[0].checked=false}}))}))}}},{"../../../../constants/runmode":83,"../../../../lang/evaluation/element_eval":690,"../../../../u":823,"../../../property_applications":412,"../../core_elements_utilities/element_utils":286,"../../shared/inputs":364}],327:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../../u");const i=e("../../../../lang/btypes");const s=e("../../../property_applications");const o=e("../../../../lang/appquery");const a=e("../../../../lib");const l=e("../../../../constants/runmode");const c=e("../../../../webfonts");const u=e("../../../../logger");const d=e("../../core_elements_utilities/element_utils");const p=e("../../shared/inputs");const _=e("../../../../u/shared/b_date");const f=e("../../../../lang/evaluation/element_eval");const h=e("../../../../lang/evaluation/element_props");const m=e("../../../custom_tz_utilities");const{PADDING_VERSION:g}=e("../../../../constants/elements");const{has_input_timezone_controls_on:v}=e("../../../../lang/timezone_override_settings");const b=r.require_moment();function y(e,t){if(!t){return}const n=i.get("date").cast(t);if(!n){return}const r=w(e);const s=b(n).tz(r);return[s.year(),s.month(),s.date()]}function w(e){if(v()){return m.get_custom_tz({static_eval:t=>e.get_static_property(t),dynamic_eval:t=>f.evaluate_property(e,t),not_overridden:true})}else{return a().current_timezone()}}function x(e,t){let n="";switch(t){case"number1":n+="d/mm/yyyy";break;case"number2":n+="m/dd/yyyy";break;case"alpha":n+="d mmmm, yyyy";break;case"alphalong":n+="dddd, d mmmm, yyyy";break;case"alphashort":n+="d-mmm-yyyy";break;case"us_short":n+="mmmm d, yyyy";break;case"us_long":n+="dddd, mmmm d, yyyy";break;case"custom":n+=e.get_static_property("custom_format");break}return n}t.exports={property_applications:[new s.MinWidth],initialize(e){e.wait_for_visible_lite((()=>{let t,n,i;const m=e.get_canvas();let v=n=t=i=null;const j=r.MakeKey(null,"dateinput_drawn");e.on_message("add_tab_index",(e=>r.WaitFor(j,(()=>{}))));m.addClass("date_picker_element");m[0].style.overflow="visible";f.on_property_change(e,"input_type",(t=>{m.empty();v=$('<input type="text" class="date_div"></input>');p.reset_input_div(v);m.append(v);d.register_tab_index_listener(e,(e=>{v.attr("tabindex",e)}));if(t==="date_time"){n=$('<input type="text" class="time_div"></input>');p.reset_input_div(n);m.append(n)}}));f.on_property_change(e,"disabled",(e=>{s.apply_css_style(v,{cursor:e?"default":"pointer"});s.apply_css_style(n,{cursor:e?"default":"pointer"})}));f.pre_cache(e,["input_type","width","height","padding_horizontal","date_format","time_format","placeholder","overwrite_placeholder"]);e.autorun((()=>{var t;let r,i,l;const c={};for(const t of["input_type","width","height","padding_horizontal","date_format","time_format","placeholder","overwrite_placeholder","padding_top","padding_bottom","padding_left","padding_right"]){c[t]=f.evaluate_property(e,t)}const u=s.calculate_border_height(e);const d=s.calculate_border_width(e);const p=e.element.element_version(true)<g?2*c.padding_horizontal:c.padding_left+c.padding_right;const h=e.element.element_version(true)<g?0:c.padding_top+c.padding_bottom;const m=o.get_public_setting("bubble_version")<18;const y=m?`calc(100% - ${u}px)`:`calc(100% - ${h+u}px)`;s.apply_css_style(v,{height:y,"box-sizing":"content-box"});if(c.input_type==="date_time"){const e=m?70:72;const t=m?5:8;s.apply_css_style(v,{width:`calc(100% - ${2*p+2*d}px - ${e+t}px)`,float:"left"});s.apply_css_style(n,{width:`${e}px`,float:"right",height:`calc(100% - ${h+u}px)`,"box-sizing":"content-box"})}else{r=c.width-p-d;v[0].style.width=r+"px"}if(c.input_type==="date"&&c.overwrite_placeholder){i=c.placeholder}else{let t;if(o.app().id()==="test_app"){var j;const n=(j=w(e))!=null?j:a().current_timezone();t=b.tz("1/15/2013",n).toDate()}else{t=new Date}const n=x(e,c.date_format);i=_.format_date(t,n,a().get_text("BUILT_IN","DATE_FORMAT"),w(e))}v.attr("placeholder",i);switch(c.time_format){case"full":l="12:00";break;case"ampm":l="12:00 AM";break}return(t=n)==null?void 0:t.attr("placeholder",l)}));if(e.run_mode()){m.addClass(l.CLICKABLE_ELEMENT);function M(){var n;if((n=t)!=null&&n.get()){const n=t.get("select");const o={year:n.year,month:n.month,day:n.date};if(e.get_static_property("input_type")==="date_time"){const e=i.get("select");if(!e){return undefined}else{var r,s;o.hour=(r=e==null?void 0:e.hour)!=null?r:"";o.minute=(s=e==null?void 0:e.mins)!=null?s:""}}return b.tz(o,w(e)).toDate()}else{return null}}function E(){this.$holder.blur();r.run_once(30,M,((t,n)=>{e.state("is_focused",false);if(n!==undefined){e.message("user_submit",n)}}));return true}function k(t){let{$holder:n,$root:r}=t;n.css("transition","0.05s ease-in-out");n.position({my:"left top",at:"left bottom",of:e.get_canvas(),collision:"fit flip"});if(a().bubble_version()<19){r.addClass("datepicker-legacy-font")}}function O(){k(this)}function S(){queueMicrotask((()=>{k(this);e.setTimeout((()=>k(this)),100)}));$(window).on("resize",(()=>k(this)));const n=e.get_canvas();r.run_once(30,(()=>({width:n.width(),"font-family":c.get_face_and_variant(h.get_font_face(e)).font_family})),((e,n)=>{var r;if(e){u.log(e);return}t.$root.css(n);(r=i)==null?void 0:r.$root.css(n)}))}const D=e.get_static_property("show_month_year_picker");v.pickadate({container:"html",firstDay:e.get_static_property("start_monday"),selectMonths:D,selectYears:D&&200,format:x(e,e.get_static_property("date_format")),onOpen:S,onClose:E});t=v.pickadate("picker");e.wait_for_visible((()=>{S.apply(t);e.setTimeout((()=>S.apply(t)),100)}));r.autorun((()=>t.$root.css({"margin-top":f.evaluate_property(e,"height"),"max-width":f.evaluate_property(e,"width")})));let C=false;const T={};if(e.get_static_property("input_type")==="date_time"){C=true;T.container="html";T.interval=e.get_static_property("time_interval");switch(e.get_static_property("time_format")){case"full":T.format="H:i";break;case"ampm":T.format="h:i A";break}T.onClose=E;T.onOpen=S;T.onRender=O;n.pickatime(T);i=n.pickatime("picker");r.autorun((()=>i.$root.css({"margin-top":f.evaluate_property(e,"height"),"max-width":f.evaluate_property(e,"width")})))}function N(e){if(!e){return false}const t=Math.floor(e);const n=Math.round((e-t)*60);return[t,n]}e.autorun((()=>{var n,s;const o=f.evaluate_property(e,"min_date");const l=f.evaluate_property(e,"max_date");t.set({min:(n=y(e,o))!=null?n:-Infinity,max:(s=y(e,l))!=null?s:Infinity});if(C){const t=f.evaluate_property(e,"min_hour");const n=f.evaluate_property(e,"max_hour");i.set({min:N(t),max:N(n)})}let c=a().current_timezone();e.autorun((()=>{const n=w(e);if(e.state("has_been_changed")&&n===c){return}c=n;const s=e.state("value");if(r.autorun_top((()=>e.state("is_focused")))){return}if(s){t.set("select",y(e,s));if(C){const t=w(e);const n=b(s).tz(t);i.set("select",[n.hours(),n.minutes()])}}else{t.clear();if(C){i.clear()}}}))}));e.autorun((()=>{const n=f.evaluate_property(e,"min_date");const r=f.evaluate_property(e,"max_date");const i=e.state("value");if(t.get("select")){if(n!=null&&i<n){t.set("select",y(e,n));e.state("value",n)}else if(r!=null&&i>r){const s=r>=n?r:n!=null?n:i;t.set("select",y(e,s));e.state("value",s)}}}));f.on_property_change(e,"disabled",(e=>{v[0].disabled=e;if(n!=null){n[0].disabled=e}}))}p.register_focus(e,m.find("input"));e.on_message("set_focus",(()=>{if(!v[0].disabled){t.open()}}));if(!e.run_mode()){var A;v.attr("readonly","true");(A=n)==null?void 0:A.attr("readonly","true")}}))}}},{"../../../../constants/elements":61,"../../../../constants/runmode":83,"../../../../lang/appquery":651,"../../../../lang/btypes":653,"../../../../lang/evaluation/element_eval":690,"../../../../lang/evaluation/element_props":691,"../../../../lang/timezone_override_settings":729,"../../../../lib":741,"../../../../logger":744,"../../../../u":823,"../../../../u/shared/b_date":836,"../../../../webfonts":858,"../../../custom_tz_utilities":380,"../../../property_applications":412,"../../core_elements_utilities/element_utils":286,"../../shared/inputs":364,"core-js/modules/web.dom-collections.iterator.js":1123}],328:[function(e,t,n){arguments[4][324][0].apply(n,arguments)},{"../../../property_applications":412,dup:324}],329:[function(e,t,n){arguments[4][324][0].apply(n,arguments)},{"../../../property_applications":412,dup:324}],330:[function(e,t,n){"use strict";const r=e("../../../../u");const i=e("../../../../lib");const s=e("../../../property_applications");const o=e("../../../../constants/runmode");const a=e("./shared/containers");const l=e("../../../../lang/evaluation/element_edit_eval");const c=o.POPUP_ZINDEX;const u=500;t.exports={property_applications:[new s.MinWidth],position_canvas(e,t){const{element:n}=t;const o=t.element.parent();function d(){if(n.get_static_property("float_zindex")==="back"){return 0}else{let e;const n=$(".greyout");if(n.length===0){e=c-u}else{e=n.css("z-index")-u}if(!e||e<=0){e=2}const r=e+t.element.get_zindex();return r}}if(!(t.run_mode()||t.responsive_mode())||o.type()!=="Page"){t.container.add(t,true);t.container.container_canvas.append(t.get_canvas());t.wait_for_visible_lite((()=>{s.apply_css_style(t.get_canvas(),{position:"absolute",width:t.element.get_width()+"px",top:t.element.get_top()+"px",left:t.element.get_left()+"px",height:t.element.get_height()+"px"});r.WaitFor(t.get_children_drawn_key(),(()=>a.resize_container_width(t)))}));return}if(t.responsive_mode()){t.container.wrap(t);t.container.add_to_instances(t);e=t.container.to_canvas(t)}t.wait_for_visible_lite((()=>{if(n.root().use_responsive_algorithm()&&!n.root().get_static_property("fixed_width")){const i=()=>{let i,s;const c=n.get_width();const u=n.get_min_width();const d=n.get_max_width();const p=n.get_left();const{container_width:_}=t.container;const f=l.get_container_width(o);const h=f-(p+c);const m=p+h;const g=c-u;let v=f-_;if(g===0){i=1}else if(g>=v){i=(g-v)/g;v=0}else{i=0;v-=g}if(m===0||v===0){s=1}else if(m>=v){s=(m-v)/m}else{s=0}switch(n.get_static_property("floating_reference_horizontal_resp")){case"left":e.css("left",p*s);break;case"right":e.css("right",h*s);break}let b=u+g*i;if(d){b=Math.min(b,d)}e.css("width",b);r.WaitFor(t.get_children_drawn_key(),(()=>a.resize_container_width(t,b)))};t.container.on("resize_width",i);r.WaitFor(t.container.flow_created,(()=>{let s,a,l;let c=n.get_height();const u=n.get_static_property("floating_reference");let p;if(["bottom","top","both"].includes(u)){a=t.responsive_mode()?"absolute":"fixed";if(u==="top"){l=n.get_top();s=undefined}else if(u==="bottom"){l=undefined;s=o.get_height()-n.get_top()-n.get_height();if(r.is_debug_mode()){s+=50}}else if(u==="both"){l=n.get_top();s=o.get_height()-n.get_top()-n.get_height();if(r.is_debug_mode()){s+=50}c=undefined;p="auto"}}else{a="absolute";l=n.get_top();s=undefined}if(t.responsive_mode()){t.container.container_canvas.append(e)}else{$("body").append(e)}e.addClass("floating-group");e.css({position:a,"z-index":d(),height:c,top:l,bottom:s,"overflow-y":p});return i()}))}else{let s,l,c,u,p,_;const f=p=n.get_top();const h=l=n.get_left();const m=n.get_height();const g=n.get_width();switch(n.get_static_property("floating_reference_horizontal")){case"left":l=h;u=undefined;break;case"right":u=o.get_width()-h-g;l=undefined;break;default:l="50%";c=-o.get_width()/2+h}if(["bottom","top"].includes(n.get_static_property("floating_reference"))){_="fixed";switch(n.get_static_property("floating_reference")){case"top":p=n.get_top();s=undefined;break;case"bottom":s=o.get_height()-f-m;if(r.is_debug_mode()){const e=i().workflow.debugger.canvas;s+=e.children(".element-area").height()}p=undefined;break}}else{_="absolute"}$("body").append(e);e.addClass("floating-group");e.css({position:_,"z-index":d(),width:g,height:m,top:p,bottom:s,left:l,right:u,"margin-left":c});if(n.root().use_responsive_algorithm()){r.WaitFor(t.get_children_drawn_key(),(()=>a.resize_container_width(t,g)))}}const c=t.get_static_property("parallax");if(t.run_mode()&&![null,undefined,1].includes(c)){$(window).on("scroll",(()=>window.requestAnimationFrame((()=>s.apply_css_style(e,{transform:"translate3d(0,"+(1-c)*$(window).scrollTop()+"px, 0)"})))))}}))},register(e){if(e.get_static_property("floating_reference")!=="both"){e.on_message("child_movement",(t=>{e.state("child_movement_delta",t)}))}},initialize(e){if(e.get_static_property("floating_reference")!=="both"){e.autorun((()=>{const t=e.state("child_movement_delta");if(t!=null){const n=e.element.get_height()+t;e.get_canvas().height(n)}}))}},additional_data:{notify_width(e,t){r.WaitFor(e.get_children_drawn_key(),(()=>a.resize_container_width(e,t)))}}}},{"../../../../constants/runmode":83,"../../../../lang/evaluation/element_edit_eval":689,"../../../../lib":741,"../../../../u":823,"../../../property_applications":412,"./shared/containers":351}],331:[function(e,t,n){"use strict";const r=e("../../../../u");const i=e("../../../property_applications");const s=e("../../../../geolocation/client/google_maps");const o=e("../../core_elements_utilities/element_utils");const a=e("../../shared/image_utils");const l=e("../../../../lang/evaluation/element_eval");t.exports={property_applications:[new i.MinWidth],additional_data:{notify_width(e,t){a.keep_proportions(e,t)}},initialize(e){e.wait_for_visible_lite((()=>{var t;(t=e.currently_displayed_markers)!=null?t:e.currently_displayed_markers={};const n=s.load_google_map_api();const i=e.get_canvas();if(e.thumbnail_mode()){i.css({"background-color":"#E6E6E6"});return}let a=null;r.WaitFor(n,(()=>{const t=()=>{a=this._get_map(e,{height:"100%",width:"100%",position:null,top:null,left:null,right:null,bottom:null});if(e.edit_mode()){o.do_add_an_invisible_div_on_the_top(e)}l.pre_cache(e,["height","width","four_border_style","border_width","border_style","padding_vertical","padding_horizontal"]);e.autorun((()=>{this._refresh_border(e,a)}));l.on_property_change(e,["allow_zoom_drag","map_style","custom_style","disable_zoom_scroll"],(e=>{this._handle_map_option_change(a,e)}));l.on_property_change(e,"map_type",(e=>{a.setMapTypeId(window.google.maps.MapTypeId[e])}));e.autorun((()=>{this._render_markers(e,a)}));e.autorun((()=>{this._set_center_and_zoom(e,a)}))};e.wait_for_visible((()=>{e.setTimeout(t,1)}))}))}))}}},{"../../../../geolocation/client/google_maps":623,"../../../../lang/evaluation/element_eval":690,"../../../../u":823,"../../../property_applications":412,"../../core_elements_utilities/element_utils":286,"../../shared/image_utils":363}],332:[function(e,t,n){"use strict";const r=e("../../../../u");const i=e("../../../property_applications");const s=e("./shared/groups");t.exports=r.extend({property_applications:[new i.MinWidth],attempt_size_only_draw(e){if(e.get_static_property("collapse_when_hidden")){e.set_height(0);e.canvas[0].style.display="none";e.canvas.css("overflow","visible");return false}return true},register(e){e.on_message("child_movement",(t=>{const n=e.element.get_height()+t;if(e.is_visible()||!e._has_been_hidden){e.set_height(n);e.state("actual_height",n)}else{e.state("actual_height",n)}}))},initialize(e){}},s.group_collapse_definition)},{"../../../../u":823,"../../../property_applications":412,"./shared/groups":352}],333:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../../u");const i=e("../../../../lang/elements");const s=e("../../../property_applications");const o=e("../../../../lib");const a=e("../../../../logger");const l=e("../../../../lang/appquery");const c=e("./shared/containers");const u=e("../../../../lang/evaluation/element_eval");const d=e("../../../../u/shared/mode_check");t.exports={initialize(e){const t=e.get_canvas();let n=false;if(e.run_mode()){let i;if(r.is_on_mobile_or_tablet()){i="touchend.groupfocus, inputmaskclick"}else{i="click.groupfocus, inputmaskclick"}$("body").on(i,(i=>{var s;const a=$(".tt-dropdown-menu");const l=e.is_visible()&&!t.data("GroupWithFocus_loading")&&t[0]!==i.target&&!$.contains(t[0],i.target)&&!((s=$(i.target).attr("class"))!=null&&s.match(/\bselect2-/))&&!(a.length>0&&$.contains(a[0],i.target));if(l){if(d.running_test()){e.do_hide()}else{n=true;e.setTimeout((()=>{r.WaitFor(o().workflow.everything_done_key(),(()=>{n=false;e.do_hide()}))}),10)}}}));e.on_message("child_movement",(t=>{const n=e.element.get_height()+t;e.get_canvas()[0].style.height=n+"px"}))}e.autorun((()=>{const t=e.state("manual_position");if(t){s.apply_css_style(e.get_canvas(),t)}}));if(e.edit_mode()){u.pre_cache(e,["reference","offset_left","offset_top"]);e.autorun((()=>{const t={};for(const n of["reference","offset_left","offset_top"]){t[n]=e.get_static_property(n)}const r=o.or_throw().visual_edit.current_editor_canvas.getWrapper(t.reference);if(!t.reference||!r||!r.is(":visible")){if(!n){e.get_canvas().parent(".element").css({top:0,left:0})}return}const{top:i,left:s}=o().visual_edit.edit_canvas.elements[t.reference].offset();const a=$(".container.page-element").parent(".non-draggable").offset();const c=l.element(t.reference);e.get_canvas().parent(".element").css({top:i+c.get_height()+t.offset_top-a.top,left:s+t.offset_left-a.left})}))}},position_canvas(e,t){let n;if(t.responsive_mode()){n={position:"absolute"};const i=r.div("r-wrapper groupfocus");i.append(e);o().visual_edit.responsive_canvas.get_current_preview_canvas().find("> .r-wrapper").append(i);t.container.add_to_instances(t);o().visual_edit.responsive_canvas.register_wrapper(t.element_id(),i,true);e.hide()}else if(t.edit_mode()){$(".container.page-element").parent(".non-draggable").append(e);n={position:"absolute"}}else{$(window.document.body).append(e);n={position:"fixed"}}r.extend(n,{width:t.element.get_width()+"px",height:t.element.get_height()+"px","z-index":o().bv().MAX_POPUP_ZINDEX+t.element.get_zindex()});s.apply_css_style(e,n);if(t.run_mode()||t.responsive_mode()){const e=e=>{r.WaitFor(t.get_children_drawn_key(),(()=>t.wait_for_visible_lite((()=>{t.get_canvas().css({width:e});c.resize_container_width(t,e)}))))};e(r.real_inner_width(t.get_canvas()));t.on_resize((n=>r.run_once(30,(()=>t.find_instance_by_id(t.get_static_property("reference"))),((r,i)=>{if(r){a.log(r);return}if(!i){return}const s=i.get_canvas().offset().left+t.get_static_property("offset_left");const o=Math.max(t.element.get_min_width(),Math.min(t.element.get_width(),n-20-s));e(o)}))))}},do_show(e,t,n,l){e._is_visible_me=true;e.ensure_drawn();e._update_visible();const c=e.get_canvas();if(!e.run_mode()){c[0].style.display="";if(e.responsive_mode()){const t=r.div("groupfocus-greyout",o().visual_edit.responsive_canvas.get_current_preview_canvas().find("> .r-wrapper"));s.apply_css_style(t,{"background-color":"rgba(0, 0, 0, 0.701961)",top:"0px",left:"0px",position:"absolute",width:"100%",height:t.parents(".res-preview").find(".main-page").height()+"px","z-index":2001+e.element.get_zindex()})}return}r.run_once(30,(()=>e.find_instance_by_id(e.get_static_property("reference"))),((s,o)=>{var u;if(s){a.log(s);return}if(!o){return}(u=c.velocity)==null?void 0:u.call(c,"stop");if(l){i.perform_animate_in(e,t,n)}else{c[0].style.display="";e._is_visible_me=true;e._update_visible()}function d(){let t,n;if(e.state("manual_position")){return}const r=o.get_canvas();if(r){n=r.offset().left;t=r.offset().top+r.height()}else{n=0;t=0}const i=n+e.get_static_property("offset_left");const s=t+e.get_static_property("offset_top")-$(window).scrollTop();c.css({top:s,left:i})}d();if(!r.is_on_mobile_or_tablet()){let t=null;$(window).off("resize.groupfocus"+e.toUniqueString());$(window).on("resize.groupfocus"+e.toUniqueString(),(()=>{const n=$(window).width();if(t!==n){t=n;if(e.is_visible()&&!e.get_canvas().data("GroupWithFocus_loading")){e.do_hide()}}}))}const p="scroll.groupfocus"+e.toUniqueString();$(window).off(p);$(window).on(p,d)}))},do_hide(e,t,n,i){var s;e._is_visible_me=false;e._update_visible();const a=e.get_canvas();(s=a.velocity)==null?void 0:s.call(a,"stop");if(i){var l,c,u,d,p;(l=e._transforms)!=null?l:e._transforms={};(u=(c=e._transforms).initial_opacity)!=null?u:c.initial_opacity=a[0].style.opacity;(p=(d=e._transforms).initial_transform)!=null?p:d.initial_transform=a[0].style.transform;e.set_animating(true);r.velocity(a,t.animation,{duration:n.duration,complete_cb(){e.set_animating(false);a[0].style.transform=e._transforms.initial_transform;a[0].style.opacity=e._transforms.initial_opacity;e._transforms=undefined}})}else{a[0].style.display="none"}$(window).off("resize.groupfocus"+e.toUniqueString());$(window).off("scroll.groupfocus"+e.toUniqueString());if(e.responsive_mode()){o().visual_edit.responsive_canvas.get_current_preview_canvas().find("> .r-wrapper").find(".groupfocus-greyout").remove()}}}},{"../../../../lang/appquery":651,"../../../../lang/elements":680,"../../../../lang/evaluation/element_eval":690,"../../../../lib":741,"../../../../logger":744,"../../../../u":823,"../../../../u/shared/mode_check":851,"../../../property_applications":412,"./shared/containers":351,"core-js/modules/web.dom-collections.iterator.js":1123}],334:[function(e,t,n){"use strict";const r=e("../../../../u");const i=e("../../../property_applications");const s=e("./shared/groups");t.exports=r.extend({property_applications:[new i.MinWidth],initialize(e){const t=e.get_canvas();e.do_hide();if(e.run_mode()){let n;if(r.is_on_mobile_or_tablet()){n="touchend.groupfocus"}else{n="click.groupfocus"}$("body").on(n,(n=>{var r;const i=e.is_visible()&&!t.data("GroupWithFocus_loading")&&t[0]!==n.target&&!$.contains(t[0],n.target)&&!((r=$(n.target).attr("class"))!=null&&r.match(/\bselect2-/));if(i){e.do_hide()}}));e.on_message("child_movement",(t=>{const n=e.element.get_height()+t;e.get_canvas()[0].style.height=n+"px"}))}}},s.group_collapse_definition)},{"../../../../u":823,"../../../property_applications":412,"./shared/groups":352}],335:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("../../../../lang/elements");const i=e("../../../../u");const s=e("../../../property_applications");const o=e("../../../../logger");const a=e("base64url");const l=e("../../../../lib");const c=e("../../core_elements_utilities/element_utils");const u=e("../../shared/image_utils");const d=e("../../shared/video_elements");const p=e("./shared/text_elements");const _=e("../../../../lang/evaluation/element_eval");const{ignoreError:f}=e("../../../../u/shared/callbacks");function UNMANGLED_html_wrap(e){return e()}t.exports={property_applications:[new s.MinWidth],additional_data:{notify_width(e,t){return u.keep_proportions(e,t)}},can_defer_drawing(e){return e.get_static_property("defer_drawing")},register(e){if(e.run_mode()&&window.bubble_safe_mode){return o.owner_warn(new i.OwnerError("This HTML element is not rendered in safe mode",{element_instance:e}))}},initialize(e){function t(){if(e.run_mode()&&window.bubble_safe_mode){return}const t=e.get_canvas();let n=null;let s=null;const u=()=>s[0].contentWindow;let h=false;let m=false;_.pre_cache(e,["html","useiframe","width","height"]);e.autorun((()=>{var g;let v;const b={};for(const A of["html","useiframe","width","height"]){b[A]=_.evaluate_property(e,A)}let{html:y,useiframe:w,width:x,height:j}=b;(g=y)!=null?g:y="";if(!e.run_mode()){v=a.encode(y);l().location.post("server://appeditor/cache_iframe_content",{content:v},f((n=>{const r=n;const i=`${l().location.get_base_for_meta()}/appeditor/basic_iframe_service/${l().appname()}/test/${r}`;s=$(`<iframe src="${i}"\n    id='user_preview_iframe'\n    width="${x}"\n    height="${j}"\n    sandbox="allow-scripts"\n>\n    (this browser does not support HTML element preview rendering)\n</iframe>`);t.empty();t.append(s);c.do_add_an_invisible_div_on_the_top(e)})))}else{if(w){const M=r=>{e.clearTimeout(n);if(!s){s=$('<iframe src="about:blank"></iframe>');if(d.should_block_cookies()){s.attr("sandbox","allow-scripts allow-same-origin")}t.append(s)}s[0].style.width=x+"px";s[0].style.height=j+"px";if(u()){if(m!==r){s[0].contentWindow.contents=r;m=r}s[0].src='javascript:window["contents"]'}else{n=e.setTimeout((()=>M(r)),100)}};M(y)}else{try{if(e.get_static_property("stretch_to_fit")){v=t.find(".content");if(v.length===0){v=i.div("content",t)}if(m!==y){UNMANGLED_html_wrap((()=>v.html(y)));m=y}function E(n){if(e.is_animating(true)){n==null?void 0:n();return}const r=e.is_visible(true);if(!r&&!h){n==null?void 0:n();return}h=r;const i=t.outerHeight()-t.height();let s=parseInt(v.css("height").replace("px",""));if(s===0&&v.find(" > *").length){s=parseInt(v.find(" > *").css("height").replace("px",""))}const o=e.element.get_height();e.set_height(Math.max(o,s+i));n==null?void 0:n()}if(!e.is_animating()){const k=r.add_layout_resizing_key();i.wait_for_updates((()=>p.wait_for_img_tags_loaded(v,(()=>E((()=>k.turn()))))));if(e.is_visible()){e.setTimeout(E,500);e.setTimeout(E,2e3)}}}else{UNMANGLED_html_wrap((()=>t.html(y)))}}catch(O){const S=O;o.owner_only_error("html bug",{display:"Bug in custom html:\n"+S.stack,element_instance:e,prop_name:"html"})}}}}))}if(e.get_static_property("defer_drawing")){e.wait_for_visible_lite(t)}else{t()}}}},{"../../../../lang/elements":680,"../../../../lang/evaluation/element_eval":690,"../../../../lib":741,"../../../../logger":744,"../../../../u":823,"../../../../u/shared/callbacks":843,"../../../property_applications":412,"../../core_elements_utilities/element_utils":286,"../../shared/image_utils":363,"../../shared/video_elements":374,"./shared/text_elements":354,base64url:957,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],336:[function(e,t,n){"use strict";const r=e("../../../property_applications");const i=e("../../../../constants/runmode");const s=e("./shared/icons");const o=e("../../../../lang/evaluation/element_eval");t.exports={property_applications:[new r.MinWidth],initialize(e){e.wait_for_visible_lite((()=>{const t=e.get_canvas();r.patch_user_agent_styles(t);o.on_property_change(e,"icon",(e=>{let n;if(t.hasClass(i.CLICKABLE_ELEMENT)){n=true}t.attr("class","");t.addClass(e+" inner-element bubble-element");if(n){t.addClass(i.CLICKABLE_ELEMENT)}}));o.on_property_change(e,"icon_color",(e=>{t[0].style.color=e}));o.on_property_change(e,"spin_icon",(e=>{if(!e){e=false}t.toggleClass("fa-spin",e)}));s.calculate_font_size_for_fontawesome(e)}))},additional_data:{notify_width(e,t){e.state("notify_width",t)}}}},{"../../../../constants/runmode":83,"../../../../lang/evaluation/element_eval":690,"../../../property_applications":412,"./shared/icons":353}],337:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../property_applications");const i=e("../../../../shared/apps_utilities");const s=e("../../../../shared/images");const o=e("../../../../lang/appquery");const a=e("../../../../u");const l=e("../../shared/image_utils");const c=e("../../../../lang/evaluation/element_eval");function u(e){const t=e.property("src");if(!t.is_empty()&&t.is_static()&&e.get_static_property("src",true)!==""){return true}}t.exports={property_applications:[new r.MinWidth],can_defer_drawing(){return true},register(e){e.state("src_version",0)},initialize(e){const t=e.get_canvas();t.addClass("bubble-legacy-image");e.wait_for_visible_lite((()=>{let n;const d=a.img(undefined,t);d[0].style.display="block";if(!e.run_mode()){n=a.div("display_text",t);d[0].style.float="left"}let p=null;let _=null;if(e.run_mode()){c.on_property_change(e,"alt_tag",(e=>d[0].alt=e!=null?e:""))}c.pre_cache(e,["src","stretch_or_rescale","width","height","crop_data"]);e.autorun((()=>{let t;const f={};for(const v of["src","stretch_or_rescale","width","height","crop_data"]){f[v]=c.evaluate_property(e,v)}const h=u(e.element);if(!e.run_mode()){if(!h){var m;n.html((m=f.src)!=null?m:"");r.apply_css_style(n,{display:"block",overflow:"hidden",width:"100%",color:"grey"});d[0].style.display="none";return}else{n[0].style.display="none";d[0].style.display="block"}}p=t=a.LUID();if(f.src&&!a.is_empty(f.src)){if(!d[0].src){d[0].src=l.transparent_image();l.reset_img_settings(d)}function b(n,r,s,a){function c(r){if(p!==t){return}l.download_image(r,e,(e=>{if(p!==t){return}_=n;d[0].src=e}))}const u=l.optimize_image(n,r,s,a);let f=n===_&&!l.downloaded_images[u];if(f&&i.is_test(o.appname())){f=false}if(f){e.setTimeout(c.bind(null,u),300)}else{c(u)}}if(h){var g;let y;if((g=e.element.root())!=null&&g.use_responsive_algorithm()&&!e.get_static_property("keep_proportion_resize")){y={fit:"crop"}}else{y={}}l.reset_img_settings(d);b(f.src,f.width,f.height,y);if(f.crop_data){const w=e=>`${Math.floor(e*100)}%`;r.apply_css_style(d,{width:w(f.crop_data.width_factor),height:w(f.crop_data.height_factor),"margin-left":w(f.crop_data.left_offset),"margin-top":f.crop_data.top_offset*f.height+"px"})}}else{let x=a.autorun_top((()=>e.state("src_version")));x+=1;e.state("src_version",x);if(f.stretch_or_rescale==="rescale"){l.rescale_image({src:f.src,img:d,instance:e,ref_version:x,cb(){b(f.src,c.evaluate_property(e,"width"),c.evaluate_property(e,"height"))}})}else if(f.stretch_or_rescale==="adjust_height"){s.get_image_real_dimensions(f.src,(t=>{if(t.height==null){b(f.src,f.width,f.height);return}const n=a.autorun_top((()=>e.state("src_version")));if(x!==n){return}l.reset_img_settings(d);const r=t.height/t.width*f.width;b(f.src,f.width,r);e.set_height(r)}))}else if(f.stretch_or_rescale==="stretch"){l.reset_img_settings(d);b(f.src,f.width,f.height)}else if(f.stretch_or_rescale==="zoom"){l.reset_img_settings(d);r.apply_css_style(d,{"object-fit":"cover"});b(f.src,f.width,f.height)}}}else{d[0].src=l.transparent_image();_=null;l.reset_img_settings(d)}}));e.autorun((()=>{if(c.evaluate_property(e,"four_border_style")){for(const t of["top","right","bottom","left"]){d[0].style["border-radius-"+t]=c.evaluate_property(e,"border_roundness_"+t)+"px"}}else{d[0].style["border-radius"]=c.evaluate_property(e,"border_roundness")+"px"}}))}))},additional_data:{notify_width(e,t){l.keep_proportions(e,t)}}}},{"../../../../lang/appquery":651,"../../../../lang/evaluation/element_eval":690,"../../../../shared/apps_utilities":788,"../../../../shared/images":796,"../../../../u":823,"../../../property_applications":412,"../../shared/image_utils":363,"core-js/modules/web.dom-collections.iterator.js":1123}],338:[function(e,t,n){arguments[4][324][0].apply(n,arguments)},{"../../../property_applications":412,dup:324}],339:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("../../../../u");const i=e("../../../property_applications");const s=e("../../../../constants/runmode");const o=e("../../../../lang/application");const a=e("../../../../lang/appquery");const l=e("../../../url_data");const c=e("../../../../constants/lang");const u=e("../../../../lang/evaluation/evaluate");const d=e("../../../../lang/evaluation/eval_node_state");const p=e("../../../../lib");const _=e("querystring");const f=e("../../core_elements_utilities/element_utils");const h=e("./shared/text_elements");const m=e("../../shared/links");const g=e("../../../../lang/evaluation/element_eval");t.exports={property_applications:[new i.MinWidth],additional_data:{notify_width(e,t){e.state("notify_width",t)}},initialize(e){const t=e.get_canvas();e.wait_for_visible_lite((()=>{t.addClass(s.CLICKABLE_ELEMENT);i.apply_css_style(t,{"white-space":"pre-wrap","text-decoration":"none"});let n=false;g.pre_cache(e,["text","font_size","icon","show_icon","background_style","no_html"]);e.autorun((()=>{const s={};for(const p of["text","font_size","icon","show_icon","background_style","no_html"]){s[p]=g.evaluate_property(e,p)}const{text:o,icon:a,show_icon:l,background_style:c,no_html:u}=s;e.state("notify_width");if(c==="image"){t.text("")}else{if(l){var d;n=false;(d=t.trigger)==null?void 0:d.call(t,"destroy");t.empty();const _=r.div(a+" inner-element");i.apply_css_style(_,{"font-family":"FontAwesome","padding-left":"3px"});t.append(_)}else{function m(e){if(u){e.html(r.bbcode_to_html(o).trim())}else{e.html(o)}}if(e.get_static_property("wrap_when_squizzed")&&(e.run_mode()||e.responsive_mode())){i.apply_css_style(t,{"word-break":"break-word"});e.wait_for_visible_lite((()=>e.setTimeout((()=>{let n=t.find(".content");if(n.length===0){n=r.div("content",t)}m(n);const i=t.outerHeight()-t.height();const s=parseInt(n.css("height").replace("px",""));const o=e.element.get_height();e.set_height(Math.max(o,s+i))}),1)))}else{m(t);if((e.run_mode()||e.thumbnail_mode())&&!n){n=true;h.apply_dotdotdot(e,e.edit_mode()||e.responsive_mode()?"letter":"words")}}if(!e.run_mode()){f.do_add_an_invisible_div_on_the_top(e)}}}if(c==="none"){(new i.NoSelect)._apply(true,t)}}));if(e.run_mode()){g.on_property_change(e,"open_in_new_tab",(e=>{if(e){t[0].target="_blank"}else{t[0].target="_self"}}));g.on_property_change(e,"link_disabled",(t=>{e.state("link_disabled",t);if(t){e.get_canvas()[0].style.cursor="not-allowed";e.get_canvas()[0].style["pointer-events"]="none"}else{e.get_canvas()[0].style.cursor="pointer";e.get_canvas()[0].style["pointer-events"]="auto"}}));g.on_property_change(e,"nofollow",(e=>{if(e){t[0].rel="nofollow"}}));e.autorun((()=>{const n=g.evaluate_property(e,"linktype");function i(e){var t,n;let r=o.page_id_to_name(e);(t=r)!=null?t:r=(n=a.get_page_by_name(e))==null?void 0:n.name();return r}let s;if(n==="pagelink"){var f;const t=g.evaluate_property(e,"page");let n=(f=i(t))!=null?f:"";let o=g.evaluate_property(e,"data_to_send");if(o){const e=a.get_page_by_name(n);if(e!=null){o=l.get_data_to_send(o,e.get_static_property("readable_field"));if(o){n+="/"+o}}}const h={};if(e.get_static_property("keep_current_page_params")){r.extend(h,p().location.get_query())}if(r.is_debug_mode()){h.debug_mode=true}if(g.evaluate_property(e,"add_parameters")){const t=e.element.property("url_parameters");d.with_eval_node(t,(()=>{const n=u.evaluate_properties(t.json._raw(),e.prop_eval_context(),c.DETECT_FIELD_NAMES,[],t.json._path());for(const{key:e,value:t}of Object.values(n!=null?n:{})){if(!m.forbidden_url_keys.includes(e)){h[e]=t}}}))}if(n==="index"){n=""}s=p().location.get_server_base()+n;if(!r.is_empty(h)){s+="?"+_.stringify(h)}}else{var h;s=g.evaluate_property(e,"url");if(((h=s)==null?void 0:h.indexOf("//"))===-1&&!m.href_attributes.includes(s.split(":")[0])&&s[0]!=="#"){s="//"+s}}t[0].href=s;if(r.on_phonegap()){t.on("touchend",(()=>window.open(s,"_blank","location=yes,enableViewportScale=yes")));t.on("click",(e=>{e.preventDefault();return false}))}}))}}))}}},{"../../../../constants/lang":73,"../../../../constants/runmode":83,"../../../../lang/application":650,"../../../../lang/appquery":651,"../../../../lang/evaluation/element_eval":690,"../../../../lang/evaluation/eval_node_state":694,"../../../../lang/evaluation/evaluate":695,"../../../../lib":741,"../../../../u":823,"../../../property_applications":412,"../../../url_data":416,"../../core_elements_utilities/element_utils":286,"../../shared/links":365,"./shared/text_elements":354,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,querystring:2279}],340:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=e("../../../property_applications");const i=e("../../core_elements_utilities/element_utils");const s=e("../../../../lib");const o=e("../../../../u");const a=e("../../shared/inputs");const l=e("../../../../lang/evaluation/element_eval");t.exports={property_applications:[new r.MinWidth],initialize(e){e.wait_for_visible_lite((()=>{const t=e.get_canvas();a.reset_input_div(t);t.attr("data-gramm_editor","false");i.register_tab_index_listener(e,(e=>{t.attr("tabindex",e)}));e.autorun((()=>{t.attr("placeholder",l.evaluate_property(e,"placeholder"));window.optional_modules.autosize.update(t)}));if(!e.run_mode()){t.attr("readonly","true");t[0].style.resize="none"}a.set_character_limit_on_input(e);e.autorun((()=>{const t=true;a.assign_enter_handler_in_input(e,t)}));const n=o.Box(0);a.input_change_autorun(e,(r=>{if(e.state("is_focused")){return}t.val(r!=null?r:"");if(e.run_mode()&&e.get_static_property("stretch_to_fit")&&e.is_visible()){if(!t[0].disabled){window.optional_modules.autosize.update(t)}else{n(n.dangerously_peek()+1);e.setTimeout((()=>{window.optional_modules.autosize.update(t);n(n.dangerously_peek()-1)}),5)}}}));if(e.run_mode()){e.on_message("set_focus",(()=>t.focus()));a.assign_change_keyup_handlers(e,(()=>e.get_canvas().val()));e.autorun((()=>{if(n()>0){t[0].disabled=false}else{t[0].disabled=l.evaluate_property(e,"disabled")}}));if(e.get_static_property("stretch_to_fit")){t[0].style["min-height"]=e.element.get_height()+"px";if(s().bubble_version()>=8){t.attr("rows",1)}window.optional_modules.autosize(t);t.on("autosize:resized",(()=>{const n=parseInt(t.css("height").replace("px",""));e.set_height(n)}));e.wait_for_visible((()=>window.optional_modules.autosize.update(t)));e.on_destroy((()=>window.optional_modules.autosize.destroy(t)))}}}))}}},{"../../../../lang/evaluation/element_eval":690,"../../../../lib":741,"../../../../u":823,"../../../property_applications":412,"../../core_elements_utilities/element_utils":286,"../../shared/inputs":364,"core-js/modules/es.string.replace.js":1121}],341:[function(e,t,n){(function(n){(function(){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.immediate.js");const r=e("../../../../u");const i=e("../../../property_applications");const s=e("../../shared/image_utils");const o=e("../../../../lang/evaluation/page_state");const a=e("../../../../constants/lang");const l=e("../../../../lang/evaluation/evaluate");const c=e("../../../../lang/evaluation/eval_node_state");const u=e("../../shared/pages");const d=e("../../../../lang/color_tokens");const p=e("../../../../lang/font_tokens");const _=e("../../../../lang/evaluation/element_eval");function f(e){const t=u.get_stripes(e.element);if(!t.length){return[]}const n=[];for(const r of t){c.with_eval_node(r,(()=>n.push(l.evaluate_properties(r.json._raw(),e.prop_eval_context(),a.DETECT_FIELD_NAMES,[],r.json._path()))))}return n}t.exports={property_applications(e){if(!e||!(e!=null&&e.use_responsive_algorithm())){return[new i.Background]}else{return[]}},position_canvas(e,t){if(t.responsive_mode()){t.container.add(t);return}const n=this.calculate_run_mode_width(t);i.apply_css_style(e,{width:n+"px",height:t.element.get_height()+"px"});if(t.edit_mode()){$(".canvas").append(e)}else{$("html, body").css("height","100%");$(window.document.body).append(e);e[0].style["min-height"]="100%"}i.apply_css_style(e,{"margin-right":"auto","margin-left":"auto",position:"relative","z-index":2})},register(e){e.on_message("child_movement",(t=>{e.state("last_delta",t)}))},initialize(e){if(e.run_mode()){e.register_workflows(e.element.events())}_.on_property_change(e,"title",(t=>{if(e.edit_mode()){$(".edit-date").text(t)}else if(e.run_mode()){$(document).ready((()=>window.document.title=t))}}));const t=document.documentElement;if(e.edit_mode()){e.autorun((()=>{p.load_font_tokens_default();p.load_font_tokens_user()}));_.on_property_change(e,"preset_width",(t=>{if(u.preset_page_widths[t].width!=null){e.element.set_property("width",u.preset_page_widths[t].width);e.element.commit_merge()}}));_.on_property_change(e,"width",(t=>{const n=e.get_static_property("preset_width");for(const r in u.preset_page_widths){const i=u.preset_page_widths[r];if(t===i.width){if(r!==n){e.element.set_property("preset_width",r);e.element.commit_merge()}return}}if(n!=="custom"){e.element.set_property("preset_width","custom");e.element.commit_merge()}}))}e.autorun((()=>{for(const[e,n]of Object.entries(p.default_font_tokens_to_property())){t.style.setProperty(e,n)}}));e.autorun((()=>{for(const[e,n]of Object.entries(p.user_font_tokens_to_property())){t.style.setProperty(e,n)}}));e.autorun((()=>{for(const[e,n]of Object.entries(d.default_color_tokens_to_property())){t.style.setProperty(e,n)}}));e.autorun((()=>{for(const[e,n]of Object.entries(d.user_color_tokens_to_property())){t.style.setProperty(e,n)}}));if(e.run_mode()){o.page_width($(window).width());$(window).on("resize",(()=>o.page_width($(window).width())));o.page_current_scroll_position($(window).scrollTop());$(window).on("scroll wheel touchmove",(()=>o.page_current_scroll_position($(window).scrollTop())))}const n=["background_style","bgcolor","background_gradient_direction","background_gradient_from","background_gradient_mid","background_gradient_to","background_image","center_background","background_size_cover","repeat_background_vertical","repeat_background_horizontal","background_color_if_empty_image","background_gradient_style","background_radial_gradient_shape","background_radial_gradient_size","background_radial_gradient_xpos","background_radial_gradient_ypos","background_gradient_custom_angle"];function a(){let t,o,a;if(e.element.use_responsive_algorithm()){o=e.get_canvas()}else{o=r.div("stripe-container Backdrop",e.container.get_canvas());if(e.run_mode()){$(window).off("resize.backdrop-non-responsive");$(window).on("resize.backdrop-non-responsive",(()=>o[0].style.width=Math.max($(".main-page").width(),$(window).width())+"px"))}}if(e.thumbnail_mode()){o.css({"z-index":1,position:"absolute",top:0,width:e.element.get_width(),height:e.element.get_height(),overflow:"hidden"})}else{i.apply_css_style(o,{"z-index":1,position:e.get_static_property("fixed_width")?"relative":"absolute",top:"0px",width:e.get_static_property("fixed_width")?e.element.get_width():"100%",overflow:"hidden"})}if(r.is_debug_mode()){t=300;$(".main-page").css("height",$(".main-page").height()+t)}else{t=0}const l=()=>{let t;if(e.thumbnail_mode()){t=e.element.get_height()}else{t=Math.max(o.parent().height(),$(".main-page").height());if(t===0){t=e.element.get_height()}}o[0].style.height=t+"px"};l();window.fix_backdrop_height=l;if(e.edit_mode()){e.autorun((()=>o.css("height",_.evaluate_property(e,"height")+20)))}let c=null;_.pre_cache(e,n.map((e=>`backdrop_${e}`)));_.pre_cache(e,["backdrop_paralax_speed","backdrop_image_paralax"]);e.autorun((()=>{const t={is_backdrop:true};for(const r of n){t[r]=_.evaluate_property(e,"backdrop_"+r)}if(e.run_mode()){for(const n of["backdrop_paralax_speed","backdrop_image_paralax"]){t[n]=_.evaluate_property(e,n)}}if(t.background_style==="video"){if(e.run_mode()&&!r.is_on_mobile_or_tablet()){if(!c){c=new $.BigVideo;c.init()}$("#big-video-wrap").css("background","black");const t=$("#big-video-wrap video");t.attr("muted","");const n=s.optimize_image(_.evaluate_property(e,"backdrop_video_source"),undefined,undefined,undefined,true);c.show(n,{forceAutoplay:true,doLoop:true,ambient:true});e.autorun((()=>{if(_.evaluate_property(e,"backdrop_video_silence")){t.attr("muted","");c.getPlayer().muted(true)}else{c.getPlayer().volume(.8);t.removeAttr("muted");c.getPlayer().muted(false)}}))}else{o.css("background","black");const t=_.evaluate_property(e,"backdrop_video_image_fallback");if(t){o.css({"background-image":`url(${s.optimize_image(t,o.width())})`,"background-position":"center top"})}}}else{(new i.Background)._apply(t,o)}}));if(!e.element.use_responsive_algorithm()){const n=r.MakeKey(null,"stripe_drawn");const s=[];$(window).off("resize.withstripe",l);$(window).on("resize.withstripe",l);e.on_destroy((()=>$(window).off("resize.withstripe",l)));e.autorun((()=>{let t=0;let a=0;function l(e){const t={};const n=r.div("backdrop-stripe",o);if(e.floating){t["z-index"]=5e3}else{t["z-index"]=u}u-=1;t.width="100%";t["box-sizing"]="border-box";t["-moz-box-sizing"]="border-box";t.height=e.stripe_height+"px";if(e.border_width>0){t["border-bottom"]=`${e.border_width}px ${e.border_style} ${e.border_color}`;t["border-radius"]=e.border_roundness+"px"}i.apply_css_style(n,t);(new i.Background)._apply(e,n);(new i.BoxShadow)._apply(e,n);return n}const c=(t,n)=>{let r;if(n.floating&&!e.edit_mode()){r="fixed";t.addClass("floating")}else{r="absolute"}t.css("position",r)};let u=5e3;o.find(".backdrop-stripe").remove();const d=f(e);if(d.length===0){return}for(const e of d){const n=l(e);c(n,e);if(e.floating!==true||e.floating&&e.floating_reference==="top"){n.css("top",t+"px");s.push({div:n,top:t,height:parseFloat(e.stripe_height)});t+=parseFloat(e.stripe_height)}else{n.css("bottom",a+"px");s.push({});a+=parseFloat(e.stripe_height)}}return n.turn()}));a=$(".main-page");e.on_message("movement_in_stripe",((i,l)=>r.WaitFor(n,(()=>{let n=0;for(let e=0;e<s.length;e++){var r;const t=s[e];if(t.top===undefined){continue}let o;if(e>=i){if(e===i){o=l-n}else{o=t.height_change}t.div.height(t.height+o);t.div.css("top",t.top+n+"px");t.height_change=o}n+=(r=t.height_change)!=null?r:0}const c=e.element.get_height()+n+t;o.css("height",c);a.css("height",c)}))))}e.autorun((()=>{const n=e.state("last_delta");if(n!=null){var r;const i=e.element.get_height()+n+t;o.css("height",i);(r=a)==null?void 0:r.css("height",i)}}))}if(e.edit_mode()){_.pre_cache(e,n);e.autorun((()=>{e.container.get_canvas().find(".stripe-container.Backdrop").remove();e.autorun((()=>{if(!e.is_destroyed()){const t={};for(const r of n){t[r]=_.evaluate_property(e,r)}(new i.Background)._apply(t,e.get_canvas())}}));a()}))}else if(e.thumbnail_mode()){e.autorun(a)}else{a()}},additional_data:{is_responsive_mode(e){return e.run_mode()&&e.element.use_responsive_algorithm()},calculate_run_mode_width(e){if(this.is_responsive_mode(e)&&!e.get_static_property("fixed_width")){const t=$(window).width();return Math.max(e.element.get_min_width(),t)}else{return e.element.get_width()}},initialize_container_width(e,t){if(!this.is_responsive_mode(e)){return}t.resize_width(this.calculate_run_mode_width(e));n((()=>{t.resize_width(this.calculate_run_mode_width(e))}));let i=null;$(window).resize((()=>{const n=this.calculate_run_mode_width(e);if(n!==i){if(r.is_fullscreen()){return}i=n;t.resize_width(n);e.get_canvas()[0].style.width=n+"px"}}))}}}}).call(this)}).call(this,e("timers").setImmediate)},{"../../../../constants/lang":73,"../../../../lang/color_tokens":657,"../../../../lang/evaluation/element_eval":690,"../../../../lang/evaluation/eval_node_state":694,"../../../../lang/evaluation/evaluate":695,"../../../../lang/evaluation/page_state":698,"../../../../lang/font_tokens":713,"../../../../u":823,"../../../property_applications":412,"../../shared/image_utils":363,"../../shared/pages":366,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,timers:2334}],342:[function(e,t,n){"use strict";const r=e("../../../property_applications");const i=e("../../shared/image_utils");t.exports={property_applications:[new r.MinWidth],additional_data:{notify_width(e,t){return i.keep_proportions(e,t)}}}},{"../../../property_applications":412,"../../shared/image_utils":363}],343:[function(e,t,n){(function(n){(function(){"use strict";e("core-js/modules/web.immediate.js");e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../../u");const i=e("../../../../lib");const s=e("../../../../lang/elements");const o=e("../../../property_applications");const a=e("../../../../constants/runmode");const l=e("../../shared/popups");const c=e("../../../../lang/evaluation/element_eval");const{ignoreError:u}=e("../../../../u/shared/callbacks");t.exports={property_applications:[new o.MinWidth],initialize(e){e.wait_for_visible_lite((()=>{c.on_property_change(e,"greyout_color",(t=>{l.apply_greyout_color(e,t)}));c.on_property_change(e,"greyout_blur",(t=>{if(![null,undefined,0].includes(t)){e.wait_for_visible((()=>{l.apply_blur_effect_to_greyout(e,t)}))}}));let t=0;e.on_message("child_movement",(n=>{t=n;e.wait_for_visible((()=>{const n=e.element.get_height()+t;l.get_popup_positioning(e,n);e.get_canvas()[0].style.height=n+"px"}))}));e.on_destroy((()=>{if(![null,undefined,0].includes(e.get_static_property("greyout_blur"))||e.edit_mode()){l.remove_blur_effect_to_greyout(e)}}))}))},position_canvas(e,t){let n;if(t.responsive_mode()){n="absolute";const c=r.div("r-wrapper popup");c.append(e);i().visual_edit.responsive_canvas.get_current_preview_canvas().find("> .r-wrapper").append(c);t.container.add_to_instances(t);i().visual_edit.responsive_canvas.register_wrapper(t.element_id(),c,true);e.hide()}else if(t.edit_mode()){$(".canvas").append(e);n="absolute"}else{$(window.document.body).append(e);n="fixed";e.css("display","none")}const s=t.element.get_width();o.apply_css_style(e,{height:t.element.get_height()+"px",top:l.get_popup_top(t)+"px",position:n,left:"50%"});t.autorun((()=>{var n;e.css("z-index",a.POPUP_ZINDEX+((n=t.state("popup_zindex"))!=null?n:0))}));e.data("overwrite-left","50%");if(t.run_mode()||t.responsive_mode()){function u(e){if(t.run_mode()){var n;(n=e)!=null?n:e=$(window).width()}else if(t.responsive_mode()){var r;(r=e)!=null?r:e=i().visual_edit.responsive_canvas.current_width_without_dependency}return Math.max(t.element.get_min_width(),Math.min(t.element.get_width(),e-20))}t.on_resize((e=>{if(t.is_visible()){l.resize_popup(t,u(e))}}));let d=null;$(window).on("resize.popup_"+t.element_id(),(()=>{const e=$(window).height();if(e!==d){d=e;l.get_popup_positioning(t)}}));t.on_destroy((()=>$(window).off("resize.popup_"+t.element_id())))}else{o.apply_css_style(e,{width:s+"px","margin-left":"-"+s/2+"px"})}},do_show(e,t,d,p){e.ensure_drawn();let _=e.get_canvas();e.state("has_been_absolutely_positioned",null);l.add_layer(e);_=e.get_canvas();const f=l.get_greyout(e);if(e.run_mode()){var h;f.css("z-index",a.POPUP_ZINDEX+((h=e.state("popup_zindex"))!=null?h:0))}if(![null,undefined,0].includes(e.get_static_property("greyout_blur"))||e.edit_mode()){l.apply_blur_effect_to_greyout(e,e.get_static_property("greyout_blur"))}if(e.run_mode()){l.get_popup_positioning(e);r.run_once(30,(()=>({height:c.evaluate_property(e,"height"),width:c.evaluate_property(e,"width")})),u((i=>{var a,c,u;let{height:h,width:m}=i;(a=(c=_).velocity)==null?void 0:a.call(c,"stop");(u=f.velocity)==null?void 0:u.call(f,"stop");l.get_popup_positioning(e,h);o.apply_css_style(_,{opacity:0,"margin-left":"-"+m/2+"px",width:m+"px"});const g=Math.max(e.element.get_min_width(),Math.min(m,$(window).width()-20));_[0].style.display="block";if(p){s.perform_animate_in(e,t,d,true);n((()=>{l.resize_popup(e,g);_[0].style.display="block"}))}else{t={animation:"transition.fadeIn"};d={duration:300};n((()=>{l.resize_popup(e,g)}));s.perform_animate_in(e,t,d,true)}o.apply_css_style(f,{opacity:0,display:"block"});r.velocity(f,"fadeIn",{duration:300,complete_cb(){f[0].style.top="-1px";e.setTimeout((()=>{f[0].style.top="0px"}),151)}});e.setTimeout((()=>{let t=[];let n=false;function r(e){for(const s of(i=e.children)!=null?i:[]){var i;if(s.element.get_messages().includes("set_focus")){if(!s.get_canvas()){continue}if(s.get_canvas().is(":focus")){n=true;return}t.push(s)}r(s)}}r(e);if(n){return}t=t.filter((e=>e.state("tab_index")&&e.is_visible()));t.sort(((e,t)=>{if(e.state("tab_index")<=t.state("tab_index")){return-1}else{return 1}}));for(const e of t){if(e.is_visible()){if(e.element.type()!=="DateInput"){e.message("set_focus")}break}}}),400);if(!e.get_static_property("prevent_user_from_closing_through_esc")){$(document).off("keydown.escape");$(document).on("keydown.escape",(t=>{if(t.keyCode===27){e.do_hide();$(document).off("keydown.escape")}}));f.off("click");f.on("click",(()=>{e.do_hide()}))}e.message("popup_opened")})))}else{_[0].style.display="block";e._is_visible_me=true;e._update_visible();if(!e.thumbnail_mode()){f[0].style.display="block"}if(e.responsive_mode()){f[0].style.height=f.parents(".res-preview").find(".main-page").height()+"px";r.run_once(30,(()=>c.evaluate_property(e,"width")),u((t=>{const n=i().visual_edit.responsive_canvas.current_width_without_dependency;t=Math.max(e.element.get_min_width(),Math.min(t,n-20));l.resize_popup(e,t)})))}if(e.edit_mode()){f.click((()=>{i().visual_edit.turn_element_on(e.element_id(),false)}))}}},do_hide(e,t,n,i){if(!e.is_drawn){return}e.set_animating(true);if(r.on_phonegap()){$(window).off("touchmove.popup_opened")}const s=e.get_canvas();const o=l.get_greyout(e);if(![null,undefined,0].includes(e.get_static_property("greyout_blur"))||e.edit_mode()){l.remove_blur_effect_to_greyout(e)}if(!e.edit_mode()&&s.is(":visible")){var a,c;(a=s.velocity)==null?void 0:a.call(s,"stop");(c=o.velocity)==null?void 0:c.call(o,"stop");if(i){var u,d,p,_,f;(u=e._transforms)!=null?u:e._transforms={};(p=(d=e._transforms).initial_opacity)!=null?p:d.initial_opacity=s[0].style.opacity;(f=(_=e._transforms).initial_transform)!=null?f:_.initial_transform=s[0].style.transform;r.velocity(s,t.animation,{duration:n.duration,transform:"",complete_cb(){e.set_animating(false);s[0].style.transform=e._transforms.initial_transform;s[0].style.opacity=e._transforms.initial_opacity;e._transform=undefined}})}else{r.velocity(s,"fadeOut",{duration:300,complete_cb(){e.set_animating(false);s[0].style.display="none"}})}r.velocity(o,"fadeOut",{duration:300,complete_cb:()=>{o[0].style.display="none"}});e.message("popup_closed")}else{s[0].style.display="none";o[0].style.display="none";e.set_animating(false)}e._is_visible_me=false;e._update_visible();l.remove_layer(e);l.set_body_overflow()}}}).call(this)}).call(this,e("timers").setImmediate)},{"../../../../constants/runmode":83,"../../../../lang/elements":680,"../../../../lang/evaluation/element_eval":690,"../../../../lib":741,"../../../../u":823,"../../../../u/shared/callbacks":843,"../../../property_applications":412,"../../shared/popups":368,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,timers:2334}],344:[function(e,t,n){(function(n){(function(){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.immediate.js");e("core-js/modules/es.string.replace.js");const r=e("../../../../u");const i=e("../../../property_applications");const s=e("../../../../constants/runmode");const o=e("../../../../db/hydrate");const a=e("../../../../logger");const l=e("../../core_elements_utilities/element_utils");const c=e("../../shared/dropdowns");const u=e("../../shared/radiobuttons");const d=e("../../shared/inputs");const p=e("../../../../lang/evaluation/element_eval");const _=50;t.exports={property_applications:[new i.MinWidth],can_defer_drawing(){return true},register(e){const t=r.Watcher((()=>{if(!e.state("has_been_changed")){return false}const t=e.state("value");if(t==null){return false}return!this._choice_list_contains(e,t)}));e.on_destroy((()=>t.destroy()));t.on_value((t=>{if(t){e.message("reset_input")}}))},initialize(e){e.wait_for_visible_lite((()=>{const t=r.LUID();const f=e.get_canvas();const h=r.div("radio-v0",f);if(e.run_mode()){f.addClass(s.CLICKABLE_ELEMENT)}e.on_message("set_focus",(()=>f.find("input:first").focus()));l.register_tab_index_listener(e,(e=>{f.find("input:first").attr("tabindex",e)}));if(e.edit_mode()){h[0].style.height="100%"}p.on_property_change(e,"color",(e=>{for(const e of u.bootstrap_colors){h.removeClass("radio-"+e)}h.addClass("radio-"+e)}));let m={};function g(e,n){const r=o.dehydrate_tree_to_string_safe(e.value);const i=$('<input type="radio" value="'+r+'" name="'+t+'" id="'+t+"_option_"+n+'"><label for="'+t+"_option_"+n+'">'+e.display+"</label>");i.data("bubble_val",r);m[r]=i;return i}const v=()=>{let t;if(e.edit_mode()&&p.evaluate_property(e,"choices_style")==="dynamic"){t=["Dynamic choice 1","Dynamic choice 2","Dynamic choice 3","Dynamic choice 4"];e.get_canvas().data("Dynamic choice 1");return t.map((e=>({display:e,value:e})))}t=this._get_raw_choice_list(e);const n=this._get_display_option(e);const i=t.get_children(0,_);r.run_once(30,(()=>i.map((e=>n(e)))));const s=[];for(const e of i){s.push({display:n(e),value:e})}return s};let b=null;function y(t){var n,r;b=t;m=f.data("options_div_mapping");if(!t){if(e.edit_mode()){var i;const e=Object.values((i=m)!=null?i:{})[0];if(e!=null){e[0].checked=true;return}}else{for(const e of Object.values((s=m)!=null?s:{})){var s;e[0].checked=false}}}const a=o.dehydrate_tree_to_string_safe(t);const l=(n=m)==null?void 0:(r=n[a])==null?void 0:r[0];if(l!=null){l.checked=true}}const w=()=>{let t;h.empty();m={};const s=e.get_static_property("columns");const o=p.evaluate_property(e,"width");const l=Math.max(Math.floor(s/e.element.get_width()*o),1);const u=10;const d=20;let _=(o-i.calculate_border_width(e))/l-u;_-=d;const w=v();for(let e=0;e<w.length;e++){const n=w[e];t=g(n,e);h.append(t);const r=$(t[1]);r[0].style.width=_+"px";r[0].style["margin-right"]=d+"px";if(e<l){r[0].style["margin-top"]="3px"}else{r[0].style["margin-top"]="12px"}}f.data("options_div_mapping",m);h.find("input[type=radio]").on("change",(function(){const t=c.rehydrate_dropdown_value($(this).data("bubble_val"));e.message("user_submit",t);y(t)}));y(b);const x=p.evaluate_property(e,"disabled");for(const e of Object.values((j=m)!=null?j:{})){var j;e[0].disabled=x}if(!e.edit_mode()&&!e.thumbnail_mode()){const t=f.outerHeight()-f.height();const i=e.element.get_height();n((()=>{const n=r.MakeKey(null,"wrapper_drawn");r.run_once(30,(()=>{const e=parseInt(h.css("height").replace("px",""));if(e>0){return e}}),((r,s)=>{if(r){a.log(r);return}if(s>0){n.turn();return e.set_height(Math.max(i,s+t))}}))}))}};d.input_change_autorun(e,(e=>y(e)));r.autorun((()=>{const t=p.evaluate_property(e,"disabled");for(const e of Object.values((n=m)!=null?n:{})){var n;e[0].disabled=t}}));e.autorun((()=>{if(e.is_visible()){w()}}))}))}}}).call(this)}).call(this,e("timers").setImmediate)},{"../../../../constants/runmode":83,"../../../../db/hydrate":429,"../../../../lang/evaluation/element_eval":690,"../../../../logger":744,"../../../../u":823,"../../../property_applications":412,"../../core_elements_utilities/element_utils":286,"../../shared/dropdowns":358,"../../shared/inputs":364,"../../shared/radiobuttons":369,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,timers:2334}],345:[function(e,t,n){(function(n){(function(){"use strict";e("core-js/modules/web.immediate.js");e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("../../../../u");const i=e("../../../../lang/elements");const s=e("../../../property_applications");const o=e("../../../../lib");const a=e("../../../../languages");const l=e("../../../status_bar");const c=e("../../../../logger");const u=e("../../../../db/sample");const d=e("../../../../lang/btypes");const p=e("../../core_elements_utilities/element_utils");const _=e("../../../../client/epoch");const f=e("../../../../constants/epoch");const h=e("../../shared/repeating_group_utils");const m=e("../../shared/repeating_groups");const g=e("../../GroupItem");const v=e("../../../../lang/evaluation/element_eval");const b="#CCCCCC";const y=5e3;const w=f.SPANS.rg_display_data_in_cells;const x=f.SPANS.rg_add_cells;function j(e){if(e.get_static_property("layout_style")==="horizontal_scroll"){return 1}else{return e.get_static_property("rows",true)}}t.exports={register(e){e.repeating_group_layout={max_index:null,add_cells:null,has_written_a_list:false,do_create_container:()=>({}),finished_loading_switch:r.MakeSwitch(null,"loading_switch"),raw_list_data(){return null}};e.repeating_layout_type="RepeatingGroup";let t=null;function s(n){let r;if(n!==undefined){e.repeating_group_layout.has_written_a_list=true}if(n&&n.dehydrate){r=n.dehydrate()}else{r="no data";n=null}if(r!==t){t=r;e.state("list_data",n);e.state("show_range",0)}}if(e.responsive_mode()){n((()=>{var t;const n=(t=e.get_static_property("group_type"))!=null?t:"user";return s(o().db_instance().static_list(n,[new u.SampleObject(n)]))}))}else if(e.run_mode()){e.state("list_data",i.STATE_NOT_READY);const t=new Map;e.autorun((()=>{if(!e.state("datasource_changed_by_workflow_action")){const n=v.evaluate_property(e,"data_source");m.check_astable_loop(e,n,t);s(n)}}));e.on_message("set_list_data",(t=>{e.state("datasource_changed_by_workflow_action",true);s(t)}));e.on_message("clear_list",(()=>{e.state("datasource_changed_by_workflow_action",false);const t=e.get_static_property("layout_style");if(t==="limit_items"){e.state("show_range",0)}else if(t==="infinite_scroll"){var n;(n=e.get_canvas())==null?void 0:n.scrollTop(0)}else if(t==="horizontal_scroll"){var r;(r=e.get_canvas())==null?void 0:r.scrollLeft(0)}for(const t of(i=e.children)!=null?i:[]){var i;p.reset_inputs_and_groups(t)}}));e.on_message("show_next",(t=>{var n;(n=t)!=null?n:t=false;r.run_once(30,(()=>{var t;return(t=e.state("list_data"))==null?void 0:t.length()}),((n,r)=>{let i;if(n){c.log(n);return}const s=j(e)*m.get_fixed_cell_rg_column_count(e);let o=e.state("show_range");o+=s;if(e.get_static_property("stable_pagination")){i=o>=r;if(i&&t){o=0}else if(i){return}}else{i=o===r;const e=o+s>r;if(i&&t){o=0}else if(e){o=Math.max(r-s,0)}}e.state("show_range",o)}))}));e.on_message("show_previous",(t=>{var n;(n=t)!=null?n:t=false;return r.run_once(30,(()=>{var t;return(t=e.state("list_data"))==null?void 0:t.length()}),((n,r)=>{if(n){c.log(n);return}const i=j(e)*m.get_fixed_cell_rg_column_count(e);let s=e.state("show_range");if(s===0&&t){if(e.get_static_property("stable_pagination")){s=Math.max(r-i+r%i,0)}else{s=Math.max(r-i,0)}}else{s=Math.max(s-i,0)}return e.state("show_range",s)}))}));e.on_message("go_to_page",(t=>r.run_once(30,(()=>{var t;return(t=e.state("list_data"))==null?void 0:t.length()}),((n,r)=>{if(n){c.log(n);return}const i=j(e)*m.get_fixed_cell_rg_column_count(e);let s=(t-1)*i;if(s+i>r&&!e.get_static_property("stable_pagination")){s=Math.max(0,r-i)}return e.state("show_range",s)}))));e.on_message("draw_till",(t=>{const n=e.get_static_property("layout_style");if(!["infinite_scroll","horizontal_scroll","vertical_extendable"].includes(n)||!e.repeating_group_layout.max_index){return}if(e.repeating_group_layout.max_index()>t){return}e.repeating_group_layout.add_cells(t+1);e.repeating_group_layout.max_index(t)}));e.on_message("scroll_to",(t=>{if(e.get_static_property("layout_style")==="limit_items"){return}r.WaitFor(e.get_children_drawn_key(),(()=>{r.run_once(30,(()=>{const n=e.state("list_data");if(n==null&&!e.state("loading")){return-1}return n==null?void 0:n.position(t.entry,d.get(e.get_static_property("group_type")))}),((n,i)=>{var s,o;if(n){c.log(n);return}if(i===-1){return}function a(){let n;const s=e.children[i];const o=e.get_static_property("layout_style");if(o==="infinite_scroll"){n=s.get_canvas().position().top+e.get_canvas().scrollTop()+t.offset;if(t.animate){return e.get_canvas().animate({scrollTop:n},300)}else{return e.get_canvas().scrollTop(n)}}else if(o==="horizontal_scroll"){n=s.get_canvas().position().left+e.get_canvas().scrollLeft();if(t.animate){return e.get_canvas().animate({scrollLeft:n},300)}else{return e.get_canvas().scrollLeft(n)}}else{if(t.animate){return r.velocity(s.get_canvas(),"scroll",{duration:300,offset:-t.offset})}else{let e;let n=s.get_canvas();while(n.length&&!n.hasClass("main-page")&&!e){if(n.css("position")==="fixed"){e=n}n=n.parent()}if(!n.length||n.hasClass("main-page")){e=$(window)}return e.scrollTop(s.get_canvas().offset().top+t.offset)}}}if(!((s=e.children)!=null&&(o=s[i])!=null&&o.is_visible())){r.wait_for_updates((()=>{e.message("draw_till",i);function t(){e.setTimeout((()=>{var n,r,s;if((n=e.children)!=null&&(r=n[i])!=null&&r.is_visible()&&(s=e.children)!=null&&s[i].canvas.is(":visible")){a()}else{t()}}),50)}t()}))}else{a()}}))}))}))}},initialize(e){let t;const u=e.get_canvas();const d=()=>{var e,t;return((e=window)==null?void 0:(t=e.BrowserDetect)==null?void 0:t.OS)==="Windows"};const p=()=>a.is_rtl(o().app_language());const f=()=>e.get_static_property("columns",true);const v=()=>{var t;return(t=e.columns)!=null?t:f()};const A=e=>Math.floor((e-1)/v())+1;const M=e=>(e-1)%v()+1;function E(t){if(e.get_static_property("layout_style")==="horizontal_scroll"){return false}else{return A(t)>1}}function k(t){if(e.get_static_property("layout_style")==="horizontal_scroll"){return t>1}else{return M(t)>1}}const O=1;const S=()=>e.edit_mode()&&e.state("show_borders")&&(e.get_static_property("separator_width")===0||e.get_static_property("separator_style")==="none");function D(){if(S()){return O}else{return m._get_separator_width(e.element)}}function C(){const t=e.element.get_width();const n=t-m.get_external_border_width(e);const r=n-D()*(v()-1);return Math.floor(10*r/(v()+0))/10}function T(){const t=e.element.get_height();const n=t-m.get_external_border_width(e);const r=n-D()*(j(e)-1);return Math.floor(10*r/(j(e)+0))/10}const N=()=>e.element.get_zindex();function P(t,n){if(E(t)){s.apply_css_style(n,{"border-top-width":D()+"px","border-top-color":S()?b:e.get_static_property("separator_color"),"border-top-style":S()?"solid":e.get_static_property("separator_style")})}else{n[0].style["border-top-style"]="none"}return e.autorun((()=>{let r;if(p()){r="right"}else{r="left"}if(k(t)){const t={};t["border-"+r+"-width"]=D()+"px";t["border-"+r+"-color"]=S()?b:e.get_static_property("separator_color");t["border-"+r+"-style"]=S()?"solid":e.get_static_property("separator_style");return s.apply_css_style(n,t)}else{n[0].style["border-"+r+"-style"]="none"}}))}let I;function R(){if(I==null){if(["show_all","vertical_extendable","limit_items"].includes(e.get_static_property("layout_style"))){I=0}else{const e=r.div("div-for-scrollbar",$("body"));e.css("overflow-y","scroll");I=Math.max(e[0].offsetWidth-e[0].clientWidth,0);e.remove()}}return I}const L=(t,n)=>e.autorun((()=>{s.apply_css_style(n.canvas,{float:p()?"right":"left",position:"relative","box-sizing":"border-box","-moz-box-sizing":"border-box","z-index":N(),height:T()+(E(t)?D():0)+"px"});return z(t,n)}));function z(t,r,i){var o,a;let l=(o=i!=null?i:e.repeating_group_layout.cell_width)!=null?o:C();if(e.get_static_property("layout_style")!=="horizontal_scroll"){if(M(t)===v()){if(v()>1){l-=R()+1}}}s.apply_css_style(r.canvas,{width:l+(k(t)?D():0)+"px"});P(t,r.canvas);r==null?void 0:(a=r.child_container)==null?void 0:a.resize_width(l);return n((()=>{var e;return r==null?void 0:(e=r.child_container)==null?void 0:e.resize_width(l)}))}function B(){let t;if(e.edit_mode()||e.thumbnail_mode()){t=$("> .list-dummy",u)}else{if($("> .rows",u).length){t=$("> .rows > .list-dummy",u)}else{t=$("> .list-dummy",u)}}return t}e.on_message("resize_cell",((e,t,n)=>z(e,t,n)));e.on_message("resize_dummies",(e=>{const t=B();for(let n=0;n<t.length;n++){const r=t[n];z(n+1,{canvas:$(r)},e)}}));if(!(e.run_mode()||e.responsive_mode())){t=r.div("list-item",e.canvas)}const q=()=>r.wait_for_updates((()=>e.setTimeout((()=>{const n=B();if(e.edit_mode()||e.thumbnail_mode()){n.html(t.html())}else if(e.responsive_mode()){var r;n.html((r=e.children)==null?void 0:r[0].canvas.html())}n.find(".resize-handle").remove();n.find(".element").css({"-webkit-box-shadow":"none","box-shadow":"none","-moz-box-shadow":"none"});n.find(".element").removeClass("element");return n.find(".container").removeClass("container")}),100)));e.wait_for_visible_lite((()=>{if(e.run_mode()||e.responsive_mode()){let M;const E=e.get_static_property("layout_style");e.children=[];const k=[];const O=h.evaluate_extra_fields(e.element);const S=(t,n)=>{var i;(i=e.repeating_group_layout._raw_list_data_watcher)==null?void 0:i.destroy();e.repeating_group_layout._raw_list_data_watcher=r.Watcher((()=>{var r,i,s,o;const a=t();const l=n();const c=e.state("list_data");return(r=c==null?void 0:(i=c.with_extra_fields)==null?void 0:(s=(o=i.call(c,O)).get_children)==null?void 0:s.call(o,a,l))!=null?r:[]}));e.repeating_group_layout._raw_list_data_watcher.on_value((()=>{e.state("loading",true);e.repeating_group_layout.finished_loading_switch.turn_off()}));e.repeating_group_layout.raw_list_data=()=>e.repeating_group_layout._raw_list_data_watcher.get()};const N=(t,n)=>{if(!(e.responsive_mode()&&t>1)){const n=new g(e,T(),t);const s=i.ElementInstance(n,e.mode);s.state("group_data",i.STATE_NOT_READY);s.drawn_key=r.MakeKey(null,"cell_drawn");n.instance=s;e.children.push(s);s.state("cell_index",t);s._is_visible_me=false;s.register(e);s.create_skeleton(M);s.start_draw_tree();L(t,s);P(t,s.canvas);s.do_hide();s.drawn_key.turn()}if(E!=="show_all"){const e=r.div("list-dummy",n);L(t,{canvas:e});P(t,e);k.push(e)}};let I;const R=()=>_.traceSpan(w.name,w.type,(()=>{let t=null;return e.autorun((()=>{var n;let i;if(!e.is_visible()){var s;(s=t)==null?void 0:s();return}e.state("loading",true);e.repeating_group_layout.finished_loading_switch.turn_off();if(!t){t=l.spinner(e)}let o=e.repeating_group_layout.raw_list_data();const a=e.state("list_data");if(!e.responsive_mode()){o=o.filter((e=>e!=null))}(n=t)==null?void 0:n();t=null;let c;for(c=0;c<o.length;c++){const t=o[c];if(e.children[c]!=null){var u;const n=e.children[c];r.WaitFor(r.page_loaded_key,(()=>n.can_register_workflows().turn()));n.message("set_group_data",t);n.do_show();if(["show_all","vertical_extendable"].includes(E)){n.message("child_shown")}const i=(u=k[c])==null?void 0:u[0];if(i!=null){i.style.display="none"}}}e.last_cell=c;const d=e.children[c-1];if(d&&["show_all","vertical_extendable"].includes(E)){d.message("child_shown")}const p=c;if(!["show_all","vertical_extendable"].includes(E)){let t;let n,r;const s=j(e)*v();for(t=p,r=k.length,n=p<=r;n?t<r:t>r;n?t++:t--){var _;if(t<s){var f;i=(f=k[t])==null?void 0:f[0];if(i!=null){i.style.display="block"}}(_=e.children[t])==null?void 0:_.do_hide()}if(["infinite_scroll","horizontal_scroll"].includes(E)&&p<k.length){let e,n;for(t=p,n=k.length,e=p<=n;e?t<n:t>n;e?t++:t--){i=k[t][0];if(i!=null){i.style.display="none"}}}}else{for(let t=p,n=e.children.length,r=p<=n;r?t<n:t>n;r?t++:t--){e.children[t].do_hide();if(E==="vertical_extendable"){var h;i=(h=k[t])==null?void 0:h[0];if(i!=null){i.style.display="none"}}}if(p<e.children.length){e.children[e.children.length-1].message("child_shown")}}if(E==="horizontal_scroll"){I[0].style.width=c*C()+(c-1)*D()+10+"px"}if(a!=null&&E==="limit_items"&&v()===1&&j(e)===1){if(e.state("show_range")===(a==null?void 0:a.length())&&a.length()>1){e.state("show_range",a.length()-1)}}if(e.repeating_group_layout.has_written_a_list){r.wait_for_updates((()=>{e.mark_children_registered();return e.get_children_drawn_key().turn()}))}r.wait_for_updates((()=>{const[t,n]=e.repeating_group_layout._raw_list_data_watcher.get_current_status_array();const r=!n||t!=null;e.state("loading",r);if(r){e.repeating_group_layout.finished_loading_switch.turn_off()}else{e.repeating_group_layout.finished_loading_switch.turn_on()}}))}))}));if(["infinite_scroll","horizontal_scroll","show_all","vertical_extendable"].includes(E)){let z=0;I=r.div("rows",u);I[0].style["-webkit-transform"]="translateZ(0)";if(E==="infinite_scroll"){I[0].style["min-height"]=e.element.get_height()+1+"px"}e.repeating_group_layout.add_cells=t=>{_.traceSpan(x.name,x.type,(()=>{if(t>z){for(let e=z+1,n=e,r=t,i=e<=r;i?n<=r:n>=r;i?n++:n--){N(n,I)}z=t;e.last_cell=z}if(E==="horizontal_scroll"){I[0].style.width=t*C()+(t-1)*D()+10+"px"}}))};M=e.container.create_child(e,I);if(["infinite_scroll","horizontal_scroll","vertical_extendable"].includes(E)){const B=e.element.get_height()-m.get_external_border_width(e);const U=u.height();const F={"overflow-scrolling":"touch","-webkit-overflow-scrolling":"touch"};if(!e.responsive_mode()){if(E==="infinite_scroll"){if(d()){F["overflow-y"]="scroll"}else{F["overflow-y"]="auto"}}else if(E==="vertical_extendable"){F["overflow-y"]="hidden"}else if(E==="horizontal_scroll"){if(d()){F["overflow-x"]="scroll"}else{F["overflow-x"]="auto"}}}else{F["overflow-y"]="hidden"}s.apply_css_style(u,F);e.autorun((()=>I[0].style.float=p()?"right":"left"));const W=e.get_static_property("fixed_width");if(E==="vertical_extendable"){function X(){const t=T();if(t===0){return 0}const n=Math.ceil(($(window).scrollTop()+$(window).height()-u.offset().top)/t);return v()*Math.max(j(e),n)-1}e.repeating_group_layout.max_index=r.Box(X());e.setTimeout((()=>{const t=X()-e.repeating_group_layout.max_index();if(t>0){return H(t)}}),100)}else if(E==="horizontal_scroll"&&!W){const Y=()=>Math.ceil(u.width()/C());e.repeating_group_layout.max_index=r.Box(Math.max(v(),Y()));e.setTimeout((()=>{const t=Y()-e.repeating_group_layout.max_index();if(t>0){H(t)}}),100)}else{e.repeating_group_layout.max_index=r.Box(j(e)*v())}let G=false;const V="scroll wheel";function H(t,n){var i;(i=t)!=null?i:t=1;G=true;r.run_once(30,(()=>{var n,r,i;return(n=(r=e.state("list_data"))==null?void 0:(i=r.with_extra_fields)==null?void 0:i.call(r,O).get_children(e.repeating_group_layout.max_index(),t))!=null?n:[]}),((i,s)=>{if(i){c.log(i);G=false;return}if(s.length){let n;const i=Math.min(s.length,t);if(E==="infinite_scroll"){n=v()}else{n=0}e.repeating_group_layout.add_cells(e.repeating_group_layout.max_index()+i+n);e.repeating_group_layout.max_index(e.repeating_group_layout.max_index()+i+n-1);r.wait_for_updates((()=>G=false))}else{G=false;n==null?void 0:n()}}))}if(["infinite_scroll","horizontal_scroll"].includes(E)){u.on(V,(t=>{const n=$(window).height();if(E==="infinite_scroll"){var i;if(!(r.is_on_mobile_or_tablet()||((i=window.BrowserDetect)==null?void 0:i.OS)==="Windows")){var s;const e=u.offset().top+U;if(G&&e<$(window).scrollTop()+n){t.preventDefault();return}else if(((s=t.originalEvent)==null?void 0:s.wheelDelta)<0&&e>$(window).scrollTop()+n){u[0].style["overflow-y"]="hidden";return}else{u[0].style["overflow-y"]="auto"}}if(u.scrollTop()+B>parseInt(I.css("height").replace("px",""))-50){H(2*v())}}else if(E==="horizontal_scroll"){if(G){t.preventDefault();return}const n=()=>H(2,(()=>I.css("width",e.last_cell*C()+(e.last_cell-1)*D())));if(p()){if(u.scrollLeft()<C()){n()}}else{if(u.scrollLeft()+u.width()>parseInt(I.css("width").replace("px",""))-C()){n()}}}}))}else if(E==="vertical_extendable"){function K(t){let n=null;t.on("DOMMouseScroll mousewheel scroll wheel",(t=>{if(G){return}e.clearTimeout(n);n=e.setTimeout((()=>{const e=u.offset().top+u.height();const t=$(window).height();if(e<$(window).scrollTop()+Math.max(t+T()*2,100)){const n=Math.ceil(($(window).scrollTop()+t-e)/T()+2);H(Math.max(n+1,3)*v())}}),20)}))}const J=e.element.parents("FloatingGroup");if(J.length){var n,a;r.wait_for_attached(u,(()=>{var e;let t;let n=u;while(n.length&&!n.is("body")){if(n.css("position")==="fixed"){t=n}n=n.parent()}(e=t)!=null?e:t=$(window);K(t)}),{error_message:`Dynamic data necessary to render vertically-extending Repeating Group "${e.element.display()}" inside Floating Group "${(n=J[0])==null?void 0:(a=n.display)==null?void 0:a.call(n)}" was not ready on page load.\nFor better performance, please set the repeating group to "full list" or re-structure the page to have the repeating group's data load earlier elsewhere on the page.`})}else{K($(window))}}e.repeating_group_layout.add_cells(e.repeating_group_layout.max_index()+1);S((()=>0),(()=>e.repeating_group_layout.max_index()+1));R()}else{I[0].style.overflow="hidden";e.repeating_group_layout.max_index=r.Box(null,true);S((()=>0),(()=>e.repeating_group_layout.max_index()));R();e.autorun((()=>{var t,n;const i=Math.min((t=(n=e.state("list_data"))==null?void 0:n.length())!=null?t:0,y);if(i>100){c.owner_warn(new r.OwnerError("repeating group showing more than 100 items",{display:"This repeating group is showing more than 100 items, which can considerably slow down your page. You should consider using infinite scrolling",element_instance:e}))}r.autorun_top((()=>{e.repeating_group_layout.add_cells(i);e.repeating_group_layout.max_index(i)}));if(i===0){return e.set_height(0)}}))}}else{M=e.container.create_child(e,e.canvas);for(let Z=1,Q=j(e)*v(),ee=Q>=1;ee?Z<=Q:Z>=Q;ee?Z++:Z--){N(Z,e.canvas)}S((()=>e.state("show_range")),(()=>j(e)*v()));return R()}}else{var f,b,A;if(e.thumbnail_mode()&&!((f=o().styles_editor)!=null&&(b=f.element_styles_editor())!=null&&(A=b.owner)!=null&&A.is_active())){r.run_once(60,(()=>e.start_child_drawing()))}e.autorun((()=>{L(1,{canvas:t});P(1,t);u.find(".list-dummy").remove();const n=Math.min(v()*j(e),100);for(let e=2,t=n,i=t>=2;i?e<=t:e>=t;i?e++:e--){if(n>=2){const t=r.div("list-dummy",u);L(e,{canvas:t});P(e,t)}}return q()}));return e.autorun((()=>{for(const r of e.element.elements()){var t,n;r.json.register_dependency();(t=r.get_style())==null?void 0:(n=t.json)==null?void 0:n.register_dependency();o().visual_edit.turned_on(r.id())}return q()}))}}))},get_container_width(e){let t;const n=e.get_static_property("columns",true);if([undefined,null,"none"].includes(e.get_static_property("separator_style",true))){t=e.get_static_property("separator_width",true)}else{t=0}return(e.get_width()-t*(n-1)-m.get_external_border_width(e))/n},additional_data:{notify_width(e,t){if(!e.get_static_property("fixed_width")){let i;const s=m._get_separator_width(e.element);const o=e.get_static_property("columns",true);const a=m._get_cell_width(e.element);if(e.get_static_property("layout_style")!=="horizontal_scroll"){if(t){var n,r;let l,c;if(o===1&&!e.get_static_property("allow_more_than_one_colum")){l=1;i=t-m.get_external_border_width(e)}else{const n=this.get_min_width(e.element);const r=(t-s*(o-1)-m.get_external_border_width(e))/o;if(r<n){i=n}else{if(t>e.element.get_width()){i=a}else{i=r}}l=Math.max(Math.floor(t/i),1);i=(t-s*(l-1)-m.get_external_border_width(e))/l;const c=t-m.get_external_border_width(e)-l*i-s*(l-1);i=i+c/l}e.columns=l;e.repeating_group_layout.cell_width=i;const u=(n=e.children)!=null?n:[];for(let t=0;t<u.length;t++){c=u[t];e.message("resize_cell",t+1,c,i)}(r=c)==null?void 0:r.message("child_shown");const d=e.responsive_mode();const p=e.run_mode()&&!e.get_static_property("fixed_width");if(d||p){e.message("resize_dummies",i)}}}else{const t=e.get_canvas().scrollLeft();e.get_canvas().find("> .rows").css("width",e.last_cell*a+(e.last_cell-1)*s+10);e.get_canvas().scrollLeft(t);if(e.responsive_mode()){e.message("resize_dummies",i)}}}}}}}).call(this)}).call(this,e("timers").setImmediate)},{"../../../../client/epoch":25,"../../../../constants/epoch":63,"../../../../db/sample":461,"../../../../lang/btypes":653,"../../../../lang/elements":680,"../../../../lang/evaluation/element_eval":690,"../../../../languages":739,"../../../../lib":741,"../../../../logger":744,"../../../../u":823,"../../../property_applications":412,"../../../status_bar":415,"../../GroupItem":242,"../../core_elements_utilities/element_utils":286,"../../shared/repeating_group_utils":370,"../../shared/repeating_groups":371,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,timers:2334}],346:[function(e,t,n){"use strict";const r=e("../../../property_applications");const i=e("../../shared/image_utils");t.exports={property_applications:[new r.MinWidth],initialize(){},additional_data:{notify_width(e,t){return i.keep_proportions(e,t)}}}},{"../../../property_applications":412,"../../shared/image_utils":363}],347:[function(e,t,n){(function(n){(function(){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.immediate.js");const r=e("../../../../u");const i=e("../../../property_applications");const s=e("../../core_elements_utilities/element_utils");const o=e("../../../../constants/runmode");const a=e("../../shared/inputs");const l=e("../../../../lang/evaluation/element_eval");t.exports={property_applications:[new i.MinWidth],initialize(e){e.wait_for_visible_lite((()=>{const t=e.get_canvas();const i=r.MakeKey(null,"slider_init");const c=r.div("jquery-slider",t);c.slider();t.css("padding",8);const u=()=>c.slider("instance");e.on_destroy((()=>{if(u()){c.slider("destroy")}}));if(!e.run_mode()){c.off()}if(e.run_mode()){t.addClass(o.CLICKABLE_ELEMENT);e.wait_for_visible((()=>{r.WaitFor(i,(()=>{l.on_property_change(e,"disabled",(e=>{c.slider("option","disabled",e)}));e.on_message("set_focus",(()=>t.find(".ui-slider-handle").focus()))}))}))}l.pre_cache(e,["min_value","max_value","step","range_type","orientation","height","width","handle_color","range_area_color","border_color","background_color"]);e.autorun((()=>{var r,o;let d;if(e.get_styleable_static_property("range_type")==="range"){d="values"}else{d="value"}const p={};for(const t of["min_value","max_value","step","range_type","orientation","height","width","handle_color","range_area_color","border_color","background_color"]){p[t]=l.evaluate_property(e,t)}const _={min:(r=p.min_value)!=null?r:0,max:(o=p.max_value)!=null?o:9,step:p.step,range:p.range_type==="range",orientation:p.orientation,slide:(t,r)=>{n((()=>{e.message("user_change",c.slider(d))}));return true},stop:(t,r)=>{n((()=>{e.message("user_submit",c.slider(d))}));return true}};if(!e.thumbnail_mode()||u()){for(const e in _){const t=_[e];c.slider("option",e,t)}}const f={"margin-left":3,"margin-right":3,cursor:l.evaluate_property(e,"disabled")?"default":"pointer",background:p.background_color,"border-color":p.border_color};const h={cursor:l.evaluate_property(e,"disabled")?"default":"pointer",outline:"none","border-color":p.border_color};if(p.orientation==="horizontal"){f.height=p.height-16;f.width=p.width-23;h.top=-8;h.height=p.height-1;h.width=19;c.find(".ui-slider-range").css({height:"100%"})}else{f.width=p.width-22;f.height=p.height-20;h.width=p.width-11;h.height=19;c.find(".ui-slider-range").css({width:"100%"})}h.background=p.handle_color;if(p.range_type==="range"){c.find(".ui-slider-range").css({background:p.range_area_color})}c.css(f);c.find(".ui-slider-handle").css(h);i.turn();s.register_tab_index_listener(e,(e=>{t.find(".ui-slider-handle").attr("tabindex",e)}));if(e.thumbnail_mode()&&!u()){return}a.input_change_autorun(e,(e=>{if(d==="values"&&e==null){e=[]}c.slider(d,e)}))}))}))}}}).call(this)}).call(this,e("timers").setImmediate)},{"../../../../constants/runmode":83,"../../../../lang/evaluation/element_eval":690,"../../../../u":823,"../../../property_applications":412,"../../core_elements_utilities/element_utils":286,"../../shared/inputs":364,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,timers:2334}],348:[function(e,t,n){"use strict";const r=e("../../../../lang/appquery");const i=e("../../../property_applications");const s=e("../../../../lib");const o=e("./shared/text_elements");const a=e("../../../../lang/evaluation/element_eval");t.exports={property_applications:[new i.MinWidth],attempt_size_only_draw(e){if(e.run_mode()||e.responsive_mode()){if(s().bubble_version()>=4&&!e.is_visible()){if(o.text_should_stretch_vertically(e)){o.set_text_height_to_invisibility_state(e);return false}}}return true},initialize(e){const t=e.get_canvas();this.attempt_size_only_draw(e);e.autorun((()=>{if(r.get_public_setting("bubble_version")>=10){i.apply_css_style(t,{"white-space":"pre-wrap"})}else{i.apply_css_style(t,{"white-space":""})}}));e.wait_for_visible_lite((()=>{var n,r;let i;if(e.edit_mode()||e.responsive_mode()){i="letter";if(e.responsive_mode()){t[0].style.overflow="hidden"}}else{i="words";t[0].style.overflow="visible"}const l=e.get_static_property("stretch_to_fit");const c=e.get_static_property("cut_off_content");a.pre_cache(e,["text","font_size","padding_vertical","line_height","rotation_angle"]);s().bv().apply_dynamic_properties_text(e);if(e.edit_mode()||e.thumbnail_mode()||(n=e.element.root())!=null&&n.use_responsive_algorithm()&&c||!((r=e.element.root())!=null&&r.use_responsive_algorithm())&&!l){o.apply_dotdotdot(e,i)}if(e.responsive_mode()){t[0].style["pointer-events"]="none"}}))},additional_data:{notify_width(e,t){e.state("notify_width",t)}}}},{"../../../../lang/appquery":651,"../../../../lang/evaluation/element_eval":690,"../../../../lib":741,"../../../property_applications":412,"./shared/text_elements":354}],349:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("../../../../u");const i=e("../../../../constants/known_plugins");const s=e("../../../property_applications");const o=e("../../../../services/shared/plugin_registry");const a=e("../../shared/video_elements");const l=e("../../shared/image_utils");const c=e("../../../../lang/evaluation/element_eval");let u=r.MakeKey(null,"always turned");u.turn();function d(e,t){const n=r.MakeKey(null,"next video");r.WaitFor(u,(()=>setTimeout((()=>{if(!(t!=null&&t.is_destroyed())){e()}n.turn()}),10)));u=n}t.exports={property_applications:[new s.MinWidth],additional_data:{notify_width(e,t){l.keep_proportions(e,t,true)}},initialize(e){e.wait_for_visible_lite((()=>{const t=e.get_canvas();e.setTimeout((()=>{c.pre_cache(e,["video_source","video_id","autoplay","control_color_vimeo","width","height","padding_horizontal","padding_vertical","loop","auth_token"]);const n={};e.autorun((()=>{let l,u,p,_;const f={};const h={};for(u of["video_source","video_id","autoplay","control_color_vimeo","width","height","padding_horizontal","padding_vertical","loop","auth_token"]){h[u]=c.evaluate_property(e,u);if(h[u]!==n[u]){f[u]=h[u];n[u]=h[u]}}h.available_width=h.width-2*h.padding_horizontal-s.calculate_border_width(e);h.available_height=h.height-2*h.padding_vertical-s.calculate_border_height(e);for(u of["available_width","available_height"]){if(h[u]!==n[u]){f[u]=h[u];n[u]=h[u]}}let m=`<iframe allow="autoplay; fullscreen" width="${h.available_width}" height="${h.available_height}" `;if(a.should_block_cookies()){m+=' sandbox="allow-scripts" '}if(h.video_source==="youtube"){var g;if(((g=h.video_id)==null?void 0:g.indexOf)!=null&&h.video_id.indexOf("watch?v=")!==-1){h.video_id=h.video_id.split("watch?v=")[1]}_="//www.youtube.com/embed/"+h.video_id+"?rel=0";if(h.autoplay&&e.run_mode()){_+="&autoplay=1"}if(h.loop&&e.run_mode()){_+="&loop=1&playlist="+h.video_id}m+=' frameborder="0" allowfullscreen modestbranding="1" autohide="1"'}if(h.video_source==="vimeo"){var v;if(((v=h.video_id)==null?void 0:v.indexOf)!=null&&h.video_id.indexOf("https://vimeo.com/")!==-1){h.video_id=h.video_id.split("https://vimeo.com/")[1]}const t=r.rgb_to_hex(h.control_color_vimeo).code.slice(1);_="//player.vimeo.com/video/"+h.video_id+"?title=0&byline=0&portrait=0&color="+t;if(h.autoplay&&e.run_mode()){_+="&autoplay=1"}if(h.loop&&e.run_mode()){_+="&loop=1"}m+=' frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'}if(h.video_source===i.ZIGGEO){const e=o.get_hardcoded_plugin(i.ZIGGEO);p=h.auth_token||(e==null?void 0:e.get_key(e.key_for_html_header));if(p){var b,y,w;l=$("<ziggeoplayer/>");l.attr({video:(b=h.video_id)!=null?b:"no_video",application:p,auth:"true",width:"100%",height:"100%",autoplay:(y=h.autoplay)!=null?y:"false",loop:(w=h.loop)!=null?w:"false",theme:"modern"});const e=l[0].outerHTML.replace(/"/g,"'");m+=` frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen\n                                style='overflow:hidden'\n                                srcdoc="\n<html style='overflow:hidden'>\n<head style='overflow:hidden'>\n<meta http-equiv='Content-Security-Policy' content='upgrade-insecure-requests'>\n<link rel='stylesheet' href='https://assets.ziggeo.com/v2-stable/ziggeo.css' />\n<script src='https://assets.ziggeo.com/v2-stable/ziggeo.js'><\/script>\n</head>\n<body style='margin:0px'>\n${e}\n</body>\n</html>\n"`}else{_=`https://ziggeo.io/p/${h.video_id}`;m+=`height="${h.width}"\nframeborder="0"\nscrolling="no"\nreferrerpolicy="no-referrer"\nallowspeakers ${h.autoplay?"allowautoplay":""} allowfullscreen\nallow="${h.autoplay?"autoplay *; ":""}  fullscreen *"\nstyle="width:${h.width}px;height:${h.height}px" `}}m+="></iframe>";if(h.video_source!=="ziggeo"||!p){l=$(m);l.attr("src",_)}let x=h.video_source!=="ziggeo";const j={width:true,height:true,available_width:true,available_height:true};for(const e in f){if(j[e]){continue}x=false;break}if(e.run_mode()){if(x){t.children().attr({width:h.available_width,height:h.available_height});return}if(h.video_id){d((()=>{t.empty();t.append(l)}),e)}else{t.empty()}}else{t.empty();t.append(`<img style="width: ${h.available_width}px; height: ${h.available_height}px;" src="//s3.amazonaws.com/appforest_uf/f1665093563671x395094029933674050/video.png"></img>`)}}))}),20)}))}}},{"../../../../constants/known_plugins":72,"../../../../lang/evaluation/element_eval":690,"../../../../services/shared/plugin_registry":784,"../../../../u":823,"../../../property_applications":412,"../../shared/image_utils":363,"../../shared/video_elements":374,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],350:[function(e,t,n){"use strict";const r=n;const i=e("../../../../safe_require");i.safe_register("./core/core_elements/legacy/responsive_v0",r);const s=e("../../../property_applications");const o={Page:e("./Page"),Text:e("./Text"),Button:e("./Button"),Icon:e("./Icon"),Link:e("./Link"),Image:e("./Image"),Shape:e("./Shape"),Alert:e("./Alert"),Video:e("./VideoComponent"),HTML:e("./HTML"),GoogleMap:e("./GoogleMaps"),Group:e("./Group"),RepeatingGroup:e("./RepeatingGroup"),Popup:e("./Popup"),FloatingGroup:e("./FloatingGroup"),GroupFocus:e("./GroupFocus"),GroupWithFocus:e("./GroupWithFocus"),Input:e("./Input"),MultiLineInput:e("./MultiLineInput"),Checkbox:e("./Checkbox"),Dropdown:e("./Dropdown"),AutocompleteDropdown:e("./AutocompleteDropdown"),RadioButtons:e("./RadioButtons"),SliderInput:e("./SliderInput"),DateInput:e("./DateInput"),PictureInput:e("./PictureInput"),FileInput:e("./FileInput")};r.get_element_modifications=e=>o[e];r.set_legacy_element_modifications=function(e,t){var n;(n=t)!=null?n:t={property_applications:[new s.MinWidth]};o[e]=t}},{"../../../../safe_require":777,"../../../property_applications":412,"./Alert":323,"./AutocompleteDropdown":324,"./Button":325,"./Checkbox":326,"./DateInput":327,"./Dropdown":328,"./FileInput":329,"./FloatingGroup":330,"./GoogleMaps":331,"./Group":332,"./GroupFocus":333,"./GroupWithFocus":334,"./HTML":335,"./Icon":336,"./Image":337,"./Input":338,"./Link":339,"./MultiLineInput":340,"./Page":341,"./PictureInput":342,"./Popup":343,"./RadioButtons":344,"./RepeatingGroup":345,"./Shape":346,"./SliderInput":347,"./Text":348,"./VideoComponent":349}],351:[function(e,t,n){"use strict";const r=e("../../../../../u");const i=n;i.resize_container_width=function(e,t){function n(){var n;if((n=e.element.root())!=null&&n.use_responsive_algorithm()){var i;return(i=r.real_inner_width(e.get_canvas()))!=null?i:t}else{return e.element.get_width()}}const i=n();if(i){var s;(s=e.child_container)==null?void 0:s.resize_width(i)}e._set_immediate((()=>{r.wait_for_updates((()=>{const t=n();if(t&&Math.abs(t-i)>1){var r;(r=e.child_container)==null?void 0:r.resize_width(t)}}))}))}},{"../../../../../u":823}],352:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=e("../../../../../u");const i=e("../../../../../lang/elements");const s=n;const o=15;s.group_collapse_definition={do_show(e,t,n,s,a){var l;e._is_visible_me=true;e.ensure_drawn();const c=e.get_canvas();const u=e.group_slide_timeout!==null;c[0].style.display="";e._update_visible();if(!e.run_mode()){return}(l=c.velocity)==null?void 0:l.call(c,"stop");if(e.group_slide_timeout!=null){e.clearTimeout(e.group_slide_timeout);e.group_slide_timeout=undefined}const d=e.get_static_property("collapse_when_hidden");function p(){var t;return(t=e.state("actual_height"))!=null?t:e.element.get_height()}if(d&&!s){if(e.get_static_property("collapse_animation")&&!a){switch(e.get_static_property("animation_type")){case"slide":{e.canvas.css("overflow","hidden");let _=p();let f=_/o;let h=u?parseInt(c.css("height").replace("px","")):0;e.set_height(h);function m(){const t=p();if(t!==_){_=t;f=_/o}if(h>=t){e.set_height(t);e.canvas.css("overflow","visible");e.group_slide_timeout=undefined;return}h+=f;e.set_height(h);e.group_slide_timeout=e.setTimeout((()=>m()),1)}m();break}case"fade":{c[0].style.opacity=0;e.set_height(p());r.velocity(c,"fadeIn",{duration:400});e.canvas.css("overflow","visible")}}}else{e.set_height(p())}}else if(s){e.set_height(p());i.perform_animate_in(e,t,n,true)}else{e.set_height(p())}},do_hide(e,t,n,i,s){var a;e.ensure_drawn();const l=e.get_canvas();if(!e.run_mode()){e._is_visible_me=false;e._update_visible();l[0].style.display="none";return}(a=l.velocity)==null?void 0:a.call(l,"stop");if(e.group_slide_timeout!=null){e.clearTimeout(e.group_slide_timeout);e.group_slide_timeout=undefined}const c=e.get_static_property("collapse_when_hidden");const u=parseInt(l.css("height").replace("px",""));if(c&&!i){if(e.get_static_property("collapse_animation")&&!s){switch(e.get_static_property("animation_type")){case"slide":{e.canvas.css("overflow","hidden");const m=u/o;let g=u;function v(){if(g<=0){e.set_height(0);l[0].style.display="none";e.canvas.css("overflow","visible");e.group_slide_timeout=undefined;return}g-=m;e.set_height(g);e.canvas.css("height",g);e.group_slide_timeout=e.setTimeout((()=>v()),1)}v();break}case"fade":{r.velocity(l,"fadeOut",{duration:400,complete_cb(){l[0].style.display="none";return e.set_height(0)}});break}}}else{e.set_height(0);l[0].style.display="none"}}else if(i){var d,p,_,f,h;(d=e._transforms)!=null?d:e._transforms={};(_=(p=e._transforms).initial_transform)!=null?_:p.initial_transform=l[0].style.transform;(h=(f=e._transforms).initial_opacity)!=null?h:f.initial_opacity=l[0].style.opacity;e.set_animating(true);r.velocity(l,t.animation,{duration:n.duration,complete_cb(){e.set_animating(false);l[0].style.transform=e._transforms.initial_transform;l[0].style.opacity=e._transforms.initial_opacity;e._transforms=undefined;if(c){e.set_height(0)}}})}else{l[0].style.display="none"}e._is_visible_me=false;return e._update_visible()}}},{"../../../../../lang/elements":680,"../../../../../u":823,"core-js/modules/es.string.replace.js":1121}],353:[function(e,t,n){"use strict";const r=n;const i=e("../../../../../lang/evaluation/element_eval");const s=e("../../../../property_applications");const o=e("../../../../../safe_require");o.safe_register("./core/core_elements/legacy/responsive_v0/shared/icons",r);r.calculate_font_size_for_fontawesome=function(e){e.autorun((()=>{var t;const n=i.evaluate_property(e,"height");const r=(t=e.state("notify_width"))!=null?t:i.evaluate_property(e,"width");function o(){let t=Math.min(n,r);const i=Math.max(s.calculate_border_height(e),s.calculate_border_width(e));if(i!==0){t-=i+5}return t}e.get_canvas()[0].style["font-size"]=o()+"px"}))}},{"../../../../../lang/evaluation/element_eval":690,"../../../../../safe_require":777,"../../../../property_applications":412}],354:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.promise.finally.js");const r=n;const i=e("../../../../property_applications");const s=e("../../../core_elements_utilities/element_utils");const o=e("../../../../../u");const a=e("../../../../../lang/elements");const l=e("../../../../../webfonts");const c=e("../../../../../logger");const u=e("../../../../../lang/evaluation/element_eval");const d=e("../../../../../lang/evaluation/element_props");const{PADDING_VERSION:p}=e("../../../../../constants/elements");const _=e("../../../shared/text_elements");r.wait_for_img_tags_loaded=function(e,t){if(!(e instanceof $)){t();return}const n=e.find("img").not((function(){return this.complete}));if(!n.length){t();return}let r=n.length;n.on("load",(()=>{r--;if(r===0){t()}}))};r.apply_dynamic_properties_text=function(e){const t=e.get_canvas();const n=e.get_static_property("shrink_if_less_high");let c=null;let f=null;let h=null;e.autorun((()=>{e.state("notify_width");const m=["text","font_size","padding_vertical","line_height","rotation_angle","link_color","nofollow"];const g={};for(const y of m){g[y]=u.evaluate_property(e,y)}g.notify_width=e.state("notify_width");g.font_face=d.get_font_face(e);c=g;if(e.is_animating()){return}if(e.run_mode()||e.responsive_mode()){var v;if((v=e.element.root())!=null&&v.use_responsive_algorithm()&&e.element.element_version(true)<p){var b;t[0].style["padding-bottom"]=((b=g.padding_vertical)!=null?b:0)+"px"}if(r.text_should_stretch_vertically(e)){if(!e.is_visible()){r.set_text_height_to_invisibility_state(e);return}if(JSON.stringify(g)===f){if(h){e.set_height(h)}return}let w=t.find(".content");if(w.length===0){w=o.div("content",t)}const x=o.div("content-for-img");function j(i){if(e.is_animating(true)){i();return}const s=e.is_visible(true);if(!s){i();return}f=JSON.stringify(c);_.apply_text(e,w,c);r.wait_for_img_tags_loaded(w,(()=>{const r=t.outerHeight()-t.height();if(g.rotation_angle!=null&&![0,180].includes(g.rotation_angle)){i();return}const s=w.height();const o=e.element.get_height();if(n){h=s+r;e.set_height(h)}else{h=Math.max(o,s+r);e.set_height(h)}i()}))}const A=a.add_layout_resizing_key();o.wait_for_updates((()=>{let t;if(o.has_bbcode(c.text)&&!e.get_static_property("no_bbcode")&&c.text.indexOf("[/img]")>-1){_.apply_text(e,x,c);t=x}else{t=null}r.wait_for_img_tags_loaded(t,(()=>{let{font_family:e}=l.get_quoted_face_and_variant(g.font_face);const{font_size:t}=g;j((()=>{var n;if((n=e)!=null&&n.includes("var(")){e=l.font_token_to_font(e).font_family}r.wait_for_font_loaded(`${t}px ${e}`,(e=>{if(e){A.turn();return}j((()=>A.turn()))}))}))}))}))}else{if(e.is_visible()){i.apply_css_style(t,{"word-break":"break-word"});_.apply_text(e,t,g)}}}else{_.apply_text(e,t,g);s.do_add_an_invisible_div_on_the_top(e)}}))};r.wait_for_font_loaded=function(e,t){if(e==null){t(true);return}if(document.fonts==null){t(true);return}if(document.fonts.check(e)){t(true);return}const n=document.fonts.load(e);if(n.finally!=null){n.finally((()=>t(false)))}else if(n.then!=null){n.then((()=>t(false))).catch((()=>t(false)));if(Math.random()>.99){var r,i;c.info("odd missing Promise.prototype.finally",{type:typeof n,this_then:n.then.toString(),finally:Promise==null?void 0:(r=Promise.prototype.finally)==null?void 0:r.toString(),then:Promise==null?void 0:(i=Promise.prototype.then)==null?void 0:i.toString()})}}else{var s;c.info("document.font polyfill but not Promise",{type:typeof n,then:Promise==null?void 0:(s=Promise.prototype.then)==null?void 0:s.toString()});t(true)}};r.apply_dotdotdot=function(e,t){const n=e.get_canvas();if(e.thumbnail_mode()){n.css("overflow","hidden");return}e.setTimeout((()=>n.dotdotdot({wrap:t,callback:(t,r)=>{o.run_once(30,(()=>{var t,n;return e.edit_mode()&&r.length!==0&&((t=e.canvas)==null?void 0:(n=t.text)==null?void 0:n.call(t))&&e.canvas.text().trim()===""&&u.evaluate_property(e,"text")!==""}),((t,r)=>{if(t){c.log(t);return}if(r){const t=o.div("dots-placeholder",n);i.apply_css_style(t,{"line-height":0,"font-size":"20px","text-align":e.get_static_property("font_alignment",true)});t.text("............")}}))}})),1);u.pre_cache(e,["width","height","font_size","padding_vertical","line_height","word_spacing","letter_spacing"]);return e.autorun((()=>{var t;for(const t of["width","height","font_size","padding_vertical","line_height","word_spacing","letter_spacing"]){u.evaluate_property(e,t)}e.element.get_style_id();(t=n.trigger)==null?void 0:t.call(n,"update.dot")}))};r.text_should_stretch_vertically=function(e){var t;const n=(t=e.element.root())==null?void 0:t.use_responsive_algorithm();const r=e.get_static_property("cut_off_content");const i=e.get_static_property("stretch_to_fit");return n&&!r||!n&&i};r.set_text_height_to_invisibility_state=function(e){if(e.get_static_property("shrink_if_less_high")){e.set_height(0)}else{e.set_height(e.element.get_height())}}},{"../../../../../constants/elements":61,"../../../../../lang/elements":680,"../../../../../lang/evaluation/element_eval":690,"../../../../../lang/evaluation/element_props":691,"../../../../../logger":744,"../../../../../u":823,"../../../../../webfonts":858,"../../../../property_applications":412,"../../../core_elements_utilities/element_utils":286,"../../../shared/text_elements":373,"core-js/modules/es.promise.finally.js":1117,"core-js/modules/web.dom-collections.iterator.js":1123}],355:[function(e,t,n){"use strict";const r=e("../../property_applications");const i=e("../../../lang/elements");const s=e("../../../u");const o=e("../../../lib");const a=e("./responsive_v0");const l=n;const c={do_show(e,t,n,r){var s;e._is_visible_me=true;e.ensure_drawn();const o=e.get_canvas();(s=o.velocity)==null?void 0:s.call(o,"stop",true);if(!r){e._display_me();e._update_visible()}else{i.perform_animate_in(e,t,n,true)}},do_hide(e,t,n,r){var i;const o=e.get_canvas();(i=o.velocity)==null?void 0:i.call(o,"stop",true);if(!r){e._hide_me();e._is_visible_me=false;e._update_visible()}else{var a,l,c,u,d;(a=e._transforms)!=null?a:e._transforms={};(c=(l=e._transforms).initial_opacity)!=null?c:l.initial_opacity=o[0].style.opacity;(d=(u=e._transforms).initial_transform)!=null?d:u.initial_transform=o[0].style.transform;e._is_visible_me=false;e._update_visible();e.set_animating(true);const r={duration:n.duration,complete_cb(){e.set_animating(false);o[0].style.transform=e._transforms.initial_transform;o[0].style.opacity=e._transforms.initial_opacity;e._transforms=undefined}};n.visibility="hidden";s.velocity(o,t.animation,r)}}};const u={position_canvas:1,do_show:0,do_hide:0,get_container_width:0,attempt_size_only_draw:0,register:0};l.wrap_core_element=function(e){var t;const n=a.get_element_modifications(e.plugin_name);if((n==null?void 0:n.additional_data)!=null){s.extend(e,n.additional_data)}const i=(e,t)=>(e==null?void 0:e.is_responsive_v1())&&(e.E_object().uses_css_responsive||["position_canvas","do_show","do_hide"].includes(t));const l=e.property_applications;e.property_applications=function(t){let s;if(typeof l==="function"){s=l(t)}else{s=l}s=s.slice();if(!e.uses_css_responsive){s.push(new r.ResponsiveElement(t))}if(i(t,"property_applications")){return s}else{let e;if(typeof(n==null?void 0:n.property_applications)==="function"){e=n==null?void 0:n.property_applications(t)}else{e=n==null?void 0:n.property_applications}if(e!=null){return s.concat(e)}return s}};function d(t,r){var a;const l=e[t];const u=(a=n==null?void 0:n[t])!=null?a:l;if(l!=null||u!=null){e[t]=function(){var n;const a=arguments[r];const d=(n=a.element)!=null?n:a;if((!s.on_server()||o().force_responsive_version)&&i(d,t)){var p;if(t==="position_canvas"&&a.responsive_mode()){return}return(p=l!=null?l:c[t])==null?void 0:p.apply(e,arguments)}else{return u.apply(e,arguments)}}}}for(const e in u){const t=u[e];d(e,t)}const p=e.initialize;const _=(t=n==null?void 0:n.initialize)!=null?t:p;e.initialize=function(t){if(i(t.element,"initialize")){p.call(e,t)}else{_.call(e,t)}if(t.element.is_responsive_v1()&&!t.element.E_object().uses_css_responsive){if(!t.thumbnail_mode()){if(typeof ResizeObserver!=="undefined"&&ResizeObserver!==null){const e=new ResizeObserver((e=>{const{width:n}=e[0].contentRect;t.notify_width(n)}));e.observe(t.canvas[0]);t.on_destroy((()=>{e.disconnect()}))}t.notify_width(t.canvas.width())}t.autorun((()=>{t.canvas.css({height:t.element.get_height()})}))}};return e}},{"../../../lang/elements":680,"../../../lib":741,"../../../u":823,"../../property_applications":412,"./responsive_v0":350}],356:[function(e,t,n){"use strict";const r=n;const i=e("../../../u/client/b_ui");r.structure_fixed_aspect_ratio=function(e,t){const n=i.div("",t);e.autorun((()=>{if(e.element.has_fixed_aspect_ratio()){const t=e.element.get_static_property("aspect_ratio_height")/e.element.get_static_property("aspect_ratio_width");n.css({position:"relative","padding-top":t*100+"%"});n.show()}else{n.hide()}}))};r.element_css=function(e){return{position:e?"absolute":"relative",top:0,left:0,display:"block","margin-top":"","margin-left":"",width:"100%",height:"100%"}}},{"../../../u/client/b_ui":813}],357:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.unwatchClip=a;n.watchClip=o;e("core-js/modules/web.dom-collections.iterator.js");const r=new WeakMap;let i;function s(e){for(const t of e){const e=r.get(t.target);if(e!=null){t.removedNodes.forEach((t=>{if(t instanceof Element)e.unobserve(t)}));t.addedNodes.forEach((t=>{if(t instanceof Element)e.observe(t)}))}}}function o(e,t){if(typeof MutationObserver!=="undefined"&&typeof IntersectionObserver!=="undefined"){var n;if(r.has(e))return;const o=new IntersectionObserver(((n,i)=>{if(n.some((e=>e.boundingClientRect.height>0&&e.intersectionRatio<1))){i.disconnect();r.delete(e);t()}}),{root:e,threshold:[0,1]});r.set(e,o);e.childNodes.forEach((e=>{if(e instanceof Element)o.observe(e)}));(n=i)!=null?n:i=new MutationObserver(s);i.observe(e,{childList:true})}else{t()}}function a(e){var t;(t=r.get(e))==null?void 0:t.disconnect();r.delete(e)}},{"core-js/modules/web.dom-collections.iterator.js":1123}],358:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("../../../u");const s=e("../../../db/hydrate");const o=e("../../../lib");const a=e("../../../lang/evaluation/element_eval");const l=e("../../../safe_require");l.safe_register("./core/core_elements/shared/dropdowns",r);r._get_raw_btype_dropdown=function(e){if(e.get_static_property("choices_style")==="static"){if(!o().is_edit_mode()){const t=e.get_static_property("computed_value");if(t!=null){return t}}const t=c(e.get_static_property("choices",true));if(o().is_edit_mode()){e.set_property("computed_value",t)}return t}else if(e.get_static_property("dynamic_type")){return e.get_static_property("dynamic_type")}return"text"};function c(e){if(typeof e!=="string"){e=""}for(let t of e.split("\n").map((e=>e.trim()))){if(t.length>0){if(!["0","00","000","0000"].includes(t)){if(t.indexOf("0.")!==0&&t.indexOf("00.")!==0&&t.indexOf("000.")!==0){t=t.replace(/^0+/g,"")}t=t.replace(/(\.[0-9]*?)0+$/,"$1");t=t.replace(/\.$/,"")}if(![t,"0"].includes(String(o().locale().parse_float(t)))){return"text"}}}return"number"}r._get_raw_choice_list_dropdown=function(e,t){const n=t._get_raw_btype(e.element);if(a.evaluate_property(e,"choices_style")==="static"){let t;const r=a.evaluate_property(e,"choices");if(typeof r!=="string"){t=[]}else{t=r.split("\n").map((e=>e.trim())).filter((e=>e));if(n==="number"){t=t.map((e=>o().locale().parse_float(e)))}}return o().db_instance().static_list(n,t)}else{const t=a.evaluate_property(e,"data_source");if(typeof(t==null?void 0:t.get_children)==="function"){if(!t.contains){throw new i.UnexpectedError("Get children but no contains: "+t.constructor.name+" "+t.constructor)}return t}else{return o().db_instance().static_list(n,[])}}};r._get_display_option=function(e){if(a.evaluate_property(e,"choices_style")==="static"){return e=>e}else{return t=>{const n=e.get_injected_context(t,this.get_injected_value(e.element));return a.eval_property_with_states(e.element,"option_display_expression",n)}}};r.use_injected_datasource=(e,t)=>t.path().indexOf(t.owner.property(e).path())===0;r.rehydrate_dropdown_value=function(e){if(e===""){return null}else{var t;return(t=s.rehydrate_tree(o().db_instance(),e))!=null?t:null}}},{"../../../db/hydrate":429,"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../safe_require":777,"../../../u":823,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],359:[function(e,t,n){"use strict";const r=n;const i=e("./groups");const s=e("../../../lib");r.floating_field_names={floating_reference:{default:"top",no_states:true},floating_reference_horizontal:{default:"none",no_states:true},floating_reference_horizontal_resp:{default:"left",no_states:true},float_zindex:{default:"front",no_states:true},parallax:{default:1,no_states:true}};r.floating_group_fields=e=>[{name:"floating_reference",caption:"Vertically float relative to",editor:"Dropdown",set:s().sets.get_set("Object")({top:"Top",bottom:"Bottom",both:"Both",none:"Nothing"}),pretty:{section:"FloatingReference",dropdown_width:"medium"}},{name:"floating_reference_horizontal",caption:"Horizontally float relative to",editor:"Dropdown",set:s().sets.get_set("Object")({left:"Left",right:"Right",none:"Nothing"}),condition(e){var t;return!((t=e.root())!=null&&t.use_responsive_algorithm())},pretty:{section:"FloatingReference",dropdown_width:"medium"}},{name:"floating_reference_horizontal_resp",caption:"Horizontally float relative to",editor:"Dropdown",set:s().sets.get_set("Object")({left:"Left",right:"Right"}),condition(e){var t;return(t=e.root())==null?void 0:t.use_responsive_algorithm()},pretty:{section:"FloatingReference",dropdown_width:"medium"}},{name:"float_zindex",caption:"Floating zindex",editor:"Dropdown",set:s().sets.get_set("Object")({front:"Above elements",back:"Beneath the page"}),pretty:{section:"FloatingReference"}},{name:"parallax",caption:"Parallax effect factor",numerical_step:.1,editor:"Dropdown",set:s().sets.get_set("Numeric")([0,.2,.4,.6,.8,1,1.2,1.4,1.6,1.8,2]),condition(e){return e.get_static_property("float_zindex")==="back"},pretty:{section:"FloatingReference"}},{name:"floating_information",label_text:"When a floating element is beneath elements, it will only visible if the page background is transparent",editor:"Label",condition(e){return e.get_static_property("float_zindex")==="back"},pretty:{section:"FloatingReference"}}];r.check_error_floating_group=function(e,t){if(!["Page","CustomDefinition"].includes(e.parent().type())){let n;switch(e.parent().type()){case"Page":n="page";break;case"CustomDefinition":n="reusable element";break}t(e.display()+": Floating Group must be right under the "+n+". Instead it is under "+e.parent().display());i._check_for_errors_datasource_set_to_self(e,"get_group_data",t)}}},{"../../../lib":741,"./groups":360}],360:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../u");const s=e("../core_elements_utilities/element_workflows");const o=e("../../../lang/appquery");const a=e("../../property_applications");const l=e("../legacy/responsive_v0/shared/containers");const c=e("../../../safe_require");c.safe_register("./core/core_elements/shared/groups",r);r.container_field_names={group_type:{no_states:true},data_source:{}};r.state_value_helper_for_group=function(e,t){if(t==="group_data"){return e.get_static_property("group_type")}};r.group_field_names={collapse_animation:{no_states:true,default:false},animation_type:{no_states:true,default:"slide"},overflow_scroll:{no_states:true,default:false}};r.group_element_definition={category:"containers",defaults:{bgcolor:"#FFFFFF",background_style:"bgcolor",width:400,height:250},updated_default_sizing:{width:280,height:280},field_names:i.extend({collapse_when_hidden:{no_states:true,default:false}},r.group_field_names,s.start_workflow_field_names,r.container_field_names),property_applications(e){return[new a.Dimensions,new a.Background,new a.Border,new a.BoxShadow,new a.ResponsiveContainer(e),new a.ResponsiveElement(e),new a.PaddingFields,new a.Opacity]},get_html(e){return"<div></div>"},change_cursor_style_if_clickable:true,can_have_children(){return true},get_children_canvas(e){return e.get_canvas()},is_container:true,get_state_value(e,t){return r.state_value_helper_for_group(e,t)},notify_width(e,t){i.WaitFor(e.get_children_drawn_key(),(()=>{l.resize_container_width(e,t)}))},get_min_width(e){return 0},events:["ButtonClicked"],is_input:false,add_an_invisible_div_on_the_top:false};r._check_for_errors_datasource_set_to_self=function(e,t,n){function r(i,s,a){var l,c,u,d,p;let _;(l=s)!=null?l:s=0;if(s>100){n(`${e.display()} is referencing an invalid data source`);return}function f(){if(a){return" (in conditions)"}else{return""}}const h=i.property("data_source");const m=h.find_expressions("GetElement.element_id="+e.id()).concat(h.find_expressions("ThisElement"));for(_ of m){var g;if(((g=_.raw().next)==null?void 0:g.name)===t){n(e.display()+": Data source cannot refer to the same element"+f());return}}_=h.raw();if(((c=_)==null?void 0:c.type)==="GetElement"){var v;if(((v=_.next)==null?void 0:v.name)===t){if(_.properties.element_id===e.id()){if(s===0){n(e.display()+": Data source cannot refer to the same element"+f())}else{n(e.display()+": Data source cannot use an element that refers to the current element"+f())}}else if(_.properties.element_id){r(o.element(_.properties.element_id),s+1,a)}}}else if(((u=_)==null?void 0:u.type)==="ThisElement"&&((d=_.next)==null?void 0:d.name)===t){n(e.display()+": Data source cannot refer to the same element"+f())}else if(((p=_)==null?void 0:p.type)==="ElementParent"){let t;if(a){t=i.context_element().parent()}else{t=i.parent()}if(t.id()===e.id()){n(e.display()+": Data source cannot use an element that refers the the current element"+f())}else{r(t,s+1,a)}}}r(e);for(const t of e.states()){r(t,0,true)}}},{"../../../lang/appquery":651,"../../../safe_require":777,"../../../u":823,"../../property_applications":412,"../core_elements_utilities/element_workflows":288,"../legacy/responsive_v0/shared/containers":351,"core-js/modules/web.dom-collections.iterator.js":1123}],361:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=new Set;const s=e=>{for(const e of i){if(!e.canvas[0].matches(":hover")&&e.element.type()!=="TableMainAxis"){e.state("is_hovered",false);i.delete(e)}}if(i.size===0)window.removeEventListener("mousemove",s)};r.setup_hover=function(e){const t=e.canvas[0].matches!=null;e.canvas.mouseenter((()=>{e.state("is_hovered",true);if(t){if(i.size===0)window.addEventListener("mousemove",s);i.add(e)}}));e.canvas.mouseleave((()=>{e.state("is_hovered",false);i.delete(e)}));const n=t&&e.canvas[0].matches(":hover");e.state("is_hovered",n);return n}},{"core-js/modules/web.dom-collections.iterator.js":1123}],362:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=n;const i=e("../../../constants/icons_content");const s=e("../../../safe_require");s.safe_register("./core/core_elements/shared/icons",r);function o(){let e=$("#bubble-icon-retriever")[0];if(e!=null){return e}e=$('<div id="bubble-icon-retriever" style="display: none; position: absolute;"></div>')[0];document.body.appendChild(e);return e}let a=null;function l(){const e=document.createElement("iframe");document.body.appendChild(e);const t=e.contentWindow.getComputedStyle;e.remove();return t}function c(){var e;(e=a)!=null?e:a=l();return a.apply(window,arguments)}function u(e){const t=o();t.setAttribute("class",e);return c(t,":before").content.replace(/"/g,"")}r.get_static_icon=function(e){return i.ICONS_CONTENT[e]};const d={};r.get_icon_svg=function(e,t){var n;const i=(n=d[t])!=null?n:d[t]=u(t);return r.get_svg_canvas(e,i)};r.get_svg_canvas=function(e,t,n){var r;(r=n)!=null?r:n=-18;const i=$(`<svg viewbox="0 ${n} 50 50">\n    <text class="${e}" x="50%" y="50%" text-anchor="middle" style="font-size: 50px;fill: currentColor;">\n        ${t}\n    </text>\n</svg>`);i.css({width:"100%",height:"100%"});return i}},{"../../../constants/icons_content":70,"../../../safe_require":777,"core-js/modules/es.string.replace.js":1121}],363:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=n;const i=e("../../../u");const s=e("../../../shared/images");const o=e("../../../lang/evaluation/element_eval");const a=e("../../../client_config");const l=e("../../../imgix");const c=e("../../../lib");const u=e("../../../lang/appquery");const d=e("../../../safe_require");const p=e("../../../u/shared/b_file_shared");d.safe_register("./core/core_elements/shared/image_utils",r);r.reset_img_settings=e=>e.css({margin:"0px",width:"100%",height:"100%","object-fit":""});r.rescale_image=function(e){let{src:t,img:n,element_height:a,element_width:l,cb:c,instance:u,ref_version:d}=e;if(t.indexOf("data:image/")===0){c(n)}function p(){if(u!=null){return{element_height:o.evaluate_property(u,"height"),element_width:o.evaluate_property(u,"width")}}else{return{element_height:a,element_width:l}}}({element_height:a,element_width:l}=p());t=r.optimize_image(t,l,a);s.get_image_real_dimensions(t,(e=>{if(e.height==null){c==null?void 0:c(n);return}if(u!=null){const e=i.autorun_top((()=>u.state("src_version")));if(e!==d){return}}r.reset_img_settings(n);if(e.height/e.width>a/l){const t=e.width/e.height*a;n.css({"margin-left":(l-t)/2+"px",width:t+"px"})}else{const t=e.height/e.width*l;n.css({"margin-top":(a-t)/2+"px",height:t+"px"})}c==null?void 0:c(n)}))};r.keep_proportions=function(e,t,n){let r;if(n||e.get_static_property("keep_proportion_resize")){r=t/e.element.get_width()*e.element.get_height();e.set_height(r)}else{r=e.element.get_height()}return r};r.optimize_image=function(e,t,n,r,i,s){var o;if(typeof e!=="string"){return}if(/^data:image\//.test(e)){return e}if(/^blob:/.test(e)){return e}e=p.replace_s3_with_cdn_url(e,u.appname());if(/\.(mov|mp4|mkv|avi|flv|webm)$/i.test(e)){return e}if(t===0){t=undefined}if(n===0){n=undefined}const d=e.indexOf("https://")===0;if(e.indexOf("http://")===0){e=e.split("http://").slice(1).join("http://")}if(e.indexOf("https://")===0){e=e.split("https://").slice(1).join("https://")}if(e.indexOf("//")===0){e=e.replace("//","")}if(!(a.image_optimization_service&&e.indexOf(a.image_optimization_service)!==-1||e.indexOf("/user/iop/")!==-1)&&!((o=r)!=null&&o.force)&&l.ignore_imgix_fn(e)){if(a.user_file_cdn){e=e.replace(a.user_file_cdn,p.get_file_cdn_url(u.appname()))}}else{if(!c().is_edit_mode()){var _;const e=m((_=window)==null?void 0:_.devicePixelRatio);if(e!=null){var f;(f=r)!=null?f:r={};r.dpr=e}}e=l.get_reduced_file_url(e,t,n,r)}let h;if(d){h="https:"}else{h=c().location.parsed_url().protocol}e=h+"//"+e;return e};r.download_image=function(e,t,n){if(r.downloaded_images[e]){return n==null?void 0:n(e)}else{const s=i.img(undefined,undefined,e);s.on("load",(()=>{var t;r.downloaded_images[e]=true;n==null?void 0:n(e);s.remove();return(t=c().workflow.debugger)==null?void 0:t.get_request_size(e,"image")}));return s.on("error",(()=>{s.remove();if(n){var i;n(r.transparent_image());return(i=c().workflow.debugger)==null?void 0:i.report_error({type:"warning",instance:t,error:{message:`The image could not be loaded: ${e} .`}})}}))}};const _=.5;const f=8;const h=.25;function m(e){if(e==null){return 1}if(!(e>_)){return _}if(!(e<f)){return f}return h*Math.floor(e/h)}r.transparent_image=()=>"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";r.downloaded_images={}},{"../../../client_config":41,"../../../imgix":628,"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../safe_require":777,"../../../shared/images":796,"../../../u":823,"../../../u/shared/b_file_shared":837,"core-js/modules/es.string.replace.js":1121}],364:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("lodash/debounce");const s=e("../../../u");const o=e("../../../db/hydrate");const a=e("../../../u/shared/mode_check");const l=e("../../../db/obfuscate");const c=e("../../../logger");const u=e("../../../constants/eval");const d=e("../../core_events");const p=e("../core_elements_utilities/element_workflows");const _=e("../../../lang/appquery");const f=e("../../data_updates");const h=e("../../property_applications");const m=e("../../../constants/workflow");const g=e("../../../lib");const v=e("../../../lang/btypes");const b=e("../../status_bar");const y=e("../../../lang/evaluation/element_eval");const w=e("../../../safe_require");w.safe_register("./core/core_elements/shared/inputs",r);r.get_max_file_size_field_name={max_size:{default:50}};r.get_file_upload_condition_field_name={file_upload_condition:{}};r.type_content_format_mapping={text:["_all"],number:["int_number","float_number","currency","percentage"],geographic_address:["geographic_address"],date:["date","date_2"],file:["text"],image:["text"],number_range:[],dateinterval:[]};r.register_input_states=function(e,t,n){let i=false;function o(){if(i){c.owner_error("Circular reference evaluating the input's initial content",{element_instance:n,prop_name:"content"});return null}if(!e.get_starting_content){return null}try{i=true;return e.get_starting_content(n)}finally{i=false}}function a(){if(!n.state("has_been_changed")){n.state("value",o)}}n.autorun(a);if(n.run_mode()){if(t.includes("is_invalid")){n.state("is_invalid",(()=>!e.content_validated(n.state("value"),n)))}n.state("value_that_is_valid",(()=>{if(t.includes("is_invalid")&&n.state("is_invalid")){const e={};e[u.NV_MARKER]=true;return e}else{return n.state("value")}}));if(t.includes("display_invalid")){n.state("display_invalid",(()=>n.state("is_invalid")&&(n.state("has_been_changed")||n.state("force_display_validity"))))}n.on_message("display_validity",(()=>{n.state("force_display_validity",true)}));function l(e){if(s.compare(e,n.state("value",undefined,true))){return false}if(e===undefined){e=null}n.state("has_been_changed",true);n.state("value",e);return true}let d=false;n.on_message("user_change",(e=>{if(!l(e)){return}d=true}));function _(e){if(!l(e)){if(!d){return}}d=false;n.get_canvas().blur();n.state("is_focused",false);r.run_auto_binding(n,e);p.run_element_workflow(n,"InputChanged");g().element.emit("user_changed_input",{instance:n,val:e})}n.on_message("user_submit",(e=>{_(e)}));n.on_message("reset_input",(()=>{n.state("force_display_validity",false);if(n.state("has_been_changed")){n.state("has_been_changed",false);a()}}))}};r.input_change_autorun=(e,t)=>e.autorun((()=>{if(!e.state("has_been_changed")){t(e.state("value"))}}));r.register_focus=function(e,t){t.focus((()=>e.state("is_focused",true)));t.blur((()=>e.state("is_focused",false)))};r.get_input_parent_thing=function(e,t){var n,r,i,s,o;let a,l;const c=(n=e.parent)==null?void 0:n.call(e);if(c!=null&&c.get_static_property("group_type")){l=c.get_static_property("group_type");if(!t){a=e.parent().state("group_data")}}else if((c==null?void 0:(r=c.element)==null?void 0:r.type())==="GroupItem"){l=c.parent().get_static_property("group_type");if(!t){a=c.state("group_data")}}else if((i=(s=e.element).root)!=null&&(o=i.call(s))!=null&&o.get_static_property("page_item_type")){l=e.element.root().get_static_property("page_item_type");if(!t){a=g().pageparam.get()}}return{type:l,thing:a}};r.get_input_parent_thing_field=function(e){var t;const{type:n,thing:i}=r.get_input_parent_thing(e);if(n==null||!(i!=null&&(t=i.exists)!=null&&t.call(i))){return null}const s=e.get_static_property("bind_field");if(!s){return null}return v.get(n).get_message(s).evaluate(i)};r.do_auto_binding=function(e,t,n,r,i,a){var u;(u=a)!=null?u:a={0:{key:r,value:i}};f.update_thing(t,a);const p={appname:_.appname(),app_version:_.app_version(),temp_db:g().db_instance().cur_temp_db(),data:{type:n,items:[{id:t._id(),changes:o.dehydrate_tree(a)}]}};const h=l.encode_data(p,g().appname());const v=g().location.post("server://elasticsearch/modify",h);const w=b.show_progress_line(v);g().workflow.all_server_completed.add_promise(v);return v.callback(((n,r)=>{g().db_instance().ensure_object_updates(r);e.state("currently_binding",false);w();if(n){g().db_instance().flush(t._id());d.handle_uncaught_error({original_error:n,caught_from:m.ERROR_SOURCES.ELEMENT,cb(e){if(e){window.alert(c.human_friendly(e))}}})}if(e.supports_message("reset_input")){e.message("reset_input")}if(!n){if(e.get_static_property("show_alert_on_sucess")){return s.run_once(30,(()=>{const t=e.find_instance_by_id(e.get_static_property("alert_element"));const n=y.evaluate_property(e,"alert_message");const r=y.evaluate_property(t,"text");return{alert_instance:t,element_text:n,alert_text:r}}),((e,t)=>{if(e){c.log(e);return}const{alert_instance:n,element_text:r,alert_text:i}=t;if(n!=null){const e={fade_in:500,hold:500,fade_out:500};if(![null,undefined,""].includes(r)){e.message=r}else{e.message=i}n.message("show_alert",e)}}))}}}))};r.run_auto_binding=function(e,t,n){if(!e.get_static_property("auto_binding")){return}const i=e.get_static_property("bind_field");const o=g().workflow.all_sent_to_server.make(30,"run_aut_bonding");return s.run_once(30,(()=>{let s;const o=r.get_input_parent_thing(e);const{thing:a}=o;if(a!=null){s=a.child(i).get()}return{current_val:s,is_invalid:!n?e.state("is_invalid"):undefined,thing_type:o,val:typeof t==="function"?t():t}}),((t,s)=>{o.turn();if(t){c.log(t);return}if(!n){if(s.is_invalid){return}e.state("currently_binding",true)}const{type:a,thing:l}=s.thing_type;if(l==null){return}const{val:u}=s;const d=v.get(a).custom_type();const p=d.field(i).value();if(v.get(p).equals(s.current_val,u)){return}if(!a||l==null||!i){return}if(!n){if(e.element.E.field_names.content_format){const t=e.get_static_property("content_format");if(r.type_content_format_mapping[p][0]!=="_all"&&!r.type_content_format_mapping[p].includes(t)){return}}}return r.do_auto_binding(e,l,a,i,u)}))};r.get_disabled_field_name={disabled:{default:false}};r.get_auto_binding_field_names={auto_binding:{default:false,no_states:true},information:{no_states:true},bind_field:{no_states:true},show_alert_on_sucess:{no_states:true},alert_element:{no_states:true,optional:true},alert_message:{no_states:true,optional:true}};r.additional_field_names_for_text_inputs=s.extend({mandatory:{},limit_number_of_characters:{no_states:true,default:false},character_limit:{no_states:true}},r.get_disabled_field_name,r.get_auto_binding_field_names);r.switch_disabled_or_not=e=>y.on_property_change(e,"disabled",(t=>e.get_canvas()[0].disabled=t));r.set_character_limit_on_input=e=>y.on_property_change(e,["limit_number_of_characters","character_limit","content_format"],(t=>{let{limit_number_of_characters:n,character_limit:r,content_format:i}=t;if(n&&r&&[null,undefined,"text","numerical_ref"].includes(i)){return e.get_canvas().attr("maxlength",r)}else{return e.get_canvas().attr("maxlength","")}}));r.assign_change_keyup_handlers=function(e,t){const n=e.get_canvas();if(s.on_phonegap()){n.css("-webkit-user-select","text")}r.register_focus(e,e.canvas);let o=null;let l=false;const c=()=>{l=true;if(o){e.clearTimeout(o)}let r;if(e.get_static_property("content_format")==="geographic_address"){r=3e3}else{const e=n.val();if([null,undefined,""].includes(e)||e.length===1){r=0}else{r=1500}}o=e.setTimeout((()=>{e.message("user_change",t());o=null}),r);return true};n.on("input",c);n.on("paste",c);const u=e.get_static_property("content_format");const d=["int_number","float_number"].includes(u);let p="";if(d){n.on("keyup",(e=>{const t=e.key==="Backspace";const r=n.get(0);const i=p[0]==="-";p=n.val();const s=r.selectionStart===0&&r.selectionEnd===0;if(t&&s&&i){return c()}}))}n.on("keydown",(e=>{const t=13;const r=n.hasClass("MultiLineInput");if(e.keyCode!==t||r){return}n.blur()}));n.blur((()=>{if(l){l=false;_()}f.flush();if(o!=null){e.message("user_change",t());e.clearTimeout(o);o=null}}));function _(){e.message("user_submit",t())}const f=i(_,50);return n.change((()=>{if(a.running_test()){_()}else{f()}}))};r.default_for_inputs={font_size:14,font_color:"#3D3D3D",background_style:"bgcolor",border_style:"solid",border_width:1,border_color:"#BDBDBD",border_roundness:3,border_style_top:"solid",border_width_top:1,border_color_top:"#BDBDBD",border_roundness_top:3,border_style_left:"solid",border_width_left:1,border_color_left:"#BDBDBD",border_roundness_left:3,border_style_bottom:"solid",border_width_bottom:1,border_color_bottom:"#BDBDBD",border_roundness_bottom:3,border_style_right:"solid",border_width_right:1,border_color_right:"#BDBDBD",border_roundness_right:3,padding_horizontal:4,padding_vertical:0};r.default_states_for_inputs=[{condition:{type:"ThisElement",next:{type:"Message",name:"is_focused"}},properties:{border_color:"#52A8EC",boxshadow_color:"#52A8EC",boxshadow_style:"outset",boxshadow_horizontal:0,boxshadow_vertical:0,boxshadow_blur:6}},{condition:{type:"ThisElement",next:{type:"Message",name:"isnt_valid"}},properties:{border_color:"#FF0000",boxshadow_color:"#FF0000",boxshadow_style:"outset",boxshadow_horizontal:0,boxshadow_vertical:0,boxshadow_blur:6}}];r.input_content_options={text:"Text",email:"Email",password:"Password",int_number:"Integer",float_number:"Decimal",geographic_address:"Address"};r.is_pw_valid=function(e){if(typeof e!=="string"){return false}if(e.length===0||e.length>1e4){return false}if(!_.get_public_setting("have_pw_policy")){return true}let t=_.get_public_setting("pw_length");if(typeof t!=="number"){t=null}const n=_.get_public_setting("pw_require_capital_letter");const r=_.get_public_setting("pw_require_number");const i=_.get_public_setting("pw_require_special_char");if(t&&e.length<t){return false}if(n&&!e.match(/[A-Z]/)){return false}if(r&&!e.match(/\d/)){return false}if(i&&!e.match(/[^a-zA-Z\d\s:]/)){return false}return true};r.assign_enter_handler_in_input=function(e,t){var n,r,i;const o=e.get_canvas();let a=null;const l=(n=(r=(i=e.element).get_visible_workflows)==null?void 0:r.call(i))!=null?n:[];const c=e.element_id();for(const t of l){var u;if(t.find_expressions(`GetElement.element_id=${c}`).length<1){continue}const n=e.find_instance_by_id((u=t.element_id)==null?void 0:u.call(t));if(n!=null&&n.is_visible()){var d;(d=a)!=null?d:a=n;if(n!==a){a=null;break}}}o.off("keydown.click_the_button");if(!a){return}return o.on("keydown.click_the_button",(e=>{if(e.shiftKey){return}const n=s.meta(e);if(t&&!n){return}const r=13;if(e.keyCode===r){const e=a.get_canvas();if(e.is(":visible")){s.trigger_blur(o);return e.click()}}}))};r.reset_input_div=e=>h.apply_css_style(e,{border:"none","background-color":"transparent"})},{"../../../constants/eval":64,"../../../constants/workflow":95,"../../../db/hydrate":429,"../../../db/obfuscate":430,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../logger":744,"../../../safe_require":777,"../../../u":823,"../../../u/shared/mode_check":851,"../../core_events":377,"../../data_updates":381,"../../property_applications":412,"../../status_bar":415,"../core_elements_utilities/element_workflows":288,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/debounce":1311}],365:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../lang/shrink");r.href_attributes=["mailto","tel","sms","skype"];r.forbidden_url_keys=["id","debug_mode","resume","record_debugging_session"];r.check_parameters=function(e,t){if(e.get_static_property("add_parameters")){const n=e.get_static_property("url_parameters");if(n!=null){for(const s of Object.values(n)){if(r.forbidden_url_keys.includes(s[i.shrink("key")])){t(e.display()+": The parameter "+s[i.shrink("key")]+" cannot be used.")}}}}}},{"../../../lang/shrink":728,"core-js/modules/web.dom-collections.iterator.js":1123}],366:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../u");r.preset_page_widths={custom:{},full_width:{width:1200,caption:"Full width"},centered:{width:980},mobile:{width:380}};r.preset_page_width_list={};for(const e in r.preset_page_widths){var s;const t=r.preset_page_widths[e];r.preset_page_width_list[e]=(s=t.caption)!=null?s:i.toTitleCase(e)}r.get_stripes=function(e){var t;let n;if((t=e.get_style)!=null&&t.call(e).exists()){n=e.get_style().property("stripes")}else{n=e.property("stripes")}if(n.is_empty()){return[]}return n.entries()};r.stripe_defaults={bgcolor:"#AAAAAA",background_style:"bgcolor",boxshadow_horizontal:0,border_style:"none",border_roundness:0,border_width:1,border_color:"#6B6B6B"}},{"../../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],367:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../services/is_installed");const s=e("../../../services/shared/plugin_registry");const o=e("../../../lang/evaluation/element_eval");const a=e("../../../safe_require");a.safe_register("./core/core_elements/shared/pictureinputs",r);r.file_inputs_additional_messages={get_loading_status:{description:" is loading",ret_btype:"boolean",fn(e,t){return e==null?void 0:e.state("loading")}},get_file_size:{description:"'s file size",ret_btype:"number",fn(e,t){return e==null?void 0:e.state("file_size")}}};r.process_upload_security=function(e){const t={};if(e.get_static_property("private")){var n,r;t.attach_to=(n=o.evaluate_property(e,"attach_to"))==null?void 0:(r=n._id)==null?void 0:r.call(n)}else{t.public=true}l(e,t);return t};function l(e,t){var n;const r=(n=e.get_static_property("service"))!=null?n:"bubble";t.service=r;if(r!=="bubble"&&i(r)){const n=s.get_hardcoded_plugin(r);for(const r of n.file_upload.fields){t[r.name]=o.evaluate_property(e,r.name)}}}},{"../../../lang/evaluation/element_eval":690,"../../../safe_require":777,"../../../services/is_installed":781,"../../../services/shared/plugin_registry":784,"core-js/modules/web.dom-collections.iterator.js":1123}],368:[function(e,t,n){(function(t){(function(){"use strict";e("core-js/modules/web.immediate.js");const r=n;const i=e("../../../u");const s=e("../../../lib");const o=e("../../property_applications");const a=e("../../../constants/runmode");const l=e("../../../lang/elements");const{ignoreError:c}=e("../../../u/shared/callbacks");const u=e("../../../editor/css");const d=[];r.top_layer=()=>d[0];r.previous_layer=()=>d[1];r.add_layer=e=>{var t,n;e.state("popup_zindex",s().bubble_version()>18?((t=(n=r.top_layer())==null?void 0:n.state("popup_zindex"))!=null?t:-1)+1:0);d.unshift(e)};r.remove_layer=function(e){const t=t=>t.toUniqueString()===e.toUniqueString();const n=d.findIndex(t);if(n>=0){return d.splice(n,1)[0]}};function p(){var e;const t=r.top_layer();return(e=t==null?void 0:t.state("body_positioning"))!=null?e:"auto"}r.set_body_overflow=()=>document.body.style.overflow=p();r.get_popup_top=function(e,t){if(i.is_on_mobile_or_tablet()){return 20}else{var n;(n=t)!=null?n:t=e.element.get_height();const r=$(window).height();if(t>r-100){return 30}else if(t>r-200){return 50}else{return 100}}};r.get_popup_positioning=function(e,t){var n,s;let o;if(e._has_been_hidden){return}const a=e.get_canvas();(n=t)!=null?n:t=a.outerHeight();const l=(s=window.innerHeight)!=null?s:$(window).height();if(t>l-r.get_popup_top(e,t)+10||e.state("has_been_absolutely_positioned")!=null){o="absolute";e.state("body_positioning","visible");if(i.on_phonegap()){$(window).off("touchmove.popup_opened")}}else if(!e.responsive_mode()){o="fixed";e.state("body_positioning","hidden");if(i.on_phonegap()){if(!e.element.find_elements_custom("RepeatingGroup").length){$(window).on("touchmove.popup_opened",(e=>e.preventDefault()))}}}r.set_body_overflow();a[0].style.position=o;if(o==="absolute"){if(e.state("has_been_absolutely_positioned")==null){e.state("has_been_absolutely_positioned",$(window).scrollTop())}a[0].style.top=e.state("has_been_absolutely_positioned")+50+"px"}else{a[0].style.top=r.get_popup_top(e,t)+"px"}};const _={editor:{position:"absolute","z-index":a.POPUP_ZINDEX-1},runmode:{position:"fixed","z-index":a.POPUP_ZINDEX}};r.get_greyout=function(e){if(!e.state("greyout")){const t=i.div("greyout");t.hide();e.state("greyout",t);e.on_destroy((()=>t.remove()));o.apply_css_style(t,{top:"0px",left:"0px",width:"100%",height:"100%","background-color":"rgba(0,0,0,0.7)"});if(e.edit_mode()){$(".canvas").append(t);t.css(_.editor)}else if(e.responsive_mode()){const e=s().visual_edit.responsive_canvas.get_current_preview_canvas().find("> .r-wrapper");e.append(t);t.css(_.editor)}else{t.insertBefore(e.get_canvas());t.css(_.runmode)}}return e.state("greyout")};r.get_elements_to_blur=function(e){var t;let n;if(e.edit_mode()){n=$(".element",$(u.VISUAL_CANVAS)).not($(".element.Popup,.element.CustomElement.non-draggable",$(u.VISUAL_CANVAS))).not($("*",$(".element.Popup,.element.CustomElement.non-draggable")))}if(e.run_mode()){n=$("body > div").not(e.get_canvas().parents()).not(e.get_canvas()).not(".debugger-canvas").not(".highlight-box").not("span.tt-dropdown-menu").not(".bad-revision").not(".GroupFocus").not(".db-limit-reached")}return(t=n)==null?void 0:t.add(".stripe-container")};r.apply_blur_effect_to_greyout=function(e,t){var n,i;let s;const o=r.previous_layer();if(o!=null){s=r.get_elements_to_blur(o)}(n=s)!=null?n:s=$();const a=(i=r.get_elements_to_blur(e))==null?void 0:i.not(".Popup:not(:visible)");const l=s.not(a);l==null?void 0:l.css({"-webkit-filter":"none",filter:"none"});const c=`blur(${t}px)`;a==null?void 0:a.css({"-webkit-filter":c,filter:c})};r.remove_blur_effect_to_greyout=function(e){const t=r.get_elements_to_blur(e);t==null?void 0:t.css({"-webkit-filter":"none",filter:"none"})};r.apply_greyout_color=function(e,t){const n=r.get_greyout(e);n[0].style["background-color"]=t};r.resize_popup=function(e,n){const s=l.add_layout_resizing_key();e.get_canvas()[0].style["margin-left"]="-"+n/2+"px";e.get_canvas()[0].style.width=n+"px";return i.WaitFor(e.get_children_drawn_key(),(()=>i.run_once(30,(()=>o.calculate_border_width(e)),c((o=>{e.child_container.resize_width(n-o);if(e._has_been_hidden){s.turn()}else{e.wait_for_visible((()=>t((()=>{var t;e.child_container.resize_width((t=i.real_inner_width(e.get_canvas()))!=null?t:n-o);r.get_popup_positioning(e);s.turn()}))))}})))))};r.resize_popup_if_legacy=function(e,n){if(!e.element.E.uses_css_responsive){const s=l.add_layout_resizing_key();return i.WaitFor(e.get_children_drawn_key(),(()=>i.run_once(30,(()=>o.calculate_border_width(e)),c((o=>{e.child_container.resize_width(n-o);if(e._has_been_hidden){s.turn()}else{e.wait_for_visible((()=>t((()=>{var t;e.child_container.resize_width((t=i.real_inner_width(e.get_canvas()))!=null?t:n-o);r.get_popup_positioning(e);s.turn()}))))}})))))}};r.greyout_field_names={prevent_user_from_closing_through_esc:{no_states:true},greyout_color:{default:"rgba(0,0,0,0.7)",in_style:true},greyout_blur:{default:0,no_states:true,in_style:true}};r.get_greyout_properties=()=>[{name:"prevent_user_from_closing_through_esc",caption:"This popup can't be closed by pressing 'Esc'",editor:"Checkbox",pretty:{short_caption:false,section:"Background"}},{name:"greyout_color",caption:"Grayout color",editor:"Color",pretty:{short_caption:false,section:"Background"}},{name:"greyout_blur",caption:"Grayout blur",editor:"Dropdown",numerical_step:.1,set:s().sets.get_set("Numeric")([0,.5,1,1.5,2,2.5,3,4,5,6,7,8,9,10]),pretty:{short_caption:false,section:"Background"}}]}).call(this)}).call(this,e("timers").setImmediate)},{"../../../constants/runmode":83,"../../../editor/css":560,"../../../lang/elements":680,"../../../lib":741,"../../../u":823,"../../../u/shared/callbacks":843,"../../property_applications":412,"core-js/modules/web.immediate.js":1124,timers:2334}],369:[function(e,t,n){"use strict";const r=n;r.bootstrap_colors=["black","primary","danger","info","warning","success"]},{}],370:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../lang/btypes");const s=e=>e.type()==="ElementParent";const o=e=>e.type()==="TextExpression";const a=e=>{const t=e.next();if(t.type()==="Message"&&t.message().is_lookup()&&i.is_custom_type(t.message().ret_btype_id())){return t.message().get_lookup_name()}return null};const l=(e,t)=>{if(s(e)){const n=a(e);if(n)t.add(n)}return t};const c=(e,t)=>{e.elements().forEach((e=>{if(u(e))return;if(d(e)){t=c(e,t)}const n=e.properties();n.forEach((e=>{if(o(e)){const n=e.entries();n.forEach((e=>{t=l(e,t)}))}else{t=l(e,t)}}))}));return t};const u=e=>e.type()==="RepeatingGroup";const d=e=>{if(e.type()==="Group"){const t=e.property("data_source");return s(t)&&!t.has_next()}return false};r.evaluate_extra_fields=e=>{let t=new Set;t=c(e,t);const n=Array.from(t);return n}},{"../../../lang/btypes":653,"core-js/modules/web.dom-collections.iterator.js":1123}],371:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../../u/shared/mode_check");const s=e("../../../lib");const o=e("../../../u");const a=e("../../../lang/evaluation/element_eval");r._get_separator_width=function(e){const t=(t,n)=>{var r;if((!i.on_server()||s().force_responsive_version)&&((r=e.root())==null?void 0:r.get_responsive_version())>=1){return e.get_styleable_static_property(t,n)}else{return e.get_static_property(t,n)}};if([undefined,null,"none"].includes(t("separator_style",true))){return 0}else{return t("separator_width",true)}};function l(e){return function(t){let n;if(t.get_static_property("four_border_style",true)){let r=0;for(const i of e){n=t.get_static_property("border_style"+i,true);if(n&&n!=="none"){r+=t.get_static_property("border_width"+i,true)}}return r}else{n=t.get_static_property("border_style",true);if(n&&n!=="none"){return 2*t.get_static_property("border_width",true)}else{return 0}}}}r.get_external_border_width=l(["_left","_right"]);const c=l(["_top","_bottom"]);r._get_cell_width=function(e){const t=r._get_separator_width(e);const n=e.get_static_property("columns",true);return(e.get_width()-t*(n-1)-r.get_external_border_width(e))/n};r._get_cell_height=function(e){const t=r._get_separator_width(e);const n=e.get_static_property("rows",true);return(e.get_height()-t*(n-1)-c(e))/n};r.get_fixed_cell_rg_column_count=function(e){var t,n;let r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(e==null){return r}let i;if(e.element.is_responsive_v1()>0){var s;i=(s=a.evaluate_property(e,"columns"))!=null?s:r}else{var o,l;i=(o=(l=e.element)==null?void 0:l.get_static_property("columns",true))!=null?o:r}if((t=e.element)!=null&&t.parent().is_root()||(n=e.element)!=null&&n.get_static_property("fixed_width")){var c;return(c=e.columns)!=null?c:i}else{var u;return Math.min((u=e.columns)!=null?u:1,i)}};const u=1e3;const d=10;r.check_astable_loop=function(e,t,n){let r=false;const i=Date.now();n.forEach(((s,a)=>{const{since_timestamp:l,count:c}=s;if(i-l>u){n.delete(a);return}if(!o.compare(a,t)){return}if(c>d){const t=e.element.root();throw new o.OwnerError("Astable data source in repeating group",{display:`${t.type()} ${t.display()}: Data source on repeating group "${e.element.display()}" is not stable, please fix or remove conditional data source. Some elements may be able to render and workflows may time out.`})}n.set(a,{since_timestamp:l,count:c+1});r=true}));if(!r){n.set(t,{since_timestamp:i,count:1})}}},{"../../../lang/evaluation/element_eval":690,"../../../lib":741,"../../../u":823,"../../../u/shared/mode_check":851,"core-js/modules/web.dom-collections.iterator.js":1123}],372:[function(e,t,n){"use strict";const r=n;const i=e("../../../u");const s=e("../../../safe_require");s.safe_register("./core/core_elements/shared/sliderinputs",r);let o=false;r.show_message_for_ios_8_upload_bug=function(){var e;if(!o&&i.safe_contains((e=navigator)==null?void 0:e.userAgent,"12A365")){o=true;alert("The iOS version you're using prevents you from uploading files, please upgrade your system and try again.")}}},{"../../../safe_require":777,"../../../u":823}],373:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("../../../logger");const i=e("../../../u");const s=e("../../../lang/appquery");const o=e("../../property_applications");const a=e("./clipping");const l=e("../../../lang/evaluation/element_eval");const c=e("../../../lang/evaluation/element_props");const u=e("../../../constants/colors");const{variable_to_token_variant:d}=e("../../../lang/color_tokens");const p=n;const{DEFAULT_USER_TOKENS:_}=e("../../../constants/tokens");const{json_deep_copy:f}=e("../../../u/shared/b_object");const h=/(?:(?:https?|ftp|file):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#/%=~_|$?!:,.']*\)|[-A-Z0-9+&@#/%=~_|$?!:,.'])*(?:\([-A-Z0-9+&@#/%=~_|$?!:,.']*\)|[-A-Z0-9+&@#/%=~_|$])/gim;const m=/(?:[a-zA-Z0-9+._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/gim;let g;if(typeof ResizeObserver!=="undefined"&&ResizeObserver!==null){g=new ResizeObserver((e=>{for(const t of e){$(t.target).trigger("update.dot")}}))}p.apply_dotdotdot=function(e,t){const n=e.get_canvas();if(e.thumbnail_mode()){n.css("overflow","hidden");return}function s(){n.dotdotdot({wrap:t,callback:(t,s)=>{i.run_once(30,(()=>{var t,n;return e.edit_mode()&&s.length!==0&&((t=e.canvas)==null?void 0:(n=t.text)==null?void 0:n.call(t))&&e.canvas.text().trim()===""&&l.evaluate_property(e,"text")!==""}),((t,s)=>{if(t){r.log(t);return}if(s){const t=i.div("dots-placeholder",n);t.css({"line-height":0,"font-size":20,"text-align":e.get_static_property("font_alignment",true)});t.text("............")}}))}})}e.setTimeout((()=>{if(e.run_mode()){a.watchClip(n[0],(()=>{s()}))}else{s()}}),1);e.autorun((()=>{var t;for(const t of["font_size","font_family","font_weight","padding_vertical","line_height","word_spacing","letter_spacing","fit_width","fit_height","min_width_css","max_width_css","min_height_css","max_height_css","single_width","single_height"]){l.evaluate_property(e,t)}(t=n.trigger)==null?void 0:t.call(n,"update.dot")}));if(g!=null){g.observe(n[0])}else{n.css("overflow","hidden")}};p.remove_dotdotdot=function(e){var t,n,r;(t=(n=e.canvas).trigger)==null?void 0:t.call(n,"destroy.dot");a.unwatchClip(e.canvas[0]);(r=g)==null?void 0:r.unobserve(e.canvas[0])};p.could_clip=function(e){var t;if(c.max_height_css(e)!=null){return true}if(((t=e.element.parent())==null?void 0:t.container_layout())==="row"){if(l.evaluate_property(e,"vert_alignment")!=="stretch"){return false}}else if(e.element.fit_height()){return false}return true};p.apply_text=function(e,t,n){function r(t){if(e.element.is_responsive_v1()&&(n.vertical_centering||e.run_mode()&&p.could_clip(e))){return`<div>${t}</div>`}else{return t}}const a=s.get_public_setting("bubble_version")>=10;const l=e.get_canvas();const c=e.get_static_property("recognize_links");const u=e.get_static_property("no_bbcode");let d;if(e.run_mode()||!n.editor_preview_text||!n.text||e.element.property("text").is_static()){d=n.text}else{d=n.editor_preview_text}if(u){if(!i.has_bbcode(d)){let s;if(c){s=i.bbcode_to_html(p.replace_links_emails(e,n),a)}else{s=i.bbcode_to_html(d,a)}t.html(r(s))}else{if(e.element.is_responsive_v1()&&p.could_clip(e)){var _;const e=i.div("");e.text(d);t.append(e);(_=t.trigger)==null?void 0:_.call(t,"update.dot")}else{t.text(d)}o.apply_css_style(l,{"white-space":"pre-wrap"})}}else{if(c){d=p.replace_links_emails(e,n)}t.html(r(i.bbcode_to_html(d,a)))}};p.replace_links_emails=function(e,t){let{text:n,editor_preview_text:r,link_color:o,nofollow:a}=t;if(!e.run_mode()&&r&&n&&!e.element.property("text").is_static()){return r}if(typeof n!=="string"||!e.run_mode()){return n}const l=["[url=","[url]","[video]","[youtube]"];const c=["[/url]","[/img]","[/video]","[/youtube]"];function p(e,t,n,r,i){if(i){return n+t.length+r.length<=e.length&&e.substring(n+t.length,n+t.length+r.length)===r}return n>=r.length&&e.substring(n-r.length,n)===r&&n+t.length<e.length&&e[n+t.length]==="]"}function g(e,t,n){for(let t=0;t<l.length;t++){const r=l[t];const i=c[t];if(e.substring(0,n).includes(r)&&e.substring(n).includes(i)){const t=e.substring(n);const s=t.indexOf(r);if(s<0||s>0&&s>t.indexOf(i)){return true}}}return false}function v(e){if(o==null){return e}if(o.includes(u.VAR_IDENTIFIER)){var t;const e=(t=s.get_public_setting("color_tokens"))!=null?t:u.DEFAULT_COLOR_TOKENS;const{token_set:r,variant:i}=d(o);if(!e[r]){var n;const e=(n=s.get_public_setting("color_tokens_user"))!=null?n:f(_);o=e[i][r].rgba}else{o=e[r][i]}}const r=i.rgb_to_hex(o);return`[color=${r.code}]${e}[/color]`}const b=a?" nofollow=true":"";let y=n.replace(h,((e,t)=>{let r;for(r of l){if(p(n,e,t,r)){return e}}for(r of c){if(p(n,e,t,r,true)){return e}}const i=/^http/.test(e)?e:`http://${e}`;return v(`[url=${i}${b}]${e}[/url]`)}));y=y.replace(m,((e,t)=>{if(g(y,e,t)){return e}for(const n of["[url=https://mailto:","[url=mailto:","[url]"]){if(p(y,e,t,n)){return e}}if(p(y,e,t,"[/url]",true)){return e}return v(`[email=${e}]${e}[/email]`)}));return y}},{"../../../constants/colors":53,"../../../constants/tokens":93,"../../../lang/appquery":651,"../../../lang/color_tokens":657,"../../../lang/evaluation/element_eval":690,"../../../lang/evaluation/element_props":691,"../../../logger":744,"../../../u":823,"../../../u/shared/b_object":839,"../../property_applications":412,"./clipping":357,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],374:[function(e,t,n){"use strict";const r=n;const i=e("../../../lang/appquery");const s=e("../../../lib");const o=e("../../../constants/db");r.should_block_cookies=()=>i.get_public_setting("cookie_opt_in")&&s().current_user()._id()===o.NO_USER},{"../../../constants/db":58,"../../../lang/appquery":651,"../../../lib":741}],375:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("mathjs");const s=e("../client/analytics");const o=e("../lang/appquery");const a=e("../shared/apps_utilities");const l=e("./core_elements/core_elements_utilities/element_registry");const c=e("./core_elements/core_elements_utilities/element_transformer");const u=e("./core_elements/core_elements_utilities/element_visibility");const d=e("./core_elements/shared/radiobuttons");const p=e("./core_elements/shared/popups");const _=e("./core_elements/shared/pages");const f=e("./core_elements/shared/repeating_groups");const h=e("./core_elements/core_elements_utilities/element_optional_utils");const m=e("./core_elements/shared/inputs");const g=e("./core_elements/shared/floating_groups");const v=e("../constants/currency");const b=e("../core/font_awesome_icons");const y=e("../shared/images");const w=e("./input_mask");const x=e("../lang/lang");const j=e("pluralize");const A=e("./property_applications");const M=e("./property_applications/property_applications_fields");const E=e("../shared/responsive/responsive_algorithm");const k=e("../shared/responsive/responsive_layout");const O=e("../safe_require");const S=e("../u");const D=e("./custom_tz_utilities");const C=e("../lang/evaluation/element_eval");const{SETTINGS_TAB:T}=e("./../editor/css");e("../lang/elements");const{customTypes:N}=e("../lang/btypes_dropdowns");const{has_adv_timezone_overridden:P,has_input_timezone_controls_on:I}=e("../lang/timezone_override_settings");const{isTableDirectionHorizontal:R}=e("./core_elements/components/utils/table_element");const{createMainAxis:L,createCrossAxis:z}=e("../editor/element_actions/tables");const{MASONRY_GRID_SETTING_CLICKED:B}=e("../constants/segment_events");const q=e("./shared_fields");const{is_responsive_v0:U,is_responsive_v1_or_higher:F,get_element_parent_type:W,get_binding_properties:G,get_disabled_property:V,get_mandatory_property:H}=q;const{displayableInListBtypes:X,filters:Y}=e("../lang/btypes_dropdowns");const K=S.require_moment();O.safe_register("./core/core_elements_fields",r);S.edit_mode_only();r.add_fields_to_elements=function(){for(const e in l.registered_elements){const t=l.registered_elements[e];if(t.field_names){(function(e,t){if(r[e]){c.add_fields(r[e].fields,t);t.primary_field=r[e].primary_field;t.mandatory_sections=r[e].mandatory_sections}})(e,t)}}};const J=e=>{var t,n;return(t=(n=pe().action_canvas)==null?void 0:n.get_related_workflows(e))!=null?t:0};function Z(e){return[{name:"button_disabled",caption:"This element isn't clickable",editor:"Checkbox",pretty:{section:"StartWorkflow"}},{name:"start_workflow",dynamic_caption:()=>{const t=J(e.id()).length;return t>0?t>1?"Edit workflows":"Edit workflow":"Add workflow"},editor:"Button",optional:true,click_cb:()=>pe().action_canvas.reveal_workflow_for_element(e.id()),pretty:{section:"StartWorkflow",no_caption:true}}]}r.Text={primary_field(){return"text"},fields(e){return[{name:"text",caption:"Text",editor:"LongText",pretty:{section:"Text",no_caption:true}},{name:"editor_preview_text",optional:true,caption:"Canvas placeholder",editor:"StaticText",condition(){return F(e)&&!e.property("text").is_static()},pretty:{section:"Text"}},{name:"stretch_to_fit",caption:"Stretch to fit content",editor:"Checkbox",condition(e){var t;return!((t=e.root())!=null&&t.use_responsive_algorithm())},pretty:{section:"Text"}},{name:"cut_off_content",caption:"Cut off content if the element is not tall enough",editor:"Checkbox",condition(e){var t;return((t=e.root())==null?void 0:t.use_responsive_algorithm())&&U(e)},pretty:{section:"TextResponsive"},include_in_redesign:false},{name:"text_probably_hidden",label_text:"Warning: This element may never draw because the text size is larger than the container. To remove this warning, make this element taller, reduce padding or reduce the font size or line height.",editor:"Label",condition(e){if(!e.get_static_property("cut_off_content")){return false}const t=e.get_static_property("line_height",true);const n=e.get_static_property("font_size",true);const r=e.get_static_property("height",true);const i=e.get_static_property("padding_vertical",true);if(t==null||n==null||r==null||i==null){return}return t*n>r-2*i},pretty:{section:"TextResponsive"},include_in_redesign:false},{name:"shrink_if_less_high",caption:"Shrink the element height if the text gets shorter",editor:"Checkbox",condition(e){var t;return((t=e.root())==null?void 0:t.use_responsive_algorithm())&&U(e)&&!e.get_static_property("cut_off_content")},pretty:{section:"TextResponsive"},include_in_redesign:false},{name:"text_height_options",caption:"radio options to set height",editor:"Dropdown_Button",set:pe().sets.get_set("Object")({auto_height:"Auto height",truncate_text:"Truncate text",shrink_to_fit:"Shrink to fit"}),show_captions:true,overwrite_legacy:{auto_height:{shrink_if_less_high:false,cut_off_content:false},truncate_text:{shrink_if_less_high:false,cut_off_content:true},shrink_to_fit:{shrink_if_less_high:true,cut_off_content:false}},condition:U,optional:true,pretty:{section:"Text"},include_in_redesign:true},{name:"no_bbcode",caption:"Do not apply bb-code",editor:"Checkbox",pretty:{section:"Text"}},{name:"recognize_links",caption:"Recognize links and emails",editor:"Checkbox",pretty:{section:"Text"}},{name:"link_color",caption:"Link color",editor:"Color",empty_possible:true,dynamic:true,pretty:{section:"Text"},condition(){return e.get_static_property("recognize_links")}},{name:"nofollow",caption:"Mark the links as nofollow",editor:"Checkbox",condition(){return e.get_static_property("recognize_links")},pretty:{section:"Text"}},{name:"tag_type",caption:"HTML tag for this element (SEO)",editor:"Dropdown",set:pe().sets.get_set("List")(["normal","h1","h2","h3","h4","h5","h6"],undefined,true),condition(){return o.get_public_setting("expose_text_tags")},pretty:{section:"Text",dropdown_width:"medium"}}].concat(Z(e))},mandatory_sections(e){return["Text","Font","StartWorkflow"]}};r.Shape={fields(e){return Q().concat(Z(e))},mandatory_sections(e){return["Background","Boxshadow","Border","Position"]}};r.Button={primary_field(){return"text"},fields(e){return[{name:"text",caption:"Text",editor:"ShortText",pretty:{section:"Text",no_caption:true}}].concat(Z(e))},mandatory_sections(e){return["Text","StartWorkflow","Font"]}};r.Icon={primary_field(){return"icon"},fields(e){return[{name:"icon",caption:"Icon",editor:"IconPicker",icon_list:{set:b.icons},pretty:{section:"IconStyle"}},{name:"icon_color",caption:"Icon color",editor:"Color",transition:true,dynamic:true,pretty:{section:"IconStyle"}},{name:"spin_icon",caption:"Make the icon rotate",editor:"Checkbox",pretty:{section:"IconStyle"}}].concat(Z(e))},mandatory_sections(e){return["IconStyle","StartWorkflow"]}};r.Link={primary_field(){return"text"},fields(e){let t;let n=null;if(e.get_static_property("linktype")==="pagelink"){var r;const i=e.get_static_property("page");t=o.page(i);(r=t)!=null?r:t=o.get_page_by_name(i);if(!t){n=_e.get("null")}else{const e=t.get_static_property("page_item_type");if(!e){n=_e.get("null")}else{n=_e.get(e)}}}const i=e.get_styleable_static_property("show_icon",true);const s=e.get_static_property("no_html");return[{name:"show_icon",caption:"Show an icon instead of text",editor:"Checkbox",pretty:{section:"Text"}},{name:"text",caption:"Text",editor:"LongText",no_rich_text_editing:!s,condition(){return!i},pretty:{section:"Text",no_caption:true}},{name:"icon",caption:"Icon",editor:"IconPicker",icon_list:{set:b.icons},condition(){return i},pretty:{section:"Text",no_caption:true}},{name:"linktype",caption:"Link destination",editor:"Dropdown",set:pe().sets.get_set("Object")({pagelink:"Internal page",url:"External URL"}),pretty:{section:"LinkBehavior"}},{name:"page",caption:"Destination page",editor:"Dropdown",set:pe().sets.get_set("Pages")(),condition:"linktype is pagelink",pretty:{section:"LinkBehavior"}},{name:"data_to_send",caption:"Data to send",editor:"Basic",value:n&&n.id()!=="null"?n:"text",condition:"linktype is pagelink",optional:!(n&&n.id()!=="null"),value_setter:{property_modifier(e){return q.set_group_type_list_elements(t,e,"page_item_type")},generate_message(e){return q.get_generate_message_page(t,e)}},pretty:{section:"LinkBehavior"}},{name:"url",caption:"Destination URL",editor:"ShortText",condition:"linktype is url",pretty:{section:"LinkBehavior"}},{name:"open_in_new_tab",caption:"Open in a new tab",editor:"Checkbox",pretty:{section:"LinkBehavior"}},{name:"link_disabled",caption:"This element isn't clickable",editor:"Checkbox",pretty:{section:"LinkBehavior"}},{name:"nofollow",caption:"Mark the link as nofollow",editor:"Checkbox",pretty:{section:"LinkBehavior"}}].concat(q.add_parameters_to_link("link")).concat([{name:"wrap_when_squizzed",caption:"Wrap the text when the width changes",editor:"Checkbox",condition(e){var t;return((t=e.root())==null?void 0:t.use_responsive_algorithm())&&U(e)},pretty:{section:"LinkBehavior"}}])},mandatory_sections(){return["Text","Font","LinkBehavior"]}};r.HTML={primary_field(){return"html"},fields(e){return[{name:"html",caption:"HTML",editor:"LongText",html_code_editor:true,pretty:{section:"HTML",show_title:false,no_caption:true}},{name:"useiframe",caption:"Display as an iFrame",editor:"Checkbox",pretty:{section:"HTML",show_title:false}},{name:"stretch_to_fit",caption:"Stretch to fit content",editor:"Checkbox",condition(e){return U(e)&&!e.get_static_property("useiframe",true)},pretty:{section:"HTML",show_title:false}},{name:"defer_drawing",caption:"Wait to render this element until it is visible",editor:"Checkbox",pretty:{section:"HTML"}}].concat(Q())},mandatory_sections(){return["HTML","Position"]}};r.Video={primary_field(){return"video_id"},fields(e){const t={youtube:"YouTube",vimeo:"Vimeo"};for(const e of me.get_app_plugins()){if(e!=null&&e.is_video_service()){t[e.name]=e.display()}}return[{name:"video_source",caption:"Video source",editor:"Dropdown",set:pe().sets.get_set("Object")(t),pretty:{section:"VideoBehavior"}},{name:"video_id",caption:"Video ID",editor:"Basic",value:"text",pretty:{section:"VideoBehavior"}},{name:"auth_token",caption:"Server auth token",editor:"Basic",condition:"video_source is ziggeo",value:"text",pretty:{section:"VideoBehavior"}},{name:"autoplay",caption:"Play the video automatically on load",editor:"Checkbox",pretty:{section:"VideoBehavior"}},{name:"loop",caption:"Replay video when over",editor:"Checkbox",condition:e=>e.get_static_property("video_source")!=="ziggeo",pretty:{section:"VideoBehavior"}},{name:"control_color_vimeo",caption:"Video control color",editor:"Color",condition:"video_source is vimeo",pretty:{section:"VideoBehavior"}}]},mandatory_sections(){return["VideoBehavior","Position"]}};function Q(){return[{name:"keep_proportion_resize",caption:"Keep element proportions as the page is resized",editor:"Checkbox",condition(e){var t;return((t=e.root())==null?void 0:t.use_responsive_algorithm())&&e.root().get_responsive_version()<1&&!e.get_static_property("fixed_width")},pretty:{section:"Position"}}]}(()=>{function e(e){const t=e.property("src");if(!t.is_empty()&&t.is_static()&&e.get_static_property("src",true)!==""){return true}}function t(e){var t;const n=e.property("src");return n.is_empty()||n.is_static()&&((t=n.get_static)==null?void 0:t.call(n))===""}function n(e){const t=e.property("src");return!t.is_empty()&&!t.is_static()}r.Image={primary_field(){return"src"},fields(t){const r={stretch:"Stretch",rescale:"Rescale",zoom:"Zoom"};if(U(t)){r.adjust_height="Adjust element height"}return[{name:"src",editor:"DynamicImage",caption:"Image Source",on_change:e=>{if(t.exists()){return y.get_image_real_dimensions(e,(e=>{if(e.height==null){return}t.set_property("width",Math.floor(e.width*t.get_height()/e.height));pe().ImagePalette().wipe_crop_data(t);const n=parseInt(e.height);const r=parseInt(e.width);if(n>0&&r>0){const e=i.gcd(n,r);t.set_property("aspect_ratio_height",n/e);t.set_property("aspect_ratio_width",r/e)}return t.commit()}))}},pretty:{section:"Image",no_caption:true}},{name:"stretch_or_rescale",caption:"Run-mode rendering",editor:"Dropdown",set:pe().sets.get_set("Object")(r),condition(){return n(t)},pretty:{section:"Image",short_caption:true}},{name:"crop_data",optional:true,caption:"Image cropping",editor:"Crop_Button",condition(){return e(t)},pretty:{section:"Image"}}].concat(Q()).concat([{name:"alt_tag",optional:true,caption:"ALT tag",editor:"ShortText",condition(){return o.get_public_setting("expose_text_tags")},pretty:{section:"Image"}},{name:"editor_preview_image",optional:true,caption:"Canvas placeholder",editor:"Image",condition(e){return F(e)&&n(e)},pretty:{section:"Image"}}]).concat(Z(t))},mandatory_sections(){return["Image","Position","StartWorkflow"]}}})();r.Alert={primary_field(){return"text"},fields(e){return[{name:"text",caption:"Text",editor:"LongText",pretty:{section:"Text",no_caption:true}},{name:"at_to_top",caption:"Position the alert at the top",editor:"Checkbox",on_change(t){var n;if(((n=e.root())==null?void 0:n.get_responsive_version())<1){return}if(t){if(e.parent().container_layout()===k.FIXED_LAYOUT){const t=E.get_default_sizing({width:e.get_width(),height:e.get_height(),can_fit_height:e.can_fit_height()});t.single_width=false;t.max_width_css=null;for(const n in t){const r=t[n];e.set_property(n,r)}}}else{const t=pe().visual_edit.get_instance(e);e.set_property("width",t.canvas.width());e.set_property("height",t.canvas.height());e.set_property("top",C.evaluate_property(t,"margin_top"));e.set_property("left",C.evaluate_property(t,"margin_left"));pe().visual_edit.current_editor_canvas.getFirstContainer(e.parent()).move_element_in({instance:t,element:e})}e.commit_merge()},pretty:{section:"Text"}}]},mandatory_sections(){return["Text","Font","Background"]}};r.PoweredByBubble={primary_field(){return"element_type"},fields(e){return[{name:"element_type",caption:"Visual type",editor:"Dropdown",set:pe().sets.get_set("Object")({image_black:"Original logo",image_blue:"Blue image",image_grey:"Gray image",image_white:"White image",text:"Text"}),pretty:{section:"Text"}},{name:"add_border",caption:"Add a border",editor:"Checkbox",pretty:{section:"Text"}},{name:"text_color",caption:"Text color",editor:"Color",pretty:{section:"Text"},condition:"element_type is text"}]}};function ee(e){var t;(t=e)!=null?t:e="StaticText";return[{name:"placeholder",caption:"Placeholder",editor:e,optional:true,no_rich_text_editing:true,pretty:{short_caption:false,section:"InputContent"}}]}function te(){return[{name:"not_submit_on_enter",caption:'Prevent "enter" key from submitting',editor:"Checkbox",pretty:{section:"InputContent"}}]}function ne(e,t){const n=o.has_advanced_feature_enabled("timezone_controls_page")?"on_page":"legacy";return D.custom_tz_fields(n,{condition(){return t()&&I()},pretty:{section:"InputContent"}},true)}r.Input={primary_field(){return"placeholder"},fields(e){const t=e.get_static_property("content_format");const n=S.extend({},m.input_content_options);if(a.is_meta(o.appname())){S.extend(n,{credit_card_number:w.masks.credit_card_number.caption,credit_card_cvc:w.masks.credit_card_cvc.caption,credit_card_exp_month:w.masks.credit_card_exp_month.caption,credit_card_exp_year:w.masks.credit_card_exp_year.caption,appname_validate:"Application name"})}const r=["int_number","float_number","currency","percentage"];function i(t){let r;const i=W(e);if(e.get_static_property("auto_binding")&&t&&i){const e=_e.get(i).custom_type();const s=e.field(t);if(s!=null&&s.exists()){const e=s.value();r=pe().sets.get_set("Filtered")(pe().sets.get_set("Object")(n),(t=>{var n;const r=(n=m.type_content_format_mapping[e])!=null?n:[];return r.includes(t.value)||r[0]==="_all"}))}}if(!r){r=pe().sets.get_set("Object")(n)}return r}const s=i(e.get_static_property("bind_field"));let l;if(o.get_public_setting("bubble_version")>=12){if(t in w.masks){l=w.masks[t].btype}else if(t==="geographic_address"){l="geographic_address"}else{l="text"}}else{if(["date","date_2"].includes(t)){l="date"}else if(t==="geographic_address"){l="geographic_address"}else{l="text"}}const c=ee("ShortText").concat(G(e)).concat([{name:"content",caption:"Initial content",editor:l==="text"?"ShortText":"Basic",value:l,pretty:{short_caption:false,section:"InputContent"},optional:true,condition(e){return!e.get_static_property("auto_binding")}},{name:"content_format",caption:"Content format",editor:"Dropdown",set:s,pretty:{short_caption:false,section:"InputContent"}}].concat(ne(e,(()=>t==="date"||t==="date_2"))).concat([{name:"currency_symbol",caption:"Currency prefix",editor:"Dropdown",set:pe().sets.get_set("List")(v.currency_symbols,"text"),condition:"content_format is currency",pretty:{dropdown_width:"short",section:"InputContent"}},{name:"always_show_decimals",caption:"Always show decimals",editor:"Checkbox",condition:"content_format is currency",pretty:{section:"InputContent"}},{name:"decimal_place",caption:"Decimal place",editor:"Dropdown",set:pe().sets.get_set("Integer")([0,1,2,3,4]),numerical_step:1,condition(){return["float_number","percentage"].includes(t)},optional:true,pretty:{dropdown_width:"short",section:"InputContent"}},{name:"show_thousands",caption:"Show thousands separator",editor:"Checkbox",condition(){return["float_number","int_number"].includes(t)},pretty:{section:"InputContent"}},{name:"limit_number_of_characters",caption:"Limit the number of characters",editor:"Checkbox",condition(){return["text","appname_validate","numerical_ref"].includes(t)},pretty:{short_caption:false,section:"InputContent"}},{name:"character_limit",caption:"Maximum number",editor:"StaticNumber",pretty:{short_caption:false,section:"InputContent"},condition(){return["text","appname_validate","numerical_ref"].includes(t)&&e.get_static_property("limit_number_of_characters")}},{name:"have_a_numerical_range",caption:"Set a range (min and max)",editor:"Checkbox",condition(){return r.includes(t)},pretty:{short_caption:false,section:"InputContent"}},{name:"min_range_value",caption:"Minimum value",editor:"Basic",value:"number",optional:true,pretty:{short_caption:false,section:"InputContent"},condition(){return r.includes(t)&&e.get_static_property("have_a_numerical_range")}},{name:"max_range_value",caption:"Maximum value",editor:"Basic",value:"number",optional:true,pretty:{short_caption:false,section:"InputContent"},condition(){return r.includes(t)&&e.get_static_property("have_a_numerical_range")}},{name:"check_password_policy",caption:"Check the password while typing",editor:"Checkbox",condition(){return t==="password"&&o.get_public_setting("have_pw_policy")},pretty:{short_caption:false,section:"InputContent"}}].concat(te(),q.additional_fields_for_text_inputs())));for(const t of c){if(t.name==="bind_field"){t.on_change=function(t){if(e.E.field_names.content_format&&t!=null){const a=W(e);const l=_e.get(a).custom_type();const c=l.field(t);if(c!=null&&c.exists()){var n,r;const a=c.value();const l=i(t);const u=((n=window)==null?void 0:n.composer_revamp)&&!s.find((e=>e.value===a))&&l.all()[0]!=null;const d=!((r=window)!=null&&r.composer_revamp)&&!l.contains(a)&&l.get_options()[0]!=null;if(u||d){var o;e.set_property("content_format",(o=window)!=null&&o.composer_revamp?l.all()[0].value:l.get_options()[0].value);return e.commit_merge()}}}};break}}return c},mandatory_sections(){return["InputContent","Font"]}};r.MultiLineInput={primary_field(){return"placeholder"},fields(e){return ee("LongText").concat(G(e,["text"])).concat([{name:"content",caption:"Initial content",editor:"LongText",no_rich_text_editing:true,optional:true,pretty:{short_caption:false,section:"InputContent"},condition(e){return!e.get_static_property("auto_binding")}}].concat([{name:"limit_number_of_characters",caption:"Limit the number of characters",editor:"Checkbox",pretty:{short_caption:false,section:"InputContent"}},{name:"character_limit",caption:"Maximum number",editor:"StaticNumber",pretty:{short_caption:false,section:"InputContent"},condition:"limit_number_of_characters"},{name:"stretch_to_fit",caption:"Stretch to fit content",editor:"Checkbox",condition:U,pretty:{section:"InputContent"}}].concat(q.additional_fields_for_text_inputs())))},mandatory_sections(){return["InputContent","Font"]}};r.Checkbox={primary_field(){return"label"},fields(e){return[{name:"label",caption:"Label",editor:"ShortText",pretty:{short_caption:false,section:"InputContent"}}].concat(G(e,["boolean"])).concat([{name:"contents",caption:"Preset status",editor:"Dropdown",set:pe().sets.get_set("Object")({checked:"Checked",unchecked:"Unchecked",dynamic_state:"Dynamic"}),condition(e){return!e.get_static_property("auto_binding")},pretty:{short_caption:false,section:"InputContent"}},{name:"dynamic",caption:"Dynamic status",editor:"Basic",value:"sys.bool",condition(e){return!e.get_static_property("auto_binding")&&e.get_static_property("contents",true)==="dynamic_state"},pretty:{short_caption:false,section:"InputContent"}},{name:"mandatory",caption:"This checkbox should be checked",editor:"Checkbox",pretty:{short_caption:false,section:"InputContent"}}].concat(V()))},mandatory_sections(){return["InputContent","Font"]}};function re(e){var t;let n,r,i,s,a;if(e.get_static_property("choices_style")==="dynamic"){var l,c;let t;n=a=e.get_static_property("dynamic_type");if(n!=null){t="."+n}r="list"+((l=t)!=null?l:"*");i="Basic";s=(c=n)!=null?c:"null"}else{i="ShortText";a="text"}let u;if(o.has_feature_enabled("reorg_component_selection")){u=X()}else{u=pe().sets.get_set("DisplayableInListValues")(true)}return[{name:"choices_style",caption:"Choices style",editor:"Dropdown",set:pe().sets.get_set("Object")({static:"Static choices",dynamic:"Dynamic choices"}),pretty:{section:"InputContent"}},{name:"choices",caption:"Choices (press Enter between each option)",editor:"StaticMultiLineText",condition:"choices_style is static",pretty:{short_caption:false,section:"InputContent"}},{name:"dynamic_type",caption:"Type of choices",editor:"Dropdown",set:u,condition:"choices_style is dynamic",on_change(t){if(e.exists()){const t={name:"DynamicChoiceChange"};if(e.property("option_display_expression").is_empty()){return e.property("option_display_expression").json.set(x.RAW.TextExpression([{type:"InjectedValue"}]),t)}}},pretty:{short_caption:false,section:"InputContent"}},{name:"data_source",caption:"Choices source",editor:"Basic",value:(t=r)!=null?t:"null",condition:"choices_style is dynamic",pretty:{short_caption:false,section:"InputContent"},value_setter:{property_modifier(t){return q.set_group_type_list_elements(e,t,"dynamic_type")},no_need_to_show_message(){return q.no_need_to_show_message_container_elements(e)},generate_message(t){return q.get_generate_message_list_elements(e,t,"dynamic_type","this input's type of choices","setting")}}},{name:"option_display_expression",caption:"Option caption",editor:"ShortText",condition:e=>e.get_static_property("choices_style")==="dynamic"&&n!=null,pretty:{short_caption:false,section:"InputContent"}}].concat(q.get_binding_properties(e,[a])).concat([{name:"default",caption:"Default value",editor:i,value:s,optional:true,condition:e=>!e.get_static_property("auto_binding"),pretty:{short_caption:false,section:"InputContent"}}])}r.Dropdown={primary_field(){return"placeholder"},fields(e){return ee("ShortText").concat(re(e)).concat(H()).concat(V()).concat([{name:"placeholder_color",caption:"Placeholder color",editor:"Color",pretty:{section:"PlaceholderColor"}}])},mandatory_sections(){return["InputContent","Font"]}};r.RadioButtons={fields(e){return re(e).concat(H()).concat(V()).concat([{name:"use_dynamic_columns",caption:"Use a dynamic number of columns",editor:"Checkbox",condition:F,pretty:{short_caption:false,section:"InputContent"}},{name:"columns",caption:"Number of columns",editor:"Dropdown",set:pe().sets.get_set("Integer")([1,2,3,4]),numerical_step:1,condition(e){return U(e)||!e.get_static_property("use_dynamic_columns")},pretty:{short_caption:false,section:"InputContent"}},{name:"min_column_width_px",caption:"Minimum column width (px)",editor:"StaticNumber",condition(e){return F(e)&&e.get_static_property("use_dynamic_columns")},validation_fn(e){return e>0},pretty:{short_caption:false,section:"InputContent"}},{name:"color",caption:"Bootstrap color",editor:"Dropdown",set:pe().sets.get_set("List")(d.bootstrap_colors),pretty:{short_caption:false,section:"InputContent"}}])},mandatory_sections(){return["InputContent","Font"]}};r.AutocompleteDropdown={primary_field(){return"placeholder"},fields(e){let t,n,r,i,s;const a=e.get_static_property("choices_style");if(a==="dynamic"){t=e.property("data_source").property("type_to_find").json.get()}if(a==="algolia_search"){t=e.property("algolia_source").property("type_to_find").json.get()}if(!t){n="Define list of options"}else{n=`Modify list of ${j(_e.get(t).display())}`}if(["dynamic","geographic_places"].includes(a)){r="Basic";if(a==="dynamic"){var l;i=(l=t)!=null?l:"null";s=t}else{s=i="geographic_address"}}else{r="ShortText";s="text"}const c={static:"Static choices",dynamic:"Dynamic choices",geographic_places:"Geographic places"};if(o.get_private_setting("general_keys.has_valid_algolia")){c.algolia_search="Search with Algolia"}const u=ee("ShortText").concat([{name:"choices_style",caption:"Choices style",editor:"Dropdown",set:pe().sets.get_set("Object")(c),click_cb(){return console.log("should probably delete the data source if it went from dynamic to algolia")},pretty:{section:"InputContent"}},{name:"choices",caption:"Choices (press Enter between each option)",editor:"StaticMultiLineText",condition:"choices_style is static",pretty:{short_caption:false,section:"InputContent"}},{name:"data_source",button_caption:n,editor:"Button",optional:true,click_cb:()=>{const t=e.property("data_source");if(t.is_empty()){t.json.set(x.RAW.DataSource("Search"),{name:"SearchBoxSource"})}const n=pe().visual_edit.reference_slidable_palette();if(!n.is_currently_visible()){n.assign_node(t,(n=>{if(n.action==="change"){t.json.set(n.value.val,{name:"SearchBoxSource"})}else if(n.action==="delete"){t.json.set(null,{name:"SearchBoxSource"})}return e.commit()}));return n.show()}else{return n.hide()}},condition(e){return e.get_static_property("choices_style")==="dynamic"},pretty:{short_caption:false,section:"InputContent"}},{name:"algolia_source",button_caption:n,editor:"Button",optional:true,click_cb(){const t=e.property("algolia_source");if(t.is_empty()){t.json.set(x.RAW.DataSource("AlgoliaSearch"),{name:"SearchBoxSource"})}const n=pe().SlidablePalette();if(!n.is_currently_visible()){n.assign_node(t,(n=>{if(n.action==="change"){t.json.set(n.value.val,{name:"SearchBoxSource"})}else if(n.action==="delete"){t.json.set(null,{name:"SearchBoxSource"})}return e.commit()}));return n.show()}else{return n.hide()}},condition(e){return e.get_static_property("choices_style")==="algolia_search"},pretty:{short_caption:false,section:"InputContent"}},{name:"field_to_display",caption:"Field to display",editor:"Dropdown",set:pe().sets.get_set("CustomFields")({include_all_fields:true,public_searchable:true,include_not_built_ins:false,btype_name:t,white_list_btypes:["text","number"]}),default:"_all",condition(e){const n=e.property("algolia_source").property("field_to_search").get_static();return e.get_static_property("choices_style")==="algolia_search"&&t!=null&&n==="_all"},pretty:{short_caption:false,section:"InputContent"}},{name:"field_to_search",caption:"Field to search",editor:"Dropdown",set:pe().sets.get_set("CustomFields")({btype_name:t,white_list_btypes:["text"]}),condition(e){return e.get_static_property("choices_style")==="dynamic"&&t!=null},pretty:{short_caption:false,section:"InputContent"}},{name:"information",label_text:"Your application is on a domain and should be using its own Google Map API Key for this element to function best. Click here to set it.",click_cb(){$(T).click();return pe().settings_editor.settings_canvas.open_tab("General")},editor:"Label",condition(e){return e.get_static_property("choices_style")==="geographic_places"&&o.domain()&&o.get_public_setting("general_keys.google_map_key")==null},pretty:{short_caption:false,section:"InputContent"}},{name:"location",caption:"Prefer results around",editor:"Basic",value:"geographic_address",condition:"choices_style is geographic_places",pretty:{short_caption:false,section:"InputContent"}},{name:"radius",caption:"Radius (meters)",editor:"Basic",value:"number",condition:e=>e.get_static_property("choices_style")==="geographic_places"&&e.get_static_property("location",true)!=null,pretty:{short_caption:false,section:"InputContent"}}].concat(q.get_binding_properties(e,[s])).concat([{name:"default",caption:"Default value",editor:r,value:i,condition:e=>!e.get_static_property("auto_binding"),pretty:{short_caption:false,section:"InputContent"}},{name:"allow_not_in_list",caption:"Allow entries not in list when typing",editor:"Checkbox",condition:e=>!e.get_static_property("auto_binding")&&a!=="geographic_places",pretty:{short_caption:false,section:"InputContent"}},{name:"ac_list_max",caption:"Max. entries to show",editor:"StaticNumber",pretty:{shoft_caption:false,section:"InputContent"}}].concat(te(),H(),V())));for(const e of u){if(e.name==="auto_binding"){e.condition=e=>s!=null}if(e.name==="bind_field"){const t=e.condition;e.condition=e=>t(e)&&s!=null}}return u},mandatory_sections(){return["InputContent","Font"]}};r.SliderInput={primary_field(){},fields(e){const t=e.get_styleable_static_property("range_type");const n=[{name:"min_value",caption:"Min value",editor:"Basic",value:"number",pretty:{short_caption:false,section:"InputContent"}},{name:"max_value",caption:"Max value",editor:"Basic",value:"number",pretty:{short_caption:false,section:"InputContent"}},{name:"step",caption:"Step",editor:"StaticNumber",integer:false,pretty:{short_caption:false,section:"InputContent"},validation_fn(e){return e>0}},{name:"range_type",caption:"Slider type",editor:"Dropdown",set:pe().sets.get_set("Object")({simple:"Simple",range:"Range"}),pretty:{short_caption:false,section:"InputContent"}}];if(t==="range"){n.push(...G(e,["number_range"])||[])}else{n.push(...G(e,["number"])||[])}n.push(...[{name:"content",caption:"Initial content",editor:"Basic",value:t==="range"?"number_range":"number",condition(e){return!e.get_static_property("auto_binding")},optional:true,pretty:{short_caption:false,section:"InputContent"}},{name:"orientation",caption:"Orientation",editor:"Dropdown",set:pe().sets.get_set("List")(["horizontal","vertical"]),pretty:{short_caption:false,section:"InputContent"}},{name:"border_color",caption:"Border color",editor:"Color",pretty:{short_caption:false,section:"InputContent"}},{name:"background_color",caption:"Background color",editor:"Color",pretty:{short_caption:false,section:"InputContent"}},{name:"handle_color",caption:"Handle color",editor:"Color",pretty:{short_caption:false,section:"InputContent"}},{name:"range_area_color",caption:"Range area color",editor:"Color",condition(){return t==="range"},pretty:{short_caption:false,section:"InputContent"}}].concat(V())||[]);return n},mandatory_sections(){return["InputContent"]}};r.PictureInput={primary_field(){},fields(e){return ee("ShortText").concat(G(e,["image"])).concat([{name:"src",caption:"Default",editor:"DynamicImage",optional:true,condition(e){return!e.get_static_property("auto_binding")},pretty:{no_caption:true,section:"InputContent"}}].concat(H()).concat(Q()).concat(V(),r.file_upload_destination(e).concat([{name:"limit_image_width",caption:"Limit image size before upload",editor:"Checkbox",pretty:{section:"InputContent"}}])))},mandatory_sections(){return["InputContent"]}};r.file_upload_destination=function(e,t){var n,r;(n=t)!=null?n:t="InputContent";const i=[];const s=pe().sets.get_set("FileStorageProviders")();const a=(r=window)!=null&&r.composer_revamp?s.all().length>1:s.get_options().length>1;if(a){i.push({name:"service",caption:"Storage service",editor:"Dropdown",set:pe().sets.get_set("FileStorageProviders")(),default:"bubble"})}const l=e.get_static_property("service");if(l&&l!=="bubble"&&fe(l)){i.push(...he.get_hardcoded_plugin(l).file_upload.fields||[]);if(l==="box"){const e=o.custom_type("box_file").privacy_roles();if(e.length<2){i.push({name:"information",label_text:"There are currently no privacy rules on Box files. Click here get to the Privacy section of the Data tab.",editor:"Label",click_cb(){return o.app().securable_type("box","box_file").privacy_role("everyone").find_in_editor()},pretty:{short_caption:false,section:"InputContent"}})}}}else{i.push(...[{name:"private",caption:"Make this file private",editor:"Checkbox",pretty:{section:"InputContent"}},{name:"attach_to",caption:"Attach this file to",editor:"Basic",value:_e.saveable,condition:"private",pretty:{section:"InputContent"}}]||[])}for(const e of i){e.pretty={section:t}}return i};r.FileInput={primary_field(){},fields(e){return ee("ShortText").concat(G(e,["file"])).concat([{name:"src",caption:"Initial content",editor:"DynamicFile",optional:true,condition(e){return!e.get_static_property("auto_binding")},pretty:{section:"InputContent"}}].concat(H()).concat(V(),r.file_upload_destination(e),q.get_max_file_size_property()))},mandatory_sections(){return["InputContent"]}};r.DateInput={primary_field(){},fields(e){return[{name:"input_type",caption:"Input type",editor:"Dropdown",set:pe().sets.get_set("Object")({date:"Date",date_time:"Date & Time"}),pretty:{section:"InputContent"}}].concat(ne(e,(()=>true)),G(e,["date"])).concat([{name:"content",caption:"Initial content",editor:"Basic",value:"date",condition(e){return!e.get_static_property("auto_binding")},optional:true,pretty:{short_caption:false,section:"InputContent"}},{name:"overwrite_placeholder",editor:"Checkbox",caption:"Customize the input placeholder",condition:"input_type is date",pretty:{short_caption:false,section:"InputContent"}},{name:"placeholder",editor:"StaticText",caption:"Placeholder",condition(){return e.get_static_property("input_type")==="date"&&e.get_static_property("overwrite_placeholder")},pretty:{short_caption:false,section:"InputContent"}},{name:"date_format",caption:"Date format",editor:"Dropdown",set:pe().sets.get_set("Object")({number2:"1/15/2013",us_short:"January 15, 2013",us_long:"Tuesday, January 15, 2013",number1:"15/1/2013",alpha:"15 January, 2013",alphalong:"Tuesday, 15 January, 2013",alphashort:"15-Jan-2013",custom:"Custom"}),pretty:{section:"InputContent"}},{name:"custom_format",caption:"Custom format",editor:"StaticText",condition:"date_format is custom",pretty:{section:"InputContent"}},{name:"start_monday",caption:"Start the week on Monday",editor:"Checkbox",pretty:{section:"InputContent"}},{name:"show_month_year_picker",caption:"Display dropdowns to pick month/year",editor:"Checkbox",pretty:{section:"InputContent"}},{name:"time_interval",caption:"Time interval",editor:"StaticNumber",condition:"input_type is date_time",pretty:{section:"InputContent"}},{name:"time_format",caption:"Time format",editor:"Dropdown",condition:"input_type is date_time",set:pe().sets.get_set("Object")({full:"17:26",ampm:"5:26 PM"}),pretty:{section:"InputContent"}},{name:"min_date",caption:"Minimum date",editor:"Basic",value:"date",optional:true,pretty:{section:"InputContent"}},{name:"max_date",caption:"Maximum date",editor:"Basic",value:"date",optional:true,pretty:{section:"InputContent"}},{name:"min_hour",caption:"Minimum hour",editor:"Basic",value:"number",optional:true,condition:"input_type is date_time",pretty:{section:"InputContent"}},{name:"max_hour",caption:"Maximum hour",editor:"Basic",value:"number",optional:true,condition:"input_type is date_time",pretty:{section:"InputContent"}}].concat(H(),V()))},mandatory_sections(){return["InputContent","Font"]}};const ie={fields(e){const t=q.container_fields(e).concat(Z(e));if(U(e)){t.push({name:"collapse_when_hidden",caption:"Collapse this element's height when hidden",editor:"Checkbox",pretty:{short_caption:false,section:"Position"}})}return t.concat(q.group_element_fields(e))},mandatory_sections(){return["GroupType","Background"]}};r.Group=ie;r.GroupWithFocus={fields(e){return[{name:"information",editor:"Label",label_text:"This Group With Focus is depreciated. You should replace it with the new one that lets you pick an element to locate the group.",pretty:{short_caption:false,section:"GroupType"}}].concat(ie.fields(e).concat(u.visibility_property(e)))},mandatory_sections:ie.mandatory_sections};r.GroupFocus={fields(e){return[{name:"reference",caption:"Reference element",editor:"Dropdown",set:pe().sets.get_set("Filtered")(pe().sets.get_set("PageElements")(e,undefined,undefined,true),(t=>{const n=e.json.path();if(o.element(t.value).json.path().indexOf(n)!==-1){return false}else{return true}})),pretty:{short_caption:false,section:"GroupType"}},{name:"offset_top",caption:"Offset top",editor:"StaticNumber",pretty:{short_caption:false,section:"GroupType"}},{name:"offset_left",caption:"Offset left",editor:"StaticNumber",pretty:{short_caption:false,section:"GroupType"}}].concat(q.container_fields(e))},mandatory_sections:ie.mandatory_sections};r.Popup={fields(e){let t=q.container_fields(e);t=t.concat(p.get_greyout_properties());t=t.concat(Z(e));return t},not_draggable(){return true}};r.FloatingGroup={fields(e){return q.container_fields(e).concat(g.floating_group_fields(e).concat(Z(e)))},mandatory_sections(){return["GroupType","FloatingReference","Background"]}};function se(e,t){const n={width:"column",height:"row"};const r={width:"horizontal",height:"vertical"};const i=`fixed_${n[e]}s`;return[{name:i,caption:`Set fixed number of ${n[e]}s`,editor:"Checkbox",condition:F,pretty:{section:"RepeatingGroupLayout"},include_in_redesign:false},{name:`cell_min_${e}_css`,caption:`Min ${e} of ${n[e]}`,editor:"CSSDimension",condition(e){return F(e)&&!e.get_static_property(i)},no_states:t.get_static_property(i),pretty:{section:"RepeatingGroupLayout"},include_in_redesign:false},{name:`auto_fit_${n[e]}`,caption:`Stretch ${n[e]}s to fill ${r[e]} space`,editor:"Checkbox",condition(t){if(U(t)){return false}if(ce(t)&&e==="height"){return false}return!t.get_static_property(i)},pretty:{section:"RepeatingGroupLayout"}}]}function oe(e){if(!e.get_static_property("fixed_rows")&&!e.get_static_property("fixed_columns")){return e.get_static_property("scroll_direction")}if(e.get_static_property("fixed_columns")){return"vertical"}else{return"horizontal"}}function ae(e){return oe(e)==="flex_row"}function le(e){return!e.get_static_property("fixed_rows")&&oe(e)==="vertical"&&!e.get_static_property("auto_fit_row")}function ce(e){return le(e)&&e.get_static_property("masonry")}function ue(e){var t;let{element:n,typeMessage:r}=e;let i=n.get_static_property("group_type");if(i!=null){i="."+i}const s="list"+((t=i)!=null?t:"*");let a;if(o.has_feature_enabled("reorg_component_selection")){a=X()}else{a=pe().sets.get_set("DisplayableInListValues")(true)}return[{name:"group_type",caption:"Type of content",editor:"Dropdown",set:a,pretty:{short_caption:false,section:"GroupType"}},{name:"data_source",caption:"Data source",editor:"Basic",value:s,optional:true,pretty:{short_caption:false,section:"GroupType"},value_setter:{property_modifier(e){return q.set_group_type_list_elements(n,e,"group_type")},no_need_to_show_message(){return q.no_need_to_show_message_container_elements(n)},generate_message(e){return q.get_generate_message_list_elements(n,e,"group_type",r,"setting")}}}]}function de(e){let{condition:t,section:n,prefix:r}=e;function i(){if(r.includes("vertical")){return"Vertical "}else if(r.includes("horizontal")){return"Horizontal "}return""}return[{name:`${r}separator_label`,label_text:`${i()}Separators`,editor:"Label",condition:t,pretty:{section:n}},{name:`${r}separator_style`,caption:"Style",editor:"Dropdown",set:pe().sets.get_set("Object")({none:"None",solid:"Solid",dotted:"Dotted",dashed:"Dashed",double:"Double",groove:"Groove",ridge:"Ridge",inset:"Inset",outset:"Outset"}),pretty:{section:n,dropdown_width:"short"},condition:t},{name:`${r}separator_width`,caption:"Width",editor:"Dropdown",set:pe().sets.get_set("Integer")([0,1,2,4,10,20]),numerical_step:1,condition(e){return t(e)&&e.get_static_property(`${r}separator_style`)!=="none"},pretty:{section:n,short_caption:true}},{name:`${r}separator_color`,caption:"Color",editor:"Color",condition(e){return t(e)&&e.get_static_property(`${r}separator_style`)!=="none"},pretty:{section:n,short_caption:true}}]}r.RepeatingGroup={primary_field(){},fields(e){const t=S.autorun_top((()=>f._get_cell_width(e)));return[...ue({element:e,typeMessage:"this repeating group's content type"}),{name:"layout_style",caption:"Layout style",editor:"Dropdown",set:pe().sets.get_set("Object")({infinite_scroll:"Vertical scrolling",vertical_extendable:"Ext. vertical scrolling",show_all:"Full list",limit_items:"Fixed number of cells",horizontal_scroll:"Horizontal scrolling"}),condition:U,pretty:{section:"RepeatingGroupLayout",short_caption:true}}].concat(se("height",e)).concat([{name:"rows",caption:"Rows",editor:"Dropdown",set:pe().sets.get_set("Integer")([1,2,3,4,5,6,7,8,9,10,15,20]),numerical_step:1,no_states:U(e),condition(e){if(F(e)){return e.get_static_property("fixed_rows")}else{return e.get_static_property("layout_style")!=="horizontal_scroll"}},pretty:{section:"RepeatingGroupLayout"}}].concat(se("width",e)).concat([{name:"columns",caption:"Columns",editor:"Dropdown",set:pe().sets.get_set("Integer")([1,2,3,4,5,6,7,8,9,10]),numerical_step:1,no_states:U(e),condition(e){return U(e)||e.get_static_property("fixed_columns")},pretty:{section:"RepeatingGroupLayout"}},{name:"information",label_text:"Your design shows more than 100 cells, this can lead to very slow designs. Please check your settings.",editor:"Label",condition(e){return e.get_static_property("rows",true)*e.get_static_property("columns",true)>100},pretty:{section:"RepeatingGroupLayout"}},{name:"scroll_direction",caption:"Scroll direction",editor:"Dropdown",set:pe().sets.get_set("Object")({vertical:"Vertical",horizontal:"Horizontal",flex_row:"Wrapped horizontally"}),condition(e){if(U(e)){return false}return!e.get_static_property("fixed_rows")&&!e.get_static_property("fixed_columns")},pretty:{section:"RepeatingGroupLayout"}},{name:"show_all_items",caption:"Show all items immediately",editor:"Checkbox",condition(e){if(U(e)){return false}return!(e.get_static_property("fixed_rows")&&e.get_static_property("fixed_columns"))},pretty:{section:"RepeatingGroupLayout"}},{name:"stable_pagination",caption:"Show partial list on last page if needed",condition(e){if(F(e)){return e.get_static_property("fixed_rows")&&e.get_static_property("fixed_columns")}else{return e.get_static_property("layout_style")==="limit_items"}},editor:"Checkbox",pretty:{section:"RepeatingGroupLayout"}},...de({condition:e=>!(F(e)&&(ae(e)||ce(e))),section:"RepeatingGroupLayout",prefix:""}),{name:"masonry",caption:"Display items as masonry grid",editor:"Checkbox",condition(e){return F(e)&&le(e)},on_change(){const t=e.get_static_property("masonry");s.track(B,{app:o.appname(),state:t?"enabled":"disabled"})},pretty:{section:"RepeatingGroupLayout"}},{name:"row_cell_gap",caption:"Row cell gap (px)",editor:"StaticNumber",condition(e){return F(e)&&(ae(e)||ce(e))},integer:true,pretty:{section:"RepeatingGroupLayout"}},{name:"column_cell_gap",caption:"Column cell gap (px)",editor:"StaticNumber",condition(e){return F(e)&&(ae(e)||ce(e))},integer:true,pretty:{section:"RepeatingGroupLayout"}},{name:"fixed_width",caption:"This repeating group has a fixed width",editor:"Checkbox",condition(e){var t;return((t=e.root())==null?void 0:t.use_responsive_algorithm())&&U(e)},pretty:{section:"RepeatingGroupLayout"}},{name:"cell_min_width",caption:"Cell min width (current width: "+Math.floor(t)+"px)",integer:true,editor:"StaticNumber",condition(e){var t;return((t=e.root())==null?void 0:t.use_responsive_algorithm())&&U(e)&&!e.get_static_property("fixed_width")},pretty:{section:"RepeatingGroupLayout"}},{name:"use_max_width",caption:"Apply a max width when the page is stretched",editor:"Checkbox",condition(e){var t;return U(e)&&((t=e.root())==null?void 0:t.use_responsive_algorithm())&&!e.get_static_property("fixed_width")},pretty:{section:"RepeatingGroupLayout"}},{name:"max_width",caption:"Maximum width (% of current width)",editor:"StaticNumber",integer:true,condition(e){var t;return U(e)&&((t=e.root())==null?void 0:t.use_responsive_algorithm())&&!e.get_static_property("fixed_width")&&e.get_static_property("use_max_width")},pretty:{section:"RepeatingGroupLayout"}},{name:"allow_more_than_one_colum",caption:"Allow more than one column when stretched",editor:"Checkbox",condition(e){var t;return U(e)&&((t=e.root())==null?void 0:t.use_responsive_algorithm())&&!e.get_static_property("fixed_width")&&e.get_static_property("columns",true)===1},pretty:{section:"RepeatingGroupLayout"}}]))},mandatory_sections(){return["GroupType","RepeatingGroupLayout","Position"]}};r.Table={fields(e){return[{name:"table_direction",caption:"Table direction",editor:"Dropdown",set:pe().sets.get_set("Object")({vertical:"Vertical",horizontal:"Horizontal"}),pretty:{short_caption:false,section:"TableProperties"}},...ue({element:e,typeMessage:"this table's content type"}),...de({condition:()=>true,section:"TableGroupLayout",prefix:"vertical_"}),...de({condition:()=>true,section:"TableGroupLayout",prefix:"horizontal_"})]}};r.TableMainAxis={fields(e){const t=R(e.parent());return[{name:"add_main_axis",button_caption:`Add ${t?"row":"column"}`,optional:true,editor:"Button",pretty:{short_caption:false,section:"ElementMetaActions",width:"small"},click_cb(){L(e.id(),"after")}}]}};r.TableCrossAxis={fields(e){const t=R(e.parent());return[{name:"make_sticky",caption:`Make this ${t?"column":"row"} sticky`,editor:"Checkbox",pretty:{short_caption:false,section:"TableProperties"},condition(e){return!e.get_static_property("cross_axis_repeat")}},{name:"fixed_number_repeating_axis",caption:`Set fixed number of repeating ${t?"columns":"rows"}`,editor:"Checkbox",pretty:{short_caption:false,section:"TableProperties"},condition(e){return e.get_static_property("cross_axis_repeat")}},{name:"fixed_number_repeating_axis_count",caption:`${t?"Column":"Row"} count`,editor:"StaticNumber",integer:true,pretty:{short_caption:false,section:"TableProperties"},condition(e){return e.get_static_property("cross_axis_repeat")&&e.get_static_property("fixed_number_repeating_axis")}},{name:"add_static_axis",button_caption:`Add static ${t?"column":"row"}`,optional:true,editor:"Button",pretty:{short_caption:false,section:"ElementMetaActions",width:"small"},condition(e){return!e.get_static_property("cross_axis_repeat")},click_cb(){z(e.id(),"after")}}]}};r.TableCell={fields(e){return[]}};r.GoogleMap={fields(e){let t,n;const r=e.get_static_property("marker_type");if(r==="list"){var i;let r;t=e.get_static_property("marker_data_type");if(t!=null){r="."+t}n="list"+((i=r)!=null?i:"*")}else{n="geographic_address"}const s={normal:"Normal"};for(const e in h.google_map_styles){const t=h.google_map_styles[e];s[e]=t.name}s._custom="Custom style";let a;if(o.has_feature_enabled("reorg_component_selection")){a=X().filter(Y().no_primitives).add_items(["Basic Types",[{display:"geographic address",value:"geographic_address"}]])}else{a=pe().sets.get_set("DisplayableInListValues")(undefined,undefined,["geographic_address"])}return[{name:"marker_type",caption:"Number of markers",editor:"Dropdown",set:pe().sets.get_set("Object")({none:"None",single:"Single",list:"List"}),pretty:{section:"MapContent"}},{name:"marker_data_type",caption:"Type of markers",editor:"Dropdown",set:a,condition:"marker_type is list",pretty:{section:"MapContent"}},{name:"data_source",caption:r==="single"?"Marker address":r==="none"?"Initial position":"Data source",editor:"Basic",value:n,optional:true,pretty:{short_caption:false,section:"MapContent"},value_setter:{property_modifier(t){if(r==="list"){return q.set_group_type_list_elements(e,t,"marker_data_type")}else{const t=o.element(e.property("data_source").element_id());if((t==null?void 0:t.type())==="Input"){t.set_property("content_format","geographic_address");return t.commit()}}},no_need_to_show_message(){if(!e.property("data_source").is_empty()&&e.property("data_source").type()==="GetElement"&&e.property("data_source").element_id()){const t=o.element(e.property("data_source").element_id());const n=t==null?void 0:t.get_static_property("content_format");if(n&&n!=="geographic_address"){return true}}return q.no_need_to_show_message_container_elements(e)},generate_message(t){if(r==="list"){return q.get_generate_message_list_elements(e,t,"marker_data_type","this map's marker type","setting")}}}},{name:"location_field",caption:"Address field",editor:"Dropdown",set:pe().sets.get_set("Filtered")(pe().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>_e.get(t).get_message(e.value).ret_btype().id()==="geographic_address")),condition(){return r==="list"&&t!=null&&t!=="geographic_address"},pretty:{short_caption:false,section:"MapContent"}},{name:"show_info_window",caption:"Show title window",editor:"Dropdown",set:pe().sets.get_set("Object")({no:"No",on_click:"On click",always:"Always"}),condition(){return r==="list"&&t!=="geographic_address"},on_change(t){if(e.exists()){const n={name:"GoogleMapsMarker"};if(["on_click","always"].includes(t)){if(e.property("marker_caption_expression").is_empty()){return e.property("marker_caption_expression").json.set(x.RAW.TextExpression([{type:"InjectedValue"}]),n)}}}},pretty:{short_caption:false,section:"MapContent"}},{name:"marker_caption_expression",caption:"Marker caption",editor:"ShortText",condition(){return r==="list"&&["on_click","always"].includes(e.get_static_property("show_info_window"))&&t!=null&&t!=="geographic_address"},pretty:{short_caption:false,section:"MapContent"}},{name:"autoclose",caption:"Auto-close window when another is clicked on",editor:"Checkbox",condition(){return e.get_static_property("show_info_window")==="on_click"},pretty:{short_caption:false,section:"MapContent"}},{name:"information",label_text:"Your application is on a domain and should be using its own Google Map API Key. Click here to set it.",click_cb(){$(T).click();return pe().settings_editor.settings_canvas.open_tab("General")},editor:"Label",condition(e){return o.domain()&&o.get_public_setting("general_keys.google_map_key")==null},pretty:{short_caption:false,section:"MapContent"}},{name:"map_type",caption:"Map type",editor:"Dropdown",set:pe().sets.get_set("Object")({ROADMAP:"Roadmap",HYBRID:"Hybrid",SATELLITE:"Satellite",TERRAIN:"Terrain"}),pretty:{section:"MapFormat"}},{name:"map_style",caption:"Map style",editor:"Dropdown",set:pe().sets.get_set("Object")(s),ignore_issue_checker:true,pretty:{section:"MapFormat"}},{name:"custom_style",caption:'Style JSON - See <a href="https://snazzymaps.com/" target="_blank">snazzymaps.com</a> for examples',editor:"StaticMultiLineText",condition:"map_style is _custom",pretty:{section:"MapFormat"}},{name:"allow_zoom_drag",caption:"Allow zooming and dragging",editor:"Checkbox",pretty:{section:"MapFormat"}},{name:"disable_zoom_scroll",caption:"Disable zooming on scroll",editor:"Checkbox",condition:"allow_zoom_drag",pretty:{section:"MapFormat"}},{name:"manual_setting",caption:"Set center and zoom manually",editor:"Checkbox",condition(){return r==="list"},pretty:{section:"MapFormat"}},{name:"center",caption:"Map centered on",editor:"Basic",value:"geographic_address",condition(){return r==="list"&&e.get_static_property("manual_setting")},pretty:{section:"MapFormat"}},{name:"initial_zoom",caption:"Initial zoom",editor:"Dropdown",set:pe().sets.get_set("Integer")([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]),numerical_step:1,condition(){return["single","none"].includes(r)||r==="list"&&e.get_static_property("manual_setting")},pretty:{section:"MapFormat"}},{name:"use_customized_marker_icon",caption:"Use customized marker icon",editor:"Checkbox",condition(){return r==="single"},pretty:{section:"MapFormat"}},{name:"use_customized_marker_icon_for_list",caption:"Customized icon",editor:"Dropdown",set:pe().sets.get_set("Object")(t!=="geographic_address"?{no:"No",upload:"Upload custom",field:"Data dependent"}:{no:"No",upload:"Upload custom"}),condition(){return r==="list"},pretty:{section:"MapFormat"}},{name:"custom_marker_icon",editor:"Image",caption:"Customized icon",condition(){return r==="single"&&e.get_static_property("use_customized_marker_icon")||r==="list"&&e.get_static_property("use_customized_marker_icon_for_list")==="upload"},pretty:{section:"MapFormat"}},{name:"custom_marker_field",caption:"Icon field",editor:"Dropdown",set:pe().sets.get_set("Filtered")(pe().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>_e.get(t).get_message(e.value).ret_btype().id()==="image")),condition(){return r==="list"&&e.get_static_property("use_customized_marker_icon_for_list")==="field"&&t!=null&&t!=="geographic_address"},pretty:{section:"MapFormat"}},{name:"custom_selected_icon",caption:"Custom selected icon",editor:"Dropdown",set:pe().sets.get_set("Object")(t!=="geographic_address"?{no:"No",upload:"Upload custom",field:"Data dependent"}:{no:"No",upload:"Upload custom"}),condition(){return r==="list"},pretty:{section:"MapFormat"}},{name:"custom_selected_icon_image",editor:"Image",caption:"Selected icon",condition(){return r==="list"&&e.get_static_property("custom_selected_icon")==="upload"},pretty:{section:"MapFormat"}},{name:"custom_selected_icon_field",caption:"Selected icon field",editor:"Dropdown",set:pe().sets.get_set("Filtered")(pe().sets.get_set("MessagesWithoutArguments")({btype_name:t}),(e=>_e.get(t).get_message(e.value).ret_btype().id()==="image")),condition(){return r==="list"&&e.get_static_property("custom_selected_icon")==="field"&&t!=null&&t!=="geographic_address"},pretty:{section:"MapFormat"}}].concat(Q())},mandatory_sections(){return["MapContent","MapFormat"]}};r.Page={fields(e){var t,n,r,i;const a=e.get_static_property("page_item_type");function l(e){if(e.value==="Slug"){return false}if(_e.get(a).get_message(e.value).ret_btype().id()!=="text"){return false}return true}let c;if(o.has_feature_enabled("reorg_component_selection")){c=N()}else{c=pe().sets.get_set("CustomTypes")(true,false)}const u=P()?"_overridden":"";const d=[{name:"page_item_type",caption:"Type of content",editor:"Dropdown",set:c,optional:true,pretty:{short_caption:false,section:"GroupType"}},{name:"readable_field",caption:"Backup field for URL",editor:"Dropdown",set:pe().sets.get_set("Filtered")(pe().sets.get_set("CustomFields")({btype_name:a}),l),optional:true,condition:"page_item_type",pretty:{short_caption:false,section:"GroupType"}},{name:`tz_type${u}`,caption:"Time zone selection",editor:"Dropdown",set:pe().sets.get_set("Object")({browser:"User's current timezone",static:"Static choice"}),default:"browser",condition:()=>o.has_advanced_feature_enabled("timezone_controls_page"),pretty:{short_caption:false,section:"GroupType"}},{name:`tz_static${u}`,caption:"Timezone ID",editor:"Dropdown",set:pe().sets.get_set("List")(K.tz.names()),condition(e){return o.has_advanced_feature_enabled("timezone_controls_page")&&e.get_static_property(`tz_type${u}`)==="static"},pretty:{section:"GroupType"}},{name:"title",caption:"Page title",editor:"ShortText",pretty:{section:"PageTitle"}},{name:"native_app",caption:"This page is a native app",editor:"Checkbox",optional:true,on_change(e){if(e){const e=`You're going to use this page as a native app. You should keep a few things in mind when you're building a native app.<br>\n1) You should change the page width to something like 640 and 320 pixels.<br>\n2) You shouldn't change pages in this app. Instead, use groups that you hide and show to take the user to other sections.<br>\n3) Check our plugin elements for elements that feel more native.<br>\nDon't hesitate to ask on the <a href="https://forum.bubble.io" target="_blank">Bubble Forum</a> for questions. As we're in early beta it's the best way to get help.`;return window.MessagePanel({title:"Building a Native App",message:e,additional_class:"native-app-instructions"})}},pretty:{section:"PageTitle"}},{name:"mobile_page",caption:"Mobile version",editor:"Dropdown",set:pe().sets.get_set("Pages")(),optional:true,condition(){return e.get_static_property("native_app")!==true},pretty:{section:"PageTitle"}},{name:"native_app_name",caption:"Native app name",editor:"StaticText",condition:"native_app",pretty:{section:"PageTitle"}},{name:"delete_page",button_caption:"Delete this page",editor:"Button",optional:true,click_cb(){if(e.is_protected()){return}return window.ConfirmPanel({title:"Delete page",message:`Delete page ${e.get_name()}?`,cb_yes(){e.delete({user_action:"Delete Page Prompt"});return e.commit()}})},condition(){return!e.is_protected()},pretty:{section:"ElementMetaActions",no_caption:true}},{name:"meta_title",caption:(t=window)!=null&&t.is_maison?"SEO title":"Title (for SEO / FB)",editor:"ShortText",optional:true,no_rich_text_editing:true,pretty:{section:"SearchEngineData"}},{name:"meta_description",caption:(n=window)!=null&&n.is_maison?"SEO description":"Description (for SEO / FB)",editor:"LongText",optional:true,no_rich_text_editing:true,pretty:{section:"SearchEngineData"}},{name:"meta_image",caption:"Image (for FB)",editor:"Basic",value:"text",optional:true,pretty:{section:"SearchEngineData"},include_in_redesign:false},{name:"meta_image",caption:"SEO Link image",editor:"DynamicImage",value:"text",optional:true,pretty:{section:"SearchEngineData",no_caption:false},include_in_redesign:true},{name:"html_header",caption:"Page HTML Header",editor:"LongText",optional:true,html_code_editor:true,pretty:{section:"SearchEngineData"}}];if(U(e)){d.push(...[{name:"new_responsive",caption:"Enable responsive page rendering engine",editor:"Checkbox",condition(){return!o.get_public_setting("no_legacy_responsive")},pretty:{section:"ShortPosition"}},{name:"upgrade_responsive_version",button_caption:"Upgrade responsive",editor:"Button",optional:true,condition(e){var t;return(t=e.root())==null?void 0:t.use_responsive_algorithm()},click_cb(){window.start_responsive_upgrade(e)},pretty:{section:"ShortPosition",no_caption:true}}]||[])}d.push({name:"fixed_width",caption:(r=window)!=null&&r.is_maison?"Make this page fixed-width":"Make this element fixed-width",editor:"Checkbox",condition(e){var t;return((t=e.root())==null?void 0:t.use_responsive_algorithm())&&U(e)},pretty:{section:"ShortPosition"},on_change(){if(!e.get_static_property("fixed_width")){return s.track("Fixed Width Disabled",{app:o.appname(),page_name:e.name()})}}});if(U(e)){d.push({name:"min_width",caption:"Minimum width (% of current width)",editor:"StaticNumber",validation_fn(e){return e<100},integer:true,condition(e){return(e==null?void 0:e.use_responsive_algorithm())&&!e.get_static_property("fixed_width")},pretty:{section:"ShortPosition"}})}d.push(...M._background_properties_getter("backdrop_","BackdropBackground")||[]);d.push(...[{name:"backdrop_video_source",caption:'Video file <a href="http://www.coverr.co/" target="_blank">(check Coverr for free videos)</a>',editor:"DynamicFile",file_type:"mp4",condition:"backdrop_background_style is video",pretty:{section:"BackdropBackground"}},{name:"backdrop_video_image_fallback",caption:"Fallback image",editor:"DynamicImage",condition:"backdrop_background_style is video",pretty:{section:"BackdropBackground"}},{name:"backdrop_video_silence",caption:"Play video silent",editor:"Checkbox",condition:"backdrop_background_style is video",pretty:{section:"BackdropBackground"}},{name:"backdrop_image_paralax",caption:"Apply a parallax effect (desktop only)",editor:"Checkbox",condition:"backdrop_background_style is image",pretty:{section:"BackdropBackground"}},{name:"backdrop_paralax_speed",caption:"Parallax speed",numerical_step:.1,set:pe().sets.get_set("Numeric")([0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]),editor:"Dropdown",condition(){return e.get_static_property("backdrop_image_paralax")&&e.get_static_property("backdrop_background_style")==="image"},pretty:{section:"BackdropBackground"}}]||[]);const p=[{name:"stripe_height",caption:"Stripe height",editor:"Dropdown",set:pe().sets.get_set("Integer")([10,20,40,80,160]),numerical_step:1,default:80},{name:"floating",caption:"Floating stripe",editor:"Checkbox"},{name:"floating_reference",editor:"Dropdown",condition:"floating",default:"top",set:pe().sets.get_set("Object")({top:"at the top",bottom:"at the bottom"})}];p.push(...(new A.Background).get_properties(_.stripe_defaults)||[]);p.push(...new A.Border(undefined,undefined,{only_main_border:true}).get_properties(_.stripe_defaults)||[]);p.push(...(new A.BoxShadow).get_properties(_.stripe_defaults)||[]);d.push({name:"stripes",condition(){return!(e!=null&&e.use_responsive_algorithm())&&!o.get_public_setting("no_legacy_responsive")},editor:"ObjectList",button_caption:"Add a stripe",add_move_up_down_btn:true,remove_caption:"remove this stripe",move_up_caption:"move up",move_down_caption:"move down",sub_properties(e){return p},pretty:{section:"Stripes"}});d.push({name:"preset_width",caption:"Preset page width",editor:"Dropdown",set:pe().sets.get_set("Object")(_.preset_page_width_list),pretty:{section:"ShortPosition"}});d.push({name:"page_folder",caption:(i=window)!=null&&i.is_maison?"Page tag":"Page folder",editor:"Dropdown",set:pe().sets.get_set("PageFolders")(),pretty:{section:"PageFolder"}});return d},mandatory_sections(e){return["PageTitle","GroupType","Background","Stripe","ShortPosition"]}};const pe=e("./../lib");const _e=e("./../lang/btypes");const fe=e("../services/is_installed");const he=e("../services/shared/plugin_registry");const me=e("../services/shared/plugin_getter")},{"../client/analytics":20,"../constants/currency":56,"../constants/segment_events":85,"../core/font_awesome_icons":382,"../editor/element_actions/tables":571,"../lang/appquery":651,"../lang/btypes_dropdowns":654,"../lang/elements":680,"../lang/evaluation/element_eval":690,"../lang/lang":714,"../lang/timezone_override_settings":729,"../safe_require":777,"../services/is_installed":781,"../services/shared/plugin_getter":783,"../services/shared/plugin_registry":784,"../shared/apps_utilities":788,"../shared/images":796,"../shared/responsive/responsive_algorithm":802,"../shared/responsive/responsive_layout":804,"../u":823,"./../editor/css":560,"./../lang/btypes":653,"./../lib":741,"./core_elements/components/utils/table_element":281,"./core_elements/core_elements_utilities/element_optional_utils":283,"./core_elements/core_elements_utilities/element_registry":284,"./core_elements/core_elements_utilities/element_transformer":285,"./core_elements/core_elements_utilities/element_visibility":287,"./core_elements/shared/floating_groups":359,"./core_elements/shared/inputs":364,"./core_elements/shared/pages":366,"./core_elements/shared/popups":368,"./core_elements/shared/radiobuttons":369,"./core_elements/shared/repeating_groups":371,"./custom_tz_utilities":380,"./input_mask":383,"./property_applications":412,"./property_applications/property_applications_fields":413,"./shared_fields":414,"core-js/modules/web.dom-collections.iterator.js":1123,mathjs:2169,pluralize:2275}],376:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.add_event=o;n.all_events=c;n.clear_event=a;n.has_event=l;n.relevant_elements=u;n.relevant_events=d;e("core-js/modules/web.dom-collections.iterator.js");var r=i(e("../../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./core/core_events/event_element_mapping",n);const s=new Map;function o(e,t){let n=s.get(e);if(!n){n=new Set;s.set(e,n)}if(t){n.add(t)}}function a(e){var t;(t=s.get(e))==null?void 0:t.clear()}function l(e,t){var n,r;return(n=(r=s.get(e))==null?void 0:r.has(t))!=null?n:false}function c(){return[...s.keys()]}function u(e){var t;return[...(t=s.get(e))!=null?t:[]]}function d(e){return c().filter((t=>l(t,e)))}},{"../../safe_require":777,"core-js/modules/web.dom-collections.iterator.js":1123}],377:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r;const i=e("../../u");const s=e("../../lib");const o=e("../../safe_require");const a=e("../../u/shared/b_object");const l=e("../../logger");const c=e("../../constants/workflow");const u=e("../../constants/core");const d=e("../../lang/appquery");const p=e("../core_datasources/utilities/core_ds_workflow_utilities");const _=e("../custom_tz_utilities");const f=e("../../lang/evaluation/FrozenState");const h=e("../../lang/evaluation/page_state");const m=e("../../u/shared/decaf");const g=e("../../services/shared/service_type_parser");const v=e("./event_element_mapping");const{customTypes:b,allowableBtypes:y,filters:w,displayableInListBtypes:x}=e("../../lang/btypes_dropdowns");const j=n;o.safe_register("./core/core_events",j);function A(){const e=v.all_events().filter((e=>e!=="OnError"));e.push("OnError");return e}j.get_events_for_an_element=function(e){const t=v.relevant_events(e);return i.sort_array(t,A())};function M(){return{General:[{type:"LoggedIn"},{type:"LoggedOut"},{type:"PageLoaded"},{type:"DoInterval"},{type:"ConditionTrue"},{type:"OnPageError"}]}}function E(){return{Custom:[{type:"CustomEvent"}]}}j.get_root_events=M;(r=j.plugin_general_events)!=null?r:j.plugin_general_events={};const k=j.make_gen_event=function(e,t){j[e]=t;t.register=function(t,n){const r=()=>{const e={element:n};const r=s().workflow.run_workflows(e,[t]);return r.callback((e=>j.handle_uncaught_error({original_error:e,caught_from:c.ERROR_SOURCES.GENERAL_WORKFLOW,cb(e){if(e){console.log("Workflow failed:");return l.log(e)}}})))};s().workflow.on_event(e,r);const i=()=>s().workflow.off_event(e,r);return i}};const O=j.make_element_event=function(e,t,n,r){var i,o;if(!n){j[e]=t}(i=t.field_names)!=null?i:t.field_names={element_id:{}};const a=t._fields;t.fields=function(e){var t,n,r;let i;if((t=e.owner())!=null&&(n=t.is_custom_definition)!=null&&n.call(t)){if(["PopupClosed","PopupOpened"].includes(e.type())){if(e.owner().get_static_property("element_type")==="Popup"){i=true}else{i=false}}else{i=true}}else{i=false}const o=v.relevant_elements(e.type());const l=(r=s().sets)==null?void 0:r.get_set("PageElementsByType")(e,o,i,o);const c=[{name:"element_id",caption:"Element",editor:"Dropdown",set:l}];if(a!=null){var u;c.push(...m.array_from((u=a(e))!=null?u:[]))}return c};const l=(o=t._display)!=null?o:t.display;t.display=function(e){var n,i,s,o;const a=!((n=d.element(e==null?void 0:e.element_id()))!=null&&n.get_name())&&!t.element_name;const c=a?"(testing)":" (testing) ";const u=`${(i=(s=(o=d.element(e==null?void 0:e.element_id()))==null?void 0:o.get_name())!=null?s:t.element_name)!=null?i:"An element "}`+`${r?c:""}`;return u+l(e)};t.register=function(){};t.deferrable=true};k("LoggedIn",{display(){return"User is logged in"},can_redirect:true,server_side_redirect(){return s().current_user().is_logged_in()}});k("LoggedOut",{display(){return"User is logged out"},can_redirect:true,server_side_redirect(){return!s().current_user().is_logged_in()}});k("PageLoaded",{display(){return"Page is loaded"},can_redirect:true,server_side_redirect(){return true}});const S=i.MakeSwitch(null,"conditiontrue is running");S.turn_on();j.ConditionTrue={field_names:{run_when:{default:"just_once"}},display(e){const t=e==null?void 0:e.property("condition").get_tree_display();return"Do when "+(t||"condition is true")},can_redirect:false,never_show_condition:true,fields(){return[{name:"run_when",caption:"Run this ",editor:"Dropdown",set:s().sets.get_set("Object")({just_once:"Just once",every_time:"Every time"})}]},condition_not_optional:true,register(e,t){const n=e.get_static_property("run_when");let r=null;i.WaitFor(t.get_is_ready_key(),(()=>{let o=new Date(i.timestamp());r=i.Watcher((()=>{i.ensure_ready(S);if(!o){o=new Date(i.timestamp())}const n={element:t,datasources:h.get_basic_datasources(t.element.root()),_current_date_time:o};new f(n);return[F.evaluate_event_condition(e,n),n]}));let a=true;r.on_value((t=>{let[i,u]=t;o=null;if(i){if(a){S.turn_off();s().workflow.run_workflows(u,[e]).callback((e=>j.handle_uncaught_error({original_error:e,caught_from:c.ERROR_SOURCES.GENERAL_WORKFLOW,cb(e){if(e){l.log(e)}return S.turn_on()}})));a=false;if(n!=="every_time"){r.destroy()}}}else{a=true}}))}));const o=()=>{var e;return(e=r)==null?void 0:e.destroy()};return o}};let D=[];let C=0;j.OnPageError={display(e){return"An unhandled error occurs"},fields(){return[{name:"caught_error_origins",caption:"Catch ",editor:"Dropdown",set:s().sets.get_set("Object")(c.ERROR_CATCHER_TYPES)}]},field_names:{caught_error_origins:{default:c.DEFAULT_CATCHER_TYPE}},register(e,t){const n=C;C++;const r=e.get_static_property("caught_error_origins");D.push({id:n,workflow:e,element_instance:t,error_origin:r});const i=()=>{D=D.filter((e=>e.id!==n))};return i}};j.build_wf_error_object=function(e){let t=e.message;if(!t){if(e instanceof i.errors.ExpectedError){t="MISCELLANEOUS"}else{t="TEMPORARY_BUG"}}const n=l.human_friendly(e);return{code:t,message:n}};j.handle_uncaught_error=function(e){let{original_error:t,caught_from:n,cb:r}=e;if(t==null){r(null);return}if(D.length===0){r(t);return}const o=j.build_wf_error_object(t);const a=[];for(const{workflow:e,element_instance:t,error_origin:r}of D){const i=r!=null?r:c.DEFAULT_CATCHER_TYPES;const l=c.CAUGHT_ERROR_SOURCES[i];if(n!=null&&!l.includes(n)){continue}const d={element:t,datasources:h.get_basic_datasources(t.element.root())};const _={};_[u.LEGACY_PARAM_ID]=new B(o,null,"sys.error");d.datasources.get_wf_param=p.generate_wf_param_datasource(_);a.push(s().workflow.run_workflows(d,[e],true))}if(a.length===0){r(t)}i.promise_array(a).callback(((e,n)=>{if(e){r(e);return}for(const e of n){if(e.length!==0){r(null);return}}r(t)}))};j.DoInterval={display(e){var t;return"Do every "+((t=e==null?void 0:e.get_static_property("interval"))!=null?t:"X")+" seconds"},field_names:{interval:{default:5}},fields(){return[{name:"interval",caption:"Interval (seconds)",editor:"StaticNumber",optional:false}]},register(e,t){const n=e.get_static_property("interval");let r=true;function o(){if(r){setTimeout((()=>{const n={element:t};s().workflow.run_workflows(n,[e]).callback((e=>j.handle_uncaught_error({original_error:e,caught_from:c.ERROR_SOURCES.GENERAL_WORKFLOW,cb(){}})));i.WaitFor(s().workflow.everything_done_key(),o)}),n*1e3)}}o();const a=()=>{r=false};return a}};O("ButtonClicked",{display(){return" is clicked"}});O("InputChanged",{display(){return"'s value is changed"},element_name:"An input"});O("PopupClosed",{display(){return" is closed"},element_name:"A popup "});O("PopupOpened",{display(){return" is opened"},element_name:"A popup "});O("MapMarkerClicked",{display(){return"'s marker is clicked"},element_name:"A map"});O("OnError",{display(){return" has an error running a workflow"}});j.CustomEvent={display(e){const t=e==null?void 0:e.get_static_property("event_name");if(t){return t}else{return"Create a custom event..."}},field_names:{event_name:{},parameters:{}},fields(){return[{name:"event_name",caption:"Event name",editor:"StaticText"},{name:"parameters",editor:"ObjectList",button_caption:"Add a new parameter",id_field:"param_id",has_rows:true,sub_properties(e){let t;if(d.has_feature_enabled("reorg_component_selection")){t=x()}else{t=s().sets.get_set("DisplayableInListValues")(true)}return[{name:"param_name",caption:"Name",editor:"StaticText",include_in_redesign:false},{name:"btype_id",caption:"Type",editor:"Dropdown",set:t,condition:"param_name",pretty:{dropdown_width:"medium-large"},include_in_redesign:false},{name:"is_list",caption:"Is a list/array",editor:"Checkbox",default:false,condition:"param_name",include_in_redesign:false},{name:"optional",caption:"Optional",editor:"Checkbox",condition:"param_name",default:false,include_in_redesign:false}]}}]},register(){},deferrable:true};function T(e){const t=e.get_static_property("raw_data");e.set_property("waiting_for_data",true);U.wait_for_stable((()=>{e.set_property("raw_data",null);const n=i.Watcher((()=>e.get_static_property("raw_data")));let r=s().location.format_pieces({appname:d.appname(),app_version:d.app_version(),version_explicit:"default"},{protocol:"https:"});r+="/api/1.1/wf/"+e.wf_name()+"/initialize";function o(){e.set_property("waiting_for_data",false);n.destroy()}const a=window.ConfirmPanel({title:"Detecting Request Data",build(e){const t=i.div("instruction",e);const n=i.div();n.html('Trigger a request to (click to copy) \n <code class="enpoint-to-initiliaze code-explanation">'+r+"</code>");t.append(n);i.copy_on_click(n,undefined,true);q.show_loading_animation(e)},additional_class:"waiting-post-wf-data",button_caption:"CANCEL",no_cancel:true,cb_yes(){o();e.set_property("raw_data",t)}});n.on_value((t=>{if(t){N(e);o();a.popup.hide()}}))}))}function N(e){var t,n;const r=o.safe_require("./editor_plugin/apiconnector_editor");const s=i.json_parse((t=e.get_static_property("raw_data"))!=null?t:"{}");const{types:a}=i.json_parse((n=e.get_static_property("data_type"))!=null?n:"{}");const l=r.get_response_schema_value({response:s,api_id:e.id(),call_name:"Request Data",is_wf_data:true,API_CONNECTOR_BASE:"api_wf_data"});return new r.EditDataTypesPopup({api_call:{types:a},raw_response:s,schema:l,API_CONNECTOR_BASE:"api_wf_data",API_CONNECTOR_FIELD_PREFIX:"_wf_",is_wf_data:true,api_id:e.id(),cb(t,n){e.set_property("data_type",i.json_stringify({types:t,is_list:n.is_list}));if((n==null?void 0:n.raw_response)!=null){e.set_property("raw_data",i.json_stringify(n.raw_response))}return e.commit()},get_api(){return{types:a,name:"Request Data"}}})}function P(e){const t=/[$#[\]/]/;return t.test(e)}j.APIEvent={display(e,t){var n;const r=e==null?void 0:(n=e.wf_name)==null?void 0:n.call(e);if(r){return r}else if(t){return"API Workflow"}else{return"New API workflow..."}},field_names:i.extend({wf_name:{},expose:{default:true},auth_unecessary:{default:false},ignore_privacy_rules:{default:false},trigger_option:{default:"post"},return_200_if_not_run:{default:false},parameters:{},detect_request:{},include_headers:{},parameter_def:{default:"manual"},modify_types:{},response_type:{default:"json"},redirect_page_success:{},redirect_page_error:{}},_.custom_tz_field_names),fields(e){return[{name:"wf_name",caption:"API workflow name",editor:"StaticText",validation_fn(e){return!i.firebase_illegal(e)&&e.indexOf('"')===-1&&e.indexOf("'")===-1}},{name:"expose",caption:"Expose as a public API workflow",editor:"Checkbox"},{name:"auth_unecessary",caption:"This workflow can be run without authentication",editor:"Checkbox"},{name:"ignore_privacy_rules",caption:"Ignore privacy rules when running the workflow",editor:"Checkbox"},{name:"trigger_option",caption:"Trigger workflow with",condition(e){return e.get_static_property("expose")===true},set:s().sets.get_set("Object")({post:"POST",get:"GET"}),editor:"Dropdown"},{name:"parameter_def",caption:"Parameter definition",condition(e){return e.get_static_property("trigger_option")==="post"||e.get_static_property("trigger_option")==="get"&&e.get_static_property("expose")===false},set:s().sets.get_set("Object")({manual:"Manual definition",auto:"Detect request data"}),editor:"Dropdown"},{name:"parameters",condition(e){return e.get_static_property("parameter_def")!=="auto"||e.get_static_property("trigger_option")==="get"&&e.get_static_property("expose")===true},editor:"ObjectList",button_caption:"Add a new parameter",has_rows:true,sub_properties(e,t){let n;if(d.has_feature_enabled("reorg_component_selection")){n=y().filter(w().no_api).filter((e=>!["dateinterval","number_range"].includes(e.value)))}else{n=s().sets.get_set("Filtered")(s().sets.get_set("AllowableValues")(false,true),(e=>!["dateinterval","number_range"].includes(e.value)))}const r=[{name:"key",caption:"Key",editor:"StaticText",validation_fn(e){return!P(e)},include_in_redesign:false},{name:"value",caption:"Type",editor:"Dropdown",set:n,condition:"key",default:"text",pretty:{dropdown_width:"medium-large"},include_in_redesign:false},{name:"is_list",caption:"Is a list/array",editor:"Checkbox",condition:"key",include_in_redesign:false},{name:"optional",caption:"Optional",editor:"Checkbox",condition:"key",include_in_redesign:false},{name:"in_url",caption:"Querystring",editor:"Checkbox",condition(e){var n;const r=t.get_static_property("trigger_option");const i=t.get_static_property("expose");const s=(n=e.get_static_property("key"))!=null?n:"";return r!=="get"&&i!==false&&s!==""},include_in_redesign:false},{name:"key",caption:"Key",editor:"StaticText",validation_fn(e){return!P(e)},pretty:{class_name:"api-event-parameter",row_id:1},include_in_redesign:true},{name:"value",caption:"Type",editor:"Dropdown",set:n,condition:"key",default:"text",pretty:{dropdown_width:"medium-large",class_name:"api-event-parameter",row_id:3},include_in_redesign:true},{name:"is_list",caption:"Is a list/array",editor:"Checkbox",condition:"key",include_in_redesign:true,pretty:{class_name:"api-event-parameter",row_id:2}},{name:"optional",caption:"Optional",editor:"Checkbox",condition:"key",include_in_redesign:true,pretty:{class_name:"api-event-parameter",row_id:2}},{name:"in_url",caption:"Querystring",editor:"Checkbox",condition:"key",include_in_redesign:true,pretty:{class_name:"api-event-parameter",row_id:2}}];return r}},{name:"include_headers",caption:"Include headers in the detected data",editor:"Checkbox",condition(e){return e.get_static_property("parameter_def")==="auto"&&e.get_static_property("trigger_option")!=="get"}},{name:"detect_request",button_caption:"Detect data",editor:"Button",optional:true,condition(e){return e.get_static_property("parameter_def")==="auto"&&e.get_static_property("trigger_option")!=="get"},click_cb(){return T(e)},pretty:{width:"small"}},{name:"modify_types",button_caption:"Modify types",editor:"Button",optional:true,condition(e){return e.get_static_property("parameter_def")==="auto"&&e.get_static_property("trigger_option")!=="get"},disabled(e){return e.get_static_property("data_type")==null},click_cb(){return N(e)},pretty:{width:"small"}},{name:"response_type",caption:"Response type",set:s().sets.get_set("Object")({json:"JSON Object",redirect:"Page redirect (302)"}),editor:"Dropdown"},{name:"return_200_if_not_run",caption:"Return a 200 if condition is not met",editor:"Checkbox",condition(e){return e.get_static_property("response_type")==="json"}},{name:"redirect_page_success",caption:"Redirection on success",set:s().sets.get_set("Pages")(),editor:"Dropdown",condition(e){return e.get_static_property("response_type")==="redirect"}},{name:"redirect_page_error",caption:"Redirection on error",set:s().sets.get_set("Pages")(),editor:"Dropdown",condition(e){return e.get_static_property("response_type")==="redirect"}},..._.custom_tz_fields("API request's timezone",{condition:()=>d.has_advanced_feature_enabled("timezone_controls_backend_workflows")})]},register(){},deferrable:true,check_for_errors(e,t){if(e.wf_name()){if(e.wf_name().indexOf(" ")!==-1&&e.get_static_property("expose")){t(this.display(e)+" - the API workflow name should not have any spaces, since it can be used via the Workflow API")}else if(i.firebase_illegal(e.wf_name())){t(this.display(e)+" - the API workflow should not contain illegal characters, since it can be used via the Workflow API")}}else{t(this.display(e)+" - the API workflow name should not be empty")}for(const{param_id:n}of e.get_custom_parameters()){if(n){if(n.trim()!==n){t(this.display(e)+" - the parameter "+n.trim()+" has some spaces around it")}}}}};j.RecurringEvent={display(e,t){const n=e==null?void 0:e.get_static_property("event_name");if(n){return n}else if(t){return"Recurring event"}else{return"New recurring event..."}},field_names:i.extend({event_name:{},custom_event_data_type:{},ignore_privacy_rules:{default:false}},_.custom_tz_field_names),fields(){let e;if(d.has_feature_enabled("reorg_component_selection")){e=b()}else{e=s().sets.get_set("CustomTypes")(true,false)}return[{name:"event_name",caption:"Event name",editor:"StaticText"},{name:"custom_event_data_type",caption:"Type of thing",editor:"Dropdown",set:e},{name:"ignore_privacy_rules",caption:"Ignore privacy rules when running the workflow",editor:"Checkbox"},..._.custom_tz_fields("Timezone where event was scheduled",{condition:()=>d.has_advanced_feature_enabled("timezone_controls_backend_workflows")})]},register(){},deferrable:true};j.DatabaseTriggerEvent={display(e,t){const n=e==null?void 0:e.get_static_property("event_name");if(n){return n}else if(t){return"Database trigger event"}else{return"New database trigger event..."}},field_names:i.extend({event_name:{},data_trigger_type:{}},_.custom_tz_field_names),fields(){let e;if(d.has_feature_enabled("reorg_component_selection")){e=b()}else{e=s().sets.get_set("CustomTypes")(true,false)}const t=[{name:"event_name",caption:"Event name",editor:"StaticText"},{name:"information",editor:"Label",label_text:"This event type is only available on plans that support triggers. Click here to upgrade your plan for the event to be activated.",click_cb(){s().subscription.enter_upgrade_path({feature_id:"data_trigger",source:"Workflow/NewDataTrigger"})},condition(){return!d.app_plan().data_trigger}},{name:"data_trigger_type",caption:"Type",editor:"Dropdown",set:e},..._.custom_tz_fields("Timezone where change was triggered",{condition:()=>d.has_advanced_feature_enabled("timezone_controls_backend_workflows")})];return t},get_composer_context(e){return{data_trigger:true,node:e,is_workflow:true}},register(){},deferrable:true};j.get_all_events=function(e){let t;if(e.is_api()){t={General:[{type:"APIEvent"},{type:"RecurringEvent"},{type:"DatabaseTriggerEvent"}]}}else{t=j.get_root_events();t.Elements=I(e).map((e=>({type:e})))}i.extend(t,E());for(const e in j.plugin_general_events){if(R(e.toLowerCase())){i.extend(t,j.plugin_general_events)}}return t};j.get_full_list_events=function(){const e=j.get_root_events();e.General.push(...[{type:"APIEvent"},{type:"RecurringEvent"},{type:"DatabaseTriggerEvent"}]);e.Elements=A().map((e=>({type:e})));i.extend(e,E());return e};function I(e){const t=[];if(e.is_custom_definition()){t.push(...n.get_events_for_an_element(e.element_type()))}for(const n of e.find_elements()){for(const e of A()){var r,s;if(n.type()==="CustomElement"&&(r=(s=n.E).is_popup)!=null&&r.call(s)&&v.has_event(e,"Popup")){t.push(e)}if(v.has_event(e,n.type())){t.push(e)}}}return i.sort_array(i.unique(t),A())}j.get_event_object=function(e){if(j[e]){return j[e]}else{var t;const[n]=g.get_plugin_and_type(e);return(t=z.get_plugin(n))==null?void 0:t.get_event(e)}};const R=e("../../services/is_installed");const L=e("../../services/shared/plugin_registry");const z=e("../../services/shared/plugin_getter");L.on_plugin_registration(((e,t)=>{if(t.plugin_general_events!==null){var n;(n=j.plugin_general_events)!=null?n:j.plugin_general_events={};a.extend(j.plugin_general_events,t.plugin_general_events)}}));const B=e("../../db/values/StaticObject");const q=e("../status_bar");const U=e("../../lang/lang");const F=e("../../lang/evaluation/node_eval")},{"../../constants/core":55,"../../constants/workflow":95,"../../db/values/StaticObject":473,"../../lang/appquery":651,"../../lang/btypes_dropdowns":654,"../../lang/evaluation/FrozenState":687,"../../lang/evaluation/node_eval":697,"../../lang/evaluation/page_state":698,"../../lang/lang":714,"../../lib":741,"../../logger":744,"../../safe_require":777,"../../services/is_installed":781,"../../services/shared/plugin_getter":783,"../../services/shared/plugin_registry":784,"../../services/shared/service_type_parser":785,"../../u":823,"../../u/shared/b_object":839,"../../u/shared/decaf":844,"../core_datasources/utilities/core_ds_workflow_utilities":236,"../custom_tz_utilities":380,"../status_bar":415,"./event_element_mapping":376,"core-js/modules/web.dom-collections.iterator.js":1123}],378:[function(e,t,n){"use strict";const r=e("./property_applications");const i=e("./property_applications/property_applications_fields");const s=e("./core_actions_fields");const o=e("./core_elements_fields");const a=n;a.add_fields_to_core=l;function l(){i.add_fields_to_property_applications(r);s.add_fields_to_actions();o.add_fields_to_elements()}},{"./core_actions_fields":176,"./core_elements_fields":375,"./property_applications":412,"./property_applications/property_applications_fields":413}],379:[function(e,t,n){"use strict";const r=e("../u");const i=e("../u/shared/async/b_fiber");const s=e("../logger");const o=e("../constants/core");const a=e("../lang/btype_ids");const l=n;l.list_of_formulas={};l.all={};function c(e,t){l[e]=t;l.list_of_formulas[e]=t.display;l.all[e]=t}c("PMT",{display:"Loan Payment",fields:{rate:{content_format:"percentage"},nper:{},pv:{}},evaluate(e){let{rate:t,nper:n,pv:i}=e;const s=0;const o=0;if(t===0){return r.to_num(-(i+s)/n)}const a=Math.pow(1+t,n);let l=t/(a-1)*-(i*a+s);if(o===1){l/=1+t}return r.to_num(l)},testing:{properties:{rate:.1,nper:10,pv:1e3},result:-162.74539488251153}});c("CoordToAddress",{display:"Coordinates to Address",fields:{latitude:{},longitude:{}},ret_btype:"geographic_address",evaluate(e){return{lat:e.latitude,lng:e.longitude}},testing:{ignore:true}});c("RandomString",{display:"Generate random string",fields:{length:{default:6,caption:"Length of characters"},letters:{default:true,editor:"Checkbox",caption:"Use letters"},non_cap:{default:true,editor:"Checkbox",caption:"Use non capitalized letters"},numbers:{default:false,editor:"Checkbox",caption:"Use numbers"},special_chars:{default:false,editor:"Checkbox",caption:"Use special characters"}},ret_btype:"text",evaluate(e,t){if(!e){return""}if(t.is_in_partial){return"not available in debugger"}const{length:n,letters:r,non_cap:a,numbers:l,special_chars:c}=e;let u="";if(r){u+="ASDFGHJKLZXCVBNMQWERTYUIOP"}if(a){u+="qwertyuiopasdfghjklzxcvbnm"}if(l){u+="1234567890"}if(c){u+="{}[];:/<>?_+~!@#"}let d;if(t!=null&&t.random_generator){d=e=>t.random_generator.random(0,e)}else{d=e=>Math.random()*e}let p="";if(n>o.SLOW_RANDOM_LENGTH){s.owner_warn("Probably slow random generation",{display:"Generating a random string > 100,000 characters can slow down workflows and time out, consider using a smaller random string"})}for(let e=0;e<Math.abs(n);e++){if(e%1e3===0){i.optional_pause()}p+=u.charAt(Math.floor(d(u.length)))}return p},testing:{ignore:true}});c("SumProduct",{display:"Calculate sumproduct",fields:{list_1:{value:a.list_type("number"),caption:"List 1"},list_2:{value:a.list_type("number"),caption:"List 2"}},evaluate(e,t){if(!e){return 0}const n=e=>{var t,n;return(t=e==null?void 0:(n=e.all)==null?void 0:n.call(e))!=null?t:e};const r=n(e.list_1);const i=n(e.list_2);if(!(r!=null&&r.length)||!(i!=null&&i.length)){return 0}const s=Math.min(r.length,i.length);let o=0;for(let e=0;e<s;e++){o+=r[e]*i[e]}return o},testing:{ignore:true}})},{"../constants/core":55,"../lang/btype_ids":652,"../logger":744,"../u":823,"../u/shared/async/b_fiber":833}],380:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=n;const{has_adv_timezone_overridden:i}=e("../lang/timezone_override_settings");const s=e("../lib");const o=e("../u/shared/b_date");const a=o.require_moment();r.custom_tz_field_names={tz_type:{default:"browser",no_states:true},tz_static:{},tz_dynamic:{},tz_type_overridden:{default:"browser",no_states:true},tz_static_overridden:{},tz_dynamic_overridden:{}};const l=e=>{switch(e){case"on_page":return"Current page's timezone";case"api_wf":return"Current workflow's timezone";case"unknown":return"Current default timezone";case"legacy":return"User's current time zone";default:return e}};r.custom_tz_fields=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const r=l(e);const o=i()&&!n?"_overridden":"";return[{...t,name:`tz_type${o}`,caption:"Time zone selection",editor:"Dropdown",set:s().sets.get_set("Object")({browser:r,static:"Static choice",dynamic:"Dynamic choice"})},{...t,name:`tz_static${o}`,caption:"Time zone ID",editor:"Dropdown",set:s().sets.get_set("List")(a.tz.names()),condition:e=>{var n,r;return((n=(r=t.condition)==null?void 0:r.call(t,e))!=null?n:true)&&e.get_static_property(`tz_type${o}`)==="static"}},{...t,name:`tz_dynamic${o}`,caption:"Dynamic time zone",editor:"Basic",value:"text",condition:e=>{var n,r;return((n=(r=t.condition)==null?void 0:r.call(t,e))!=null?n:true)&&e.get_static_property(`tz_type${o}`)==="dynamic"}}]};r.get_custom_tz=e=>{var t;let{static_eval:n,dynamic_eval:r,invalid_tz_fallback:o,not_overridden:l=false}=e;(t=r)!=null?t:r=n;if(o===undefined){var c;(c=o)!=null?c:o=s().current_timezone()}const u=i()&&!l?"_overridden":"";switch(n(`tz_type${u}`)){case"browser":return s().current_timezone();case"static":return r(`tz_static${u}`);case"dynamic":{const e=r(`tz_dynamic${u}`);if(a.tz.zone(e)){return e}else{return o}}}return s().current_timezone()};r.get_tz_display=e=>{if(e){var t;const n=(t=e.replace(/_/g," "))!=null?t:"";return" ("+n+")"}else{return""}}},{"../lang/timezone_override_settings":729,"../lib":741,"../u/shared/b_date":836,"core-js/modules/es.string.replace.js":1121}],381:[function(e,t,n){"use strict";const r=n;const i=e("../u");const s=e("../u/shared/async/b_fiber");const o=e("../logger");const a=e("../shared/investigations");r.update_modified_date=e=>e.child("Modified Date").set(i.timestamp());r.update_thing=function(e,t,n){var c,u;const d=i.Promise(null,"updating "+(e==null?void 0:(c=e._id)==null?void 0:c.call(e)));if(!e){console.log("trying to update something that does not exist.  this is likely an application error...");d.resolve();return d}if(typeof e.child!=="function"){console.log(`trying to update something that doesn't look like a DB object.  This can legitimately happen in preview mode, if the to_change expression isn't valid.`);d.resolve();return d}const p={thing_id:e==null?void 0:(u=e._id)==null?void 0:u.call(e),new_values:t,expected_value_id:n,inner_value_check:{}};d.resolve(i.run_once(30,(()=>e._type())).then((c=>{p.thing_type=c;if(n!=null&&n!==c){return null}const u=l.get(c).custom_type();if(u!=null){s.optional_pause();return i.run_once(30,(()=>{const e={};const n=t!=null?t:{};for(const t in n){const o=n[t];if(o!=null&&o.key){var r;if(!u.field(o.key).exists()){continue}e[t]=i.extend({},o);const n=l.get(u.field(o.key).value());let a=n.inner();p.inner_value_check[o.key]=a!=null;(r=a)!=null?r:a={cast(){return null}};if(!o.action&&n.is_list()){o.action="set_list"}if(!o.action){e[t].value=n.cast(o.value)}else if(["add","remove"].includes(o.action)){e[t].value=a.cast(o.value)}else{var s;e[t].value=[];const n=(s=o.value)!=null?s:[];for(let r=0;r<n.length;r++){const s=n[r];e[t].value.push(a.cast(s));i.optional_pause_tick()}}}}p.new_values2=e;return e})).then((t=>{if(a.action_update_thing.active()){o.debug("update_thing processed values",p)}const n=t!=null?t:{};for(const t in n){const r=n[t];if(!r.action){e.child(r.key).set(r.value)}else{const t=t=>e.child(r.key).push(t);const n=t=>e.child(r.key).remove(t);if(r.action==="add"){t(r.value)}else if(r.action==="remove"){n(r.value)}else if(r.action==="set_list"){e.child(r.key).set(r.value)}else if(r.action==="add_list"){for(let e=0;e<r.value.length;e++){const n=r.value[e];t(n);i.optional_pause_tick()}}else if(r.action==="remove_list"){for(let e=0;e<r.value.length;e++){const t=r.value[e];n(t);i.optional_pause_tick()}}else if(r.action==="clear_list"){e.child(r.key).set([])}else{throw new i.UnexpectedError("unrecognized action: "+r.action)}}s.optional_pause()}r.update_modified_date(e);return null}))}})));return d};const l=e("../lang/btypes")},{"../lang/btypes":653,"../logger":744,"../shared/investigations":798,"../u":823,"../u/shared/async/b_fiber":833}],382:[function(e,t,n){"use strict";n.icons=["fa fa-american-sign-language-interpreting","fa fa-asl-interpreting","fa fa-assistive-listening-systems","fa fa-audio-description","fa fa-blind","fa fa-braille","fa fa-deaf","fa fa-deafness","fa fa-envira","fa fa-fa","fa fa-first-order","fa fa-font-awesome","fa fa-gitlab","fa fa-glide","fa fa-glide-g","fa fa-google-plus-circle","fa fa-google-plus-official","fa fa-hard-of-hearing","fa fa-instagram","fa fa-low-vision","fa fa-pied-piper","fa fa-question-circle-o","fa fa-sign-language","fa fa-signing","fa fa-snapchat","fa fa-snapchat-ghost","fa fa-snapchat-square","fa fa-themeisle","fa fa-universal-access","fa fa-viadeo","fa fa-viadeo-square","fa fa-volume-control-phone","fa fa-wheelchair-alt","fa fa-wpbeginner","fa fa-wpforms","fa fa-yoast","fa fa-adjust","fa fa-anchor","fa fa-archive","fa fa-area-chart","fa fa-arrows","fa fa-arrows-h","fa fa-arrows-v","fa fa-asterisk","fa fa-at","fa fa-automobile","fa fa-balance-scale","fa fa-ban","fa fa-bank","fa fa-bar-chart","fa fa-bar-chart-o","fa fa-barcode","fa fa-bars","fa fa-battery-0","fa fa-battery-1","fa fa-battery-2","fa fa-battery-3","fa fa-battery-4","fa fa-battery-empty","fa fa-battery-full","fa fa-battery-half","fa fa-battery-quarter","fa fa-battery-three-quarters","fa fa-bed","fa fa-beer","fa fa-bell","fa fa-bell-o","fa fa-bell-slash","fa fa-bell-slash-o","fa fa-bicycle","fa fa-binoculars","fa fa-birthday-cake","fa fa-bluetooth","fa fa-bluetooth-b","fa fa-bolt","fa fa-bomb","fa fa-book","fa fa-bookmark","fa fa-bookmark-o","fa fa-briefcase","fa fa-bug","fa fa-building","fa fa-building-o","fa fa-bullhorn","fa fa-bullseye","fa fa-bus","fa fa-cab","fa fa-calculator","fa fa-calendar","fa fa-calendar-check-o","fa fa-calendar-minus-o","fa fa-calendar-o","fa fa-calendar-plus-o","fa fa-calendar-times-o","fa fa-camera","fa fa-camera-retro","fa fa-car","fa fa-caret-square-o-down","fa fa-caret-square-o-left","fa fa-caret-square-o-right","fa fa-caret-square-o-up","fa fa-cart-arrow-down","fa fa-cart-plus","fa fa-cc","fa fa-certificate","fa fa-check","fa fa-check-circle","fa fa-check-circle-o","fa fa-check-square","fa fa-check-square-o","fa fa-child","fa fa-circle","fa fa-circle-o","fa fa-circle-o-notch","fa fa-circle-thin","fa fa-clock-o","fa fa-clone","fa fa-close","fa fa-cloud","fa fa-cloud-download","fa fa-cloud-upload","fa fa-code","fa fa-code-fork","fa fa-coffee","fa fa-cog","fa fa-cogs","fa fa-comment","fa fa-comment-o","fa fa-commenting","fa fa-commenting-o","fa fa-comments","fa fa-comments-o","fa fa-compass","fa fa-copyright","fa fa-creative-commons","fa fa-credit-card","fa fa-credit-card-alt","fa fa-crop","fa fa-crosshairs","fa fa-cube","fa fa-cubes","fa fa-cutlery","fa fa-dashboard","fa fa-database","fa fa-desktop","fa fa-diamond","fa fa-dot-circle-o","fa fa-download","fa fa-edit","fa fa-ellipsis-h","fa fa-ellipsis-v","fa fa-envelope","fa fa-envelope-o","fa fa-envelope-square","fa fa-eraser","fa fa-exchange","fa fa-exclamation","fa fa-exclamation-circle","fa fa-exclamation-triangle","fa fa-external-link","fa fa-external-link-square","fa fa-eye","fa fa-eye-slash","fa fa-eyedropper","fa fa-fax","fa fa-feed","fa fa-female","fa fa-fighter-jet","fa fa-file-archive-o","fa fa-file-audio-o","fa fa-file-code-o","fa fa-file-excel-o","fa fa-file-image-o","fa fa-file-movie-o","fa fa-file-pdf-o","fa fa-file-photo-o","fa fa-file-picture-o","fa fa-file-powerpoint-o","fa fa-file-sound-o","fa fa-file-video-o","fa fa-file-word-o","fa fa-file-zip-o","fa fa-film","fa fa-filter","fa fa-fire","fa fa-fire-extinguisher","fa fa-flag","fa fa-flag-checkered","fa fa-flag-o","fa fa-flash","fa fa-flask","fa fa-folder","fa fa-folder-o","fa fa-folder-open","fa fa-folder-open-o","fa fa-frown-o","fa fa-futbol-o","fa fa-gamepad","fa fa-gavel","fa fa-gear","fa fa-gears","fa fa-gift","fa fa-glass","fa fa-globe","fa fa-graduation-cap","fa fa-group","fa fa-hand-grab-o","fa fa-hand-lizard-o","fa fa-hand-paper-o","fa fa-hand-peace-o","fa fa-hand-pointer-o","fa fa-hand-rock-o","fa fa-hand-scissors-o","fa fa-hand-spock-o","fa fa-hand-stop-o","fa fa-hashtag","fa fa-hdd-o","fa fa-headphones","fa fa-heart","fa fa-heart-o","fa fa-heartbeat","fa fa-history","fa fa-home","fa fa-hotel","fa fa-hourglass","fa fa-hourglass-1","fa fa-hourglass-2","fa fa-hourglass-3","fa fa-hourglass-end","fa fa-hourglass-half","fa fa-hourglass-o","fa fa-hourglass-start","fa fa-i-cursor","fa fa-image","fa fa-inbox","fa fa-industry","fa fa-info","fa fa-info-circle","fa fa-institution","fa fa-key","fa fa-keyboard-o","fa fa-language","fa fa-laptop","fa fa-leaf","fa fa-legal","fa fa-lemon-o","fa fa-level-down","fa fa-level-up","fa fa-life-bouy","fa fa-life-buoy","fa fa-life-ring","fa fa-life-saver","fa fa-lightbulb-o","fa fa-line-chart","fa fa-location-arrow","fa fa-lock","fa fa-magic","fa fa-magnet","fa fa-mail-forward","fa fa-mail-reply","fa fa-mail-reply-all","fa fa-male","fa fa-map","fa fa-map-marker","fa fa-map-o","fa fa-map-pin","fa fa-map-signs","fa fa-meh-o","fa fa-microphone","fa fa-microphone-slash","fa fa-minus","fa fa-minus-circle","fa fa-minus-square","fa fa-minus-square-o","fa fa-mobile","fa fa-mobile-phone","fa fa-money","fa fa-moon-o","fa fa-mortar-board","fa fa-motorcycle","fa fa-mouse-pointer","fa fa-music","fa fa-navicon","fa fa-newspaper-o","fa fa-object-group","fa fa-object-ungroup","fa fa-paint-brush","fa fa-paper-plane","fa fa-paper-plane-o","fa fa-paw","fa fa-pencil","fa fa-pencil-square","fa fa-pencil-square-o","fa fa-percent","fa fa-phone","fa fa-phone-square","fa fa-photo","fa fa-picture-o","fa fa-pie-chart","fa fa-plane","fa fa-plug","fa fa-plus","fa fa-plus-circle","fa fa-plus-square","fa fa-plus-square-o","fa fa-power-off","fa fa-print","fa fa-puzzle-piece","fa fa-qrcode","fa fa-question","fa fa-question-circle","fa fa-quote-left","fa fa-quote-right","fa fa-random","fa fa-recycle","fa fa-refresh","fa fa-registered","fa fa-remove","fa fa-reorder","fa fa-reply","fa fa-reply-all","fa fa-retweet","fa fa-road","fa fa-rocket","fa fa-rss","fa fa-rss-square","fa fa-search","fa fa-search-minus","fa fa-search-plus","fa fa-send","fa fa-send-o","fa fa-server","fa fa-share","fa fa-share-alt","fa fa-share-alt-square","fa fa-share-square","fa fa-share-square-o","fa fa-shield","fa fa-ship","fa fa-shopping-bag","fa fa-shopping-basket","fa fa-shopping-cart","fa fa-sign-in","fa fa-sign-out","fa fa-signal","fa fa-sitemap","fa fa-sliders","fa fa-smile-o","fa fa-soccer-ball-o","fa fa-sort","fa fa-sort-alpha-asc","fa fa-sort-alpha-desc","fa fa-sort-amount-asc","fa fa-sort-amount-desc","fa fa-sort-asc","fa fa-sort-desc","fa fa-sort-down","fa fa-sort-numeric-asc","fa fa-sort-numeric-desc","fa fa-sort-up","fa fa-space-shuttle","fa fa-spinner","fa fa-spoon","fa fa-square","fa fa-square-o","fa fa-star","fa fa-star-half","fa fa-star-half-empty","fa fa-star-half-full","fa fa-star-half-o","fa fa-star-o","fa fa-sticky-note","fa fa-sticky-note-o","fa fa-street-view","fa fa-suitcase","fa fa-sun-o","fa fa-support","fa fa-tablet","fa fa-tachometer","fa fa-tag","fa fa-tags","fa fa-tasks","fa fa-taxi","fa fa-television","fa fa-terminal","fa fa-thumb-tack","fa fa-thumbs-down","fa fa-thumbs-o-down","fa fa-thumbs-o-up","fa fa-thumbs-up","fa fa-ticket","fa fa-times","fa fa-times-circle","fa fa-times-circle-o","fa fa-tint","fa fa-toggle-down","fa fa-toggle-left","fa fa-toggle-off","fa fa-toggle-on","fa fa-toggle-right","fa fa-toggle-up","fa fa-trademark","fa fa-trash","fa fa-trash-o","fa fa-tree","fa fa-trophy","fa fa-truck","fa fa-tty","fa fa-tv","fa fa-umbrella","fa fa-university","fa fa-unlock","fa fa-unlock-alt","fa fa-unsorted","fa fa-upload","fa fa-user","fa fa-user-plus","fa fa-user-secret","fa fa-user-times","fa fa-users","fa fa-video-camera","fa fa-volume-down","fa fa-volume-off","fa fa-volume-up","fa fa-warning","fa fa-wheelchair","fa fa-wifi","fa fa-wrench","fa fa-hand-o-down","fa fa-hand-o-left","fa fa-hand-o-right","fa fa-hand-o-up","fa fa-ambulance","fa fa-subway","fa fa-train","fa fa-genderless","fa fa-intersex","fa fa-mars","fa fa-mars-double","fa fa-mars-stroke","fa fa-mars-stroke-h","fa fa-mars-stroke-v","fa fa-mercury","fa fa-neuter","fa fa-transgender","fa fa-transgender-alt","fa fa-venus","fa fa-venus-double","fa fa-venus-mars","fa fa-file","fa fa-file-o","fa fa-file-text","fa fa-file-text-o","fa fa-cc-amex","fa fa-cc-diners-club","fa fa-cc-discover","fa fa-cc-jcb","fa fa-cc-mastercard","fa fa-cc-paypal","fa fa-cc-stripe","fa fa-cc-visa","fa fa-google-wallet","fa fa-paypal","fa fa-bitcoin","fa fa-btc","fa fa-cny","fa fa-dollar","fa fa-eur","fa fa-euro","fa fa-gbp","fa fa-gg","fa fa-gg-circle","fa fa-ils","fa fa-inr","fa fa-jpy","fa fa-krw","fa fa-rmb","fa fa-rouble","fa fa-rub","fa fa-ruble","fa fa-rupee","fa fa-shekel","fa fa-sheqel","fa fa-try","fa fa-turkish-lira","fa fa-usd","fa fa-won","fa fa-yen","fa fa-align-center","fa fa-align-justify","fa fa-align-left","fa fa-align-right","fa fa-bold","fa fa-chain","fa fa-chain-broken","fa fa-clipboard","fa fa-columns","fa fa-copy","fa fa-cut","fa fa-dedent","fa fa-files-o","fa fa-floppy-o","fa fa-font","fa fa-header","fa fa-indent","fa fa-italic","fa fa-link","fa fa-list","fa fa-list-alt","fa fa-list-ol","fa fa-list-ul","fa fa-outdent","fa fa-paperclip","fa fa-paragraph","fa fa-paste","fa fa-repeat","fa fa-rotate-left","fa fa-rotate-right","fa fa-save","fa fa-scissors","fa fa-strikethrough","fa fa-subscript","fa fa-superscript","fa fa-table","fa fa-text-height","fa fa-text-width","fa fa-th","fa fa-th-large","fa fa-th-list","fa fa-underline","fa fa-undo","fa fa-unlink","fa fa-angle-double-down","fa fa-angle-double-left","fa fa-angle-double-right","fa fa-angle-double-up","fa fa-angle-down","fa fa-angle-left","fa fa-angle-right","fa fa-angle-up","fa fa-arrow-circle-down","fa fa-arrow-circle-left","fa fa-arrow-circle-o-down","fa fa-arrow-circle-o-left","fa fa-arrow-circle-o-right","fa fa-arrow-circle-o-up","fa fa-arrow-circle-right","fa fa-arrow-circle-up","fa fa-arrow-down","fa fa-arrow-left","fa fa-arrow-right","fa fa-arrow-up","fa fa-arrows-alt","fa fa-caret-down","fa fa-caret-left","fa fa-caret-right","fa fa-caret-up","fa fa-chevron-circle-down","fa fa-chevron-circle-left","fa fa-chevron-circle-right","fa fa-chevron-circle-up","fa fa-chevron-down","fa fa-chevron-left","fa fa-chevron-right","fa fa-chevron-up","fa fa-long-arrow-down","fa fa-long-arrow-left","fa fa-long-arrow-right","fa fa-long-arrow-up","fa fa-backward","fa fa-compress","fa fa-eject","fa fa-expand","fa fa-fast-backward","fa fa-fast-forward","fa fa-forward","fa fa-pause","fa fa-pause-circle","fa fa-pause-circle-o","fa fa-play","fa fa-play-circle","fa fa-play-circle-o","fa fa-step-backward","fa fa-step-forward","fa fa-stop","fa fa-stop-circle","fa fa-stop-circle-o","fa fa-youtube-play","fa fa-500px","fa fa-adn","fa fa-amazon","fa fa-android","fa fa-angellist","fa fa-apple","fa fa-behance","fa fa-behance-square","fa fa-bitbucket","fa fa-bitbucket-square","fa fa-black-tie","fa fa-buysellads","fa fa-chrome","fa fa-codepen","fa fa-codiepie","fa fa-connectdevelop","fa fa-contao","fa fa-css3","fa fa-dashcube","fa fa-delicious","fa fa-deviantart","fa fa-digg","fa fa-dribbble","fa fa-dropbox","fa fa-drupal","fa fa-edge","fa fa-empire","fa fa-expeditedssl","fa fa-facebook","fa fa-facebook-f","fa fa-facebook-official","fa fa-facebook-square","fa fa-firefox","fa fa-flickr","fa fa-fonticons","fa fa-fort-awesome","fa fa-forumbee","fa fa-foursquare","fa fa-ge","fa fa-get-pocket","fa fa-git","fa fa-git-square","fa fa-github","fa fa-github-alt","fa fa-github-square","fa fa-gittip","fa fa-google","fa fa-google-plus","fa fa-google-plus-square","fa fa-gratipay","fa fa-hacker-news","fa fa-houzz","fa fa-html5","fa fa-internet-explorer","fa fa-ioxhost","fa fa-joomla","fa fa-jsfiddle","fa fa-lastfm","fa fa-lastfm-square","fa fa-leanpub","fa fa-linkedin","fa fa-linkedin-square","fa fa-linux","fa fa-maxcdn","fa fa-meanpath","fa fa-medium","fa fa-mixcloud","fa fa-modx","fa fa-odnoklassniki","fa fa-odnoklassniki-square","fa fa-opencart","fa fa-openid","fa fa-opera","fa fa-optin-monster","fa fa-pagelines","fa fa-pied-piper-alt","fa fa-pied-piper-pp","fa fa-pinterest","fa fa-pinterest-p","fa fa-pinterest-square","fa fa-product-hunt","fa fa-qq","fa fa-ra","fa fa-rebel","fa fa-reddit","fa fa-reddit-alien","fa fa-reddit-square","fa fa-renren","fa fa-resistance","fa fa-safari","fa fa-scribd","fa fa-sellsy","fa fa-shirtsinbulk","fa fa-simplybuilt","fa fa-skyatlas","fa fa-skype","fa fa-slack","fa fa-slideshare","fa fa-soundcloud","fa fa-spotify","fa fa-stack-exchange","fa fa-stack-overflow","fa fa-steam","fa fa-steam-square","fa fa-stumbleupon","fa fa-stumbleupon-circle","fa fa-tencent-weibo","fa fa-trello","fa fa-tripadvisor","fa fa-tumblr","fa fa-tumblr-square","fa fa-twitch","fa fa-twitter","fa fa-twitter-square","fa fa-usb","fa fa-viacoin","fa fa-vimeo","fa fa-vimeo-square","fa fa-vine","fa fa-vk","fa fa-wechat","fa fa-weibo","fa fa-weixin","fa fa-whatsapp","fa fa-wikipedia-w","fa fa-windows","fa fa-wordpress","fa fa-xing","fa fa-xing-square","fa fa-y-combinator","fa fa-y-combinator-square","fa fa-yahoo","fa fa-yc","fa fa-yc-square","fa fa-yelp","fa fa-youtube","fa fa-youtube-square","fa fa-h-square","fa fa-hospital-o","fa fa-medkit","fa fa-stethoscope","fa fa-user-md","fa fa-address-book","fa fa-address-book-o","fa fa-address-card","fa fa-address-card-o","fa fa-bandcamp","fa fa-bath","fa fa-bathtub","fa fa-drivers-license","fa fa-drivers-license-o","fa fa-eercast","fa fa-envelope-open","fa fa-envelope-open-o","fa fa-etsy","fa fa-free-code-camp","fa fa-grav","fa fa-handshake-o","fa fa-id-badge","fa fa-id-card","fa fa-id-card-o","fa fa-imdb","fa fa-linode","fa fa-meetup","fa fa-microchip","fa fa-podcast","fa fa-quora","fa fa-ravelry","fa fa-s15","fa fa-shower","fa fa-snowflake-o","fa fa-superpowers","fa fa-telegram","fa fa-thermometer","fa fa-thermometer-0","fa fa-thermometer-1","fa fa-thermometer-2","fa fa-thermometer-3","fa fa-thermometer-4","fa fa-thermometer-empty","fa fa-thermometer-full","fa fa-thermometer-half","fa fa-thermometer-quarter","fa fa-thermometer-three-quarters","fa fa-times-rectangle","fa fa-times-rectangle-o","fa fa-user-circle","fa fa-user-circle-o","fa fa-user-o","fa fa-vcard","fa fa-vcard-o","fa fa-window-close","fa fa-window-close-o","fa fa-window-maximize","fa fa-window-minimize","fa fa-window-restore","fa fa-wpexplorer"]},{}],383:[function(e,t,n){"use strict";const r=e("./../u");const i=e("../u/shared/b_date");const s=e("../lib");const o=i.require_moment();const a=n;a.file="jquery_plugins/jquery.inputmask";class l{constructor(e,t){this.caption=e;this.mask=t;this.btype="text"}format_val(e,t){return this.format_text(e)}get_val(e,t){var n,r;return this.parse_val((n=(r=e.inputmask)==null?void 0:r.call(e,"unmaskedvalue"))!=null?n:e.val(),t)}parse_val(e,t){return e}is_valid_text(e){const t=this.format_text(e);return window.Inputmask.isValid(t,this.get_mask())}get_mask(e){var t;(t=e)!=null?t:e={};return r.extend({greedy:false},this.mask,e)}format_text(e,t){return window.Inputmask.format(e!=null?e:"",this.get_mask(t))}}class c extends l{constructor(e,t,n){super(e,n);this.type=t;this.btype="number"}get_mask(e){var t;(t=e)!=null?t:e={};const{decimal_separator:n,group_separator:i}=s().locale().get_regional_separators();return r.extend({greedy:false,radixPoint:n,groupSeparator:i},this.mask,e)}format_val(e,t){if(e!=null){const n=s().locale().format_number(e,t.digits);return this.format_text(n,t)}else{return""}}parse_val(e){const t=s().locale().parse_float(e);if(isNaN(t)){return null}if(this.type==="integer"){const e=parseInt(t);if(isNaN(e)){return null}return e}else{return t}}is_valid_text(e){if(this.type==="integer"){const t=this.parse_val(e);if(t==null||!!isNaN(t)){return false}return t===0||String(t)===e}else{return true}}}class u extends c{format_val(e,t){if(e==null){return""}const n=s().locale().parse_float(e);if(!isNaN(n)){e=e*100;e=parseFloat(e.toPrecision(12))}if(e!=null){const n=s().locale().format_number(e,t.digits);return this.format_text(n,t)}else{return""}}parse_val(e){const t=super.parse_val(e);if(t==null){return t}return t/100}}class d extends l{constructor(e,t){let{separator:n,order:r}=t;const i=r.join(n);const s={alias:"datetime",inputFormat:i,placeholder:i};super(e,s);this.btype="date";this.date_format=i;this.separator=n;this.order=r}format_val(e,t){return i.format_date(i.mk_date(e),this.date_format,null,t.timezone)}parse_val(e,t){if(e){var n;let r,i,a;const l=e.split(this.separator);for(let e=0;e<this.order.length;e++){const t=this.order[e];if(t[0]==="m"){i=l[e]}else if(t[0]==="d"){r=l[e]}else{a=l[e]}}const c=(n=t==null?void 0:t.timezone)!=null?n:s().current_timezone();return o.tz([a,i-1,r],c).toDate()}else{return null}}is_valid_text(e){return Boolean(i.mk_date(e))}}class p extends l{format_val(e){if(e===""||e==null){return""}return this.format_text(e)}}a.masks={us_phone:new p("US Phone",{mask:"(999) 999-9999",placeholder:"_",inputmode:"tel"}),us_ssn:new l("US SSN",{alias:"ssn"}),percentage:new u("Percentage","float",{alias:"decimal",suffix:"%",placeholder:"0",inputmode:"text"}),currency:new c("Currency","float",{alias:"currency",digits:2,inputmode:"decimal"}),date:new d("Date",{separator:"/",order:["mm","dd","yyyy"]}),date_2:new d("Euro date",{separator:".",order:["dd","mm","yyyy"]}),time:new l("Time",{alias:"datetime",inputFormat:"HH:MM:ss",placeholder:"hh:mm:ss"}),date_time:new l("Date/Time",{alias:"datetime",inputFormat:"mm/dd/yyyy HH:MM:ss",placeholder:"mm/dd/yyyy hh:mm:ss"}),date_time_no_seconds:new l("Date/Time (no seconds)",{alias:"datetime",inputFormat:"mm/dd/yyyy hh:MM tt",placeholder:"mm/dd/yyyy hh:mm xm"}),numerical_ref:new l("Text (numbers only)",{placeholder:"",mask:"9{1,30}",inputmode:"numeric"}),credit_card_number:new l("Credit card number",{placeholder:"",mask:"9999 9999 9999 [9][9][9][9]"}),credit_card_cvc:new l("Credit card CVC",{placeholder:"",mask:"9{3,4}"}),credit_card_exp_month:new l("Credit card exp month",{placeholder:"",mask:"9[9]"}),credit_card_exp_year:new l("Credit card exp year",{placeholder:"",mask:"9999"}),bank_routing_number:new l("Routing number",{placeholder:"",mask:"999999999"}),int_number:new c("Integer","integer",{alias:"numeric",digits:0,placeholder:"",autoGroup:true,_radixDance:false}),float_number:new c("Decimal","float",{alias:"numeric",placeholder:"",autoGroup:true,_radixDance:false,inputmode:"text"})}},{"../lib":741,"../u/shared/b_date":836,"./../u":823}],384:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../safe_require");const i=e("./plugin_loader");const s=n;const o=["algolia_search_engine"];s.initialize=function(){const t=e("./core_elements/core_elements_utilities/element_registry");const n=e("./core_events");const s=e("./core_actions");const a=e("./core_btypes");const l=e("./core_datasources");if(typeof window==="undefined"||window===null){for(const e of o){r.safe_require(`./optional/services/${e}`)}}const c={element:t.registered_elements,event:n,action:s,btype:a.all,datasource:l};i.inject_dependencies(c)}},{"../safe_require":777,"./core_actions":162,"./core_btypes":177,"./core_datasources":220,"./core_elements/core_elements_utilities/element_registry":284,"./core_events":377,"./plugin_loader":385,"core-js/modules/web.dom-collections.iterator.js":1123}],385:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../u");const i=e("../safe_require");const s=e("../strings/plugin");const o=e("../services/shared/service_type_parser");const a=e("../services/shared/plugin_getter");const{UnexpectedError:l}=e("../u/shared/errors");const c=n;let u=null;let d={element:{},event:{},action:{},btype:{},datasource:{}};c.type_to_prefix={element:"Element",event:"Event",action:"Action",btype:"Btype",datasource:"Datasource",module:"Module"};const p={};for(const[e,t]of Object.entries(c.type_to_prefix)){p[t]=e}c.load_plugin=function(e,t,n){var i;(i=t)!=null?i:t=false;if(!u){throw new l("Loading a plugin before the loader was initialized")}if(e.slice(0,7)===c.type_to_prefix.module+":"){return _(e.slice(7))}let f=u[e];if(!f){const[t,...n]=e.split(":");const r=n.join(":");const i=p[t];if(i){var h;f=(h=d[i])==null?void 0:h[r];if(f){u[e]=f}}}if(!f){const t=c.type_to_prefix.element+":";const r=c.type_to_prefix.action+":";const i=c.type_to_prefix.event+":";if(e.startsWith(t)){const r=e.split(t)[1];const[i,s]=o.get_plugin_and_type(r);if(s){var m;f=(m=a.get_plugin(i))==null?void 0:m.get_element(r,n)}}else if(e.startsWith(r)){const t=e.split(r)[1];const[n,i]=o.get_plugin_and_type(t);if(i){var g;f=(g=a.get_plugin(n))==null?void 0:g.get_action(t)}}else if(e.startsWith(i)){const t=e.split(i)[1];const[n]=o.get_plugin_and_type(t);if(t){var v;f=(v=a.get_plugin(n))==null?void 0:v.get_event(t)}}}if(!f){if(t){return null}throw new r.UnexpectedError(s.MISSING_PLUGIN+" "+e)}f.plugin_retrieved_name=e;return f};c.inject_dependencies=function(e){if(u){return}d=e;u={};for(const[e,t]of Object.entries(d)){const n=c.type_to_prefix[e];for(const[e,r]of Object.entries(t)){u[`${n}:${e}`]=r}}};function _(e){return i.safe_require("./optional/"+e)}},{"../safe_require":777,"../services/shared/plugin_getter":783,"../services/shared/service_type_parser":785,"../strings/plugin":810,"../u":823,"../u/shared/errors":846,"core-js/modules/web.dom-collections.iterator.js":1123}],386:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u/shared/decaf");t.exports=class e{constructor(e,t,n){var r;this.sel_fn=e;this.to_remove=t!=null?t:[];this.to_not_apply=n!=null?n:[];this.uses_properties=((r=this._uses_properties)!=null?r:[]).filter((e=>!this.to_remove.includes(e)))}get_target(e){if(this.sel_fn){if(typeof this.sel_fn==="string"){e=e.find(this.sel_fn)}else{e=this.sel_fn(e)}}return e}apply(e,t,n){for(const t of this.to_remove){delete e[t]}for(const t of this.to_not_apply){delete e[t]}if(!this.sel_fn){this._apply(e,t,n)}else{for(const i of r.array_from(this.get_target(t))){this._apply(e,$(i),n)}}}apply_directly(e,t,n){for(const t of this.to_remove){delete e[t]}for(const t of this.to_not_apply){delete e[t]}this._apply(e,t,n)}get_transition_css(e,t,n){let r="";for(const t of this.uses_properties){var i;if((i=this.transition_properties)!=null&&i[t]){const n=this._transition_property_to_css_string(e,t);if(n){r+=n+", "}}}if(r){var s,o,a,l,c;let e;const i=this.get_target(t);if(typeof this.sel_fn==="string"){e=this.sel_fn}else{e=i.prop("outerHTML")}(o=n[s=e])!=null?o:n[s]={};(l=(a=n[e]).target)!=null?l:a.target=i;n[e].css_prop=((c=n[e].css_prop)!=null?c:"")+r}}_transition_property_to_css_string(e,t){let n="";const r=e.transition(t);if(!this._transition_should_be_applied(e,t)){return n}if(r!=null&&r.exists()){if(Array.isArray(this.transition_properties[r.prop_name()])){n+=this.transition_properties[r.prop_name()].map((e=>this._combine_transformation_info_into_css(e,r))).join(", ")}else{const e=this.transition_properties[r.prop_name()];n+=this._combine_transformation_info_into_css(e,r)}}return n}_transition_should_be_applied(e,t){var n;if(((n=this.transition_conditions)==null?void 0:n[t])!=null){return this.transition_conditions[t](e)}else{return true}}_combine_transformation_info_into_css(e,t){return`${e} ${t.duration()}ms ${t.fn()}`}get_transition_styling(e){const t=[];for(const r of this.uses_properties){var n;if((n=this.transition_properties)!=null&&n[r]){const n=this._transition_property_to_css_string(e,r);if(n){t.push(n)}}}return t.join(", ")}get_properties(e){const t=this._get_properties().filter((e=>!this.to_remove.includes(e.name)));if(e){for(const e of t){var n;const t=(n=this.field_names[e.name])==null?void 0:n.default;if(t){e.default=t}}for(const n of t){if(e[n.name]!=null){n.default=e[n.name]}}}return t}}},{"../../u/shared/decaf":844,"core-js/modules/web.dom-collections.iterator.js":1123}],387:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../constants/runmode");const i=e("../../lang/evaluation/element_eval");const s=e("../../lang/elements/ElementInstance");const o=e("../../u/shared/decaf");const a=n;a.apply_css_style=function(e,t){for(const n of o.array_from(e!=null?e:[])){for(const e in t){const r=t[e];n.style[e]=r}}};a.patch_user_agent_styles=function(e){a.apply_css_style(e,{padding:"0px","text-align":"center",background:"none",border:"none"});if(!e.hasClass(r.CLICKABLE_ELEMENT)){return a.apply_css_style(e,{cursor:"inherit"})}};a.calculate_border_height=e=>l(e,["_top","_bottom"]);a.calculate_border_width=e=>l(e,["_left","_right"]);function l(e,t){let n;const r=t=>{let n;if(e instanceof s){var r,o;n=(r=(o=e.element).get_style_if_exists)==null?void 0:r.call(o);if(n){return n.get_static_property(t)}return i.evaluate_property(e,t)}else{var a,l;n=(a=e.get_style_if_exists)==null?void 0:a.call(e);if(n){return n.get_static_property(t)}return(l=e.get_static_property)==null?void 0:l.call(e,t,true)}};if(e.get_static_property("four_border_style")){let e=0;for(const i of t){n=r("border_style"+i);if(![undefined,"none"].includes(n)){e+=r("border_width"+i)}}return e}else{n=r("border_style");if(![undefined,"none"].includes(n)){return 2*r("border_width")}else{return 0}}}},{"../../constants/runmode":83,"../../lang/elements/ElementInstance":669,"../../lang/evaluation/element_eval":690,"../../u/shared/decaf":844,"core-js/modules/web.dom-collections.iterator.js":1123}],388:[function(e,t,n){"use strict";var r;const i=e("../../../u");const s=e("../PropertyApplication");const o=e("../application_utilities");const a=e("../../core_elements/shared/image_utils");const l=e("../../../lang/appquery");const c=e("./SimpleGradient");const u=e("../../../lang/evaluation/element_eval");t.exports=(r=class e extends s{_apply(e,t,n){if(e){const p={};if(!e._first_time&&(l.get_public_setting("bubble_version")<16||(n==null?void 0:n.element.type())!=="Dropdown"||e.background_style==="image")){p.background="none"}if(e.background_style==="bgcolor"){p["background-color"]=i.RGBA_to_RGB(e.bgcolor);p["background-color"]=e.bgcolor}else if(e.background_style==="none"&&!e._first_time){p["background-color"]="transparent"}else if(e.background_style==="gradient"){o.apply_css_style(t,p);(new c)._apply({style:e.background_gradient_style,direction:e.background_gradient_direction,angle:e.background_gradient_custom_angle,from:e.background_gradient_from,to:e.background_gradient_to,mid:e.background_gradient_mid,shape:e.background_radial_gradient_shape,pos:e.background_radial_gradient_size,xpos:e.background_radial_gradient_xpos,ypos:e.background_radial_gradient_ypos},t);return}else if(e.background_style==="image"){if(!e.backdrop_image_paralax){p["background-color"]=e.background_color_if_empty_image}if(e.background_image){var r,s;const o=e.repeat_background_vertical&&e.repeat_background_horizontal?"repeat":e.repeat_background_vertical?"repeat-y":e.repeat_background_horizontal?"repeat-x":"no-repeat";p["background-repeat"]=o;if(e.center_background){if(e.is_backdrop){p["background-position"]="center top"}else{p["background-position"]="center"}}else{p["background-position"]=""}if(e.background_size_cover||n!=null&&(r=n.element.root())!=null&&r.use_responsive_algorithm()&&e.crop_responsive){p["background-size"]="cover";p["-webkit-background-size"]="cover";p["-moz-background-size"]="cover";p["-o-background-size"]="cover"}else{p["background-size"]=""}const l=n==null?void 0:n.element.property("background_image");const c=l&&(!l.is_empty()&&l.is_static()||l.is_empty());if(e.background_size_cover){if(!n||n!=null&&n.run_mode()||c){if(!e.backdrop_image_paralax){d(t,a.optimize_image(e.background_image,t.width()),n,p);return}}}else if(e.crop_responsive&&n!=null&&(s=n.element.root())!=null&&s.use_responsive_algorithm()){if(n.run_mode()){let e=null;let r=null;n.autorun((()=>{const i=u.evaluate_property(n,"width");const s=u.evaluate_property(n,"height");const o=u.evaluate_property(n,"background_image");const l=n.responsive_mode()&&i===n.element.get_width();function c(){d(t,a.optimize_image(o,i,s,{fit:"crop"}),n,p)}r=a.optimize_image(o,i,s);if(o===e&&!a.downloaded_images[r]||l){n.setTimeout((()=>{if(r===a.optimize_image(o,i,s)){c()}}),300)}else{if(i!==0||r===o){e=o;c()}}}));return}else if(c){d(t,e.background_image,n,p);return}}else if(!e.backdrop_image_paralax){d(t,a.optimize_image(e.background_image),n,p);return}if(e.backdrop_image_paralax){if(!i.is_on_mobile_or_tablet()){p["background-image"]="none";const n=a.optimize_image(e.background_image,t.width());t.parallax({imageSrc:n,speed:e.backdrop_paralax_speed});$(".parallax-slider").attr({src:n})}else{d(t,a.optimize_image(e.background_image),n,p);return}}}}o.apply_css_style(t,p)}}},(()=>{r.prototype._uses_properties=["background_style","bgcolor","background_gradient_direction","background_gradient_custom_angle","background_gradient_from","background_gradient_to","background_gradient_mid","background_image","repeat_background_vertical","center_background","repeat_background_horizontal","background_size_cover","background_color_if_empty_image","crop_responsive","background_gradient_style","background_radial_gradient_shape","background_radial_gradient_size","background_radial_gradient_xpos","background_radial_gradient_ypos"];r.prototype.transition_properties={background_style:"background"};r.prototype.no_solid_support=true;r.prototype.field_names={background_style:{default:"none"},bgcolor:{default:"#FFFFFF"},background_gradient_direction:{default:"top"},background_gradient_custom_angle:{default:45},background_gradient_from:{default:"#FFFFFF"},background_gradient_to:{default:"#AAAAAA"},background_gradient_mid:{optional:true},background_gradient_style:{default:"linear"},background_radial_gradient_shape:{default:"ellipse"},background_radial_gradient_size:{default:"farthest-corner"},background_radial_gradient_xpos:{default:10},background_radial_gradient_ypos:{default:10},background_image:{},center_background:{},background_size_cover:{},repeat_background_vertical:{},repeat_background_horizontal:{},background_color_if_empty_image:{default:"rgba(255, 255, 255, 0.0)"},crop_responsive:{no_states:true,default:true,prop_not_in_style:true}};r.prototype.class_name="Background"})(),r);function d(e,t,n,r){e.data("_last_downloaded_image",t);a.download_image(t,n,(()=>{if(t===e.data("_last_downloaded_image")){r["background-image"]=`url("${t}")`;o.apply_css_style(e,r)}}))}},{"../../../lang/appquery":651,"../../../lang/evaluation/element_eval":690,"../../../u":823,"../../core_elements/shared/image_utils":363,"../PropertyApplication":386,"../application_utilities":387,"./SimpleGradient":409}],389:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i;const s=e("../../../u");const o=e("../PropertyApplication");const a=e("../application_utilities");const l=e("../../../constants/style");const c={four_border_style:{default:(r=window)!=null&&r.is_maison?"connected":false,no_states:true}};const u={};for(const e of["","_top","_right","_bottom","_left"]){c["border_style"+e]={default:"none"};c["border_roundness"+e]={default:0};c["border_width"+e]={default:1};c["border_color"+e]={default:"#6B6B6B"}}for(const e of["","top","right","bottom","left"]){if(e===""){u.border_roundness="border-radius";u.border_width="border-width";u.border_color="border-color"}else{const t=l.BORDER_TO_CORNER_MAPPING[e];const n="_"+e;u["border_roundness"+n]="border-"+t+"-radius";u["border_width"+n]="border-"+e+"-width";u["border_color"+n]="border-"+e+"-color"}}t.exports=(i=class e extends o{constructor(e,t,n){var r;(r=t)!=null?r:t=[];super(e,t);this.data=n}_apply(e,t){if(e){var n;if(!((n=this.data)!=null&&n.only_main_border)&&e.four_border_style){for(const n of["top","right","bottom","left"]){const r={};if(e["border_style_"+n]!=="none"||!e._first_time){r["border-"+n+"-style"]=e["border_style_"+n];r["border-"+n+"-width"]=e["border_width_"+n]+"px";r["border-"+n+"-color"]=s.RGBA_to_RGB(e["border_color_"+n]);r["border-"+n+"-color"]=e["border_color_"+n]}const i=l.BORDER_TO_CORNER_MAPPING[n];r["border-"+i+"-radius"]=e["border_roundness_"+n]+"px";a.apply_css_style(t,r)}}else{const n={};if(e.border_style!=="none"||!e._first_time){n["border-style"]=e.border_style;n["border-width"]=e.border_width+"px";n["border-color"]=s.RGBA_to_RGB(e.border_color);n["border-color"]=e.border_color}n["border-radius"]=e.border_roundness+"px";n["-moz-border-radius"]=e.border_roundness+"px";a.apply_css_style(t,n)}}}},(()=>{i.prototype._uses_properties=Object.keys(c);i.prototype.transition_properties=u;i.prototype.field_names=c;i.prototype.class_name="Border"})(),i)},{"../../../constants/style":89,"../../../u":823,"../PropertyApplication":386,"../application_utilities":387,"core-js/modules/web.dom-collections.iterator.js":1123}],390:[function(e,t,n){"use strict";var r;const i=e("../../../u");const s=e("../../../outlining");const o=e("../PropertyApplication");t.exports=(r=class e extends o{_apply(e,t){if(e&&e.boxshadow_style!=="none"){var n,r,o,a,l,c,u,d,p,_,f;e=i.extend({},e);e.blur=(n=(r=e.boxshadow_blur)!=null?r:e.blur)!=null?n:0;e.horizontal=(o=(a=e.boxshadow_horizontal)!=null?a:e.horizontal)!=null?o:0;e.vertical=(l=(c=e.boxshadow_vertical)!=null?c:e.vertical)!=null?l:0;e.spread=(u=(d=e.boxshadow_spread)!=null?d:e.spread)!=null?u:0;e.color=(p=(_=e.boxshadow_color)!=null?_:e.color)!=null?p:0;const h=e.boxshadow_style==="inset"?"inset":"";e.inset=e.boxshadow_style!==undefined?h:(f=e.inset)!=null?f:"";s.add_outline(t,"default",5,e)}else if(e.boxshadow_style==="none"&&!e._first_time){s.remove_outline(t,"default")}}},(()=>{r.prototype.transition_properties={boxshadow_style:"box-shadow"};r.prototype._uses_properties=["boxshadow_style","boxshadow_horizontal","boxshadow_vertical","boxshadow_blur","boxshadow_color","boxshadow_spread"];r.prototype.field_names={boxshadow_style:{default:"none"},boxshadow_horizontal:{default:2},boxshadow_vertical:{default:2},boxshadow_blur:{default:4},boxshadow_color:{default:"#AAAAAA"},boxshadow_spread:{default:0}};r.prototype.class_name="BoxShadow"})(),r)},{"../../../outlining":753,"../../../u":823,"../PropertyApplication":386}],391:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{_apply(e,t){}},(()=>{r.prototype.field_names={width:{default:100,no_states:true},height:{default:100,no_states:true},left:{no_states:true},top:{no_states:true}};r.prototype.not_in_style=true;r.prototype.apply_once=true;r.prototype.class_name="Dimensions"})(),r)},{"../PropertyApplication":386}],392:[function(e,t,n){"use strict";var r;const i=e("../../../lib");const s=e("../../../webfonts");const o=e("../PropertyApplication");const a=e("../application_utilities");const l=e("../../../constants/fonts");const{FONT_FAMILY_VERSION:c}=e("../../../constants/elements");const u=["normal","bold","lighter","bolder","initial","inherit","unset","100","200","300","400","500","600","700","800","900"];t.exports=(r=class e extends o{_apply(e,t,n){if(e){let r;if(n&&n.element.element_version(true)>=c){r=s.to_font_face(e.font_family,e.font_weight)}else{r=e.font_face}if(i().is_edit_mode()){s.load_font(r)}const o=s.get_quoted_face_and_variant(r);a.apply_css_style(t,{"font-family":o.font_family,"font-size":e.font_size+"px"});let l=null;if(e.bold){l="bold"}else if(o.variant&&u.includes(o.variant)){l=o.variant}else if(!(e._first_time&&(!o.variant||!u.includes(o.variant)))){l="normal"}if(l){t[0].style["font-weight"]=l}let d=null;if(e.underline){d="underline"}else if(!e.underline&&!e._first_time){d="none"}if(d){t[0].style["text-decoration"]=d}let p=null;if(e.italic){p="italic"}else if(!e.italic&&!e._first_time){p="normal"}if(p){t[0].style["font-style"]=p}t[0].style.color=e.font_color;if(!(e.font_alignment==="left"&&e._first_time&&n.element.type()!=="PictureInput")){t[0].style["text-align"]=e.font_alignment}}}},(()=>{r.prototype._uses_properties=["font_face","font_family","font_weight","font_size","bold","underline","italic","font_color","font_alignment"];r.prototype.transition_properties={font_size:"font-size",font_color:"color"};r.prototype.field_names={font_face:{default:l.DEFAULT_FONT},font_family:{default:l.DEFAULT_CSS_TOKEN},font_weight:{default:l.DEFAULT_WEIGHT},font_size:{default:14},bold:{},italic:{},underline:{},font_alignment:{default:"left"},font_color:{default:"#252525"}};r.prototype.class_name="Font"})(),r)},{"../../../constants/elements":61,"../../../constants/fonts":68,"../../../lib":741,"../../../webfonts":858,"../PropertyApplication":386,"../application_utilities":387}],393:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{_apply(e,t){if(e){if(e.textshadow){const n=`${e.textshadow_horizontal}px ${e.textshadow_vertical}px ${e.textshadow_blur}px ${e.textshadow_color}`;t[0].style.textShadow=n}if(!e.textshadow&&!e._first_time){t[0].style.textShadow="none"}}}},(()=>{r.prototype._uses_properties=["textshadow","textshadow_horizontal","textshadow_vertical","textshadow_blur","textshadow_color"];r.prototype.transition_properties={textshadow:"text-shadow"};r.prototype.field_names={textshadow:{},textshadow_horizontal:{default:1},textshadow_vertical:{default:1},textshadow_blur:{default:0},textshadow_color:{default:"#Ffffff"}};r.prototype.class_name="FontShadow"})(),r)},{"../PropertyApplication":386}],394:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{_apply(e,t){if(e){if(!(e.letter_spacing===0&&e._first_time)){t[0].style["letter-spacing"]=e.letter_spacing+"px"}if(!(e.word_spacing===0&&e._first_time)){t[0].style["word-spacing"]=e.word_spacing+"px"}t[0].style["line-height"]=e.line_height}}},(()=>{r.prototype._uses_properties=["letter_spacing","word_spacing","line_height"];r.prototype.transition_properties={letter_spacing:"letter-spacing",word_spacing:"word-spacing",line_height:"line-height"};r.prototype.field_names={word_spacing:{default:0},line_height:{default:1},letter_spacing:{default:0}};r.prototype.class_name="FontSpacing"})(),r)},{"../PropertyApplication":386}],395:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");const{PADDING_VERSION:s}=e("../../../constants/elements");t.exports=(r=class e extends i{_apply(e,t,n){if(e&&(n.element.element_version(true)<s||n.element.context_element().E.is_plugin)){var r;(r=e.padding_horizontal)!=null?r:e.padding_horizontal=0;t[0].style.padding="0px "+e.padding_horizontal+"px"}}},(()=>{r.prototype._uses_properties=["padding_horizontal"];r.prototype.transition_properties={padding_horizontal:"padding"};r.prototype.field_names={padding_horizontal:{default:4}};r.prototype.class_name="InputPadding"})(),r)},{"../../../constants/elements":61,"../PropertyApplication":386}],396:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{_apply(){}},(()=>{r.prototype.field_names={min_width:{default:20,no_states:true},fixed_width:{no_states:true,default:false},use_max_width:{no_states:true,default:false},max_width:{default:100,optional:true,no_states:true},collapse_margin:{default:0,optional:true,no_states:true},responsive_alignment:{default:"center",no_states:true}};r.prototype.not_in_style=true;r.prototype.apply_once=true;r.prototype.class_name="MinWidth"})(),r)},{"../PropertyApplication":386}],397:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");const s=e("../application_utilities");t.exports=(r=class e extends i{_apply(e,t){if(e){s.apply_css_style(t,{"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","user-select":"none"})}}},r.prototype.apply_once=true,r)},{"../PropertyApplication":386,"../application_utilities":387}],398:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");const s=e("../application_utilities");t.exports=(r=class e extends i{_apply(e,t,n){let r=e.opacity/100;if(n.state("opacity_override")!=null){r=n.state("opacity_override")}s.apply_css_style(t,{opacity:r})}},(()=>{r.prototype._uses_properties=["opacity"];r.prototype.transition_properties={opacity:"opacity"};r.prototype.field_names={opacity:{default:100}};r.prototype.class_name="Opacity"})(),r)},{"../PropertyApplication":386,"../application_utilities":387}],399:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");const{PADDING_VERSION:s}=e("../../../constants/elements");t.exports=(r=class e extends i{_apply(e,t,n){if(e&&(n.element.element_version(true)<s||n.element.context_element().E.is_plugin)){var r,i;(r=e.padding_vertical)!=null?r:e.padding_vertical=0;(i=e.padding_horizontal)!=null?i:e.padding_horizontal=0;if(!(e.padding_vertical===0&&e.padding_horizontal===0&&e._first_time)){t[0].style.padding=e.padding_vertical+"px "+e.padding_horizontal+"px"}}}},(()=>{r.prototype._uses_properties=["padding_vertical","padding_horizontal"];r.prototype.transition_properties={padding_vertical:"padding-top",padding_horizontal:"padding-left"};r.prototype.field_names={padding_vertical:{default:0},padding_horizontal:{default:0}};r.prototype.class_name="Padding"})(),r)},{"../../../constants/elements":61,"../PropertyApplication":386}],400:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{constructor(e){var t,n,r;super(e==null?void 0:e.selector);this.minimum_element_version=(t=e==null?void 0:e.minimum_element_version)!=null?t:0;this.no_vertical_if_legacy_center=(n=e==null?void 0:e.no_vertical_if_legacy_center)!=null?n:false;this.allow_legacy=(r=e==null?void 0:e.allow_legacy)!=null?r:false}_apply(e,t,n){var r;if((n==null?void 0:(r=n.element.root())==null?void 0:r.get_responsive_version())<1&&!((n==null?void 0:n.element.type())==="CustomElement"&&n.element.E.custom_definition().get_responsive_version()>0)&&!this.allow_legacy){return}if(e){var i,s,o,a,l;if((n==null?void 0:n.element.element_version(true))<this.minimum_element_version){return}if(e.container_layout==="fixed"){t[0].style.padding="0px";return}(i=e.padding_top)!=null?i:e.padding_top=0;(s=e.padding_right)!=null?s:e.padding_right=0;(o=e.padding_bottom)!=null?o:e.padding_bottom=0;(a=e.padding_left)!=null?a:e.padding_left=0;if(this.no_vertical_if_legacy_center&&(n==null?void 0:(l=n.element.root())==null?void 0:l.get_responsive_version())<1&&e.vertical_centering){t[0].style["padding-left"]=e.padding_left+"px";t[0].style["padding-right"]=e.padding_right+"px"}else if(!(e.padding_top===0&&e.padding_right===0&&e.padding_bottom===0&&e.padding_left===0&&e._first_time)){t[0].style.padding=`${e.padding_top}px ${e.padding_right}px ${e.padding_bottom}px ${e.padding_left}px`}}}},(()=>{r.prototype._uses_properties=["padding_top","padding_right","padding_bottom","padding_left","vertical_centering","container_layout"];r.prototype.transition_properties={padding_top:"padding-top",padding_right:"padding-right",padding_bottom:"padding-bottom",padding_left:"padding-left"};r.prototype.field_names={padding_top:{default:0,allow_overrides:true},padding_right:{default:0,allow_overrides:true},padding_bottom:{default:0,allow_overrides:true},padding_left:{default:0,allow_overrides:true},vertical_centering:{default:false}};r.prototype.class_name="PaddingFields";r.prototype.style_allows_overrides=true})(),r)},{"../PropertyApplication":386}],401:[function(e,t,n){"use strict";var r;const{PADDING_VERSION:i}=e("../../../constants/elements");const s=e("../PropertyApplication");t.exports=(r=class e extends s{_apply(e,t,n){if(e){var r;const l=n.element.element_version(true)<i||n.element.context_element().E_object().is_plugin;if(((r=n.element.root())==null?void 0:r.get_responsive_version())>0){if(e.vertical_centering){t.addClass("bubble-r-vertical-center")}else{t.removeClass("bubble-r-vertical-center")}if(l){var s;const n=(s=e.padding_vertical)!=null?s:0;if(!(n===0&&e._first_time)){t.css({"padding-top":n,"padding-bottom":n})}}}else{var o;let n;if(e.vertical_centering){n=(e.height-e.font_size)/2-2}else{if(!l){return}n=e.padding_vertical}(o=n)!=null?o:n=0;if(!(n===0&&e._first_time)){t[0].style["padding-top"]=n+"px ";if(e.stretch_to_fit){t[0].style["padding-bottom"]=n+"px "}}}if(l){var a;(a=e.padding_horizontal)!=null?a:e.padding_horizontal=0;if(!(e.padding_horizontal===0&&e._first_time)){t[0].style["padding-left"]=e.padding_horizontal+"px ";t[0].style["padding-right"]=e.padding_horizontal+"px "}}}}},(()=>{r.prototype._uses_properties=["vertical_centering","padding_vertical","padding_horizontal","font_size","height","stretch_to_fit"];r.prototype.transition_properties={padding_vertical:"padding-top",padding_horizontal:"padding-left"};r.prototype.field_names={padding_vertical:{default:0},padding_horizontal:{default:0},vertical_centering:{default:false}};r.prototype.class_name="PaddingText"})(),r)},{"../../../constants/elements":61,"../PropertyApplication":386}],402:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r;const i=e("../PropertyApplication");const s=e("../../../u");const{PLACEHOLDER_COLOR_VERSION:o}=e("../../../constants/elements");const a={};const l=new WeakMap;t.exports=(r=class e extends i{_apply(e,t,n){if(e){if(n&&n.element.element_version(true)>=o){const n=l.get(t[0]);if(n){const e=a[n];t.removeClass(e.class_name);e.count--;if(e.count<=0){e.style_tag.remove();delete a[n]}}if(!(e.placeholder_color in a)){const t="a"+s.LUID();const n=document.createElement("style");n.textContent=`\n.${t}.${t}::-webkit-input-placeholder {\n  color: ${e.placeholder_color};\n}\n.${t}.${t}::-moz-placeholder {\n  color:    ${e.placeholder_color};\n  opacity:  1;\n}\n.${t}.${t}:-ms-input-placeholder {\n  color: ${e.placeholder_color} !important;\n}\n.${t}.${t}:-moz-placeholder {\n  color: ${e.placeholder_color};\n  opacity:  1;\n}`;document.head.appendChild(n);a[e.placeholder_color]={class_name:t,style_tag:n,count:0}}t.addClass(a[e.placeholder_color].class_name);a[e.placeholder_color].count++;l.set(t[0],e.placeholder_color)}else{t.removeClass(["grey","black","white","blue","green","red"].join(" "));if(e.placeholder_color!=="grey"&&["grey","black","white","blue","green","red"].includes(e.placeholder_color)){t.addClass(e.placeholder_color)}}}}},(()=>{r.prototype._uses_properties=["placeholder_color"];r.prototype.transition_properties={};r.prototype.no_solid_support=true;r.prototype.field_names={placeholder_color:{default:"rgba(181, 181, 181, 1)"}};r.prototype.class_name="PlaceholderColor"})(),r)},{"../../../constants/elements":61,"../../../u":823,"../PropertyApplication":386,"core-js/modules/web.dom-collections.iterator.js":1123}],403:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{_apply(){}},(()=>{r.prototype.field_names={left:{no_states:true},top:{no_states:true}};r.prototype.not_in_style=true;r.prototype.apply_once=true;r.prototype.class_name="PositionOnly"})(),r)},{"../PropertyApplication":386}],404:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{constructor(e,t,n){var r;(r=n)!=null?r:n=[];super(t,n);this.element=e}_apply(){}},(()=>{r.prototype.field_names={container_layout:{no_states:true,default:"fixed"},container_horiz_alignment:{no_states:false,default:"flex-start"},container_vert_alignment:{no_states:false,default:"flex-start"},use_gap:{no_states:true,default:false},row_gap:{no_states:false,default:0},column_gap:{no_states:false,default:0}};r.prototype.not_in_style=true;r.prototype.apply_once=true;r.prototype.class_name="ResponsiveContainer"})(),r)},{"../PropertyApplication":386}],405:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r;const i=e("../PropertyApplication");const s=e("../../../u");function o(){const e={};for(const t of["left","right","top","bottom"]){e[`margin_${t}`]={default:0}}return e}t.exports=(r=class e extends i{constructor(e,t,n){var r;(r=n)!=null?r:n=[];super(t,n);this.element=e;this.transition_properties=c(this.element)}_apply(){}},(()=>{r.prototype._uses_properties=["margin_top","margin_right","margin_bottom","margin_left","min_width_css","max_width_css","min_height_css","max_height_css","width_css","height_css"];r.prototype.transition_conditions={min_width_css(e){return!e.get_static_property("single_width")},max_width_css(e){return!e.get_static_property("single_width")},width_css(e){return e.get_static_property("single_width")},min_height_css(e){return!e.get_static_property("single_height")},max_height_css(e){return!e.get_static_property("single_height")},height_css(e){return e.get_static_property("single_height")}};r.prototype.field_names=s.extend(o(),{parent_container_type_label:{no_states:true,only_edit_mode:true},margin_label:{no_states:true,only_edit_mode:true},padding_label:{no_states:true,only_edit_mode:true},nonant_alignment:{no_states:false,default:"aa",no_plugin:true},vert_alignment:{no_states:false,default:"flex-start",no_plugin:true},horiz_alignment:{no_states:false,default:"flex-start",no_plugin:true},flex_move_first:{no_states:true,only_edit_mode:true},flex_move_prev:{no_states:true,only_edit_mode:true},flex_move_next:{no_states:true,only_edit_mode:true},flex_move_last:{no_states:true,only_edit_mode:true},single_width:{no_states:true,default:false,no_plugin:true},fit_width:{no_states:true,default:false},forced_fit_width_label:{no_states:true,only_edit_mode:true},min_width_css:{no_states:false,default:"0px"},max_width_css:{no_states:false,default:null,allow_empty_condition:true},width_css:{no_states:true,no_plugin:true},single_height:{no_states:true,default:false,no_plugin:true},fit_height:{no_states:true,default:false},forced_fit_height_label:{no_states:true,only_edit_mode:true},min_height_css:{no_states:false,default:"0px"},max_height_css:{no_states:false,default:null,allow_empty_condition:true},height_css:{no_states:true,no_plugin:true},use_aspect_ratio:{no_states:true,default:false,no_plugin:true},aspect_ratio_width:{no_states:true,default:1,no_plugin:true},aspect_ratio_height:{no_states:true,default:1,no_plugin:true},aspect_ratio_warning:{no_states:true,only_edit_mode:true},width_preview:{no_states:true,only_edit_mode:true},height_preview:{no_states:true,only_edit_mode:true},collapse_when_hidden:{no_states:true,default:false},order:{default:0,no_states:true,no_plugin:true}});r.prototype.not_in_style=true;r.prototype.apply_once=true;r.prototype.class_name="ResponsiveElement"})(),r);function a(e,t){var n;return(e==null?void 0:(n=e.parent())==null?void 0:n.get_static_property("container_layout"))==="relative"&&!e.get_static_property(`single_${t}`)&&!e.get_static_property(`fit_${t}`)}function l(e,t,n){if(a(e,n))return[t,n];return t}function c(e){return{get margin_top(){var t;if(e!=null&&(t=e.E)!=null&&t.uses_inset_instead_of_margin){return"top"}return l(e,"margin-top","height")},get margin_right(){var t;if(e!=null&&(t=e.E)!=null&&t.uses_inset_instead_of_margin){return"right"}return l(e,"margin-right","width")},get margin_bottom(){var t;if(e!=null&&(t=e.E)!=null&&t.uses_inset_instead_of_margin){return"bottom"}return l(e,"margin-bottom","height")},get margin_left(){var t;if(e!=null&&(t=e.E)!=null&&t.uses_inset_instead_of_margin){return"left"}return l(e,"margin-left","width")},min_width_css:"min-width",max_width_css:"max-width",width_css:["min-width","max-width"],min_height_css:"min-height",max_height_css:"max-height",height_css:["min-height","max-height"]}}},{"../../../u":823,"../PropertyApplication":386,"core-js/modules/web.dom-collections.iterator.js":1123}],406:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{_apply(){}},(()=>{r.prototype.field_names={default_width:{no_states:true,default:1200},min_width_px:{no_states:true,default:0},max_width_px:{no_states:true,default:null},min_height_px:{no_states:true,default:0},max_height_px:{no_states:true,default:null}};r.prototype.not_in_style=true;r.prototype.apply_once=true;r.prototype.class_name="RootSizing"})(),r)},{"../PropertyApplication":386}],407:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");const s=e("../application_utilities");t.exports=(r=class e extends i{_apply(e,t){var n;const r=(n=e.rotation_angle)!=null?n:0;if(r===0&&e._first_time){return}const i="rotate("+r+"deg)";s.apply_css_style(t,{"-ms-transform":i,"-webkit-transform":i,transform:i})}},(()=>{r.prototype.not_in_style=true;r.prototype.field_names={rotation_angle:{default:0}};r.prototype._uses_properties=["rotation_angle"];r.prototype.class_name="Rotation"})(),r)},{"../PropertyApplication":386,"../application_utilities":387}],408:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{_apply(){}},(()=>{r.prototype.field_names={width:{default:960,no_states:true},height:{default:600,no_states:true}};r.prototype.not_in_style=true;r.prototype.apply_once=true;r.prototype.class_name="ShortDimensions"})(),r)},{"../PropertyApplication":386}],409:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var r;const i=e("../../../u");const s=e("../PropertyApplication");const o=e("../../../constants/colors");t.exports=(r=class e extends s{_apply(e,t){if(e){const u=[null,undefined,"linear"].includes(e.style);const d="rgba(0,0,0,1)";let p=e.from;let _=e.to;let f,h;const m=e.mid;if(u){if(e.direction==="custom"){var n;f=((n=e.angle)!=null?n:45)+"deg"}else{var r;f=(r=e.direction)!=null?r:"top";if(f==="top"||f==="bottom"){h=0;if(f==="bottom"){const e=p;p=_;_=e;f="top"}}else if(f==="left"||f==="right"){h=1;if(f==="right"){const e=p;p=_;_=e;f="left"}}}}const g=i.RGBA_to_ARGB(p);const v=i.RGBA_to_ARGB(_);let b;if(m){b=`${p} 0%, ${m} 50%, ${_} 100%`}else{b=`${p} 0%, ${_} 100%`}let y;if(u){y=`linear-gradient(${f}, ${b})`}else{var s,a,l,c;(s=e.shape)!=null?s:e.shape="ellipse";(a=e.pos)!=null?a:e.pos="farthest-corner";(l=e.xpos)!=null?l:e.xpos=10;(c=e.ypos)!=null?c:e.ypos=10;y=`radial-gradient(${e.shape} ${e.pos} at ${e.xpos}% ${e.ypos}%, ${b})`}t[0].style.background=p;for(const e of["-moz-","-webkit-","-o-","-ms-",""]){if(y.includes("var")){let t=y.replace(o.RGB_TOKEN_ALPHA,d);t=t.replace(o.RGBA_TOKEN,d);if(!CSS.supports("background",e+t)){continue}}t[0].style.background=e+y}t.css("filter",`progid:DXImageTransform.Microsoft.gradient( startColorstr='${g}', endColorstr='${v}',GradientType=${h})`)}}_get_properties(){return[]}},r.prototype.class_name="SimpleGradient",r)},{"../../../constants/colors":53,"../../../u":823,"../PropertyApplication":386,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],410:[function(e,t,n){"use strict";var r;const i=e("../PropertyApplication");t.exports=(r=class e extends i{_apply(e,t,n){if(e&&n.run_mode()){t.attr("title",e.title_attribute)}}},(()=>{r.prototype._uses_properties=["title_attribute"];r.prototype.transition_properties={};r.prototype.not_in_style=true;r.prototype.field_names={title_attribute:{optional:true}};r.prototype.no_solid_support=true;r.prototype.class_name="ToolTip"})(),r)},{"../PropertyApplication":386}],411:[function(e,t,n){"use strict";var r;const i=e("../../../client_config");const s=e("../../../lang/appquery");const o=e("../PropertyApplication");t.exports=(r=class e extends o{_apply(e,t,n){if(e&&n.run_mode()){if(s.has_advanced_feature_enabled("expose_id_option")){if(e.unique_id!=null||!["",null,undefined].includes(t[0].id)){if(e.unique_id==null){if(!i.run_mode_ids){t.removeAttr("id")}}else{t[0].id=e.unique_id}}}}}},(()=>{r.prototype._uses_properties=["unique_id"];r.prototype.transition_properties={};r.prototype.not_in_style=true;r.prototype.field_names={title_attribute:{optional:true,no_states:true}};r.prototype.class_name="UniqueID"})(),r)},{"../../../client_config":41,"../../../lang/appquery":651,"../PropertyApplication":386}],412:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../safe_require");const i=e("./../../lang/elements/style_properties");const s=e("./application_utilities");const o=n;o.NoSelect=e("./applications/NoSelect");o.Dimensions=e("./applications/Dimensions");o.Opacity=e("./applications/Opacity");o.MinWidth=e("./applications/MinWidth");o.RootSizing=e("./applications/RootSizing");o.ResponsiveElement=e("./applications/ResponsiveElement");o.ResponsiveContainer=e("./applications/ResponsiveContainer");o.ShortDimensions=e("./applications/ShortDimensions");o.PositionOnly=e("./applications/PositionOnly");o.Rotation=e("./applications/Rotation");o.BoxShadow=e("./applications/BoxShadow");o.PaddingFields=e("./applications/PaddingFields");o.Font=e("./applications/Font");o.FontShadow=e("./applications/FontShadow");o.FontSpacing=e("./applications/FontSpacing");o.Border=e("./applications/Border");o.PaddingText=e("./applications/PaddingText");o.Padding=e("./applications/Padding");o.InputPadding=e("./applications/InputPadding");o.PlaceholderColor=e("./applications/PlaceholderColor");o.ToolTip=e("./applications/ToolTip");o.UniqueID=e("./applications/UniqueID");o.Background=e("./applications/Background");o.SimpleGradient=e("./applications/SimpleGradient");o.apply_css_style=s.apply_css_style;o.calculate_border_height=s.calculate_border_height;o.calculate_border_width=s.calculate_border_width;o.patch_user_agent_styles=s.patch_user_agent_styles;for(const e of Object.values(o)){var a;if(((a=e.prototype)==null?void 0:a.field_names)!=null&&!e.prototype.not_in_style){for(const[t,n]of Object.entries(e.prototype.field_names)){if(!n.prop_not_in_style){i.register_style_property(t)}}}}r.safe_register("./core/property_applications",o)},{"../../safe_require":777,"./../../lang/elements/style_properties":684,"./application_utilities":387,"./applications/Background":388,"./applications/Border":389,"./applications/BoxShadow":390,"./applications/Dimensions":391,"./applications/Font":392,"./applications/FontShadow":393,"./applications/FontSpacing":394,"./applications/InputPadding":395,"./applications/MinWidth":396,"./applications/NoSelect":397,"./applications/Opacity":398,"./applications/Padding":399,"./applications/PaddingFields":400,"./applications/PaddingText":401,"./applications/PlaceholderColor":402,"./applications/PositionOnly":403,"./applications/ResponsiveContainer":404,"./applications/ResponsiveElement":405,"./applications/RootSizing":406,"./applications/Rotation":407,"./applications/ShortDimensions":408,"./applications/SimpleGradient":409,"./applications/ToolTip":410,"./applications/UniqueID":411,"core-js/modules/web.dom-collections.iterator.js":1123}],413:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../../u");const i=n;const s=e("../../client/analytics");const o=e("../../lang/caching");const a=e("./../../lib");const l=e("./../../lang/appquery");const c=e("../../constants/style");const{CUSTOM_FONT_FLAG:u}=e("../../constants/fonts");const d=e("../../shared/responsive/responsive_algorithm");const p=e("../../shared/responsive/responsive_layout");const _=e("../../editor/css");const{COMPOSER_INPUT_TYPES:f}=e("../../constants/composer");const{PADDING_VERSION:h,VERSION_STYLE_OVERRIDES:m}=e("../../constants/elements");i.add_fields_to_property_applications=function(e){for(const n in e){var t;const s=e[n];if(!["downloaded_images"].includes(n)&&((t=s.prototype)==null?void 0:t.field_names)!=null){if(!i[n]||!i[n]._get_properties){throw new r.UnexpectedError("Fields definition missing for "+n)}s.prototype._get_properties=i[n]._get_properties}}};i.NoSelect={_get_properties:o.all_cache("_get_properties",(()=>[]))};function g(e){return!w(e)||P(e)==="fixed"}function v(e){return g(e)||e.force_fixed()||!e.can_be_variable_width()||!e.E.uses_css_responsive}i.Dimensions={_get_properties:o.all_cache("_get_properties",(()=>[{name:"width",caption:"Width",editor:"StaticNumber",validation_fn(e){return e>=1&&e<5001},condition:v,pretty:{section:"Position2",short_caption:"W"}},{name:"height",caption:"Height",editor:"StaticNumber",validation_fn(e){return e>=1&&e<50001},condition:v,pretty:{section:"Position2",short_caption:"H"}},{name:"left",caption:"X",editor:"StaticNumber",condition:g,pretty:{section:"Position2"}},{name:"top",caption:"Y",editor:"StaticNumber",condition:g,pretty:{section:"Position2"}}]))};function b(e){var t;if(((t=e.root())==null?void 0:t.get_responsive_version())>0){return!e.uses_css_responsive()}return true}i.MinWidth={_get_properties:o.all_cache("_get_properties",(()=>{var e;return[{name:"fixed_width",caption:(e=window)!=null&&e.is_maison?"Fixed width":"Make this element fixed-width",editor:"Checkbox",condition(e){var t;return b(e)&&((t=e.root())==null?void 0:t.use_responsive_algorithm())},pretty:{section:"Position"}},{name:"min_width",caption:"Minimum width (% of current width)",editor:"StaticNumber",integer:true,validation_fn(e){return e>=0&&e<100},condition(e){var t;return b(e)&&((t=e.root())==null?void 0:t.use_responsive_algorithm())&&!e.get_static_property("fixed_width")},pretty:{section:"Position"}},{name:"use_max_width",caption:"Apply a max width when the page is stretched",editor:"Checkbox",condition(e){var t;return b(e)&&((t=e.root())==null?void 0:t.use_responsive_algorithm())&&!e.get_static_property("fixed_width")&&e.max_width_adjustable_legacy()},pretty:{section:"Position"}},{name:"max_width",caption:"Maximum width (% of current width)",editor:"StaticNumber",integer:true,condition(e){var t;return b(e)&&((t=e.root())==null?void 0:t.use_responsive_algorithm())&&!e.get_static_property("fixed_width")&&e.max_width_adjustable_legacy()&&e.get_static_property("use_max_width")},pretty:{section:"Position"}}]}))};function y(){return[{name:"default_width",caption:"Width for UI builder",editor:"StaticNumber",validation_fn(e){return e>0},integer:true,condition(e){return w(e)&&!e.force_fixed()},pretty:{section:"Responsive"},include_in_redesign:false},{name:"min_width_px",caption:"Min width",editor:"StaticNumber",integer:true,validation_fn(e){return e>=0},condition(e){return w(e)&&!e.force_fixed()},pretty:{section:"Responsive"},include_in_redesign:false},{name:"max_width_px",caption:"Max width",editor:"StaticNumber",integer:true,optional:true,placeholder:"inf",condition(e){return w(e)&&!e.force_fixed()&&!e.not_max_adjustable()},pretty:{section:"Responsive"},include_in_redesign:false},{name:"min_height_px",caption:"Min height",editor:"StaticNumber",integer:true,validation_fn(e){return e>=0},condition(e){return w(e)&&!e.force_fixed()},pretty:{section:"Responsive"},include_in_redesign:false},{name:"max_height_px",caption:"Max height",editor:"StaticNumber",integer:true,optional:true,placeholder:"inf",condition(e){return w(e)&&!e.force_fixed()&&!e.not_max_adjustable()},pretty:{section:"Responsive"},include_in_redesign:false}]}i.RootSizing={_get_properties(){return y()}};function w(e){const t=e==null?void 0:e.root();if(t!=null){return t.get_responsive_version()>0}else{return true}}const x=["top","bottom","left","right"].map((e=>{const t=`margin_${e}`;return{name:t,caption:r.FirstLetterCapitalize(e),long_caption:`${r.FirstLetterCapitalize(e)} margin`,editor:"StaticNumber",integer:true,transition:true,condition(e){return w(e)&&!e.no_margins()},pretty:{section:"Margins"},include_in_redesign:false}}));const j=e=>["top","bottom","left","right"].map((t=>{const n=`padding_${t}`;return{name:n,caption:r.FirstLetterCapitalize(t),long_caption:`${r.FirstLetterCapitalize(t)} padding`,editor:"StaticNumber",integer:true,transition:true,condition(t){if(t.element_version(true)<h){return w(t)&&!t.force_fixed()&&!e}return w(t)?!t.force_fixed():e},placeholder(e){const n=e.get_style_if_exists();if(n!=null){return n.get_static_property(`padding_${t}`)}else{return null}},pretty:{section:"PaddingFields"},include_in_redesign:false}}));const A={aa:"Top-left",ba:"Top",ca:"Top-right",ab:"Left",bb:"Center",cb:"Right",ac:"Bottom-left",bc:"Bottom",cc:"Bottom-right"};const M={"flex-start":"Top-aligned",center:"Centered","flex-end":"Bottom-aligned",stretch:"Vertical stretch"};const E={"flex-start":"Left-aligned",center:"Centered","flex-end":"Right-aligned",stretch:"Horizontal stretch"};const k={"flex-start":"Left-aligned",center:"Centered","flex-end":"Right-aligned","space-around":"Space around","space-between":"Space between"};const O={"flex-start":"Top-aligned",center:"Centered","flex-end":"Bottom-aligned","space-around":"Space around","space-between":"Space between"};function S(e){var t,n;return((t=(n=e.parent())==null?void 0:n.elements())!=null?t:[]).filter((e=>e.added_to_container()))}function D(e){const t=e.get_static_property("order");if(t===1){return true}for(const n of S(e)){if(n.get_static_property("order")<t){return false}}return true}function C(e){const t=e.get_static_property("order");for(const n of S(e)){if(n.get_static_property("order")>t){return false}}return true}function T(e){const t=r.extend({},E);if(e!=null&&e.get_static_property("single_width")){delete t.stretch}return a().sets.get_set("Object")(t)}function N(e){const t=r.extend({},M);if(e!=null&&e.get_static_property("single_height")){delete t.stretch}return a().sets.get_set("Object")(t)}function P(e){if(!e.added_to_container()){return null}const t=e.get_containing_element();if(t!=null){return t.get_static_property("container_layout")}else{return null}}function I(e){return P(e)==="fixed"||e.force_fixed()||e.not_resizable()}function R(e){return function(t){if(!w(t)){return false}if(Array.isArray(e)){return e.includes(P(t))}else{return P(t)===e}}}function L(e){var t;let{element:n,dimension:i,condition:s}=e;(t=s)!=null?t:s=()=>true;function o(e){if(!w(e)||!(e!=null&&e.can_be_variable_width())||I(e)||b(e)){return false}return s(e)}const l=e=>!(e!=null&&e.can_be_variable_width())||(e==null?void 0:e.get_static_property(`single_${i}`));return[{name:`single_${i}`,caption:`Make this element fixed-${i}`,editor:"Checkbox",condition:o,on_change(){const e={width:"horiz_alignment",height:"vert_alignment"};if(n.get_static_property(e[i],true)==="stretch"){return n.set_property(e[i],"flex-start")}},pretty:{section:"Responsive"},include_in_redesign:false},{name:`min_${i}_css`,caption:l(n)?`${r.FirstLetterCapitalize(i)}`:`Min ${i}`,editor:"CSSDimension",transition:!l(n),condition:o,pretty:{section:"Responsive"},include_in_redesign:false},{name:`max_${i}_css`,caption:`Max ${i}`,editor:"CSSDimension",optional:true,placeholder:"inf",transition:!l(n),condition(e){return o(e)&&!e.is_fixed_dimension(i)&&!e.not_max_adjustable()},pretty:{section:"Responsive"},include_in_redesign:false},{name:`${i}_css`,caption:`${r.FirstLetterCapitalize(i)}`,editor:"CSSDimension",transition:l(n),condition(e){return false},pretty:{section:"Responsive"},include_in_redesign:false},{name:`fit_${i}`,caption:`Fit ${i} to content`,editor:"Checkbox",condition(e){if(!w(e)||!e[`can_fit_${i}`]()||e.get_static_property(`single_${i}`)||e.force_fixed()){return false}if(!o(e)){return false}const t=P(e);if(t==="fixed"){return false}if(i==="width"&&t==="column"&&e.get_static_property("horiz_alignment",true)==="stretch"){return false}if(i==="height"&&t==="row"){return false}return true},pretty:{section:"Responsive"},include_in_redesign:false},{name:`forced_fit_${i}_label`,editor:"Label",condition(e){return o(e)&&e[`can_fit_${i}`]()&&!e.get_static_property(`single_${i}`)&&!e.force_fixed()&&P(e)===p.DIMENSION_TO_CROSS_AXIS[i]&&(i==="height"||e.get_static_property("horiz_alignment",true)==="stretch")},label_text(){const e={width:"horiz_alignment",height:"vert_alignment"};if(n.get_static_property(e[i],true)==="stretch"){return`This element is stretching to its maximum ${i} because of its alignment`}else{return"This element is fitting to its content. To change this, change its alignment"}},pretty:{section:"Responsive"},include_in_redesign:false},{name:`${i}_preview`,editor:"Label",condition(e){return w(e)&&s(e)},label_text(){if(I(n)||!n.can_be_variable_width()){return`${n.get_static_property(i)}px`}const e=n.get_static_property(`min_${i}_css`,true);if(n.get_static_property(`single_${i}`)){return e}else{var t;const r=(t=n.get_static_property(`max_${i}_css`,true))!=null?t:"inf";return`${e} - ${r}`}},click_cb(){a().property_editor.current_tab("layout")},pretty:{section:"SizingPreviews"},include_in_redesign:false}]}i.ResponsiveElement={_get_properties(){return[{name:"parent_container_type_label",editor:"Label",label_text:()=>p.LAYOUT_NAMES[P(this.element)],condition(e){return w(e)&&P(e)!=null},click_cb:()=>{a().visual_edit.select_to_edit(this.element.parent().id())},pretty:{section:"Responsive"},include_in_redesign:false},{name:"nonant_alignment",caption:"Alignment",editor:"Dropdown_Button",set:a().sets.get_set("Object")(A),condition:R("relative"),pretty:{no_caption:true,section:"Responsive"},include_in_redesign:false},{name:"horiz_alignment",caption:"Horizontal alignment",editor:"Dropdown_Button",set:T(this.element),condition:R("column"),add_title:true,pretty:{section:"Responsive"},include_in_redesign:false},{name:"vert_alignment",caption:"Vertical alignment",editor:"Dropdown_Button",set:N(this.element),condition:R("row"),add_title:true,pretty:{section:"Responsive"},include_in_redesign:false},{name:"flex_move_first",button_caption:"Make first",editor:"Button",optional:true,click_cb(e){const t=e.get_static_property("order");for(const n of S(e)){if(n.id()!==e.id()){const e=n.get_static_property("order");if(e<t){n.set_property("order",e+1)}}}e.set_property("order",1);l.commit()},condition:R(p.FLEX_LAYOUTS),disabled:D,pretty:{section:"Responsive",no_caption:true,width:"tiny"},include_in_redesign:false},{name:"flex_move_prev",button_caption:"Previous",editor:"Button",optional:true,click_cb(e){const t=S(e).sort(((e,t)=>e.get_static_property("order")-t.get_static_property("order")));for(let n=0;n<t.length;n++){const r=t[n];if(r.id()===e.id()){const r=t[n-1].get_static_property("order");t[n-1].set_property("order",e.get_static_property("order"));e.set_property("order",r);break}}l.commit()},condition:R(p.FLEX_LAYOUTS),disabled:D,pretty:{section:"Responsive",no_caption:true,width:"tiny"},include_in_redesign:false},{name:"flex_move_next",button_caption:"Next",editor:"Button",optional:true,click_cb(e){const t=S(e).sort(((e,t)=>e.get_static_property("order")-t.get_static_property("order")));for(let n=0;n<t.length;n++){const r=t[n];if(r.id()===e.id()){const r=t[n+1].get_static_property("order");t[n+1].set_property("order",e.get_static_property("order"));e.set_property("order",r);break}}l.commit()},condition:R(p.FLEX_LAYOUTS),disabled:C,pretty:{section:"Responsive",no_caption:true,width:"tiny"},include_in_redesign:false},{name:"flex_move_last",button_caption:"Make last",editor:"Button",optional:true,click_cb(e){const t=e.get_static_property("order");let n=t;for(const r of S(e)){if(r.id()!==e.id()){const e=r.get_static_property("order");if(e>t){r.set_property("order",e-1)}n=Math.max(n,e)}}e.set_property("order",n);l.commit()},condition:R(p.FLEX_LAYOUTS),disabled:C,pretty:{section:"Responsive",no_caption:true,width:"tiny"},include_in_redesign:false}].concat(L({element:this.element,dimension:"width",condition(e){var t,n;const r=((t=e.parent)==null?void 0:(n=t.call(e))==null?void 0:n.get_static_property("table_direction"))==="horizontal";if(e.type()==="TableMainAxis"){return!r}else if(e.type()==="TableCrossAxis"){return r}return true}})).concat([{name:"use_aspect_ratio",editor:"Checkbox",caption:"Keep element aspect ratio fixed",condition(e){return w(e)&&e.can_fix_aspect_ratio()&&!I(e)},pretty:{short_caption:false,section:"Responsive"},include_in_redesign:false},{name:"aspect_ratio_width",editor:"StaticNumber",caption:"Aspect ratio",integer:true,condition(e){return w(e)&&e.has_fixed_aspect_ratio()},validation_fn(e){return e>=1},pretty:{short_caption:false,section:"Responsive"},include_in_redesign:false},{name:"aspect_ratio_height",editor:"StaticNumber",caption:"x",integer:true,condition(e){return w(e)&&e.has_fixed_aspect_ratio()},validation_fn(e){return e>=1},pretty:{short_caption:false,section:"Responsive"},include_in_redesign:false},{name:"aspect_ratio_warning",editor:"Label",label_text:"Height automatically determined by width when aspect ratio fixed",condition(e){return w(e)&&e.has_fixed_aspect_ratio()},pretty:{short_caption:false,section:"Responsive"},include_in_redesign:false}].concat(L({element:this.element,dimension:"height",condition(e){var t,n;const r=((t=e.parent)==null?void 0:(n=t.call(e))==null?void 0:n.get_static_property("table_direction"))==="horizontal";if(e.type()==="TableMainAxis"){return r}else if(e.type()==="TableCrossAxis"){return!r}return!e.has_fixed_aspect_ratio()}})).concat([{name:"margin_label",editor:"Label",label_text:"Margins",condition(e){return w(e)&&!e.no_margins()},pretty:{short_caption:false,section:"Margins"},include_in_redesign:false}].concat(x).concat([{name:"collapse_when_hidden",caption:"Collapse when hidden",editor:"Checkbox",condition:R(p.NON_FIXED_LAYOUTS),pretty:{section:"Position"}}])))}};i.ResponsiveContainer={_get_properties(){const e=this.element.get_static_property("container_layout");return[{name:"container_layout",caption:this.element.type()==="RepeatingGroup"||this.element.type()==="TableCell"?"Cell's container layout":"Container layout",editor:"Dropdown",set:a().sets.get_set("Object")(p.LAYOUT_NAMES),condition:w,on_change:t=>{const n=a().visual_edit.current_editor_canvas.getFirstContainer(this.element);const r=n.new_layout_properties(e);if(this.element.type()==="Page"){s.track("page responsive layout type changed",{app:l.appname(),page:this.element.name(),old_layout:e,current_layout:t})}for(const e in r){const t=r[e];const n=l.element(e);for(const e in t){const r=t[e];n.set_property(e,r)}}if(!this.element.E.no_fixed_sizing){if(t==="fixed"){this.element.set_property("width",parseInt(n.container_canvas.outerWidth()));this.element.set_property("height",parseInt(n.container_canvas.outerHeight()))}else if(e==="fixed"){d.on_container_layout_change_from_fixed(this.element)}}l.commit_merge()},pretty:{section:"ResponsiveContainer"},include_in_redesign:false},{name:"container_horiz_alignment",caption:"Container alignment",editor:"Dropdown_Button",set:a().sets.get_set("Object")(k),condition(e){return w(e)&&e.get_static_property("container_layout")==="row"},add_title:true,pretty:{section:"ResponsiveContainer"},include_in_redesign:false},{name:"container_vert_alignment",caption:"Container alignment",editor:"Dropdown_Button",set:a().sets.get_set("Object")(O),condition(e){return w(e)&&e.get_static_property("container_layout")==="column"},add_title:true,pretty:{section:"ResponsiveContainer"},include_in_redesign:false},{name:"use_gap",caption:"Apply gap spacing between elements",editor:"Checkbox",condition(e){return e.type()!=="RepeatingGroup"&&w(e)&&p.FLEX_LAYOUTS.includes(e.get_static_property("container_layout"))},pretty:{section:"ResponsiveContainer"},include_in_redesign:false},{name:"row_gap",caption:"Row gap (px)",editor:"StaticNumber",condition(e){return e.get_static_property("use_gap")&&p.FLEX_LAYOUTS.includes(e.get_static_property("container_layout"))},integer:true,pretty:{section:"ResponsiveContainer"},include_in_redesign:false},{name:"column_gap",caption:"Column gap (px)",editor:"StaticNumber",condition(e){return e.get_static_property("use_gap")&&e.get_static_property("container_layout")==="row"},integer:true,pretty:{section:"ResponsiveContainer"},include_in_redesign:false}]}};i.ShortDimensions={_get_properties:o.all_cache("_get_properties",(()=>[{name:"width",caption:"Width",editor:"StaticNumber",validation_fn(e){return e>=1&&e<5001},condition:v,pretty:{section:"ShortPosition"}},{name:"height",caption:"Height",editor:"StaticNumber",condition:v,pretty:{section:"ShortPosition"}}]))};i.PositionOnly={_get_properties:o.all_cache("_get_properties",(()=>[{name:"left",caption:"X",editor:"StaticNumber",condition:g,pretty:{section:"Position2"}},{name:"top",caption:"Y",editor:"StaticNumber",condition:g,pretty:{section:"Position2"}}]))};i.Rotation={_get_properties:o.all_cache("_get_properties",(()=>[{name:"rotation_angle",caption:"Rotation angle",editor:"StaticNumber",pretty:{section:"ToolTipRotation"}}]))};i.BoxShadow={_get_properties:o.all_cache("_get_properties",(()=>[{name:"boxshadow_style",caption:"Boxshadow style",editor:"Dropdown",set:a().sets.get_set("Object")({none:"None",outset:"Outset",inset:"Inset"},f.ENUMERATED),transition:true,pretty:{section:"Boxshadow",short_caption:"Shadow style"}},{name:"boxshadow_horizontal",caption:"Horizontal offset",editor:"Dropdown",set:a().sets.get_set("Integer")([-16,-8,-4,-2,-1,0,1,2,4,8,16]),numerical_step:1,condition:"boxshadow_style",pretty:{section:"Boxshadow",short_caption:"Horizontal offset"}},{name:"boxshadow_vertical",caption:"Vertical offset",editor:"Dropdown",set:a().sets.get_set("Integer")([-16,-8,-4,-2,-1,0,1,2,4,8,16]),numerical_step:1,condition:"boxshadow_style",pretty:{section:"Boxshadow",short_caption:"Vertical offset"}},{name:"boxshadow_blur",caption:"Boxshadow blur radius",editor:"Dropdown",set:a().sets.get_set("Integer")([0,1,2,4,8,16]),numerical_step:1,condition:"boxshadow_style",pretty:{section:"Boxshadow",short_caption:"Blur radius"}},{name:"boxshadow_spread",caption:"Boxshadow spread radius",editor:"Dropdown",set:a().sets.get_set("Integer")([0,1,2,4,8,16]),numerical_step:1,optional:true,condition:"boxshadow_style",pretty:{section:"Boxshadow",short_caption:"Spread radius"}},{name:"boxshadow_color",caption:"Boxshadow color",editor:"Color",condition:"boxshadow_style",dynamic:true,pretty:{section:"Boxshadow"}}]))};i.Font={_get_properties:o.all_cache("_get_properties",(function(){return[{name:"font_family",caption:"Font",editor:"Dropdown",set:a().sets.get_set("FontFamilies")(),pretty:{no_caption:true,section:"Font",dropdown_width:"extra_large",sticky_section:"Tokens"}},{name:"font_weight",caption:"Font weight",editor:"Dropdown",set:a().sets.get_set("FontWeights")(),condition(e){var t;return!(e!=null&&(t=e.get_static_property("font_family",true))!=null&&t.includes(u))},pretty:{no_caption:true,section:"Font",right_align:true}},{name:"font_size",caption:"Font size",editor:"Dropdown",set:a().sets.get_set("Integer")([6,7,8,9,10,11,12,14,18,24,36],undefined,{display_formatting_fn(e){return`${e}px`}}),numerical_step:1,transition:true,pretty:{no_caption:true,section:"Font"}},{name:"font_alignment",caption:"Text alignment",editor:"Dropdown_Button",set:a().sets.get_set("Object")({left:"Left",center:"Center",right:"Right"}),pretty:{no_caption:true,section:"Font"}},{name:"bold",caption:"Bold",editor:"Checkbox",pretty:{no_caption:true,section:"Font",checkbox_type:"glyph_toggle"}},{name:"italic",caption:"Italic",editor:"Checkbox",pretty:{no_caption:true,section:"Font",checkbox_type:"glyph_toggle"}},{name:"underline",caption:"Underline",editor:"Checkbox",pretty:{no_caption:true,section:"Font",checkbox_type:"glyph_toggle"}},{name:"font_color",caption:"Font color",editor:"Color",transition:true,dynamic:true,pretty:{short_caption:true,section:"Font"}}]}))};i.FontShadow={_get_properties:o.all_cache("_get_properties",(()=>[{name:"textshadow",caption:"Show text shadow",editor:"Checkbox",transition:true,pretty:{section:"FontShadow"}},{name:"textshadow_horizontal",caption:"Horizontal Offset",editor:"Dropdown",set:a().sets.get_set("Integer")([-10,-4,-3,-2,-1,0,1,2,3,4,10]),numerical_step:1,condition:"textshadow",pretty:{section:"FontShadow",short_caption:"Horizontal offset"}},{name:"textshadow_vertical",caption:"Vertical Offset",editor:"Dropdown",set:a().sets.get_set("Integer")([-10,-4,-3,-2,-1,0,1,2,3,4,10]),numerical_step:1,condition:"textshadow",pretty:{section:"FontShadow",short_caption:"Vertical offset"}},{name:"textshadow_blur",caption:"Font shadow blur radius",editor:"Dropdown",set:a().sets.get_set("Integer")([0,1,2,4,8,16]),numerical_step:1,condition:"textshadow",pretty:{section:"FontShadow",short_caption:"Blur radius"}},{name:"textshadow_color",caption:"Fontshadow color",editor:"Color",condition:"textshadow",dynamic:true,pretty:{section:"FontShadow",short_caption:"Text shadow color"}}]))};i.FontSpacing={_get_properties:o.all_cache("_get_properties",(()=>[{name:"word_spacing",caption:"Word spacing",editor:"Dropdown",numerical_step:1,set:a().sets.get_set("Numeric")([-2,-1,0,1,2,3,4,5,6,7,8,9,10]),transition:true,pretty:{section:"Font"}},{name:"line_height",caption:"Line spacing",editor:"Dropdown",set:a().sets.get_set("Numeric")([.5,1,1.5,2]),numerical_step:.1,transition:true,pretty:{section:"Font"}},{name:"letter_spacing",caption:"Letter spacing",editor:"Dropdown",set:a().sets.get_set("Numeric")([-2,-1,0,1,2,3,4,5,6,7,8,9,10]),numerical_step:.5,transition:true,pretty:{section:"Font"}}]))};i.Border={_get_properties:o.all_cache("_get_properties",(function(){var e,t,n;const i=e=>{var t,n,i;const s=e?"_"+e:"";const o=e?" - "+e:!((t=this.data)!=null&&t.only_main_border)?" - all borders":"";let l;if(e){l=c.BORDER_TO_CORNER_MAPPING[e]}return[{name:"border_style"+s,caption:"Border style"+o,editor:"Dropdown",set:a().sets.get_set("Object")({none:"None",solid:"Solid",dotted:"Dotted",dashed:"Dashed",double:"Double",groove:"Groove",ridge:"Ridge",inset:"Inset",outset:"Outset"}),pretty:{section:"Border",short_caption:false,dropdown_width:"large"}},{name:"border_roundness"+s,caption:"Border roundness",long_caption:"Border roundness "+((n=l)!=null?n:""),editor:"Dropdown",set:a().sets.get_set("Integer")([0,1,2,5,10,20]),numerical_step:1,transition:true,pretty:{section:"Border",short_caption:r.toTitleCase((i=l)!=null?i:"roundness")}},{name:"border_width"+s,caption:"Border width",long_caption:"Border width"+o,editor:"Dropdown",set:a().sets.get_set("Integer")([1,2,5,10,20]),numerical_step:1,transition:true,pretty:{section:"Border",short_caption:true}},{name:"border_color"+s,caption:"Border color",long_caption:"Border color"+o,editor:"Color",transition:true,dynamic:true,pretty:{section:"Border",short_caption:"Color"}}]};let s;if(!((e=this.data)!=null&&e.only_main_border)){s=[{name:"four_border_style",caption:"Define each border independently",editor:"Checkbox",pretty:{section:"Border"}}]}else{s=[]}const o=i();if(!((t=this.data)!=null&&t.only_main_border)){for(const e of o){if(["border_style","border_roundness"].includes(e.name)){e.condition="four_border_style is false"}else{e.condition=["four_border_style is false","border_style"]}}}else{for(const e of o){if(["border_color","border_width"].includes(e.name)){e.condition="border_style"}}}s.push(...o||[]);if(!((n=this.data)!=null&&n.only_main_border)){for(const e of["top","right","bottom","left"]){const t=i(e);for(const n of t){if(["border_style_"+e,"border_roundness_"+e].includes(n.name)){n.condition="four_border_style"}else{n.condition=["four_border_style","border_style_"+e]}}s.push(...t||[])}}return s}))};function z(e){return["top","bottom","left","right"].filter((t=>e.property(`padding_${t}`).raw()!=null))}const B=e=>{let{element:t,allowLegacy:n}=e;if(t.element_version(true)<h){return w(t)&&!t.force_fixed()&&a().visual_edit.is_active()&&t.get_style_if_exists()&&!n}else{if(w(t)){return t.get_style_if_exists()&&!t.force_fixed()&&a().visual_edit.is_active()}return t.get_style_if_exists()&&n}};i.PaddingFields={_get_properties:o.all_cache("_get_properties",(function(){return[{name:"padding_label",editor:"Label",label_text:"Padding",condition:e=>{if(e.element_version(true)<h){return w(e)&&!e.force_fixed()&&!this.allow_legacy}return w(e)?!e.force_fixed():this.allow_legacy},pretty:{short_caption:false,section:"PaddingFields"},include_in_redesign:false},{name:"padding_reset",editor:"Label",label_text:e=>"Reset",condition:e=>{if(z(e).length===0){return false}return B({element:e,allowLegacy:this.allow_legacy})},click_cb:e=>{for(const t of["top","right","bottom","left"]){e.set_property(`padding_${t}`,null)}l.commit()},pretty:{section:"PaddingFields"},include_in_redesign:false},{name:"padding_edit_style",editor:"Label",label_text:e=>{if(z(e).length){return"Style (overridden)"}return"Style"},condition:e=>B({element:e,allowLegacy:this.allow_legacy}),click_cb:e=>{const t=e.element_version();if(t>=m){a().property_editor.current_tab("appearance")}else{a().styles_editor.element_styles_editor().currently_displayed_style(e.get_style_id());$(_.STYLES_TAB).click()}},pretty:{section:"PaddingFields"},include_in_redesign:false}].concat(j(this.allow_legacy))}))};i.PaddingText={_get_properties:o.all_cache("_get_properties",(()=>[{name:"padding_vertical",caption:"Vertical padding",editor:"Dropdown",set:a().sets.get_set("Integer")([0,1,2,4,10,20]),transition:true,condition(e){return e.context_element().E_object().is_plugin||e.element_version(true)<h},numerical_step:1,pretty:{short_caption:"V",section:"Padding"}},{name:"padding_horizontal",caption:"Horizontal padding",editor:"Dropdown",set:a().sets.get_set("Integer")([0,1,2,4,10,20]),numerical_step:1,transition:true,condition(e){return e.context_element().E_object().is_plugin||e.element_version(true)<h},pretty:{short_caption:"H",section:"Padding"}},{name:"vertical_centering",caption:"Center the text vertically",editor:"Checkbox",pretty:{section:"CenterVertically"}}]))};i.Padding={_get_properties:o.all_cache("_get_properties",(()=>[{name:"padding_vertical",caption:"Vertical padding",editor:"Dropdown",set:a().sets.get_set("Integer")([0,1,2,4,10,20]),numerical_step:1,transition:true,condition(e){return e.context_element().E_object().is_plugin||e.element_version(true)<h},pretty:{short_caption:"V",section:"Padding"}},{name:"padding_horizontal",caption:"Horizontal padding",editor:"Dropdown",set:a().sets.get_set("Integer")([0,1,2,4,10,20]),numerical_step:1,transition:true,condition(e){return e.context_element().E_object().is_plugin||e.element_version(true)<h},pretty:{short_caption:"H",section:"Padding"}}]))};i.InputPadding={_get_properties:o.all_cache("_get_properties",(()=>[{name:"padding_horizontal",caption:"Horizontal padding",editor:"Dropdown",set:a().sets.get_set("Integer")([0,1,2,4,10,20]),numerical_step:1,transition:true,condition(e){return e.context_element().E_object().is_plugin||e.element_version(true)<h},pretty:{section:"InputPadding"}}]))};i.Opacity={_get_properties:o.all_cache("_get_properties",(()=>[{name:"opacity",caption:"Opacity",editor:"StaticNumber",validation_fn(e){return e>=0&&e<=100},integer:true,pretty:{section:"Opacity"},transition:true}]))};i.PlaceholderColor={_get_properties:o.all_cache("_get_properties",(()=>[{name:"placeholder_color",caption:"Placeholder color",editor:"Color",pretty:{section:"PlaceholderColor"}}]))};i.ToolTip={_get_properties:o.all_cache("_get_properties",(()=>[{name:"title_attribute",caption:"Tooltip text (on hover)",editor:"ShortText",pretty:{section:"ToolTipRotation"}}]))};i.UniqueID={_get_properties:o.all_cache("_get_properties",(()=>[{name:"unique_id",caption:"ID Attribute",editor:"ShortText",optional:true,condition:()=>l.has_advanced_feature_enabled("expose_id_option"),pretty:{section:"UniqueID"}}]))};i._background_properties_getter=function(e,t){var n,r;let i,s;(n=e)!=null?n:e="";(r=t)!=null?r:t="Background";if(e==="backdrop_"){s=a().sets.get_set("Object")({none:"None",bgcolor:"Flat color",gradient:"Gradient",image:"Image",video:"Video"});i=" - Backdrop"}else{s=a().sets.get_set("Object")({none:"None",bgcolor:"Flat color",gradient:"Gradient",image:"Image"});i=""}const o=t=>t.get_static_property(e+"background_style",true)==="gradient"&&t.get_static_property(e+"background_gradient_style",true)==="radial";const l=t=>t.get_static_property(e+"background_style",true)==="gradient"&&[null,undefined,"linear"].includes(t.get_static_property(e+"background_gradient_style",true));return[{name:e+"background_style",caption:"Background style",long_caption:"Background style "+i,editor:"Dropdown",transition:true,set:s,pretty:{short_caption:false,section:t}},{name:e+"bgcolor",caption:"Background color",long_caption:"Background color "+i,editor:"Color",dynamic:true,condition:e+"background_style is bgcolor",pretty:{short_caption:true,section:t}},{name:e+"background_gradient_style",caption:"Gradient style",long_caption:"Gradient style "+i,editor:"Dropdown",set:a().sets.get_set("List")(["linear","radial"]),condition:e+"background_style is gradient",pretty:{section:t}},{name:e+"background_gradient_direction",caption:"Gradient direction",long_caption:"Gradient direction "+i,editor:"Dropdown",set:a().sets.get_set("List")(["top","left","bottom","right","custom"]),condition:l,pretty:{section:t}},{name:e+"background_gradient_custom_angle",caption:"Direction degrees",editor:"StaticNumber",validation_fn(e){return e>=0&&e<=360},condition(t){return l(t)&&t.get_static_property(e+"background_gradient_direction",true)==="custom"},pretty:{section:t}},{name:e+"background_radial_gradient_shape",caption:"Gradient shape",editor:"Dropdown",set:a().sets.get_set("List")(["ellipse","circle"]),condition:o,pretty:{section:t}},{name:e+"background_radial_gradient_size",caption:"Gradient base",editor:"Dropdown",set:a().sets.get_set("List")(["closest-side","closest-corner","farthest-side","farthest-corner"]),condition:o,pretty:{section:t}},{name:e+"background_radial_gradient_xpos",caption:"X center position (%)",editor:"StaticNumber",condition:o,pretty:{section:t}},{name:e+"background_radial_gradient_ypos",caption:"Y center position (%)",editor:"StaticNumber",condition:o,pretty:{section:t}},{name:e+"background_gradient_from",caption:"Starting color",long_caption:"Starting color "+i,dynamic:true,editor:"Color",condition:e+"background_style is gradient",pretty:{section:t}},{name:e+"background_gradient_to",caption:"Ending color",long_caption:"Ending color "+i,editor:"Color",dynamic:true,condition:e+"background_style is gradient",pretty:{section:t}},{name:e+"background_gradient_mid",caption:"Intermediate color",long_caption:"Intermediate color "+i,editor:"Color",optional:true,dynamic:true,empty_possible:true,condition:e+"background_style is gradient",pretty:{section:t}},{name:e+"background_image",caption:"Background image",long_caption:"Background image "+i,editor:"DynamicImage",condition:e+"background_style is image",pretty:{no_caption:true,section:t}},{name:e+"center_background",caption:"Center the image",long_caption:"Center the image "+i,editor:"Checkbox",condition:e+"background_style is image",pretty:{section:t}},{name:e+"background_size_cover",caption:"Make image as wide as parent element",long_caption:"Make image as wide as parent element "+i,editor:"Checkbox",condition:e==="backdrop_"?["backdrop_background_style is image","backdrop_image_paralax is false"]:"background_style is image",pretty:{section:t}},{name:e+"crop_responsive",caption:"Crop the image to fit the element size",editor:"Checkbox",condition(t){var n,r,i;if(t.type()==="Page"||t.get_static_property(e+"background_style",true)!=="image"){return false}return(n=t.root)==null?void 0:(r=n.call(t))==null?void 0:(i=r.use_responsive_algorithm)==null?void 0:i.call(r)},pretty:{section:t}},{name:e+"repeat_background_vertical",caption:"Repeat the image vertically",long_caption:"Repeat the image vertically "+i,editor:"Checkbox",condition:e==="backdrop_"?["backdrop_background_style is image","backdrop_image_paralax is false"]:"background_style is image",pretty:{section:t}},{name:e+"repeat_background_horizontal",caption:"Repeat the image horizontally",long_caption:"Repeat the image horizontally "+i,editor:"Checkbox",condition:e==="backdrop_"?["backdrop_background_style is image","backdrop_image_paralax is false"]:"background_style is image",pretty:{section:t}},{name:e+"background_color_if_empty_image",caption:"Background color if empty",editor:"Color",dynamic:true,condition:e==="backdrop_"?["backdrop_background_style is image","backdrop_image_paralax is false"]:"background_style is image",pretty:{section:t}}]};i.Background={_get_properties:o.all_cache("_get_properties",(()=>i._background_properties_getter()))};i.SimpleGradient={_get_properties(){return[]}}},{"../../client/analytics":20,"../../constants/composer":54,"../../constants/elements":61,"../../constants/fonts":68,"../../constants/style":89,"../../editor/css":560,"../../lang/caching":656,"../../shared/responsive/responsive_algorithm":802,"../../shared/responsive/responsive_layout":804,"./../../lang/appquery":651,"./../../lib":741,"./../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],414:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../lang/btypes");const s=e("../lib");const o=e("../lang/btype_ids");const a=e("../safe_require");a.safe_register("./core/shared_fields",r);const l=e("../lang/appquery");const{DropdownContents:c}=e("../editor/composer/utilities/dropdown_contents");const{displayableInListBtypes:u}=e("../lang/btypes_dropdowns");function d(e,t){return e&&(e instanceof c&&e.find((e=>e.value===t))!=null||!(e instanceof c)&&e.contains(t))}function p(e){if(e.is_list()){return e.inner()}else{return e}}r.is_responsive_v1_or_higher=function(e){var t;return((t=e.root())==null?void 0:t.get_responsive_version())>0};r.is_responsive_v0=function(e){return!r.is_responsive_v1_or_higher(e)};function _(e,t,n,r){let i;if(t&&t.id()!=="null"&&t.display()){i="is "+t.display().toLowerCase()}else{i="is not set"}const s=e[0].toUpperCase()+e.slice(1);let o;if((t==null?void 0:t.display().toLowerCase())===r.display().toLowerCase()){o="another "+r.display().toLowerCase()}else{o="type "+r.display().toLowerCase()}const a=`${s} ${i}. The data you're ${n} now is ${o}.`;const l=`Click to change ${e} to ${o}`;return{message:a,button_caption:l}}r.get_element_parent_type=function(e){var t,n,r,s,o,a,l;const c=(t=(n=e.parent)==null?void 0:(r=n.call(e))==null?void 0:r.get_static_property("group_type"))!=null?t:(s=e.root)==null?void 0:(o=s.call(e))==null?void 0:o.get_static_property("page_item_type");if(!((a=(l=i.get(c)).custom_type)!=null&&a.call(l))){return null}return c};r.no_need_to_show_message_container_elements=function(e,t){var n;(n=t)!=null?n:t="data_source";const r=p(e.property(t).get_eval_value());if(r.id().indexOf("struct.")===0){return true}};r.set_group_type_list_elements=function(e,t,n){if(e){const r=p(t.get_eval_value());if(r){e.set_property(n,r.id());return e.commit()}}};r.get_generate_message_list_elements=function(e,t,n,r,s){if(e){var a;let l;const c=e.get_static_property(n);if(c!=null){l=i.get(o.list_type(c))}else{l=i.get("null")}const u=t.get_eval_value();if(u&&u.id()!=="null"&&u.is_list()&&!u.matches((a=l)==null?void 0:a.id())){if(d(e._field_data(n).set,u.inner().id())){return _(r,l.inner(),s,u.inner())}}}};r.get_binding_properties=function(e,t,n){var o;let a,l,c,u,d;(o=n)!=null?o:n="InputContent";if(r.get_element_parent_type(e)==null){a="The parent element and the page have no type of content or it is not modifiable. Click here to edit it."}else{d=r.get_element_parent_type(e);const n=e.get_static_property("bind_field");if(d){var p,_;l=(p=(_=i.get(d)).custom_type)==null?void 0:p.call(_);if(l&&t){u=s().sets.get_set("Filtered")(s().sets.get_set("CustomFields")({btype_name:d,writeable:true}),(e=>t.includes(l.field(e.value).value())))}else{u=s().sets.get_set("CustomFields")({btype_name:d,writeable:true})}c=r.get_privacy_warning_caption(d,n)}}return[{name:"auto_binding",caption:"Enable auto-binding on parent element's thing",editor:"Checkbox",pretty:{short_caption:false,section:n}},{name:"information",label_text:a,click_cb(){let t;const n=e.parent();if(n.E.field_names.group_type){t=n.id()}else{t=e.root().id()}s().visual_edit.current_editor_canvas.select(t,"overwrite");return s().visual_edit.currently_editing(t)},editor:"Label",condition(e){return e.get_static_property("auto_binding")&&a!=null},pretty:{short_caption:false,section:n},include_in_redesign:false},{name:"information_data",label_text:a,click_cb(){let t;const n=e.parent();if(n.E.field_names.group_type){t=n.id()}else{t=e.root().id()}s().visual_edit.current_editor_canvas.select(t,"overwrite");return s().visual_edit.currently_editing(t)},editor:"Label",condition(e){return e.get_static_property("auto_binding")&&a!=null},pretty:{short_caption:false,section:n},include_in_redesign:true},{name:"bind_field",caption:"Field to modify",editor:"Dropdown",set:u,condition(e){return e.get_static_property("auto_binding")&&d!=null},pretty:{short_caption:false,section:n}},{name:"information",label_text:c,editor:"Label",condition(e){return e.get_static_property("auto_binding")&&c!=null},click_cb(){return l.privacy_role("everyone").find_in_editor()},pretty:{short_caption:false,section:n}},{name:"show_alert_on_sucess",caption:"Show an alert on success",editor:"Checkbox",condition(e){return e.get_static_property("auto_binding")&&d!=null},pretty:{short_caption:false,section:n}},{name:"alert_element",caption:"Alert to show",editor:"Dropdown",condition(e){return e.get_static_property("auto_binding")&&d!=null&&e.get_static_property("show_alert_on_sucess")},set:s().sets.get_set("PageElementsByType")(e,["Alert"]),pretty:{short_caption:false,section:n}},{name:"alert_message",caption:"Alert message",editor:"ShortText",condition(e){return e.get_static_property("auto_binding")&&d!=null&&e.get_static_property("show_alert_on_sucess")},pretty:{short_caption:false,section:n}}]};r.get_privacy_warning_caption=function(e,t){var n,r,s;const o=(n=(r=i.get(e)).custom_type)==null?void 0:n.call(r);if(t&&o!=null&&(s=o.field(t))!=null&&s.exists()){const e=o.privacy_roles();let n=false;for(const r of e){const e=r.get_permissions();if(e!=null&&e.auto_binding){for(const r in e.binding_fields){const i=e.binding_fields[r];if(i===t){n=true;break}}}}if(!n){return"You want this input to modify a thing of type "+o.display()+" and the field "+o.field(t).display()+", but there are no privacy rules that let any users do this. Click here to get to the Privacy section of the Data tab."}}};r.get_generate_message_group_elements=function(e,t,n){if(e){var r;const s=t.get_eval_value();const o=(r=e.get_static_property("group_type"))!=null?r:"null";const a=i.get(o);if(s&&s.id()!=="null"&&!s.is_list()&&i.compound(s)&&!s.matches(a.id())){if(d(e._field_data("group_type").set,s.id())){return _(e.get_name()+"'s content type",a,n,s)}}else if(s.is_list()&&(s==null?void 0:s.inner().id())===o){return{message:"The data you're displaying is a list of "+a.display()+"s, while it should be a single "+a.display()+".",button_caption:"Click to use the first item of this list"}}}};r.set_group_type_group_elements=function(e,t,n){if(e){var r;const s=p(n.get_eval_value());const o=(r=e.get_static_property("group_type"))!=null?r:"null";const a=i.get(o);if(s&&s.id()!=="null"&&!s.is_list()&&i.compound(s)&&!s.matches(a.id())){e.set_property("group_type",s.id());return e.commit()}else if(n.get_eval_value().is_list()&&n.get_eval_value().inner().id()===o){const e=t.property("data_source").raw();let n=e;while(n.next)n=n.next;n.next={name:"first_element",type:"Message"};t.set_property("data_source",e);return t.commit()}}};r.get_generate_message_page=function(e,t){if(e){const n=t.get_eval_value();const r=e.get_static_property("page_item_type");const s=i.get(r!=null?r:"null");if(n&&n.id()!=="null"&&!n.is_list()&&!n.matches(s.id())){if(d(e._field_data("page_item_type").set,n.id())){return _(e.get_name()+"'s content type",s,"sending",n)}}}};r.get_disabled_property=function(e){var t;(t=e)!=null?t:e="InputContent";return[{name:"disabled",caption:"This input is disabled",editor:"Checkbox",pretty:{short_caption:false,section:e}}]};r.get_mandatory_property=function(e){var t;(t=e)!=null?t:e="InputContent";return[{name:"mandatory",caption:"This input should not be empty",editor:"Checkbox",pretty:{short_caption:false,section:e}}]};r.additional_fields_for_text_inputs=function(e){var t;(t=e)!=null?t:e="InputContent";return r.get_mandatory_property(e).concat(r.get_disabled_property(e))};r.get_max_file_size_property=()=>[{name:"max_size",caption:"Max file size (MB)",editor:"Basic",value:"number",pretty:{short_caption:false,section:"InputContent"}}];r.get_file_upload_condition_property=()=>[{name:"file_upload_condition",caption:"File uploads enabled",editor:"Basic",value:"sys.bool",pretty:{short_caption:false,section:"InputContent"}}];r.container_fields=function(e){const t=e.get_static_property("group_type");let n;if(l.has_feature_enabled("reorg_component_selection")){n=u()}else{n=s().sets.get_set("DisplayableInListValues")(true)}return[{name:"group_type",caption:"Type of content",editor:"Dropdown",optional:true,set:n,pretty:{short_caption:false,section:"GroupType"}},{name:"data_source",caption:"Data source",editor:"Basic",value:t!=null?t:"null",value_setter:{property_modifier(t){return r.set_group_type_group_elements(e,e,t)},no_need_to_show_message(){return r.no_need_to_show_message_container_elements(e)},generate_message(t){return r.get_generate_message_group_elements(e,t,"setting")}},optional:true,pretty:{short_caption:false,section:"GroupType"}}]};r.add_parameters_to_link=e=>[{name:"keep_current_page_params",caption:"Send current page parameters",editor:"Checkbox",condition:e==="link"?"linktype is pagelink":undefined,pretty:e==="link"?{section:"LinkBehavior"}:undefined},{name:"add_parameters",condition:e==="link"?"linktype is pagelink":undefined,caption:"Send more parameters to the page",editor:"Checkbox",pretty:e==="link"?{section:"LinkBehavior"}:undefined},{name:"url_parameters",editor:"ObjectList",condition:e==="link"?["add_parameters","linktype is pagelink"]:"add_parameters",button_caption:"Add another parameter",has_rows:true,do_not_scroll_to_down:e==="link"?true:undefined,pretty:e==="link"?{section:"LinkBehavior"}:undefined,sub_properties(){return[{name:"key",caption:"Key",editor:"StaticText",include_in_redesign:false},{name:"value",caption:"=",condition:"key",editor:"ShortText",include_in_redesign:false},{name:"key",caption:"Key",editor:"StaticText",include_in_redesign:true,pretty:{row_id:1,class_name:"grouped-properties-span url-parameters-key"}},{name:"value",caption:"=",condition:"key",editor:"ShortText",include_in_redesign:true,pretty:{row_id:1,class_name:"grouped-properties-span url-parameters-value"}}]}}];r.group_element_fields=e=>[{name:"collapse_animation",caption:"Animate the collapse operation",editor:"Checkbox",condition(){return e.get_static_property("collapse_when_hidden")},pretty:{short_caption:false,section:"Position"}},{name:"animation_type",caption:"Animation style",editor:"Dropdown",set:s().sets.get_set("Object")(r.is_responsive_v1_or_higher(e)?{slide:"Slide Up/Down",slide_horiz:"Slide Left/Right",fade:"Fade In/Out"}:{slide:"Slide Up/Down",fade:"Fade In/Out"}),condition(){return e.get_static_property("collapse_animation")&&e.get_static_property("collapse_when_hidden")},pretty:{short_caption:false,section:"Position"}},{name:"overflow_scroll",caption:"Allow vertical scrolling when content overflows",editor:"Checkbox",condition(e){return r.is_responsive_v1_or_higher(e)&&e.get_static_property("container_layout")!=="fixed"&&(e.type()==="Group"||e.type()==="CustomElement")},pretty:{section:"Responsive"}}]},{"../editor/composer/utilities/dropdown_contents":556,"../lang/appquery":651,"../lang/btype_ids":652,"../lang/btypes":653,"../lang/btypes_dropdowns":654,"../lib":741,"../safe_require":777,"core-js/modules/web.dom-collections.iterator.js":1123}],415:[function(e,t,n){"use strict";const r=e("./../u");const i=e("./../safe_require");const s=e("./../lang/appquery");const o=n;i.safe_register("./core/status_bar",o);let a=0;const l=e("../../vendor/jquery_plugins/nprogress.js");l.configure({showSpinner:false});let c=null;o.no_status_bar=r.MakeSwitch(null,"no_status_bar");o.no_status_bar.turn_on();o.show_progress_line=function(e){if(e==null){throw new r.UnexpectedError("must pass in what we are waiting on (a key or promise preferably)")}if(c==null){var t;c=(t=s.app().get_public_setting("status_bar_color"))!=null?t:"#29d";l.configure({showSpinner:false,template:`<div class="bar" role="bar" style="background:${c};">\n    <div class="peg" style="box-shadow:0 0 10px ${c}, 0 0 5px ${c};">\n    </div>\n</div>`})}if(a===0){o.no_status_bar.turn_off();setTimeout((()=>{if(a>0){l.start()}}),200)}a++;const n=setTimeout((()=>console.log("warning: status bar still waiting on "+e)),10*1e3);let i=false;let u=false;return e=>{if(i){return}if(e==null){i=true;a--;clearTimeout(n);if(a===0){l.done();return setTimeout((()=>o.no_status_bar.turn_on()),400)}else if(u){l.set(.5)}}else{u=true;l.set(e)}}};const u="#nprogress";o.hide_run_mode=()=>$(u).hide();o.show_run_mode=()=>$(u).show();o.bar_visible=()=>$(u).is(":visible");o.show_NProgres_edit_mode=function(e,t){if(!e.attr("id")){e.attr("id",t)}l.configure({parent:"#"+t});l.start();let n=false;return()=>{if(n){return}n=true;l.done()}};let d=false;let p=null;let _=false;o.set_general_message=e=>$(".status-notification .subtitle").text(e);o.show_general_message=function(e,t){var n;(n=t)!=null?n:t=100;if(_){return}_=true;p=setTimeout((()=>$(document).ready((()=>{if(d){$(".status-notification .subtitle").text(e);$(".status-notification").show(100)}}))),t);d=true};o.show_general_message_immediate=function(e,t){var n;(n=t)!=null?n:t=100;if(_){return}_=true;d=false;$(".status-notification .subtitle").html(e);$(".status-notification").show(t)};o.hide_general_message=function(e){_=false;clearTimeout(p);d=false;$(".status-notification").hide(100,e)};o.show_loading_animation=e=>{const t=$(`<div class="loading-animation">\n    <div class='bubble'></div>\n    <div class='pulse'></div>\n</div>`);e.append(t);return()=>t.remove()};o.show_simple_status=e=>$(document).ready((()=>{$(".simple-notification").text(e);$(".simple-notification").show(100)}));o.color_simple_status=e=>$(document).ready((()=>$(".simple-notification").css("color",e)));o.hide_simple_status=()=>$(document).ready((()=>$(".simple-notification").hide(100)));const f=[];o.spinner_key=r.MakeKeyList();let h=null;let m=null;o.spinner=function(t){var n,i,a;const l=t.get_canvas();if(!l[0]){return()=>{}}const c=o.spinner_key.make(null,"spinner_key");const u=t.element.id();if(f.includes(u)){return()=>{}}f.push(u);(n=h)!=null?n:h=e("../../vendor/jquery_plugins/spin.min.js");(i=m)!=null?i:m=(a=s.app().get_public_setting("spinner_color"))!=null?a:"black";let d=null;let p=true;const _=setTimeout((()=>{if(p){var e;const n={lines:13,length:10,width:2,radius:10,corners:1,rotate:0,direction:1,color:m,speed:1,trail:70,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:Math.min(Math.max(t.element.get_height(),l.height())/2-10,100),left:l.width()/2-25};if(((e=t.element.root())==null?void 0:e.get_responsive_version())>0){n.top=Math.min(Math.max(t.element.get_height(),l.height())/2-10,50)}d=new h(n).spin(l[0])}}),700);return()=>{var e;clearTimeout(_);p=false;(e=d)==null?void 0:e.stop();r.array_remove(f,u);c.turn()}}},{"../../vendor/jquery_plugins/nprogress.js":2354,"../../vendor/jquery_plugins/spin.min.js":2355,"./../lang/appquery":651,"./../safe_require":777,"./../u":823}],416:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("../db/values/db_values");r.get_data_to_send=function(e,t){if(!e){return e}if(i.registry.is(e,i.STATIC_NODE)){return null}if(e._id){const n=e.child("Slug").get();if(n!=null&&n!==""){return n}let i,s;if(typeof e._id==="function"){i=e._id()}else{i=e.id}if(t&&typeof e.child==="function"){s=e.child(t).get()}if(s){const e=r.make_URL_friendly_string(s);return e+"-"+i}else{return i}}else{return e}};const s=/ /g;const o=/[.,/#!$%^&*;':\\{}=_`~()<>?"@]/g;const a=/\n/g;const l=/\./g;const c=75;r.make_URL_friendly_string=function(e,t){var n;(n=t)!=null?n:t=c;const r=e.split(" ");let i=r[0];if(i.length>t){i=i.slice(0,+t+1||undefined)}else{for(const e of r.slice(1)){if(i.length+e.length>t){break}i+=" "+e}}i=i.toLowerCase().replace(s,"-").replace(o,"").replace(a,"-").replace(l,"-");return i}},{"../db/values/db_values":476,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],417:[function(e,t,n){"use strict";const r=e("../../client/analytics");const i=e("../../lang/appquery");const s=e("./SubMenu");const o=e("../../u");class a extends s{constructor(e,t,n,s,a){super();this.title=e;this.true_modal=t;this.close=n;this.canvas=o.div("modal-popup");const l=o.div("popup-content",this.canvas);if(this.close){this.close_btn=this.create_close();l.append(this.close_btn);this.close_btn.on("vclick",(()=>{if(s){r.track("Modal Action Taken",{action:"close_button",app:i.appname(),title:e})}this.hide()}))}l.append(this.create_header(a));const c=o.div("children",l);this.children_div=o.div("inner-children",c);if(!this.true_modal){this.canvas.on("vmousedown",(e=>{this.inner_mousedown=o.did_event_pass_through(e,".popup-content");return true}));this.canvas.on("vclick",(e=>{if(this.inner_mousedown||o.did_event_pass_through(e,".popup-content")||o.is_on_mobile_or_tablet()){return true}this.hide();return true}));$(document).off("keydown.escape-modal-popup");$(document).on("keydown.escape-modal-popup",(e=>{if(e.keyCode===27){this.hide()}}))}}create_header(e){const t=o.div("popup-title");t.text(this.title);if(e){t.append(this.create_subtitle(e))}return t}create_subtitle(e){const t=o.div("subhead1 margin-top-5 align-text-center");t.text(e);return t}create_close(){const e=o.div("fa fa-close btn-close");return e}show(){let e;$(document.body).append(this.canvas);if(this.canvas.height()>$(window).height()-150){e="absolute";$("body").css("overflow","visible")}else{e="fixed";$("body").css("overflow","hidden")}this.canvas.css({opacity:0,position:e});o.velocity(this.canvas,"fadeIn",{duration:300})}hide(){this.canvas.find(".btn").addClass("disabled");this.emit("hiding");o.velocity(this.canvas,"fadeOut",{duration:300,complete_cb:()=>{this.canvas.remove();$("body").css("overflow","auto");$(document).off("keydown.escape-modal-popup")}})}}t.exports=a},{"../../client/analytics":20,"../../lang/appquery":651,"../../u":823,"./SubMenu":418}],418:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./Widget");const i=e("../../u/shared/decaf");class s extends r{set_children(e){this.children_div.empty();for(const t of i.array_from(e)){this.add_child(t)}}add_child(e){this.children_div.append(e.get_canvas())}}t.exports=s},{"../../u/shared/decaf":844,"./Widget":419,"core-js/modules/web.dom-collections.iterator.js":1123}],419:[function(e,t,n){"use strict";const r=e("events");class i extends r.EventEmitter{get_canvas(){return this.canvas}}t.exports=i},{events:978}],420:[function(e,t,n){"use strict";const r=n;const i=e("./../../lib");const s=e("./../status_bar");const o=e("./../../lang/appquery");const a=e("./../../lang/context_serialization/context_serializer");const l=e("../../lang/evaluation/page_state");const c=e("./../../u");const u=e("./../../logger");const{GIBIBYTE:d}=e("../../constants/byte");r.upload_file=function(e,t,n,r,s,d,p){s==null?void 0:s();let _=false;let f=null;function h(t,n){if(_){return}if(t!=null){d==null?void 0:d(t)}else{if(n==null){r==null?void 0:r(null);return}const s=new FormData;for(const e in n.fields){const t=n.fields[e];s.append(e,t)}s.append("file",e);f=new XMLHttpRequest;f.onload=function(){if(f.status===204){r==null?void 0:r(n.file_url)}else{var e;if(f.status>=400&&f.status<=499){if(f.responseText.indexOf("EntityTooLarge")!==-1){t=new c.UserError("FILE_TOO_LARGE")}}(e=t)!=null?e:t=i().location.response_to_error(f);d==null?void 0:d(t)}};f.onerror=function(){t=i().location.response_to_error(f);d==null?void 0:d(t)};f.upload.onprogress=function(t){if(t.lengthComputable){const n=Math.min(t.loaded/e.size,1);p==null?void 0:p(n)}};f.open("POST",n.url,true);f.send(s)}}n(((n,r)=>{if(n){window.alert(u.human_friendly(n));h(null,null)}else{if(i().is_edit_mode()){c.extend(r,{appname:o.appname(),app_version:o.app_version()})}const n={element:t,inputs_must_be_valid:false,datasources:l.get_basic_datasources(t.element.root())};return a.serialize_context(n,t.element).then((t=>{c.extend(r,{timezone_string:t.timezone_string,serialized_context:t,name:e.name,size:e.size,content_type:e.type});return i().location.post("server://fileupload/geturl",r,h)}))}}));return function(){var e;_=true;return(e=f)==null?void 0:e.abort()}};r.make_presigned_uploader=function(e){let{instance:t,input:n,get_additional_data:i,cb_success:o,cb_start:a,cb_fail:l,cb_progress:p,max_file_size_fn:_}=e;let f=null;let h=null;n.change((()=>{const{files:e}=n[0];if(e.length<1)return;const m=e[0];if(m.size>2*d){u.warn("very large file upload could crash browser from new memory overhead",{size:m.size})}m.arrayBuffer().then((e=>{const n=new File([e],m.name,{type:m.type});c.run_once(30,(()=>_==null?void 0:_()),((e,u)=>{if(u&&n.size>u){const e=new c.UserError("FILE_TOO_LARGE");l==null?void 0:l(e)}else{h=s.show_progress_line("image uploader");f=r.upload_file(n,t,i,(e=>{h();o==null?void 0:o(e)}),a,(e=>{h();l==null?void 0:l(e)}),(e=>{h(e);p==null?void 0:p(e)}))}}))}))}));return function(){var e,t;(e=f)==null?void 0:e();(t=h)==null?void 0:t();h=null;f=null}}},{"../../constants/byte":52,"../../lang/evaluation/page_state":698,"./../../lang/appquery":651,"./../../lang/context_serialization/context_serializer":659,"./../../lib":741,"./../../logger":744,"./../../u":823,"./../status_bar":415}],421:[function(e,t,n){"use strict";const r=n;const i=e("./../../u");const s=e("../../logger");const o=e("./../../safe_require");const a=e("../../shared/image_processor");const l=e("../../constants/editor");const c=e("./Widget");const u=e("../../u/shared/b_file_shared");o.safe_register("./core/widgets",r);r.Widget=c;r.SubMenu=e("./SubMenu");r.ModalPopup=e("./ModalPopup");r.get_uploaded_file_id=function(e,t){let n="f"+(t!=null?t:i.UUID())+"/"+e;if(f.is_dedicated){n=f.environment_name+"/"+n}return n};r.get_uploaded_file_endpoint=function(e){let{key:t,with_protocol:n,appname:r}=e;const i=`//${u.get_file_cdn_url(r)}${t}`;return n?`https:${i}`:i};function d(e){return e(null,{})}r.upload_file=function(e,t,n,r,o,l,c,u){var f;(f=n)!=null?f:n=d;const m=p().location.get_server_base()+"fileupload";function g(d,f){var g,v;let b;o==null?void 0:o();if(p().is_edit_mode()){_.show_general_message(t)}else{b=_.show_progress_line("image uploader")}function y(){if(p().is_edit_mode()){_.hide_general_message()}else{b()}}function w(){const t={success(e){y();r(e)},error(e){var t;let n;y();if(e.status>=400&&e.status<=499){if(e.responseText.indexOf("Error parsing request body: request entity too large")!==-1){n=new i.UserError("FILE_TOO_LARGE")}}(t=n)!=null?t:n=p().location.response_to_error(e);l==null?void 0:l(n)},processData:false,type:"post"};n(((n,r)=>{if(n){window.alert(s.human_friendly(n));t.success(null)}else{var o;if(p().is_edit_mode()){i.extend(r,{appname:h.appname(),app_version:h.app_version()})}const n=i.extend(r,e);(o=n.name)!=null?o:n.name=u;t.data=JSON.stringify(n);t.contentType="application/json";$.ajax(m,t)}}))}const x=(g=u||((v=e)==null?void 0:v.name))==null?void 0:g.toLowerCase().split(".").pop();if(c&&x!=="svg"){a({file:e,image_url:d.result,extension:x,success_callback(){return w()},fail_callback(){return l==null?void 0:l()},progress_bar_hide_fn(){return y()}})}else{if(f){e={contents:f,name:u}}else{var j;e.contents=(j=d.result.split(",")[1])!=null?j:""}w()}}if(e.contents){g(undefined,e.contents)}else{const t=new FileReader;t.onload=()=>g(t);t.readAsDataURL(e)}};r.MakeImageUploader=function(e){var t,n;let{input:s,text:o,get_additional_data:a,cb_success:l,cb_start:c,cb_fail:u,limit_size:p,max_file_size_fn:_}=e;(t=o)!=null?t:o="We're uploading your image...";(n=a)!=null?n:a=d;s.change((()=>{const{files:e}=s[0];if(e.length<1){return}const t=e[0];i.run_once(30,(()=>_==null?void 0:_()),((e,n)=>{if(n&&t.size>n){const e=new i.UserError("FILE_TOO_LARGE");u==null?void 0:u(e)}else{r.upload_file(t,o,a,l,c,u,p)}}))}))};r.ImageUploader=class e extends r.Widget{get get_class(){return"image-uploader"}constructor(e){super();this.file_cb=e;this.canvas=i.input(undefined,undefined,"file");r.MakeImageUploader({input:this.canvas,get_additional_data:null,cb_success:this.file_cb,max_file_size_fn:()=>l.MAX_FILE_COMPOSER_SIZE})}};const p=e("./../../lib");const _=e("./../status_bar");const f=e("./../../client_config");const h=e("./../../lang/appquery")},{"../../constants/editor":60,"../../logger":744,"../../shared/image_processor":795,"../../u/shared/b_file_shared":837,"./../../client_config":41,"./../../lang/appquery":651,"./../../lib":741,"./../../safe_require":777,"./../../u":823,"./../status_bar":415,"./ModalPopup":417,"./SubMenu":418,"./Widget":419}],422:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.DefaultLib=void 0;var r=i(e("./LibContext"));function i(e){return e&&e.__esModule?e:{default:e}}const s=new r.default("default");n.DefaultLib=s},{"./LibContext":423}],423:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=void 0;var r=s(e("../lib"));var i=e("../lib/lib_factory");function s(e){return e&&e.__esModule?e:{default:e}}class o{constructor(e){this._libName=e}get(){return(0,i.getLibFactory)().getLib(this._libName)}with(e,t){return(0,i.getLibFactory)().libCaller({libName:this._libName,libParams:t?e:undefined,fn:t!=null?t:e,wither:r.default.with_lib})}extend(e,t){return(0,i.getLibFactory)().libCaller({libName:this._libName,libParams:t?e:undefined,fn:t!=null?t:e,extender:r.default.extend})}ensure(e,t){if((0,r.default)()){return(0,i.getLibFactory)().libCaller({libName:this._libName,libParams:t?e:undefined,fn:t!=null?t:e,extender:r.default.extend})}return(0,i.getLibFactory)().libCaller({libName:this._libName,libParams:t?e:undefined,fn:t!=null?t:e,wither:r.default.with_lib})}}n.default=o},{"../lib":741,"../lib/lib_factory":742}],424:[function(e,t,n){(function(t){(function(){"use strict";e("core-js/modules/web.immediate.js");e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../u");const i=e("../u/shared/async/async_state");const s=e("../u/shared/errors");const o=e("./../safe_require");const a=e("./db");const l=e("./plans");const c=e("./db_utils");const u=e("./obfuscate");const d=e("../constants/db");const p=e("../constants/time");const _=e("./../logger");const f=e("./../lib");const h=e("./client_firebase");const m=e("../shared/cookies");const g=n;o.safe_register("./db/client_db",g);const v=e("../client/epoch");const b=e("../constants/epoch");const y=e("./values/ClientDBNode");const w=e("./values/ClientDBObject");if(typeof window!=="undefined"&&window!==null){window.client_db=g}function x(){if(!r.cookies_enabled()){return null}return c.get_temp_db(r.readCookie("temp_db"),f().appname())}g.instance=function(e,t,n){var i,s,o,a;(i=e)!=null?i:e=f().appname();(s=t)!=null?s:t=f().app_version();(o=n)!=null?o:n=x();const l=r.smush(e,t,n);(a=j[l])!=null?a:j[l]=new C(n,e,t,true);return j[l]};g.new_instance=function(e,t,n){var r,i,s;(r=e)!=null?r:e=f().appname();(i=t)!=null?i:t=f().app_version();(s=n)!=null?s:n=x();return new C(n,e,t)};const j={};const A=r.Box();g.recheck_uid=function(e,t){var n;(n=e)!=null?n:e=function(){};f.wait_for_lib((()=>{var n,i;let s=r.readCookie(m.uid_cookie_name(f().appname(),f().app_version(),x()));if(s!=null&&s!==window.bubble_session_uid){_.info("bubble_session_uid not updated",{last_request_uri:t,new_uid:s,bubble_session_uid:window.bubble_session_uid})}(n=s)!=null?n:s=(i=window.bubble_session_uid)!=null?i:d.NO_USER;if(s!==A()){A(s);g.reauth();r.run_once(30,(()=>{const e=f().current_user();const t=T.get_user_language_field();if(t!=null){e.child(t).get()}return e.get_email()}))}e()}))};g.current_user=function(e,t,n){g.recheck_uid();return g.instance(e,t,n).get(A())};g.server_time_offset_key=r.MakeKey(null,"server_time_offset");if(typeof window!=="undefined"&&window!==null){window.server_time_offset=0;t((()=>N.get_server_time_offset((e=>{window.server_time_offset=e;g.server_time_offset_key.turn()}))))}let M=10;const E=["get","search","aggregate"];const k=["mget","msearch","maggregate"];function O(){setTimeout((()=>{M=M*5;if(M>120*1e3){M=120*1e3}const e=f().location.post("server://user/hi",{});e.then((()=>g.reauth(true)),O)}),M)}let S=0;g.reauth=e=>f.wait_for_lib((()=>{r.rebuild_cookies();if(r.is_edit_mode()&&f().user.is_cookie_opt_in()){D(e)}}));function D(e){if(!r.cookies_enabled()){return}const t=()=>h.get_token_expiration().then((e=>{const t=e.valueOf()-r.timestamp();const n=Math.max(30*p.MINUTE_MS,t-5*p.MINUTE_MS);setTimeout((()=>{console.log("firebase token about to expire, refreshing");O()}),n)}));h.reauth().then((()=>{S=0;setTimeout((()=>M=10),10*1e3);t()}),(t=>{if(e){S+=1;if(t instanceof r.UnexpectedError){_.error(t)}else{const e=typeof t==="string"?t:"failed to reauth to firebase";if(S===5){_.error(e)}else{_.warn(e)}}}}))}class C extends a.DB{constructor(e,t,n,r){super();this.temp_db=e;this.appname=t;this.app_version=n;this.can_watch=r;this._gets=[];this._searches=[];this._searches_current_count=0;this._aggregates=[];this.result_cache={};this.result_dependency_cache={};this.watch_search_status={};this.perc_ids_to_calls={};this.perc_id_update_versions={};this._notifier_client=N;this._last_run={};this._next_scheduled={};this._to_percolate=[];this._all_time_queued_fetches=0;this._prefetched_request_counts={mget:0,msearch:0,maggregate:0}}local_item_updated(e,t,n,i){var s;const o="db_latest_version_"+e;if((s=r.session_storage)!=null&&s.getItem(o)){return r.session_storage.setItem(o,String(i))}}initialize_data(e,t,n,i){this.has_session_storage=r.session_storage!=null;if(!this.has_session_storage){return}try{var s;const o="db_latest_version_"+e;const a=r.session_storage.getItem(o);if(a==="local"||parseInt(a)>i){return}r.session_storage.setItem(o,String(i));(s=this._tracking_on_page_load)!=null?s:this._tracking_on_page_load={};this._tracking_on_page_load[e]=true;this._set_data(e,t,n,i)}catch(e){console.log("error in client_db.initialize_data: "+e.stack)}}schedule_discard_errors(e){setTimeout((()=>{const t=this.init_result_cache(e);t.ranges=t.ranges.filter((e=>e.state!==d.range_states.ERROR))}),3e4)}execute_with_dependency(e,t,n){var o,a;const l=JSON.stringify(e)+"_"+t+"_"+n;(a=(o=this.result_dependency_cache)[l])!=null?a:o[l]={};if(!this.result_dependency_cache[l].current_result){var c;if(((c=i.CurrentNotReadyCatcher)==null?void 0:c.length)>0){return[]}const o=I.get_current_eval_node();const a={id:l,invalidate:()=>{var i;a.invalidated=true;if(a!==((i=this.result_dependency_cache[l])==null?void 0:i.current_result)){return}if(!a.dependency.needed()){delete this.result_dependency_cache[l];return}this.result_dependency_cache[l].old_result=this.result_dependency_cache[l].current_result;this.result_dependency_cache[l].current_result=null;this._set_immediate((()=>{r.run_once(120,(()=>{let r;try{r=I.get_current_eval_node();I.set_current_eval_node(o);this.execute_with_dependency(e,t,n)}finally{I.set_current_eval_node(r)}}))}))}};let u;const d=i.CurrentNotReadyCatcher;const p=i.CurrentAutoRun;try{i.CurrentAutoRun=a;i.CurrentNotReadyCatcher=null;u=this.execute_query(e,t,n)}catch(e){const t=e instanceof s.NotReadyError&&e.not_ready_key;if(t&&p){t.turned_dependency().register(p)}throw e}finally{i.CurrentNotReadyCatcher=d;i.CurrentAutoRun=p}if(a.invalidated){throw new r.UnexpectedError("assertion error: current_result invalidated too soon",{query:e,from:t,n:n})}let _;if(this.result_dependency_cache[l].old_result){({dependency:_}=this.result_dependency_cache[l].old_result);if(JSON.stringify(this.result_dependency_cache[l].old_result.results)!==JSON.stringify(u)){_.invalidate()}this.result_dependency_cache[l].old_result=null}else{_=r.Dependency()}a.dependency=_;a.results=u;this.result_dependency_cache[l].current_result=a}this.result_dependency_cache[l].current_result.dependency.register();return this.result_dependency_cache[l].current_result.results}register_call_dependency(e){var t,n;if(!this.can_watch){return}const i=this.get_cache_key(e);(n=(t=this.result_cache[i]).dependency)!=null?n:t.dependency=r.Dependency();this.result_cache[i].dependency.register();this.ensure_watching_plan(e)}invalidate_call_dependency(e){var t,n;(t=this.result_cache[e])==null?void 0:(n=t.dependency)==null?void 0:n.invalidate()}add_plan_to_watch_search(e){var t,n;const r=l[e.t].watch_search_call(e);if(!r){return}const i=JSON.stringify(r);const s=this.get_cache_key(e);(n=(t=this.watch_search_status)[i])!=null?n:t[i]={plans:{},search_path:this.build_search_path(e,"watch")};this.watch_search_status[i].plans[s]=true}ensure_watching_plan(e){if(!this.can_watch){return}this.add_plan_to_watch_search(e);const t=l[e.t].watch_search_call(e);if(!t){return}const n=JSON.stringify(t);if(!this.watch_search_status[n].scheduled){this.watch_search_status[n].scheduled=true;this.do_percolate(t)}}schedule_percolator(e,t){const n=JSON.stringify(e);this.watch_search_status[n].scheduled=true;let r=t-Date.now()+20+Math.round(2e4*Math.random());r=Math.min(r,7*24*60*60*1e3);this._set_timeout((()=>{if(this.percolate_still_needed(e)){this.do_percolate(e)}else{this.watch_search_status[n].scheduled=false}}),r)}percolate_still_needed(e){const t=JSON.stringify(e);let n=false;const r={};for(const e in this.watch_search_status[t].plans){var i,s;if((i=this.result_cache[e])!=null&&(s=i.dependency)!=null&&s.needed()){n=true;r[e]=true}else{this.invalidate_plan(e)}}this.watch_search_status[t].plans=r;return n}set_perc_ids(e,t){let{search_ids:n,expires:r}=t;const i=n;if(i==null){return}if(!this.can_watch){return}const s=JSON.stringify(e);this.schedule_percolator(e,r);for(const t of i){var o;const n=this.watch_search_status[s];(o=n.perc_ids)!=null?o:n.perc_ids=[];if(n.perc_ids.includes(t)){continue}n.perc_ids.push(t);if(!this.perc_ids_to_calls[t]){this.perc_ids_to_calls[t]=[];this._notifier_client.watch([P.SearchNotificationTopic,t],this.get_perc_id_version.bind(this,t),this.handle_perc_updates.bind(this,t))}this.perc_ids_to_calls[t].push(e)}}get_perc_id_version(e){var t;if(this.perc_id_update_versions[e]){return this.perc_id_update_versions[e]}let n;for(const t of this.perc_ids_to_calls[e]){const e=JSON.stringify(t);for(const t in this.watch_search_status[e].plans){const e=this.get_plan_version(t);if(e!=null&&(n==null||e<n)){n=e}}}return(t=n)!=null?t:0}handle_perc_updates(e,t){let{version:n,message:r}=t;if(n!=null){this.perc_id_update_versions[e]=n}if(r&&this.is_watching(r)){return}for(const t of this.perc_ids_to_calls[e]){this.notify_maybe_invalid(t)}}notify_maybe_invalid(e,t){f().workflow.wait_for_server((()=>{const n=JSON.stringify(e);if(this._next_scheduled[n]){return}const r=this.query_planner().get_stats(e.type,e.constraints);let i;if(t){if((r==null?void 0:r.length)!=null){if(r.length<50){i=500}else if(r.length<1e3){i=2e3}else{i=1e4}}else if(e.is_group_by){i=1e4}else{i=2e3}}else if((r==null?void 0:r.length)!=null){if(r.length<10){i=2e3}else if(r.length<50){i=5e3}else if(r.length<1e3){i=1e4}else{i=3e4}}else if(e.is_group_by){i=3e4}else{i=1e4}const s=()=>this._last_run[n]&&this._last_run[n]>Date.now()-i&&!this.percolator_rate_limit_disabled;if(s()){this._next_scheduled[n]=true;this._set_timeout((()=>{f().workflow.wait_for_server((()=>{this._next_scheduled[n]=false;this._last_run[n]=Date.now();this.invalidate_plans(n)}))}),this._last_run[n]+i-Date.now())}else{this._last_run[n]=Date.now();this.invalidate_plans(n)}}))}_set_timeout(e,t){return setTimeout(e,t)}_set_immediate(e){return t(e)}wait_for_plan_loading(e,t){const n=this.result_cache[e];const i=[];for(const e of(s=n==null?void 0:n.ranges)!=null?s:[]){var s;if(e.state===d.range_states.LOADING){i.push(e.loading_key)}}if(i.length>0){r.WaitFor(i,(()=>{this._set_timeout((()=>{r.wait_for_updates(this.wait_for_plan_loading.bind(this,e,t))}),5)}))}else{return t()}}invalidate_plans(e){if(!this.watch_search_status[e]){return}for(const t in this.watch_search_status[e].plans){this.wait_for_plan_loading(t,(()=>{this.invalidate_plan(t)}))}}do_percolate(e){this._to_percolate.push(e);if(!this._watch_percolate_scheduled){this._watch_percolate_scheduled=true;this._set_timeout(this.bulk_watch.bind(this),200)}}bulk_watch(){this._watch_percolate_scheduled=false;const e=this._to_percolate;this._to_percolate=[];const t=e=>{var t,n;const r=JSON.stringify(e);const{type:i,constraints:s}=e;const{search_path:o}=this.watch_search_status[r];(n=(t=this.watch_search_status[r]).ttl_start)!=null?n:t.ttl_start=Date.now();let a=Date.now()-this.watch_search_status[r].ttl_start;a=Math.min(7*24*60*60*1e3,Math.max(a,10*60*1e3));return{type:i,constraints:s,search_path:o,ttl:a}};const n=e.map(t);this.elasticsearch("bulk_watch",{appname:this.appname,app_version:this.app_version,temp_db:this.cur_temp_db(),searches:n},((t,n)=>{if(t){_.log(t)}else{for(const[t,r]of e.entries()){this.set_perc_ids(r,n[t])}}}))}get_appname(){return this.appname}get_app_version(){return this.app_version}get_temp_db(){return c.get_temp_db(this.temp_db,this.appname)}elasticsearch(e,t,n){if(E.includes(e)){this._all_time_queued_fetches++}if(e==="get"&&!t.clear_cache){this._schedule_multi_get();this._gets.push({id:t.id,cb:n});return}if(e==="search"&&t.n<40){this._searches.push({data:t,cb:n});this._searches_current_count+=t.n;this._schedule_multi_search();return}if(e==="aggregate"){this._aggregates.push({data:t,cb:n});this._schedule_multi_aggregate();return}const i=u.encode_data(t,f().appname());const s=r.extend({},b.SPANS.data_retrieval);s.name=`${s.name} - ${e}`;const o=v.startSpan(s.name,s.type,s.sync);function a(r,s){if((r==null?void 0:r.message)==="bad request from client"){_.info("report invalid params",{data:t,encoded:i,cmd:e,err:r})}v.endSpan(o);return n(r,s)}if(this._is_prefetching&&k.includes(e)){this._prefetched_request_counts[e]++}f().location.post("server://elasticsearch/"+e,i,a)}_schedule_multi_get(){if(this._multi_get_scheduled){return}this._multi_get_scheduled=true;if(!this._multi_get_switch){this._multi_get_switch=r.MakeSwitch(null,"multi get switch");this._multi_get_switch.turn_on()}r.WaitFor(this._multi_get_switch,(()=>{setTimeout((()=>this._do_multi_get(10)))}))}_do_multi_get(){this._multi_get_scheduled=false;if(this._gets.length===0){return}const e=this.GET_BATCH_SIZE;const t=this._gets.slice(0,e);this._gets=this._gets.slice(e);this._multi_get_switch.turn_off();if(this._gets.length>0){this._schedule_multi_get()}const n=t.map((e=>{let{id:t}=e;return t}));const i={appname:this.appname,app_version:this.app_version,temp_db:this.cur_temp_db(),ids:n};return this.elasticsearch("mget",i,((e,n)=>{var s;if(!e&&((s=n.docs)==null?void 0:s.length)!==t.length){e=new r.UnexpectedError("bad response from mget",{params:i,res:n})}if(e){for(const{cb:n}of t){n(e)}}else{const e=[];for(const[r,i]of n.docs.entries()){if(i!=null){t[r].cb(null,i)}else{e.push(t[r])}}this._gets=e.concat(this._gets);this._schedule_multi_get()}this._multi_get_switch.turn_on()}))}_schedule_multi_search(){if(this._multi_search_scheduled){if(this._searches.length>30||this._searches_current_count>200){clearTimeout(this._multi_search_timeout);this._do_multi_search()}return}this._multi_search_scheduled=true;this._multi_search_timeout=setTimeout(this._do_multi_search.bind(this),10)}_schedule_multi_aggregate(){if(this._multi_aggregate_scheduled){if(this._aggregates.length>20){clearTimeout(this._multi_aggregate_timeout);this._do_multi_aggregate()}return}this._multi_aggregate_scheduled=true;this._multi_aggregate_timeout=setTimeout(this._do_multi_aggregate.bind(this),10)}get_prefetched_request_counts(){return this._prefetched_request_counts}get_all_time_queued_fetches(){return this._all_time_queued_fetches}prefetch_queued_fetches(){this._is_prefetching=true;if(this._multi_get_scheduled){this._do_multi_get()}if(this._multi_search_scheduled){clearTimeout(this._multi_search_timeout);this._do_multi_search()}if(this._multi_aggregate_scheduled){clearTimeout(this._multi_aggregate_timeout);this._do_multi_aggregate()}this._is_prefetching=false}_do_multi_search(){this._multi_search_scheduled=false;const e=this._searches;this._searches=[];this._searches_current_count=0;const t=e.map((e=>{let{data:t}=e;return t}));const n={appname:this.appname,app_version:this.app_version,temp_db:this.cur_temp_db(),searches:t};this.elasticsearch("msearch",n,((t,i)=>{var s;if(!t&&((s=i.responses)==null?void 0:s.length)!==e.length){t=new r.UnexpectedError("bad response from msearch",{res:i,params:n})}if(t){for(const{cb:n}of e){n(t)}}else{for(const[t,n]of i.responses.entries()){e[t].cb(null,n)}}}))}_do_multi_aggregate(){this._multi_aggregate_scheduled=false;const e=this._aggregates;this._aggregates=[];const t=e.map((e=>{let{data:t}=e;return t}));const n={appname:this.appname,app_version:this.app_version,temp_db:this.cur_temp_db(),aggregates:t};this.elasticsearch("maggregate",n,((t,i)=>{if(!t&&i.responses.length!==e.length){t=new r.UnexpectedError("bad response from maggregate",{res:i,params:n})}if(t){for(const{cb:n}of e){n(t)}}else{for(const[t,n]of i.responses.entries()){e[t].cb(null,n)}}}))}}(()=>{C.prototype.DBNODE=y;C.prototype.DBOBJECT=w;C.prototype.GET_BATCH_SIZE=200})();const T=e("./../languages");const N=e("../notifier/client");const P=e("../constants/notifier_topics");const I=e("../lang/evaluation/eval_node_state")}).call(this)}).call(this,e("timers").setImmediate)},{"../client/epoch":25,"../constants/db":58,"../constants/epoch":63,"../constants/notifier_topics":76,"../constants/time":92,"../lang/evaluation/eval_node_state":694,"../notifier/client":747,"../shared/cookies":790,"../u/shared/async/async_state":829,"../u/shared/errors":846,"./../languages":739,"./../lib":741,"./../logger":744,"./../safe_require":777,"./../u":823,"./client_firebase":425,"./db":427,"./db_utils":428,"./obfuscate":430,"./plans":457,"./values/ClientDBNode":462,"./values/ClientDBObject":463,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,timers:2334}],425:[function(e,t,n){"use strict";const r=n;const i=e("../u");const s=e("./../lib");const o=e("../client_config");const a=e("../shared/cookies");const l="firebase_workflow";if(typeof window!=="undefined"&&window.firebase!=null){window.firebase.initializeApp(o.firebase_app_config)}const c={};c.firebase_workflow=i.MakeSwitch(null,"firebase_workflow ready key");r.get_firebase=function(){const e=i.Promise(null,"get workflow firebase");i.WaitFor(c.firebase_workflow,(()=>{e.resolve(window.firebase.database().ref())}));return e};r.get_token_expiration=()=>window.firebase.auth().currentUser.getIdTokenResult().then((e=>Date.parse(e.expirationTime)));const u={};r.reauth=function(){const e=i.Promise(null,"reauthing to firebase");if(!i.cookies_enabled()){e.reject("cookies disabled");return e}const t=a.firebase_cookie_name(s().appname(),l);const n=i.readCookie(t);if(typeof n!=="string"){const r=new i.ExpectedError("Reauthed to firebase but cookie did not contain a valid token",{cookie_name:t,token:n,cookieEnabled:navigator.cookieEnabled,dck:document.cookie});e.reject(r)}else if(n!==u[l]){u[l]=n;window.firebase.auth().signInWithCustomToken(n).then((()=>{console.log("authorized successfully for "+l);c[l].turn_on();e.resolve()})).catch((t=>{e.reject(t)}))}else{e.resolve()}return e}},{"../client_config":41,"../shared/cookies":790,"../u":823,"./../lib":741}],426:[function(e,t,n){"use strict";e("core-js/modules/es.error.cause.js");e("core-js/modules/web.dom-collections.iterator.js");const r=e("lodash/keyBy");const i=e("lodash/mapValues");const s=e("memoizee");const o=e("../u/shared/errors");const a=e("../u/shared/b_object");const l=e("../geolocation/shared/b_location_utils");const c=e("../geolocation/b_location");const{isArrayLike:u}=e("../u/shared/b_array");const d=n;class p{constructor(e){let{name:t,fn:n,value_type:r}=e;this.name=t;this.fn=n;this.value_type=r;if(!["none","simple","array","geographic_address"].includes(this.value_type)){throw new Error}}takes_no_value(){return this.value_type==="none"}takes_array_value(){return this.value_type==="array"}process_array_value(e){if(Array.isArray(e)){return e}else if((e==null?void 0:e.all)!=null){var t;return(t=e.all())!=null?t:[]}else if(e&&u(e)){const t=Object.values(e);if(t.length===0){return[]}return t}else{return[]}}resolve_constraint(e){let{entry:t,null_not_dropped:n}=e;if(n){t=this.heed_empty_constraint(t);if(!t){return}}if(t.constraint_type==="return_empty_set"){return t}const r=d.get(t.constraint_type);return r.ignore_empty_constraint(t)}heed_empty_constraint(e){const t=a.extend({},e);if(this.takes_array_value()){const n=this.process_array_value(e.value);if(!n.length){if(this.name==="not in"){return}t.constraint_type="return_empty_set"}}else if([null,""].includes(t.value)){if(this.name==="equals"){t.constraint_type="is_empty"}if(!this.takes_no_value()){t.constraint_type="return_empty_set"}}if(this.name==="geographic_search"&&!t.value.origin_address){t.constraint_type="return_empty_set"}return t}ignore_empty_constraint(e){if(this.takes_array_value()){const t=this.process_array_value(e.value);if(t.length){return a.extend({},e,{value:t})}}else if(this.takes_no_value()){return{key:e.key,constraint_type:e.constraint_type,self:e.self}}else if(this.name!=="geographic_search"&&e.value!=null&&e.value!==""){return e}else if(this.name==="geographic_search"&&e.value.origin_address!=null&&e.value.origin_address!==""){e.value.origin_address=c.from_address(e.value.origin_address);return e}return null}}d.numberify=function(e){if(String(parseFloat(e))===e){return parseFloat(e)}else{return e}};function _(e,t){if(e===false&&t==null){return true}return d.numberify(e)===d.numberify(t)}function f(e,t){const n=t!=null?t:"";const r=e!=null?e:null;return n.indexOf(r)!==-1}function h(e,t){var n,r;const i=(n=e==null?void 0:e.toLowerCase().split(/\s+/))!=null?n:["WILL_NEVER_FIND_THIS"];const s=((r=t==null?void 0:t.toLowerCase())!=null?r:"").split(/\s+/);for(const e of i){if(!s.includes(e)){return false}}return true}function m(e){if(e[0]>e[1]){return[e[1],e[0]]}else{return e}}d.all=s((()=>{const e={email_equals:{value_type:"simple"},email_contains_string:{value_type:"simple"},equals:{value_type:"simple",fn:_},"not equal":{value_type:"simple",fn(e,t){return!_(e,t)}},is_empty:{value_type:"none",fn(e,t){return t==null||t===""}},is_not_empty:{value_type:"none",fn(e,t){return t!=null&&t!==""}},in:{value_type:"array",fn(e,t){return(e!=null?e:[]).some((e=>_(e,t)))}},"not in":{value_type:"array",fn(e,t){return!(e!=null?e:[]).some((e=>_(e,t)))}},contains:{value_type:"simple",fn(e,t){var n;return((n=t==null?void 0:t.indexOf(e))!=null?n:-1)!==-1}},"not contains":{value_type:"simple",fn(e,t){var n;return((n=t==null?void 0:t.indexOf(e))!=null?n:-1)===-1}},empty:{value_type:"none",fn(e,t){return!t||t.length===0}},"not empty":{value_type:"none",fn(e,t){return(t==null?void 0:t.length)>0}},"greater than":{value_type:"simple",fn(e,t){return t!=null&&d.numberify(t)>d.numberify(e)}},gte:{value_type:"simple",fn(e,t){return t!=null&&d.numberify(t)>=d.numberify(e)}},"less than":{value_type:"simple",fn(e,t){return t!=null&&d.numberify(t)<d.numberify(e)}},lte:{value_type:"simple",fn(e,t){return t!=null&&d.numberify(t)<=d.numberify(e)}},"not true":{value_type:"none",fn(e,t){return[false,null,undefined].includes(t)}},"text contains string":{value_type:"simple",fn:f},"not text contains string":{value_type:"simple",fn(e,t){return!f(e,t)}},"text contains":{value_type:"simple",fn:h},"not text contains":{value_type:"simple",fn(e,t){return!h(e,t)}},geographic_search:{value_type:"geographic_address",fn(e,t){let{range:n,unit:r,origin_address:i}=e;if(!t||!i){return false}const s={lat:i.lat,lng:i.lng};const o={lat:t.lat,lng:t.lng};const a=l.geographic_distance(o,s,r);return a<=n}},contains_all_fields:{value_type:"simple",fn(e,t){var n,r,i;const s=(n=t==null?void 0:t.toLowerCase().split(" "))!=null?n:[];const o=(r=(i=e)==null?void 0:i.toLowerCase().split(" "))!=null?r:["WILL_NEVER_FIND_THIS"];for(e of o){let t=false;for(const n of s){if(n.indexOf(e)!==-1){t=true;break}}if(!t){return false}}return true}},prefix_search:{value_type:"simple",fn(e,t){var n;const r=(n=t==null?void 0:t.toLowerCase().split(" "))!=null?n:[];for(const t of r){if(t.indexOf(e)===0){return true}}return false}},match_phrase_prefix:{value_type:"simple",fn(e,t){var n;const r=(n=t==null?void 0:t.toLowerCase().split(" "))!=null?n:[];for(const t of r){if(t.indexOf(e)===0){return true}}return false}},range_contains:{value_type:"array",fn(e,t){var n,r;if(((n=t)==null?void 0:n[0])==null||((r=e)==null?void 0:r[0])==null){return false}e=m(e);t=m(t);return t[0]<=e[0]&&t[1]>=e[1]}},range_contains_point:{value_type:"simple",fn(e,t){var n;if(((n=t)==null?void 0:n[0])==null||e==null){return false}t=m(t);return t[0]<=e&&t[1]>=e}},range_contained_by:{value_type:"array",fn(e,t){var n,r;if(((n=t)==null?void 0:n[0])==null||((r=e)==null?void 0:r[0])==null){return false}e=m(e);t=m(t);return e[0]<=t[0]&&e[1]>=t[1]}},range_overlaps:{value_type:"array",fn(e,t){var n,r;if(((n=t)==null?void 0:n[0])==null||((r=e)==null?void 0:r[0])==null){return false}e=m(e);t=m(t);return t[0]<=e[1]&&t[1]>=e[0]}},range_greater_than:{value_type:"array",fn(e,t){var n,r;if(((n=t)==null?void 0:n[0])==null||((r=e)==null?void 0:r[0])==null){return false}e=m(e);t=m(t);return t[0]>e[1]}},range_less_than:{value_type:"array",fn(e,t){var n,r;if(((n=t)==null?void 0:n[0])==null||((r=e)==null?void 0:r[0])==null){return false}e=m(e);t=m(t);return t[1]<e[0]}},range_greater_than_point:{value_type:"simple",fn(e,t){var n;if(((n=t)==null?void 0:n[0])==null||e==null){return false}t=m(t);return t[0]>e}},range_less_than_point:{value_type:"simple",fn(e,t){var n;if(((n=t)==null?void 0:n[0])==null||e==null){return false}t=m(t);return t[1]<e}}};return Object.keys(e).map((t=>new p(a.extend({name:t},e[t]))))}));d.by_name=s((()=>r(d.all(),(e=>e.name))));d.get=e=>{const t=d.by_name()[e];if(!t)throw new o.UnexpectedError("missing constraint_def",{name:e});return t};d.all_search_constraints=i(d.by_name(),(e=>e.fn))},{"../geolocation/b_location":621,"../geolocation/shared/b_location_utils":626,"../u/shared/b_array":835,"../u/shared/b_object":839,"../u/shared/errors":846,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/keyBy":1328,"lodash/mapValues":1331,memoizee:2252}],427:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("../u");const s=e("../u/shared/async/b_fiber");const o=e("../u/shared/async/async_state");const a=e("../u/shared/mode_check");const l=e("../safe_require");const c=e("../logger");l.safe_register("./db/db",r);const u=e("../constants/db");const d=e("../constants/locations");const p=e("../constants/eval");const _=e("../lang/evaluation/eval_node_state");const f=e("../constants/special_keys");const h=e("./db_utils");const m=e("../constants/notifier_topics");r.Dynamic=e("./values/Dynamic");r.StaticNode=e("./values/StaticNode");r.StaticObject=e("./values/StaticObject");r.ListWrapper=e("./values/ListWrapper");r.NodeBase=e("./values/NodeBase");r.StaticList=e("./values/StaticList");r.TransformList=e("./values/TransformList");r.ConcatList=e("./values/ConcatList");r.IntersectList=e("./values/IntersectList");r.UniqueList=e("./values/UniqueList");r.SortedList=e("./values/SortedList");r.NodeList=e("./values/NodeList");r.OuterStringified={rehydrate(e,t){return I.rehydrate_tree(e,i.incremental_json_parse(t))}};function g(e,t){if(a.on_server()&&s.Fiber.current==null){s.SyncRun(e,t,true)}else{t()}}const v={NOTIFIER:"NOTIFIER",EXTERNAL:"EXTERNAL"};class b{constructor(e,t){this.db=undefined;this.id=undefined;this.raw=undefined;this.type=undefined;this.version=undefined;this.latest_version=undefined;this.latest_version_source=undefined;this.db=e;this.id=t;this.ready_key=i.MakeKey(null,"initial data for "+this.id);this.dependency=i.Dependency();this._old_keys=[]}is_watching(){return this._watching}flush(e){if(this.ready_key){this._old_keys.push(this.ready_key)}this.ready_key=i.MakeKey(null,"reloading item after stale");this.flushed_raw=this.raw;delete this.raw;delete this.version;if(!e){return this.dependency.invalidate()}}mark_ready(){this.ready_key.turn();for(const e of this._old_keys){e.turn()}this._old_keys=[]}watch(){if(a.on_server()){return}if(!this.db.can_watch){return}if(this._watching){return}this._watching=true;const e=`${this.db.appname}_${P.get_db_version(this.db.app_version)}${this.db.temp_db?"_"+this.db.temp_db:""}`;T.watch([m.NotificationTopic,e,this.id],(()=>{var e,t;return(e=(t=this.latest_version)!=null?t:this.version)!=null?e:0}),(e=>{let{stale:t,version:n,message:r}=e;if(t){this.flush()}else if(n!=null){this.set_latest_version(n,v.NOTIFIER)}}))}poll(e,t){if(t>0){setTimeout((()=>{this.db._reload(this.id);this.poll(e,t-1)}),e)}}set_latest_version(e,t){var n,r;(n=e)!=null?n:e=0;(r=this.latest_version)!=null?r:this.latest_version=0;if(e>this.latest_version){var i;this.latest_version=e;this.latest_version_source=t;if(this.latest_version>((i=this.version)!=null?i:0)){this.db._wait_for_process_updates(this.id,this.latest_version,(()=>{this.db._reload(this.id)}))}}}dump(){const{raw:e,type:t,version:n}=this;const r=this.ready_key.is_turned();return JSON.stringify({raw:e,type:t,version:n,ready:r},null,4)}}r.global_data_items_loaded=0;let y=false;const w={t:"Static",value_id:"sys.bool",data:[false]};const x={t:"Static",value_id:"sys.bool",data:[true]};r.get_admin_user_id=function(e){if(e==null){const t=S();e={appname:t.appname(),app_version:t.app_version(),temp_db:t.temp_db()}}const t=P.get_db_version(e.app_version);let n;if(e.temp_db){n=`${e.temp_db}_${e.appname}_${t}`}else{n=`${e.appname}_${t}`}return`${u.ADMIN_USER_ID}_${n}`};r.transform_constraint_for_db=function(e,t){if(e==="user"&&t.key==="email"&&t.constraint_type==="equals"){return i.extend({},t,{constraint_type:"email_equals"})}if(e==="user"&&t.key==="logged_in"){return i.extend({},t,{key:"user_signed_up"})}return t};r.DB=class e{constructor(){this._locals={};this.result_cache={}}inspect(){return this.constructor.name}query_planner(){var e;(e=this._query_planner)!=null?e:this._query_planner=new R.QueryPlanner;return this._query_planner}iterate(e,t){var n,r;(n=t)!=null?n:t=0;if(typeof((r=E[e.t])==null?void 0:r.load)==="function"){return n=>{let r;if(n!=null){r=t+n}else{const n=this.get_ranges(e,t,t+1);if(n===u.range_states.PAST_END){return null}if([u.range_states.AVAILABLE,u.range_states.LOADING].includes(n[0].state)&&n[0].to>t){r=n[0].to}else{r=Math.min(t+u.MAX_SEARCH_CHUNK,Math.max(t+10,t*2))}}const i=this.execute_call_get_children(e,t,r-t);if(i.length===0){return null}t=r;return i}}else{const n=E[e.t].fn.call(this,e,t);return e=>{const t=n(e);if(t.length===0){return null}else{return t}}}}all(e){const t=this.iterate(e)(u.ALL_MAX);return t!=null?t:[]}build_search_path(e,t){var n,r,s,o,a;(n=this._search_path_cache)!=null?n:this._search_path_cache={};const l=JSON.stringify({plan:e,to:t});(s=(r=this._search_path_cache)[l])!=null?s:r[l]=(o=_.get_current_eval_node())==null?void 0:o.serialize();if(!this._search_path_cache[l]&&i.on_client()&&!y){y=true;c.warn("No search path found",{key:l})}return JSON.stringify((a=this._search_path_cache[l])!=null?a:null)}get_plan_for_node(e,t){switch(e.t){case"All":{var n;const r={t:"CallSearch",type:e.type,constraints:[],sorts_list:(n=t.sorts_list)!=null?n:[]};if(t.lookup){r.extra={lookup:t.lookup}}return r}case"Filter":{var s,o;const n=this.get_plan_for_node(e.prev,{});if(n.t!=="CallSearch"){return i.extend({},e,{prev:n})}if(((s=n.constraints)==null?void 0:s.length)>0){throw new i.UnexpectedError("should not have constraints",{query:e,prev:n})}const a=[];const l=[];for(const t of e.constraints){const e=r.transform_constraint_for_db(n.type,t);if(k.can_execute_in_db(n.type,e)){a.push(e)}else{l.push(t)}}const{search:c,leftover:u}=this.query_planner().pick_search(n.type,a,(o=t.sorts_list)!=null?o:[],t.n);l.push(...u||[]);if(l.length===0){if(t.lookup){c.extra={lookup:t.lookup}}return c}return{t:"Filter",constraints:l,prev:c}}case"Sort":{const n=this.get_plan_for_node(e.prev,{sorts_list:e.sorts_list,n:t.n,lookup:t.lookup});let r;if(n.t==="CallSearch"){r=n}else if(n.t==="Filter"&&n.prev.t==="CallSearch"){r=n.prev}if(!r){return i.extend({},e,{prev:n})}if(JSON.stringify(r.sorts_list)===JSON.stringify(e.sorts_list)){return n}else{return i.extend({},e,{prev:n})}}case"Contains":{var a;const t=this.get_plan_for_node(e.prev,{});if(!["CallSearch","Filter"].includes(t.t)){return i.extend({},e,{prev:t})}if(D.get(this.get_plan_ret_btype(t)).custom_type()==null){return i.extend({},e,{prev:t})}const n=I.rehydrate_tree(this,e.item);if(t.t==="CallSearch"&&t.type!==(n==null?void 0:(a=n._type)==null?void 0:a.call(n))){return w}if(!(n!=null&&n.exists())){return w}const r=[];const s=t.t==="Filter";for(const e of(l=t.constraints)!=null?l:[]){var l;if(s||R.can_execute_in_memory(e)){if(!k.local_constrain(n,e,t.type)){return w}}else{r.push(e)}}if(r.length===0){if(t.t==="CallSearch"){return x}else{return i.extend({},e,{prev:t})}}r.push({key:f.UNIQUE_ID,constraint_type:"equals",value:n._id()});const o={t:"Compare",op:">",n:0,prev:{t:"Length",prev:{t:"Filter",constraints:r,prev:{t:"All",type:t.type}}}};return this.get_plan_for_node(o,{})}case"Compare":{let t;if(e.prev.t==="Length"&&e.n===0){const n=this.get_plan_for_node(e.prev.prev,{});t={t:"Length",bound:e.n+1,prev:n,options:e.prev.options};return{t:"Compare",prev:t,op:e.op,n:e.n}}t=this.get_plan_for_node(e.prev,{});if(t.t==="Length"){t={t:"Length",bound:e.n+1,prev:t.prev,options:e.prev.options}}return{t:"Compare",prev:t,op:e.op,n:e.n}}case"GroupBy":{const t=this.get_plan_for_node(e.prev,{n:u.ALL_MAX});const n=t=>i.extend({},e,{prev:t});if(t.t!=="CallSearch"){return n(t)}const r=this.query_planner().get_stats(t.type,t.constraints);if(r!=null&&r.searches){if(r.length!=null){for(const e of Object.values(r.searches)){if(e.loaded>=r.length){return n(this.query_planner().node_to_search(e))}}}}return{t:"CallGroupBy",aggregations:e.aggregations,groupings:e.groupings,constraints:t.constraints,type:t.type}}case"Length":case"Numeric":{var c;let t,n,r,s,o,a,l;if(e.t==="Length"){a=this.get_plan_for_node(e.prev,{n:u.ALL_MAX});n=a.t==="CallSearch";t=a;r=e=>({t:"Length",prev:this.query_planner().node_to_search(e)});s="count";o=undefined;l=e.options}else{const t=e.prev;n=t.t==="Transform";if(n){const e=D.get(t.value_id).get_message(t.message);n=e.ret_btype_id()!=="null"&&e.is_lookup()}if(n){a=this.get_plan_for_node(t.prev,{n:u.ALL_MAX});n=a.t==="CallSearch"}r=n=>{const r=i.extend({},t,{prev:this.query_planner().node_to_search(n)});return i.extend({},e,{prev:r})};s=e.op;o=t.message;l=e.options}if(n){const e=this.query_planner().get_stats(a.type,a.constraints);if(e!=null&&e.searches){if(e.length!=null){for(const t of Object.values(e.searches)){if(!t.from>0&&!t.has_gaps&&t.loaded>=e.length){return r(t)}}}if(!e[k.aggregate_started_key(s,o,l)]){for(const t of Object.values(e.searches)){var d;const e=t.loading_to-((d=t.loaded)!=null?d:0);if(!t.from>0&&!t.has_gaps&&e>0&&e<u.MAX_SEARCH_CHUNK){return r(t)}}}}return{t:"CallAggregate",type:a.type,constraints:a.constraints,agg_fn:s,field:o,options:l}}(c=t)!=null?c:t=this.get_plan_for_node(e.prev,{n:u.ALL_MAX});return i.extend({},e,{prev:t})}case"Transform":{let n;const r=D.get(e.value_id).get_message(e.message);if(r.is_lookup()&&r.ret_btype().custom_type()!=null){n=[e.message];if(t.lookup){n=n.concat(t.lookup)}}else{n=null}const s=this.get_plan_for_node(e.prev,{lookup:n});return i.extend({},e,{prev:s})}case"ExtraFields":{var p;const t=this.get_plan_for_node(e.prev,{});if(((p=e.extra_field_names)==null?void 0:p.length)>0){t.extra={lookup:e.extra_field_names}}return t}case"Columns":{const t=this.get_plan_for_node(e.prev,{});if(t!=null){const n={};for(const t of e.columns){n[t]=true}n._id=true;n._version=true;if(t.sorts_list!=null){for(const e of t.sorts_list){n[e.sort_field]=true}}t.columns=Object.keys(n)}return t}default:{const t={};if(e.prev){t.prev=this.get_plan_for_node(e.prev,{})}if(e.prevs){t.prevs=e.prevs.map((e=>this.get_plan_for_node(e,{})))}return i.extend({},e,t)}}}validate_query(e){var t;if(!E[e.t]){throw new i.UnexpectedError("Unrecognized query",{query:e})}(t=E[e.t].validate)==null?void 0:t.call(this,e);if(e.prev!=null){this.validate_query(e.prev)}if(e.prevs!=null){if(!Array.isArray(e.prevs)){throw new i.UnexpectedError("Prevs must be array",{query:e})}for(const t of e.prevs){this.validate_query(t)}}}build_query_plan(e,t,n){e=i.json_deep_copy(e);this.validate_query(e);e=this.simplify_query(e);this.canonicalize_query(e);const r=this.get_plan_for_node(e,{n:n});return r}execute_query(e,t,n){const r=this.build_query_plan(e,t,n);return this.execute_get_children(r,t,n)}init_result_cache(e){const t=this.get_cache_key(e);if(!this.result_cache[t]){this.result_cache[t]={plan:e,ranges:[]}}return this.result_cache[t]}get_ranges(e,t,n){if(n<=t){throw new i.UnexpectedError("assertion error: to must be strictly greater than from",{plan:e,from:t,to:n})}if(t<0){throw new i.UnexpectedError("assertion error: from must be at least 0",{plan:e,from:t,to:n})}const r=this.init_result_cache(e);const{ranges:s}=r;const o=[];let a=t;let l=false;for(const e of s){if(a>=n){break}if(e.to<=a){if(e.state===u.range_states.AVAILABLE&&e.at_end){return u.range_states.PAST_END}continue}if(a<e.from){const t=Math.min(e.from,n);o.push({state:u.range_states.NOT_STARTED,from:a,to:t});a=t}if(e.from>=n){break}o.push(e);a=e.to;if(e.state===u.range_states.AVAILABLE&&e.at_end){l=true;break}}if(a<n){if(!l){o.push({state:u.range_states.NOT_STARTED,from:a,to:n})}}let c=false;for(const e of o){if(e.state===u.range_states.AVAILABLE){if(c){throw new i.UnexpectedError("assertion error: adjacent available ranges")}else{c=true}}else{c=false}}return o}get_plan_ret_btype(e){const t=E[e.t].get_ret_btype.call(this,e);return t}array_to_objects(e,t,n){const r=this.get_plan_ret_btype(e);if((!r||r==="null")&&(t==null?void 0:t.length)>0){c.error("null value_id in array_to_objects",{plan:e,value_id:r,array_length:t.length})}if(typeof r==="object"){if(r.get_message){c.error("Got value instead of value id",{plan:e})}else{throw new i.UnexpectedError("Got object value_id",{plan:e})}}const o=(e,t)=>{if(e==null){return null}if(t%10===0){s.optional_pause("in wrapped_get")}const r=this.get(e);if(n){r.precache()}return r};const a=(e,t)=>{if(t%10===0){s.optional_pause("in wrapped_static_get")}return h._static_get(e,this,r)};s.optional_pause("array_to_objects: pre");let l;if(D.get(r).custom_type()!=null){l=t.map(((e,t)=>o(e,t)))}else{l=t.map(((e,t)=>a(e,t)))}s.optional_pause("array_to_objects: post");return l}array_to_ids(e,t){const n=this.get_plan_ret_btype(e);if((!n||n==="null")&&(t==null?void 0:t.length)>0){c.error("null value_id in array_to_ids",{plan:e,value_id:n,array_length:t.length})}return h.array_to_ids(n,t)}get_cache_key(e){if(e.extra!=null){e=i.json_deep_copy(e);delete e.extra;return JSON.stringify(e)}return JSON.stringify(e)}execute_get_children(e,t,n){var r;const s={plan:e,from:t,n:n};if(n<=0){throw new i.UnexpectedError("must request at least 1 result",s)}if(t<0){throw new i.UnexpectedError("cannot call negative from",s)}const o=this.iterate(e,t);return(r=o(n))!=null?r:[]}execute_call_get_children(e,t,n){const r=t+n;const s=this.get_ranges(e,t,r);if(s===u.range_states.PAST_END){this.register_call_dependency(e);return[]}if(s.length===1&&s[0].state===u.range_states.AVAILABLE){const r=t-s[0].from;const i=r+n;this.register_call_dependency(e);return s[0].results.slice(r,i)}const a=[];const l=[];for(const e of s){switch(e.state){case u.range_states.LOADING:a.push(e.loading_key);break;case u.range_states.AVAILABLE:break;case u.range_states.ERROR:throw e.err;case u.range_states.NOT_STARTED:l.push(e);break;default:throw new i.UnexpectedError("Unrecognized range state: "+JSON.stringify(e))}}if(l.length>0){var c;if(((c=o.CurrentNotReadyCatcher)==null?void 0:c.length)>0){return[]}for(const t of l){a.push(this.load_get_children(e,t.from,t.to-t.from))}}const d=i.TransientKeyList(a);if(d.is_turned()){return this.execute_call_get_children(e,t,n)}i.ensure_ready(d);if(i.on_client()){return[]}else{throw new u.RetryError}}add_loading_range(e,t,n,r){const s=t+n;const o=this.init_result_cache(e);const{ranges:a}=o;let l,c;for(l=0;l<a.length;l++){const r=a[l];if(r.from>=s){break}if(r.from>t){throw new i.UnexpectedError("adding overlapping range",{plan:e,from:t,n:n,existing_ranges:a})}}if(a[l-1]&&a[l-1].state===u.range_states.AVAILABLE&&a[l-1].to===t){c=a[l-1].results.slice(-1)[0]}const d={state:u.range_states.LOADING,from_id:c,from:t,to:s,loading_key:r,result_cache:o};a.splice(l,0,d);return d}invalidate_plan(e){const t=this.result_cache[e];if(!t){return}t.ranges=[];this.invalidate_call_dependency(e)}get_plan_version(e){let t=null;for(const i of(n=(r=this.result_cache[e])==null?void 0:r.ranges)!=null?n:[]){var n,r;if(i.search_version!=null&&(t==null||i.search_version<t)){t=i.search_version}}return t}handle_results(e,t,n,r){const s=this.get_cache_key(e);this.init_result_cache(e);if(t.state!==u.range_states.LOADING&&n){c.error("Got an error for a non-loading range, throwing error",{plan:e,state:t.state});throw n}if(t.state!==u.range_states.LOADING){throw new i.UnexpectedError("assertion error: handle_results called on a non-loading range",{plan:e,range_state:t.state})}t.loading_key.turn();delete t.loading_key;if(n){t.state=u.range_states.ERROR;t.err=n;this.schedule_discard_errors(e)}else{E[e.t].initialize_range.call(this,e,t,r);t.state=u.range_states.AVAILABLE;for(const n in this.local_changes){const r=this._local(n);E[e.t].local_change.call(this,e,t,n,r.type,u.DONT_KNOW,r.raw,true)}let n=[];let i=null;for(const t of[].concat(this.result_cache[s].ranges)){if(t.state===u.range_states.AVAILABLE){if(i&&i.to===t.from){E[e.t].merge_ranges.call(this,e,i,t)}else{i=t;n.push(t)}}else{i=null;n.push(t)}}n=n.filter((e=>e.state!==u.range_states.DELETED));this.result_cache[s].ranges=n}}delete_range(e,t){const n=this.get_cache_key(e);i.array_remove(this.result_cache[n].ranges,t);t.state=u.range_states.DELETED}load_get_children(e,t,n){var r;if(typeof((r=E[e.t])==null?void 0:r.load)!=="function"){throw new i.UnexpectedError("no load function for "+e.t)}const s=i.MakeKey(null,JSON.stringify({plan:e,from:t,n:n}));const o=this.add_loading_range(e,t,n,s);E[e.t].load.call(this,{plan:e,from:t,n:n,from_id:o.from_id},this.handle_results.bind(this,e,o));return s}canonicalize_query(e){if(E[e.t].canonicalize){E[e.t].canonicalize(e)}if(e.prev){this.canonicalize_query(e.prev)}if(e.prevs){for(const t of e.prevs){this.canonicalize_query(t)}}return null}simplify_query(e,t){var n;(n=t)!=null?n:t={};const r={};for(const[n,i]of Object.entries(t)){var s;if((s=E[e.t].preserves_context)!=null&&s[n]){r[n]=i}}if(E[e.t].adds_context){for(const[t,n]of Object.entries(E[e.t].adds_context)){r[t]=n}}if(e.prev){e=i.extend({},e,{prev:this.simplify_query(e.prev,r)})}if(e.prevs){e=i.extend({},e,{prevs:e.prevs.map((e=>this.simplify_query(e,r)))})}while(true){var o,a;if(!E[e.t]){throw new i.UnexpectedError("Unrecognized query type",{query:e})}let n=(o=E[e.t].simplify)==null?void 0:o.call(this,e,t);if(n){e=n;continue}if(((a=e.prev)==null?void 0:a.t)==="Sort"&&E[e.t].sort_neutral){var l;const r=e.prev.prev;let s=i.extend({},e,{prev:r});n=(l=E[s.t].simplify)==null?void 0:l.call(this,s,t);if(n){s=n}e=i.extend({},e.prev,{prev:s});continue}return e}}get_node(e){const[t,...n]=e.split(".");const r=this.get_object(t);return new this.DBNODE(r,n,this)}get_object(e){return new this.DBOBJECT(e,this)}_local(e){var t,n;(n=(t=this._locals)[e])!=null?n:t[e]=new b(this,e);return this._locals[e]}is_watching(e){return this._locals[e]!=null&&this._local(e).is_watching()}flush(e){this._local(e).flush();this._reload(e)}flush_all(){for(const e in this._locals){const t=this._locals[e];t.flush(true)}}reset(){this._locals={};this._search_path_cache={};this.result_cache={};this._query_planner=null}_get_data(e){if(e===u.NO_USER){const e=(new M).raw();return e}const t=this._local(e);if(t.error){throw t.error}else if(t.raw){return t.raw}else{return null}}_get_ready_key(e){if([u.NO_USER,"constructor"].includes(e)){return i.FakeKey()}return this._local(e).ready_key}_ensure_loading(e){if(e===u.NO_USER){return}if(this._local(e).raw===undefined){this._reload(e)}}_wait_for_process_updates(e,t,n){if(t==="local"||!this._get_ready_key(e).is_turned()){n()}else if(a.on_server()){n()}else{S().workflow.wait_for_server(n)}}_reload(e,t){var n;if(e===u.NO_USER){return}const r=this._local(e);if(r._is_loading){return}r._is_loading=true;const i=(n=this._local(e).latest_version)!=null?n:0;this.elasticsearch("get",{id:e,appname:this.appname,app_version:this.app_version,temp_db:this.cur_temp_db(),clear_cache:t},((t,n)=>{r._is_loading=false;this._handle_get_response(e,t,n);if((n==null?void 0:n._version)!=null&&n._version<i){if(N.offline&&n._type==="user"&&n._source.bubble_employee_boolean){return}c.error("Got an out of date version in _reload",{id:e,latest_version:i,version:n._version});return this._reload(e,true)}}))}_handle_get_response(e,t,n){if(t!=null){this._set_error(e,t);return}const{_version:r,found:i,_source:s,_type:o}=n;if(!i){var a;this._set_data(e,null,null,(a=this._local(e).latest_version)!=null?a:0)}else{this._set_data(e,s,o,r)}}_register_dependency(e){if(e===u.NO_USER){(new M).register_dependency()}this._local(e).dependency.register()}_set_local(e,t,n){this._ensure_loading(e);i.WaitFor(this._get_ready_key(e),(()=>{var r;const s=i.json_deep_copy((r=this._get_data(e))!=null?r:{});if(t){let e=s;for(const[r,i]of t.entries()){if(r===t.length-1){e[i]=n}else{var o,a;(a=(o=e)[i])!=null?a:o[i]={};e=e[i]}}}else{i.extend(s,n)}this._set_data(e,s,null,"local")}))}_delete_local(e){return this._set_data(e,null,null,"local")}_create_local(e,t){return this._set_data(e,{},t,"local")}_get_type(e){if(e===u.NO_USER){return"user"}return this._local(e).type}ensure_object_updates(e){let t=0;for(const n in e){const r=e[n];t++;if(t%10===0){s.optional_pause()}const o=this._local(n);let a;if(o.ready_key.is_turned()&&(r>o.version||r==="clear")){o.ready_key=i.MakeKey(30,"data ensure_object_updates loaded for "+n);a=true}else{a=false}if(r==="clear"){if(a){delete o.raw;delete o.version;this._reload(n)}}else{o.set_latest_version(r,v.EXTERNAL)}}}_set_error(e,t){const n=this._local(e);n.error=t;n.mark_ready()}_set_data(e,t,n,s){const o=i.Promise(null,"db._set_data "+e);if(e===u.NO_USER){(new M)._write(t);o.resolve();return o}if(s!=="local"){r.global_data_items_loaded++}this._wait_for_process_updates(e,s,(()=>{g("db_set_data",(()=>{var r;const i=this._local(e);if(!(s==="local"||s>((r=i.version)!=null?r:-1))){o.resolve()}else{var a,l,c;if(i.latest_version>s){var u;this._reload(e);(u=i._outstanding_set_data_promise)==null?void 0:u.resolve(o);i._outstanding_set_data_promise=o;return}if(s==="local"&&n!=null){i.just_created=true}if(i.just_created&&s!=="local"){if(t===null){o.resolve();return}else{i.just_created=false}}(a=this.local_changes)!=null?a:this.local_changes={};if(s==="local"){this.local_changes[e]=i.raw}else{i.version=s;delete this.local_changes[e]}const r=(l=i.raw)!=null?l:i.flushed_raw;delete i.flushed_raw;i.raw=t;if(n!=null){i.type=n}if(i.type||i.raw===null){i.error=null;i.mark_ready();this.local_item_updated(e,i.raw,i.type,s)}i.dependency.invalidate();i.watch();(c=i._outstanding_set_data_promise)==null?void 0:c.resolve();o.resolve();if(r!=null||s==="local"||i.latest_version_source===v.EXTERNAL){i.treat_as_changed=false;this.publish_change(e,n!=null?n:i.type,r,t,s==="local")}}}))}));return o}publish_change(e,t,n,r,i){for(const s in this.result_cache){const o=this.result_cache[s];const{plan:a}=o;let l=false;for(const s of[].concat(o.ranges)){if(s.state===u.range_states.AVAILABLE){const o=E[a.t].local_change.call(this,a,s,e,t,n,r,i);if(o===u.DONT_KNOW){const e=E[a.t].watch_search_call.call(this,a);this.notify_maybe_invalid(e,true)}else if(o){l=true}}}if(l){this.invalidate_call_dependency(s)}}}cur_temp_db(){if(this.temp_db){return h.get_temp_db(this.temp_db,this.get_appname())}return undefined}lookup_user(e,t){const n=[{key:e,constraint_type:"equals",value:t}];const r=this.find("user",n);return r.get_children(0,1)[0]}find(e,t,n,i){var s;t=I.dehydrate_tree(t);if(e==="user"){t=t.concat([{key:"user_signed_up",constraint_type:"equals",value:true},{key:"_id",constraint_type:"not equal",value:this.get_admin_user_id()},{key:"_id",constraint_type:"not equal",value:r.get_admin_user_id({appname:this.appname,app_version:d.LIVE_VERSION})},{key:"_id",constraint_type:"not equal",value:r.get_admin_user_id({appname:this.appname,app_version:d.TEST_VERSION})},{key:"_id",constraint_type:"not equal",value:u.ADMIN_USER_ID}])}let o={t:"All",type:e};if(((s=t)==null?void 0:s.length)>0){o={t:"Filter",constraints:t,prev:o}}if((n==null?void 0:n.length)>0){o={t:"Sort",sorts_list:n,prev:o}}const a=new r.ListWrapper(this,o);if(i&&!_.get_current_eval_node()){a._creation_eval_node={serialize(){return i}}}return a}static_list(e,t){var n;if(!e){throw new i.UnexpectedError("Value id is required",{value_id:e})}(n=t)!=null?n:t=[];if(!Array.isArray(t)){throw new i.UnexpectedError("Bad array",{array_type:typeof t,array_str:String(t),value_id:e})}const r=h.array_to_ids(e,t);return this.static_list_from_ids(e,r)}static_list_from_ids(e,t){var n;if(!e){throw new i.UnexpectedError("Value id is required",{value_id:e})}(n=t)!=null?n:t=[];if(!Array.isArray(t)){throw new i.UnexpectedError("Bad array",{array_type:typeof t,array_str:String(t),value_id:e})}const s={t:"Static",data:t,value_id:e};return new r.ListWrapper(this,s)}retrieve(e,t){const n=[];for(const e in t){const r=t[e];if(r==null){throw new i.UnexpectedError("retrieve: value cannot be null for key "+e)}n.push({key:e,value:r,constraint_type:"equals"})}const r=this.find(e,n);let o=5;while(r.get_children(0,1)[0]==null){o-=1;if(o===0){throw new i.UnexpectedError("Retrieve failed for "+e,t)}s.pause(1e3,"db retrieve attempt cooldown")}return r.get_children(0,1)[0]}get_admin_user_id(){const e=this.cur_temp_db();return r.get_admin_user_id({appname:this.appname,app_version:this.app_version,temp_db:e})}id(){return this.appname+"_"+this.app_version+(this.temp_db?"_"+this.temp_db:"")}create(e,t,n){var r,s;(r=t)!=null?r:t={};if(n&&a.on_server()){if(this.get(n).exists()){throw new i.UnexpectedError("cannot create object, id already exists",{id:n,type:e,initial_data:t})}}(s=n)!=null?s:n=i.UUID();const o=this.get_object(n);let l;if(e==="user"){l=n}else{l=S().current_user()._id()}const c={"Created By":p.HYDRATE_STRING+l,"Created Date":i.timestamp(),"Modified Date":i.timestamp()};i.extend(c,t);this._create_local(n,e);o.set(c,{is_insert:true});return o}get(e){if(!e||typeof e!=="string"){throw new i.UnexpectedError("bad id: must be a string",{id_type:typeof e,id_as_string:String(e)})}if(e===u.NO_USER){return new M}if(e.indexOf("sample:")===0){return new O.SampleObject(e.replace("sample:",""))}return this.get_object(e)}};let j=null;let A=null;r.wipe_no_user=function(){if(a.on_server()){delete s.Fiber.current.NoUserObject}else{var e;j=null;(e=i.session_storage)==null?void 0:e.removeItem("NoUserObject")}};class M{constructor(){var e;this.ready_key=i.FakeKey();(e=A)!=null?e:A=i.Dependency();this.dependency=A}child(e){return new r.ClientDBNode(this,[e],S().db_instance())}_child(e){return new r.ClientDBNode(this,e,S().db_instance())}dehydrate(){return p.HYDRATE_STRING+u.NO_USER}_id(){return u.NO_USER}_type(){return"user"}is_equal_to(e){var t;return(e==null?void 0:(t=e.dehydrate)==null?void 0:t.call(e))===this.dehydrate()}precache(){}exists(){return false}ignore_privacy(){return this}get_email(){return null}is_logged_in(){return false}raw(){var e,t;function n(){const e={};if(!S().is_edit_mode()){var t;const n=C.custom_type("user");const r=(t=n.fields())!=null?t:[];for(let t=0;t<r.length;t++){const n=r[t];if(!n.deleted()&&n.default_val()!=null){e[n.name()]=n.default_val()}}}e["Created Date"]=i.timestamp();e["Modified Date"]=i.timestamp();return e}if(a.on_server()){var r,o;return(r=(o=s.Fiber.current)==null?void 0:o.NoUserObject)!=null?r:n()}if(j!=null){return j}return i.json_parse((e=(t=i.session_storage)==null?void 0:t.getItem("NoUserObject"))!=null?e:i.json_stringify(n()))}_write(e){var t;if(a.on_server()&&s.Fiber.current!=null){s.Fiber.current.NoUserObject=e}try{i.session_storage.setItem("NoUserObject",JSON.stringify(e))}catch(t){var n;j=e;(n=i.session_storage)==null?void 0:n.removeItem("NoUserObject")}return(t=A)==null?void 0:t.invalidate()}register_dependency(){var e;(e=A)!=null?e:A=i.Dependency();A.register()}}r.NoUser=M;const E=e("./plans");const k=e("./plans/plan_utils");const O=e("./sample");const S=e("../lib");const D=e("../lang/btypes");h.set_lang_btypes(D);const C=e("../lang/appquery");const T=e("../notifier/client");const N=e("../client_config");const P=e("../locations");const I=e("./hydrate");I.register_db(r);const R=e("./query_planner")},{"../client_config":41,"../constants/db":58,"../constants/eval":64,"../constants/locations":74,"../constants/notifier_topics":76,"../constants/special_keys":87,"../lang/appquery":651,"../lang/btypes":653,"../lang/evaluation/eval_node_state":694,"../lib":741,"../locations":743,"../logger":744,"../notifier/client":747,"../safe_require":777,"../u":823,"../u/shared/async/async_state":829,"../u/shared/async/b_fiber":833,"../u/shared/mode_check":851,"./db_utils":428,"./hydrate":429,"./plans":457,"./plans/plan_utils":458,"./query_planner":460,"./sample":461,"./values/ConcatList":464,"./values/Dynamic":465,"./values/IntersectList":466,"./values/ListWrapper":467,"./values/NodeBase":468,"./values/NodeList":469,"./values/SortedList":470,"./values/StaticList":471,"./values/StaticNode":472,"./values/StaticObject":473,"./values/TransformList":474,"./values/UniqueList":475,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],428:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../u");const s=e("../u/shared/async/b_fiber");const o=e("../u/shared/mode_check");const a=e("../constants/eval");const l=e("../constants/db");const c=e("./values/registry");const u=e("./values/value_types");const d=e("../constants/postgres_pool");const p=e("../logger");const _=e("../lang/btype_ids");let f=null;r.set_lang_btypes=e=>f=e;r.lang_btypes=()=>f;r._is_geographic_object=function(e,t){if(t&&typeof t==="string"){return t==="geographic_address"}else{return e.lat&&e.lng&&!e._id}};r.resolve_sorts=function(e,t){const n=[];for(const r of e!=null?e:[]){if(r){if(r.self||r.sort_on_id){n.push(r)}else if(r.sort_field){if(t||typeof r.sort_field!=="object"){n.push(r)}}}}return n};r.ObjectBase={exists(){return this.raw()!=null},_id(){return this.id},_type(){let e=this.db._get_type(this.id);if(!e){this.raw();e=this.db._get_type(this.id)}return e},parent_id(){return this.id},dehydrate(){return a.HYDRATE_STRING+this.id},get(){return this},key(){return this.id},flush(){this.db.flush(this.id)},child(e){return this._child(e.split("."))},_child(e){return new this.db.DBNODE(this,e,this.db)},get_email(){return r.email_getter(this)},is_logged_in(){var e;return(e=this.child("user_signed_up").get())!=null?e:false},maison_by_default(){var e;return(e=this.child("maison_by_default_boolean").get())!=null?e:false},poll(e,t){if(o.running_test()){console.log("Polling turned on, but disabling it because this is a test");return}return this.db._local(this._id()).poll(e,t)}};r.email_getter=function(e){const t=e.child("authentication").child("email").child("email").raw();if(t){return t}const n=e.child("authentication").raw();for(const e in n){const t=n[e];if(t.email!=null){return t.email}}return null};r.get_temp_db=function(e,t){if(e&&e.indexOf(":")!==-1){if(e.split(":")[0]===t){return e.split(":")[1]}}else{return e}};r._static_get=function(e,t,n){if(c.is(e,u.DYNAMIC)){return e}else if(e!=null&&e.is_db_proxy||e!=null&&e.getTime){return e}const i=f.get(n);if(i.is_range()){return i.cast(v.rehydrate(t,e))}if(Array.isArray(e)){if(typeof n==="string"){n=i.inner_including_ranges().id()}const r=c.get(u.STATIC_LIST);return new r(v.rehydrate_tree(t,e),t,n)}if(e&&typeof e==="object"){if(r._is_geographic_object(e,n)){return e}else if(v.is_json_class(e)){return v.from_json(t,e)}if(e._id){const r=c.get(u.STATIC_OBJECT);return new r(e,t,n)}else{const r=c.get(u.STATIC_NODE);return new r(e,t,n)}}const s=v.rehydrate(t,e);if(!n){return s}return f.get(n).cast(s)};r.can_group_with=function(e,t){const n=f.get(e).get_message(t).ret_btype_id();switch(n){case"number":return["exact","bucket"];case"date":return["exact"].concat(l.CALENDAR_GROUPINGS);default:return["exact"]}};const h=e=>["text","number","date","user"].includes(e)||_.is_custom_type(e)||_.is_option_set(e);r.can_group_on=function(e){let t=f.get(e).get_messages();t=t.filter((e=>e.is_lookup()));t=t.filter((e=>h(e.ret_btype_id())));return t.map((e=>e.name()))};r.can_aggregate_on=function(e,t){if(e==="count"){return[]}let n=f.get(t).get_messages();const r=t=>t.is_lookup()&&t.ret_btype_id()==="number"||t.ret_btype_id()==="date"&&["max","min","average","median"].includes(e);n=n.filter(r);return n.map((e=>e.name()))};function m(e,t,n){if(e==null){return null}if(t%10===0){s.optional_pause()}if(typeof e._id!=="function"){throw new i.UnexpectedError("_id isnt function",{value_id:n,object_type:typeof e,obj_data:i.json_stringify(e,null,true)})}return e._id()}function g(e,t){if(t%10===0){s.optional_pause()}return v.dehydrate_tree(e)}r.array_to_ids=function(e,t){if(f.get(e).custom_type()!=null){return t.map(((t,n)=>m(t,n,e)))}else{return t.map(((e,t)=>g(e,t)))}};r.is_timeout_error=function(e){return(e.message===d.TIMEOUT_MSG||e.code===d.USER_REQUESTED_CANCEL_CODE)&&e instanceof b.UnexpectedError};r.enrich_timeout_error=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(r.is_timeout_error(e)){let n="Database query timeout";if(t.label&&t.label!=="[not found]"){n=`Database query timeout on "${t.label}"`}return new b.OwnerError(e.message,{...e.args,...t,display:n})}return e};r.coerce_to_integer=function(e,t){const n=Math.floor(e);if(e!==n)p.warn("consumer tried to pass non-integer value",{value:e,data_to_log:t});return n};const v=e("./hydrate");const b=e("../u/shared/errors")},{"../constants/db":58,"../constants/eval":64,"../constants/postgres_pool":80,"../lang/btype_ids":652,"../logger":744,"../u":823,"../u/shared/async/b_fiber":833,"../u/shared/errors":846,"../u/shared/mode_check":851,"./hydrate":429,"./values/registry":478,"./values/value_types":479,"core-js/modules/web.dom-collections.iterator.js":1123}],429:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("../lib");const s=e("../u/shared/async/b_fiber");const o=e("../u/shared/b_string");const a=e("../u/shared/incremental");const l=e("../logger");const c=e("../u/shared/errors");const u=e("../constants/eval");const d=e("./values/registry");const p=e("./values/value_types");const _=e("../safe_require");_.safe_register("./db/hydrate",r);let f={};r.register_db=e=>f=e;r.from_json=function(e,t){if(!f[t._class]){l.warn("Trying to from_json on a bad _class",{_class:String(t._class)})}return f[t._class].from_json(e,t)};r.is_json_class=function(e){return e&&e._class&&f[e._class]&&typeof f[e._class].from_json==="function"};r.dehydrate_tree=function(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(typeof e==="function"){throw new c.UnexpectedError("cannot dehydrate a function",{toString:e.toString()})}else if(e&&typeof e.to_json==="function"){return e.to_json()}else if(e&&typeof e.dehydrate==="function"){return e.dehydrate()}else if(e instanceof Date){return e.valueOf()}else if(e&&typeof e==="object"){if(e.constructor!=={}.constructor&&!Array.isArray(e)){throw new c.UnexpectedError(`trying to dehydrate a class: ${e.constructor.name}`)}s.optional_pause("dehydrate_tree pre iterate");let t=0;const n=Array.isArray(e)?[]:{};for(const i of Object.keys(e)){t++;if(t%10===0){s.optional_pause("dehydrate_tree in iterate")}n[i]=r.dehydrate_tree(e[i])}s.optional_pause("dehydrate_tree finished");return n}else{return e}};r.rehydrate=function(e,t){if(r.is_json_class(t)){return r.from_json(e,t)}if(o.starts_with(t,u.HYDRATE_STRING)){t=t.replace(u.HYDRATE_STRING,"");const n=t.split("::");if(n.length>1){if(!f[n[0]]){return null}return f[n[0]].rehydrate(e,n.slice(1).join("::"))}else{return e.get(t)}}else{return t}};r.rehydrate_tree=function(e,t){if(e&&typeof e.get!=="function"){throw new c.UnexpectedError(`called rehydrate tree with ${e} for my_db, it should be (my_db, obj)`)}if(typeof t==="function"){throw new c.UnexpectedError(`called rehydrate tree with function: ${t}`)}if(typeof t==="string"&&o.starts_with(t,u.HYDRATE_STRING)){return r.rehydrate(e,t)}else if(t&&typeof t==="object"){if(r.is_json_class(t)){return r.from_json(e,t)}if(d.is(t,p.DYNAMIC)){return t}const n=Array.isArray(t)?[]:{};let i=0;for(const o of Object.keys(t)){i++;if(i%10===0){s.optional_pause()}n[o]=r.rehydrate_tree(e,t[o])}return n}return t};r._dehydrate_value_id_data=function(e,t){let n=r.dehydrate_tree(e);n=a.incremental_json_stringify(n);n=`${t!=null?t:""},${n}`;return n};r._rehydrate_value_id_data=function(e,t){let n;const i=t.split(",");let s=i[0];if(s.indexOf("{")===0){s=null;n=t}else{if(!s){s=null}n=i.slice(1).join(",")}if(n==="undefined"){n=undefined}else{n=a.incremental_json_parse(n)}n=r.rehydrate_tree(e,n);return{value_id:s,data:n}};r.dehydrate_prefix=e=>u.HYDRATE_STRING+e+"::";function h(e){return r.dehydrate_prefix("OuterStringified")+a.incremental_json_stringify(e)}r.dehydrate_tree_to_db_primitive=function(e){if(Array.isArray(e)){return e.map((e=>r.dehydrate_tree_to_db_primitive(e)))}const t=r.dehydrate_tree(e);if(r.is_json_class(t)){return h(t)}else{return t}};r.dehydrate_tree_to_string_safe=function(e){if(Array.isArray(e)){return e.map((e=>r.dehydrate_tree_to_string_safe(e)))}const t=r.dehydrate_tree(e);if(t&&typeof t==="object"){return h(t)}else{return t}};function m(e){return typeof e==="string"&&o.starts_with(e,u.HYDRATE_STRING)&&!o.starts_with(e,r.dehydrate_prefix("OuterStringified"))}r.dehydrated_array_index_of=function(e,t){const n=e.indexOf(t);if(n>-1){return n}return e.findIndex((e=>m(e)&&t===r.dehydrate_tree_to_string_safe(r.rehydrate_tree(i().db_instance(),e))))}},{"../constants/eval":64,"../lib":741,"../logger":744,"../safe_require":777,"../u/shared/async/b_fiber":833,"../u/shared/b_string":841,"../u/shared/errors":846,"../u/shared/incremental":848,"./values/registry":478,"./values/value_types":479,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],430:[function(e,t,n){"use strict";const r=n;const i=e("browserify-aes");const s=e("pbkdf2");const o=e("../u/shared/timestamp");r.encode_data=(e,t)=>{const n="1";const r=String(o.timestamp());const i=`${r}_${n}`;const s=t+r;const l=String(Math.random());return{z:a(s,l,JSON.stringify(e),t),y:a(t,"po9",i,t),x:a(t,"fl1",l,t)}};function a(e,t,n,r){e=s.pbkdf2Sync(e,r,7,32,"md5");t=s.pbkdf2Sync(t,r,7,16,"md5");const o=i.createCipheriv("aes-256-cbc",e,t);o.write(n);o.end();return o.read().toString("base64")}},{"../u/shared/timestamp":854,"browserify-aes":961,pbkdf2:2269}],431:[function(e,t,n){"use strict";const r=e("../../u");const i={get_ret_btype(e){return e.type},fn(){throw new r.UnexpectedError("All cannot be executed")}};t.exports=i},{"../../u":823}],432:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../constants/db");const s=e("./plan_utils");const o=e("../values/StaticObject");const a={watch_search_call(e){return{constraints:e.constraints,type:e.type}},load(e,t){var n,i;let{plan:o,from:a,n:l}=e;if(a!==0||l!==1){throw new r.UnexpectedError("CallAggregate weird params",{plan:o,from:a,n:l})}let{constraints:c,type:u,agg_fn:d,field:p,options:_}=o;(n=p)!=null?n:p=undefined;(i=_)!=null?i:_=undefined;const f={};f[s.aggregate_started_key(d,p,_)]=true;this.query_planner().update(u,c,null,f);const h=[{n:d,field:p,options:_}];this.elasticsearch("aggregate",{appname:this.appname,app_version:this.app_version,temp_db:this.cur_temp_db(),type:u,constraints:c,aggregate:{fns:h},search_path:this.build_search_path(o,d)},((e,n)=>{var r,i;if(e){t(e);return}const s=n.fns[0];const{search_version:o}=n;if(d==="count"&&!((r=_)!=null&&r.should_approx)&&!((i=_)!=null&&i.cacheable)){this.query_planner().update(u,c,null,{length:s})}t(null,{value:s,search_version:o})}))},initialize_range(e,t,n){t.search_version=n.search_version;t.at_end=true;t.results=[n.value]},local_change(e,t,n,r,a,l,c){var u;let d,p;if(e.type!==r){return false}function _(t){if(t==null){return false}const n=new o(t,null,r);for(const t of e.constraints){if(!s.local_constrain(n,t,r)){return false}}return true}if(a===i.DONT_KNOW){var f;(f=t._unknown_ids)!=null?f:t._unknown_ids={};t._unknown_ids[n]=true;return i.DONT_KNOW}if((u=t._unknown_ids)!=null&&u[n]){return i.DONT_KNOW}const h=_(a);const m=_(l);let g=h!==m;if(!g&&h&&e.field){g=a[e.field]!==l[e.field]}if(!g){return false}if(!s.AGGREGATE_LOCAL_CHANGE[e.agg_fn]){return i.DONT_KNOW}if(e.field){p=h?a==null?void 0:a[e.field]:null;d=m?l==null?void 0:l[e.field]:null}t.results[0]=s.AGGREGATE_LOCAL_CHANGE[e.agg_fn](h,m,p,d,t.results[0]);return true},merge_ranges(e,t,n){throw new r.UnexpectedError("Merge CallAggregate",{plan:e,merge_into:t,merge_from:n})}};t.exports=a},{"../../constants/db":58,"../../u":823,"../values/StaticObject":473,"./plan_utils":458,"core-js/modules/web.dom-collections.iterator.js":1123}],433:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../constants/db");const s=e("./plan_utils");const o=e("../../u/shared/mode_check");const a=e("./GroupByBucketer");const l=e("../values/StaticObject");const c=e("../../lib");const u=e("../hydrate");const d=e("../query_planner");const p={watch_search_call(e){let{constraints:t,type:n,groupings:r,aggregations:i}=e;const s=new a(n,r,i);t=[].concat(t,s.get_grouping_constraints());d.sort_constraints(t);return{constraints:t,type:n,is_group_by:true}},load(e,t){let{plan:n,from:a,n:d}=e;let{constraints:p,type:_,groupings:f,aggregations:h}=n;function m(e){e=r.extend({},e);if(e.timezone_string==="browser"){e.timezone_string=c().current_timezone()}return e}f=f.map(m);const g=e=>f.map(((t,n)=>e[`grouping${String(n)}`]));return r.run_once(120,(()=>{if(a>0){const e=this.execute_call_get_children(n,0,a);if(e.length<a){return"at_end"}const t=u.rehydrate_tree(this,e[e.length-1]).raw();return g(t)}else{return null}}),((e,m)=>{if(e){t(e);return}if(m==="at_end"){return t(null,{at_end:true,results:[]})}const v=[];let b=true;const y=s.get_group_by_value_id(_,f,h);let w=null;const x=()=>{b=false;const e=d-v.length;return this.elasticsearch("group_by",{appname:this.appname,app_version:this.app_version,temp_db:this.cur_temp_db(),type:_,constraints:p,groupings:f,aggregations:h,last:m,n:Math.min(e,i.MAX_GROUPING_CALL),search_path:this.build_search_path(n,a+d)},((e,i)=>{if(e){t(e);return}if(!w||i.search_version<w){({search_version:w}=i)}for(const e of i.groups){v.push(u.dehydrate_tree(new l(e,c().db_instance(),y)))}if(i.groups[i.groups.length-1]){m=g(i.groups[i.groups.length-1])}const{at_end:s}=i;if(s||v.length===d){t(null,{at_end:s,results:v,search_version:w})}else if(v.length>d){t(new r.UnexpectedError("should never go above n",{results_length:v.length,n:d,plan:n}))}else{if(o.on_server()){b=true}else{x()}}}))};while(b){x()}}))},get_ret_btype(e){const{type:t,groupings:n,aggregations:r}=e;return s.get_group_by_value_id(t,n,r)},initialize_range(e,t,n){t.at_end=n.at_end;t.results=n.results;t.search_version=n.search_version},local_change(e,t,n,r,o,a,c){var u;if(e.type!==r){return false}function d(t){if(t==null){return false}const n=new l(t,null,r);for(const t of e.constraints){if(!s.local_constrain(n,t,r)){return false}}return true}if(o===i.DONT_KNOW){var p;(p=t._unknown_ids)!=null?p:t._unknown_ids={};t._unknown_ids[n]=true;return i.DONT_KNOW}if((u=t._unknown_ids)!=null&&u[n]){return i.DONT_KNOW}const _=d(o);const f=d(a);let h=_!==f;if(!h&&_){for(const t of e.aggregations){if(t.message){if(o[t.message]!==a[t.message]){h=true;break}}}if(!h){for(const t of e.groupings){if(o[t.message]!==a[t.message]){h=true;break}}}}if(!h){return false}else{return i.DONT_KNOW}},merge_ranges(e,t,n){t.results.push(...n.results);t.to=n.to;if(n.search_version<t.search_version){t.search_version=n.search_version}}};t.exports=p},{"../../constants/db":58,"../../lib":741,"../../u":823,"../../u/shared/mode_check":851,"../hydrate":429,"../query_planner":460,"../values/StaticObject":473,"./GroupByBucketer":445,"./plan_utils":458,"core-js/modules/web.dom-collections.iterator.js":1123}],434:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../u/shared/async/b_fiber");const s=e("../../logger");const o=e("../../constants/db");const a=e("./plan_utils");const l=e("../values/StaticObject");const c=e("../query_planner");const u=["_id"];function d(e){return(e!=null?e:[]).every((e=>u.includes(e.sort_field)))}const p={watch_search_call(e){return{constraints:e.constraints,type:e.type}},load(e,t){var n,s;let{plan:o,from:a,n:l,from_id:c}=e;const{constraints:u,sorts_list:p,type:_,extra:f,columns:h}=o;this.query_planner().update(_,u,p,{loading_to:a+l},true);const{local_change_buffer:m}=(n=this.query_planner().get_stats(_,u,p))!=null?n:{};l+=m!=null?m:0;let g,v;const b=d(p);const y=(s=(p!=null?p:[])[0])==null?void 0:s.descending;if(b&&c){g=[...u,{key:"_id",constraint_type:y?"less than":"greater than",value:c}];v=0}else{g=[...u];v=a}this.elasticsearch("search",{appname:this.appname,app_version:this.app_version,temp_db:this.cur_temp_db(),type:_,constraints:g,sorts_list:p,from:v,n:l,search_path:this.build_search_path(o,a+l),extra:f,columns:h},((e,n)=>{var s,o;if(e){t(e);return}const l=(s=(o=n.hits)==null?void 0:o.hits)!=null?s:[];const{search_version:c}=n;const{at_end:d}=n;const f=[];const m={};for(const[e,t]of l.entries()){if(e%10===0){i.optional_pause()}const n=t._id;f.push(n);if(h!=null){var g;const e=this._locals[n];if(e!=null&&t._version>((g=e.version)!=null?g:-1)){r.extend(e.raw,t._source)}}else{this._set_data(n,t._source,t._type,t._version)}m[n]=t._source}if(n.extras!=null&&h==null){for(const[e,t]of n.extras.entries()){if(e%10===0){i.optional_pause()}if(t){this._handle_get_response(t._id,null,t)}}}if(d){this.query_planner().update(_,u,null,{length:a+f.length})}this.query_planner().update(_,u,p,{from:a,loaded:a+f.length});t(null,{at_end:d,results:f,raw_data:m,search_version:c})}))},get_ret_btype(e){return e.type},initialize_range(e,t,n){t.at_end=n.at_end;t.results=n.results;t.before=[];t.after=[];t.search_version=n.search_version;const{type:r,constraints:l,sorts_list:u}=e;let d=c.can_sort_locally(r,u,l);t.sort_scores={};if(d){for(const[r,s]of t.results.entries()){if(r%10===0){i.optional_pause()}t.sort_scores[s]=a.calculate_sort_score(n.raw_data[s],e.sorts_list)}const p=t.results.slice(0,t.results.length-1);for(const[n,i]of p.entries()){const p=t.results[n+1];if(!a.is_less_than(u,i,t.sort_scores[i],p,t.sort_scores[p])){s.warn("Client-server sort mismatch",{type:r,sorts_list:u,db_first:t.sort_scores[i],db_second:t.sort_scores[p],first_id:i,second_id:p});d=false;c.add_bad_in_memory_sort(JSON.stringify({type:r,sorts_list:u,constraints:l}));const n=this.get_cache_key(e);for(const e of this.result_cache[n].ranges){if(e.state===o.range_states.AVAILABLE&&e!==t){e.state=o.range_states.DELETED}}this.invalidate_call_dependency(n);break}}}if(!d){for(const[e,n]of t.results.entries()){if(e%10===0){i.optional_pause()}t.sort_scores[n]=[t.from+e]}t.server_sorted=true}p._adjust_range_length.call(this,e,t,true)},local_change(e,t,n,i,s,u,d){if(e.type!==i){return false}let _;if(u==null){_=false}else{_=true;const t=new l(u,null,i);for(const n of e.constraints){if(!a.local_constrain(t,n,i)){if(!c.can_execute_in_memory(n)){return o.DONT_KNOW}_=false;break}}}if(!_){if(!t.sort_scores[n]){return false}delete t.sort_scores[n];r.array_remove(t.before,n);r.array_remove(t.after,n);if(t.results.indexOf(n)===-1){return false}r.array_remove(t.results,n);p._adjust_range_length.call(this,e,t);return true}if(!c.can_sort_locally(i,e.sorts_list,e.constraints)){return o.DONT_KNOW}const f=a.calculate_sort_score(u,e.sorts_list);const h=t.sort_scores[n]!=null;if(h&&JSON.stringify(t.sort_scores[n])===JSON.stringify(f)){return false}t.sort_scores[n]=f;if(h){r.array_remove(t.before,n);r.array_remove(t.after,n);r.array_remove(t.results,n)}function m(r){let i=0;let s=r.length;while(i!==s){const o=Math.floor(i+(s-i)/2);if(a.is_less_than(e.sorts_list,n,f,r[o],t.sort_scores[r[o]])){s=o}else{i=o+1;if(i>s){i=s}}}r.splice(i,0,n)}if(t.results.length===0){if(t.from===0&&t.at_end){t.results.push(n)}else{if(t.from!==0){m(t.before)}if(!t.at_end){m(t.after)}}}else if(a.is_less_than(e.sorts_list,n,f,t.results[0],t.sort_scores[t.results[0]])){if(t.from===0){t.results.unshift(n)}else{m(t.before)}}else if(a.is_less_than(e.sorts_list,t.results[t.results.length-1],t.sort_scores[t.results[t.results.length-1]],n,f)){if(t.at_end){t.results.push(n)}else{m(t.after)}}else{m(t.results)}p._adjust_range_length.call(this,e,t);return true},_adjust_range_length(e,t,n){if(t.results.length>t.to-t.from){delete t.at_end;return}else if(t.results.length===t.to-t.from||t.at_end){return}if(!n){var r;let n=t.to-(t.from+t.results.length);const{type:i,constraints:s,sorts_list:o}=e;const{local_change_buffer:a}=(r=this.query_planner().get_stats(i,s,o))!=null?r:{};n+=a!=null?a:0;this.query_planner().update(i,s,o,{local_change_buffer:n})}t.to=t.from+t.results.length;if(t.results.length===0){return this.delete_range(e,t)}},merge_ranges(e,t,n){const r=t.results[0];const i=t.sort_scores[r];const s=n.results[n.results.length-1];const o=n.sort_scores[s];const l=[];const c={};for(const e in n.sort_scores){var u,d;const r=n.sort_scores[e];(d=(u=t.sort_scores)[e])!=null?d:u[e]=r}const _=t.sort_scores;function f(n){let u=0;let d=0;while(u<n.length&&a.is_less_than(e.sorts_list,n[u],_[n[u]],r,i,t.server_sorted)){u++}while(u<n.length&&(s==null||n[u]===s||a.is_less_than(e.sorts_list,n[u],_[n[u]],s,o,t.server_sorted))){if(!c[n[u]]){c[n[u]]=true;while(d<l.length&&a.is_less_than(e.sorts_list,l[d],_[l[d]],n[u],_[n[u]],t.server_sorted)){d++}if(d===l.length){l.push(n[u])}else{l.splice(d,0,n[u])}d++}u++}}f(t.results);f(t.after);f(n.before);f(n.results);t.results=l;t.after=n.after;t.at_end=n.at_end;t.to=n.to;if(n.search_version<t.search_version){t.search_version=n.search_version}p._adjust_range_length.call(this,e,t)}};t.exports=p},{"../../constants/db":58,"../../logger":744,"../../u":823,"../../u/shared/async/b_fiber":833,"../query_planner":460,"../values/StaticObject":473,"./plan_utils":458,"core-js/modules/web.dom-collections.iterator.js":1123}],435:[function(e,t,n){"use strict";const r={fn(e,t){let{prev:n,max:r}=e;const i=this.iterate(n,t);r-=t;t=0;return e=>{let n;const s=r-t;if(s<1){return[]}if(e!=null){n=Math.min(e,s)}else{n=null}let o=i(n);if(!o){return[]}if(o.length>s){o=o.slice(0,s)}t+=o.length;return o}},get_ret_btype(e){return this.get_plan_ret_btype(e.prev)}};t.exports=r},{}],436:[function(e,t,n){"use strict";const r=e("../db_utils");const i={fn(e,t){const{prev:n,value_id:i}=e;const s=this.iterate(n,t);return t=>{var n;return r.array_to_ids(i,this.array_to_objects(e,(n=s(t))!=null?n:[],true))}},get_ret_btype(e){return e.value_id},preserves_length:true,preserves_context:{sorted_above:true}};t.exports=i},{"../db_utils":428}],437:[function(e,t,n){"use strict";const r=e("../../u");const i={get_ret_btype(e){return e.type},fn(){throw new r.UnexpectedError("Columns cannot be executed")}};t.exports=i},{"../../u":823}],438:[function(e,t,n){"use strict";const r=e("../../u");const i=e("./plan_utils");const s={is_single:true,fn(e,t){return i.ensure_single(e,t,(()=>{var t;const{op:n,n:i,prev:s}=e;const o=(t=this.execute_get_children(s,0,1))==null?void 0:t[0];switch(n){case">":return[o>i];case"<":return[o<i];case">=":return[o>=i];case"<=":return[o<=i];case"===":return[o===i];case"!==":return[o!==i];default:throw new r.UnexpectedError("unrecognized op",{plan:e})}}))},get_ret_btype(){return"sys.bool"}};t.exports=s},{"../../u":823,"./plan_utils":458}],439:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../db_utils");const s={fn(e,t){const{prevs:n}=e;let r=-1;const s=[];let o=null;return a=>{let l,c;if(a!=null){c=t+a}else{c=t+1}c=i.coerce_to_integer(c,{n:a,to:c,from:t,plan:e});while(s.length<c){if(o==null){r++;if(r===n.length){break}o=this.iterate(n[r])}l=o();if(l==null){o=null}else{s.push(...l)}}if(a!=null){l=s.slice(t,c)}else{l=s.slice(t)}t+=l.length;return l}},validate(e){if(!Array.isArray(e.prevs)){throw new r.UnexpectedError("Concat must have prevs array",{query:e})}},get_ret_btype(e){for(const t of e.prevs){const e=this.get_plan_ret_btype(t);if(e!=null&&e!=="null"){return e}}return"null"},preserves_context:{sorted_above:true},simplify(e){let t=false;const n=[];for(const r of e.prevs){if(r.t==="Concat"){t=true;for(const e of r.prevs){n.push(e)}}else{n.push(r)}}if(t===false){return null}return r.extend({},e,{prevs:n})}};t.exports=s},{"../../u":823,"../db_utils":428,"core-js/modules/web.dom-collections.iterator.js":1123}],440:[function(e,t,n){"use strict";const r=e("../../u");const i=e("./plan_utils");const s=e("../db_utils");const o=e("../../u/shared/async/b_fiber");const a=e("../hydrate");const l=e("../plans");const c={is_single:true,fn(e,t){return i.ensure_single(e,t,(()=>{let t;let{value_id:n,item:r,prev:i}=e;const l=s.lang_btypes().get(n);r=a.rehydrate_tree(this,r);const c=this.iterate(i);while(t=c()){const e=this.array_to_objects(i,t);for(let t=0;t<e.length;t++){const n=e[t];if(t%10===0){o.optional_pause()}if(l.equals(n,r)){return[true]}}}return[false]}))},get_ret_btype(){return"sys.bool"},adds_context:{sorted_above:true},simplify(e){if(l[e.prev.t].preserves_items){return{t:"Contains",value_id:e.value_id,item:e.item,prev:e.prev.prev}}else if(e.prev.t==="Concat"){return{t:"Reduce",op:"or",prev:{t:"Concat",prevs:e.prev.prevs.map((t=>r.extend({},e,{prev:t})))}}}else if(e.prev.t==="Intersect"){return{t:"Reduce",op:"and",prev:{t:"Concat",prevs:e.prev.prevs.map((t=>r.extend({},e,{prev:t})))}}}else{return null}}};t.exports=c},{"../../u":823,"../../u/shared/async/b_fiber":833,"../db_utils":428,"../hydrate":429,"../plans":457,"./plan_utils":458}],441:[function(e,t,n){"use strict";const r=e("../../u");const i={get_ret_btype(e){return this.get_plan_ret_btype(e.prev)},fn(){throw new r.UnexpectedError("ExtraFields cannot be executed")}};t.exports=i},{"../../u":823}],442:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../../u/shared/async/b_fiber");const s=e("./plan_utils");const o=e("../query_planner");const a=e("../db_utils");const l={fn(e,t){const{prev:n,constraints:r}=e;const o=[];const l=this.iterate(n);const c=this.get_plan_ret_btype(e.prev);return u=>{let d,p;if(u!=null){p=t+u}else{p=t+1}p=a.coerce_to_integer(p,{n:u,to:p,from:t,plan:e});let _;while(o.length<p&&(_=l())){const e=this.array_to_objects(n,_,true);for(let t=0;t<e.length;t++){const n=e[t];if(t%10===0){i.optional_pause()}if(s.pass_filter(n,r,c)){o.push(_[t])}}}if(u!=null){d=o.slice(t,p)}else{d=o.slice(t)}t+=d.length;return d}},validate(e){if(!Array.isArray(e.constraints)){throw new r.UnexpectedError("Filter must have constraints array",{query:e})}},canonicalize(e){return o.sort_constraints(e.constraints)},get_ret_btype(e){return this.get_plan_ret_btype(e.prev)},simplify(e){if(e.prev.t==="Filter"){return{t:"Filter",constraints:e.constraints.concat(e.prev.constraints),prev:e.prev.prev}}else if(["Concat","Intersect"].includes(e.prev.t)){return{t:e.prev.t,prevs:e.prev.prevs.map((t=>this.simplify_query(r.extend({},e,{prev:t}))))}}else{return null}},sort_neutral:true,preserves_context:{sorted_above:true}};t.exports=l},{"../../u":823,"../../u/shared/async/b_fiber":833,"../db_utils":428,"../query_planner":460,"./plan_utils":458}],443:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../hydrate");const s=e("../db_utils");const o=e("../../lang/btype_ids");const a={fn(e,t){const{prev:n}=e;const r=this.iterate(n);let o=null;let a=[];const l=[];return n=>{let c,u;if(n!=null){u=t+n}else{u=t+1}u=s.coerce_to_integer(u,{n:n,to:u,from:t,plan:e});while(l.length<u){if(o==null){var d,p,_;if(a.length===0){a=r();if(a==null){break}}const e=(d=i.rehydrate_tree(this,a.shift()))==null?void 0:(p=(_=d).get_plan)==null?void 0:p.call(_);if(e==null){continue}o=this.iterate(e)}while(l.length<u){c=o();if(c==null){o=null;break}l.push(...c)}}if(n!=null){c=l.slice(t,u)}else{c=l.slice(t)}t+=c.length;return c}},validate(e){const t=this.get_plan_ret_btype(e.prev);if(!o.is_list(t)){throw new r.UnexpectedError("Flatten must be called on a plan that returns lists",{query:e})}},get_ret_btype(e){const t=this.get_plan_ret_btype(e.prev);return t.slice(5)},preserves_context:{sorted_above:true},simplify(e){return null}};t.exports=a},{"../../lang/btype_ids":652,"../../u":823,"../db_utils":428,"../hydrate":429,"core-js/modules/web.dom-collections.iterator.js":1123}],444:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./GroupByBucketer");const i=e("../../logger");const s=e("./plan_utils");const o=e("../values/TransformList");const a=e("../hydrate");const l={fn(e,t){const{aggregations:n,prev:s}=e;const l=this.get_plan_ret_btype(s);const c=new r(l,e.groupings,n);const u=[];const d=this.array_to_objects(s,this.all(s)).filter((e=>e!==null&&c.is_in_range(e)));d.sort(c.build_grouping_sorter());let p=null;let _=null;const f=e=>{for(const[t,n]of c.groupings.entries()){if(a.dehydrate_tree(c.get_bucket(n,e))!==a.dehydrate_tree(p[t])){return false}}if(c.continuous_group!=null&&c.get_bucket(c.continuous_group,e)!==_){return false}return true};const h=()=>{if(c.continuous_group!=null){if(_==null){_=c.get_continuous_start()}else{_=c.next_bucket(c.continuous_group,_);if(_>c.get_continuous_end()){p=null;if(c.groupings.length===0){return}_=c.get_continuous_start()}}}else{p=null}if(p==null){if(d[0]==null&&c.groupings.length>0){return}p=c.groupings.map((e=>c.get_bucket(e,d[0])))}};const m=()=>{h();if(p==null){return}const e=[];while(d[0]!=null&&f(d[0])){e.push(d.shift())}const t={};for(const[e,n]of p.entries()){t["grouping"+String(e)]=n}if(c.continuous_group!=null){t["grouping"+String(p.length)]=_}let r=null;for(const[a,{fn:c,message:u}]of n.entries()){let n;if(c==="count"){n=e.length}else{var s;(s=r)!=null?s:r=this.static_list(l,e);const t=new o(r,{value_id:l,message:u});if(c in t){n=t[c]()}else{i.info("Unexpectedly missing transform call!",{fn_name:c});n=t._numeric_op(c)}}t["agg"+String(a)]=n}return t};return e=>{let n,r;if(e!=null){r=t+e}else{r=t+1}let i;while(u.length<r&&(i=m())){u.push(a.dehydrate_tree(i))}if(e!=null){n=u.slice(t,r)}else{n=u.slice(t)}t+=n.length;return n}},get_ret_btype(e){const{aggregations:t,groupings:n,prev:r}=e;return s.get_group_by_value_id(this.get_plan_ret_btype(r),n,t)},adds_context:{sorted_above:true}};t.exports=l},{"../../logger":744,"../hydrate":429,"../values/TransformList":474,"./GroupByBucketer":445,"./plan_utils":458,"core-js/modules/web.dom-collections.iterator.js":1123}],445:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../db_utils");const s=e("./plan_utils");const o=e("../../constants/db");const a=e("../../u/shared/mode_check");let l;if(!a.on_server()){l=e("../../../vendor/jquery_plugins/moment.timezone.min.js")}else{const t=e;l=t("moment-timezone")}function c(e,t){if(e==="browser"){return l(t)}else{return l(t).tz(e)}}const u=5;function d(e,t){const n=Math.log10(t);const r=Math.max(0,u-n);return Number(e.toFixed(r))}class p{constructor(e,t,n){this.prev_value_id=e;this.aggregations=n;this.prev_value=i.lang_btypes().get(this.prev_value_id);this.bucket_starts=t.map(this.get_start,this);this.all_groupings=t;this.last_grouping=t[t.length-1];if(this.last_grouping.end!=null&&o.BUCKET_GROUPINGS.includes(this.last_grouping.fn)){this.continuous_group=this.last_grouping;this.groupings=t.slice(0,t.length-1);this.bucket_end=this.get_bucket_from_data(this.last_grouping,this.continuous_group.end)}else{this.continuous_group=null;this.bucket_end=null;this.groupings=this.all_groupings}}get_bucket_data(e,t){return this.prev_value.get_message(e.message).evaluate_without_cast(t)}get_bucket(e,t){const n=this.get_bucket_data(e,t);return this.get_bucket_from_data(e,n)}get_bucket_from_data(e,t){var n;switch((n=e.fn)!=null?n:"exact"){case"exact":return t;case"bucket":{if(t==null){return null}const{start:n,interval:r}=e;const i=Math.floor((t-n)/r);const s=n+i*r;return d(s,r)}case"day":case"month":{if(t==null){return null}let{start:n}=e;const{interval:i,timezone_string:s}=e;n=c(s,e.start).startOf(e.fn);if(t<n.valueOf()){throw new r.UnexpectedError("assertion error: got data < start",{data:t,start:n,grouping:e})}const o=e.fn==="day"?"days":e.fn;let a=n;while(true){const e=a.clone().add(i,o);if(e.valueOf()>t){return a.valueOf()}else{a=e}}}default:throw new r.UnexpectedError("unrecognized fn "+e.fn)}}next_bucket(e,t){var n;switch((n=e.fn)!=null?n:"exact"){case"exact":throw new r.UnexpectedError("cannot call next_bucket on an exact match",{grouping:e,data:t});case"bucket":{const{interval:n}=e;const r=t+n;return d(r,n)}case"day":case"month":{const{interval:n,timezone_string:r}=e;const i=e.fn==="day"?"days":e.fn;return c(r,t).add(n,i).valueOf()}}}get_start(e){if(!o.BUCKET_GROUPINGS.includes(e.fn)){return null}return this.get_bucket_from_data(e,e.start)}is_in_range(e){let t;for(let n=0;n<this.groupings.length;n++){const r=this.groupings[n];if(this.bucket_starts[n]!=null){t=this.get_bucket_data(r,e);if(t==null){return false}if(t<this.bucket_starts[n]){return false}}}if(this.continuous_group!=null){t=this.get_bucket_data(this.continuous_group,e);if(t==null){return null}if(t<this.bucket_starts[this.groupings.length]){return false}if(this.get_bucket_from_data(this.continuous_group,t)>this.bucket_end){return false}}return true}build_grouping_sorter(e){var t;let n;(t=e)!=null?t:e=0;const r=t=>{const n=this.get_bucket(this.all_groupings[e],t);if(typeof(n==null?void 0:n._id)==="function"){return n._id()}return n};if(e+1<this.all_groupings.length){n=this.build_grouping_sorter(e+1)}else{n=()=>0}return s.make_sort_comparer(r,false,n)}get_continuous_start(){return this.get_start(this.continuous_group)}get_continuous_end(){return this.get_bucket_from_data(this.continuous_group,this.continuous_group.end)}get_grouping_constraints(){let e;const t=[];for(const n of this.groupings){e=this.get_start(n);if(e!=null){t.push({constraint_type:"or",opts:[{constraint_type:"greater than",key:n.message,value:e},{constraint_type:"equals",key:n.message,value:e}]})}}if(this.continuous_group){e=this.get_continuous_start();t.push({constraint_type:"or",opts:[{constraint_type:"greater than",key:this.continuous_group.message,value:e},{constraint_type:"equals",key:this.continuous_group.message,value:e}]});const n=this.next_bucket(this.continuous_group,this.get_continuous_end());t.push({constraint_type:"less than",key:this.continuous_group.message,value:n})}return t}}t.exports=p},{"../../../vendor/jquery_plugins/moment.timezone.min.js":2353,"../../constants/db":58,"../../u":823,"../../u/shared/mode_check":851,"../db_utils":428,"./plan_utils":458,"core-js/modules/web.dom-collections.iterator.js":1123}],446:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../u/shared/async/b_fiber");const s=e("../query_planner");const o=e("../db_utils");const a={fn(e,t){let n;const{prevs:r}=e;const s=[];const a=r.map((e=>({})));const l={};function c(e,t,n){if(n%10===0){i.optional_pause()}const o=JSON.stringify(e);if(l[o]){return}a[t][o]=true;for(let e=0;e<r.length;e++){if(!a[e][o]){return}}l[o]=true;return s.push(e)}const u=r.map((e=>this.iterate(e)));n=0;let d=0;return i=>{let a,l;if(i!=null){l=t+i}else{l=t+1}l=o.coerce_to_integer(l,{n:i,to:l,from:t,plan:e});while(s.length<l&&d<r.length){if(u[n]){const e=u[n]();if(!e){u[n]=null;d++}else{for(let t=0;t<e.length;t++){const r=e[t];c(r,n,t)}}}n++;if(n===r.length){n=0}}if(i!=null){a=s.slice(t,l)}else{a=s.slice(t)}t+=a.length;return a}},get_ret_btype(e){for(const t of e.prevs){const e=this.get_plan_ret_btype(t);if(e!=null&&e!=="null"){return e}}return"null"},validate(e){if(!Array.isArray(e.prevs)){throw new r.UnexpectedError("Intersect must have prevs array",{query:e})}},preserves_context:{sorted_above:true},simplify(e,t){let n;let i=false;const o=[];for(n of e.prevs){if(n.t==="Intersect"){i=true;for(const e of n.prevs){o.push(e)}}else{o.push(n)}}if(i){return r.extend({},e,{prevs:o})}if(!t.sorted_above){return null}let a=null;let l=null;for(n of e.prevs){if(n.t==="Filter"){a=n.prev}else if(n.t==="All"){a=n}else{return null}if(l==null){l=JSON.stringify(a)}else if(l!==JSON.stringify(a)){return null}}const c={};const u=[];for(n of e.prevs){if(n.t==="Filter"){for(const e of n.constraints){if(!c[JSON.stringify(e)]){c[JSON.stringify(e)]=true;u.push(e)}}}}if(u.length===0){return a}return{t:"Filter",constraints:s.sort_constraints(u),prev:a}}};t.exports=a},{"../../u":823,"../../u/shared/async/b_fiber":833,"../db_utils":428,"../query_planner":460,"core-js/modules/web.dom-collections.iterator.js":1123}],447:[function(e,t,n){"use strict";const r=e("../../constants/db");const i=e("./plan_utils");const s={is_single:true,fn(e,t){return i.ensure_single(e,t,(()=>{let t;let{prev:n,bound:i}=e;if(!i){i=r.ALL_MAX}let s=0;const o=this.iterate(n);while(s<i&&(t=o())){s+=t.length}return[s]}))},get_ret_btype(){return"number"},simplify(e){if(o[e.prev.t].preserves_length){return{t:"Length",bound:e.bound,prev:e.prev.prev,options:e.options}}else if(e.prev.t==="Concat"){return{t:"Reduce",op:"+",prev:{t:"Concat",prevs:e.prev.prevs.map((t=>({t:"Length",prev:t,options:e.options})))}}}else{return null}},adds_context:{sorted_above:true}};const o=e("../plans");t.exports=s},{"../../constants/db":58,"../plans":457,"./plan_utils":458}],448:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=e("../../u");const i=e("../../u/shared/async/b_fiber");const s=e("./../db_utils");const o=e("../../constants/eval");const a=e("../../lang/btype_ids");const l={fn(e,t){var n;const{id:a,field:l}=e;if(!a){throw new r.UnexpectedError("NodeList missing id",{plan:e})}const c=this.get(a);let u=(n=c.child(l)._extract(c.raw()))!=null?n:[];if(!Array.isArray(u)){throw new r.UnexpectedError("NodeList called on bad field",{plan:e})}const d=(e,t,n)=>{if(n%10===0){i.optional_pause()}if(typeof e!=="string"){return e}if(!r.starts_with(e,o.HYDRATE_STRING)||e.length>200||e.indexOf("StaticNode")!==-1||e.indexOf("StaticObject")!==-1){return e}const s=e.replace(o.HYDRATE_STRING,"");const a=this._local(s);a.dependency.register();if(a.raw==null&&a.ready_key.is_turned()){return null}else{return s}};const p=[];return n=>{let r,o;let a,l;if(n!=null){o=t+n}else{o=t+this.GET_BATCH_SIZE}o=s.coerce_to_integer(o,{n:n,to:o,from:t,plan:e});while(p.length<o&&u.length>0){const e=(o-p.length)*1.2;let t=u.slice(0,e);u=u.slice(e);for(a=0;a<t.length;a++){l=t[a];d(l,true,a)}t=t.map(((e,t)=>d(e,false,t)));t=t.filter((e=>e!=null));for(a=0;a<t.length;a++){l=t[a];if(a%10===0){i.optional_pause()}p.push(l)}}if(n!=null){r=p.slice(t,o)}else{r=p.slice(t)}t+=r.length;return r}},get_ret_btype(e){var t;if(e.type){return e.type}if(e.id==null){throw new r.UnexpectedError("NodeList missing id",{plan:e})}const n=this.get(e.id);const i=n._type();if(!i){return"null"}const o=(t=s.lang_btypes().get(i).get_message(e.field).ret_btype())==null?void 0:t.id();if(o==null||o==="null"){return"null"}if(o==="date_range"){return"date"}if(o==="number_range"){return"number"}if(!a.is_list(o)){throw new r.UnexpectedError("NodeList has non-list value for field: "+o)}return a.list_element_type(o)}};t.exports=l},{"../../constants/eval":64,"../../lang/btype_ids":652,"../../u":823,"../../u/shared/async/b_fiber":833,"./../db_utils":428,"core-js/modules/es.string.replace.js":1121}],449:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./plan_utils");const i=e("../../u");const s={is_single:true,fn(e,t){return r.ensure_single(e,t,(()=>{let t;let n;const{prev:r,op:s}=e;let o=this.all(r);if(o.length===0){return[null]}switch(s){case"sum":{let e=0;for(n of o){if(n!=null){e+=n}}return[e]}case"product":{let e=1;for(n of o){if(n!=null){e*=n}}return[e]}case"average":{let e=0;let t=0;for(n of o){if(n!=null){t++;e+=n}}if(t===0){return[null]}return[e/t]}case"median":o=[].concat(o);o.sort(((e,t)=>e-t));o=o.filter((e=>e!==null));if(o.length===0){return[null]}if(o.length%2===0){return[(o[o.length/2-1]+o[o.length/2])/2]}else{return[o[Math.floor(o.length/2)]]}case"min":{let e=o[0];for(t of o.slice(1)){if(t!=null){if(t<e){e=t}}}return[e]}case"max":{let e=o[0];for(t of o.slice(1)){if(t!=null){if(t>e){var a;e=(a=t)!=null?a:0}}}return[e]}default:throw new i.UnexpectedError("unrecognized op: "+s)}}))},get_ret_btype(){return"number"},simplify(e){},adds_context:{sorted_above:true}};t.exports=s},{"../../u":823,"./plan_utils":458,"core-js/modules/web.dom-collections.iterator.js":1123}],450:[function(e,t,n){"use strict";const r={fn(e,t){let{prev:n,offset:r}=e;r=Math.floor(r);if(r<0){r=0}const i=this.iterate(n,t+r);return e=>{var t;return(t=i(e))!=null?t:[]}},get_ret_btype(e){return this.get_plan_ret_btype(e.prev)}};t.exports=r},{}],451:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./plan_utils");const i=e("../db_utils");const s=e("../../u/shared/async/b_fiber");const o=e("../hydrate");const a={is_single:true,fn(e,t,n){return r.ensure_single(e,t,(()=>{let t;let{value_id:n,item:r,prev:a}=e;const l=i.lang_btypes().get(n);r=o.rehydrate_tree(this,r);let c=-1;const u=this.iterate(a);while(t=u()){const e=this.array_to_objects(a,t,true);for(const[t,n]of e.entries()){if(t%10===0){s.optional_pause()}c++;if(l.equals(n,r)){return[c]}}}return[-1]}))},get_ret_btype(){return"number"}};t.exports=a},{"../../u/shared/async/b_fiber":833,"../db_utils":428,"../hydrate":429,"./plan_utils":458,"core-js/modules/web.dom-collections.iterator.js":1123}],452:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../u/shared/async/b_fiber");const s=e("./plan_utils");const o={is_single:true,fn(e,t){return s.ensure_single(e,t,(()=>{let t,n;const{op:s,prev:o}=e;switch(s){case"+":t=0;n=(e,t)=>[e+t];break;case"or":t=false;n=(e,t)=>[e||t,e||t];break;case"and":t=true;n=(e,t)=>[e&&t];break;default:throw new r.UnexpectedError("unrecognized op "+s)}const a=this.iterate(o);let l;while(l=a()){for(const[e,r]of l.entries()){let s;if(e%10===0){i.optional_pause()}[t,s]=n(t,r);if(s){return[t]}}}return[t]}))},get_ret_btype(e){switch(e.op){case"+":return"number";case"or":return"boolean";default:throw new r.UnexpectedError("unrecognized op "+e.op)}},adds_context:{sorted_above:true}};t.exports=o},{"../../u":823,"../../u/shared/async/b_fiber":833,"./plan_utils":458,"core-js/modules/web.dom-collections.iterator.js":1123}],453:[function(e,t,n){"use strict";const r=e("../../constants/db");const i=e("./../db_utils");const s=e("./plan_utils");const o={fn(e,t){const{prev:n,sorts_list:i}=e;let o=this.all(n);o=this.array_to_objects(n,o,true);s.sort_in_memory(o,i,this.get_plan_ret_btype(e.prev));o=this.array_to_ids(n,o);return e=>{var n;(n=e)!=null?n:e=r.ALL_MAX;const i=t+e;const s=o.slice(t,i);t=i;return s}},get_ret_btype(e){return this.get_plan_ret_btype(e.prev)},preserves_items:true,preserves_length:true,canonicalize(e){e.sorts_list=i.resolve_sorts(e.sorts_list,true)},adds_context:{sorted_above:true},simplify(e,t){if(t.sorted_above){return e.prev}else{return null}}};t.exports=o},{"../../constants/db":58,"./../db_utils":428,"./plan_utils":458}],454:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../logger");const i=e("../../constants/db");const s={fn(e,t){var n;let{data:s,value_id:o}=e;(n=s)!=null?n:s=[];if(!Array.isArray(s)){r.error("Bad array rehydrated",{data:s,value_id:o});const e=[];for(const[t,n]of s.entries()){const r=parseInt(t);if(!isNaN(r)){e[r]=n}}s=e}return e=>{var n;(n=e)!=null?n:e=i.ALL_MAX;const r=t+e;const o=s.slice(t,r);t=r;return o}},get_ret_btype(e){return e.value_id}};t.exports=s},{"../../constants/db":58,"../../logger":744,"core-js/modules/web.dom-collections.iterator.js":1123}],455:[function(e,t,n){"use strict";const r=e("../../u/shared/async/b_fiber");const i=e("../db_utils");const s=e("../hydrate");const o={fn(e,t){let{prev:n,value_id:o,message:a,properties:l,_raw:c,arg:u}=e;const d=this.iterate(n,t);l=s.rehydrate_tree(this,l);a=i.lang_btypes().get(o).get_message(a);function p(e,t){if(t%10===0){r.optional_pause("transform")}return a.evaluate_without_cast(e,u,l,c)}return e=>{let t=d(e);if(t==null){return[]}t=this.array_to_objects(n,t,true);r.optional_pause("pre-transform");const s=t.map(((e,t)=>p(e,t)));r.optional_pause("post-transform");return i.array_to_ids(a.ret_btype_id(),s)}},get_ret_btype(e){let{value_id:t,message:n}=e;n=i.lang_btypes().get(t).get_message(n);return n.ret_btype().id()},preserves_length:true,preserves_context:{sorted_above:true}};t.exports=o},{"../../u/shared/async/b_fiber":833,"../db_utils":428,"../hydrate":429}],456:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../u/shared/async/b_fiber");const s=e("./plan_utils");const o=e("../query_planner");const a={simplify(e,t){let n,i;if(e.prev.t!=="Concat"){return null}let a=false;const l=e=>{if(e.t==="Unique"){a=true;return e.prev}else{return e}};const c=e.prev.prevs.map(l);if(a){return{t:"Unique",prev:this.simplify_query(r.extend({},e.prev,{prevs:c}))}}if(!t.sorted_above){return null}const u=e.prev.prevs;let d=null;let p=null;for(const e of u){if(e.t==="All"){return e}else if(e.t==="Filter"){p=e.prev}else{return null}if(d==null){d=JSON.stringify(p)}else if(d!==JSON.stringify(p)){return null}}const _=[];for(const e of u){const t={};const r=[];for(n of e.constraints){if(!t[JSON.stringify(n)]){r.push(n);t[JSON.stringify(n)]=true}}_.push(r)}const f={};for(i of _){for(n of i){var h,m;(m=f[h=JSON.stringify(n)])!=null?m:f[h]=0;f[JSON.stringify(n)]++}}const g=this.get_plan_ret_btype(p);const v=[];const b=[];let y=false;for(i of _){const e=[];for(n of(w=i)!=null?w:[]){var w;if(f[JSON.stringify(n)]===_.length){b.push(n);f[JSON.stringify(n)]="added"}else if(f[JSON.stringify(n)]!=="added"){if(!s.can_execute_in_db(g,n)){return null}e.push(n)}}if(e.length===0){y=true}else if(e.length===1){if(e[0].constraint_type==="or"){for(const t of e[0].opts){v.push(t)}}else{v.push(e[0])}}else{v.push({constraint_type:"and",opts:o.sort_constraints(e)})}}if(!y){b.push({constraint_type:"or",opts:o.sort_constraints(v)})}return{t:"Filter",constraints:o.sort_constraints(b),prev:p}},fn(e,t){const{prev:n}=e;const r=[];const s={};const o=this.iterate(n);return e=>{let n,a;if(e!=null){a=t+e}else{a=t+1}let l;while(r.length<a&&(l=o())){for(const[e,t]of l.entries()){if(e%10===0){i.optional_pause()}if(!s[JSON.stringify(t)]){s[JSON.stringify(t)]=true;r.push(t)}}}if(e!=null){n=r.slice(t,a)}else{n=r.slice(t)}t+=n.length;return n}},get_ret_btype(e){return this.get_plan_ret_btype(e.prev)},preserves_items:true,sort_neutral:true,preserves_context:{sorted_above:true}};t.exports=a},{"../../u":823,"../../u/shared/async/b_fiber":833,"../query_planner":460,"./plan_utils":458,"core-js/modules/web.dom-collections.iterator.js":1123}],457:[function(e,t,n){"use strict";const r=n;r.All=e("./All");r.Static=e("./Static");r.Transform=e("./Transform");r.Cast=e("./Cast");r.Numeric=e("./Numeric");r.Contains=e("./Contains");r.Position=e("./Position");r.Compare=e("./Compare");r.NodeList=e("./NodeList");r.Length=e("./Length");r.Cap=e("./Cap");r.Offset=e("./Offset");r.Flatten=e("./Flatten");r.Concat=e("./Concat");r.Intersect=e("./Intersect");r.Unique=e("./Unique");r.Reduce=e("./Reduce");r.Filter=e("./Filter");r.Sort=e("./Sort");r.GroupBy=e("./GroupBy");r.Columns=e("./Columns");r.ExtraFields=e("./ExtraFields");r.CallSearch=e("./CallSearch");r.CallAggregate=e("./CallAggregate");r.CallGroupBy=e("./CallGroupBy")},{"./All":431,"./CallAggregate":432,"./CallGroupBy":433,"./CallSearch":434,"./Cap":435,"./Cast":436,"./Columns":437,"./Compare":438,"./Concat":439,"./Contains":440,"./ExtraFields":441,"./Filter":442,"./Flatten":443,"./GroupBy":444,"./Intersect":446,"./Length":447,"./NodeList":448,"./Numeric":449,"./Offset":450,"./Position":451,"./Reduce":452,"./Sort":453,"./Static":454,"./Transform":455,"./Unique":456}],458:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var r;let i;const s=n;const o=e("../../u");const a=e("../db_utils");const l=e("../../constants/db");const c=e("../../constants/special_keys");const u=e("../constraint_defs");const d=e("../../lang/appquery");const p=e("../../lang/evaluation/evaluate");const _=e("../../logger");const f=e("../values/ListWrapper");const h=e("../hydrate");const m=e("../../lang/btype_ids");s.ensure_single=function(e,t,n){if(t>0){return e=>[]}let r=false;return function(e){var t;(t=e)!=null?t:e=1;if(e!==1){return[]}if(r){return[]}r=true;return n()}};s.can_execute_in_db=function(e,t){let n;if(t.key==="_id"&&["lower than","greater than"].includes(t.constraint_type)){return true}if(e==="user"&&["email","StripeCustomerID","user_signed_up"].includes(t.key)){if(t.key==="email"&&t.constraint_type!=="email_equals"&&t.constraint_type!=="email_contains_string"){return false}return true}if(["and","or"].includes(t.constraint_type)){return true}if(t.key===c.UNIQUE_ID){return["equals","not equal","in","not in"].includes(t.constraint_type)}if(t.key===c.ALL_DB_FIELDS){return true}if(t.key===c.ADVANCED_SEARCH_CONSTRAINT){return false}const r=a.lang_btypes().get(e).get_message(t.key);return r.is_lookup()&&(n=r.ret_btype_id(),!l.NO_DB_CONSTRAINTS.includes(n))};s.pass_filter=function(e,t,n){for(const r of t){if(!s.local_constrain(e,r,n)){return false}}return true};function g(e,t){if(e==null||!e._id()){return 1}if(t==null||!t._id()){return-1}return e._id().localeCompare(t._id(),"en-US")}s.sort_in_memory=function(e,t,n){if(t.length===0){if(a.lang_btypes().get(n).custom_type()!=null){return e.sort(g)}else{return e}}else if(t[0].sort_field===c.RANDOM_SORTING){return o.shuffle_array(e)}else{const r=e=>function(t){if(e.sort_on_id){return t._id()}else if(e.self){return t}else if(e.sort_field&&t!=null){if(a.lang_btypes().get(n).option_set()!=null){var r;return(r=a.lang_btypes().get(n).option_set().value(t))==null?void 0:r.attr(e.sort_field)}if(typeof t.child!=="function"){if(m.is_api_type(n)){const r=a.lang_btypes().get(n).get_message(e.sort_field);if(r.is_not_found()){throw new o.OwnerError("Sorting on this type of thing is currently not supported")}return r.evaluate_without_cast(t)}else{throw new o.UnexpectedError("Trying to sort on a bad object",{value_id:n,sort_item:e,string_entry:String(t)})}}return t.child(e.sort_field).get()}else{return null}};function i(t){if(!t[0]){return(t,n)=>e.indexOf(t)-e.indexOf(n)}else{return s.make_sort_comparer(r(t[0]),t[0].descending,i(t.slice(1)))}}return e.sort(i(t))}};if(typeof Intl!=="undefined"&&((r=Intl)==null?void 0:r.Collator)!=null){i=new Intl.Collator("en-US")}else{i={compare(e,t){return String(e).localeCompare(t,"en-US")}}}const v=/[ &'.]/g;s.locale_compare=function(e,t){const n=i.compare(e.replace(v,""),t.replace(v,""));if(n!==0){return n}return i.compare(e,t)};s.make_sort_comparer=function(e,t,n){let r;if(t){r=-1}else{r=1}return function(t,i){const o=e(t);const a=e(i);let l=u.numberify(o);let c=u.numberify(a);if(typeof o===typeof a&&typeof l!==typeof c){l=o;c=a}if(typeof l!==typeof c){if(["undefined","object","function"].includes(typeof l)){return 1}if(["undefined","object","function"].includes(typeof c)){return-1}if(typeof l==="string"){return 1*r}if(typeof c==="string"){return-1*r}if(typeof l==="number"){return 1*r}if(typeof c==="number"){return-1*r}}else{if(l===c&&n){return n(t,i)}if(typeof l==="string"){return s.locale_compare(l,c)*r}if(typeof l==="number"){return(l-c)*r}if(typeof l==="boolean"){if(l){return r}else{return-r}}if(l instanceof Date&&c instanceof Date){if(l<c){return-1*r}else{return 1*r}}return 0}}};s.get_group_by_value_id=function(e,t,n){const r=a.lang_btypes().get(e);const i={};for(const[e,{message:n}]of t.entries()){const t=r.get_message(n);i["grouping"+String(e)]=[t.description(undefined,true),t.ret_btype_id()]}for(const[e,{fn:t,message:s}]of n.entries()){let n,o;if(s){const e=r.get_message(s);o=t+" of "+e.description(undefined,true);n=e.ret_btype_id()}else{o=t;n="number"}i["agg"+String(e)]=[o,n]}return"struct."+o.base64(JSON.stringify({caption:"Grouping",definition:i}))};s.calculate_sort_score=function(e,t){const n=[];for(const r of t!=null?t:[]){if(typeof r.sort_field==="string"){n.push(e==null?void 0:e[r.sort_field])}else{n.push(0)}}return n};s.is_less_than=function(e,t,n,r,i,o){var a;(a=o)!=null?a:o=false;if(o){return n[0]<i[0]}for(const[t,{descending:r}]of(e!=null?e:[]).entries()){if(n[t]===i[t]){continue}if(n[t]==null){return false}if(i[t]==null){return true}if(typeof n[t]==="string"){const e=s.locale_compare(n[t],i[t]);if(!r){return e<0}else{return e>0}}else{if(!r){return n[t]<i[t]}else{return n[t]>i[t]}}}return t<r};s.AGGREGATE_LOCAL_CHANGE={count(e,t,n,r,i){return i+(e?-1:1)},sum(e,t,n,r,i){var s,o;(s=n)!=null?s:n=0;(o=r)!=null?o:r=0;return i+r-n},product(e,t,n,r,i){var s,o;(s=n)!=null?s:n=1;(o=r)!=null?o:r=1;return i*r/n}};s.aggregate_started_key=(e,t,n)=>"CallAggregate_started_"+e+(t?"_"+t:"")+(n!=null&&n.should_approx?"_approximate":"")+(n!=null&&n.cacheable?"_cached":"");const b={email_equals:(e,t)=>e===t,email_contains_string:(e,t)=>e==null?void 0:e.includes(t)};s.local_constrain=function(e,t,n){if(e==null){return false}if(t.key===c.ADVANCED_SEARCH_CONSTRAINT){const r={datasources:{injected_value(){return e},injected_value_btype(){var r,i,s,o,a,l;const c=(r=t.self)!=null?r:e==null?void 0:(i=e._type)==null?void 0:i.call(e);if(c!=null&&c!==n){var u;_.debug("different value_id in injected datasource constraint",{self:t.self,obj_type:e==null?void 0:(u=e._type)==null?void 0:u.call(e),value_id:n})}return(s=(o=(a=t.self)!=null?a:e==null?void 0:(l=e._type)==null?void 0:l.call(e))!=null?o:n)!=null?s:"null"}},advanced_search:true};const[i]=p.evaluate(t.value,r,null,null);return i}else{let p;if(t.constraint_type in b){const n=e.child("authentication");const r=n.child("email").child("email").get();if(b[t.constraint_type](r,t.value))return true;for(const e of d.get_oauth_providers()){const r=n.child(e).child("email").get();if(b[t.constraint_type](r,t.value))return true}return false}else if(t.constraint_type==="or"){var r;if(!((r=t.opts)!=null&&r.length)){throw new o.UnexpectedError("assertion: or must have at least one sub",{c:t})}for(p of t.opts){if(s.local_constrain(e,p,n)){return true}}return false}else if(t.constraint_type==="and"){var i;if(!((i=t.opts)!=null&&i.length)){throw new o.UnexpectedError("assertion: and must have at least one sub",{c:t})}for(p of t.opts){if(!s.local_constrain(e,p,n)){return false}}return true}else{let r,i;if(t.key==="_id"&&typeof e._id==="function"){i=e._id()}else if(t.key===c.ALL_DB_FIELDS){i=o.json_stringify(e.raw())}else if(typeof e.child!=="function"){if(m.is_api_type(n)){r=a.lang_btypes().get(n).get_message(t.key);if(r.is_not_found()){throw new o.OwnerError("Filtering on this type of thing is currently not supported")}i=r.evaluate_without_cast(e);if(i instanceof f){i=i.all()}}else{return false}}else{let s;if(n){r=a.lang_btypes().get(n).get_message(t.key);s=r.is_lookup()}let o=null;if(typeof s==="string"){o=s}else if(s||!r){o=t.key}if(o&&r){var l,g;const n=(l=e.child(t.key).raw())!=null?l:null;const i=(g=r.evaluate_without_cast(e))!=null?g:null;if(n!==i&&r.ret_btype().option_set()){_.info("Local constrain value mismatch",{raw_val:n,msg_val:i,c:t,lookup_key:o})}}if(o){i=e.child(t.key).raw();if(h.is_json_class(i)){const t=h.from_json(e.db,i);if(t instanceof f){i=t.all()}else{_.error("JSON class value is not handled",i)}}}else{i=r.evaluate_without_cast(e,null,null,null,{constraint_messsage:t.key})}}const s=u.all_search_constraints[t.constraint_type];if(!s){throw new o.UnexpectedError("bad constraint type "+t.constraint_type)}return s(t.value,i)}}}},{"../../constants/db":58,"../../constants/special_keys":87,"../../lang/appquery":651,"../../lang/btype_ids":652,"../../lang/evaluation/evaluate":695,"../../logger":744,"../../u":823,"../constraint_defs":426,"../db_utils":428,"../hydrate":429,"../values/ListWrapper":467,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],459:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("./hydrate");function s(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(n+1%10===0){m.optional_pause()}if(e==="_id"){if(typeof(t==null?void 0:t._id)==="function"){return t._id()}else if(Array.isArray(t)){return t.map(((t,n)=>s(e,t,n)))}else{return t}}else{return i.dehydrate_tree(t)}}function o(e){var t;(t=e)!=null?t:e=[];if(typeof e.all==="function"){e=e.all()}return e.filter((e=>e!=null))}function a(e){return r[e.constraint_type](e.key,e.value,e.opts)}r.and=function(e,t,n){if(!Array.isArray(n)){return false}return{t:"A",a:n.map((e=>a(e)))}};r.and.no_field_required=true;r.or=function(e,t,n){if(!Array.isArray(n)){return false}return{t:"O",a:n.map((e=>a(e)))}};r.or.no_field_required=true;r.equals=function(e,t){if(t==null){return{t:"C",c:e,n:"is_empty"}}return{t:"C",c:e,n:"equals",v:s(e,t)}};r.equals_both=(e,t)=>({t:"F",n:"equals_both",a:{col1:e,col2:t}});r.not_equals=function(e,t){if(t==null){return{t:"C",c:e,n:"is_not_empty"}}return{t:"C",c:e,n:"not_equals",v:s(e,t)}};r["not true"]=e=>r.not_equals(e,true);r["not equal"]=r.not_equals;r.not_equals_both=(e,t)=>({t:"F",n:"not_equals_both",a:{col1:e,col2:t}});r.is_empty=e=>({t:"C",c:e,n:"is_empty"});r.is_not_empty=e=>({t:"C",c:e,n:"is_not_empty"});r.empty=r.is_empty;r["not empty"]=r.is_not_empty;r.is_true=e=>({t:"C",c:e,n:"equals",v:true});r.is_false=e=>({t:"C",c:e,n:"equals",v:false});r.contains=function(e,t){if(t==null){return false}return{t:"C",c:e,n:"contains",v:s(e,t)}};r.contains_both=(e,t)=>({t:"F",n:"contains_both",a:{col1:e,col2:t}});r.in=function(e,t){t=o(t);if(t.length===0){return false}return{t:"C",c:e,n:"in",v:s(e,t)}};r.not_contains=function(e,t){if(t==null){return null}return{t:"C",c:e,n:"not_contains",v:s(e,t)}};r["not contains"]=r.not_contains;r.not_contains_both=(e,t)=>({t:"F",n:"not_contains_both",a:{col1:e,col2:t}});r.not_in=function(e,t){t=o(t);if(t.length===0){return null}return{t:"C",c:e,n:"not_in",v:s(e,t)}};r["not in"]=r.not_in;r["greater than"]=function(e,t){if(t==null){return null}return{t:"C",c:e,n:"greater_than",v:t}};r.gte=function(e,t){if(t==null){return null}return{t:"C",c:e,n:"gte",v:t}};r["less than"]=function(e,t){if(t==null){return null}return{t:"C",c:e,n:"less_than",v:t}};r.lte=function(e,t){if(t==null){return null}return{t:"C",c:e,n:"lte",v:t}};r["text contains string"]=function(e,t){if(t==null){return null}return{t:"C",c:e,n:"contains_string",v:t}};r["not text contains string"]=function(e,t){if(t==null){return null}return{t:"C",c:e,n:"not_contains_string",v:t}};r["text contains"]=function(e,t){if(t==null){return null}return{t:"C",c:e,n:"contains",v:{language:c(),query:t}}};r["not text contains"]=function(e,t){if(t==null){return null}return{t:"C",c:e,n:"not_contains",v:{language:c(),query:t}}};r.contains_all_fields=function(e,t,n){let r;if(t==null){return null}if(n!=null&&n.no_language){r="simple"}else{r=c()}return{t:"C",c:"_all",n:"contains",v:{language:r,query:t}}};r.contains_all_fields.no_field_required=true;r.prefix_search=function(e,t,n){let r;if(t==null){return null}if(n!=null&&n.no_language){r="simple"}else{r=c()}return{t:"C",c:e,n:"prefix",v:{language:r,query:t}}};r.match_phrase_prefix=r.prefix_search;const l={miles:1609.344,kms:1e3,km:1e3};r.geographic_search=function(e,t){if(t==null){return null}const{range:n,unit:r,origin_address:i}=t!=null?t:{};if(i==null||!f.ensure_valid_location(i)){return null}const s=i.lng;const{lat:o}=i;const a=l[r!=null?r:"miles"]*(n!=null?n:1);return{t:"C",c:e,n:"within",v:{lon:s,lat:o,meters:a}}};r.email_prefix_search=function(e,t){if(t==null||typeof t!=="string"){return false}const n={t:"O",a:[]};n.a.push(r.prefix_search("authentication.email.email",t.toLowerCase()));for(const e of h.get_oauth_providers()){n.a.push(r.prefix_search("authentication."+e+".email",t.toLowerCase()))}return n};r.email_prefix_search.no_field_required=true;r.email_equals=function(e,t){if(t==null||typeof t!=="string"){return false}const n={t:"O",a:[]};n.a.push(r.equals("authentication.email.email",t.toLowerCase()));for(const e of h.get_oauth_providers()){n.a.push(r.equals("authentication."+e+".email",t.toLowerCase()))}return n};r.email_equals.no_field_required=true;r.email_contains_string=function(e,t){if(t==null||typeof t!=="string")return false;const n="authentication.email.email";const i=h.get_oauth_providers().map((e=>`authentication.${e}.email`));return{t:"O",a:[n,...i].map((e=>r["text contains string"](e,t.toLowerCase())))}};r.email_contains_string.no_field_required=true;function c(){const e=g().app_language();if(u[e]){return u[e]}if(d.includes(e)){return e}return"simple"}const u={da_dk:"danish",nl_nl:"dutch",en_us:"english",fi_fi:"finnish",fr_fr:"french",de_de:"german",hu_hu:"hungarian",it_it:"italian",no_no:"norwegian",pt_br:"portuguese",ro_ro:"romanian",ru_ru:"russian",es_es:"spanish",sv_se:"swedish",tr_tr:"turkish"};const d=Object.values(u);const p=["range_contains","range_greater_than","range_less_than"];const _=["range_contains","range_contained_by","range_overlaps","range_greater_than","range_less_than"];_.forEach((e=>{function t(e){r[e]=function(t,n){if(n==null){return false}return{t:"C",c:t,n:e,v:n}};if(p.includes(e)){r[e+"_point"]=r[e]}}t(e)}));const f=e("./../geolocation/b_location");const h=e("./../lang/appquery");const m=e("../u/shared/async/b_fiber");const g=e("./../lib")},{"../u/shared/async/b_fiber":833,"./../geolocation/b_location":621,"./../lang/appquery":651,"./../lib":741,"./hydrate":429,"core-js/modules/web.dom-collections.iterator.js":1123}],460:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../u/shared/mode_check");const s=e("./hydrate");const o=e("../constants/db");const a=e("../constants/special_keys");const l=e("./../lang/btypes");const c=e("./../geolocation/b_location");const u=100;const d=3;r.sort_constraints=function(e){e.sort(((e,t)=>{var n,i;const o=r.can_execute_in_memory(e);const a=r.can_execute_in_memory(t);if(o!==a){if(o){return 1}else{return-1}}const l=String(e.key)+e.constraint_type+JSON.stringify(s.dehydrate_tree((n=e.value)!=null?n:null));const c=String(t.key)+t.constraint_type+JSON.stringify(s.dehydrate_tree((i=t.value)!=null?i:null));if(l<c){return-1}else if(c<l){return 1}else{return 0}}));return e};const p={equals:true,"not equal":true,is_empty:true,is_not_empty:true,in:true,"not in":true,contains:true,"not contains":true,empty:true,"not empty":true,"greater than":true,gte:true,"less than":true,lte:true,"not true":true};r.can_execute_in_memory=function(e){if(e.key===a.ADVANCED_SEARCH_CONSTRAINT){return true}if(["or","and"].includes(e.constraint_type)){for(const t of e.opts){if(!r.can_execute_in_memory(t)){return false}}return true}return p[e.constraint_type]};r.use_geographic_sorting=function(e,t){for(const n of t!=null?t:[]){if(n.sort_field==null||typeof n.sort_field!=="object"){continue}const t=l.get(e).get_message(n.sort_field.location_field);if(!t||t.ret_btype().id()!=="geographic_address"){continue}if(c.ensure_valid_location(n.sort_field.geo_reference,true)){return true}}return false};const _=[];r.add_bad_in_memory_sort=e=>_.push(e);r.can_sort_locally=function(e,t,n){if(r.use_geographic_sorting(e,t)){return false}for(const e of t!=null?t:[]){if(e.sort_field===a.RANDOM_SORTING){return false}}if(_.length>0){const r=JSON.stringify({type:e,sorts_list:t,constraints:n});for(const e of _){if(e===r){return false}}}return true};r.QueryPlanner=class e{constructor(){this.root={}}update(e,t,n,i,s){var o,a;r.sort_constraints(t);let l=(a=(o=this.root)[e])!=null?a:o[e]={type:e,constraints:[]};for(let n=0;n<t.length;n++){var c,u,d,p,_;const r=t[n];(u=(c=l).children)!=null?u:c.children={};l=(_=(d=l.children)[p=JSON.stringify(r)])!=null?_:d[p]={type:e,constraints:t.slice(0,+n+1||undefined)}}if(n!=null){var f,h,m,g,v;(h=(f=l).searches)!=null?h:f.searches={};l=(v=(m=l.searches)[g=JSON.stringify(n)])!=null?v:m[g]={type:e,constraints:t,sorts_list:n}}if(i.from!=null){var b,y,w,x,j;(y=(b=l).from)!=null?y:b.from=l.loaded;(x=(w=l).has_gaps)!=null?x:w.has_gaps=l.loaded!=null&&(i.from>l.loaded+1||l.from>i.loaded+1);l.from=Math.min((j=l.from)!=null?j:Infinity,i.from)}for(const e in i){const t=i[e];if(e!=="from"){if(!s||l[e]==null||t>l[e]){l[e]=t}}}}get_stats(e,t,n){r.sort_constraints(t);let i=this.root[e];if(i==null){return null}for(let e=0;e<t.length;e++){var s;const n=t[e];if(!((s=i.children)!=null&&s[JSON.stringify(n)])){return null}i=i.children[JSON.stringify(n)]}if(n!=null){var o,a;if(!((o=i.searches)!=null&&o[JSON.stringify(n)])){return null}return(a=i.searches)==null?void 0:a[JSON.stringify(n)]}else{return i}}node_to_search(e,t){var n;return{t:"CallSearch",type:e.type,constraints:e.constraints,sorts_list:(n=e.sorts_list)!=null?n:t}}pick_search(e,t,n,s){r.sort_constraints(t);const a=!r.can_sort_locally(e,n,t);const l=JSON.stringify(n);const c=(e,n,p)=>{let _,f;const h=()=>p.concat(t.slice(n));if(t[n]&&!r.can_execute_in_memory(t[n])){_=false}else{_=true}if(e.length!=null&&e.length<u&&_){if(!e.searches){return[e,h(),true]}if(e.searches[l]){return[e.searches[l],h(),true]}if(!a){for(const t in e.searches){return[e.searches[t],h(),true]}}}if(e.children&&t.length>n){let i=null;for(let s=n;s<t.length;++s){if(e.children[JSON.stringify(t[s])]){const o=e.children[JSON.stringify(t[s])];const a=s+1;const l=p.concat(t.slice(n,s));let u=false;for(const e of l){if(!r.can_execute_in_memory(e)){u=true;break}}if(u){break}const d=c(o,a,l);if(d!=null){if(d[2]){return d}if(i==null||d[1].length<i[1].length){i=d}}}}if(i!=null){return i}}if(e.searches&&_){for(const t in e.searches){var m,g;f=e.searches[t];if(a&&t!==l){continue}let{loading_to:n}=f;if(e.length!=null&&e.length<f.loading_to){n=e.length}const r=n-((m=f.loaded)!=null?m:0);if(r/o.MAX_SEARCH_CHUNK>d){continue}if(e.length==null&&i.on_client()){if(s!=null&&s<u){continue}if(f.loaded<u){return[f,h(),false]}else{continue}}const c=e.length-((g=f.loaded)!=null?g:0);if(s!=null&&c>1.5*s){continue}if(f.loading_to>e.length*.5&&c<d*o.MAX_SEARCH_CHUNK){return[f,h(),false]}if(c<2*u){return[f,h(),false]}}}return null};const p=this.root[e]?c(this.root[e],0,[]):null;let _,f;if(p!=null){let e;[e,_]=p;f=this.node_to_search(e,n)}else{_=[];f={t:"CallSearch",type:e,constraints:t,sorts_list:n}}return{search:f,leftover:_}}}},{"../constants/db":58,"../constants/special_keys":87,"../u/shared/mode_check":851,"./../geolocation/b_location":621,"./../lang/btypes":653,"./hydrate":429,"core-js/modules/web.dom-collections.iterator.js":1123}],461:[function(e,t,n){"use strict";const r=n;const i=e("./hydrate");e("../lang/appquery");const s=e("./../lang/btypes");r.SampleNode=class e{constructor(e,t,n){var r,i;this.object=e;this.name=t;this.value=n;(r=this.value)!=null?r:this.value=(i=this.object.value.get_message(this.name))==null?void 0:i.ret_btype()}get(){var e;return(e=this.value)==null?void 0:e.get_sample()}raw(){var e;return(e=this.value)==null?void 0:e.get_sample()}set(){}push(){}remove(){}dehydrate(){return i.dehydrate_prefix("SampleNode")+this.value.id()}static rehydrate(t,n){return new e(null,null,s.get(n))}};r.SampleList=class e{constructor(e){const t=s.get(e);return new o([t==null?void 0:t.get_sample(),t==null?void 0:t.get_sample()],null,e)}static rehydrate(t,n){return new e(n)}};r.SampleObject=class e{constructor(e){try{this.value=s.get(e)}catch(e){this.value=s.get("null")}this.id=e}child(e){return new r.SampleNode(this,e)}dehydrate(){return i.dehydrate_prefix("SampleObject")+this.value.id()}_id(){return"sample:"+this.id}_type(){return this.value.id()}is_equal_to(e){var t;return(e==null?void 0:(t=e.dehydrate)==null?void 0:t.call(e))===this.dehydrate()}precache(){}exists(){return false}ignore_privacy(){return this}static rehydrate(t,n){return new e(n)}};const o=e("./values/StaticList")},{"../lang/appquery":651,"./../lang/btypes":653,"./hydrate":429,"./values/StaticList":471}],462:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../client_config");const i=e("../../logger");const s=e("../../u");const o=e("../../geolocation/b_location");const a=e("../../geolocation/shared/b_location_utils");const l=e("../hydrate");const c=e("./NodeBase");class u extends c{_operate(e,t){const n=this.parent_id();this.db._ensure_loading(n);e=l.dehydrate_tree_to_db_primitive(e);return t(n,e,this._extract(this.db._get_data(n)))}set(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this._operate(e,((e,t,n)=>this.db._set_local(e,this._path,t)))}push(e){return this._operate(e,((e,t,n)=>{const o=(n!=null?n:[]).slice();function c(){if(Array.isArray(t)||a.is_b_location(t)){for(const e of o){if(s.json_stringify(e)===s.json_stringify(t)){return true}}}return false}if(!Array.isArray(o)){i.error("path is not array",{firebase:this.firebase,new_value:o})}else if(l.dehydrated_array_index_of(o,t)===-1&&!c()){o.push(t);if(r.MAX_LIST_LENGTH&&o.length>r.MAX_LIST_LENGTH){throw new s.OwnerError("List at maximum length ("+r.MAX_LIST_LENGTH+")")}this.set(o)}}))}remove(e){return this._operate(e,((e,t,n)=>{var r;let c,u;(r=n)!=null?r:n=[];if(!Array.isArray(n)){i.error("path is not array",{firebase:this.firebase,cur_value:n})}else if((c=l.dehydrated_array_index_of(n,t))>-1){u=n.slice();u.splice(c,1);return this.set(u)}else if(Array.isArray(t)||a.is_b_location(t)){u=[];if(a.is_b_location(t)){for(const e of n){if(!o.is_equal(e,t)){u.push(e)}}}else if(n.map(s.json_stringify).includes(s.json_stringify(t))){for(const e of n){if(s.json_stringify(e)!==s.json_stringify(t)){u.push(e)}}}this.set(u)}}))}raw(){const e=this.parent_id();this.db._ensure_loading(e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}s.ensure_ready(this.db._get_ready_key(e),...n);this.db._register_dependency(e);return this._extract(this.db._get_data(e))}dehydrate(){return l.dehydrate_prefix("ClientDBNode")+this.key()}precache(){const e=this.parent_id();return this.db._ensure_loading(e)}}u.rehydrate=(e,t)=>e.get_node(t);t.exports=u},{"../../client_config":41,"../../geolocation/b_location":621,"../../geolocation/shared/b_location_utils":626,"../../logger":744,"../../u":823,"../hydrate":429,"./NodeBase":468,"core-js/modules/web.dom-collections.iterator.js":1123}],463:[function(e,t,n){"use strict";const r=e("../db");const i=e("../db_utils");const s=e("./ClientDBNode");class o extends s{constructor(e,t){super(undefined,undefined,t);this.id=e}ignore_privacy(){return this}delete(){this.db._delete_local(this.id)}is_equal_to(e){if(!(e instanceof o)){return false}if(this.db!==e.db){return false}return this.id===e.id}}(function(){for(const e in i.ObjectBase){const t=i.ObjectBase[e];o.prototype[e]=t}})();t.exports=r.ClientDBObject=o},{"../db":427,"../db_utils":428,"./ClientDBNode":462}],464:[function(e,t,n){"use strict";const r=e("../hydrate");const i=e("../db_utils");const s=e("./ListWrapper");class o extends s{constructor(e){var t,n;const r=e.all().filter((e=>e!==null));const s=(t=(n=r[0])==null?void 0:n.db)!=null?t:a().db_instance();if(r.length===0){r.push(s.static_list(i.lang_btypes().get(e.get_item_btype_id()).inner().id()))}const o=r.map((e=>e.query));super(s,{t:"Concat",prevs:o})}}o.rehydrate=(e,t)=>new o(r.rehydrate(e,t));t.exports=o;const a=e("../../lib")},{"../../lib":741,"../db_utils":428,"../hydrate":429,"./ListWrapper":467}],465:[function(e,t,n){"use strict";class r{}t.exports=r},{}],466:[function(e,t,n){"use strict";const r=e("../hydrate");const i=e("../db_utils");const s=e("./ListWrapper");class o extends s{constructor(e){var t,n;const r=e.all().filter((e=>e!==null));const s=(t=(n=r[0])==null?void 0:n.db)!=null?t:a().db_instance();if(r.length===0){r.push(s.static_list(i.lang_btypes().get(e.get_item_btype_id()).inner().id()))}const o=r.map((e=>e.query));super(s,{t:"Intersect",prevs:o})}}o.rehydrate=(e,t)=>new o(r.rehydrate(e,t));t.exports=o;const a=e("../../lib")},{"../../lib":741,"../db_utils":428,"../hydrate":429,"./ListWrapper":467}],467:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("fast-deep-equal");const i=e("../../u");const s=e("./Dynamic");const o=e("../db_utils");const a=e("../../lang/btype_ids");const l=e("../../constants/db");const c=e("../../constants/special_keys");const u=e("./value_types");const d=e("./registry");const p=e("../../lang/evaluation/eval_node_state");class _ extends s{constructor(e,t){super();this.db=e;this.query=t;if(!this.db){throw new i.UnexpectedError("missing db")}if(!this.query){throw new i.UnexpectedError("missing query")}const n=p.get_current_eval_node();if(n){this._creation_eval_node=n}return this}_with_eval_node(e){if(p.get_current_eval_node()||!i.on_client()||!this._creation_eval_node){return e()}try{p.set_current_eval_node(this._creation_eval_node);return e()}finally{p.set_current_eval_node(null)}}get_children(e,t){if(t<1){return[]}if(e+t>l.ALL_MAX){t=l.ALL_MAX-e}const n=this._with_eval_node((()=>this.db.execute_with_dependency(this.query,e,t)));return this.db.array_to_objects(this.query,n)}all_ids(){const e=0;const t=l.ALL_MAX;const n={t:"Columns",columns:["_id"],prev:this.query};return this._with_eval_node((()=>this.db.execute_with_dependency(n,e,t)))}get_plan(e,t){return this.db.build_query_plan(this.query,e,t)}length(e){const t={t:"Length",prev:this.query,options:e};return this._with_eval_node((()=>this.db.execute_with_dependency(t,0,1)[0]))}length_or_zero(){var e;return(e=this.length())!=null?e:0}get_item_btype_id(){return this.db.get_plan_ret_btype(this.query)}filter(e,t){e=f().bv().resolve_constraints(e,t);e=m.dehydrate_tree(e);if(e.length===0){return this}for(const t of e){if(t.constraint_type==="return_empty_set"){return f().db_instance().static_list(this.get_item_btype_id(),[])}}const n={t:"Filter",constraints:e,prev:this.query};return new _(this.db,n)}minus_list(e){let t;const n=o.lang_btypes().get(this.get_item_btype_id());if(n.custom_type()){const n=[];for(const t of e.all()){if(t!=null){n.push(t._id())}}t={key:c.UNIQUE_ID,constraint_type:"not in",value:n}}else{const r="is_not_contained_by_list";if(n.get_message(r).is_not_found()){throw new i.UnexpectedError(`minus_list called on a value that doesn't have ${r}: ${n.id()}`)}t={key:c.ADVANCED_SEARCH_CONSTRAINT,self:this.get_item_btype_id(),value:{"%x":"InjectedValue","%n":{"%x":"Message","%nm":r,"%a":h.create_reduced(e,a.list_type(n.id()))}}}}return this.filter([t])}with_extra_fields(e){if(!e||e.length===0){return this}const t={t:"ExtraFields",extra_field_names:e,prev:this.query};return this._with_eval_node((()=>new _(this.db,t)))}sort(e){e=o.resolve_sorts(e,false);if(e.length===0){return this}const t={t:"Sort",sorts_list:e,prev:this.query};return new _(this.db,t)}sort_on_id(){return this.sort([{sort_field:"_id"}])}capped(e){const t={t:"Cap",max:e,prev:this.query};return new _(this.db,t)}offset(e){const t={t:"Offset",offset:e,prev:this.query};return new _(this.db,t)}to_json(){return{_class:"ListWrapper",query:this.query}}dehydrate(){return m.dehydrate_prefix("ListWrapper")+i.incremental_json_stringify(this.query)}get(){return this}all(){return this.get_children(0,l.ALL_MAX)}make_static(){return this.db.static_list(this.get_item_btype_id(),this.all())}contains(e,t){const n={t:"Contains",prev:this.query,value_id:t.id(),item:m.dehydrate_tree(e)};return this._with_eval_node((()=>this.db.execute_with_dependency(n,0,1)[0]))}position(e,t){const n={t:"Position",prev:this.query,value_id:t.id(),item:m.dehydrate_tree(e)};return this._with_eval_node((()=>this.db.execute_with_dependency(n,0,1)[0]))}_length_compare(e,t,n){const r={t:"Length",prev:this.query,options:n};const i={t:"Compare",op:e,prev:r,n:t};return this._with_eval_node((()=>this.db.execute_with_dependency(i,0,1)[0]))}length_greater_than(e,t){return this._length_compare(">",e,t)}length_greater_or_equal_than(e,t){return this._length_compare(">=",e,t)}length_less_than(e,t){return this._length_compare("<",e,t)}length_less_or_equal_than(e,t){return this._length_compare("<=",e,t)}length_equals(e,t){return this._length_compare("===",e,t)}length_not_equals(e,t){return this._length_compare("!==",e,t)}_numeric_op(e,t){const n=this.get_item_btype_id();if(n!=="number"){return null}const r={t:"Numeric",prev:this.query,op:e,options:t};return this._with_eval_node((()=>this.db.execute_with_dependency(r,0,1)[0]))}_date_op(e,t){const n=this.get_item_btype_id();if(n!=="date"){return null}const r={t:"Numeric",prev:this.query,op:e,options:t};return this._with_eval_node((()=>new Date(this.db.execute_with_dependency(r,0,1)[0])))}sum(e){return this._numeric_op("sum",e)}product(e){return this._numeric_op("product",e)}average(e){var t;return(t=this._numeric_op("average",e))!=null?t:this._date_op("average",e)}median(e){var t;return(t=this._numeric_op("median",e))!=null?t:this._date_op("median",e)}min(e){var t;return(t=this._numeric_op("min",e))!=null?t:this._date_op("min",e)}max(e){var t;return(t=this._numeric_op("max",e))!=null?t:this._date_op("max",e)}flatten(){const e={t:"Flatten",prev:this.query};return new _(this.db,e)}list_cast(e){if(e===this.get_item_btype_id()){return this}return new _(this.db,{t:"Cast",prev:this.query,value_id:e})}group_by(e){let{groupings:t,aggregations:n}=e;const r=this.get_item_btype_id();function s(e){e=i.extend({},e);if(e.start!=null){e.start=e.start.valueOf()}if(e.end!=null){e.end=e.end.valueOf()}return e}t=t.map((e=>s(e)));for(const{message:e,fn:n,timezone_string:s}of t){if(!o.can_group_on(r).includes(e)){throw new i.UnexpectedError("bad grouping message",{fn:n,value_id:r,message:e})}if(n!=null&&!o.can_group_with(r,e).includes(n)){throw new i.UnexpectedError("bad grouping function",{fn:n,value_id:r,message:e})}if(l.CALENDAR_GROUPINGS.includes(n)&&s==null){throw new i.UnexpectedError("grouping fn "+n+" requires a timezone string")}}for(const{fn:e,message:t}of n){if(!l.SUPPORTED_AGGREGATIONS.includes(e)){throw new i.UnexpectedError("bad aggregation function: "+e)}if(t!=null&&!o.can_aggregate_on(e,r).includes(t)){throw new i.UnexpectedError("bad aggregation message",{fn:e,value_id:r,message:t})}}const a={t:"GroupBy",groupings:t,aggregations:n,prev:this.query};return this._with_eval_node((()=>new _(this.db,a)))}is_equal_to(e){if(!d.is(e,u.LIST_WRAPPER)){return false}if(this.db!==e.db||this._creation_eval_node!==e._creation_eval_node){return false}return r(this.query,e.query)}}_.from_json=(e,t)=>{let{query:n}=t;return new _(e,n)};_.rehydrate=function(e,t){const n=i.incremental_json_parse(t);return new _(e,n)};t.exports=_;const f=e("../../lib");const h=e("../../lang/expressions/expression_utils");const m=e("../hydrate")},{"../../constants/db":58,"../../constants/special_keys":87,"../../lang/btype_ids":652,"../../lang/evaluation/eval_node_state":694,"../../lang/expressions/expression_utils":710,"../../lib":741,"../../u":823,"../db_utils":428,"../hydrate":429,"./Dynamic":465,"./registry":478,"./value_types":479,"core-js/modules/web.dom-collections.iterator.js":1123,"fast-deep-equal":1190}],468:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./Dynamic");const i=e("./StaticNode");const s=e("./ListWrapper");class o extends r{constructor(e,t,n){super();this.parent=e;this._path=t;this.db=n}path(){return this._path.join(".")}toString(){return"DBNode<"+this.key()+">"}key(){return this.parent_id()+"."+this._path.join(".")}child(e){let t;if(!this.parent){return new i(undefined)}if(this._path){t=this._path.concat(e.split("."))}return this.parent._child(t)}parent_id(){return this.parent._id()}get(e){const t=this.raw();if(!e){var n,r,i,o;const t=(n=(r=this.parent)._type)==null?void 0:n.call(r);const s=this._path.join(".");e=(i=a.lang_btypes().get(t))==null?void 0:(o=i.get_message(s))==null?void 0:o.ret_btype_id()}if(Array.isArray(t)){if(typeof e==="string"){e=a.lang_btypes().get(e).inner_including_ranges().id()}return new s(this.db,{t:"NodeList",type:e,id:this.parent_id(),field:this._path.join(".")})}if(t&&typeof t==="object"){if(a._is_geographic_object(t,e)){return t}return this}const c=l.rehydrate(this.db,t,e);return c}_extract(e){for(const i of(t=this._path)!=null?t:[]){var t,n,r;e=(n=(r=e)==null?void 0:r[i])!=null?n:null}return e}}t.exports=o;const a=e("../db_utils");const l=e("../hydrate")},{"../db_utils":428,"../hydrate":429,"./Dynamic":465,"./ListWrapper":467,"./StaticNode":472,"core-js/modules/web.dom-collections.iterator.js":1123}],469:[function(e,t,n){"use strict";const r=e("./ListWrapper");class i extends r{constructor(e){const t=e.parent_id();const n=e._path.join(".");super(e.db,{t:"NodeList",id:t,field:n})}}i.rehydrate=(e,t)=>new i(e.get_node(t));t.exports=i},{"./ListWrapper":467}],470:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../hydrate");const s=e("./ListWrapper");class o extends s{constructor(e,t){const{sorts_list:n}=t;const r=e.query;const i=e.db;super(i,{t:"Sort",sorts_list:n,prev:r})}}o.rehydrate=function(e,t){const{source_list:n,properties:s}=r.incremental_json_parse(t);return new o(i.rehydrate(e,n),s)};t.exports=o},{"../../u":823,"../hydrate":429,"./ListWrapper":467}],471:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../u/shared/async/b_fiber");const s=e("../../logger");const o=e("../../lang/btype_ids");const a=e("./ListWrapper");const l=false;class c extends a{constructor(e,t,n){var o;(o=t)!=null?o:t=u().db_instance();if(n==null){var a;if(!l){s.error("StaticList created without value_id")}for(const t of e){if(t==null){i.optional_pause();continue}n=c.guess_value_id(t);if(!n){throw new r.UnexpectedError("could not guess value_id",{dehydrated:d.dehydrate_tree(e)})}break}(a=n)!=null?a:n="null"}super(t,{t:"Static",data:p.array_to_ids(n,e),value_id:n})}}c.rehydrate=function(e,t){const{value_id:n,data:r}=d._rehydrate_value_id_data(e,t);return new c(r,e,n)};c.guess_value_id=function(e){if(e==null){return null}else if(typeof e==="string"){return"text"}else if(typeof e==="number"){return"number"}else if(typeof e._type==="function"){return e._type()}else if(typeof e==="boolean"){return"sys.bool"}else if(e instanceof a){return o.list_type(e.get_item_btype_id())}else{return null}};t.exports=c;const u=e("../../lib");const d=e("../hydrate");const p=e("../db_utils")},{"../../lang/btype_ids":652,"../../lib":741,"../../logger":744,"../../u":823,"../../u/shared/async/b_fiber":833,"../db_utils":428,"../hydrate":429,"./ListWrapper":467,"core-js/modules/web.dom-collections.iterator.js":1123}],472:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("./Dynamic");const s=e("../db_utils");const o=e("./value_types");const a=e("./registry");const l=e("../../logger");class c extends i{constructor(e,t,n){var r;super();this.data=e;this.db=t;this.value_id=n;(r=this.db)!=null?r:this.db=d().db_instance()}get_data(){return this.data}set(){return l.debug("SETTING TO A STATIC NODE... IGNORING THIS")}push(){return l.debug("PUSHING TO A STATIC NODE.... IGNORING THIS")}raw(){if(a.is(this.data,o.LIST_WRAPPER)){return this.data.get_children()}return this.data}_type(){return this.value_id}child(e){let t,n;const r=this.get_data();const i=String(e).split(".");if(i.length>1&&typeof r[i[0]]==="object"){t=r;for(const e of i){var o;t=(o=t)==null?void 0:o[e]}}else{t=r==null?void 0:r[e]}if(this.value_id!=null){if(this.value_id==="user"&&e==="authentication"||e.indexOf("authentication.")===0){n="sys.json"}else if(this.value_id==="user"&&e==="user_signed_up"){n="boolean"}else if(this.value_id==="user"&&e==="StripeCustomerID"){n="text"}else if(this.value_id==="sys.json"){n="sys.json"}else{var a,u;n=(a=s.lang_btypes().get(this.value_id))==null?void 0:(u=a.get_message(e))==null?void 0:u.ret_btype_id();if(n==="null"){n=null}if(!n){l.owner_error("Could not find StaticNode child value id",{display:`Cannot evaluate the child ${e} on type ${this.value_id} because it does not exist`,ours:this.value_id,name:e})}}}else{n=null}return new c(t,this.db,n)}get(){return s._static_get(this.get_data(),this.db,this.value_id)}to_json(){var e;(e=this._json_cache)!=null?e:this._json_cache=this.compute_to_json();return this._json_cache}compute_to_json(){return{_class:"StaticNode",data:p.dehydrate_tree(this.data),value_id:this.value_id}}dehydrate(){var e,t,n,i;const s=p._dehydrate_value_id_data(this.data,this.value_id);const o=r.incremental_json_stringify({data:p.dehydrate_tree(this.data),value_id:this.value_id});(t=(e=this.db).__StaticNode_rehydrate_cache)!=null?t:e.__StaticNode_rehydrate_cache={};(i=(n=this.db.__StaticNode_rehydrate_cache)[o])!=null?i:n[o]=this;return p.dehydrate_prefix("StaticNode")+s}}function u(e,t){var n,i,s;let{data:o,value_id:a}=t;const l=r.incremental_json_stringify({data:p.dehydrate_tree(o),value_id:a});(n=e.__StaticNode_rehydrate_cache)!=null?n:e.__StaticNode_rehydrate_cache={};(s=(i=e.__StaticNode_rehydrate_cache)[l])!=null?s:i[l]=new c(o,e,a);return e.__StaticNode_rehydrate_cache[l]}c.from_json=(e,t)=>{let{data:n,value_id:r}=t;return new c(n,e,r)};c.rehydrate=function(e,t){const{value_id:n,data:r}=p._rehydrate_value_id_data(e,t);return u(e,{data:r,value_id:n})};t.exports=c;const d=e("../../lib");const p=e("../hydrate")},{"../../lib":741,"../../logger":744,"../../u":823,"../db_utils":428,"../hydrate":429,"./Dynamic":465,"./registry":478,"./value_types":479,"core-js/modules/web.dom-collections.iterator.js":1123}],473:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../db_utils");const s=e("./StaticNode");const o=e("../../safe_require");o.safe_register("./db/values/StaticObject",t.exports);class a extends s{constructor(e,t,n,r,i,s){var o;(o=s)!=null?o:s={};super(e,t,n);this._exists=r;this._bubble_id=i;this.allow_email=s.allow_email}_id(){var e;if(this._bubble_id!=null){return this._bubble_id}const t=this.get_data();if(t!=null&&t._id){if(typeof t._id==="function"){return t._id()}else{return t._id}}(e=this.__id)!=null?e:this.__id=r.incremental_digest(this.to_json());return this.__id}get(){return this}ignore_privacy(){if(this.db.ignore_privacy_rules){return this}else{return c.extend({ignore_privacy_rules:true},(()=>new a(this.data,c().db_instance(),this.value_id)))}}exists(){var e;return(e=this._exists)!=null?e:false}delete(){}poll(){}is_equal_to(e){if(typeof(e==null?void 0:e._id)!=="function"){return false}return e._id()===this._id()}get_email(){if(this.allow_email){return i.email_getter(this)}return undefined}is_logged_in(){return undefined}to_json(){var e;(e=this._json_cache)!=null?e:this._json_cache=this.compute_to_json();return this._json_cache}compute_to_json(){return{_class:"StaticObject",data:u.dehydrate_tree(this.data),value_id:this.value_id}}dehydrate(){var e,t,n,i;const s=u._dehydrate_value_id_data(this.data,this.value_id);const o=r.incremental_json_stringify({data:u.dehydrate_tree(this.data),value_id:this.value_id});(t=(e=this.db).__StaticObject_rehydrate_cache)!=null?t:e.__StaticObject_rehydrate_cache={};(i=(n=this.db.__StaticObject_rehydrate_cache)[o])!=null?i:n[o]=this;return u.dehydrate_prefix("StaticObject")+s}}function l(e,t){var n,i,s;let{data:o,value_id:l}=t;const c=r.incremental_json_stringify({data:u.dehydrate_tree(o),value_id:l});(n=e.__StaticObject_rehydrate_cache)!=null?n:e.__StaticObject_rehydrate_cache={};(s=(i=e.__StaticObject_rehydrate_cache)[c])!=null?s:i[c]=new a(o,e,l);return e.__StaticObject_rehydrate_cache[c]}a.from_json=(e,t)=>{let{data:n,value_id:r}=t;return new a(n,e,r)};a.rehydrate=function(e,t){const{value_id:n,data:r}=u._rehydrate_value_id_data(e,t);return l(e,{data:r,value_id:n})};t.exports=a;const c=e("../../lib");const u=e("../hydrate")},{"../../lib":741,"../../safe_require":777,"../../u":823,"../db_utils":428,"../hydrate":429,"./StaticNode":472}],474:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../hydrate");const s=e("./ListWrapper");class o extends s{constructor(e,t){let{value_id:n,message:r,properties:s,_raw:o,arg:a}=t;const l=e.query;const c=e.db;s=i.dehydrate_tree(s);super(c,{t:"Transform",prev:l,value_id:n,message:r,properties:s,_raw:o,arg:a})}}o.rehydrate=function(e,t){const{source_list:n,transform_data:s}=r.incremental_json_parse(t);return new o(i.rehydrate(e,n),s)};t.exports=o},{"../../u":823,"../hydrate":429,"./ListWrapper":467}],475:[function(e,t,n){"use strict";const r=e("../hydrate");const i=e("./ListWrapper");class s extends i{constructor(e){const t=e.query;const n=e.db;super(n,{t:"Unique",prev:t})}}s.rehydrate=(e,t)=>new s(r.rehydrate(e,t));t.exports=s},{"../hydrate":429,"./ListWrapper":467}],476:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../safe_require");i.safe_register("./db/values/db_values",r);r.registry=e("./registry");const s=e("./value_types");Object.entries(s).forEach((e=>{let[t,n]=e;return r[t]=n}))},{"../../safe_require":777,"./registry":478,"./value_types":479,"core-js/modules/web.dom-collections.iterator.js":1123}],477:[function(e,t,n){"use strict";const r=n;const i=e("./registry");const s=e("./value_types");const o=e("../db");const a=e("./Dynamic");const l=e("./StaticNode");const c=e("./StaticObject");const u=e("./ListWrapper");const d=e("./NodeBase");const p=e("./StaticList");const _=e("./TransformList");const f=e("./ConcatList");const h=e("./IntersectList");const m=e("./UniqueList");const g=e("./SortedList");const v=e("./NodeList");const b=e("./ClientDBNode");o.ClientDBNode=b;const y=e("./ClientDBObject");r.register_values=function(){i.add(s.DYNAMIC,a);i.add(s.LIST_WRAPPER,u);i.add(s.NODE_BASE,d);i.add(s.STATIC_NODE,l);i.add(s.STATIC_OBJECT,c);i.add(s.STATIC_LIST,p);i.add(s.TRANSFORM_LIST,_);i.add(s.CONCAT_LIST,f);i.add(s.INTERSECT_LIST,h);i.add(s.UNIQUE_LIST,m);i.add(s.SORTED_LIST,g);i.add(s.NODE_LIST,v);i.add(s.CLIENT_DB_NODE,b);i.add(s.CLIENT_DB_OBJECT,y)}},{"../db":427,"./ClientDBNode":462,"./ClientDBObject":463,"./ConcatList":464,"./Dynamic":465,"./IntersectList":466,"./ListWrapper":467,"./NodeBase":468,"./NodeList":469,"./SortedList":470,"./StaticList":471,"./StaticNode":472,"./StaticObject":473,"./TransformList":474,"./UniqueList":475,"./registry":478,"./value_types":479}],478:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../u/shared/errors");const s={};r.add=function(e,t){s[e]=t};r.has=function(e){return e in s};r.get=function(e){if(!s[e]){throw new i.UnexpectedError("Unknown db value type",{name:e})}return s[e]};r.is=function(e,t){return e instanceof s[t]};r.list=()=>Object.keys(s);r.create=function(e){const t=r.get(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++){i[s-1]=arguments[s]}return new t(...i)}},{"../../u/shared/errors":846,"core-js/modules/web.dom-collections.iterator.js":1123}],479:[function(e,t,n){"use strict";var r=function(e){e["DYNAMIC"]="Dynamic";e["LIST_WRAPPER"]="ListWrapper";e["NODE_BASE"]="NodeBase";e["STATIC_NODE"]="StaticNode";e["STATIC_OBJECT"]="StaticObject";e["STATIC_LIST"]="StaticList";e["TRANSFORM_LIST"]="TransformList";e["CONCAT_LIST"]="ConcatList";e["INTERSECT_LIST"]="IntersectList";e["UNIQUE_LIST"]="UniqueList";e["SORTED_LIST"]="SortedList";e["NODE_LIST"]="NodeList";e["CLIENT_DB_NODE"]="ClientDBNode";e["CLIENT_DB_OBJECT"]="ClientDBObject";e["SERVER_DB_NODE"]="ServerDBNode";e["SERVER_DB_OBJECT"]="ServerDBObject";return e}(r||{});t.exports=r},{}],480:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./graph.js");const i=e("./../lang/appquery");const s=e("../monitoring/apm");const o=e("./node_types");const a=e("../u/shared/errors");const l=100;const c="DDG construction timed out";const u=e=>e.json.toUniqueString();const d=e=>p(e.owner.id(),e.node_name());const p=(e,t)=>`${e}.${t}`;const _=e=>{var t;return`${e.type()}: ${(t=e.display)==null?void 0:t.call(e)}`};const f=e=>`${e.owner.type()}: ${e.node_name()}`;const h={get_group_data:true,get_list_data:true};const m=e=>e.name()in h;const g=e=>{const t=e.prior().get_static_property("element_id");return p(t,"data_source")};const v={getElementParentDependencies:e=>{var t,n;const r=(t=e.owner)==null?void 0:(n=t.parent())==null?void 0:n.id();if(!r){return[]}else{const e=p(r,"data_source");return[e]}},getInjectedValueDependencies:e=>{const t=e.owner.property("data_source");const n=u(t);return[n]},getMessageNodeDependencies:e=>{if(e.has_args()){return[u(e.args())]}else{return[]}}};const b=e=>{let t=[];switch(e.type()){case"ElementParent":t=v.getElementParentDependencies(e);break;case"InjectedValue":t=v.getInjectedValueDependencies(e);break;case"Message":t=v.getMessageNodeDependencies(e);break}for(const n of e.properties()){t.push(u(n))}return t};class y{constructor(e){s.traceSpan("construct_ddg",{},(()=>{const t=i.get_page_by_name(e);this.graph=new r;this.nodes=new Map;this.startedConstruction=Date.now();this.generateDependencyGraph(t)}))}getEvaluationOrder(){return this.graph.topologicalSort().reverse()}getDependencies(e){return this.graph.adjacent(e)}getNode(e){return this.nodes.get(e)}getNodeIds(){return this.graph.nodes()}setLabel(e,t,n){const r=this.getNode(e);if(!r)return;r.labels[t]=n}getLabel(e,t){var n;const r=this.getNode(e);if(!r)return null;return(n=r.labels)==null?void 0:n[t]}addPropertyNode(e){const t=d(e);const n=()=>f(e)||t;const r={id:t,topLevelExpressionId:u(e),display:n,expression:e,labels:{},type:o.Property};this.graph.addNode(t);this.nodes.set(t,r);return t}addExpressionNode(e,t){const n=u(e);const r=()=>_(e)||n;const i={id:n,display:r,expression:e,labels:{},type:o.Expression,containingPropertyNodeId:t};this.graph.addNode(n);this.nodes.set(n,i);return n}addDependency(e,t){this.graph.addEdge(e,t)}addDependencies(e,t){t.forEach((t=>this.addDependency(e,t)))}analyzeElement(e){if(Date.now()-this.startedConstruction>l)throw new a.ExpectedError(c);for(const t of e.properties()){this.analyzeProperty(t)}for(const t of e.elements()){this.analyzeElement(t)}}analyzeMessageNode(e,t,n){const r=this.analyzeExpression(e);this.addDependency(r,t);if(e.has_args()){this.analyzeExpression(e.args(),n)}if(m(e)){this.addDependency(r,g(e))}}analyzeProperty(e){const t=this.addPropertyNode(e);const n=this.analyzeExpression(e,t);this.addDependency(t,n);return t}analyzeExpression(e,t){const n=this.addExpressionNode(e,t);const r=b(e);this.addDependencies(n,r);if(e.has_next()&&!e.next().is_empty()){this.analyzeMessageNode(e.next(),n,t)}for(const n of e.properties()){this.analyzeExpression(n,t)}return n}generateDependencyGraph(e){for(const t of e.elements()){this.analyzeElement(t)}}printDependencyGraph(){const e=this.graph.serializeForVisualization(this.nodes);console.log("Paste the following into the visualization tool here: https://data-dag-viz.bubbleapps.io/display-graph");console.log(JSON.stringify(e))}}t.exports=y},{"../monitoring/apm":746,"../u/shared/errors":846,"./../lang/appquery":651,"./graph.js":483,"./node_types":485,"core-js/modules/web.dom-collections.iterator.js":1123}],481:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../lang/evaluation/evaluate");const i=e("../lang/evaluation/eval_node_state");const s=e("../client/epoch");const o=e("../lib");const a=e("./ddg_utils");const l=e("../logger");const c=e("./node_types");const u=e("../db/values/ListWrapper");const d=e("../monitoring/apm");const p=e("../u/shared/errors");const _=e("../page_thing_utils");const f=n;const h=.01;const m=100;const g="Prefetch timed out";const v={prefetch_attempted_nodes:0,prefetch_definite_successes:0,prefetch_possible_successes:0,prefetch_definite_failures:0,prefetchable_lists:0,prefetched_lists:0};const b=e=>{if(Date.now()-e>m)throw new p.ExpectedError(g)};const y=e=>{if(e.type===c.Property){return true}if(a.isElementReferenceExpression(e.expression)){return false}return true};const w=e=>{const t=e.getNodeIds();for(const n of t){const t=e.getNode(n);if(!t)continue;e.setLabel(n,"isEvaluable",y(t))}};const x=e=>{if(e.type===c.Property){return false}if(a.isDataFetchExpression(e.expression)){return true}return false};const j=e=>{const t=e.getNodeIds();for(const n of t){const t=e.getNode(n);if(!t)continue;e.setLabel(n,"isDataFetch",x(t))}};const A=e=>{const t=e.getNodeIds();for(const n of t){const t=e.getNode(n);if(!t)continue;if(t.type===c.Property){if(t.expression.node_name()==="data_source"){const r=t.expression.owner;if(r.type()==="RepeatingGroup"&&r.get_static_property("layout_style")==="limit_items"){const i=r.get_static_property("rows",true)*r.get_static_property("columns",true);e.setLabel(n,"listLengthDemand",i);const s=t.topLevelExpressionId;e.setLabel(s,"listLengthDemand",i)}}}}};const M=e=>{const t=e.getEvaluationOrder();for(const n of t){let t=true;if(e.getLabel(n,"isEvaluable")===false){t=false}else{const r=e.getDependencies(n);t=r.every((t=>e.getLabel(t,"isPrefetchable")))}e.setLabel(n,"isPrefetchable",t)}};const E=()=>{const e=_.get_page_thing_id(o().location);return{datasources:{current_user:()=>o().current_user(),current_page_item(){if(e){return o().db_instance().get(e)}}}}};const k=(e,t)=>{const n=e.getNode(t.containingPropertyNodeId);return n==null?void 0:n.expression};const O=(e,t,n,s)=>{const a=t.expression;v.prefetch_attempted_nodes++;let c;const d=o().db_instance().get_all_time_queued_fetches();const _=k(e,t);try{const[s]=i.with_eval_node(_,(()=>r.evaluate_json(a.json,n)));if(s instanceof u){v.prefetchable_lists++;const n=e.getLabel(t.id,"listLengthDemand");if(n){v.prefetched_lists++;s.get_children(0,n)}}}catch(e){c=e}const f=o().db_instance().get_all_time_queued_fetches();const h=f>d;if(h){v.prefetch_definite_successes++}else if(c&&!(c instanceof p.NotReadyError)){v.prefetch_definite_failures++;l.info("Prefetch evaluation threw unexpected error",{eval_error:c});if(s){l.info("Prefetch definite failure",{node:t})}}else{v.prefetch_possible_successes++;if(s){l.info("Prefetch possible success",{node:t})}}};const S=(e,t)=>x(t)&&e.getLabel(t.id,"isPrefetchable");const D=(e,t)=>d.traceSpan("startPrefetching",{},(()=>{const n=Date.now();const r=E();w(e);b(n);if(t){j(e)}A(e);b(n);M(e);b(n);const i=e.getEvaluationOrder().map((t=>e.getNode(t))).filter((e=>e!==undefined));const s=i.filter((t=>S(e,t)));s.forEach((i=>{b(n);O(e,i,r,t)}));o().db_instance().prefetch_queued_fetches()}));f.prefetchData=()=>d.traceSpan("prefetchData",{},(()=>{let e={};let t=null;try{const n=o().location.get_query().prefetch==="true";if(n||Math.random()<h){t="PREFETCHING_SUCCESS";const r=o().ddg();if(r){try{D(r,n)}catch(e){if(e.message===g){t="PREFETCHING_TIMED_OUT"}else{throw e}}}else{t="DDG_GENERATION_FAILED"}const i=o().db_instance().get_prefetched_request_counts();e={...v,prefetch_msearch_request_count:i.msearch,prefetch_mget_request_count:i.mget,prefetch_maggregate_request_count:i.maggregate};if(n){l.info("Prefetch metrics",e)}}}catch(e){l.info("Unexpected error in DDG prefetch",{e:e});t="PREFETCHING_ERROR"}e.experiment_flag=t;s.addEpochLabels(e)}))},{"../client/epoch":25,"../db/values/ListWrapper":467,"../lang/evaluation/eval_node_state":694,"../lang/evaluation/evaluate":695,"../lib":741,"../logger":744,"../monitoring/apm":746,"../page_thing_utils":754,"../u/shared/errors":846,"./ddg_utils":482,"./node_types":485,"core-js/modules/web.dom-collections.iterator.js":1123}],482:[function(e,t,n){"use strict";const r=n;const i={Search:true,GetDataFromAPI:true,CurrentPageItem:true,CurrentUser:true};r.isDataFetchExpression=e=>e.type()in i;const s={ElementParent:true,GetElement:true};r.isElementReferenceExpression=e=>e.type()in s},{}],483:[function(e,t,n){"use strict";e("core-js/modules/es.error.cause.js");class r extends Error{constructor(e){super(e);Object.setPrototypeOf(this,r.prototype)}}function i(e){const t={addNode:s,removeNode:o,nodes:a,adjacent:l,addEdge:p,removeEdge:_,hasEdge:f,setEdgeWeight:u,getEdgeWeight:d,indegree:h,outdegree:m,depthFirstSearch:g,hasCycle:v,lowestCommonAncestors:b,topologicalSort:y,shortestPath:w,serializeForVisualization:x,serialize:j,deserialize:A};const n={};const i={};if(e){A(e)}function s(e){n[e]=l(e);return t}function o(e){Object.keys(n).forEach((function(t){n[t].forEach((function(n){if(n===e){_(t,n)}}))}));delete n[e];return t}function a(){const e={};Object.keys(n).forEach((function(t){e[t]=true;n[t].forEach((function(t){e[t]=true}))}));return Object.keys(e)}function l(e){return n[e]||[]}function c(e,t){return e+"|"+t}function u(e,n,r){i[c(e,n)]=r;return t}function d(e,t){const n=i[c(e,t)];return n===undefined?1:n}function p(e,n,r){s(e);s(n);l(e).push(n);if(r!==undefined){u(e,n,r)}return t}function _(e,r){if(n[e]){n[e]=l(e).filter((function(e){return e!==r}))}return t}function f(e,t){return l(e).includes(t)}function h(e){let t=0;function r(n){if(n===e){t++}}Object.keys(n).forEach((function(e){n[e].forEach(r)}));return t}function m(e){return e in n?n[e].length:0}function g(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!e){e=a()}if(typeof t!=="boolean"){t=true}const i={};const s={};const o=[];function c(e){if(s[e]&&n){throw new r("Cycle found")}if(!i[e]){i[e]=true;s[e]=true;l(e).forEach(c);s[e]=false;o.push(e)}}if(t){e.forEach(c)}else{e.forEach((function(e){i[e]=true}));e.forEach((function(e){l(e).forEach(c)}))}return o}function v(){try{g(undefined,true,true);return false}catch(e){if(e instanceof r){return true}else{throw e}}}function b(e,t){const n=[];const r=[];function i(e,s){if(!e[s]){e[s]=true;n.push(s);if(s===t){r.push(s);return false}return l(s).every((t=>i(e,t)))}else{return true}}function s(e,t){if(!e[t]){e[t]=true;if(n.indexOf(t)>=0){r.push(t)}else if(r.length===0){l(t).forEach((t=>{s(e,t)}))}}}if(i({},e)){s({},t)}return r}function y(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return g(e,t,true).reverse()}function w(e,t){const n={};const r={};let i={};function s(){a().forEach((function(e){n[e]=Infinity}));if(n[e]!==Infinity){throw new Error("Source node is not in the graph")}if(n[t]!==Infinity){throw new Error("Destination node is not in the graph")}n[e]=0}function o(){a().forEach((function(e){i[e]=true}))}function c(){return Object.keys(i).length===0}function u(){let e=Infinity;let t;Object.keys(i).forEach((function(r){if(n[r]<e){e=n[r];t=r}}));if(t===undefined){i={};return null}delete i[t];return t}function p(e,t){const i=d(e,t);if(n[t]>n[e]+i){n[t]=n[e]+i;r[t]=e}}function _(){s();o();while(!c()){const e=u();if(e===null)return;l(e).forEach((function(t){p(e,t)}))}}function f(){const n=[];let i=0;let s=t;while(r[s]){n.push(s);i+=d(r[s],s);s=r[s]}if(s!==e){throw new Error("No path found")}n.push(s);n.reverse();n.weight=i;return n}_();return f()}function x(e){const t={nodes:a().map((function(t){const n=e.get(t);return{id:t,display:n?n.display():t,labels:n?n.labels:{},containingPropertyNodeId:n?n.containingPropertyNodeId:null}})),links:[]};const n=e=>{for(let n=0;n<t.nodes.length;n++){if(t.nodes[n].id===e)return n}return null};t.nodes.forEach((function(e){const r=e.id;l(r).forEach((function(e){const i=n(r);const s=n(e);if(i===null||s===null)return;t.links.push({source:i,target:s,weight:d(r,e)})}))}));return t}function j(){const e={nodes:a().map((function(e){return{id:e}})),links:[]};e.nodes.forEach((function(t){const n=t.id;l(n).forEach((function(t){e.links.push({source:n,target:t,weight:d(n,t)})}))}));return e}function A(e){e.nodes.forEach((function(e){s(e.id)}));e.links.forEach((function(e){p(e.source,e.target,e.weight)}));return t}return t}t.exports=i},{"core-js/modules/es.error.cause.js":1116}],484:[function(e,t,n){"use strict";const r=n;const i=e("./data_dependency_graph");const s=e("./ddg_optimizations");const o=e("../logger");r.instance=e=>{let t;return()=>{if(t===undefined){try{t=new i(e)}catch(e){t=null;if(e.message==="DDG construction timed out"){o.debug("DDG construction timed out")}else{o.info("Unexpected error while constructing DDG",{e:e})}}}return t}};r.DataDependencyGraph=i;r.optimizations=s},{"../logger":744,"./data_dependency_graph":480,"./ddg_optimizations":481}],485:[function(e,t,n){"use strict";const r={Expression:"Expression",Property:"Property"};t.exports=r},{}],486:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("./u");i.edit_mode_only();const s=e("./content/reference_id_to_url");const o=e("./lib");const a=e("./services/shared/service_type_parser");const l=e("./lang/nodes/registry");const c=e("./lang/nodes/node_types");const u=["border_style_top","border_roundness_top","border_width_top","border_color_top","border_style_right","border_roundness_right","border_width_right","border_color_right","border_style_bottom","border_roundness_bottom","border_width_bottom","border_color_bottom","border_style_left","border_roundness_left","border_width_left","border_color_left"];const d=["Omnivore-CreateOmnivoreTicket","Omnivore-AddItemToOmnivoreTicket","Omnivore-MakeThirdPartyPayment","meta_ForkPlugin","upsert_account","upsert_usage_profile","upsert_production_profile","upsert_pvwatts_profile","run_savings_analysis","zapier-TrigggerZap","localizejs-ChangeLocalizeLanguage","stripe-CreateCoupon","stripe-CreatePayout","stripe-AdjustCustomerBalance","stripe-AdjustCustomerBalanceRelative"];const p=["condition","key_info","information","information_data","information_start","formatting_type","decimal_place","decimal_separator","thousand_separator","currency_symbol","no_language","negative_parenthese","computed_value","page_folder"];const _=["mandatory","disabled","auto_binding","bind_field","alert_message","alert_element","show_alert_on_sucess"];const f=function(e){if(o().is_edit_mode()){const t=s.mapping.subsections.Plugins.subsections;return t[e]!=null}return false};r.for_workflows=function(e,t){const[n,r]=a.get_plugin_and_type(t);if(d.includes(t)||["apiconnector","appconnector","dbconnector","apiconnector2"].includes(n)||t.indexOf("meta_")===0){return}if(n){if(f(n)){if(["Blockspring"].includes(n)){return"Documentation.Plugins."+n}else{return"Documentation.Plugins."+n+"."+r}}}else{if(e){if(["APIReturnData"].includes(t)){return"Documentation.API.workflow_api."+t}else{return"Documentation.Actions."+t}}else{if(["APIEvent"].includes(t)){return"Documentation.API.workflow_api."+t}else{return"Documentation.Events."+t}}}};r.for_property_editor=function(t,n,r){var i,s,o;let f,h;const m=e("./core/property_applications");if(p.includes(n.name)){return}if(["switch_element","element_style","delete_style","edit_style","is_visible","select_parent","reveal_in_tree","lock_in_editor","unique_id"].includes(n.name)){return"Documentation.Elements.GeneralConcepts."+n.name}if(_.includes(n.name)&&t.is_input&&t.is_input()){return"Documentation.Elements.GeneralInput."+n.name}switch((i=n.pretty)==null?void 0:i.section){case"Position":case"ShortPosition":case"Position2":f="Dimensions";break;case"Boxshadow":f="BoxShadow";break;case"Responsive":case"Margins":if(["default_width"].includes(n.name)){f="RootSizing"}if(n.name==="overflow_scroll"){return"Documentation.Elements.Group."+n.name}else{f="ResponsiveElement"}break}if(u.includes(n.name)){return"Documentation.PropertyApplications.Border."+n.name.split("_").slice(0,2).join("_")}else if(["min_width","new_responsive","fixed_width","keep_proportion_resize","max_width","use_max_width"].includes(n.name)){return"Documentation.Elements.GeneralConcepts.Responsive."+n.name}else if(["line_height","letter_spacing","word_spacing"].includes(n.name)){return"Documentation.PropertyApplications.FontSpacing."+n.name}else if(["vertical_centering","padding_horizontal"].includes(n.name)){return"Documentation.PropertyApplications.Padding."+n.name}else if(["floating_reference","floating_reference_horizontal","floating_reference_horizontal_resp","parallax","float_zindex"].includes(n.name)){if(n.name==="floating_reference_horizontal_resp"){return"Documentation.Elements.FloatingGroup.floating_reference_horizontal"}return"Documentation.Elements.FloatingGroup."+n.name}else if((s=m[f])!=null?s:m[(o=n.pretty)==null?void 0:o.section]){if(["prevent_user_from_closing_through_esc","greyout_color","greyout_blur"].includes(n.name)){return"Documentation.Elements.Popup."+n.name}else if(["collapse_when_hidden","collapse_animation","animation_type"].includes(n.name)){return"Documentation.Elements.Group."+n.name}else if(["preset_width"].includes(n.name)){var g;if(((g=t.root())==null?void 0:g.get_responsive_version())>0){return"Documentation.Elements.Page.preset_width_v1"}return"Documentation.Elements.Page.preset_width"}else{var v,b,y,w;let e=(v=(b=m[f])==null?void 0:b.class_name)!=null?v:(y=n.pretty)==null?void 0:y.section;switch(e){case"ShortPosition":case"ShortDimensions":case"Rotation":case"Position":case"Position2":e="Dimensions";break;case"Boxshadow":e="BoxShadow";break;case"PlaceholderColor":e="Font";break;case"Opacity":e="Opacity";break;case"Responsive":case"Margins":if(["default_width"].includes(n.name)){e="RootSizing"}else{e="ResponsiveElement"}break;case"ResponsiveContainer":if(["container_layout"].includes(n.name)&&t.type()==="RepeatingGroup"){return"Documentation.PropertyApplications."+e+"."+n.name+"_rg"}break}if(["flex_move_first","flex_move_prev","flex_move_next","flex_move_last"].includes(n.name)){if(t.parent().container_layout()==="column"){return"Documentation.PropertyApplications."+e+"."+n.name+"_col"}if(t.parent().container_layout()==="row"){return"Documentation.PropertyApplications."+e+"."+n.name+"_row"}}if(["left","top","width","height"].includes(n.name)&&e==="Dimensions"&&((w=t.root())==null?void 0:w.get_responsive_version())>0){return"Documentation.PropertyApplications."+e+"."+n.name+"_v1"}return"Documentation.PropertyApplications."+e+"."+n.name}}let x=h=null;if(t.type){[x,h]=a.get_plugin_and_type(t.type());if(!h){return}}if(l.is(t,c.GENERIC_ELEMENT)||l.is(t,c.STYLE)){if(["FakeMultiElement","GroupWithFocus"].includes(t.type())){return}if(!["delete_element","delete_page","delete_custom_definition","edit_custom_definition","backdrop_crop_responsive"].includes(n.name)&&!["AddToAnyShareButtons"].includes(h)){if(h==="CustomElement"){h="CustomDefinition"}if(x){if(r(x)){return"Documentation.Plugins."+x+"."+h+"."+n.name}}else{var j;if(["rows","columns","stable_pagination"].includes(n.name)&&t.type()==="RepeatingGroup"&&((j=t.root())==null?void 0:j.get_responsive_version())>0){return"Documentation.Elements."+h+"."+n.name+"_v1"}return"Documentation.Elements."+h+"."+n.name}}}else if(l.is(t,c.STATE)){[x,h]=a.get_plugin_and_type(t.context_element().type());if(x){if(r(x)){return"Documentation.Plugins."+x+"."+h+"."+n.name}}else{return"Documentation.Elements."+h+"."+n.name}}else if(l.is(t,c.GENERIC_EVENT)){if(["condition","element_id","event_color","wf_folder","breakpoint","workflow_disabled"].includes(n.name)){return"Documentation.Workflow."+n.name}else{if(["APIEvent"].includes(h)){return"Documentation.API.workflow_api."+h+"."+n.name}else if(x){if(r(x)){return"Documentation.Plugins."+x+"."+h+"."+n.name}}else{return"Documentation.Events."+h+"."+n.name}}}else if(l.is(t,c.ACTION)){if(n.name==="element_id"&&h==="TriggerCustomEventFromReusable"){return"Documentation.Actions.TriggerCustomEventFromReusable.element_id"}if(n.name==="element_id"&&h==="ChangePage"){return"Documentation.Actions.ChangePage"}if(["condition","element_id","breakpoint","workflow_disabled"].includes(n.name)){return"Documentation.Workflow."+n.name}if(["X","Y"].includes(n.name)&&h==="RepositionElement"){return"Documentation.Actions.RepositionElement"}else{if(d.includes(t.type())||["apiconnector","appconnector"].includes(x)||t.type().indexOf("meta_")===0){return null}else if(["APIReturnData"].includes(h)){return"Documentation.API.workflow_api."+h+"."+n.name}else if(["ScheduleAPIEvent","ScheduleAPIEventOnList"].includes(h)&&!["api_event","date","type_of_list","data_source","ignore_privacy_rules","interval"].includes(n.name)){return"Documentation.Actions."+h+".parameters"}else if(x){if(r(x)){return"Documentation.Plugins."+x+"."+h+"."+n.name}}else{return"Documentation.Actions."+h+"."+n.name}}}else if(t._type==="Search"){return"Documentation.Data.SearchOperator."+n.name}else if(["GetDataFromAPI","GetParamFromUrl","GetMouseData"].includes(t._type)){return"Documentation.Data.DataSources."+t._type}};const h=["AppSetting","OneOptionValue","AllOptionValue"];r.for_datasource=function(e){var t;if(h.includes(e.type)){return}let n="Documentation.Data.DataSources."+e.type;if((t=e.properties)!=null&&t.name){n+="."+e.properties.name}return n};const m=["equals","not_equals","is_empty","is_not_empty"];r.for_value_messages=function(e,t){if(m.includes(t)){return"Documentation.Data.Messages.GenericMessages."+t}else{if(e==="bool"){e="boolean"}return"Documentation.Data.Messages."+e+"."+t}};const g=["Created By","Created Date","Modified Date","_id","Slug","id_link","email","logged_in","not_logged_in","email_confirmed","slug_can_be","slug_cannot_be"];r.for_value_messages_custom_types=function(e,t){if(g.includes(t)){if(["slug_can_be","slug_cannot_be"].includes(t)){return"Documentation.Elements.GeneralConcepts.State."+t}else if(e==="custom"||!["email","logged_in","not_logged_in","email_confirmed"].includes(t)){return"Documentation.Data.Messages.CustomType."+t}else{return"Documentation.Data.Messages.User."+t}}};r.for_value_messages_option_sets=function(e){if(m.includes(e)){return"Documentation.Data.Messages.GenericMessages."+e}else{return"Documentation.Data.Messages.OptionSet."+e}}},{"./content/reference_id_to_url":96,"./core/property_applications":412,"./lang/nodes/node_types":722,"./lang/nodes/registry":724,"./lib":741,"./services/shared/service_type_parser":785,"./u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],487:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ElementThumbnail=w;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=v(e("../lang/elements/ElementInstance"));var o=e("../renderer/RenderElement");var a=v(e("../shared/responsive/ResponsiveContainer"));var l=g(e("../u/client/resize_observer"));var c=v(e("../lib"));var u=g(e("../lang/evaluation/element_props"));var d=e("../u/client/b_ui");var p=v(e("../renderer/ThumbnailContext"));var _=v(e("./designcanvas/EditRepeatingGroup"));var f=e("../u/shared/async/autorun");var h=e("./designcanvas/EditRepeatingTable");function m(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(m=function(e){return e?n:t})(e)}function g(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=m(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function v(e){return e&&e.__esModule?e:{default:e}}const b=(0,r.template)(`<div></div>`,2),y=(0,r.template)(`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><rect x="11" y="1" width="2" height="5" opacity=".14"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(30 12 12)" opacity=".29"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(60 12 12)" opacity=".43"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(90 12 12)" opacity=".57"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(120 12 12)" opacity=".71"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(150 12 12)" opacity=".86"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(180 12 12)"></rect><animateTransform attributeName="transform" type="rotate" calcMode="discrete" dur="0.75s" values="0 12 12;30 12 12;60 12 12;90 12 12;120 12 12;150 12 12;180 12 12;210 12 12;240 12 12;270 12 12;300 12 12;330 12 12;360 12 12" repeatCount="indefinite"></animateTransform></g></svg>`,20);function w(e){let t;const n=e.element;let m=null;let g=false;const[v]=(0,i.createResource)((async()=>await(0,f.run_once)(30,(()=>{var e;if(g)return undefined;(e=m)==null?void 0:e.destroy();m=null;const t=new s.default(n,s.default.modes.THUMBNAIL);m=t;t.register();t.split_namespace();const r=new a.default(null);r.element_css=()=>({});t.set_containers(r);t.do_show();return t}))));(0,i.onCleanup)((()=>{g=true;setTimeout((()=>{var e;(e=m)==null?void 0:e.destroy();m=null}))}));const[y,w]=(0,i.createSignal)(0);(0,i.onMount)((()=>{w(t.clientWidth);l.observe(t,(e=>{w(e.contentRect.width)}));(0,i.onCleanup)((()=>{l.unobserve(t)}))}));const j=(0,i.createMemo)((()=>{if(e.elementWidth!=null){return{width:e.elementWidth,height:e.elementHeight}}if(c.default.or_throw().visual_edit.element_is_on_page(n)){var t;const e=c.default.or_throw().visual_edit.get_instance(n);if(e!=null&&!e.destroy_started()&&(t=e.canvas)!=null&&t.is(":visible")&&e.current_width()>0){return{width:e.current_width(),height:e.current_height()}}}const r=n.parent();if(n.force_fixed()||r==null&&!n.is_root()||(r==null?void 0:r.container_layout())==="fixed"){return{width:n.get_width(),height:n.get_height()}}else if(n.is_root()){return{width:n.default_width()}}else{var i;return{width:(i=e.maxWidth)!=null?i:y()}}}),{width:0});const A=(0,i.createMemo)((()=>{var t;let n=Math.min(1,((t=e.maxWidth)!=null?t:y())/j().width);if(e.maxHeight!=null&&v()!=null){n=Math.min(n,e.maxHeight/v().current_height())}return n}));const M=(0,i.createMemo)((()=>{const e=v();if(e==null)return()=>undefined;const[t,n]=(0,i.createSignal)(undefined);e.with_canvas((e=>{n(e)}));return t}));(0,i.createEffect)((()=>{var e;const t=v();const r=M()();if(t==null||r==null)return;let i;if(n.is_root()){i=`${n.root_min_height()}px`}else{i=u.min_height_css(t)}r.css({"box-sizing":"border-box",top:"0px",left:"0px",width:j().width,height:(e=j().height)!=null?e:"max-content","margin-left":`${(y()-j().width*A())/2}px`,"min-height":j().height==null&&i.includes("px")?i:""})}));(0,i.createEffect)((()=>{const e=M()();if(e==null)return;(0,d.apply_scale)(e,A())}));const E=()=>{var e;let t=(e=v())==null?void 0:e.current_height();if(!t){var n,r,i;t=(n=(r=v())==null?void 0:(i=r.canvas)==null?void 0:i.outerHeight())!=null?n:0}return t*A()};return(0,r.createComponent)(i.Suspense,{get fallback(){return(0,r.createComponent)(x,{})},get children(){const n=b.cloneNode(true);const s=t;typeof s==="function"?(0,r.use)(s,n):t=n;n.style.setProperty("overflow","hidden");(0,r.insert)(n,(0,r.createComponent)(p.default.Provider,{value:{repeatingGroupImplementation:_.default,editRepeatingTable:h.EditRepeatingTable},get children(){return(0,r.createComponent)(i.Show,{get when(){return v()},keyed:true,children:e=>(0,r.createComponent)(o.RenderElement,{instance:e})})}}));(0,r.effect)((t=>{const r=e.maxWidth!=null?`${j().width*A()}px`:"100%",i=`${E()}px`;r!==t._v$&&n.style.setProperty("width",t._v$=r);i!==t._v$2&&n.style.setProperty("height",t._v$2=i);return t}),{_v$:undefined,_v$2:undefined});return n}})}function x(){return y.cloneNode(true)}},{"../lang/elements/ElementInstance":669,"../lang/evaluation/element_props":691,"../lib":741,"../renderer/RenderElement":769,"../renderer/ThumbnailContext":771,"../shared/responsive/ResponsiveContainer":801,"../u/client/b_ui":813,"../u/client/resize_observer":820,"../u/shared/async/autorun":830,"./designcanvas/EditRepeatingGroup":563,"./designcanvas/EditRepeatingTable":564,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],488:[function(e,t,n){"use strict";const r=e("./thumbnail");const i=e("../shared/responsive/ResponsiveContainer");t.exports=class e extends i{create_child(e,t){const n=e.element.E.custom_definition;if(n&&n().get_responsive_version()<1){return new r.Container(e,t)}else{const n=new this.constructor(e,t);this.child_containers.push(n);return n}}}},{"../shared/responsive/ResponsiveContainer":801,"./thumbnail":590}],489:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../u");const i=e("../safe_require");const s=e("./editor_language").get_text;let o=i.safe_require("./lang/appquery");const a=e("../constants/plugin");const l=e("../core/status_bar");const c=e("lodash/debounce");const u=e("./utils/editor_exposure");const{registerAddPlugin:d}=e("../lang/btypes_dropdowns");const{is_enterprise_app:p,user_is_enterprise_owner:_}=e("./utils/organization_metadata");r.edit_mode_only();const f=n;let h=null;let m=null;const g=50;const v=150;f.show=function(e){var t;let{types:n,categories:r,cb:i,search_term:s,sort_mode:o,built_by:a}=e;(t=h)!=null?t:h=new x;return h.show({types:n,categories:r,cb:i,search_term:s,sort_mode:o,built_by:a})};d(f.show);f.show_warning_still_subscribed=function(e){var t;if((t=o.app_plan().paid_plugins)!=null&&t[e]){return window.ConfirmPanel({title:"Plugin subcription",message:"This plugin cannot be uninstalled yet, because you are still subscribed to it on a monthly basis. You can unsubscribe in the Plan section of the Settings tab. Note that you should only unsubscribe if you are not using the plugin in other development versions.",button_caption:"Go to Plan",cancel_caption:"Keep it",cb_yes(){return A.send_to_plan()}})}};function b(){return o.appname()==="learn"}const y={};function w(){return o.app_plan().can_buy_plugins&&!b()}class x{show(e){let{types:t,categories:n,cb:i,search_term:s,sort_mode:a,built_by:l}=e;this.cb=i;this.filters={types:r.Box(t),categories:r.Box(n),built_by:r.Box(l),premium:r.Box(null)};this.real_time_search_box=r.Box(s);const c=a!=null?a:"usage";this.sort_mode=r.Box(c);const u=b()?Number.POSITIVE_INFINITY:g;this.max_displayable_results=r.Box(u);this.canvas=r.div(["modal-popup","add-plugin-window"],$(document.body));const d=r.div("popup-content",this.canvas);this.canvas.on("vclick",(e=>{if(r.did_event_pass_through(e,".children")||r.is_on_mobile_or_tablet()){return true}this.hide();return true}));$(document).off("keydown.escape-addplugin");$(document).on("keydown.escape-addplugin",(e=>{if(e.keyCode===27){this.hide()}}));d.append(this.create_header());const p=r.div("children",d);this.sub_child=r.div("inner-children",p);this.autoruns=[];this.sub_child.append(this.create_filter_pane());this.sub_child.append(this.create_plugins_pane());this.sub_child.append(this.create_footer());if(s){this.search_input.val(s)}const _=r.div("paid-mention",this.sub_child);this.autorun((()=>{_.empty();if(w()){r.div("explanation",_,"Note that subscriptions on plugins are prorated but one-time purchases are non-refundable")}else{const e="You can subscribe to paid plugins on new paid plans only. Legacy plans do not offer this option.";const t="Recurring subscriptions to paid plugins are on paid plans only.";const n=o.app_plan().legacy_plan?e:t;const r=A.add_mention({feature_id:"can_buy_plugins",feature_access_check(e){return!e.can_buy_plugins},attach_to:_,text:n,source:"Plugins/AddPlugins/PluginSubscription"});return r.on("vclick",(()=>this.hide()))}}));$("body").css("overflow","hidden");r.velocity(this.canvas,"fadeIn",{duration:300,complete_cb:()=>this.search_input.focus()});$(window).on("resize.add_plugin_scrollbars",(()=>this.update_scrollbars()));this.update_scrollbars()}add_filter(e,t){var n;const r=[].concat((n=this.filters[e]())!=null?n:[]);r.push(t);this.filters[e](r)}remove_filter(e,t){var n;const i=[].concat((n=this.filters[e]())!=null?n:[]);r.array_remove(i,t);this.filters[e](i)}autorun(e){return this.autoruns.push(r.autorun(e))}hide(){for(const e of this.autoruns){e.destroy()}r.velocity(this.canvas,"fadeOut",{duration:300,complete_cb:()=>{var e;$("body").css("overflow","auto");this.canvas.remove();(e=this.cb)==null?void 0:e.call(this,m)}});$(window).off("resize.add_plugin_scrollbars")}create_header(){const e=r.div("popup-title");e.text(s("install_plugin"));return e}create_filter_pane(){const e=r.div("filter-pane");r.div("filter-title",e,"Filters");this.filter_area=r.div("filter-area",e);const t=r.div("filter-pane-inner",this.filter_area);r.div("sort-by",t,"Sort by");const n={};for(const e of["name","usage","rating","date","price"]){n[e]=r.div("sort-btn "+e,t,e);n[e].on("vclick",(()=>{this.sort_mode(e)}))}r.autorun((()=>{for(const e in n){const t=n[e];t.toggleClass("selected",e===this.sort_mode())}}));this.search_input=r.input("bubble-ui search-plugin",t,undefined,s("search_plugin"));this.search_input.on("keyup",c((()=>{var e;this.max_displayable_results(g);if(((e=this.search_input.val())==null?void 0:e.length)>2){this.real_time_search_box(this.search_input.val())}else{this.real_time_search_box(null)}}),500));const i=r.div("filter-wrapper",t);this.autorun((()=>{i.empty();i.append(this.create_filter(a.TYPES_TAG_TYPE));i.append(this.create_filter(a.CATEGORIES_TAG_TYPE));i.append(this.create_filter(a.PREMIUM_TAG_TYPE));return i.append(this.create_filter(a.BUILT_BY_TAG_TYPE))}));return e}create_filter(e){const t=r.div("filter-category");const n=j.get_all_tags(e).sort()||[];r.autorun_top((()=>{if(!this.filters[e]()||!this.filters[e]().length){for(const t of n){this.add_filter(e,t)}}}));const i=r.div("filter-caption open",t);const o=r.div("filter-select-all",t);this.autorun((()=>{const t=this.filters[e]();i.text(s(e));o.off("vclick");if((t==null?void 0:t.length)===n.length){o.text("("+s("deselect_all").toLowerCase()+")");o.on("vclick",(()=>{this.filters[e]([])}))}else{o.text("("+s("select_all").toLowerCase()+")");o.on("vclick",(()=>{this.filters[e](n)}))}}));const a=r.div("filter-list",t);a.show();this.autorun((()=>{a.empty();for(const i of n){var t;const n=r.div("tag-button",a,r.toTitleCase(i));if(((t=this.filters[e]())!=null?t:[]).includes(i)){n.addClass("selected");n.on("vclick",(()=>this.remove_filter(e,i)))}else{n.on("vclick",(()=>this.add_filter(e,i)))}}}));i.on("click",(()=>{if(i.hasClass("open")){o.hide();r.velocity(a,"slideUp",{duration:200})}else{o.show();r.velocity(a,"slideDown",{duration:200})}i.toggleClass("open")}));const l=r.div("filter-more");let c=false;function u(){l.text(s("more"));c=false}function d(){l.text(s("hide"));c=true}d();l.on("vclick",(()=>{if(c){u();r.velocity(a,"slideUp",{duration:300})}else{d();r.velocity(a,"slideDown",{duration:300})}}));return t}create_plugins_pane(){this.plugins_pane=r.div("plugin-pane");const e=r.div("plugins-pane-inner",this.plugins_pane);const t=(e,t)=>{let n,r;function i(){var n,r;const i=(n=e.count())!=null?n:0;const s=(r=t.count())!=null?r:0;if(i<s){return 1}else{return-1}}if(e.is_testing()&&!t.is_testing()){return-1}else if(!e.is_testing()&&t.is_testing()){return 1}if(e.license()===a.LICENSE_PRIVATE&&t.license()!==a.LICENSE_PRIVATE){return-1}else if(e.license()!==a.LICENSE_PRIVATE&&t.license()===a.LICENSE_PRIVATE){return 1}if(this.sort_mode()==="name"){n=e.display().toLowerCase();r=t.display().toLowerCase();if(n<r){return-1}else if(r<n){return 1}return i()}if(this.sort_mode()==="rating"){var s,o;n=(s=e.all_versions_rating())!=null?s:0;r=(o=t.all_versions_rating())!=null?o:0;if(n<r){return 1}else if(r<n){return-1}return i()}if(this.sort_mode()==="date"){var l,c;n=(l=e.published_date())!=null?l:0;r=(c=t.published_date())!=null?c:0;if(n<r){return 1}else if(r<n){return-1}return i()}if(this.sort_mode()==="price"){var u,d;n=(u=e.price())!=null?u:0;r=(d=t.price())!=null?d:0;if(n<r){return 1}else if(r<n){return-1}return i()}else if(this.sort_mode()==="usage"){return i()}};this.autorun((()=>{const n=j.get_all_plugins().sort(t);this.autorun((()=>{const t=n.filter((e=>this.should_show(e)));e.empty();if(t.length===0){return}const i=Math.min(t.length,this.max_displayable_results());if(i>=v){l.show_general_message_immediate(`Loading ${i} plugins, please wait...`,0)}setTimeout((()=>{let n=0;for(const r of t){if(n>=this.max_displayable_results()){break}n++;e.append(this.create_plugin_box(r.id,r))}const i=r.div("plugin-count-summary",e);const s=r.div("plugin-count-summary-text",i);s.text(`Showing ${n} out of ${t.length} plugins`);if(t.length>this.max_displayable_results()){const e=r.div("light-button show-all",i);e.on("vclick",(()=>this.max_displayable_results(Number.POSITIVE_INFINITY)));e.text("Show All")}this.update_scrollbars();l.hide_general_message()}),10)}))}));return this.plugins_pane}should_show(e){var t;if(e.hidden()){return false}if(e.data.whitelisted!=null&&!e.data.whitelisted.includes(o.appname())){return false}for(const t of Object.keys(this.filters)){const n=this.filters[t]();if(n!=null&&n.length){let r=false;for(const i of e.tags(t)){if(n.includes(i)){r=true}}if(!r){return false}}else{return false}}const n=(t=this.real_time_search_box())==null?void 0:t.toLowerCase();if(n&&e.display().toLowerCase().indexOf(n)===-1&&e.creator_name().toLowerCase().indexOf(n)===-1){return false}return true}create_plugin_box(e,t){if(!y[e]){const n=r.div(".plugin-box");y[e]=n;const i=r.div("plugin-description-wrapper",n);if(t.icon()){r.img("plugin-icon",i,t.icon())}r.div("plugin-display",i,t.display());if(t.is_testing()){r.div("mention-new testing",i,"TESTING")}else if(t.license()===a.LICENSE_PRIVATE){r.div("mention-new private",i,"PRIVATE")}else if(t.published_date()>Date.now()-864e6){r.div("mention-new",i,"NEW")}if(!t.is_testing()){if(t.license()===a.LICENSE_COMMERCIAL){switch(t.payment_type()){case"both":r.div("plugin-price",i,"$"+t.one_time_price()+" once or $"+t.price()+"/month");break;case"one_time":r.div("plugin-price",i,"$"+t.one_time_price()+" once");break;default:r.div("plugin-price",i,"$"+t.price()+"/month")}}else if(t.license()===a.LICENSE_OPEN_SOURCE){if(t.data.creator_id&&!a.BUBBLE_TEAM_MEMBER_IDS.includes(t.data.creator_id)){r.div("plugin-price",i,"Free")}}}const o=t.description().length>210?t.description().slice(0,200)+"...":t.description();r.div("plugin-description",i,o);r.img("plugin-creator-icon",i,t.creator_icon());if(t.creator_url()&&t.should_show_creator_url()){i.append($('<a class="plugin-creator" href="'+t.creator_url()+'" target="_blank">'+"By "+t.creator_name()+"</a>"))}else{r.div("plugin-creator",i,"By "+t.creator_name())}if(!t.is_testing()){if(t.count()){r.div("plugin-count",n,r.add_thousand_sep(t.count())+" "+s("use_this_plugin"))}const e=e=>parseFloat(Math.round(e*10)/10).toFixed(1);if(t.all_versions_rating()!=null){r.div("plugin-all-version-rating",n,"All versions "+e(t.all_versions_rating())+"/5.0")}if(t.last_version_rating()!=null){r.div("plugin-last-version-rating",n,"Current version "+e(t.last_version_rating())+"/5.0")}if(t.plugin_page_url()){const e='<a class="plugin-link" href="'+t.plugin_page_url()+'" target="_blank"">Plugin page</a>';n.append(e)}}r.div("add-plugin-btn-wrapper",n)}function n(){const n=t.is_testing()?"current":t.latest_version();o.install_plugin(e,n);m=e;return u.maybe_increase_event_count(u.EVENTS.INSTALLED_PLUGIN)}function i(){o.remove_plugin(e);m=null;return f.show_warning_still_subscribed(e)}r.autorun((()=>{const l=y[e].find(".add-plugin-btn-wrapper");l.empty();function c(){if(["one_time","both"].includes(t.payment_type())&&t.is_paid()){const e=r.div("plugin-add btn bubble-ui grey submit-button",l,"Buy $"+t.one_time_price());if(b()){e.addClass("disabled")}e.on("vclick",(()=>A.buy_plugin_once({plugin:t,cb:n})))}}function u(){if([null,undefined,"subscription","both"].includes(t.payment_type())){const e=r.div("plugin-add btn bubble-ui grey submit-button",l,"Subscribe");if(!w()){e.addClass("disabled")}if(p()&&!_()){e.addClass("disabled");e.prop("title","Contact Org Owner to purchase plugin")}else{e.on("vclick",(()=>{if(t.is_paid()){return A.subscribe_to_paid_plugin(t,n)}}))}}}function d(){r.div("plugin-add btn bubble-ui grey submit-button disabled enterprise-styling",l,"Contact Org Owner to purchase plugin")}if(o.has_plugin(e)){var f,h;const a=r.div("plugin-add btn bubble-ui grey submit-button selected",l);const u=t.is_paid()&&!(((f=o.app_plan().paid_plugins)==null?void 0:f[e])!=null||(h=o.app_plan().once_paid_plugins)!=null&&h[e])&&(!p()||_());if(u){a.text("Resubscribe");c()}else{a.text(s("uninstall"))}a.on("vclick",(()=>{if(u){A.subscribe_to_paid_plugin(t,n)}else{i()}}))}else{var m,g;const i=((m=o.app_plan().paid_plugins)==null?void 0:m[e])!=null||((g=o.app_plan().once_paid_plugins)==null?void 0:g[e]);if(!t.is_testing()&&t.license()===a.LICENSE_COMMERCIAL&&!i){if(p()&&!_()){d()}else{u();c()}}else{const e=r.div("plugin-add btn bubble-ui grey submit-button",l);e.text(s(i?"reinstall":"install"));if(t.id==="GoogleOptimize"&&!o.app_plan().ab_test_integration){e.addClass("disabled")}e.on("vclick",n)}}}));return y[e]}create_footer(){const e=r.div("bottom-stripe");const t=r.div("btn bubble-ui submit-button",e);t.on("vclick",(()=>this.hide()));t.text(s("done"));return e}update_scrollbars(){const e=$(window).height()-250;this.plugins_pane.css("height",e);this.filter_area.css("height",e-51)}}const j=e("./../lang/plugins");o=e("./../lang/appquery");const A=e("./subscription")},{"../constants/plugin":78,"../core/status_bar":415,"../lang/btypes_dropdowns":654,"../safe_require":777,"../u":823,"./../lang/appquery":651,"./../lang/plugins":726,"./editor_language":569,"./subscription":589,"./utils/editor_exposure":593,"./utils/organization_metadata":595,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/debounce":1311}],490:[function(e,t,n){var r,i,s,o,a,l,c,u,d,p,_,f,h,m,g,v,b=function(e,t){return function(){return e.apply(t,arguments)}};l=n;v=e("./../u");v.edit_mode_only();s=e("./../lib");h=e("./../logger");o=e("../client/analytics");_=e("./utils/editor_exposure");p=e("fast-deep-equal");f=e("./composer/compatibility/composers").get_composer;r=5e3;g=function(){return s().location.get_query().server_bulk_ops==="true"};c=function(e,t,n,r,i){var o;o={appname:a.app().appname(),app_version:a.app().app_version(),event:t,type:n,entries:e};return s().location.post("server://appeditor/run_bulk",o).callback((function(e,t){if(e){i(e);return}if(t!=null?t.length:void 0){r.push.apply(r,t)}return i()}))};l.BulkOperationBox=v.singleton(i=function(){var e;function t(){this.render_current_bulk_operations=b(this.render_current_bulk_operations,this);this.render_errors_list=b(this.render_errors_list,this);this.poll_for_current_operations=b(this.poll_for_current_operations,this);this.server_bulk_ops=b(this.server_bulk_ops,this);this.client_bulk_ops=b(this.client_bulk_ops,this);this.show=b(this.show,this);var e,t,n;this.canvas=v.div(["modal-popup","bulk-operation-popup"],$(document.body));t=v.div("popup-content",this.canvas);t.append(this.create_header());e=v.div("children",t);this.sub_child=v.div("inner-children",e);this.panel=v.div("panel",this.sub_child);n=function(e){return function(){return e.panel.css("max-height",$(window).height()-280)}}(this);$(window).resize(function(e){return function(){if(e._is_open){return n()}}}(this));n();this.sub_child.append(this.create_footer());$(document).off("keydown.escape-uploadcsv");$(document).on("keydown.escape-uploadcsv",function(e){return function(t){if(t.keyCode===27){e.hide()}}}(this));this.current_bulk_operation=v.Box(null);this.all_current_bulk_operations=v.Box(null);this.current_list_interval=null}t.prototype.show=function(e,t,n){var r,i,l,c,m,b,y,w,x,j;this._is_open=true;$("body").css("overflow","hidden");v.velocity(this.canvas,"fadeIn",{duration:300});if(!e){return this.header.text("Please select a view to complete a bulk operation.")}else{this.header.text("Bulk operation - "+a.app_version()+" - "+e.display);this.panel.empty();v.div("instructions caption",this.panel,"This popup lets you run an API workflow on all the entries of the view "+e.display+".");if(n!=null?n.length:void 0){this.mode_node=u.Owner();v.div("type-dropdown-caption view-or-list",this.panel,"List of modify");x=s().sets.get_set("Object")({current_view:"Whole current view",selected_entries:"Selected "+n.length+" entries"});w=f("Dropdown",this.mode_node,{default_value:"current_view",set:x,dropdown_width_override:"extra_extra_large"});w.get_canvas().addClass("bubble-ui");this.panel.append(w.get_canvas())}this.endpoint_node=u.Owner();v.div("type-dropdown-caption",this.panel,"API workflow");i=s().sets.get_set("Filtered")(s().sets.get_set("PageEventsByType")(a.api()),(function(e){var t;t=a.event(e.value);if((typeof t.wf_name==="function"?t.wf_name():void 0)==null){return false}return true}));x=new(s().sets.Set);if(typeof window!=="undefined"&&window!==null?window.composer_revamp:void 0){x=x.filter(function(e){return function(e){return a.event(e.value)!=null}}(this)).map(function(t){return function(t){var n,r,i,s;n=a.event(t.value);i=n.can_be_used_in_bulk(e.type),s=i.response,r=i.message;if(!s){t.disabled=true;t.caption=r}return t}}(this))}else{x.get_options=function(){var t,n,r,s,o,l,c,u,d;u=[];l=i.get_options();for(n=0,r=l.length;n<r;n++){o=l[n];t=a.event(o.value);if(t==null){continue}u.push(o);c=t.can_be_used_in_bulk(e.type),d=c.response,s=c.message;if(!d){o.disabled=true;o.caption=s}}return u}}if(typeof window!=="undefined"&&window!==null?window.composer_revamp:void 0){x=x.with_options({new_option_accelerator:{display:"Edit Backend workflows...",hide_dropdown:true,onClick:function(e){return function(){e.hide();return window.edit_api_workflows()}}(this)}})}else{x.add_new=function(e){return function(){return[{display:"Edit Backend workflows...",hide_dropdown:true,fn:function(){e.hide();return window.edit_api_workflows()}}]}}(this)}j=f("Dropdown",this.endpoint_node,{set:x,optional:true,dropdown_width_override:"extra_extra_large"});j.get_canvas().addClass("bubble-ui");this.panel.append(j.get_canvas());l=v.div("copy-json",this.panel,"(export bulk operation)");l.on("vclick",function(e){return function(){var n,r,i;r=e.endpoint_node.get();i={search:t!=null?t.dehydrate():void 0,workflow_id:r,appname:a.app().appname(),app_version:a.app().app_version()};n=window.btoa(JSON.stringify(i));console.log("");console.log("BULK OPERATION EXPORT");console.log("");console.log("To run this operation in a different environment, please run the following command.");console.log("Command should be run in the bubble folder of the environment to run this operation in.");console.log("It will prompt you for a time to schedule the command to run.  After it runs, an email with the results will be sent to "+d.ADMIN_EMAIL);console.log("The command is:");console.log("");console.log("coffee run_bulk.coffee "+n);console.log("");console.log("");return alert("Please open your javascript panel for instructions on running this bulk operation in another environment")}}(this));b=v.div("do-it-box",this.panel);v.autorun(function(e){return function(){if(e.endpoint_node.get()!=null){b.show();if(d.hide_export_bulk_operation){return l.hide()}else{return l.show()}}else{b.hide();return l.hide()}}}(this));v.div("instructions caption",b,"Fetching the list. Please wait...");this._all_ids=null;this._error=false;if(this._bulk_id==null){this._bulk_id=0}this._bulk_id+=1;y=this._bulk_id;if(this._load_dependency==null){this._load_dependency=v.Dependency()}v.run_once(120,(function(){return t.all_ids()}),function(e){return function(t,n){if(y===e._bulk_id){if(t){h.log(t);e._error=true}else{e._all_ids=n}return e._load_dependency.invalidate()}}}(this));if(g()){r=v.Watcher({fn:function(e){return function(){return e.all_current_bulk_operations.get()}}(this),compare:p});this.list_current_bulk_operations();this.poll_for_current_operations()}v.autorun(function(t){return function(){var r,i,s,l,c;s=(l=t.mode_node)!=null?l.get():void 0;b.empty();if(s==="selected_entries"){r=function(){var e,t,r;r=[];for(e=0,t=n.length;e<t;e++){i=n[e];r.push(i._id())}return r}();c=true}else if(t._error){v.div("instructions caption",b,"There was an issue retreiving the list. Please try again...");return}else{r=t._all_ids;c=false;if(r==null){v.div("instructions caption",b,"Fetching the list. Please wait...");t._load_dependency.register();return}}return function(n){var r;if(!n.length){v.div("instructions caption",b,"This list is empty, nothing to run");return}v.div("instructions caption",b,"You are about to run this workflow on "+n.length+" entries.");v.div("instructions caption",b,"Please be careful as you use this option, this can permanently modify your data.");r=v.div("bubble-ui grey btn run-workflow",b,"Run workflow");return r.on("vclick",(function(){o.track("Data Action Done",{app:a.appname(),action_type:"Bulk API workflow"});_.maybe_increase_event_count(_.EVENTS.DATA_ACTION);b.empty();if(g()){return t.server_bulk_ops(n,e,c)}else{return t.client_bulk_ops(b,j,w,n,e)}}))}(r)}}(this));if(g()){c=v.div("list-running-operations",this.panel);m=v.Box(null);return v.autorun(function(e){return function(){var t;t=r.get();return e.render_current_bulk_operations({all_current_bulk_operations:t,canvas:c})}}(this))}}};t.prototype.hide=function(){if(this.close_button.hasClass("disabled")){return}this._is_open=false;v.velocity(this.canvas,"fadeOut",{duration:300,complete_cb:function(e){return function(){$("body").css("overflow","auto");return e.canvas.hide()}}(this)});return clearInterval(this.current_list_interval)};t.prototype.create_header=function(){this.header=v.div("popup-title");return this.header};t.prototype.create_footer=function(){var e;e=v.div("bottom-stripe");this.close_button=v.div("btn bubble-ui submit-button",e,"CLOSE");this.close_button.on("vclick",function(e){return function(){return e.hide()}}(this));return e};t.prototype.client_bulk_ops=function(e,t,n,r,i){var o,l,u,d,p,_,f,h,g,b,y;this.close_button.addClass("disabled");f=m.get_bar(e),h=f.report_progress,d=f.finish_progress;u=this.endpoint_node.get();if(u==null){return}t.disable();if(n!=null){n.disable()}_=20;y=r.length/_;o=0;l=[];p=function(){return r.slice(_*o,_*(o+1))};g=function(t){return function(){var n,r,s;s=p();if(s.length>0){n=function(){var e,t,n;n=[];for(e=0,t=s.length;e<t;e++){r=s[e];n.push(r)}return n}();h(o+1,y);return c(n,u,i.type,l,(function(n){if(n){e.empty();window.MessagePanel({title:"Bulk Operations",message:n.message});t.close_button.removeClass("disabled");return}o++;return g()}))}else{d();return setTimeout(b,500)}}}(this);b=function(t){return function(){var n,i,o,c,u,d,p;e.empty();t.close_button.removeClass("disabled");if(l.length){v.div("instructions caption",e,"There was some issues with "+l.length+" entries. See details below.");i=v.div("error-box",e);for(o=0,d=l.length;o<d;o++){n=l[o];v.div("error-entry",i,"ID: "+n.id+" - "+n.message)}}else{v.div("instructions caption",e,"Bulk operation run successfully on "+r.length+" entries.");for(u=0,p=r.length;u<p;u++){c=r[u];s().db_instance(a.appname(),a.app_version()).flush(c)}}}}(this);h(0);return setTimeout(g,100)};t.prototype.server_bulk_ops=function(e,t,n){var r,i;r=this.endpoint_node.get();if(r==null){return}i=function(i){return function(){return s().location.post("server://appeditor/schedule_bulk_operation",{appname:a.appname(),app_version:a.app_version(),event_id:r,actual_list:e,view_id:t.id,object_type:t.type,use_selected_entries:n}).callback((function(e,t){var n;if(e!=null){h.log(e);window.MessagePanel({title:"Error scheduling bulk operation",message:(e!=null?e.message:void 0)+":\n\n"+(e!=null?(n=e.args)!=null?n.code:void 0:void 0)+"\n\nPlease try again later."})}else{return i.list_current_bulk_operations()}}))}}(this);return setTimeout(i,100)};t.prototype.cancel_bulk_operation=function(e){var t,n,r,i;t=e.event_id,n=e.initial_timestamp,i=e.use_selected_entries,r=e.operation_div;return s().location.post("server://appeditor/cancel_bulk_operation",{appname:a.appname(),app_version:a.app_version(),event_id:t,initial_timestamp:n,use_selected_entries:i},(function(e,t){if(e){h.log(e);return}if(t.success){return r.remove()}}))};t.prototype.list_current_bulk_operations=function(){return s().location.post("server://appeditor/list_bulk_operations",{appname:a.appname(),app_version:a.app_version()},function(e){return function(t,n){if(t){h.log(t);e.all_current_bulk_operations({error:true,errors:[{_id:"0o0000",message:"Error in getting current list of operations: "+t}]})}if(n!=null){return e.all_current_bulk_operations.set(n)}}}(this))};t.prototype.poll_for_current_operations=function(){clearInterval(this.current_list_interval);return this.current_list_interval=setInterval(function(e){return function(){return e.list_current_bulk_operations()}}(this),r)};t.prototype.render_errors_list=function(e){var t,n,r,i,s,o;r=e.errors,t=e.canvas;t.empty();o=[];for(i=0,s=r.length;i<s;i++){n=r[i];o.push(function(e){return function(e){var n,r;n=v.div("current-task-row light-button",t);r={id:e.id,message:e.message};return v.div("operation-error-row",n,"Failed Entry: "+r.id+"     Error: "+r.message)}}(this)(n))}return o};t.prototype.render_current_bulk_operations=function(t){var n,r,i,s,o,l,c;n=t.all_current_bulk_operations,r=t.canvas;r.empty();i=v.div("list-caption",r);i.text((n!=null?n.length:void 0)>0?"Currently running bulk operations:":"No currently running tasks");c=[];for(s=0,o=n.length;s<o;s++){l=n[s];c.push(function(t){return function(n){var i,s,o,l,c,u,d,p;c=v.div("operation-task-row light-button",r);v.div("operation-row-name",c,(u=a.event(n!=null?n.event_id:void 0))!=null?u.display():void 0);v.div("operation-row-progress",c,e(n));if((n!=null?n.done:void 0)!=null){p=(n!=null?n.error:void 0)!=null?"Show errors ":"";d=v.div("operation-row-cancel light-button",c,p);l=v.div("operation-row-cancel light-button",c,"Hide errors");l.hide();o=v.div("list-operation-errors",c);o.hide();d.on("vclick",(function(){o.show();d.hide();l.show();return t.render_errors_list({errors:n!=null?n.errors:void 0,canvas:o})}));l.on("vclick",(function(){o.hide();l.hide();return d.show()}))}i=(n!=null?n.error:void 0)!=null?"Dismiss":"cancel";s=v.div("operation-row-cancel light-button",c,i);return s.on("vclick",(function(){s.addClass("disabled");s.text("cancelling...");return t.cancel_bulk_operation({event_id:n!=null?n.event_id:void 0,initial_timestamp:n!=null?n.initial_timestamp:void 0,operation_div:c})}))}}(this)(l))}return c};e=function(e){var t,n,r;t=e.entries_complete,r=e.list_length,n=e.error;if(n!=null){return"ERROR: "+(r-t)+"/"+r+" ("+((r-t)/r*100).toFixed(0)+"%) Failed"}if(!r){return"0%"}if(t>r){return"100%"}return t+"/"+r+" ("+(t/r*100).toFixed(0)+"%)"};return t}());u=e("./composer/legacy");a=e("./../lang/appquery");d=e("./../client_config");m=e("./progressbar")},{"../client/analytics":20,"./../client_config":41,"./../lang/appquery":651,"./../lib":741,"./../logger":744,"./../u":823,"./composer/compatibility/composers":532,"./composer/legacy":544,"./progressbar":583,"./utils/editor_exposure":593,"fast-deep-equal":1190}],491:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("./../u/shared/errors");const s=e("../u/client/b_ui");const o=e("../u/shared/async/autorun");const a=e("./../logger");const l=e("../shared/apps_utilities");const{sidePanelMediator:c}=e("./side_panel_mediator");const{get_composer:u}=e("./composer/compatibility/composers");const d={GenericElement:{search_fn:"element"},GenericEvent:{caption:"Event",search_fn:"workflow_item"},Action:{search_fn:"workflow_item"},CustomType:{caption:"Custom type",search_fn:"custom_type"},PrivacyRole:{caption:"Privacy rule",parent_fn:"custom_type",search_fn:"privacy_role"},CustomField:{caption:"Field",parent_fn:"custom_type",search_fn:"field"},OptionSet:{caption:"Option set",search_fn:"option_set"},OptionValue:{caption:"Option",parent_fn:"option_set",search_fn:"value"},OptionAttribute:{caption:"Attribute",parent_fn:"option_set",search_fn:"attribute"},Style:{search_fn:"style"}};class p{constructor(){this.canvas=s.div("comment-panel");$(document.body).append(this.canvas);this.content=s.div("comment-content",this.canvas);this.canvas.css("right",-400);s.div("title",this.content,"Notes");this.see_all_btn=s.div("see-all-button bubble-ui light-grey-btn",this.content);this.see_all_btn.on("vclick",(()=>{this.show_all_comments()}));o.autorun((()=>{if(g.comments().length){this.see_all_btn.show();this.see_all_btn.text("See all ("+g.comments().length+")")}else{this.see_all_btn.hide()}}));this.one_comment_zone=s.div("one-comment-area",this.content);this.all_comments_zone=s.div("all-comments-area",this.content);this.title=s.div("comment-title",this.one_comment_zone);this.comment=s.div("comment-area",this.one_comment_zone);const e=s.div("btn bubble-ui grey close",this.content,"Close");e.on("vclick",(()=>this.hide()));this.canvas.hide();this._is_visible=false;this.observer_id="comment-panel";c.register({id:this.observer_id,onMessage:e=>{if(e==="shown"){this.hide()}}})}display_data(e,t){this.node=e;let n,r;for(const[e,t]of Object.entries(d)){if(this.node instanceof h[e]){var s;r=((s=t.caption)!=null?s:e)+" - ";n=e;break}}if(!n){throw new i.UnexpectedError("Trying to display a comment for something that isnt commentable "+this.node.path())}if(!this._is_visible){return}if(t){this.title.text(r+t.display()+" - "+this.node.display())}else{this.title.text(r+this.node.display())}this.comment.empty();const o=this.node.get_comment_node(t);const a={write_child(e,r){o.set(n,r,t==null?void 0:t.id())},get_expression_owner(){return o}};const l=u("MultilineTextBox",a,{json:o.get_content_node(),no_resize:true,on_blur_only:true});l.get_canvas().addClass("bubble-ui comment-input");setTimeout((()=>{l.get_canvas().css("height",$(window).height()-190-this.title.height())}),20);this.comment.append(l.get_canvas())}show(e,t){if(this._is_visible&&this.node.id()===e.id()&&!this._all_comments){this.hide();return}this.see_all_btn.show();this._all_comments=false;this.one_comment_zone.show();this.all_comments_zone.hide();if(this._is_visible){return}this._is_visible=true;this.display_data(e,t);this.canvas.show();s.velocity(this.canvas,{right:0},{duration:500});c.sendMessage(this.observer_id,"shown")}hide(){s.velocity(this.canvas,{right:-400},{duration:500,complete_cb:()=>{this.canvas.hide();this._is_visible=false}})}show_all_comments(){this._all_comments=true;this.see_all_btn.hide();this.one_comment_zone.hide();this.all_comments_zone.show();this.all_comments_zone.empty();this.all_comments_zone.css("height",$(window).height()-160);o.run_once(30,(()=>{const e=[];let t;for(const r of g.comments()){var n;let i=r.get_type();if(["Event","APIEvent"].includes(i)){i="GenericEvent"}if(["Element","Root"].includes(i)){i="GenericElement"}if(!i){continue}let s=((n=d[i].caption)!=null?n:i)+" - ";let o;if(r.get_parent()){t=g()[d[i].parent_fn](r.get_parent());o=t[d[i].search_fn](r.id());s+=t.display()+" - "+o.display()}else{o=g()[d[i].search_fn](r.id());s+=o.display()}if(o.exists!=null&&!o.exists()){r.set(undefined,null);continue}e.push({type:i,title:s,node:o,parent:t,content:r.get()})}return e}),((e,t)=>{if(e){a.log(e);return}if(!t.length){s.div("all-content",this.all_comments_zone,"You don't have any comment on this app yet.")}for(const{type:e,title:n,node:r,parent:i,content:o}of t){const t=s.div("all-comment-area",this.all_comments_zone);s.div("all-title",t,n);s.div("all-content",t,o);t.on("vclick",(()=>{this.show(r,i);if(e==="Element"){m().reveal_element(r.id())}else{m().show(r)}}))}}))}}const _=o.singleton(p);r.get_button=function(e,t,n,r){if(l.is_local_editable(g.appname())){return}const i=s.div("comment-btn",e);if(t){i.addClass(t)}f.DocumentationPalette().add(i,"Documentation.Interface.Comments");i.on("vclick",(()=>{_().show(n(),r)}));return i};r.update_icon=function(e,t,n){if(!t){return}_().display_data(e,n);o.autorun((()=>{if(e.has_comment(n)){t.addClass("fa fa-comment");t.removeClass("fa fa-comment-o")}else{t.removeClass("fa fa-comment");t.addClass("fa fa-comment-o")}}))};const f=e("./documentationpalette");const h=e("./../lang/lang");const m=e("./highlightbox");const g=e("./../lang/appquery")},{"../shared/apps_utilities":788,"../u/client/b_ui":813,"../u/shared/async/autorun":830,"./../lang/appquery":651,"./../lang/lang":714,"./../logger":744,"./../u/shared/errors":846,"./composer/compatibility/composers":532,"./documentationpalette":565,"./highlightbox":578,"./side_panel_mediator":586,"core-js/modules/web.dom-collections.iterator.js":1123}],492:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Severity=n.ReferencePropertyType=n.PropertyEditorHoverable=n.ElementType=void 0;n.addHighlight=p;n.removeHighlight=_;n.showHoverable=f;var r=e("solid-js/web");var i=e("solid-js");var s=e("../../design/hoverable/Hoverable");var o=e("../../design/hoverable/TooltipArrow");var a=e("../../../utils/property_editor_utils");let l=function(e){e["Alert"]="DWD-alert";e["Error"]="DWD-warning";return e}({});n.Severity=l;let c=function(e){e[e["ButtonWithWorkflow"]=0]="ButtonWithWorkflow";e[e["RepeatingGroupWithData"]=1]="RepeatingGroupWithData";e[e["PopupWithData"]=2]="PopupWithData";return e}({});n.ElementType=c;let u=function(e){e[e["None"]=0]="None";e[e["GroupType"]=1]="GroupType";e[e["DataSource"]=2]="DataSource";e[e["Workflow"]=3]="Workflow";return e}({});n.ReferencePropertyType=u;const d={[c.ButtonWithWorkflow]:{title:"This element needs a workflow",description:`You've just dragged in an element that needs a workflow attached to it to function.\n                            Add a workflow to make this button do what you want.`},[c.PopupWithData]:{title:"This element requires data",description:`You've just added an element that needs data to function.\n                            Choose the type of content and add a data source to make your popup work.`},[c.RepeatingGroupWithData]:{title:"This element requires data",description:`You've just added an element that needs data to function.\n                            Choose the type of content and add a data source to make your repeating group work.`}};function p(e){e==null?void 0:e.addClass(l.Alert)}function _(e){e==null?void 0:e.removeClass(l.Alert)}function f(e,t,n,i){n(t.propertyType);const s=a.property_editor_utils.SpaceExistsToPositionLeft();let l;let p;if(s){l=o.ArrowDirectionEnums.RightTop;if(e===c.ButtonWithWorkflow){p=-10}else{p=-145}}else{l=o.ArrowDirectionEnums.LeftTop;if(e===c.ButtonWithWorkflow){p=305}else{p=180}}(0,r.render)((()=>(0,r.createComponent)(h,{get title(){return d[e].title},get description(){return d[e].description},get referenceElt(){return t.propertyJQuery},showPEIndicator:i,offsetX:p,arrowDirection:l,onHide:()=>{n(u.None)}})),document.body)}const h=e=>(0,r.createComponent)(i.Show,{get when(){return e.showPEIndicator()!==u.None},get children(){return(0,r.createComponent)(s.Hoverable,{get title(){return e.title},get description(){return e.description},delayTime:100,get offsetX(){return e.offsetX},offsetY:-15,onHide:()=>{e.onHide()},class:"pe-visual-indicators",animationClass:"pe-visual-indicators-wrapper",get arrowDirection(){return e.arrowDirection},get referenceElt(){return e.referenceElt}})}});n.PropertyEditorHoverable=h},{"../../../utils/property_editor_utils":597,"../../design/hoverable/Hoverable":505,"../../design/hoverable/TooltipArrow":506,"solid-js":2313,"solid-js/web":2315}],493:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.Breadcrumbs=void 0;var r=e("solid-js/web");var i=e("solid-js");const s=(0,r.template)(`<div></div>`,2),o=(0,r.template)(`<div class="margin-right-10 margin-left-10">></div>`,2),a=(0,r.template)(`<div class="breadcrumb"><div></div></div>`,4);const l=e=>(()=>{const t=s.cloneNode(true);(0,r.insert)(t,(0,r.createComponent)(i.For,{get each(){return e.items},children:(t,n)=>{const s=n()===e.items.length-1;return(()=>{const e=a.cloneNode(true),n=e.firstChild;e.$$click=()=>{var e;return(e=t.onClick)==null?void 0:e.call(t)};n.classList.toggle("greyed",!s);(0,r.insert)(n,(()=>t.label));(0,r.insert)(e,(0,r.createComponent)(i.Show,{when:!s,get children(){return o.cloneNode(true)}}),null);return e})()}}));(0,r.effect)((()=>{var n;return(0,r.className)(t,`breadcrumbs-navigation ${(n=e.class)!=null?n:""}`)}));return t})();n.Breadcrumbs=l;var c=l;n.default=c;(0,r.delegateEvents)(["click"])},{"solid-js":2313,"solid-js/web":2315}],494:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.Button=void 0;var r=e("solid-js/web");var i=e("../../utils/directives");const s=(0,r.template)(`<div></div>`,2);const o=e=>(()=>{const t=s.cloneNode(true);(0,r.use)(i.showThumbnailOnHover,t,(()=>e.documentationID));t.$$click=()=>{if(e.disabled!==true){var t;(t=e.onClick)==null?void 0:t.call(e)}};(0,r.insert)(t,(()=>e.children));(0,r.effect)((n=>{var i,s;const o=`bubble-ui ${e.isNewDesign?"new-button-component":"btn button-component"} ${(i=e.class)!=null?i:""}`,a=(s=e.style)!=null?s:"",l=!!e.disabled,c=!!e.active;o!==n._v$&&(0,r.className)(t,n._v$=o);n._v$2=(0,r.style)(t,a,n._v$2);l!==n._v$3&&t.classList.toggle("disabled",n._v$3=l);c!==n._v$4&&t.classList.toggle("active",n._v$4=c);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined});return t})();n.Button=o;var a=o;n.default=a;(0,r.delegateEvents)(["click"])},{"../../utils/directives":514,"solid-js/web":2315}],495:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.CheckedList=void 0;var r=e("solid-js/web");var i=e("solid-js");const s=(0,r.template)(`<ul></ul>`,2),o=(0,r.template)(`<li class="checked-list-item flex-row"><div class="checked-list-item-check"></div><div class="checked-list-item-content"></div></li>`,6);const a=e=>(()=>{const t=s.cloneNode(true);(0,r.insert)(t,(0,r.createComponent)(i.For,{get each(){return e.list},children:(t,n)=>{const i=()=>n()===e.list.length-1;return(()=>{const e=o.cloneNode(true),n=e.firstChild,s=n.nextSibling;(0,r.insert)(s,t);(0,r.effect)((()=>s.classList.toggle("margin-bottom-12",!i())));return e})()}}));(0,r.effect)((()=>{var n;return(0,r.className)(t,`checked-list ${(n=e.class)!=null?n:""}`)}));return t})();n.CheckedList=a;var l=a;n.default=l},{"solid-js":2313,"solid-js/web":2315}],496:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ContextMenu=_;n.SEPARATOR=void 0;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("@motionone/solid");var s=e("solid-js");var o=a(e("../../../documentationpalette"));function a(e){return e&&e.__esModule?e:{default:e}}const l=(0,r.template)(`<div class="context-menu-item separator"></div>`,2),c=(0,r.template)(`<div></div>`,2);const u=Symbol("ContextMenuSeparator");n.SEPARATOR=u;const d=0;const p=3;function _(e){const[t,n]=(0,s.createSignal)(null);const o=(0,s.createMemo)((()=>{var e;return(e=t())!=null&&e.option.disabled?null:t()}),null,{equals:(e,t)=>(e==null?void 0:e.option)===(t==null?void 0:t.option)});const[a,c]=(0,s.createSignal)(false);(0,s.createEffect)((()=>{var t,n;if((t=o())!=null&&(n=t.option.subOptions)!=null&&n.length){var r;const t=setTimeout((()=>{c(true)}),(r=e.hoverTimeout)!=null?r:d);(0,s.onCleanup)((()=>clearTimeout(t)))}else{c(false)}}));const h=()=>{var t;return(t=e.margin)!=null?t:p};const m=()=>{var e;const t=(e=o())==null?void 0:e.element;if(!t)return{top:0,bottom:0,left:0,right:0};const n=t.getBoundingClientRect();return{top:n.top,bottom:window.innerHeight-n.bottom,left:n.right+h(),right:window.innerWidth-n.left+h()}};const[g,v]=(0,s.createSignal)({});let b;(0,s.createEffect)((()=>{var t;const n=b.offsetHeight;let r;if(e.anchor.top+n+h()<window.innerHeight){r={top:e.anchor.top}}else if(e.anchor.bottom!=null&&e.anchor.bottom+n+h()<window.innerHeight){r={bottom:e.anchor.bottom}}else{r={bottom:h()}}const i=b.offsetWidth;let s;if(e.anchor.left+i+h()<window.innerWidth){s={left:e.anchor.left}}else if(e.anchor.right!=null&&e.anchor.right+i+h()<window.innerWidth){s={right:e.anchor.right}}else{s={right:h()}}const o={...s,...r};const a=Object.fromEntries(Object.entries(o).map((e=>{let[t,n]=e;return[t,`${n}px`]})));v(a);(t=e.onPosition)==null?void 0:t.call(e,o)}));const[y,w]=(0,s.createSignal)({top:0,left:0});return[(0,r.createComponent)(i.Motion.div,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.15}},get["class"](){var t;return(t=e.class)!=null?t:""},onMouseLeave:e=>{var t;if(a()&&(t=o())!=null&&t.option.subOptions){const t=y();if("left"in t){if(e.pageX>=t.left-h()){return}}else{if(e.pageX<=window.innerWidth-t.right+h()){return}}}n(null);c(false)},get style(){return{position:"fixed","z-index":50000004,"margin-top":0,"max-height":`calc(100% - ${h()*2}px)`,...g()}},ref(e){const t=b;typeof t==="function"?t(e):b=e},get children(){return(0,r.createComponent)(s.For,{get each(){return e.options},children:t=>{if(t===u){return l.cloneNode(true)}else{return(0,r.createComponent)(f,(0,r.mergeProps)(t,{onClick:r=>{var i,s,o;(i=e.onSelection)==null?void 0:i.call(e,t);(s=t.onClick)==null?void 0:s.call(t,r);if((o=t.subOptions)!=null&&o.length){n({option:t,element:r.currentTarget});c(true)}},onMouseEnter:e=>n({option:t,element:e.currentTarget})}))}}})}}),(0,r.createComponent)(s.Show,{get when(){var e;return(0,r.memo)((()=>!!a()))()&&((e=o())==null?void 0:e.option.subOptions)},keyed:true,children:t=>(0,r.createComponent)(_,(0,r.mergeProps)(e,{options:t,get anchor(){return m()},onPosition:w}))})]}function f(e){let t;(0,s.onMount)((()=>{o.default.DocumentationPalette().add($(t),`Documentation.Interface.Menu.${e.text}`)}));return(()=>{const n=c.cloneNode(true);const i=t;typeof i==="function"?(0,r.use)(i,n):t=n;(0,r.addEventListener)(n,"mouseenter",e.onMouseEnter);n.$$click=t=>{if(!e.disabled){var n;(n=e.onClick)==null?void 0:n.call(e,t)}};(0,r.insert)(n,(()=>e.text));(0,r.effect)((()=>{var t,i;return(0,r.className)(n,`context-menu-item ${(t=e.icon)!=null?t:""} ${(i=e.subOptions)!=null&&i.length?"right-arrow":""} ${e.disabled?"disabled":""}`)}));return n})()}(0,r.delegateEvents)(["click"])},{"../../../documentationpalette":565,"@motionone/solid":925,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],497:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.initializeContextMenu=c;n.showContextMenu=l;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("./ContextMenu");const[o,a]=(0,i.createSignal)(null);function l(e){a(e)}function c(e){return(0,r.render)((()=>(0,r.createComponent)(i.Show,{get when(){return o()},keyed:true,children:e=>(0,r.createComponent)(s.ContextMenu,e)})),e)}},{"./ContextMenu":496,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],498:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.AutocompleteDropdown=p;n.default=void 0;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("./Dropdown");var o=l(e("../text/Text"));var a=e("../../utils/prop_utils");function l(e){return e&&e.__esModule?e:{default:e}}const c=(0,r.template)(`<input>`,1),u=(0,r.template)(`<div class="dropdown-icon fa fa-caret-down"></div>`,2);const d="More...";function p(e){var t;let n;const[l,p]=(0,i.createSignal)(null);const _=(0,i.createMemo)((()=>{const t=e.contents.find((t=>e.equals(t.value,e.currentlySelected)));if(!t){return e.contents.get_display_for_literal(e.currentlySelected)}else{return t==null?void 0:t.display}}));const f=(0,i.createMemo)((()=>{var e,t;return(e=(t=l())!=null?t:_())!=null?e:""}));const h=(0,i.createMemo)((()=>e.contents.filter((e=>{const t=l();if(t!=null){return e.display.toLowerCase().includes(t.trim().toLowerCase())}else{return true}}))));const[m,g]=(0,i.createSignal)(null,{equals:false});const[v,b]=(t=e.showingSignal)!=null?t:(0,i.createSignal)(false);function y(){g(null);p(null);b(false)}(0,i.createEffect)((()=>{if(l()!=null){g({sectionIdx:0,itemIdx:0})}}));function w(t){const n=l();if(n!=null){const r=e.contents.get_value_for_literal(n);if(r!==undefined){e.onSelect(r,t);p(null)}}}(0,i.createEffect)((()=>{if(v()){$(n).select()}else{(0,i.untrack)(w)}}));return(0,r.createComponent)(s.Dropdown,(0,r.mergeProps)(e,{onSelect:(t,n)=>{e.onSelect(t,n);y()},get contents(){return h()},get overrideHover(){return m()},get dropdownOpen(){return v()},get hideAccelerators(){return l()!=null},get disableCollapse(){return(0,r.memo)((()=>l()!=null))()&&l()!==""},setDropdownOpen:(t,r)=>{if(e.disabled){return}if(t){b(true)}else if(!$(n).is(":focus")&&v()){if(r==="ClickOutside"){w("user-click")}y()}},onKeyDown:t=>{let r=false;if(v()){switch(t.key){case"Escape":if(!v()){y();r=true}break;case"Backspace":if($(n).val()===""){e.onSelect(null,"keyboard-input");y();t.preventDefault()}r=true;break;case"Enter":{const t=e.contents.get_value_for_literal(f());if(t!==undefined){e.onSelect(t,"keyboard-input");y();r=true}break}case"ArrowLeft":{if(n.selectionStart!==0||n.selectionEnd!==n.selectionStart){r=true}break}case"ArrowRight":{if(n.selectionStart!==n.value.length||n.selectionEnd!==n.selectionStart){r=true}}}}if(r){t.stopPropagation()}else{var i;(i=e.onKeyDown)==null?void 0:i.call(e,t)}},get children(){return[(0,r.createComponent)(i.Show,{get when(){return v()},get children(){const t=c.cloneNode(true);t.$$input=t=>{var n;p(t.currentTarget.value);(n=e.onFilterChanged)==null?void 0:n.call(e,t.currentTarget.value)};(0,r.use)((e=>{n=e}),t);(0,r.effect)((n=>{var i,s;const o=(0,a.merge_class_lists)({"autocomplete-input":true,[(i=e.class)!=null?i:""]:true},e.classList),l=(s=e.autcompletePlaceholder)!=null?s:"Search...";n._v$=(0,r.classList)(t,o,n._v$);l!==n._v$2&&(0,r.setAttribute)(t,"placeholder",n._v$2=l);return n}),{_v$:undefined,_v$2:undefined});(0,r.effect)((()=>t.value=f()));return t}}),(0,r.createComponent)(i.Show,{get when(){return!v()},get children(){return(0,r.createComponent)(o.default,{get classList(){var t;return(0,a.merge_class_lists)({"dropdown-caption":true,[(t=e.class)!=null?t:""]:true,empty:_()==null&&e.captionPlaceholder==null},e.classList)},get children(){var t,n,r;return(t=(n=(r=_())!=null?r:e.captionPlaceholder)!=null?n:e.onClickAffordance)!=null?t:d}})}}),(0,r.createComponent)(i.Show,{get when(){return!e.hideArrow},get children(){return u.cloneNode(true)}})]}}))}var _=p;n.default=_;(0,r.delegateEvents)(["input"])},{"../../utils/prop_utils":516,"../text/Text":512,"./Dropdown":499,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],499:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Dropdown=m;n.equalByReference=h;n.hoveredItemEquality=f;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("solid-js/store");var o=e("../../utils/directives");var a=e("./DropdownSection");var l=e("../../utils/prop_utils");var c=e("../../../../webfonts");var u=e("../../utils/observerUtils");const d=(0,r.template)(`<div><div><div class="items-inner-container"></div></div></div>`,6),p=(0,r.template)(`<div><div></div></div>`,4);const _=-1;function f(e,t){return(e==null?void 0:e.sectionIdx)===(t==null?void 0:t.sectionIdx)&&(e==null?void 0:e.itemIdx)===(t==null?void 0:t.itemIdx)}function h(e,t){return e===t}function m(e){let t,n;const h=e.contents.get_new_option_accelerator();const[m,g]=(0,i.createSignal)(null,{equals:f});const v=(0,i.createSelector)(m,((e,t)=>(t==null?void 0:t.sectionIdx)===e.sectionIdx&&(e.itemIdx==null||e.itemIdx===t.itemIdx)));(0,i.createEffect)((t=>{if(t!==undefined){var n;g((n=e.overrideHover)!=null?n:null)}return e.overrideHover}),undefined);const[b,y]=(0,s.createStore)({});(0,i.createEffect)((()=>{if(e.disableCollapse){(0,i.untrack)((()=>{for(const e in b){y(e,false)}}))}}));const w=(0,i.createMemo)((()=>{if(e.contents.is_optional()&&!e.hideAccelerators){return _}else{return 0}}));const x=(0,i.createMemo)((()=>{const t=e.contents.section_names().length;if(h&&!e.hideAccelerators){return t}else{return t-1}}));function j(t){var n;if(t==null){return[]}const r=e.contents.section_names()[t];return(n=e.contents.section(r))!=null?n:[]}function A(t){var n;return(n=e.contents.section_names()[t!=null?t:-1])!=null?n:"[None]"}function M(t){if(t==null){return 0}const n=e.contents.section_names()[t];if(n==null||n===""||!e.contents.should_show_sections()||e.disableCollapse){return 0}else{return a.SECTION_TITLE_IDX}}function E(){if(!e.dropdownOpen){return false}const t=m();if(t==null||t.itemIdx<=M(t.sectionIdx)){var n;let e=((n=t==null?void 0:t.sectionIdx)!=null?n:_)-1;if(e<w()){e=x()}const r=b[A(e)]?a.SECTION_TITLE_IDX:j(e).length-1;g({sectionIdx:e,itemIdx:r})}else{g({sectionIdx:t.sectionIdx,itemIdx:t.itemIdx-1})}return true}function k(){if(!e.dropdownOpen){return false}const t=m();if(t===null||t.itemIdx>=j(t.sectionIdx).length-1||t.itemIdx===a.SECTION_TITLE_IDX&&M(t.sectionIdx)===a.SECTION_TITLE_IDX&&b[A(t.sectionIdx)]){var n;let e=((n=t==null?void 0:t.sectionIdx)!=null?n:x())+1;if(e>x()){e=w()}g({sectionIdx:e,itemIdx:M(e)})}else{g({sectionIdx:t.sectionIdx,itemIdx:t.itemIdx+1})}return true}const O={ArrowUp:E,ArrowDown:k,Enter:()=>{if(!e.dropdownOpen){open();return true}const t=m();const n=t?j(t.sectionIdx)[t.itemIdx]:null;if(n!=null){e.onSelect(n.value,"keyboard-input");return true}else if(!e.disableCollapse&&t!=null&&t.sectionIdx>=0&&t.sectionIdx<e.contents.section_names().length&&t.itemIdx===a.SECTION_TITLE_IDX){y(A(t.sectionIdx),(e=>!e));return true}else if(e.contents.is_optional()&&(t==null?void 0:t.sectionIdx)===w()&&!e.hideAccelerators){e.onSelect(null,"keyboard-input");return true}else if(h!=null&&(t==null?void 0:t.sectionIdx)===x()&&!e.hideAccelerators){C();return true}else if(!e.dropdownOpen){e.setDropdownOpen(true,"CaptionClick");return true}else{return false}}};function S(e){return e in O}function D(e,n,r){const i=r.target.getBoundingClientRect();const s=t.parentElement.getBoundingClientRect();if(i.top<s.bottom&&i.bottom>s.top){g({sectionIdx:e,itemIdx:n})}}function C(){if(h!=null&&h.hide_dropdown){e.setDropdownOpen(false,"SectionClick")}h==null?void 0:h.onClick((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}let[i,s]=n;if(i){e.onSelect(s,"user-click")}}))}let T;let N;const[P,I]=(0,i.createSignal)("");function R(){var e;let t=false;(e=T)==null?void 0:e.each((function(){t||(t=this.scrollTop>0)}));if(t){var n;const e=(n=N.getBoundingClientRect().top)!=null?n:0;I(`${e}px`)}else{I("")}}(0,u.observePropertyEditorMovement)((()=>N),R,(()=>e.dropdownOpen),(e=>{T=e}));let L;const z=new Set;function B(e){e.forEach((e=>{if(e.isIntersecting){z.add(e.target)}else{z.delete(e.target)}}));const t=n.scrollTop;setTimeout((()=>{if(t===n.scrollTop){const e=[];for(const t of z){if((t==null?void 0:t.fontFamily)!=null&&!c.already_loaded.includes(t.fontFamily)){e.push(t.fontFamily)}}(0,c.load_for_preview)(e)}}),500)}return(()=>{const s=p.cloneNode(true),c=s.firstChild;s.$$keydown=t=>{var n;let r=false;if(S(t.key)&&!((n=e.disabledKeyboardInputs)!=null&&n.includes(t.key))){r=O[t.key]()}if(r){t.stopPropagation()}else{var i;(i=e.onKeyDown)==null?void 0:i.call(e,t)}};s.addEventListener("mouseleave",(()=>{var t;(t=e.onHover)==null?void 0:t.call(e,false);g(null)}));s.addEventListener("mouseenter",(()=>{var t;(t=e.onHover)==null?void 0:t.call(e,true)}));s.$$focusout=()=>{var t;(t=e.onBlur)==null?void 0:t.call(e)};s.$$focusin=()=>{var t;(t=e.onFocus)==null?void 0:t.call(e)};(0,r.use)((t=>{var n;(n=e.directive)==null?void 0:n.call(e,t);(0,o.clickOutside)(t,(()=>()=>{e.setDropdownOpen(false,"ClickOutside");g(null)}))}),s);c.$$click=()=>{e.setDropdownOpen(!e.dropdownOpen,"CaptionClick");if(e.dropdownOpen&&e.onOpen!=null){e.onOpen()}};(0,r.insert)(c,(()=>e.children));(0,r.insert)(s,(0,r.createComponent)(i.Show,{get when(){return e.dropdownOpen},get children(){const s=d.cloneNode(true),o=s.firstChild,c=o.firstChild;(0,r.use)((e=>{N=e}),s);(0,r.use)((e=>{var t;n=e;(t=L)==null?void 0:t.disconnect();L=new IntersectionObserver(B,{root:e})}),o);(0,r.use)((e=>{t=e}),c);(0,r.insert)(c,(0,r.createComponent)(i.Show,{get when(){return e.contents.is_optional()&&!e.hideAccelerators},get children(){return(0,r.createComponent)(a.DropdownSection,{scrollContainer:n,sectionName:"empty",get showArrow(){return!e.disableCollapse},sectionIdx:_,get sectionContents(){var t;return[{display:(t=e.emptyDisplay)!=null?t:"(Clear selection)",value:null}]},get isHoveredItem(){return v.bind(null,{sectionIdx:_})},isSelected:()=>false,onClick:()=>e.onSelect(null,"user-click"),get onMouseMove(){return D.bind(null,_)},get["class"](){return e.class},get classList(){return e.classList},setCollapsed:()=>{}})}}),null);(0,r.insert)(c,(0,r.createComponent)(i.For,{get each(){return e.contents.section_names()},children:(t,i)=>{var s;const o=(s=e.contents.section_classes()[t])!=null?s:[];return(0,r.createComponent)(a.DropdownSection,{scrollContainer:n,sectionName:t,get showTitle(){return e.contents.should_show_sections()},get showArrow(){return!e.disableCollapse},get sectionIdx(){return i()},get sectionContents(){var n;return(n=e.contents.section(t))!=null?n:[]},isHoveredItem:e=>v({sectionIdx:i(),itemIdx:e}),section_classes:o,isSelected:t=>e.equals(e.currentlySelected,t),onClick:t=>{e.setDropdownOpen(false,"SectionClick");e.onSelect(t,"user-click")},get onMouseMove(){return D.bind(null,i())},get["class"](){return e.class},get classList(){return e.classList},get collapsed(){return b[t]},setCollapsed:n=>{if(!e.disableCollapse){y(t,n)}},get virtualizeMetadata(){return e.contents.get_virtualize_options()},ref:e=>{var t;(t=L)==null?void 0:t.observe(e)}})}}),null);(0,r.insert)(c,(0,r.createComponent)(i.Show,{get when(){return h!=null&&!e.hideAccelerators},get children(){return(0,r.createComponent)(a.DropdownSection,{scrollContainer:n,sectionName:"new",showTitle:false,get showArrow(){return!e.disableCollapse},get sectionIdx(){return x()},get sectionContents(){var e;return[{display:(e=h==null?void 0:h.display)!=null?e:"",value:null}]},get isHoveredItem(){return v.bind(null,{sectionIdx:x()})},isSelected:()=>false,onClick:C,get onMouseMove(){return D.bind(null,x())},get["class"](){return e.class},get classList(){return e.classList},collapsed:false,setCollapsed:()=>{}})}}),null);(0,r.effect)((t=>{var n,i;const a=(0,l.merge_class_lists)({"dropdown-items-positioner":true,[(n=e.class)!=null?n:""]:true},e.classList),c=(0,l.merge_class_lists)({"dropdown-items-container":true,[(i=e.class)!=null?i:""]:true},e.classList),u=P();t._v$=(0,r.classList)(s,a,t._v$);t._v$2=(0,r.classList)(o,c,t._v$2);u!==t._v$3&&o.style.setProperty("top",t._v$3=u);return t}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return s}}),null);(0,r.effect)((t=>{var n,i;const o=(0,l.merge_class_lists)({"dropdown-container":true,[(n=e.class)!=null?n:""]:true,[e.contents.get_dropdown_width()]:true,opened:e.dropdownOpen},e.classList),a=(0,l.merge_class_lists)({"dropdown-caption-container":true,[(i=e.class)!=null?i:""]:true,selected:e.dropdownOpen},e.classList);t._v$4=(0,r.classList)(s,o,t._v$4);t._v$5=(0,r.classList)(c,a,t._v$5);return t}),{_v$4:undefined,_v$5:undefined});return s})()}(0,r.delegateEvents)(["focusin","focusout","keydown","click"])},{"../../../../webfonts":858,"../../utils/directives":514,"../../utils/observerUtils":515,"../../utils/prop_utils":516,"./DropdownSection":501,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/store":2314,"solid-js/web":2315}],500:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.DropdownItem=f;var r=e("solid-js/web");var i=e("solid-js");var s=d(e("../../../../webfonts"));var o=e("../../utils/prop_utils");var a=c(e("../text/Text"));var l=e("../../utils/directives");function c(e){return e&&e.__esModule?e:{default:e}}function u(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=u(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const p=(0,r.template)(`<div class="fa fa-trash-o item-delete"></div>`,2),_=(0,r.template)(`<div><div></div></div>`,4);function f(e){let t;(0,i.onMount)((()=>{(0,i.createEffect)((()=>{if(e.isHoveredItem(e.curItem)){t.scrollIntoView({block:"nearest"})}}))}));const n=(0,i.createMemo)((()=>e.item.font_family!=null?s.get_quoted_face_and_variant(e.item.font_family):undefined));const c=()=>{const e=n();return(e==null?void 0:e.font_family)!=null?`${e.font_family}, Source Sans 3`:undefined};const u=()=>{var e,t;return((e=n())==null?void 0:e.font_family)!=null?(t=n())==null?void 0:t.variant:undefined};return(()=>{const n=_.cloneNode(true),s=n.firstChild;(0,r.use)(l.showThumbnailOnHover,n,(()=>e.item.documentation_id));n.$$mousemove=t=>e.onMouseMove(e.curItem,t);(0,r.use)((e=>{t=e}),n);n.$$click=()=>{if(!e.item.disabled){e.onClick(e.item.value)}};(0,r.use)((t=>{var n;t.fontFamily=e.item.font_family;(n=e.ref)==null?void 0:n.call(e,t)}),s);(0,r.insert)(s,(()=>e.item.display),null);(0,r.insert)(s,(0,r.createComponent)(i.Show,{get when(){return e.item.caption!=null},get children(){return(0,r.createComponent)(a.default,{get classList(){var t,n,r;return(0,o.merge_class_lists)({"disabled-caption":(t=e.item.disabled)!=null?t:false,"context-caption":(n=!e.item.disabled)!=null?n:false,[(r=e.class)!=null?r:""]:true},e.classList)},get children(){return e.item.caption}})}}),null);(0,r.insert)(n,(0,r.createComponent)(i.Show,{get when(){return e.item.delete_fn!=null},get children(){const t=p.cloneNode(true);t.$$click=()=>{e.item.delete_fn()};return t}}),null);(0,r.effect)((t=>{var i,a,l,d;const p=(i=e.extraStyling)!=null?i:{},_=(0,o.merge_class_lists)({"dropdown-item-container":true,hovered:e.isHoveredItem(e.curItem),selected:e.isSelected(e.item.value),disabled:(a=e.item.disabled)!=null?a:false},e.classList),f=(0,o.merge_class_lists)({"dropdown-item":true,[(l=e.class)!=null?l:""]:true},e.classList),h=c()!=null?{"font-family":c(),"font-weight":(d=u())!=null?d:undefined}:{},m=e.curItem;t._v$=(0,r.style)(n,p,t._v$);t._v$2=(0,r.classList)(n,_,t._v$2);t._v$3=(0,r.classList)(s,f,t._v$3);t._v$4=(0,r.style)(s,h,t._v$4);m!==t._v$5&&(0,r.setAttribute)(s,"data-index",t._v$5=m);return t}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined,_v$5:undefined});return n})()}(0,r.delegateEvents)(["click","mousemove"])},{"../../../../webfonts":858,"../../utils/directives":514,"../../utils/prop_utils":516,"../text/Text":512,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],501:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.DropdownSection=p;n.SECTION_TITLE_IDX=void 0;var r=e("solid-js/web");var i=e("solid-js");var s=c(e("../text/Text"));var o=e("../../utils/prop_utils");var a=e("./DropdownItem");var l=e("./VirtualizedSectionContents");function c(e){return e&&e.__esModule?e:{default:e}}const u=(0,r.template)(`<div></div>`,2);const d=-1;n.SECTION_TITLE_IDX=d;function p(e){let t;const n=()=>!!e.showTitle&&e.sectionName!=="";(0,i.createEffect)((()=>{if(n()&&e.isHoveredItem(d)&&t){t.scrollIntoView({block:"nearest"})}}));return(()=>{const c=u.cloneNode(true);(0,r.insert)(c,(0,r.createComponent)(i.Show,{get when(){return n()},get children(){const n=u.cloneNode(true);(0,r.use)((e=>{t=e}),n);n.$$click=()=>{e.setCollapsed(!e.collapsed)};n.$$mousemove=t=>e.onMouseMove(d,t);(0,r.insert)(n,(0,r.createComponent)(s.default,{class:"title-div",get children(){return e.sectionName.toUpperCase()}}),null);(0,r.insert)(n,(0,r.createComponent)(i.Show,{get when(){return e.showArrow},get children(){const t=u.cloneNode(true);(0,r.effect)((n=>{var i,s;return(0,r.classList)(t,(0,o.merge_class_lists)({"dropdown-icon":true,fa:true,"fa-caret-left":(i=e.collapsed)!=null?i:false,"fa-caret-down":!((s=e.collapsed)!=null?s:false)},e.classList),n)}));return t}}),null);(0,r.effect)((t=>{var i;return(0,r.classList)(n,(0,o.merge_class_lists)({"section-title":true,[e.sectionName]:true,[(i=e.class)!=null?i:""]:true,hovered:e.isHoveredItem(d)},e.classList),t)}));return n}}),null);(0,r.insert)(c,(0,r.createComponent)(i.Show,{get when(){return!e.collapsed},get children(){return(0,r.createComponent)(i.Show,{get when(){var t;return((t=e.virtualizeMetadata)==null?void 0:t.virtualize)&&e.sectionContents.length*l.STANDARD_DROPDOWN_ITEM_SIZE>_&&e.virtualizeMetadata},keyed:true,get fallback(){return(0,r.createComponent)(i.For,{get each(){return e.sectionContents},children:(t,n)=>(0,r.createComponent)(a.DropdownItem,(0,r.mergeProps)(e,{item:t,get curItem(){return n()}}))})},children:t=>(0,r.createComponent)(l.VirtualizedSectionContents,(0,r.mergeProps)(e,t))})}}),null);(0,r.effect)((()=>{var t,n;return(0,r.className)(c,`section ${e.sectionName} ${(t=(n=e.section_classes)==null?void 0:n.join(" "))!=null?t:""}`)}));return c})()}const _=350;(0,r.delegateEvents)(["mousemove","click"])},{"../../utils/prop_utils":516,"../text/Text":512,"./DropdownItem":500,"./VirtualizedSectionContents":502,"solid-js":2313,"solid-js/web":2315}],502:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.STANDARD_DROPDOWN_ITEM_SIZE=void 0;n.VirtualizedSectionContents=l;var r=e("solid-js/web");var i=e("solid-js");var s=e("@tanstack/solid-virtual");var o=e("./DropdownItem");const a=(0,r.template)(`<div></div>`,2);function l(e){var t;const n=(0,s.createVirtualizer)({count:e.sectionContents.length,overscan:(t=e.overscan_count)!=null?t:0,estimateSize:()=>c,getScrollElement:()=>e.scrollContainer});(0,i.createEffect)((()=>{let t;if(n.options.count!==e.sectionContents.length){t={count:e.sectionContents.length}}if(n.options.overscan!==e.overscan_count){var r,i;(r=t)!=null?r:t={};t.overscan=(i=e.overscan_count)!=null?i:0}if(t){n.setOptions({...n.options,...t})}}));return(()=>{const t=a.cloneNode(true);t.style.setProperty("width","233px");t.style.setProperty("position","relative");(0,r.insert)(t,(0,r.createComponent)(i.For,{get each(){return n.getVirtualItems()},children:t=>(0,r.createComponent)(o.DropdownItem,(0,r.mergeProps)(e,{get item(){return e.sectionContents[t.index]},get curItem(){return t.index},get extraStyling(){return{position:"absolute",top:0,left:0,transform:`translateY(${t.start}px)`,display:"flex","justify-content":"space-between",width:"233px"}},ref:t=>{var r;(r=e.ref)==null?void 0:r.call(e,t);n.measureElement(t)}}))}));(0,r.effect)((()=>t.style.setProperty("height",`${n.getTotalSize()}px`)));return t})()}const c=28;n.STANDARD_DROPDOWN_ITEM_SIZE=c},{"./DropdownItem":500,"@tanstack/solid-virtual":949,"solid-js":2313,"solid-js/web":2315}],503:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.FloatingWindow=s;var r=e("solid-js/web");const i=(0,r.template)(`<div></div>`,2);function s(e){return(0,r.createComponent)(r.Portal,{get children(){const t=i.cloneNode(true);(0,r.insert)(t,(()=>e.children));(0,r.effect)((n=>{var i,s;const o=`floating-window ${(i=e.class)!=null?i:""}`,a=(s=e.classList)!=null?s:{};o!==n._v$&&(0,r.className)(t,n._v$=o);n._v$2=(0,r.classList)(t,a,n._v$2);return n}),{_v$:undefined,_v$2:undefined});return t}})}},{"solid-js/web":2315}],504:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.InformationalFloatingWindow=d;n.default=void 0;var r=e("solid-js/web");var i=e("solid-js");var s=e("./FloatingWindow");var o=e("../text/Text");var a=l(e("../button/Button"));function l(e){return e&&e.__esModule?e:{default:e}}const c=(0,r.template)(`<div class="header"><div class="title-container"><div class="close-x-button"></div></div></div>`,6),u=(0,r.template)(`<div class="bottom-bar display-flex"></div>`,2);function d(e){return(0,r.createComponent)(s.FloatingWindow,{get["class"](){var t;return"informational-floating-window display-flex flex-column "+((t=e.class)!=null?t:"")},get children(){return[(()=>{const t=c.cloneNode(true),n=t.firstChild,i=n.firstChild;(0,r.insert)(n,(0,r.createComponent)(o.Text,{class:"window-title",get children(){return e.title}}),i);i.$$click=()=>{var t;e.onHide?e.onHide():(t=e.onCancel)==null?void 0:t.call(e)};(0,r.insert)(t,(0,r.createComponent)(o.Text,{class:"window-subtitle",get children(){return e.description}}),null);return t})(),(0,r.memo)((()=>e.children)),(()=>{const t=u.cloneNode(true);(0,r.insert)(t,(0,r.createComponent)(i.Show,{get when(){return e.cancelText},get children(){return(0,r.createComponent)(a.default,{class:"cancel-button no-outline",isNewDesign:true,onClick:()=>{var t;return(t=e.onCancel)==null?void 0:t.call(e)},get children(){return e.cancelText}})}}),null);(0,r.insert)(t,(0,r.createComponent)(i.Show,{get when(){var t;return(t=e.secondaryText)==null?void 0:t.length},get children(){return(0,r.createComponent)(a.default,{class:"cancel-button no-outline",isNewDesign:true,onClick:()=>{var t;return(t=e.onSecondary)==null?void 0:t.call(e)},get children(){return e.secondaryText}})}}),null);(0,r.insert)(t,(0,r.createComponent)(a.default,{class:"confirm-button action",isNewDesign:true,get onClick(){return e.onConfirm},get children(){return e.confirmText}}),null);return t})()]}})}var p=d;n.default=p;(0,r.delegateEvents)(["click"])},{"../button/Button":494,"../text/Text":512,"./FloatingWindow":503,"solid-js":2313,"solid-js/web":2315}],505:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.Hoverable=void 0;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("@motionone/solid");var o=u(e("./../text/Text"));var a=u(e("../button/Button"));var l=e("./TooltipArrow");var c=e("../../../../constants/images");function u(e){return e&&e.__esModule?e:{default:e}}const d=(0,r.template)(`<div class="close-x-button"></div>`,2),p=(0,r.template)(`<div class="hoverable-instruction-box-content"><img class="hoverable-instruction-box-icon"></div>`,3),_=(0,r.template)(`<div class="btn btn-cancel"></div>`,2),f=(0,r.template)(`<div class="btn-row"></div>`,2),h=(0,r.template)(`<div><div></div><div class="hoverable-content"><div class="hoverable-header"></div><div class="custom-content"></div></div></div>`,10);const m=e=>{var t,n,u,m;(0,i.createEffect)((()=>{const t=t=>{var n;if(t.key==="Enter"||t.key===" "||t.key==="Spacebar")(n=e.onPrimary)==null?void 0:n.call(e)};window.addEventListener("keydown",t);(0,i.onCleanup)((()=>window.removeEventListener("keydown",t)))}));const g=$(e.referenceElt);const[v,b]=(0,i.createSignal)(false);const[y,w]=(0,i.createSignal)((t=(n=g.offset())==null?void 0:n.top)!=null?t:0);const[x,j]=(0,i.createSignal)((u=(m=g.offset())==null?void 0:m.left)!=null?u:0);const[A,M]=(0,i.createSignal)("");const[E,k]=(0,i.createSignal)({});(0,i.createEffect)((t=>{const n=$(e.referenceElt);$(t).removeClass("hotspot");if(e.addHotspotToRef&&v()){n.addClass("hotspot")}else{n.removeClass("hotspot")}return e.referenceElt}),"");function O(){switch(e.arrowDirection){case l.ArrowDirectionEnums.TopLeft:case l.ArrowDirectionEnums.TopRight:{var t,n;M(`translate(${x()+((t=e.offsetX)!=null?t:0)}px, calc(${y()+((n=e.offsetY)!=null?n:0)}px + var(--arrow_size))`);break}case l.ArrowDirectionEnums.RightTop:case l.ArrowDirectionEnums.RightBottom:{var r,i;M(`translate(calc(${x()+((r=e.offsetX)!=null?r:0)}px - 100% - var(--arrow_size)), ${y()+((i=e.offsetY)!=null?i:0)}px)`);break}case l.ArrowDirectionEnums.BottomRight:case l.ArrowDirectionEnums.BottomLeft:{var s,o;M(`translate(${x()+((s=e.offsetX)!=null?s:0)}px, calc(${y()+((o=e.offsetY)!=null?o:0)}px - 100% - var(--arrow_size)))`);break}case l.ArrowDirectionEnums.LeftBottom:case l.ArrowDirectionEnums.LeftTop:{var a,c;M(`translate(calc(${x()+((a=e.offsetX)!=null?a:0)}px + var(--arrow_size)), ${y()+((c=e.offsetY)!=null?c:0)}px)`);break}default:{var u,d;M(`translate(${x()+((u=e.offsetX)!=null?u:0)}px, calc(${y()+((d=e.offsetY)!=null?d:0)}px`);break}}}const S=setInterval((()=>{(0,i.batch)((()=>{var t,n,r,i;const s=$(e.referenceElt);const o=$(e.additionalRefElt);if(s.is(":visible")){var a;setTimeout((()=>{if(s.is(":visible"))b(true)}),(a=e.delayTime)!=null?a:50)}else if(v()&&!s.is(":visible")&&!$(o).is(":visible")){var l;(l=e.onRefEltDisappears)==null?void 0:l.call(e);b(false)}else if(!s.is(":visible")){b(false)}w((t=(n=s.offset())==null?void 0:n.top)!=null?t:0);j((r=(i=s.offset())==null?void 0:i.left)!=null?r:0);O()}))}),50);(0,i.onCleanup)((()=>{clearInterval(S);$(e.referenceElt).removeClass("hotspot")}));(0,i.createEffect)((()=>{if(e.animate){const t={opacity:[0,1]};switch(e.arrowDirection){case l.ArrowDirectionEnums.TopLeft:case l.ArrowDirectionEnums.TopRight:t.y=[20,0];break;case l.ArrowDirectionEnums.BottomLeft:case l.ArrowDirectionEnums.BottomRight:t.y=[-20,0];break;case l.ArrowDirectionEnums.LeftTop:case l.ArrowDirectionEnums.LeftBottom:t.x=[20,0];break;case l.ArrowDirectionEnums.RightTop:case l.ArrowDirectionEnums.RightBottom:t.x=[-20,0];break}k(t)}}));return(0,r.createComponent)(s.Presence,{exitBeforeEnter:true,get children(){return(0,r.createComponent)(i.Show,{get when(){return v()},keyed:true,get children(){return(0,r.createComponent)(s.Motion,{get["class"](){return e.animationClass?"hoverable-animation "+e.animationClass:"hoverable-animation"},get animate(){return E()},transition:{duration:.3,easing:"ease-out"},exit:{opacity:0},get children(){const t=h.cloneNode(true),n=t.firstChild,s=n.nextSibling,l=s.firstChild,u=l.nextSibling;(0,r.insert)(l,(0,r.createComponent)(o.default,{class:"title",get children(){return e.title}}),null);(0,r.insert)(l,(0,r.createComponent)(i.Show,{get when(){return e.onHide},get children(){const t=d.cloneNode(true);t.$$click=()=>{var t;(t=e.onHide)==null?void 0:t.call(e)};return t}}),null);(0,r.insert)(s,(0,r.createComponent)(i.Show,{get when(){return e.description},get children(){return(0,r.createComponent)(o.default,{class:"description",get children(){return e.description}})}}),u);(0,r.insert)(u,(()=>e.customContent));(0,r.insert)(s,(0,r.createComponent)(i.Show,{get when(){return e.instructionBoxContent},get children(){const t=p.cloneNode(true),n=t.firstChild;(0,r.setAttribute)(n,"src",c.HOVERABLE_INSTRUCTION_BOX_ICON);(0,r.insert)(t,(()=>e.instructionBoxContent),null);return t}}),null);(0,r.insert)(s,(0,r.createComponent)(i.Show,{get when(){var t;return(t=e.primaryButtonText)!=null?t:e.secondaryButtonText},get children(){const t=f.cloneNode(true);(0,r.insert)(t,(0,r.createComponent)(i.Show,{get when(){return e.secondaryButtonText},get children(){const t=_.cloneNode(true);t.$$click=()=>{var t;(t=e.onSecondaryButton)==null?void 0:t.call(e)};(0,r.insert)(t,(()=>e.secondaryButtonText));return t}}),null);(0,r.insert)(t,(0,r.createComponent)(i.Show,{get when(){return e.primaryButtonText},get children(){return(0,r.createComponent)(a.default,{class:"btn-create",onClick:()=>{var t;return(t=e.onPrimary)==null?void 0:t.call(e)},get children(){return e.primaryButtonText}})}}),null);return t}}),null);(0,r.effect)((i=>{var s,o;const a=`hoverable ${(s=e.class)!=null?s:""}`,l=A(),c=`tooltip-arrow ${(o=e.arrowDirection)!=null?o:""}`;a!==i._v$&&(0,r.className)(t,i._v$=a);l!==i._v$2&&t.style.setProperty("transform",i._v$2=l);c!==i._v$3&&(0,r.className)(n,i._v$3=c);return i}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t}})}})}})};n.Hoverable=m;var g=m;n.default=g;(0,r.delegateEvents)(["click"])},{"../../../../constants/images":71,"../button/Button":494,"./../text/Text":512,"./TooltipArrow":506,"@motionone/solid":925,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],506:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ArrowDirectionEnums=void 0;let r=function(e){e["TopLeft"]="top-left";e["TopRight"]="top-right";e["RightTop"]="right-top";e["RightBottom"]="right-bottom";e["BottomRight"]="bottom-right";e["BottomLeft"]="bottom-left";e["LeftBottom"]="left-bottom";e["LeftTop"]="left-top";e["None"]="none";return e}({});n.ArrowDirectionEnums=r},{}],507:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.TextArea=void 0;var r=e("solid-js/web");const i=(0,r.template)(`<textarea></textarea>`,2);const s=e=>(()=>{const t=i.cloneNode(true);(0,r.spread)(t,(0,r.mergeProps)(e,{get["class"](){var t;return`bubble-ui input textarea ${(t=e.class)!=null?t:""}`},get placeholder(){var t;return(t=e.placeholder)!=null?t:""},get rows(){var t;return(t=e.rows)!=null?t:2},get maxlength(){var t;return(t=e.maxlength)!=null?t:300},get minlength(){var t;return(t=e.minlength)!=null?t:0},get classList(){return{disabled:e.disabled}},onInput:t=>{if(e.disabled!==true){var n;(n=e.onInput)==null?void 0:n.call(e,t)}},onFocusOut:t=>{var n;(n=e.onFocusOut)==null?void 0:n.call(e,t)}}),false,false);return t})();n.TextArea=s;var o=s;n.default=o},{"solid-js/web":2315}],508:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.TextField=void 0;var r=e("solid-js/web");const i=(0,r.template)(`<input>`,1);const s=e=>(()=>{const t=i.cloneNode(true);(0,r.spread)(t,(0,r.mergeProps)(e,{get["class"](){var t;return`bubble-ui input ${(t=e.class)!=null?t:""}`},type:"text",get maxlength(){var t;return(t=e.maxlength)!=null?t:100},get classList(){return{disabled:e.disabled}},onInput:t=>{if(e.disabled!==true){if(typeof e.onInput==="function"){e.onInput(t)}else if(e.onInput!=null){e.onInput[0](e.onInput[1],t)}}}}),false,false);return t})();n.TextField=s;var o=s;n.default=o},{"solid-js/web":2315}],509:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.InformationalPopup=void 0;var r=e("solid-js/web");var i=l(e("../text/Text"));var s=l(e("../button/Button"));var o=e("solid-js");var a=e("./Popup");function l(e){return e&&e.__esModule?e:{default:e}}const c=(0,r.template)(`<div class="btn btn-cancel"></div>`,2),u=(0,r.template)(`<div class="children"><div class="inner-children"><div class="btn-row"></div></div></div>`,6);const d=e=>(0,r.createComponent)(a.Popup,{get["class"](){var t;return`message-panel-popup ${(t=e.class)!=null?t:""}`},get showingPopup(){return e.showingPopup},get onHidePopup(){return e.onHidePopup},get title(){return e.title},get children(){const t=u.cloneNode(true),n=t.firstChild,a=n.firstChild;(0,r.insert)(n,(0,r.createComponent)(i.default,{class:"instruction",get children(){return e.description}}),a);(0,r.insert)(n,(0,r.createComponent)(i.default,{class:"details",get children(){var t;return(t=e.details)!=null?t:""}}),a);(0,r.insert)(n,(0,r.createComponent)(o.Show,{get when(){return e.post_details_description},get children(){return(0,r.createComponent)(i.default,{class:"post-details-instruction",get children(){return e.post_details_description}})}}),a);(0,r.insert)(a,(0,r.createComponent)(o.Show,{get when(){return e.showButton},get children(){return(0,r.createComponent)(s.default,{get["class"](){var t;return`btn-create ${(t=e.btnClass)!=null?t:""}`},onClick:()=>{var t;return(t=e.onAccept)==null?void 0:t.call(e)},get children(){var t;return(t=e.buttonText)!=null?t:"Confirm"}})}}),null);(0,r.insert)(a,(0,r.createComponent)(o.Show,{get when(){return!e.hideCancelButton},get children(){const t=c.cloneNode(true);t.$$click=()=>{e.onHidePopup()};(0,r.insert)(t,(()=>{var t;return(t=e.hideButtonText)!=null?t:"Cancel"}));return t}}),null);return t}});n.InformationalPopup=d;(0,r.delegateEvents)(["click"])},{"../button/Button":494,"../text/Text":512,"./Popup":511,"solid-js":2313,"solid-js/web":2315}],510:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.InputPopup=void 0;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=u(e("./../text/Text"));var s=u(e("./../button/Button"));var o=e("solid-js");var a=u(e("../input/TextArea"));var l=e("./Popup");var c=u(e("../input/TextField"));function u(e){return e&&e.__esModule?e:{default:e}}const d=(0,r.template)(`<div class="input-row"><div class="small-text-area-input"></div></div>`,4),p=(0,r.template)(`<div class="small-text-area-input"></div>`,2),_=(0,r.template)(`<div class="text-area-input"></div>`,2),f=(0,r.template)(`<div class="invalid-caption"></div>`,2),h=(0,r.template)(`<div class="children"><div class="inner-children"><div class="input-row"></div><div class="btn-and-warnings"><div class="btn-row"><div class="btn btn-cancel"></div></div></div></div></div>`,12);const m=e=>{const t=(t,n)=>{if("validationOptions"in e){for(const{validCondition:r,invalidMsg:i}of e.validationOptions){if(!r(t,n)){return i!=null?i:""}}}return null};const n=t=>!e.canBeEmpty&&t.length===0;const[u,m]=(0,o.createSignal)(null);const g=()=>{var t,n;return(t=(n=u())!=null?n:e.prevValue)!=null?t:""};const[v,b]=(0,o.createSignal)(null);const y=()=>{var t,n;return(t=(n=v())!=null?n:e.prevOptionalTopValue)!=null?t:""};const w=(0,o.createMemo)((()=>t(y(),0)));const x=y()?(0,o.createMemo)((()=>t(g()))):(0,o.createMemo)((()=>t(g(),1)));return(0,r.createComponent)(l.Popup,{get["class"](){var t;return`message-panel-popup input-popup ${(t=e.class)!=null?t:""}`},get showingPopup(){return e.showingPopup},get onHidePopup(){return e.onHidePopup},get title(){return e.title},get children(){const t=h.cloneNode(true),l=t.firstChild,u=l.firstChild,v=u.nextSibling,j=v.firstChild,A=j.firstChild;(0,r.insert)(l,(0,r.createComponent)(o.Show,{get when(){return e.instruction},get children(){return(0,r.createComponent)(i.default,{class:"instruction",get children(){return e.instruction}})}}),u);(0,r.insert)(l,(0,r.createComponent)(o.Show,{get when(){return e.optionalTopInputCaption},get children(){const t=d.cloneNode(true),n=t.firstChild;(0,r.insert)(t,(0,r.createComponent)(i.default,{class:"field-caption input-panel",get children(){return e.optionalTopInputCaption}}),n);(0,r.insert)(n,(0,r.createComponent)(a.default,{get value(){return y()},onInput:e=>{b(e.currentTarget.value)},get placeholder(){var t;return(t=e.placeholder)!=null?t:""}}));return t}}),u);(0,r.insert)(u,(0,r.createComponent)(i.default,{class:"field-caption input-panel",get children(){return e.inputCaption}}),null);(0,r.insert)(u,(0,r.createComponent)(o.Switch,{get children(){return[(0,r.createComponent)(o.Match,{get when(){return e.textfield},get children(){const t=p.cloneNode(true);(0,r.insert)(t,(0,r.createComponent)(c.default,{get value(){return g()},maxLength:280,onInput:e=>{m(e.currentTarget.value)},get placeholder(){var t;return(t=e.placeholder)!=null?t:""}}));return t}}),(0,r.createComponent)(o.Match,{get when(){return!e.textfield},get children(){const t=_.cloneNode(true);(0,r.insert)(t,(0,r.createComponent)(a.default,{get rows(){var t;return(t=e.inputRows)!=null?t:2},get value(){return g()},maxLength:280,onInput:e=>{m(e.currentTarget.value)},get placeholder(){var t;return(t=e.placeholder)!=null?t:""}}));return t}})]}}),null);(0,r.insert)(v,(0,r.createComponent)(o.Show,{get when(){return(0,r.memo)((()=>!!e.optionalTopInputCaption))()&&!!w()},get children(){const e=f.cloneNode(true);(0,r.insert)(e,w);return e}}),j);(0,r.insert)(v,(0,r.createComponent)(o.Show,{get when(){return x()},get children(){const e=f.cloneNode(true);(0,r.insert)(e,x);return e}}),j);(0,r.insert)(j,(0,r.createComponent)(s.default,{get["class"](){var t;return`btn-create ${(t=e.btnClass)!=null?t:""}`},get disabled(){return x()!==null||e.optionalTopInputCaption&&(w()!==null||n(y()))||n(g())},onClick:()=>{if(e.optionalTopInputCaption){e.submitHandler(g(),y());b("")}else{e.submitHandler(g())}m("")},get children(){var t;return(t=e.buttonText)!=null?t:"Confirm"}}),A);A.$$click=()=>{var t;e.onHidePopup();if(e.optionalTopInputCaption){var n;b((n=e.prevOptionalTopValue)!=null?n:"")}m((t=e.prevValue)!=null?t:"")};(0,r.insert)(A,(()=>{var t;return(t=e.closeButtonText)!=null?t:"Close"}));return t}})};n.InputPopup=m;(0,r.delegateEvents)(["click"])},{"../input/TextArea":507,"../input/TextField":508,"./../button/Button":494,"./../text/Text":512,"./Popup":511,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],511:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Popup=void 0;var r=e("solid-js/web");var i=e("solid-js");var s=l(e("./../text/Text"));var o=e("../../utils/directives");var a=e("@motionone/solid");function l(e){return e&&e.__esModule?e:{default:e}}const c=(0,r.template)(`<div class="popup-content"></div>`,2);const u=e=>{(0,i.createEffect)((()=>{const t=t=>{if(t.key==="Escape")e.onHidePopup()};window.addEventListener("keydown",t);(0,i.onCleanup)((()=>window.removeEventListener("keydown",t)))}));return(0,r.createComponent)(a.Presence,{exitBeforeEnter:true,get children(){return(0,r.createComponent)(i.Show,{get when(){return e.showingPopup},get children(){return(0,r.createComponent)(a.Motion.div,{get["class"](){var t;return`modal-popup ${(t=e.class)!=null?t:""}`},initial:{opacity:0},transition:{duration:.3},animate:{opacity:1},exit:{opacity:0},get children(){const t=c.cloneNode(true);(0,r.use)(o.clickOutside,t,(()=>e.onHidePopup));(0,r.insert)(t,(0,r.createComponent)(i.Show,{get when(){return!e.hasCustomTitle},get children(){return(0,r.createComponent)(s.default,{class:"popup-title",get children(){return e.title}})}}),null);(0,r.insert)(t,(()=>e.children),null);return t}})}})}})};n.Popup=u},{"../../utils/directives":514,"./../text/Text":512,"@motionone/solid":925,"solid-js":2313,"solid-js/web":2315}],512:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.Text=void 0;var r=e("solid-js/web");var i=e("../../utils/directives");const s=(0,r.template)(`<div></div>`,2);const o=e=>(()=>{const t=s.cloneNode(true);(0,r.use)(i.showThumbnailOnHover,t,(()=>e.documentation_id));(0,r.spread)(t,e,false,true);(0,r.insert)(t,(()=>e.children));return t})();n.Text=o;var a=o;n.default=a},{"../../utils/directives":514,"solid-js/web":2315}],513:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.VimeoVideoFrame=void 0;var r=e("solid-js/web");var i=e("solid-js");var s=a(e("../../../../u/shared/mode_check"));function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const l=(0,r.template)(`<div class="vimeo-video-frame-container video"><div><iframe allow="autoplay; clipboard-write; encrypted-media; picture-in-picture" allowfullscreen></iframe></div></div>`,6);let c;if(!s.on_server()){c=e("@vimeo/player")}const u="https://player.vimeo.com/video/";const d=e=>{let t;function n(){return e.width.toString()+"px"}function s(){return e.height.toString()+"px"}function o(e){return`${u}${e}`}(0,i.onMount)((()=>{if(c===null)return;const n=new c(t);n.on("play",(()=>{var t;return(t=e.onPlay)==null?void 0:t.call(e)}))}));return(()=>{const i=l.cloneNode(true),a=i.firstChild,c=a.firstChild;(0,r.use)((e=>t=e),c);(0,r.effect)((t=>{var l,u,d;const p=(l=e.id)!=null?l:"",_=`vimeo-video-frame ${(u=e.class)!=null?u:""}`,f=n(),h=s(),m=o(e.vimeo_id),g=(d=e.title)!=null?d:"";p!==t._v$&&(0,r.setAttribute)(i,"id",t._v$=p);_!==t._v$2&&(0,r.className)(a,t._v$2=_);f!==t._v$3&&(0,r.setAttribute)(c,"width",t._v$3=f);h!==t._v$4&&(0,r.setAttribute)(c,"height",t._v$4=h);m!==t._v$5&&(0,r.setAttribute)(c,"src",t._v$5=m);g!==t._v$6&&(0,r.setAttribute)(c,"title",t._v$6=g);return t}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined,_v$5:undefined,_v$6:undefined});return i})()};n.VimeoVideoFrame=d},{"../../../../u/shared/mode_check":851,"@vimeo/player":953,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],514:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.contextMenuHandler=n.clickOutside=void 0;n.onElementEvent=l;n.showThumbnailOnHover=void 0;var r=e("solid-js");var i=a(e("../../thumbnail"));var s=e("../../documentationpalette");var o=a(e("../../contextmenu"));function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){const i=e=>{var t;(t=n())==null?void 0:t(e)};e.addEventListener(t,i);(0,r.onCleanup)((()=>e.removeEventListener(t,i)))}const c=(e,t)=>l(document.body,"click",(()=>n=>{if(n.target instanceof Element&&!e.contains(n.target))t()()}));n.clickOutside=c;const u=(e,t)=>{if(t()!=null){(0,r.onMount)((()=>{const n=t();if(n.startsWith("Documentation.")){(0,s.DocumentationPalette)().add($(e),n)}else{(0,i.default)().add($(e),n,"left")}}))}};n.showThumbnailOnHover=u;const d=(e,t)=>{(0,o.default)().add_handler($(e),(n=>{const{options:r,class:i}=t();(0,o.default)().open(n,i,r);(0,o.default)().set_focus_owner($(e))}))};n.contextMenuHandler=d},{"../../contextmenu":558,"../../documentationpalette":565,"../../thumbnail":590,"solid-js":2313}],515:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.observePropertyEditorMovement=s;var r=e("solid-js");function i(e){if(e==null){return[]}const t=/(auto|scroll)/;let n;const r=[];for(n=e;n!=null;n=n.parentElement){const e=getComputedStyle(n);if(t.test(e.overflow+e.overflowY)){r.push(n)}}return r}function s(e,t,n,s){const o=new MutationObserver(t);(0,r.createEffect)((()=>{var a;if((a=n==null?void 0:n())!=null?a:true){const n=e();if(n==null){return}const a=i(n);if(a.length>0){const e=$(a);s==null?void 0:s(e);e.on("scroll.DropdownChild",t);const n=e.parents(".ui-draggable,.ui-draggable-handle")[0];if(n!=null){o.observe(n,{attributes:true})}t();(0,r.onCleanup)((()=>{e==null?void 0:e.off("scroll.DropdownChild",t);o.disconnect();s==null?void 0:s(null)}))}}}))}},{"solid-js":2313}],516:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.merge_class_lists=r;e("core-js/modules/web.dom-collections.iterator.js");function r(e,t){if(t==null){return e}for(const[n,r]of Object.entries(t)){e[n]||(e[n]=r)}return e}},{"core-js/modules/web.dom-collections.iterator.js":1123}],517:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Atom=_;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=d(e("../../components/design/dropdown/AutocompleteDropdown"));var o=e("../../components/utils/prop_utils");var a=e("../utilities/dropdown_contents");var l=e("../utilities/focusTracking");var c=e("./DatasourceContents");var u=e("./utils");function d(e){return e&&e.__esModule?e:{default:e}}const p=(0,r.template)(`<div></div>`,2);function _(e){const[t,n]=(0,i.createSignal)(false);const[d,_]=(0,u.get_is_open_signal)((()=>e.id),(()=>{n(true)}));const f=(0,i.createMemo)((()=>{if(e.hideUntilFocus){const t=l.GlobalComposerFocusTracker.getFocusState(e.id);return t.isFocused&&t.metadata.focus_source==="click"?e.onClickAffordance:""}else{return e.onClickAffordance}}));return[(0,r.createComponent)(i.Show,{get when(){return e.onClickAffordance!=null&&e.display==null},get children(){const t=p.cloneNode(true);t.addEventListener("mouseleave",(()=>{e.setIsHovered(false)}));t.addEventListener("mouseenter",(()=>{e.setIsHovered(true)}));(0,r.effect)((n=>{var i;return(0,r.classList)(t,{spacer:true,[(i=e.class)!=null?i:""]:true,"mini-spacer":true,hidden:!d()&&(f()===""||!e.hideUntilFocus&&l.GlobalComposerFocusTracker.isFocused(e.id))},n)}));return t}}),(0,r.createComponent)(s.default,{onKeyDown:t=>{let r=false;if(!d()&&u.DROPDOWN_OPEN_KEYS.includes(t.key)){r=true;t.preventDefault()}else if(!d()&&t.key.length===1){r=true}if(r){_(true);n(true);t.stopPropagation()}else{var i;(i=e.onKeyDown)==null?void 0:i.call(e,t)}},directive:t=>{(0,l.applyFocusHere)(t,(()=>e.id),true);(0,l.trackExclusiveFocus)(t,(()=>e.id),true)},onFocus:()=>{var t;(t=e.setIsFocused)==null?void 0:t.call(e,true)},onBlur:()=>{var t;(t=e.setIsFocused)==null?void 0:t.call(e,false)},get contents(){var n,i;return(0,r.memo)((()=>!!t()))()?e.contents().with_options({optional:(n=e.optional)!=null?n:false,dropdown_width:"short"}):a.DropdownContents.empty({optional:(i=e.optional)!=null?i:false,dropdown_width:"short"})},get currentlySelected(){return e.currentValue},get captionPlaceholder(){var t;return(t=e.display)!=null?t:undefined},get onClickAffordance(){return f()},onSelect:(t,n)=>{var r;e.setCurrentValue(t,n);(r=e.setPristineState)==null?void 0:r.call(e,"dirty");if(t==null){_(false)}},onOpen:()=>{n(true);e.setIsHovered(false)},showingSignal:[d,t=>{if(t&&e.hideUntilFocus){const t=l.GlobalComposerFocusTracker.isFocused(e.id);if(t){_(true)}else{l.GlobalComposerFocusTracker.setFocus(e.id,{focus_source:"click"})}}else{_(t)}}],get classList(){var t;return(0,o.merge_class_lists)({"new-composer":true,[(t=e.class)!=null?t:""]:true,"highlight-other":e.highlightState==="highlight-other",[(0,u.get_color_depth)(e.depth)]:e.highlightState==="highlight-self",mandatory:!e.optional},e.classList)},onHover:t=>{if(!d()){e.setIsHovered(t)}},onFilterChanged:()=>{var t;return(t=e.setPristineState)==null?void 0:t.call(e,"dirty")},hideArrow:true,equals:(e,t)=>{if(e==null&&t==null){return true}else if(e==null||t==null){return false}if((0,u.is_message)(e)&&(0,u.is_message)(t)){return e.name===t.name}if((0,u.is_message)(e)||(0,u.is_message)(t)){return false}return(0,c.datasourceIsEqual)(e,t)}}),(0,r.createComponent)(i.Show,{get when(){return e.onClickAffordance!=null&&e.display==null},get children(){const t=p.cloneNode(true);t.addEventListener("mouseleave",(()=>{e.setIsHovered(false)}));t.addEventListener("mouseenter",(()=>{e.setIsHovered(true)}));(0,r.effect)((n=>{var i;return(0,r.classList)(t,{spacer:true,"mini-spacer":true,[(i=e.class)!=null?i:""]:true,hidden:f()===""&&!d()},n)}));return t}})]}},{"../../components/design/dropdown/AutocompleteDropdown":498,"../../components/utils/prop_utils":516,"../utilities/dropdown_contents":556,"../utilities/focusTracking":557,"./DatasourceContents":518,"./utils":525,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],518:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.appWideDatasources=E;n.datasourceIsEqual=j;n.datasourcesForContext=M;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../utilities/dropdown_contents");var i=b(e("../../../lang/lang"));var s=e("../../../lang/btypes");var o=e("../../../option_sets");var a=e("../../../lang/nodes/registry");var l=e("../../../lang/app_json");var c=b(e("../../../core/core_datasources"));var u=b(e("../../../documentation_id_getter"));var d=e("solid-js");var p=e("./EvaluationContext");var _=g(e("../../../lib"));var f=e("../../../lang/btype_ids");var h=g(e("../../../lang/appquery"));var m=e("../../../constants/composer");function g(e){return e&&e.__esModule?e:{default:e}}function v(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(v=function(e){return e?n:t})(e)}function b(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=v(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function y(e,t){return(0,a.new_expression)((0,l.VirtualJSON)(t.json,e),t.owner)}function w(e){const t=e!=null?e:{find_actions:()=>[],find_events:()=>[],find_elements:()=>[],type:()=>"",id:()=>""};const n=[i.RAW.DataSource("InjectedValue"),i.RAW.DataSource("ThisElement"),...[...t.find_elements(),...e&&!e.is_api()?[e]:[]].map((e=>i.RAW.DataSource("ThisElement",{element_id:e.id()})))];const r=[...t.find_events().filter((e=>e.type()!=="CustomEvent")).flatMap((e=>e.get_custom_parameters().map((t=>({event_id:e.id(),...t}))))).map((e=>i.RAW.DataSource("APIEventParameter",e))),...t.find_events().filter((e=>e.type()==="CustomEvent")).flatMap((e=>e.get_custom_parameters().map((t=>({event_id:e.id(),...t}))))).map((e=>i.RAW.DataSource("CurrentWorkflowItem",e))),i.RAW.DataSource("CurrentWorkflowItem"),i.RAW.DataSource("OldDataItem"),i.RAW.DataSource("CurrentDataItem"),...t.find_actions().map((e=>i.RAW.DataSource("PreviousStep",{action_id:e.id()})))];const a=i.RAW.DataSource("ElementAncestor",{ancestor_type:"TableCrossAxis",fetch_data:true});const l=["Table","TableMainAxis","TableCrossAxis"].map((e=>i.RAW.DataSource("ElementAncestor",{ancestor_type:e,fetch_data:false})));const c=[i.RAW.DataSource("PrimitiveLiteral",{btype:"sys.bool",value:true}),i.RAW.DataSource("PrimitiveLiteral",{btype:"sys.bool",value:false}),i.RAW.DataSource("ElementParent"),i.RAW.DataSource("CurrentCellsIndex"),a,...l,...(0,s.list)("option").map((e=>i.RAW.DataSource("AllOptionValue",{option_set:e.id()}))),i.RAW.DataSource("CurrentUser"),i.RAW.DataSource("CurrentPageItem"),i.RAW.DataSource("Search"),i.RAW.DataSource("OptionValue"),i.RAW.DataSource("ArbitraryText"),i.RAW.DataSource("AlgoliaSearch"),i.RAW.DataSource("GetDataFromAPI")];const u=(0,s.list)("option").flatMap((e=>e.option_set().values())).sort(o.sort_options_fn).filter((e=>!e.deleted())).map((e=>i.RAW.DataSource("OneOptionValue",{option_set:(0,f.option_set_type)(e.parent().id()),option_value:e.name()})));let d=[...t.find_elements(),...e&&!e.is_api()?[e]:[]];if(t.type()==="CustomDefinition"){d=d.filter((e=>e.type()!=="CustomDefinition"));n.unshift(i.RAW.DataSource("GetElement",{element_id:t.id()}))}d=d.filter((e=>e.can_reference())).sort(((e,t)=>e.get_name()<t.get_name()?-1:1)).map((e=>i.RAW.DataSource("GetElement",{element_id:e.id()})));const p=[i.RAW.DataSource("PageData",{name:"Website Home"}),i.RAW.DataSource("PageData",{name:"This Url"}),i.RAW.DataSource("PageData",{name:"Current Page Width"}),i.RAW.DataSource("PageData",{name:"Current Page Scrolling Position"}),i.RAW.DataSource("PageData",{name:"Page Loaded Above Fold"}),i.RAW.DataSource("PageData",{name:"Page Loaded (Entire)"}),i.RAW.DataSource("PageData",{name:"Current Page Name"}),i.RAW.DataSource("GetParamFromUrl"),i.RAW.DataSource("AppText"),i.RAW.DataSource("DateTime"),i.RAW.DataSource("PageData",{name:"CurrentLanguage"}),i.RAW.DataSource("PageData",{name:"Current Date/Time"}),i.RAW.DataSource("PageData",{name:"Current Position"}),i.RAW.DataSource("PageData",{name:"Website Admin Email"}),i.RAW.DataSource("PageData",{name:"AppIsTest"}),i.RAW.DataSource("PageData",{name:"AppVersion"}),i.RAW.DataSource("GetMouseData"),i.RAW.DataSource("Formulas"),i.RAW.DataSource("AppSetting")];return{"":n,"Workflow Data Sources":r,"Data Sources":c,"Option Sets":u,Elements:d,"Other Data Sources":p}}const x={ThisElement:["element_id"],APIEventParameter:["param_id","key"],CurrentWorkflowItem:["param_id"],PreviousStep:["action_id"],PrimitiveLiteral:["btype","value"],OneOptionValue:["option_set","option_value"],AllOptionValue:["option_set"],GetElement:["element_id"],PageData:["name"],ElementAncestor:["ancestor_type","fetch_data"]};function j(e,t){if(typeof e!=="object"||typeof t!=="object"){if(typeof e==="object"){return e.type==="PrimitiveLiteral"&&e.properties.btype===typeof t&&e.properties.value===t}else if(typeof t==="object"){return t.type==="PrimitiveLiteral"&&t.properties.btype===typeof e&&t.properties.value===e}else{return e===t}}if(e.type!==t.type){return false}const n=x[e.type];if(n==null){return true}if(e.properties==null||t.properties==null){return e.properties==null&&t.properties==null}for(const r of n){if(e.properties[r]!==t.properties[r]){return false}}return true}const A={};function M(e,t,n){var i,o,a,l,f,g,v,b;if(typeof n==="string"){n=(0,s.get)(n)}const x=(i=e.owner)==null?void 0:(o=i.root)==null?void 0:o.call(i);(l=A[a=(f=x==null?void 0:x.id())!=null?f:"_missing"])!=null?l:A[a]=(0,d.createRoot)((()=>r.DropdownContents.multi_section((()=>Object.fromEntries(Object.entries(w(x)).map((e=>{let[t,n]=e;return[t,n.map((e=>({display:e.type,value:e})))]})))),{evaluation_strategy:"Lazy",virtualize:true,overscan_count:100})));const j=A[(g=x==null?void 0:x.id())!=null?g:"_missing"];const M=(0,d.createMemo)((()=>(0,p.getEvaluationContext)(e)));return j.filter((e=>{var r,i,s,o;const a=M();if(a==null){return false}const l=_.default.or_throw().load_plugin(`${_.default.or_throw().plugin_prefixes.datasource}${e.value.type}`,true);if(l==null||a.owner_type==="unknown")return false;if(a.injected_value===false&&e.value.type==="InjectedValue"){return false}else if(a.injected_value==="Restricted"&&!l.allowed_when_restricted){return false}if(e.value.type==="PrimitiveLiteral"&&!((r=n)!=null&&r.matches(e.value.properties.btype))){return false}if(a.owner_type==="BackendWorkflow"&&a.owner_node.type()==="DatabaseTriggerEvent"&&a.in_event_condition&&!["CurrentDataItem","OldDataItem","OneOptionValue","AllOptionValue","PrimitiveLiteral"].includes(e.value.type)){return false}switch(a.owner_type){case"Element":case"CustomDefinition":if(a.expression_used_in_page_load&&!l.light_evaluation){return false}else if(!l.allowed_on_element){return false}break;case"State":if(a.is_style){var c,u;return(c=(u=l.allowed_in_style_conditionals)==null?void 0:u.call(l,e))!=null?c:false}if(!l.allowed_on_element){return false}break;case"Workflow":if(!l.allowed_on_workflow){return false}break;case"BackendWorkflow":if(!l.allowed_on_backend||!l.allowed_on_workflow){return false}break;case"PrivacyRole":if(!l.allowed_on_privacy_role){return false}break}const d=(i=l.get_required_visible_id)==null?void 0:i.call(l,e.value);if(d&&!a.visible_ids.includes(d)){return false}return(s=(o=l.additional_context_filter)==null?void 0:o.call(l,e.value,a,t))!=null?s:true})).map((n=>{var r;const i=n.value;const s=y(i,e);let o;if((r=i.properties)!=null&&r.element_id){o=i.properties.element_id}else if(Object.keys(c).includes(i.type)){o=u.for_datasource(i)}let a;let l;if(i.type==="GetElement"){const e=h.default.by_id(i.properties.element_id);if(e!=null&&e.is_input()&&(e==null?void 0:e.type())!=="Input"&&!(0,p.can_datasource_get_to)(s,t,M())){o="Documentation.Data.DataSources.IncompatibleType";l=true;a="Incompatible type"}}return{display:s.display(),value:s,documentation_id:o,disabled:l,caption:a}})).filter((e=>{var n;if(((n=t.get_name)==null?void 0:n.call(t))==="saveable"||typeof e.value.D.check_btype==="function"&&e.value.D.check_btype(e.value)){return(0,p.can_datasource_get_to)(e.value,t,M())}else{return true}})).with_options({input_type:(v=(b=n)==null?void 0:b.get_composer_input_type())!=null?v:m.COMPOSER_INPUT_TYPES.REAL_TIME_SEARCH,show_sections:true,get_value_for_literal:e=>{var t,r;const i=(t=(r=n)==null?void 0:r.get_composer_input_type())!=null?t:m.COMPOSER_INPUT_TYPES.REAL_TIME_SEARCH;switch(i){case m.COMPOSER_INPUT_TYPES.TEXT:if(e===""){return null}else{return e}case m.COMPOSER_INPUT_TYPES.NUMBER:if(!isNaN(e)){return parseFloat(e)}break;case m.COMPOSER_INPUT_TYPES.INTEGER:if(!isNaN(e)){return parseInt(e)}break}return undefined},get_display_for_literal:e=>{if(["string","number"].includes(typeof e)){return String(e)}else{return null}}}).map((e=>({...e,value:{...e.value.raw(),is_slidable:e.value.get_spot()==="SlidableAtom"}})))}function E(){return r.DropdownContents.multi_section((()=>Object.fromEntries(Object.entries(w(undefined)).map((e=>{let[t,n]=e;return[t,n.map((e=>({display:"",value:e})))]}))))).filter((e=>{const t=["OneOptionValue","AllOptionValue","PrimitiveLiteral","CurrentWorkflowItem","APIEventParameter","InjectedValue","OldDataItem","CurrentDataItem","ThisElement","CurrentCellsIndex","ElementAncestor","PreviousStep","GetElement","ElementParent"];return!t.includes(e.value.type)})).map((e=>{var t;const n=e.value;const r=(0,a.new_expression)((0,l.VirtualJSON)(i.default.VirtualEditorJSON(),n),{});let s;if((t=n.properties)!=null&&t.element_id){s=n.properties.element_id}else if(Object.keys(c).includes(n.type)){s=u.for_datasource(n)}return{display:r.display(),value:r,documentation_id:s}})).with_options({show_sections:true})}},{"../../../constants/composer":54,"../../../core/core_datasources":220,"../../../documentation_id_getter":486,"../../../lang/app_json":629,"../../../lang/appquery":651,"../../../lang/btype_ids":652,"../../../lang/btypes":653,"../../../lang/lang":714,"../../../lang/nodes/registry":724,"../../../lib":741,"../../../option_sets":748,"../utilities/dropdown_contents":556,"./EvaluationContext":519,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],519:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.can_datasource_get_to=b;n.getEvaluationContext=v;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../../constants/special_keys");var i=f(e("../../../lang/elements/GenericElement"));var s=f(e("../../../lang/workflow/WorkflowObject"));var o=f(e("../../../lang/elements/State"));var a=e("../../../core/core_datasources/utilities/core_ds_element_utilities");var l=f(e("../../../lang/workflow/Action"));var c=e("../../../u");var u=e("solid-js");var d=f(e("../../../lang/workflow/GenericEvent"));var p=f(e("../../../lang/application/API"));var _=f(e("../../../lang/application/PrivacyRole"));function f(e){return e&&e.__esModule?e:{default:e}}function h(e){var t;const n=e==null?void 0:e.root();if(n==null||e instanceof p.default){return[]}const r=[n,...(t=n.find_elements())!=null?t:[]];return r.filter((t=>(0,a.is_element_visible)(t,e))).map((e=>e.id()))}function m(e){return[...h(e.context_element())]}function g(e){var t,n,r,i;const s=[...h(e.context_element()),...(t=(n=e.event())==null?void 0:n.get_custom_parameters().map((t=>`${e.event().id()}.${t.param_id}`)))!=null?t:[]];if(((r=(i=e.event())==null?void 0:i.get_static_property("custom_event_data_type"))!=null?r:"null")!=="null"){s.push(`${e.event().id()}.current_item`)}if(e instanceof l.default){let t=e.previous();while(t instanceof l.default){if(t.return_value().id()!=="null"){s.push(t.id())}t=t.previous()}}return s}function v(e){let t=e;let n=false;while(t!=null&&n===false){var a,l,c,u;if(((a=(l=t).name)==null?void 0:a.call(l))==="filtered"){var p,f,v,b;const k=(p=(f=t.property("constraints"))==null?void 0:(v=(b=f).entries)==null?void 0:v.call(b))!=null?p:[];for(const O of k){if(O.get_static_property("key")===r.ADVANCED_SEARCH_CONSTRAINT&&e.path().startsWith(O.path())){n="Full";break}}}if(((c=(u=t).name)==null?void 0:c.call(u))==="format_as_text"){n="Full"}t=t.parent_expression()}if(n===false){var y,w;const S=e.context_element();function D(e){const t=e;if(!t[0]){return false}else if(t[1]){return"Full"}else{return"Restricted"}}if((S==null?void 0:(y=S.E)==null?void 0:y.use_injected_datasource)!=null){n=S.E.use_injected_datasource(e,S)?"Full":false}if(n===false&&typeof((w=e.owner)==null?void 0:w.use_injected_datasource)==="function"){n=D(e.owner.use_injected_datasource(e))}}const x=e.owner;if(x instanceof s.default){let C=false;if(x instanceof d.default){t=e;while(t!=null){if(t.node_name()==="condition"){C=true;break}t=t.parent_expression()}}return{owner_type:x.is_api()?"BackendWorkflow":"Workflow",owner_node:x,visible_ids:g(x),injected_value:n,in_event_condition:C}}else if(x instanceof i.default){let T=false;const{field_names:N}=x.E;t=e;while(t!=null){var j;if((j=N[t.node_name()])!=null&&j.in_pageservice){T=true;break}t=t.parent_expression()}return{owner_type:"Element",owner_node:x,visible_ids:h(x),injected_value:n,expression_used_in_page_load:T}}else if(x instanceof o.default){var A,M,E;return{owner_type:"State",owner_node:x,visible_ids:m(x),injected_value:n,is_style:(A=x.context_element)==null?void 0:(M=A.call(x))==null?void 0:(E=M.is_style)==null?void 0:E.call(M)}}else if(x instanceof _.default){return{owner_type:"PrivacyRole",owner_node:x,visible_ids:[],injected_value:"Full"}}else{return{owner_type:"unknown",injected_value:n}}}function b(e,t,n){if(["Search"].includes(e._type)){return true}return x(e.get_value(),t,n)}const y={};function w(e){if(e&&typeof e==="object"){if((0,c.has_unique_string)(e)){return e.toUniqueString()}else{const t={};for(const n in e){if(n==="visible_ids"){continue}const r=e[n];t[n]=w(r)}return t}}else{return e}}function x(e,t,n){var r,i;let s;if(n!=null){s=JSON.stringify(w(n))}else{s=""}let o;if(typeof t.display==="function"){o=t.display()}else{o=t}const a=`${(r=e==null?void 0:e.id())!=null?r:""}_${o} ${s}`;(i=y[a])!=null?i:y[a]=(0,u.createMemo)((()=>{if(!(e!=null&&e.id())){return false}return j(e,t,n,new Set)}));return y[a]()}function j(e,t,n,r){if(r.has(e.id())){return false}r.add(e.id());if(e.matches(t)){return true}return e.get_messages().filter((e=>{var t;return(t=e.filter_context_new(n))!=null?t:true})).map((e=>e.ret_btype())).some((e=>j(e,t,n,r)))}},{"../../../constants/special_keys":87,"../../../core/core_datasources/utilities/core_ds_element_utilities":234,"../../../lang/application/API":634,"../../../lang/application/PrivacyRole":645,"../../../lang/elements/GenericElement":670,"../../../lang/elements/State":674,"../../../lang/workflow/Action":733,"../../../lang/workflow/GenericEvent":735,"../../../lang/workflow/WorkflowObject":736,"../../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],520:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ExpressionComposer=void 0;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("./SubExpression");var o=e("../utilities/focusTracking");var a=g(e("../../../client/analytics"));var l=e("../../../constants/segment_events");var c=e("../../../lang/btypes");var u=e("../../../u");var d=h(e("../../contextmenu"));var p=h(e("../../highlightbox"));var _=h(e("../../../lang/appquery"));var f=e("../../components/utils/directives");function h(e){return e&&e.__esModule?e:{default:e}}function m(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(m=function(e){return e?n:t})(e)}function g(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=m(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const v=(0,r.template)(`<div class="new-composer expression-composer-container"></div>`,2);const b=e=>{const t=(0,i.createMemo)((()=>o.GlobalComposerFocusTracker.isChildFocused(e.id)));let n;if(e.onDirty){const t=(0,i.createSignal)("pristine");n=t[1];(0,i.createReaction)(e.onDirty)(t[0])}function h(e,t){var n,r;if(!(e!=null&&e.has_next())){return false}let i=(n=(r=e.get_value)==null?void 0:r.call(e))!=null?n:(0,c.get)("null");let s=e.next();while(s!=null&&!s.is_empty()){var o,a,l,u,d;if(s.has_args()){const e=h(s.args(),s.get_arg_btype());if(e){return true}}i=(o=(a=(l=s).get_value)==null?void 0:a.call(l))!=null?o:(0,c.get)("null");s=(u=(d=s).next)==null?void 0:u.call(d)}return!i.matches(t)}let m=false;const g=(0,i.createMemo)((()=>{if(t()){m=true;return"focused"}const n=500;if(h(e.expression,e.expectedBtype)){setTimeout((()=>{if(m&&!t()&&h(e.expression,e.expectedBtype)){var n;a.track(l.DYNAMIC_EXPRESSION_EDITED_V1,{app_version:_.default.app_version(),app:_.default.appname(),composer_id:e.id,expression:(n=e.expression)==null?void 0:n.get_tree_display(),issue_exists:true})}}),n);return"error"}else{setTimeout((()=>{if(m&&!t()&&!h(e.expression,e.expectedBtype)){var n;a.track(l.DYNAMIC_EXPRESSION_EDITED_V1,{app_version:_.default.app_version(),app:_.default.appname(),composer_id:e.id,expression:(n=e.expression)==null?void 0:n.get_tree_display(),issue_exists:false})}}),n);return""}}));const[b,y]=(0,i.createSignal)(false);function w(){const t=e.currentValue;(0,u.add_source_appname_tracker)(t,_.default.appname());(0,u.local_storage_put)("bubble_composer_expression_clipboard",t)}function x(){const t=(0,u.local_storage_get)("bubble_composer_expression_clipboard");e.setCurrentValue(t,"user-click")}function j(){e.setCurrentValue(null,"user-click")}function A(){var t,n;const r=[["Copy expression",()=>w(),()=>{}],["Paste expression",()=>x(),()=>{}],["Clear expression",()=>j(),()=>{}]];const i=(t=(n=e.expression).element_id)==null?void 0:t.call(n);if(i!=null&&i!==""){r.push([(0,d.default)().SEPARATOR]);r.push(["Reveal the element",()=>(0,p.default)().reveal_element(i)])}else{const t=e.expression.get_static_property("action_id");if(t!=null&&t!==""){r.push([(0,d.default)().SEPARATOR]);r.push(["Reveal the action",()=>(0,p.default)().find(_.default.workflow_item(t))])}}return r}const M=new Set;const[E,k]=(0,i.createSignal)(undefined,{equals:false});const O=(0,i.createMemo)((()=>{E();return M.size}));return(()=>{const i=v.cloneNode(true);(0,r.use)(f.contextMenuHandler,i,(()=>({class:"context-menu composer",options:A()})));i.addEventListener("mouseleave",(()=>y(false)));i.addEventListener("mouseenter",(()=>y(true)));(0,r.insert)(i,(0,r.createComponent)(s.SubExpression,(0,r.mergeProps)(e,{get["class"](){return g()},depth:0,get atomsReqHighlight(){return O()},setAtomHighlightStatus:(e,t)=>{if(t==="on"){M.add(e)}else{M.delete(e)}k()},setPristineState:n,setValueAtPath:(t,n,r)=>{const i=t.split(e.id)[1].substring(1);if(i===""){e.setCurrentValue(n,r);return}const s=(0,u.json_deep_copy)(e.expression.json.raw());const o=i.split(".");let a=s;for(const e of o.slice(0,o.length-1)){var l;a=(l=a)==null?void 0:l[e]}if(a!=null){a[o[o.length-1]]=n}e.setCurrentValue(s,r)},isTopLevel:true})));(0,r.effect)((()=>i.classList.toggle("hovered",!!(b()||t()))));return i})()};n.ExpressionComposer=b},{"../../../client/analytics":20,"../../../constants/segment_events":85,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../u":823,"../../components/utils/directives":514,"../../contextmenu":558,"../../highlightbox":578,"../utilities/focusTracking":557,"./SubExpression":524,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],521:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.allMessages=y;n.messagesForContext=w;var r=e("solid-js");var i=e("../../../constants/core");var s=e("../utilities/dropdown_contents");var o=e("./EvaluationContext");var a=v(e("../../../lang/btypes"));var l=e("../../../lang/missing_btype");var c=m(e("../../../lib"));var u=e("../../../core/widgets");var d=v(e("../../../u/client/b_ui"));var p=m(e("../../../lang/appquery"));var _=e("../compatibility/composers");var f=e("../../../logger");var h=e("../../../lang/lang");function m(e){return e&&e.__esModule?e:{default:e}}function g(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(g=function(e){return e?n:t})(e)}function v(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=g(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const b="Additional";function y(e,t){return s.DropdownContents.multi_section((()=>e.get_messages_reorg().map((e=>{const n=e.description(undefined,false,{parent_node:t,for_consumer:i.DROPDOWN_DESCRIPTION_CONTEXT});return{display:n,value:e,documentation_id:e.M.documentation_id,caption:e.M.caption,delete_fn:e.M.delete_cb}}))),(e=>{var t,n,r;if(!(e!=null&&(t=e.value)!=null&&(n=t.M)!=null&&n.section)){var i,s;(0,f.log)("warn",`data source does not have a section`,{data_source_display:e.display,message_name:(i=e.value)==null?void 0:(s=i.M)==null?void 0:s.name})}return(r=e.value.M.section)!=null?r:b}),{show_sections:true,evaluation_strategy:"Lazy",virtualize:true,overscan_count:100})}function w(e,t){function n(){var e,n;if((0,l.is_missing)((e=(n=t.get_value)==null?void 0:n.call(t).id())!=null?e:(0,l.namespace_prefix)())){return undefined}if(a.saveable(t.get_eval_value())){return{display:"Create a new field...",hide_dropdown:true,onClick(e){c.default.or_throw().visual_edit.show_create_new_field_modal({div:$(""),preset_value:"",cb:function(){if((arguments.length<=0?undefined:arguments[0])==null){e(true,arguments.length<=1?undefined:arguments[1])}},custom_type:t.get_value().custom_type(),is_message:true})}}}if(t.type()==="ElementParent"){return{display:"Change the parent's thing type...",documentation_id:"Documentation.Elements.GeneralConcepts.ChangeParentType",hide_dropdown:true,onClick(e){const n=new u.ModalPopup("Change element's type");n.get_canvas().addClass("add-new-popup");const r=n.children_div;n.show();d.div("change-parent-type-title",r,`Change ${t.context_element().parent().get_name()}'s type to...`);const i=c.default.or_throw().composer.Owner(t.context_element().parent().get_static_property("group_type"));const s=d.div("editor dropdown");d.div("caption type-picker",s,"New type");const o=c.default.or_throw().sets.get_set("DisplayableInListValues")(true);const a=(0,_.get_composer)("Dropdown",i,{json:i.json,set:o});s.append(a.get_canvas());a.get_canvas().addClass("bubble-ui");r.append(s);const l=d.div(["btn","btn-create","bubble-ui"],r);l.text("Change");const p=d.div(["btn","btn-cancel"],r);p.text("Cancel");p.on("vclick",(()=>n.hide()));l.on("vclick",(()=>{const r=i.get();n.hide();t.context_element().parent().set_property("group_type",r);t.context_element().parent().commit();e(false)}))}}}if(["ThisElement","GetElement"].includes(t.type())){var r;const e=t.type()==="ThisElement"?t.context_element():p.default.element(t.element_id());if((r=e.is_style)!=null&&r.call(e)){return undefined}return{display:"Create a new custom state...",hide_dropdown:true,documentation_id:"Documentation.Elements.GeneralConcepts.States.CustomStates",onClick:t=>c.default.or_throw().visual_edit.show_create_new_state_modal({div:$(""),cb:function(){if((arguments.length<=0?undefined:arguments[0])==null){t(true,arguments.length<=1?undefined:arguments[1])}},element:e,is_message:true})}}return undefined}const i=(0,r.createMemo)((()=>(0,o.getEvaluationContext)(t)));return y(e,t).filter((e=>i()!=null&&e.value.filter_context_new(i())&&!e.value.no_composer(t))).map((e=>({...e,value:{...h.RAW.Message(e.value.name()),is_slidable:e.value.spot_data()==="SlidableAtom"}}))).with_options({new_option_accelerator:n()})}},{"../../../constants/core":55,"../../../core/widgets":421,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/lang":714,"../../../lang/missing_btype":717,"../../../lib":741,"../../../logger":744,"../../../u/client/b_ui":813,"../compatibility/composers":532,"../utilities/dropdown_contents":556,"./EvaluationContext":519,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],522:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Parenthesis=void 0;var r=e("solid-js/web");var i=e("./utils");const s=(0,r.template)(`<div><div></div></div>`,4);const o=e=>(()=>{const t=s.cloneNode(true),n=t.firstChild;t.addEventListener("mouseleave",(()=>{e.setIsHovered(false)}));t.addEventListener("mouseenter",(()=>{e.setIsHovered(true)}));(0,r.effect)((s=>{var o,a;const l={"hover-space":true,[e.side]:true,[(o=e.class)!=null?o:""]:true,mandatory:e.mandatory,[(0,i.get_color_depth)(e.depth)]:e.highlightState==="highlight-self","highlight-other":e.highlightState==="highlight-other"},c={parenthesis:true,[e.side]:true,[(a=e.class)!=null?a:""]:true,mandatory:e.mandatory,[(0,i.get_color_depth)(e.depth)]:e.highlightState==="highlight-self","highlight-other":e.highlightState==="highlight-other"};s._v$=(0,r.classList)(t,l,s._v$);s._v$2=(0,r.classList)(n,c,s._v$2);return s}),{_v$:undefined,_v$2:undefined});return t})();n.Parenthesis=o},{"./utils":525,"solid-js/web":2315}],523:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.SlidableAtom=d;var r=e("solid-js/web");var i=c(e("../../components/design/text/Text"));var s=c(e("./../../../lib"));var o=e("./utils");var a=e("../utilities/focusTracking");var l=e("../../components/utils/prop_utils");function c(e){return e&&e.__esModule?e:{default:e}}const u=(0,r.template)(`<div tabindex="-1"><div></div></div>`,4);function d(e){const t=s.default.or_throw().SlidablePalette();let n=false;function c(){n=true;e.setIsHovered(true);t.assign_node(e.node,(t=>{switch(t.action){case"go_to_next":{var n;const t=new KeyboardEvent("keydown",{key:"ArrowRight"});(n=e.onKeyDown)==null?void 0:n.call(e,t);break}case"change":e.setCurrentValue(t.value.val.properties);break;case"delete":e.setCurrentValue(null);break}}),(()=>{n=false}));t.show()}function d(){if(n){t.hide();n=false}}(0,o.get_is_open_signal)((()=>e.id),(()=>{c()}),(()=>{d()}),(()=>`${e.id}.properties`));return(()=>{const t=u.cloneNode(true),n=t.firstChild;t.$$keydown=t=>{if(o.SLIDABLE_OPEN_KEYS.includes(t.key)){c();t.stopPropagation()}else{var n;(n=e.onKeyDown)==null?void 0:n.call(e,t)}};t.addEventListener("blur",(()=>{var t;return(t=e.setIsFocused)==null?void 0:t.call(e,false)}));t.addEventListener("focus",(()=>{var t;return(t=e.setIsFocused)==null?void 0:t.call(e,true)}));t.addEventListener("mouseleave",(()=>{e.setIsHovered(false)}));t.addEventListener("mouseenter",(()=>{e.setIsHovered(true)}));t.$$click=()=>{c()};(0,r.use)(a.applyFocusHere,t,(()=>e.id));(0,r.insert)(n,(0,r.createComponent)(i.default,{get classList(){var t;return(0,l.merge_class_lists)({"dropdown-caption":true,"new-composer":true,[(t=e.class)!=null?t:""]:true,"highlight-other":e.highlightState==="highlight-other",[(0,o.get_color_depth)(e.depth)]:e.highlightState==="highlight-self"},e.classList)},get children(){return e.display}}));(0,r.effect)((i=>{var s,a;const c=(0,l.merge_class_lists)({"dropdown-container":true,"new-composer":true,[(s=e.class)!=null?s:""]:true,"highlight-other":e.highlightState==="highlight-other",[(0,o.get_color_depth)(e.depth)]:e.highlightState==="highlight-self"},e.classList),u=(0,l.merge_class_lists)({"dropdown-caption-container":true,"new-composer":true,[(a=e.class)!=null?a:""]:true,"highlight-other":e.highlightState==="highlight-other",[(0,o.get_color_depth)(e.depth)]:e.highlightState==="highlight-self"},e.classList);i._v$=(0,r.classList)(t,c,i._v$);i._v$2=(0,r.classList)(n,u,i._v$2);return i}),{_v$:undefined,_v$2:undefined});return t})()}(0,r.delegateEvents)(["click","keydown"])},{"../../components/design/text/Text":512,"../../components/utils/prop_utils":516,"../utilities/focusTracking":557,"./../../../lib":741,"./utils":525,"solid-js/web":2315}],524:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.SubExpression=y;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("../../../lang/btypes");var o=e("../../../lang/nodes/registry");var a=e("../utilities/focusTracking");var l=e("./Atom");var c=e("./DatasourceContents");var u=e("./MessageContents");var d=e("./Parenthesis");var p=e("./SlidableAtom");var _=e("solid-js/store");var f=e("./utils");const h=(0,r.template)(`<div></div>`,2);const m="MISSING";const g="MORE";const v=".insert_spot";function b(e){var t,n;return(t=(n=e.get_value)==null?void 0:n.call(e))!=null?t:(0,s.get)("null")}function y(e){const t=(0,i.createMemo)((()=>{var t,n,r;const i=[{raw:e.currentValue,expression:e.expression,contents:()=>(0,c.datasourcesForContext)(e.expression,e.expectedBtype,e.literalBtype),isSlidable:e.expression.get_spot()==="SlidableAtom"}];let s=(t=e.currentValue)==null?void 0:t.next;let o=b(e.expression);let a=(n=(r=e.expression).next)==null?void 0:n.call(r);while(s!=null&&a!=null){var l,d;const e=a;const t=o;i.push({raw:s,expression:a,isSlidable:a.get_spot()==="SlidableAtom",prev_btype:t,contents:()=>(0,u.messagesForContext)(t,e)});s=s.next;o=b(a);a=(l=(d=a).next)==null?void 0:l.call(d)}return i}));const n=(0,i.createMemo)((()=>{const e=t().length-1;return t().filter(((t,n)=>t.expression.has_args()&&n!==e))}),[],{equals(e,t){return e.length===t.length}});const s=(0,i.createMemo)((()=>{let e=0;const n=[];for(const r of t()){n.push(e);if(r.expression.has_args()){e++}}n.push(n[n.length-1]);return n}));const[w,x]=(0,_.createStore)({});const[j,A]=(0,_.createStore)({});function M(e){for(let t=e;t<=S();t++){if(w[t]||j[t]){return true}}return false}function E(t){if(w[t]||j[t]){return"highlight-self"}else if(e.atomsReqHighlight>0&&!M(t)){return"highlight-other"}else{return"no-highlight"}}function k(t,n){const r=(0,i.untrack)((()=>w[t]));x(t,n);if(n!==r){e.setAtomHighlightStatus(`${e.id}.part${t}:hover`,n?"on":"off")}}function O(t,n){const r=(0,i.untrack)((()=>j[t]));A(t,n);if(r!==n){e.setAtomHighlightStatus(`${e.id}.part${t}:focus`,n?"on":"off")}}(0,i.onCleanup)((()=>{for(let t=0;t<=S();t++){e.setAtomHighlightStatus(`${e.id}.part${t}:focus`,"off");e.setAtomHighlightStatus(`${e.id}.part${t}:hover`,"off")}}));function S(){return s()[s().length-1]}function D(){return n().length}function C(t){let n=(0,o.new_expression)(e.expression.json,e.expression.owner);let r=0;while(n.has_next()&&!n.next().is_empty()&&(t==null||r<t)){n=n.next();r+=1}return t==null?r+1:n}function T(e){if(e===0){return false}else if(e===Math.floor(e)){const t=C(e-1);a.GlobalComposerFocusTracker.setFocus(t.json.path()+".insert_spot",{force_open:false});return true}else{const t=C(Math.floor(e));if(t.has_args()){a.GlobalComposerFocusTracker.setFocus(t.json.path()+".args"+f.WHOLE_EXPRESSION_ID,{open_last_subexpr:true});return true}else{a.GlobalComposerFocusTracker.setFocus(t.json.path(),{force_open:false});return true}}}function N(e,t,n){const r=C(Math.floor(e));if(r.has_args()&&!t){a.GlobalComposerFocusTracker.setFocus(r.json.path()+".args",{force_open:n!=null?n:false});return true}else if(e===C()-.5){return false}else if(e===Math.floor(e)){a.GlobalComposerFocusTracker.setFocus(r.json.path()+".insert_spot",{force_open:n!=null?n:false});return true}else{a.GlobalComposerFocusTracker.setFocus(r.json.path()+".next",{force_open:n!=null?n:false});return true}}(0,i.createEffect)((()=>{const n=a.GlobalComposerFocusTracker.getFocusState(e.id+f.WHOLE_EXPRESSION_ID);if(n.isFocused&&n.metadata.open_last_subexpr){let e=t().length;if(!t()[e-1].expression.has_next()||t()[e-1].expression.is_empty()){e-=.5}T(e)}}));function P(t,n,r,i,s,o){if(n==null){if(typeof t==="object"&&t!=null&&!s&&(t.next!=null||t.args!=null)){const n=t.type==="Message";e.setValueAtPath(r,{next:t.next,type:n?t.type:undefined},o)}else if(typeof t==="object"&&s){e.setValueAtPath(r,t==null?void 0:t.next,o)}else{e.setValueAtPath(r,null,o)}return false}else if(typeof n==="object"&&typeof t==="object"&&t!=null){var a;const t=(a=n.is_slidable)!=null?a:false;delete n.is_slidable;for(const t of i){e.setValueAtPath(`${r}.${t}`,n[t],o)}return t}else{let t=false;if(typeof n==="object"){var l;t=(l=n.is_slidable)!=null?l:false;delete n.is_slidable}e.setValueAtPath(r,n,o);return t}}function I(t){if(t.is_deletion){const r=T(t.count);if(!r){var n;const t=new KeyboardEvent("keydown",{key:"ArrowLeft"});(n=e.onKeyDown)==null?void 0:n.call(e,t)}}else if(t.new_has_args){a.GlobalComposerFocusTracker.setFocus(`${t.base_path}.args`,{force_open:true})}else if(t.new_is_slidable){a.GlobalComposerFocusTracker.setFocus(t.base_path,{force_open:true})}else{const n=N(t.count,false,true);if(!n){var r;const t=new KeyboardEvent("keydown",{key:"ArrowRight"});(r=e.onKeyDown)==null?void 0:r.call(e,t)}}}function R(e,t,n,r){var i,s;const o=P(t.raw,e,t.expression.json.path(),n===0?["properties","type"]:["properties","name"],n!==0,r);const a=((i=t.prev_btype)==null?void 0:(s=i.get_message(e==null?void 0:e.name))==null?void 0:s.arg_btype())!=null;if(e==null){I({is_deletion:true,count:n,base_path:t.expression.json.path()})}else{var l,c,u;I({is_deletion:false,new_has_args:a&&((l=(c=(u=t.expression).args)==null?void 0:c.call(u).is_empty())!=null?l:true),new_is_slidable:o,base_path:t.expression.json.path(),count:n})}}return(0,r.createComponent)(i.Show,{get when(){return!e.isTopLevel||!e.expression.is_empty()},get fallback(){return(0,r.createComponent)(l.Atom,{contents:()=>(0,c.datasourcesForContext)(e.expression,e.expectedBtype,e.literalBtype),display:null,onClickAffordance:"Click",get["class"](){var t;return`${(t=e.class)!=null?t:""} empty-expression`},get classList(){return{error:!e.optional}},get optional(){return e.optional},get id(){return e.id},currentValue:null,setCurrentValue:(e,n)=>{R(e,t()[0],0,n)},get disabled(){return e.disabled},highlightState:"no-highlight",depth:0,get setPristineState(){return e.setPristineState},setIsHovered:()=>{}})},get children(){return[(0,r.createComponent)(i.Show,{get when(){return!e.expression.is_literal()},get children(){return(0,r.createComponent)(d.Parenthesis,{side:"open",get["class"](){return e.class},mandatory:true,get highlightState(){return E(S())},get depth(){return e.depth},get setIsHovered(){return k.bind(null,S())}})}}),(0,r.createComponent)(i.For,{get each(){return n()},children:(t,n)=>(0,r.createComponent)(d.Parenthesis,{side:"open",get["class"](){return e.class},mandatory:false,get highlightState(){return E(D()-n()-1)},get depth(){return e.depth+n()+1},get setIsHovered(){return k.bind(null,D()-n()-1)}})}),(0,r.createComponent)(i.For,{get each(){return t()},children:(n,o)=>{function c(t){let r;switch(t.key){case"ArrowLeft":r=T(o());break;case"ArrowRight":{let e=o();if(!n.expression.has_next()||n.expression.is_empty()){e+=.5}r=N(e,false);break}case"Backspace":{P(n.raw,null,n.expression.json.path(),[],o()!==0,"keyboard-input");I({is_deletion:true,count:o(),base_path:n.expression.path()});r=true;break}}if(r){t.stopPropagation();t.preventDefault()}else{var i;(i=e.onKeyDown)==null?void 0:i.call(e,t)}}return[(0,r.createComponent)(i.Show,{get when(){return!n.isSlidable},get fallback(){return(0,r.createComponent)(p.SlidableAtom,{get id(){return n.expression.json.path()},get display(){var e,t,r;return(e=(t=(r=n.expression).display)==null?void 0:t.call(r))!=null?e:""},get node(){return n.expression},get["class"](){return e.class},get highlightState(){return E(s()[o()])},get setIsHovered(){return k.bind(null,s()[o()])},get setIsFocused(){return O.bind(null,s()[o()])},get depth(){return e.depth+D()-s()[o()]},setCurrentValue:e=>{const t={type:"Fake",properties:e!=null?e:undefined,is_slidable:true};P(n.raw,e!=null?t:null,n.expression.json.path(),["properties"],false,"keyboard-input");if(e==null){a.GlobalComposerFocusTracker.setFocus(n.expression.json.path(),{force_open:true})}},onKeyDown:c})},get children(){return(0,r.createComponent)(l.Atom,{get contents(){return n.contents},get display(){var e,t,i,s,o,a,l,c;return(0,r.memo)((()=>!!n.expression.is_empty()))()?null:(e=(t=(i=(s=n.expression).display)==null?void 0:(o=i.call(s))==null?void 0:(a=o.trim)==null?void 0:a.call(o))!=null?t:(l=(c=n.expression).display)==null?void 0:l.call(c))!=null?e:null},get onClickAffordance(){return o()===0&&!e.optional?m:undefined},get["class"](){return e.class},get classList(){return{"show-cursor":n.expression.is_empty()&&o()===0&&!e.optional}},get optional(){return o()!==0},get id(){return n.expression.json.path()},get currentValue(){return n.raw},setCurrentValue:(e,t)=>{R(e,n,o(),t)},get disabled(){return e.disabled},get highlightState(){return E(s()[o()])},get setPristineState(){return e.setPristineState},get setIsHovered(){return k.bind(null,s()[o()])},get setIsFocused(){return O.bind(null,s()[o()])},get depth(){return e.depth+D()-s()[o()]},onKeyDown:c})}}),(0,r.createComponent)(i.Show,{get when(){return n.expression.has_args()&&n.expression},keyed:true,children:l=>{const c=l.args();const u=l.get_arg_btype();return[(()=>{const t=h.cloneNode(true);t.addEventListener("mouseleave",(()=>{k(s()[o()],false)}));t.addEventListener("mouseenter",(()=>{k(s()[o()],true)}));(0,r.effect)((()=>{var n;return(0,r.className)(t,`spacer ${(n=e.class)!=null?n:""}`)}));return t})(),(0,r.createComponent)(y,{get["class"](){return e.class},get id(){return c.path()},get expectedBtype(){return u.id()},get literalBtype(){return u.matches("sys.bool")?undefined:u},expression:c,get currentValue(){var e,t;return(e=(t=n.raw)==null?void 0:t.args)!=null?e:null},get setValueAtPath(){return e.setValueAtPath},get disabled(){return e.disabled},optional:false,get depth(){return e.depth+D()-s()[o()]+1},get atomsReqHighlight(){return E(s()[o()])==="highlight-other"?e.atomsReqHighlight:0},get setAtomHighlightStatus(){return e.setAtomHighlightStatus},get setPristineState(){return e.setPristineState},onKeyDown:t=>{let n;switch(t.key){case"ArrowLeft":case"Backspace":{a.GlobalComposerFocusTracker.setFocus(l.path(),{force_open:false});n=true;break}case"ArrowRight":{n=N(o(),true);break}}if(n){t.stopPropagation()}else{var r;(r=e.onKeyDown)==null?void 0:r.call(e,t)}},isTopLevel:false}),(0,r.createComponent)(i.Show,{get when(){return o()!==t().length-1},get children(){return(0,r.createComponent)(d.Parenthesis,{get["class"](){return e.class},side:"close",mandatory:false,get highlightState(){return E(s()[o()])},get setIsHovered(){return k.bind(null,s()[o()])},get depth(){return e.depth+D()-s()[o()]}})}})]}}),(0,r.createComponent)(i.Show,{get when(){return n.expression.has_next()&&!n.expression.is_empty()&&n.expression},keyed:true,children:a=>{const c=(0,i.createMemo)((()=>o()!==t().length-1||b(a).matches(e.expectedBtype)));return(0,r.createComponent)(l.Atom,{contents:()=>(0,u.messagesForContext)(b(a),a),display:null,get id(){return a.json.path()+v},get["class"](){var t;return(t=e.class)!=null?t:""},get hideUntilFocus(){return c()},classList:{insert:true,"show-cursor":true},onClickAffordance:g,currentValue:null,get optional(){return c()},setCurrentValue:(t,r)=>{var i;if(t==null){I({is_deletion:true,count:o()+.5,base_path:n.expression.path()});return}const s=t;const l=(i=s.is_slidable)!=null?i:false;delete s.is_slidable;let c=n.raw;if(typeof c!=="object"||c==null){c={type:"PrimitiveLiteral",properties:{btype:typeof c==="string"?"text":typeof c,value:c}}}e.setValueAtPath(a.json.path(),{...c,next:{...s,next:c.next}},r);I({is_deletion:false,new_is_slidable:l,new_has_args:a.next().has_args(),base_path:`${a.json.path()}.next`,count:o()+1})},get disabled(){return e.disabled},get highlightState(){return E(s()[o()+1])},get setPristineState(){return e.setPristineState},get setIsHovered(){return k.bind(null,s()[o()+1])},get setIsFocused(){return O.bind(null,s()[o()+1])},get depth(){return e.depth+D()-s()[o()+1]},onKeyDown:t=>{let r;if(t.key==="ArrowLeft"||t.key==="Backspace"){r=T(o()+.5)}else if(t.key==="ArrowRight"){r=N(o()+.5,true)}else if(t.key==="Backspace"){if(n.expression.has_args()){r=T(o()+.5)}else{P(n.raw,null,n.expression.json.path(),[],o()!==0,"keyboard-input");I({is_deletion:true,count:o(),base_path:n.expression.path()});r=true}}if(r){t.stopPropagation()}else{var i;(i=e.onKeyDown)==null?void 0:i.call(e,t)}}})}})]}}),(0,r.createComponent)(i.Show,{get when(){return!e.expression.is_literal()},get children(){return(0,r.createComponent)(d.Parenthesis,{side:"close",get["class"](){return e.class},mandatory:true,get highlightState(){return E(S())},get setIsHovered(){return k.bind(null,S())},get depth(){return e.depth}})}})]}})}},{"../../../lang/btypes":653,"../../../lang/nodes/registry":724,"../utilities/focusTracking":557,"./Atom":517,"./DatasourceContents":518,"./MessageContents":521,"./Parenthesis":522,"./SlidableAtom":523,"./utils":525,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/store":2314,"solid-js/web":2315}],525:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.WHOLE_EXPRESSION_ID=n.SLIDABLE_OPEN_KEYS=n.DROPDOWN_OPEN_KEYS=void 0;n.get_color_depth=l;n.get_is_open_signal=u;n.is_message=c;e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js");var i=e("../utilities/focusTracking");const s=["/"," ","ArrowDown"];n.DROPDOWN_OPEN_KEYS=s;const o=[...s,"Enter"];n.SLIDABLE_OPEN_KEYS=o;const a=".whole_expression";n.WHOLE_EXPRESSION_ID=a;function l(e){return`highlight-${e%7+1}`}function c(e){return e.name!=null}function u(e,t,n,s){var o,a;function l(){return i.GlobalComposerFocusTracker.getFocusState(e(),((e,t)=>{if(t===e){return true}else if(s!=null){return t.startsWith(s())}else{return false}}))}const c=i.GlobalComposerFocusTracker.getFocusState(i.DOCUMENT_FOCUS);const u=l();const d=c.isFocused&&(c.metadata.prev_focus===e()||s!=null&&((o=(a=c.metadata.prev_focus)==null?void 0:a.startsWith(s()))!=null?o:false));const p=d&&c.metadata.force_open===true||u.isFocused&&u.metadata.force_open===true;const[_,f]=(0,r.createSignal)(p);if(p){t()}else if(d&&!p){(0,r.onMount)((()=>{i.GlobalComposerFocusTracker.setFocus(e(),{force_open:false})}))}(0,r.createEffect)((()=>{const e=l();if(e.isFocused&&e.metadata.force_open){f(true);(0,r.untrack)((()=>t()))}else if(!e.isFocused&&!i.GlobalComposerFocusTracker.isFocused(i.DOCUMENT_FOCUS)){f(false);(0,r.untrack)((()=>n==null?void 0:n()))}}));return[_,f]}},{"../utilities/focusTracking":557,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],526:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.LongTextComposer=s;var r=e("solid-js/web");var i=e("./TextComposer");function s(e){return(0,r.createComponent)(i.TextComposer,(0,r.mergeProps)(e,{includeDynamicButton:true,composerSize:"long",placeholder:"Start typing or press / for dynamic data"}))}},{"./TextComposer":529,"solid-js/web":2315}],527:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ShortTextComposer=s;var r=e("solid-js/web");var i=e("./TextComposer");function s(e){return(0,r.createComponent)(i.TextComposer,(0,r.mergeProps)(e,{includeDynamicButton:false,composerSize:"short"}))}},{"./TextComposer":529,"solid-js/web":2315}],528:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.StaticSpan=m;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var i=e("solid-js");var s=e("../utilities/focusTracking");var o=e("solid-js/store");var a=e("../ExpressionComposer/utils");const l=(0,r.template)(`<div class="clickable-container"></div>`,2),c=(0,r.template)(`<div contenteditable class="static-span"></div>`,2),u=(0,r.template)(`<div class="clickable"></div>`,2);const d="\n";const p="<br>";const _=" ";const f=18;function h(e){const t=window.getSelection();t==null?void 0:t.removeAllRanges();t==null?void 0:t.addRange(e)}function m(e){let t;function n(){var t;const n=(t=e.currentValue)!=null?t:"";if(n.endsWith(d)){return n+_}else{return n}}function m(e){const n=window.getSelection();let r,i;if(n!=null&&n.rangeCount!==0){const e=n.getRangeAt(0);i=e.startOffset;if(e.startContainer===t){r=e.startContainer}else{const n=t.childNodes;for(let t=0;t<n.length;t++){if(n[t]===e.startContainer){r=t;break}}}}t.innerText=e;if(r!=null&&i!=null){const e=document.createRange();const n=t.childNodes.length;if(typeof r==="number"){var s,o;const a=t.childNodes[Math.min(r,n)];e.setStart(a,Math.min(i,(s=(o=a.textContent)==null?void 0:o.length)!=null?s:0))}else{e.setStart(r,Math.min(n,i))}e.collapse(true);h(e)}}(0,i.createEffect)((()=>{var e;const r=n();if(((e=t)==null?void 0:e.innerText)!==r){m(r)}}));const[g,v]=(0,i.createSignal)(0);const[b,y]=(0,o.createStore)({});const[w,x]=(0,i.createSignal)(0);const[j,A]=(0,i.createSignal)(0);function M(){var e,n;const r=t.getBoundingClientRect();const i=(e=(n=t.parentElement)==null?void 0:n.getBoundingClientRect())!=null?e:{top:0,bottom:0,left:0,width:0};if(t.childNodes.length===0){v(r.left-i.left-8)}else{const e=document.createRange();e.setStart(t,0);e.setEnd(t,1);const n=e.getBoundingClientRect();v(n.left-i.left-8)}const s=t.querySelectorAll("br");for(let e=0;e<s.length;e++){var o;const t=s[e].getBoundingClientRect();y(e,t.top-((o=i.top)!=null?o:0))}y(s.length,r.bottom-i.top-f);x(i.bottom-r.bottom+f);A(i.width)}(0,i.onMount)((()=>{const e=new MutationObserver(M);e.observe(t.parentElement,{childList:true,subtree:true});const n=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){M();n.unobserve(t)}}))}),{threshold:.1,root:null});n.observe(t);(0,i.onCleanup)((()=>{n.disconnect();e.disconnect()}))}));const E=(0,i.createMemo)((()=>{var t,n;const r=(t=(n=e.currentValue)==null?void 0:n.split(d))!=null?t:[];if(!e.lastSpan){r.pop()}return r}));(0,i.createEffect)((()=>{const n=s.GlobalComposerFocusTracker.getFocusState(e.id+a.WHOLE_EXPRESSION_ID);if(n.isFocused&&n.metadata.open_last_subexpr){const e=document.createRange();if(t.childNodes.length===0){e.selectNodeContents(t)}else{e.selectNodeContents(t.childNodes[t.childNodes.length-1])}e.collapse(false);h(e)}}));return[(()=>{const n=l.cloneNode(true);(0,r.insert)(n,(0,r.createComponent)(i.For,{get each(){return E()},children:(n,i)=>(()=>{const n=u.cloneNode(true);n.$$click=()=>{const e=document.createRange();if(i()<t.querySelectorAll("br").length){e.selectNodeContents(t.querySelectorAll("br")[i()])}else if(t.childNodes.length===0){e.selectNodeContents(t)}else{e.selectNodeContents(t.childNodes[t.childNodes.length-1])}e.collapse(false);h(e)};(0,r.effect)((t=>{const r=`${b[i()]}px`,s=`${i()===0?g():0}px`,o=i()===0?`${j()-g()}px`:"100%",a=i()===E().length-1&&e.lastSpan?`${w()}px`:`${f}px`;r!==t._v$&&n.style.setProperty("top",t._v$=r);s!==t._v$2&&n.style.setProperty("margin-left",t._v$2=s);o!==t._v$3&&n.style.setProperty("width",t._v$3=o);a!==t._v$4&&n.style.setProperty("height",t._v$4=a);return t}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined});return n})()}));return n})(),(()=>{const n=c.cloneNode(true);n.$$input=t=>{var n,r;const i=t.currentTarget.innerText;if(t.inputType==="insertText"&&(n=e.currentValue)!=null&&n.endsWith(d)&&!i.endsWith(d+_)){const t=i.lastIndexOf(_);const n=i.substring(0,t)+i.substring(t+_.length);e.setCurrentValue(n,"keyboard-input");return}if(!i.endsWith(d)&&!i.endsWith(p)&&!((r=e.currentValue)!=null&&r.endsWith(d))){e.setCurrentValue(i,"keyboard-input");if(t.inputType==="insertParagraph"){m(i)}return}switch(t.inputType){case"insertParagraph":{var s;const t=i.replace(/\n\n$/g,d);if((s=e.currentValue)!=null&&s.endsWith(d)){const n=t.lastIndexOf(d+_);const r=t.substring(0,n)+d+t.substring(n+(d+_).length);e.setCurrentValue(r,"keyboard-input")}else{e.setCurrentValue(t,"keyboard-input")}break}case"deleteContentBackward":case"deleteSoftLineBackward":{if(i.endsWith(d)){e.setCurrentValue(i.substring(0,i.length-d.length*2),"keyboard-input")}else{e.setCurrentValue(i.substring(0,i.length-d.length),"keyboard-input")}break}default:{e.setCurrentValue(i,"keyboard-input")}}};n.$$beforeinput=t=>{if(t.inputType==="insertText"&&t.data==="/"){t.preventDefault();const n=t.getTargetRanges()[0];e.onSplit(e.entryIndex,n,"keyboard-input")}};n.$$keydown=n=>{var r;switch(n.key){case"Backspace":case"ArrowLeft":{const r=window.getSelection();if(t.childNodes.length===0||r!=null&&r.rangeCount!==0&&r.getRangeAt(0).collapsed&&r.getRangeAt(0).startOffset===0&&r.getRangeAt(0).startContainer.previousSibling==null){var i;n.preventDefault();(i=e.onKeyDown)==null?void 0:i.call(e,n)}break}case"ArrowRight":{var s;const r=window.getSelection();if(t.childNodes.length===0||r!=null&&r.rangeCount!==0&&r.getRangeAt(0).collapsed&&r.getRangeAt(0).endOffset===((s=r.getRangeAt(0).endContainer.textContent)==null?void 0:s.length)&&r.getRangeAt(0).endContainer.nextSibling==null){var o;n.preventDefault();(o=e.onKeyDown)==null?void 0:o.call(e,n)}break}default:(r=e.onKeyDown)==null?void 0:r.call(e,n)}};(0,r.use)((n=>{t=n;(0,s.applyFocusHere)(n,(()=>e.id),false)}),n);(0,r.spread)(n,(0,r.mergeProps)((()=>({placeholder:e.placeholder}))),false,false);return n})()]}(0,r.delegateEvents)(["keydown","beforeinput","input","click"])},{"../ExpressionComposer/utils":525,"../utilities/focusTracking":557,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/store":2314,"solid-js/web":2315}],529:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.TextComposer=x;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("../utilities/focusTracking");var o=e("../ExpressionComposer/ExpressionComposer");var a=e("../../../lang/btypes");var l=e("./StaticSpan");var c=e("../../../logger");var u=e("../../../u/shared/async/autorun");var d=g(e("../../../lang/appquery"));var p=e("../../../u/client/b_window");var _=e("../../../u/client/client_storage");var f=e("../../components/utils/directives");var h=e("../../../u/shared/loggable");var m=e("../ExpressionComposer/utils");function g(e){return e&&e.__esModule?e:{default:e}}const v=(0,r.template)(`<div class="btn-row"><div class="insert-btn"><div class="fa fa-plus-square"></div><div class="text">Add dynamic data</div></div></div>`,8),b=(0,r.template)(`<div tabindex="-1"><div></div></div>`,4),y=(0,r.template)(`<div></div>`,2);function w(e){let t=0;for(let i=e.endContainer.previousSibling;i!=null;i=i.previousSibling){var n,r;t+=(n=(r=i.nodeValue)==null?void 0:r.length)!=null?n:1}return t+e.endOffset}function x(e){const[t,n]=(0,i.createSignal)(false);const[g,x]=(0,i.createSignal)(null);const j=(0,i.createReaction)(x.bind(null,null));const A=t=>`${e.id}.entries.${t}`;const M=(0,i.createMemo)((()=>{var t;if(typeof e.currentValue==="string")return[e.currentValue];if(!((t=e.currentValue)!=null&&t.entries))return[];return Object.values(e.currentValue.entries)}));const E=(0,i.createMemo)((()=>{if(!M().length)return["static"];return M().map((e=>{if(typeof e==="string"){return"static"}else{return"dynamic"}}))}),[],{equals(e,t){if(e.length!==t.length){return false}for(let n=0;n<e.length;n++){if(e[n]!==t[n]){return false}}return true}});function k(t,n,r,i){let s;if(typeof e.currentValue==="string"){s={0:e.currentValue}}else{var o,a;s=(o=(a=e.currentValue)==null?void 0:a.entries)!=null?o:{}}let l=i!=null?i:n;for(let e=n;e<r;e++,l++){t[l]=s[e]}}(0,i.createEffect)((()=>{let t=true;const n=[];E().forEach(((e,r)=>{if(e==="static"!==t){n.push(r)}else{t=!t}}));if(t&&E().length>1){n.push(E().length)}if(n.length>0){(0,u.autorun_top)((()=>(0,i.untrack)((()=>{const t={};let r=0;let i=0;for(const o of n){k(t,i,o,r);r+=o-i;if(o===0){t[0]=""}else if(o===E().length){t[o]=""}else{const n=E()[o-1];if(n==="dynamic"){t[r]=""}else{var s;t[r-1]=`${t[r-1]}${(s=e.currentValue)==null?void 0:s.entries[o]}`;i=o+1;continue}}r+=1;i=o}k(t,i,E().length,r);e.setCurrentValue({type:"TextExpression",entries:t},"automatic-change")}))))}}));const O=(0,i.createMemo)((()=>M().length));function S(t,n,r){var i;if(E()[t]==="dynamic"){(0,c.error)("Attempting to split a dynamic span!!",{path:e.id,idx:t,selectionIdx:n});return}const o={};k(o,0,t);let a;if(typeof e.currentValue==="string"){a=e.currentValue}else{var l;a=(l=e.currentValue)==null?void 0:l.entries[t]}(i=n)!=null?i:n=a.length;o[t]=a.substring(0,n);o[t+1]={type:"Empty"};o[t+2]=a.substring(n);k(o,t+1,O(),t+3);e.setCurrentValue({type:"TextExpression",entries:o},r);s.GlobalComposerFocusTracker.setFocus(A(t+1),{force_open:true})}function D(t,n){const r={};k(r,0,t);if(E()[t-1]==="static"&&E()[t+1]==="static"){var i,s;const o=n==="keyboard-input"&&g()===t-1;r[t-1]=`${r[t-1]}${o?"/":""}${(i=(s=e.currentValue.entries)==null?void 0:s[t+1])!=null?i:""}`;k(r,t+2,O(),t)}else{k(r,t+1,O(),t)}e.setCurrentValue({type:"TextExpression",entries:r})}function C(e){if(e===0){return}s.GlobalComposerFocusTracker.setFocus(`${A(e-1)}${m.WHOLE_EXPRESSION_ID}`,{open_last_subexpr:true})}function T(e){if(e===E().length-1){return}s.GlobalComposerFocusTracker.setFocus(A(e+1),{})}function N(t,n,r){var i,s;if(E()[t]==="dynamic"&&n==null){D(t,r);return}let o;if(typeof e.currentValue==="string"){o={type:"TextExpression",entries:{0:e.currentValue}}}else{var a;o=(a=e.currentValue)!=null?a:{type:"TextExpression",entries:{}}}(s=(i=o).entries)!=null?s:i.entries={};o.entries[t]=n!=null?n:"";e.setCurrentValue(o,r)}function P(){const t=e.currentValue;(0,p.add_source_appname_tracker)(t,d.default.appname());(0,_.local_storage_put)("bubble_composer_clipboard",t)}function I(){const t=(0,_.local_storage_get)("bubble_composer_clipboard");e.setCurrentValue(t,"user-click")}function R(){e.setCurrentValue(null,"user-click")}let L=null;const z=(0,i.createMemo)((()=>{if(s.GlobalComposerFocusTracker.isChildFocused(`${e.id}.entries`)){var t;const n=s.GlobalComposerFocusTracker.getFocusedId();const r=(t=n==null?void 0:n.split(`${e.id}.entries.`).pop())!=null?t:"";return parseInt(r.split(".")[0])}else{return null}}));return(()=>{const u=b.cloneNode(true),d=u.firstChild;u.addEventListener("mouseleave",(()=>n(false)));u.addEventListener("mouseenter",(()=>n(true)));(0,r.use)(s.applyFocusHere,u,(()=>e.id));(0,r.use)(f.contextMenuHandler,d,(()=>({options:[["Copy",P,()=>{}],["Paste",I,()=>{}],["Clear all",R,()=>{}]],class:"context-menu composer"})));(0,r.insert)(d,(0,r.createComponent)(i.For,{get each(){return E()},children:(t,n)=>{const u=N.bind(null,n());return(0,r.createComponent)(i.Show,{when:t==="static",get fallback(){return(0,r.createComponent)(o.ExpressionComposer,{get currentValue(){var e;return(e=M()[n()])!=null?e:null},setCurrentValue:(t,n)=>{if(typeof t==="number"||typeof t==="boolean"){(0,c.error)("Bad literal written to Text Expression!",{path:e.id,newVal:t});return}u(t,n)},get expression(){return e.expression.entries()[n()]},expectedBtype:"text",get literalBtype(){return(0,a.get)("null")},optional:false,disabled:false,showDefault:false,get id(){return A(n())},get onDirty(){return x.bind(null,null)},onKeyDown:e=>{if(e.key==="ArrowLeft"){C(n());e.preventDefault()}else if(e.key==="ArrowRight"){T(n());e.preventDefault()}}})},get children(){return(0,r.createComponent)(l.StaticSpan,{get currentValue(){var t,i;return(0,r.memo)((()=>typeof e.currentValue==="string"))()?e.currentValue:(t=e.currentValue)==null?void 0:(i=t.entries)==null?void 0:i[n()]},setCurrentValue:u,get placeholder(){return n()===0&&E().length===1?e.placeholder:undefined},get id(){return A(n())},get lastSpan(){return n()===E().length-1},get entryIndex(){return n()},onSplit:(e,t,r)=>{const i=w(t);const o=A(n()+1);S(e,i,r);s.GlobalComposerFocusTracker.setFocus(o,{force_open:true});x(n());j(s.GlobalComposerFocusTracker.isChildFocused.bind(s.GlobalComposerFocusTracker,o))},onKeyDown:e=>{if(e.key==="ArrowLeft"){C(n());e.preventDefault()}else if(e.key==="ArrowRight"){T(n());e.preventDefault()}}})}})}}));(0,r.insert)(u,(0,r.createComponent)(i.Show,{get when(){return e.includeDynamicButton},get children(){const t=v.cloneNode(true),n=t.firstChild;n.$$click=()=>{if(L==null){S(O()-1,null,"user-click")}else if(E()[L]==="static"){const t=window.getSelection();if(t!=null&&t.rangeCount!==0){if(t.rangeCount>1){(0,c.warn)("Add dynamic data, unexpected range count!",{id:e.id,currentValue:(0,h.to_loggable)(e.currentValue),rangeCount:t.rangeCount,ranges:Array.from(Array(t.rangeCount).keys()).map((e=>{const n=t.getRangeAt(e);return{startContainer:{textContent:n.startContainer.textContent,nodeKind:n.startContainer.nodeName},endContainer:{textContent:n.startContainer.textContent,nodeKind:n.startContainer.nodeName},startOffset:n.startOffset,endOffset:n.endOffset}}))})}const n=w(t.getRangeAt(0));S(L,n,"user-click")}}};n.$$mousedown=()=>{L=z()};(0,r.use)(s.trackExclusiveFocus,n,(()=>`${e.id}.insert-btn`));(0,r.insert)(t,(0,r.createComponent)(i.Show,{get when(){return e.additionalButton},keyed:true,children:e=>(()=>{const t=y.cloneNode(true);(0,r.spread)(t,e,false,true);(0,r.insert)(t,(()=>e.text));return t})()}),null);return t}}),null);(0,r.effect)((n=>{var i,s;const o=`${e.composerSize}-text-composer-wrapper ${(i=e.class)!=null?i:""} ${t()?"hovered":""}`,a=`text-composer ${(s=e.class)!=null?s:""}`;o!==n._v$&&(0,r.className)(u,n._v$=o);a!==n._v$2&&(0,r.className)(d,n._v$2=a);return n}),{_v$:undefined,_v$2:undefined});return u})()}(0,r.delegateEvents)(["mousedown","click"])},{"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../logger":744,"../../../u/client/b_window":814,"../../../u/client/client_storage":816,"../../../u/shared/async/autorun":830,"../../../u/shared/loggable":849,"../../components/utils/directives":514,"../ExpressionComposer/ExpressionComposer":520,"../ExpressionComposer/utils":525,"../utilities/focusTracking":557,"./StaticSpan":528,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],530:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.legacy_composer_canvas_classes=void 0;const r={UnimplementedComposer:["composer-unimplemented"],Checkbox:e=>({"composer-checkbox":true,disabled:e.disabled}),Dropdown:["composer-dropdown"],TextBox:["composer-textbox"],MultilineTextBox:[],NumberBox:[],DateBox:["composer-datebox"],ExpressionComposer:["expression-composer"],LongTextComposer:["long-text-composer"],ShortTextComposer:["short-text-composer"]};n.legacy_composer_canvas_classes=r},{}],531:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.legacy_prop_converters=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../utilities/dropdown_contents");var i=e("../../../../constants/composer");var s=e("../../utilities/focusTracking");var o=e("../../../../u");var a=e("solid-js");const l={TextBox:e=>{const{oldProps:t,owner:n}=e;const r=c(e);const i={get placeholder(){return typeof t.placeholder==="function"?t.placeholder(n.node):t.placeholder},get onBlurOnly(){var e;return(e=t.on_blur_only)!=null?e:false},toDisplay:t.display_formatter,fromDisplay:t.on_blur_transform,sanitizeFn:t.custom_transform,validationFn:t.validation_fn};return(0,a.mergeProps)(t,r,i)},Dropdown:e=>{const{oldProps:t,node:n}=e;const l=c(e);const d={get class(){return u((()=>{var e;return{"right-align":(e=t.right_align)!=null?e:false}}),t.get_css_classes)},get currentValue(){var e,r;return(e=(r=n().get_literal())!=null?r:t.default_value)!=null?e:null},setCurrentValue(e,t){l.setCurrentValue(e,t);if(this.contents.get_input_type()===i.COMPOSER_INPUT_TYPES.REAL_TIME_SEARCH){s.GlobalComposerFocusTracker.setFocusIfSelected(l.id,null)}},get contents(){if("set"in t&&!(t.set instanceof r.DropdownContents))throw new o.UnexpectedError("Using a legacy Set unexpectedly");if("contents"in t){return t.contents}let e=t.set;if(t.dropdown_width_override)e=e.with_options({dropdown_width:t.dropdown_width_override});if(t.optional!=null){e=e.with_options({optional:t.optional})}return e},get searchPlaceholder(){var e;return(e=t.real_time_search_placeholder)!=null?e:t.placeholder},get numericalStep(){return t.numerical_step},get hideArrow(){var e;return(e=t.hideArrow)!=null?e:false},get emptyDisplay(){return t.empty_display},get showing(){const e=s.GlobalComposerFocusTracker.getFocusState(l.id);return e.isFocused&&!!e.metadata.force_open},setShowing(e){if(e){s.GlobalComposerFocusTracker.setFocus(l.id,{force_open:true})}else{s.GlobalComposerFocusTracker.setFocusIfSelected(l.id,null)}}};return(0,a.mergeProps)(t,l,d)},MultilineTextBox:e=>{const{oldProps:t}=e;const n=l.TextBox(e);return(0,a.mergeProps)(t,n)},NumberBox:e=>{const{oldProps:t}=e;const n=l.TextBox(e);return(0,a.mergeProps)(n,{get integer(){return t.integer},get integer_percentage(){return t.integer_percentage}})},DateBox:e=>{const{oldProps:t}=e;const n=c(e);return(0,a.mergeProps)(t,n,{validationFn:t.validation_fn})},Checkbox:c,ExpressionComposer:e=>{const{oldProps:t,node:n}=e;const r=c(e);const i={get default(){var e;return(e=t.default_value)!=null?e:null},get showDefault(){return!t.dont_show_default_value},get literalBtype(){return t.editor_value},get expression(){return n()},get expectedBtype(){return t.expected_value}};return(0,a.mergeProps)(t,r,i)},LongTextComposer:e=>{const{oldProps:t,node:n}=e;const r=c(e);const i={get default(){var e;return(e=t.default_value)!=null?e:null},get expression(){return n()},get blockEnterPropagation(){return t.no_enter},get onFocus(){return t.focus_cb},get additionalButton(){return t.additional_button}};return(0,a.mergeProps)(t,r,i)},ShortTextComposer:e=>{const{oldProps:t,node:n}=e;const r=c(e);const i={get default(){var e;return(e=t.default_value)!=null?e:null},get expression(){return n()}};return(0,a.mergeProps)(t,r,i)}};n.legacy_prop_converters=l;function c(e){const{oldProps:t,json:n}=e;return{get class(){return u(t.get_css_classes)},get classList(){var e;return(e=t.get_css_classes)==null?void 0:e.call(t)},get currentValue(){var e,r;return(e=(r=n.raw())!=null?r:t.default_value)!=null?e:null},id:n.path(),setCurrentValue(e,n){var r;(r=t.on_change)==null?void 0:r.call(t,e)},get disabled(){var e;return(e=t.disabled)!=null?e:false}}}function u(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return t.flatMap((e=>{var t;return Object.entries((t=e==null?void 0:e())!=null?t:{})})).filter((e=>{let[t,n]=e;return n})).map((e=>{let[t,n]=e;return t})).join(" ")}},{"../../../../constants/composer":54,"../../../../u":823,"../../utilities/dropdown_contents":556,"../../utilities/focusTracking":557,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],532:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.get_composer=A;var r=e("solid-js/web");var i=b(e("../legacy/control"));var s=e("..");var o=e("../legacy/registry");var a=g(e("events"));var l=e("solid-js");var c=e("./solid_conversion/ComposerCanvas");var u=g(e("../../../safe_require"));var d=g(e("../../../lang/lang"));var p=e("../utilities/focusTracking");var _=e("../legacy/composerUsageSurvey");var f=e("./argument_conversion/canvas_classes");var h=e("./argument_conversion/propsConversion");var m=e("../../../u");function g(e){return e&&e.__esModule?e:{default:e}}function v(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(v=function(e){return e?n:t})(e)}function b(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=v(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const y=(0,r.template)(`<div class="new-composer"></div>`,2);u.default.safe_register("./editor/composer/compatibility/composers",n);const w=["ExpressionComposer"];class x extends a.default{constructor(e,t,n,r){var i,s;super();this.composerCanvas=void 0;this.composer=void 0;this.owner=void 0;this.props=void 0;this.json=void 0;this._composerName=void 0;this._disabledValue=void 0;this._setDisabledValue=void 0;(i=r)!=null?i:r={};const o=(0,l.createSignal)();const a=f.legacy_composer_canvas_classes[e];this._composerName=e;this._disabledValue=o[0];this._setDisabledValue=o[1];this.composer=t;this.owner=n;this.json="json"in r?(s=r.json)!=null?s:n.json:n.json;this.props=this.convertProps(r);this.composerCanvas=new c.ComposerCanvas(this.composer,this.props,a,e in w);this.claim_control_ownership();this.composerCanvas.render()}convertProps(e){var t;h.legacy_prop_converters;const n=h.legacy_prop_converters[this._composerName];const r=(t=n==null?void 0:n({oldProps:e,owner:this.owner,json:this.json,node:this.node.bind(this)}))!=null?t:e;const i=()=>{var e;return(e=this._disabledValue())!=null?e:r.disabled};return(0,l.mergeProps)(r,{setCurrentValue:(e,t)=>{this.owner.write_child(this.node(),e);if(e!=null&&t==="automatic-change"){this.node().commit_merge()}else{this.node().commit()}r.setCurrentValue(e,t)},get disabled(){return i()}})}claim_control_ownership(){i.claim(this.props.id,this);(0,l.onCleanup)((()=>i.clear_owner(this.props.id)))}selected_node(e){return(e?p.GlobalComposerFocusTracker.isChildFocused:p.GlobalComposerFocusTracker.isFocused)(this.props.id)}select_node(){this.composerCanvas.select()}deselect_node(){this.composerCanvas.deselect();(0,_.trigger_composer_survey)()}node(){return d.default.new_expression(this.json,this.owner.get_expression_owner())}write(e,t){this.props.setCurrentValue(e,t)}disable(){this._disabled=true}enable(){this._disabled=false}get _disabled(){return this.props.disabled}set _disabled(e){this._setDisabledValue(e)}get canvas(){return this.composerCanvas.canvas}get_canvas(){return this.canvas}get_owner(){return this.owner}select(){this.select_node()}open(){if("setShowing"in this.props&&typeof this.props.setShowing==="function"){this.select();this.props.setShowing(true)}else{throw new m.UnexpectedError("This composer does not support opening")}}}function j(e){return(()=>{const t=y.cloneNode(true);(0,r.insert)(t,(()=>String(e.currentValue)));return t})()}function A(e,t,n){if(e.toLowerCase()==="composer"){e="ExpressionComposer"}if(!window.composer_revamp){return new((0,o.get_composer)(e))((0,l.mergeProps)({owner:t},n))}else if(e in h.legacy_prop_converters){return new x(e,(0,s.get_composer)(e),t,n)}else{return new x("UnimplementedComposer",j,t,n)}}},{"..":536,"../../../lang/lang":714,"../../../safe_require":777,"../../../u":823,"../legacy/composerUsageSurvey":541,"../legacy/control":542,"../legacy/registry":546,"../utilities/focusTracking":557,"./argument_conversion/canvas_classes":530,"./argument_conversion/propsConversion":531,"./solid_conversion/ComposerCanvas":534,"core-js/modules/web.dom-collections.iterator.js":1123,events:978,"solid-js":2313,"solid-js/web":2315}],533:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.convert_to_legacy=d;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../utilities/dropdown_contents");var i=l(e("../../../lib"));var s=e("../../../u");var o=e("solid-js");var a=e("../../../constants/composer");function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return new(i.default.or_throw().sets.Option)(e.display,e.value,e.documentation_id,undefined,undefined,undefined,e.delete_fn)}class u{constructor(e){this._dependency=void 0;this._backing_contents=void 0;this._dependency=new s.DependencyClass;this._backing_contents=e;(0,o.createEffect)((()=>{this._backing_contents.all();this._dependency.invalidate()}))}get_options(){this._dependency.register();return this._backing_contents.all().map(c)}supports_score(){return false}supports_sections(){this._dependency.register();return this._backing_contents.section_names().length>1||this._backing_contents.section_names()[0]!==r.SINGLE_SECTION}get_section_options(){this._dependency.register();return Object.fromEntries(this._backing_contents.section_names().map((e=>{var t,n;return[e,(t=(n=this._backing_contents.section(e))==null?void 0:n.map(c))!=null?t:[]]})))}editor_type(){return this._backing_contents.get_input_type()}dropdown_width(){return this._backing_contents.get_dropdown_width()}add_new(){const e=this._backing_contents.get_new_option_accelerator();if(e){return[{display:e.display,hide_dropdown:e.hide_dropdown,thumbnail_id:e.documentation_id,fn:e.onClick}]}else{return[]}}contains(e){if(this._find(e)!=null){return true}return this._backing_contents.get_display_for_literal(e)!=null}equals(e,t){return e===t}_find(e){if(e==null){return null}const t=this.get_options();for(const n of t!=null?t:[]){if(this.equals(n.value,e)){return n}}return null}get_display(e){const t=this._find(e);if(t){return t.display}else{return""}}get_default(){return null}get_sorted_list(e){return e.sort(((e,t)=>{var n,r;if(((n=e.display)==null?void 0:n.toLowerCase())<((r=t.display)==null?void 0:r.toLowerCase())){return-1}else{return 1}}))}get_only_option(){const e=this.get_options();if(e.length===1){return e[0]}else{return null}}has_finite_options(){return a.FINITE_OPTION_INPUT_TYPES.has(this.editor_type())}use_typeahead(){return a.COMPOSER_INPUT_TYPES_WITH_TYPEAHEAD.has(this.editor_type())}}function d(e){return new u(e)}},{"../../../constants/composer":54,"../../../lib":741,"../../../u":823,"../utilities/dropdown_contents":556,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],534:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ComposerCanvas=void 0;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("../../../../u");var s=e("solid-js");var o=e("../../utilities/focusTracking");class a{constructor(e,t,n,r){this.canvas=void 0;this.composer=void 0;this.disposeFn=void 0;this.props=void 0;this.canvasCssClasses=void 0;this.include_inner=void 0;this.canvas=(0,i.div)("new-composer");this.composer=e;this.props=t;this.canvasCssClasses=n;this.include_inner=r!=null?r:false}render(){this.disposeFn=(0,i.autorun_top)((()=>(0,s.onCleanup)((0,r.render)((()=>{(0,o.trackExclusiveFocus)(this.canvasElement,(()=>this.props.id),this.include_inner);(0,s.createEffect)((()=>{const e=typeof this.canvasCssClasses==="function"?this.canvasCssClasses(this.props):Object.fromEntries(this.canvasCssClasses.map((e=>[e,true])));Object.entries(e).forEach((e=>{let[t,n]=e;this.canvas[n?"addClass":"removeClass"](t)}))}));const e=this.composer;const t=this;return(0,r.createComponent)(e,(0,r.mergeProps)((()=>t.props)))}),this.canvasElement))));return this.disposeFn}select(){this.canvas.focus()}deselect(){this.canvas.blur()}destroy(){var e;(e=this.disposeFn)==null?void 0:e.call(this)}get canvasElement(){return this.canvas.get()[0]}}n.ComposerCanvas=a},{"../../../../u":823,"../../utilities/focusTracking":557,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],535:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.DropdownComposerInterface=void 0;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=d(e("../../legacy/ComposerBase"));var s=e("../../../../u");var o=e("../../../../constants/composer");var a=e("../../legacy/control");var l=e("solid-js");var c=e("../../static/DropdownComposer");var u=d(e("../../../../safe_require"));function d(e){return e&&e.__esModule?e:{default:e}}u.default.safe_register("./editor/composer/static/DropdownComposerInterface",t.exports);class p extends i.default{constructor(e){super(e);this.canvas=void 0;this.on_change=void 0;this.contents=void 0;this.setShowingDropdown=void 0;this.setSelected=void 0;this.setDisabled=void 0;(0,s.autorun_top)((()=>{var t,n;if(((t=this.node())==null?void 0:t.path())==null){throw new s.UnexpectedError("path is missing")}this.on_change=(n=e.on_change)!=null?n:undefined;this.canvas=(0,s.div)(this.css_class);this.contents=e.contents;const[i,o]=(0,l.createSignal)(false);this.setShowingDropdown=o;const[a,u]=(0,l.createSignal)(false,{equals:false});this.setSelected=u;const[d,p]=(0,l.createSignal)(false);this.setDisabled=p;(0,l.onCleanup)((0,r.render)((()=>{this.claim_path(this.node().path(),a);const t=this;return(0,r.createComponent)(c.DropdownComposer,{get id(){return t.node().path()},get contents(){return t.contents},get showing(){return i()},setShowing:o,get disabled(){return d()},get currentValue(){var n,r;return(n=(r=t.node().get_literal())!=null?r:e.default_value)!=null?n:null},get searchPlaceholder(){var t;return(t=e.real_time_search_placeholder)!=null?t:e.placeholder},get["class"](){var t,n,r;return Object.entries({...(t=(n=e.get_css_classes)==null?void 0:n.call(e))!=null?t:{},"right-align":(r=e.right_align)!=null?r:false}).filter((e=>{let[t,n]=e;return n})).map((e=>{let[t]=e;return t})).join(" ")},setCurrentValue:(e,n)=>t.dropdown_callback({action:e==null?"delete":"change",value:e,merge:n==="automatic-change"}),get numericalStep(){return e.numerical_step},get hideArrow(){var t;return(t=e.hideArrow)!=null?t:false},get emptyDisplay(){return e.empty_display}})}),this.canvas.get()[0]))}))}claim_path(e,t){(0,l.onMount)((()=>{(0,a.claim)(e,this)}));(0,l.onCleanup)((()=>{(0,a.clear_owner)(e)}));(0,l.createEffect)((()=>{if(t()){(0,l.untrack)((()=>(0,a.select)(e)))}else{(0,l.untrack)((()=>(0,a.deselect)(e,this)))}}));(0,l.createEffect)((()=>{if((0,a.selected)(e)){(0,s.one_blur)(this.canvas,(()=>{(0,s.force_focus_change)();(0,a.deselect)(e,this)}))}}))}get css_class(){return"composer-dropdown"}dropdown_callback(e){var t;switch(e.action){case"change":this.write(e.value);if(!(0,a._is_debugger)()){if(e.merge){this.node().commit_merge()}else{this.node().commit()}}(t=this.on_change)==null?void 0:t.call(this,e.value);break;case"delete":this.write(null);this.node().commit();break;default:throw new s.UnexpectedError(`unrecognized: ${e.action}`)}if(this.contents.get_input_type()===o.COMPOSER_INPUT_TYPES.REAL_TIME_SEARCH){this.setSelected(false)}}open(){this.select();this.setShowingDropdown(true)}disable(){super.disable();this.setDisabled(true)}enable(){super.enable();this.setDisabled(false)}select(){this.setSelected(true)}}n.DropdownComposerInterface=p},{"../../../../constants/composer":54,"../../../../safe_require":777,"../../../../u":823,"../../legacy/ComposerBase":537,"../../legacy/control":542,"../../static/DropdownComposer":551,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],536:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.MakeComposer=h;n.get_composer=f;var r=e("./static/CheckboxComposer");var i=e("./static/TextBoxComposer");var s=e("./ExpressionComposer/ExpressionComposer");var o=e("./static/DropdownComposer");var a=e("./static/MultilineTextBoxComposer");var l=e("./static/NumberBoxComposer");var c=e("./static/DateBoxComposer");var u=e("./TextComposer/LongTextComposer");var d=e("./TextComposer/ShortTextComposer");const p={Checkbox:r.CheckboxComposer,Dropdown:o.DropdownComposer,TextBox:i.TextBoxComposer,MultilineTextBox:a.MultilineTextBoxComposer,ExpressionComposer:s.ExpressionComposer,NumberBox:l.NumberBoxComposer,DateBox:c.DateBoxComposer,LongTextComposer:u.LongTextComposer,ShortTextComposer:d.ShortTextComposer};function _(e){e;p}function f(e){return p[e]}function h(e){return f(e.composer_name)(e)}},{"./ExpressionComposer/ExpressionComposer":520,"./TextComposer/LongTextComposer":526,"./TextComposer/ShortTextComposer":527,"./static/CheckboxComposer":549,"./static/DateBoxComposer":550,"./static/DropdownComposer":551,"./static/MultilineTextBoxComposer":552,"./static/NumberBoxComposer":553,"./static/TextBoxComposer":554}],537:[function(e,t,n){var r,i,s,o,a,l=function(e,t){for(var n in t){if(c.call(t,n))e[n]=t[n]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},c={}.hasOwnProperty;o=e("events");a=e("../../../lang/lang");s=e("./control");i=e("./composerUsageSurvey");r=function(e){l(t,e);function t(e){var n;this.owner=e.owner,this.default_classes=e.default_classes,this.json=e.json,this.default_value=e.default_value,this.validation_fn=e.validation_fn,n=e.initialize_args;t.__super__.constructor.call(this);if(this.json==null){this.json=this.owner.json}s.claim(this.json.path(),this);this.default_classes=this.default_classes||[];if(typeof this.initialize==="function"){this.initialize(n)}}t.prototype.selected_node=function(e){return s.selected(this.json.path(),e)};t.prototype.deselect_node=function(){s.deselect(this.json.path(),this);return i.trigger_composer_survey()};t.prototype.select_node=function(){return s.select(this.json.path(),this)};t.prototype.node=function(){return a.new_expression(this.json,this.owner.get_expression_owner())};t.prototype.write=function(e){return this.owner.write_child(this.node(),e)};t.prototype.disable=function(){this._disabled=true;return this.get_canvas().addClass("disabled")};t.prototype.enable=function(){this._disabled=false;return this.get_canvas().removeClass("disabled")};t.prototype.get_canvas=function(){return this.canvas};t.prototype.get_owner=function(){return this.owner};return t}(o.EventEmitter);t.exports=r},{"../../../lang/lang":714,"./composerUsageSurvey":541,"./control":542,events:978}],538:[function(e,t,n){var r,i,s=function(e,t){return function(){return e.apply(t,arguments)}},o=function(e,t){for(var n in t){if(a.call(t,n))e[n]=t[n]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},a={}.hasOwnProperty;r=function(e){o(t,e);function t(e){var n,r,o,a,l,c,u,d,p;d=e.owner,o=e.default_classes,c=e.json,a=e.default_value,n=e.cb;this.is_valid=s(this.is_valid,this);this.is_empty=s(this.is_empty,this);this._read=s(this._read,this);t.__super__.constructor.call(this,{owner:d,default_classes:o,json:c,default_value:a});this.canvas=i.div("composer-file",null,"");p=this.default_classes;for(l=0,u=p.length;l<u;l++){r=p[l];this.canvas.addClass(r)}this.uploader=i.div("",this.canvas,"");this.input=i.input("property-editor-control",this.uploader,"file");this.text=i.div("placeholder-text center-icon",this.uploader,"Upload");this.text.text("Upload");this.file_name="";this.cb=n;this.button_delete=i.div("button-clear-composer-file json-clear bubble-ui light-grey-btn",this.uploader,"clear");this.button_delete.click(function(e){return function(){return e.clear()}}(this));i.autorun(function(e){return function(){if(e.node().get_literal()){if(e.is_valid()){return e._set_state("full")}else{return e._set_state("invalid")}}else{return e._set_state("empty")}}}(this));this.input.on("change",function(e){return function(t){return e._read(t.target.files[0])}}(this))}t.prototype._set_state=function(e){return function(){switch(false){case e!=="empty":return function(e){return function(){e.text.text("Upload");e.text.addClass("empty");return e.button_delete.hide()}}(this);case e!=="full":return function(e){return function(){e.text.text(i.truncate_text(e.file_name,15,false));e.text.removeClass("empty");return e.button_delete.show()}}(this);case e!=="invalid":return function(e){return function(){e.text.text("Invalid");return e.button_delete.show()}}(this)}}.call(this)()};t.prototype._read=function(e){var t;if(e!=null){t=new FileReader;t.onload=function(t){return function(n){t.file_name=e.name;if(typeof t.cb==="function"){t.cb(n.target.result)}t.write(n.target.result);return t.node().commit()}}(this);return t.readAsText(e)}};t.prototype.clear=function(){this.input.val("");this.input.wrap("<form>").closest("form").get(0).reset();this.input.unwrap();this.write(null);this.node().commit();return typeof this.cb==="function"?this.cb():void 0};t.prototype.is_empty=function(){return this.node().is_empty()};t.prototype.is_valid=function(){var e,t;t=this.node().get_literal();if(t!=null){try{JSON.parse(t);return true}catch(t){e=t;return false}}return true};return t}(e("./ComposerBase"));i=e("../../../u");t.exports=r},{"../../../u":823,"./ComposerBase":537}],539:[function(e,t,n){var r,i,s,o,a,l,c,u,d,p,_=function(e,t){for(var n in t){if(f.call(t,n))e[n]=t[n]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},f={}.hasOwnProperty,h=function(e,t){return function(){return e.apply(t,arguments)}};d=e("../../../lang/lang");p=e("../../../u");r=e("./ComposerBase");i=e("../../contextmenu");c=e("./control");l=e("../compatibility/composers");s=function(e){var t;_(n,e);function n(){return n.__super__.constructor.apply(this,arguments)}t=function(e){_(t,e);function t(){this.cleanup_autorun=h(this.cleanup_autorun,this);this.update=h(this.update,this);return t.__super__.constructor.apply(this,arguments)}t.prototype.initialize=function(){this.canvas=p.div("text-entry");this.cleanup_fns=[];return p.autorun(function(e){return function(){var t,n,r,i,s,a,l;e.canvas.empty();e.cleanup_autorun();l=o.has_feature_enabled("reorg_component_selection")?"static-entry-reorg":"static-entry";p.autorun_top((function(){if(e.json.parent().child_names().indexOf(e.json.name())>0){return e.canvas.css("padding-left",e.owner.editor_html().PADDING_FACTOR)}}));if(e.selected_node()){e.canvas.removeClass(l);e.canvas.addClass("editing-"+l);e.editor=e.owner.editor_html();e.canvas.append(e.editor.get_canvas());p.autorun((function(){var t,n,r;t=e.node();if(t.type()!=="string"){r=(n=e.default_value)!=null?n:""}else{r=t.get_literal()}if(r!==e.editor.val()){return e.editor.val(r)}}));a=null;s=function(){if(a!=null){clearTimeout(a)}a=setTimeout((function(){return e.update()}),900);return null};e.editor.on("input",s);e.editor.off("keydown.deleting");e.editor.on("keydown.deleting",(function(t){var n,r;if((n=t.which)===$.ui.keyCode.BACKSPACE||n===$.ui.keyCode.DELETE){if(((r=e.editor)!=null?r.get_editable().caret().start:void 0)===0&&e.editor.get_editable().caret().end===0){return e.owner.delete_previous(e.node())}}}));e.canvas.css("padding-right",0);e.dynamic_button=p.div("insert-dynamic",e.canvas);e.insert_dynamic_button=p.div("insert-dynamic-button text",e.dynamic_button,"Insert dynamic data");e.position_button();setTimeout((function(){return e.position_button()}),20);e.dynamic_button.css({opacity:0});p.velocity(e.dynamic_button,"fadeIn",{duration:200});e.insert_dynamic_button.on("vmousedown",(function(e){e.preventDefault();return null}));e.insert_dynamic_button.on("vclick",(function(){var t,n,r;e.removeAllListeners("lost_selection");r=e.editor.val();n=r.slice(0,e.editor.selectionStart());t=r.slice(e.editor.selectionEnd());e.owner.insert_dynamic(n,t,e.json.name());return null}));p.wait_for_visible(e.editor,(function(){return e.editor.select()}));e.once("lost_selection",(function(){return e.update()}));p.SetFocusOwner(e.dynamic_button,e.editor);return p.one_blur(e.editor,(function(){return e.deselect_node()}))}else{e.canvas.off("vmousedown");if((i=e.dynamic_button)!=null){i.remove()}p.autorun((function(){var t,n,r;t=e.node();if(t.type()!=="string"){r=(n=e.default_value)!=null?n:""}else{r=t.get_literal()}if(r===""){r="  "}return e.canvas.text(r)}));e.canvas.addClass(l);e.canvas.removeClass("editing-"+l);e.canvas.css("padding-right",e.owner.editor_html().PADDING_FACTOR);r=function(){e.select_node();return null};c.mousedown_once(e.canvas,r);n=typeof(t=e.owner).add_entry_div_callback==="function"?t.add_entry_div_callback(e.canvas,r):void 0;if(n){return e.cleanup_fns.push(n)}}}}(this),this.cleanup_autorun)};t.prototype.delete_into=function(){return this.select_node()};t.prototype.update=function(){var e,t,n;e=this.editor.val();t=this.node();if(t.get_static()===e){return}if(t.is_empty()&&e===((n=this.default_value)!=null?n:"")){return}if(this.owner.merge_caused_change){this.owner.merge_caused_change=false;return}return this.write(e)};t.prototype.cleanup_autorun=function(){var e,t,n,r;r=this.cleanup_fns;this.cleanup_fns=[];for(t=0,n=r.length;t<n;t++){e=r[t];e()}};t.prototype.position_button=function(){return c._position_dynamic_button(this.canvas,this.dynamic_button,6)};t.prototype.select=function(){return this.select_node()};t.prototype.open=function(){return this.select()};return t}(r);n.prototype.initialize=function(){this.canvas=p.div(this.css);this.rows=p.div("entry-rows",this.canvas);this.entry_paths_to_composer={};this.assign_click_to_empty_area(function(e){return function(){return e.add_new_text()}}(this));p.autorun(function(e){return function(){var t,n,r,i,s;e.rows.empty();s=o.has_feature_enabled("reorg_component_selection")?"static-entry-reorg":"static-entry";e.add_text_at_beginning_div=p.div("text-entry "+s+" add-text-at-beginning",e.rows);e.add_text_at_beginning_div.text("  ");e.add_text_at_beginning_div.on("vmousedown",(function(){var t,n,r,i;n=function(){var e,n,r,i,s,o;s=(i=typeof(e=this.node()).entries==="function"?e.entries():void 0)!=null?i:[];o=[];for(n=0,r=s.length;n<r;n++){t=s[n];o.push(t.raw())}return o}.call(e);n.unshift("");n=e.merge_entries(n);e.write_entries(n);e.node().commit();r=e.node().entries()[0];i=r.path();c.clear_owner(i);return c.select(i)}));p.autorun_top((function(){if(e.node().entries==null&&p.not_empty(e.node().raw())){return e.write(d.RAW.TextExpression([e.node().raw()]))}}));t=p.autorun_return((function(){var t,n;return Math.max(1,(n=typeof(t=e.node()).entries==="function"?t.entries().length:void 0)!=null?n:1)}));for(n=r=0,i=t;0<=i?r<i:r>i;n=0<=i?++r:--r){e.create_entry(n)}}}(this));return i().add_handler(this.canvas,function(e){return function(t){var n;n=[["Copy",function(){return e.copy_all()},function(){}],["Paste",function(){return e.paste_all()},function(){return!e.can_paste_all()}],["Paste before",function(){return e.paste_before()},function(){return!e.can_paste_all()}],["Paste after",function(){return e.paste_after()},function(){return!e.can_paste_all()}],["Clear all",function(){return e.clear_all()},function(){}]];i().open(t,"context-menu composer",n);return i().set_focus_owner(e.canvas)}}(this))};n.prototype.copy_all=function(){var e;e=this.node().json.raw();p.add_source_appname_tracker(e,o.appname());return p.local_storage_put("bubble_composer_clipboard",e)};n.prototype.can_paste_all=function(){return p.local_storage_get("bubble_composer_clipboard")!=null};n.prototype.clear_all=function(){this.write(null);return this.node().commit()};n.prototype.paste_all=function(){var e;e=p.local_storage_get("bubble_composer_clipboard");this.write(e);return this.node().commit()};n.prototype._paste_before_after=function(e){var t,n,r,i,s,a,l,c,u,d,_;t=p.local_storage_get("bubble_composer_clipboard");n=this.node().json.raw();if(n==null||!n.entries){this.paste_all();return}if(e){l=n.entries;for(r in l){a=l[r];continue}c=t.entries;for(i in c){a=c[i];n.entries[parseInt(i)+parseInt(r)+1]=a}s=n.entries}else{u=t.entries;for(r in u){a=u[r];continue}d=n.entries;for(i in d){a=d[i];t.entries[parseInt(i)+parseInt(r)+1]=a}s=t.entries}_={entries:s,type:n.type};p.add_source_appname_tracker(_,o.appname());this.write(_);return this.node().commit()};n.prototype.paste_before=function(){return this._paste_before_after()};n.prototype.paste_after=function(){return this._paste_before_after(true)};n.prototype.create_entry=function(e){var n;n=p.div("textcomposer-entry",this.rows);return p.autorun(function(r){return function(){var i,s,c,u,d,_,f;f=o.has_feature_enabled("reorg_component_selection")?"static-entry-reorg":"static-entry";s=o.has_feature_enabled("reorg_component_selection")?"dynamic-entry-reorg":"dynamic-entry";n.empty();_=p.autorun_return((function(){var t,n,i;n=typeof(t=r.node()).entries==="function"?t.entries()[e]:void 0;if(!n){return["0",true]}else{if((typeof n.type==="function"?n.type():void 0)==="string"){i=true}else{i=false}return[n.json.name(),i]}})),i=_[0],u=_[1];d=r.json.child("entries").child(i);if(u){c=new t({owner:r,json:d,default_value:r.default_value});n.addClass(f);n.removeClass(s)}else{c=l.get_composer("ExpressionComposer",r,{json:d,expected_value:a.stringable,optional:true});n.addClass(s);n.removeClass(f)}if(e===0){if(u){r.add_text_at_beginning_div.hide()}else{r.add_text_at_beginning_div.show();r.add_text_at_beginning_div.css("display","inline")}}n.append(c.canvas);return r.entry_paths_to_composer[d.path()]=c}}(this))};n.prototype.merge_entries=function(e){var t,n,r;e=p.json_deep_copy(e);t=0;while(t<e.length-1){if(typeof e[t]==="string"&&typeof e[t+1]==="string"){if(e[t+1]!==""){this.merge_caused_change=true}e[t]=e[t]+e[t+1];[].splice.apply(e,[n=t+1,t+2-n].concat(r=[])),r}else{t+=1}}return e};n.prototype.write_entries=function(e){e=this.merge_entries(e);return this.write(d.RAW.TextExpression(e))};n.prototype.write_child=function(e,t){var n,r,i;r=this._node_to_index(e);i=function(){var e,t,r,i,s,o;s=(i=typeof(e=this.node()).entries==="function"?e.entries():void 0)!=null?i:[];o=[];for(t=0,r=s.length;t<r;t++){n=s[t];o.push(n.raw())}return o}.call(this);if(r===-1){i.push(t)}else{i[r]=t}this.write_entries(i);return this.node().commit()};n.prototype.get_expression_owner=function(){return this.owner.get_expression_owner()};n.prototype.insert_dynamic=function(e,t,n){var r,i,s,o,a,l,u,p,_,f,h,m,g,v;i=typeof(r=this.node()).entries==="function"?r.entries():void 0;if(!(i!=null?i.length:void 0)){p=[d.RAW.Empty()];_=0}else{a=function(){var e,t,n;n=[];for(e=0,t=i.length;e<t;e++){s=i[e];n.push(s.json.name())}return n}().indexOf(n);p=[];for(o=l=0,m=a;0<=m?l<m:l>m;o=0<=m?++l:--l){p.push(i[o].raw())}p.push(e);p.push(d.RAW.Empty());p=this.merge_entries(p);_=p.length-1;p.push(t);for(o=u=g=a+1,v=i.length;g<=v?u<v:u>v;o=g<=v?++u:--u){p.push(i[o].raw())}}this.write_entries(p);this.node().commit();f=this.node().entries()[_];h=f.path();c.clear_owner(h);c.select(h);return c.call_on_owner(h,"open")};n.prototype.select=function(){return this.add_new_text()};n.prototype.add_new_text=function(){var e,t,n,r,i,s,o;t=(s=typeof(e=this.node()).entries==="function"?e.entries():void 0)!=null?s:[];r=t[t.length-1];if(r==null){o=this.node().path()+".entries.0"}else if(r.type()==="string"){o=r.path()}else{i=function(){var e,r,i;i=[];for(e=0,r=t.length;e<r;e++){n=t[e];i.push(n.raw())}return i}();i.push("");this.write_entries(i);this.node().commit();t=this.node().entries();o=t[t.length-1].path()}return c.call_on_owner(o,"select")};n.prototype._node_to_index=function(e){var t;t=this.json.child("entries").child_names();return t.indexOf(e.node_name())};n.prototype.find_previous_entry=function(e){var t;t=this._node_to_index(e);if(t<1){return null}return this.node().entries()[t-1]};n.prototype.delete_previous=function(e){var t;t=this.find_previous_entry(e);if(t){return this.delete_into_child(t)}};n.prototype.delete_into_child=function(e){var t,n,r,i,s;if(!e){return}if(e.is_empty()){i=this._node_to_index(e);s=function(){var e,n,s,o;s=this.node().entries();o=[];for(r=e=0,n=s.length;e<n;r=++e){t=s[r];if(r!==i){o.push(t.raw())}}return o}.call(this);this.write_entries(s);this.node().commit();if(i>0){return this.delete_into_child(this.node().entries()[i-1])}}else{n=this.entry_paths_to_composer[e.path()];return n.delete_into()}};n.prototype.assign_click_to_empty_area=function(e){this.get_canvas().off("vmousedown.empty_click");return this.get_canvas().on("vmousedown.empty_click",function(t){return function(n){if(n.target===t.get_canvas()[0]&&n.which===1){e()}return null}}(this))};return n}(r);u=e("../../css");o=e("../../../lang/appquery");a=e("../../../lang/btypes");t.exports=s},{"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/lang":714,"../../../u":823,"../../contextmenu":558,"../../css":560,"../compatibility/composers":532,"./ComposerBase":537,"./control":542}],540:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");const i=e("./control");const s=e("./registry");const{render:o}=e("solid-js/web");const a=e("../../thumbnail");const l=e("events");const c=e("../../utils/editor_exposure");const u=e("../../css");const d=e("../../../lang/appquery");const p=e("../../../client/analytics");const _=e("../../../u");const{COMPOSER_INPUT_TYPES:f}=e("../../../constants/composer");const h=e("../../../geolocation/b_location");const m=e("../../../geolocation/shared/b_location_utils");const g=e("../../../logger");const v=e("../../slidablepalette");const{createEffect:b,createSignal:y,untrack:w}=e("solid-js");const{DropdownContents:x}=e("../utilities/dropdown_contents");const{AutocompleteDropdown:j}=e("../../components/design/dropdown/AutocompleteDropdown");const{datasourceIsEqual:A}=e("../ExpressionComposer/DatasourceContents");const M=n;let E;class k{constructor(e){var t,n;let r;this.node=e;i.claim(this.node.path(),this);if(this.node.is_empty()){r="(More...)"}else{r=this.node.display_simple()}this.canvas=$('<span class="dynamic">'+_.escape(r)+"</span>");this.canvas.on("vmousedown",(e=>{if(e.which!==3){this.select()}}));if(((t=(n=this.node).thumbnail_id)==null?void 0:t.call(n))!=null){a().add(this.canvas,this.node.thumbnail_id(),"bottom")}}select(){const e=this.node.path();i.clear_owner(e);i.select(e);i.call_on_owner(e,"open")}open(){this.select()}}M.StaticAtom=k;let O={};class S extends l.EventEmitter{add_class(e){var t;this.canvas.addClass(e);(t=this.dropdown)==null?void 0:t.canvas.addClass(e);this.cls_to_add_to_dropdown=e}build_spot_canvas(){var e,t,n;if(this.path==null){throw new _.UnexpectedError("path is missing: "+this.path)}i.claim(this.path,this);(n=(e=O)[t=this.path])!=null?n:e[t]=_.Box(false);this.canvas=_.div(u.SPOT);this.canvas.addClass("property-editor-control");this.canvas.toggleClass("mandatory",!this.optional);this.canvas.toggleClass("optional",this.optional);if(!i._is_debugger()){$(document).off("keydown.editable-spot");$(document).on("keydown.editable-spot",(e=>{if(e.keyCode===$.ui.keyCode.ENTER){if(i.selected(this.path)){this.open()}}}))}_.autorun((()=>{if(i.selected(this.path)){_.one_blur(this.canvas,(()=>{_.force_focus_change();i.deselect(this.path,this)}))}}))}constructor(e){var t,n,r,o,a,l;let c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let u,p,v;super();if(c)return;({callback:this.callback,display:this.display,val:this.val,optional:this.optional,set:this.set,placeholder:p,path:this.path,numerical_step:this.numerical_step,real_time_search_placeholder:this.real_time_search_placeholder,from_dropdown:this.from_dropdown,add_tooltip:this.add_tooltip,right_align:this.right_align,sticky_section:this.sticky_section,empty_display:this.empty_display}=e);(t=this.optional)!=null?t:this.optional=false;let b=d.has_feature_enabled("reorg_component_selection");(n=E)!=null?n:E=_.autotop((()=>{const e=d.has_feature_enabled("reorg_component_selection");if(b!==e){O={};b=e}}));if(typeof this.set==="function"){this.build_solid_canvas();return}this.build_spot_canvas();if(!this.set.editor_type()&&!((r=this.set.get_options())!=null&&r.length)){this.canvas.addClass("no-choices")}else{this.canvas.removeClass("no-choices")}if(this.display==null||$.trim(this.display)===""){this.canvas.addClass("empty")}this.on("delete_pressed",(()=>{var e;if((e=this.ip)!=null&&e.is_focused()){return}this.close();this.callback({action:"delete"})}));(l=(o=O)[a=this.path])!=null?l:o[a]=_.Box(false);if(this.set.use_typeahead()){v=_.Box(null)}this.ensure_dropdown=()=>{if(this.dropdown){return}this.dropdown=new(s.get_composer("ComposerPalette"))({target:this.canvas,set:this.set,optional:this.optional,cb:e=>this.change(e),current_val:this.val,real_time_search_box:v,path:this.path,numerical_step:this.numerical_step,right_align:this.right_align,sticky_section:this.sticky_section,empty_display:this.empty_display});if(this.cls_to_add_to_dropdown){return this.dropdown.canvas.addClass(this.cls_to_add_to_dropdown)}};_.autorun((()=>{this.canvas.empty();let e=this.set.editor_type();if(e===f.REAL_TIME_SEARCH&&!O[this.path]()){e=f.ENUMERATED}if(this.spot_is_selected()&&e!==f.ENUMERATED){let n;this.canvas.removeClass("no-editor");e=this.set.editor_type();if(this.set.use_typeahead()){var t;if(e===f.REAL_TIME_SEARCH){n=""}else if(e===f.BOOLEAN){n=this.display}else{n=this.val}this.ip=new(s.get_composer("TextInput"))(n,"",(()=>{}));this.ip.canvas.attr("placeholder",(t=this.real_time_search_placeholder)!=null?t:"Search...");this.canvas.append(this.ip.canvas);this.ip.canvas.on("keyup",(()=>{v(this.ip.canvas.val())}));this.ip.canvas.on("change",(t=>{var r;t.stopPropagation();if(((r=this.dropdown)==null?void 0:r.currently_hovered.option)!=null){return}n=this.ip.canvas.val();switch(e){case f.TEXT:if(n===""){n=null}this.change(n);break;case f.NUMBER:if(!isNaN(n)){this.change(parseFloat(n))}break;case f.INTEGER:if(!isNaN(n)){this.change(parseInt(n))}break}}))}else if(e===f.GEOGRAPHIC_ADDRESS){n=h.get_address(this.val);this.ip=new(s.get_composer("TextInput"))(n,this.set.get_default(),(e=>{_.run_once(30,(()=>h.from_address(m.rehydrate_b_location(e),true)),((e,t)=>{if(e){g.log(e);window.alert("Oops, we are having a problem resolving the address... please try again later");return}if(t){this.change({type:"GeoAddress",val:t})}}))}));this.canvas.append(this.ip.canvas);this.ip.canvas.addClass("address-input")}else if([f.NUMBER,f.INTEGER].includes(e)){if(this.from_dropdown){this.ip=new(s.get_composer("NumberInput"))({val:this.val,default_value:this.set.get_default(),cb:e=>this.change(e),integer_only:e===f.INTEGER,numerical_step:this.from_dropdown?this.numerical_step:undefined})}this.canvas.append(this.ip.canvas)}else if(e===f.BOOLEAN){this.canvas.addClass("no-editor");if(this.display!=null&&this.display!==""){this.canvas.text(this.display)}}else if(e===f.KEY_COMBINATION){this.ip=new(s.get_composer("KeyCombinationInput"))(this.val,this.set.get_default(),(e=>this.change(e)));this.ip.canvas.attr("placeholder","Press any key(s)...");this.canvas.append(this.ip.canvas)}else{throw new _.UnexpectedError("unrecognized editor type: "+e)}if(this.ip){this.ip.canvas.on("keydown",(e=>{if(!i._is_debugger()){if(![$.ui.keyCode.DOWN,$.ui.keyCode.UP,$.ui.keyCode.ENTER].includes(e.keyCode)){e.stopPropagation()}if([$.ui.keyCode.DOWN,$.ui.keyCode.UP].includes(e.keyCode)){e.preventDefault()}}}));_.wait_for_attached(this.ip.canvas,(()=>{this.ip.canvas.focus()}));if(!i._is_debugger()){this.ip.set_delete_cb((()=>{this.callback({action:"delete"})}))}}}else{var n;this.canvas.addClass("no-editor");if(this.display!=null&&this.display!==""){this.canvas.text(this.display)}else if(p){this.canvas.text(p)}else if(!this.from_dropdown){this.canvas.text(this.optional?"More...":"Click")}if(this.add_tooltip&&((n=this.display)==null?void 0:n.length)>20){this.canvas.attr("title",this.display)}}}));_.autorun((()=>{let e;const t=this.dropdown_should_be_open();let n=false;if(t){e=this.set.get_section_options();if(this.set.include_self){delete e.CustomDefinition}for(const t in e){const r=e[t];if(r){n=true;break}}}if(n){this.canvas.addClass("selected");this.ensure_dropdown();this.dropdown.show(e)}else{var r;this.canvas.removeClass("selected");(r=this.dropdown)==null?void 0:r.hide();if(this.set.editor_type()===f.REAL_TIME_SEARCH){var i;(i=this.ip)==null?void 0:i.canvas.val("");v(null)}}}),(()=>{var e;(e=this.dropdown)==null?void 0:e.destroy()}));if(!i._is_debugger()){u="vmousedown"}else{u="mousedown"}this.canvas.on(u,(e=>{if(e.which!==3){if(!this._disabled){if(this.dropdown_should_be_open()){this.close()}else{this.open()}}}return null}))}build_solid_canvas(){i.claim(this.path,this);this.canvas=_.div(u.SPOT);O[this.path]=y(i.selected(this.path));b((e=>{if(e&&!O[this.path][0]()){w((()=>{_.force_focus_change();i.deselect(this.path,this)}))}return O[this.path][0]()}),false);const e=()=>{var e,t;switch(this.set().get_input_type()){case f.TEXT:if(typeof((e=this.val)==null?void 0:e.raw())==="string"){var n;return(n=this.val)==null?void 0:n.raw()}break;case f.INTEGER:case f.NUMBER:if(typeof((t=this.val)==null?void 0:t.raw())==="number"){var r;return(r=this.val)==null?void 0:r.raw()}break}return undefined};const[t,n]=y(i.selected(this.path));const s=this;o((()=>(0,r.createComponent)(j,{get contents(){return(0,r.memo)((()=>!!t()))()?s.set().with_options({optional:s.optional,dropdown_width:"short"}):x.empty({optional:s.optional})},get currentlySelected(){var e;return(e=s.val)==null?void 0:e.raw()},get captionPlaceholder(){var t;return(t=s.display)!=null?t:e()},onSelect:e=>{if(e==null){s.close();s.callback({action:"delete"})}else if(e.cb_fn){e.cb_fn((function(){return s.change(...arguments)}))}else{s.change(e)}},onOpen:()=>{if(!i.selected(s.path)){i.select(s.path)}n(true)},get showingSignal(){return O[s.path]},get["class"](){var e;return`new-composer ${(e=s.cls_to_add_to_dropdown)!=null?e:""}`},hideArrow:true,equals:(e,t)=>{if(e==null&&t==null){return true}else if(e==null||t==null){return false}if(e.name!=null||t.name!=null){return e.name===t.name}return A(e,t)}})),this.canvas[0])}change(e){var t,n,r,i;const s=(t=e==null?void 0:e.val)!=null?t:e;const o=(n=this.set)==null?void 0:(r=n.value)==null?void 0:(i=r.get_message)==null?void 0:i.call(r,s.name).is_lookup();if((s==null?void 0:s.type)==="Message"&&!o){p.track("Operator added",{app:d.appname(),operator:s.name});c.maybe_increase_event_count(c.EVENTS.NEW_OPERATOR)}this.close();this.callback({action:"change",value:e})}dropdown_should_be_open(){return O[this.path]()&&this.spot_is_selected()}select(){i.select(this.path)}open(){this.select();if(typeof O[this.path]==="function"){O[this.path](true)}else{O[this.path][1](true)}}close(){if(typeof O[this.path]==="function"){O[this.path](false)}else{O[this.path][1](false)}}disable(){this.canvas.addClass("disabled");this._disabled=true}enable(){this.canvas.removeClass("disabled");this._disabled=false}spot_is_selected(){return _.autorun_return((()=>i.selected(this.path)))}}M.DynamicAtom=S;class D extends S{constructor(e){let{node:t,callback:n,optional:r}=e;const s=null;const o=true;super(s,o);this.node=t;this.callback=n;this.optional=r;this.path=this.node.path();this.build_spot_canvas();this.canvas.addClass("slidable-spot");this.canvas.text(this.node.display());this.on("delete_pressed",(()=>{this.close();this.callback({action:"delete"})}));this.slidable_palette=v.SlidablePalette();if(_.autorun_top((()=>i.selected(this.path)))){this.show()}this.canvas.on("vmousedown",(()=>{this.show()}));_.autorun((()=>{var e;if(((e=this.slidable_palette.node_box())==null?void 0:e.path())===this.path&&this.slidable_palette.is_open()){this.canvas.addClass("slidable-owner")}else{this.canvas.removeClass("slidable-owner")}}))}show(){i.add_to_stack(this);this.slidable_palette.assign_node(this.node,(e=>{this.callback(e);if(e.action!=="change"){this.hide()}}),(()=>{i.remove_from_stack(this);if(i.selected(this.path)||i.selected(this.path+".properties",true)){i.select(null)}}));this.slidable_palette.show()}hide(){var e;this.slidable_palette.hide();(e=i.get_last_layer())==null?void 0:e.show()}select(){i.select(this.path)}open(){this.select();this.show()}close(){this.hide()}}M.SlidableAtom=D},{"../../../client/analytics":20,"../../../constants/composer":54,"../../../geolocation/b_location":621,"../../../geolocation/shared/b_location_utils":626,"../../../lang/appquery":651,"../../../logger":744,"../../../u":823,"../../components/design/dropdown/AutocompleteDropdown":498,"../../css":560,"../../slidablepalette":587,"../../thumbnail":590,"../../utils/editor_exposure":593,"../ExpressionComposer/DatasourceContents":518,"../utilities/dropdown_contents":556,"./control":542,"./registry":546,"core-js/modules/web.dom-collections.iterator.js":1123,events:978,"solid-js":2313,"solid-js/web":2315}],541:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.trigger_composer_survey=i;let r=false;function i(){if(!r){var e,t;(e=(t=window).UserLeap)==null?void 0:e.call(t,"track","composer_used");r=true}}},{}],542:[function(e,t,n){"use strict";e("core-js/modules/esnext.array.find-last.js");e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("events");const s=e("../../css");const o=e("../../thumbnail");const a=e("../../documentationpalette");const l=n;let c=[];l.add_to_stack=function(e){if(c.length){if(e.path.indexOf(c[0].path)!==0){c=[]}}if(!c.map((e=>e.path)).includes(e.path)){c.push(e)}};l.remove_from_stack=function(e){c=c.filter((t=>t.path!==e.path))};l.get_last_layer=function(){return c.pop()};l.add_arrow_handlers_numeric_box=function(e,t,n){var r;(r=n)!=null?r:n=1;e.on("keydown",(r=>{if([38,40].includes(r.which)){function i(e){const t=e+"";if(t.indexOf(".")===-1){return 0}else{return t.split(".")[1].length}}let s=parseFloat(e.val());if(isNaN(s)){s=parseFloat(e.attr("placeholder"));if(isNaN(s)){s=null}}const o=r.shiftKey?5*n:n;const a=Math.max(i(s),i(o));if(r.which===38){t(parseFloat((s+o).toFixed(a)))}if(r.which===40){t(parseFloat((s-o).toFixed(a)))}}}))};l.mousedown_once=function(e,t){function n(r){if(r.which!==1){e.one("vmousedown",n)}else{t==null?void 0:t(r)}}e.one("vmousedown",n)};l.delay_autorun=r.Box(null);l.selection=new i.EventEmitter;const u=r.Box(null);l.select=function(e){if(!l._is_debugger()){p()}if(e===null){const t=c.findLast((e=>e.slidable_palette.is_open()));if(t!=null){e=t.path}}const t=u();if(e!==t){if(t){f(t,"lost_selection")}u(e);return l.selection.emit("selection",e)}};l.deselect=function(e,t){if(!t){throw new r.UnexpectedError("called deselect without an owner on path "+e)}if(t!==_[e]){return}if(u()===e){return l.select(null)}};l.selected=function(e,t){var n;(n=t)!=null?n:t=false;if(t){var r;return((r=u())==null?void 0:r.indexOf(e))===0}else{return u()===e}};let d=false;const p=function(){if(d){return}d=true;$(document).on("keydown.composer-selected",(e=>{if([$.ui.keyCode.BACKSPACE,$.ui.keyCode.DELETE].includes(e.which)){if(!r.did_event_pass_through(e,"input,textarea")){const t=u();if(t){f(t,"delete_pressed");e.preventDefault()}}}return null}))};const _={};l.claim=function(e,t){return _[e]=t};l.clear_owner=function(e){return delete _[e]};const f=function(e,t){return l.get_owner(e,(function(e){return e.emit(t)}))};l.call_on_owner=function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++){i[s-2]=arguments[s]}return l.get_owner(e,(e=>{if(!e[t]){throw new r.UnexpectedError("type "+e.constructor.name+" does not have method "+t)}return e[t](...i||[])}))};l.get_owner=function(e,t,n){if(e==null){throw new r.UnexpectedError("called get_owner with no path")}if(typeof e!=="string"){throw new r.UnexpectedError("non-string path")}if(_[e]){return t(_[e])}else{r.wait_for_updates((()=>{if(_[e]){return t(_[e])}else if(n){return t()}else{console.log("warning: no owner for path "+e)}}))}};l._position_dynamic_button=function(e,t,n){var i;let o;(i=n)!=null?i:n=0;if(e.parents(s.PROPERTY_EDITOR).length){o=s.PROPERTY_EDITOR}else if(e.parents(s.SLIDABLE_PALETTE).length){o=s.SLIDABLE_PALETTE}const a=e.parents(o);if(r.is_attached(a)){var l,c,u;let r=((l=a.offset())==null?void 0:l.left)+a.width()-23;if(r+125>$(window).width()){var d;r=((d=a.offset())==null?void 0:d.left)-140}return t.css({left:r,top:Math.max((c=e.offset())==null?void 0:c.top,((u=a.offset())==null?void 0:u.top)+55)-$(window).scrollTop()-n})}};l.fix_grammarly=function(e){e.attr("data-gramm_editor","false")};l.file_storage_error_handler=function(e){if(e!=null){if(e.message==="FILE_TOO_LARGE"){return window.MessagePanel({title:"File size limit",message:e.display()})}else if(e instanceof r.UserError){return window.MessagePanel({title:"User Error",message:e.display()})}else if(e.statusCode===400&&e.message.indexOf("exceeded your allowed storage")!==-1){return window.MessagePanel({title:"Storage limit",message:e.message})}}return window.MessagePanel({title:"Unexpected Error",message:"An unexpected error occurred"})};l.enter_is_change=function(e){if(!l._is_debugger()){e.on("keydown",(t=>{if([$.ui.keyCode.ENTER,$.ui.keyCode.TAB].includes(t.which)){e.change()}}))}};l._is_debugger=function(){return!r.is_edit_mode()&&r.is_debug_mode()};l._is_directly_on_page=function(e,t,n){function i(){if(e.parents(".bubble-ui").length||e.parents(".light-design").length||r.safe_contains(t,"privacy_role")||r.safe_contains(t,"styles")||e.hasClass("bubble-ui")){return true}}let s=null;function o(){if(!e.parents().length){s=setTimeout((()=>o()),50)}else{if(i()){n==null?void 0:n.addClass("bubble-ui");return true}}}o();setTimeout((()=>clearTimeout(s)),500)};l.option_divs_cache={};l._select_dropdown_option=function(e,t){var n;if(!t||t.disabled){return}if((n=t.value)!=null&&n.cb_fn){t.value.cb_fn(e.cb)}else{e.cb(t.value)}return null};l._add_dropdown_option_handlers=function(e,t,n,r){t.on("mouseenter",(()=>{var i,s,o,a;(i=n.hover_cb)==null?void 0:(s=i.enter)==null?void 0:s.call(i);(o=e.currently_hovered)==null?void 0:(a=o.opt_div)==null?void 0:a.removeClass("hovered");e.currently_hovered={n:r,option:n,opt_div:t};t.addClass("hovered")}));return t.on("mouseleave vclick",(()=>{var r,i,s,o;if(((r=e.currently_hovered)==null?void 0:(i=r.option)==null?void 0:i.value)===n.value){e.currently_hovered=0}(s=n.hover_cb)==null?void 0:(o=s.leave)==null?void 0:o.call(s);t.removeClass("hovered")}))};l._draw_dropdown_option=function(e,t,n,i){var s,c;let u,d,p;const _=n.value+"_"+n.display+"_"+i+"_"+((s=n.delete_cb)==null?void 0:s.toString())+"_"+n.caption;if(!t[_]){p=r.div("dropdown-option",undefined,n.display);if(n.delete_cb){p[0].classList.add("delete-btn-added");u=r.div("delete-option fa fa-trash-o",p)}else if(n.disabled){p[0].classList.add("disabled");r.div("disabled-option-msg",p,n.caption)}t[_]={opt_div:p,delete_btn:u}}({opt_div:p,delete_btn:u}=t[_]);p.show();(c=u)==null?void 0:c.show();if(e.set.preview_fonts){p.data("font_value",n.value)}p[0].classList.toggle("currently-selected-option",e.set.equals(n.value,e.current_val));p[0].classList.remove("hovered");if(!l._is_debugger()){d="vclick"}else{d="click"}p.off(d);p.on(d,(t=>{t.stopPropagation();if(p[0].classList.contains("disabled")){return}l._select_dropdown_option(e,n)}));l._add_dropdown_option_handlers(e,p,n,i);if(u){u.on("vclick",(e=>{e.stopPropagation();n.delete_cb()}))}if(n.thumbnail_id){if(n.thumbnail_id.indexOf("Documentation.")===0){a.DocumentationPalette().add(p,n.thumbnail_id)}else{o().add(p,n.thumbnail_id)}}return{option:n,opt_div:p,n:i}}},{"../../../u":823,"../../css":560,"../../documentationpalette":565,"../../thumbnail":590,"core-js/modules/esnext.array.find-last.js":1122,"core-js/modules/web.dom-collections.iterator.js":1123,events:978}],543:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("./ComposerBase");const i=e("./control");const s=e("./registry");const o=e("../../../u");const a=e("../../../lib");const l=e("../../../logger");const c=e("../../css");const u=e("../../../lang/lang");const d=e("../../contextmenu");const p=e("../../highlightbox");const _=e("../../../lang/appquery");const f=e("../../../lang/btypes");const h=e("../../../core/core_datasources/utilities/core_ds_composer_utilities");const m=e("../../../client/analytics");const g=e("../../../constants/segment_events");const{datasourcesForContext:v}=e("../ExpressionComposer/DatasourceContents");const{messagesForContext:b}=e("../ExpressionComposer/MessageContents");const y=e("../compatibility/sets");const{DropdownContents:w}=e("../utilities/dropdown_contents");const{COMPOSER_INPUT_TYPES:x}=e("../../../constants/composer");const j=n;function A(e,t,n){let r;return()=>{var i;(i=r)!=null?i:r=v(e,t,n).map((t=>{let n=t.value;let r=t.documentation_id;if(n.is_slidable){n={type:n.type,cb_fn:t=>t({node:e,stay_on_this_node:true,val:u.RAW.DataSource(n.type)})}}else if(n.type==="PrimitiveLiteral"){n=n.properties.value;r=undefined}if(r){return{...t,value:n,documentation_id:r}}else{return{...t,value:n}}}));return r}}class M extends r{constructor(e){var t;let{owner:n,json:r,default_value:s,expected_value:a,editor_value:l,optional:c,dont_show_default_value:u}=e;super({owner:n,json:r,default_value:s});this.make_spot_callback=this.make_spot_callback.bind(this);this.expected_value=a;this.editor_value=l;this.optional=c;this.dont_show_default_value=u;(t=this.json)!=null?t:this.json=this.owner.json;this.canvas=o.div("composer");if(this.expected_value===undefined){throw new o.UnexpectedError("must provide expected value")}d().add_handler(this.canvas,(e=>{var t,n;const r=[["Copy expression",()=>this.copy(),()=>{}],["Paste expression",()=>this.paste(),()=>{}],["Clear expression",()=>this.clear_expression(),()=>{}]];const i=(t=(n=this.node()).element_id)==null?void 0:t.call(n);if(i){r.push([d().SEPARATOR]);r.push(["Reveal the element",()=>p().reveal_element(i)])}else{const e=this.node().get_static_property("action_id");if(e){r.push([d().SEPARATOR]);r.push(["Reveal the action",()=>p().find(_.workflow_item(e))])}}d().open(e,"context-menu composer",r);d().set_focus_owner(this.canvas)}));this.expression_parens=_.has_feature_enabled("parens");const h=o.Watcher((()=>this.selected_node(true)));let v=false;o.autorun((()=>{let e;this.canvas.empty();if(h.get()){v=true;e=this.generate_spots_tree();this.draw_spots(e)}else{if(this.node().is_empty()){if(this.default_value!=null&&!this.dont_show_default_value){let e;if(this.expected_value&&f.get(this.expected_value).has_runmode_display()){e=f.get(this.expected_value).runmode_display(this.default_value)}else{e=this.default_value}this.static_canvas=o.span("dynamic",undefined,e)}else{this.static_canvas=o.div("spot empty no-editor property-editor-control",undefined,"Click")}i.claim(this.node().path(),this);this.static_canvas.on("vmousedown",(e=>{if(e.which!==3){this.select_node();i.call_on_owner(this.node().path(),"open")}return true}))}else{this.static_canvas=o.div();this.static_canvas.css("display","inline");e=this.generate_spots_tree();if(this.expected_value==="key_combination"){this.draw_static_spots(e,this.canvas)}else{this.draw_static_spots(e)}}this.canvas.append(this.static_canvas);if(v){var t,n,r;const e=this.flat_spots_list().filter((e=>!e.node.is_empty()));m.track(g.DYNAMIC_EXPRESSION_EDITED,{app_version:_.app_version(),app:_.appname(),composer_id:this.json.path(),owner:(t=(n=(r=this.owner.get_expression_owner()).type)==null?void 0:n.call(r))!=null?t:this.owner.get_expression_owner().constructor.name,number_of_components:e.length,components_list:e.map((e=>({display:e.node.display(),type:e.node.constructor.name}))),issue_exists:this.is_not_finished()});v=false}this.static_canvas.toggleClass("not-finished",this.is_not_finished());this.canvas.find(".parens").on("vmousedown",(e=>{if(e.which!==3){this.select_node()}}))}this.setup_hover_effect();o.autorun_top((()=>{var e;if(this.node().type()!=="TextExpression"){return}if(((e=this.node().entries())==null?void 0:e.length)===1){this.write(this.node().raw().entries[0])}else{this.write(null)}}))}),(()=>{h.destroy()}))}setup_hover_effect(){if(!this.expression_parens){return}this.canvas.addClass("hover_fade_out");this.canvas.find(".nested").on("mouseover mouseout",(function(e){$(this).toggleClass("hovering",e.type==="mouseover");return e.stopPropagation()}))}generate_spots_tree(){var e=this,t;const n=function(){const t=arguments.length<=0?undefined:arguments[0];let{node:r,expected_value:i,optional:s,set:o}=t;const a=t.current_layer;const l=a!=null?a:[];let c=l;if(r.is_empty()){c.push({node:r,optional:s,set:o,empty:true});return c}c.push({node:r,optional:s,set:o});let u=false;if(r.has_args()){const e=r.args();let t;if(_.has_feature_enabled("reorg_component_selection")){var d;const e=r._message.arg_btype();t=()=>w.empty({input_type:e.get_composer_input_type()});if(!((d=r._message.editor)!=null&&d.static)&&e){t=A(r,e,e.matches("sys.bool")?null:e)}}else{t=r.argument_set()}const i=n({node:e,expected_value:r.get_arg_btype().id(),optional:false,set:t,current_layer:[]});c.push(...i||[]);u=e.get_eval_value().id()!==r.get_arg_btype().id();c=[{inner_spots:c}]}if(r.has_next()){const t=r.next();let o;if(_.has_feature_enabled("reorg_component_selection")){let e;o=()=>{var t;(t=e)!=null?t:e=b(r.get_value(),r).map((e=>{var t;const n=e.value;let i=null;if(e.value.is_slidable){i={...n,cb_fn:e=>e({stay_on_this_node:true,node:r.next(),val:n})}}return{...e,value:(t=i)!=null?t:n}}));return e}}else{o=r.message_set(i)}if(t.is_empty()){if(e.expression_parens||!u){s=r.get_value().matches(i);c.push({node:t,optional:s,set:o,empty:true})}}else{c=n({node:t,expected_value:i,optional:s,set:o,current_layer:c});return c}}return c};let r;if(_.has_feature_enabled("reorg_component_selection")&&((t=this.editor_value)==null?void 0:t.id())!==x.KEY_COMBINATION){r=A(this.node(),this.expected_value,this.editor_value)}else{r=a().sets.get_set("DataSources")(this.node(),this.expected_value,this.editor_value)}const i=n({node:this.node(),expected_value:this.expected_value,optional:this.optional,set:r,current_layer:[]});for(let e=0;e<i.length;e++){const t=i[e];if(t.inner_spots){var s;if((s=i[e+1])!=null&&s.empty){t.obvious_parens_when_inactive=true}}}return[{inner_spots:i,outermost:true}]}flat_spots_list(e,t){var n,r;(n=e)!=null?n:e=this.generate_spots_tree();(r=t)!=null?r:t=[];for(const n of e){if(n.inner_spots){this.flat_spots_list(n.inner_spots,t)}else{t.push(n)}}return t}select(){this.open()}open(){const e=this.node().path();i.clear_owner(e);i.select(e);i.call_on_owner(e,"open")}draw_spots(e,t){var n;(n=t)!=null?n:t=this.canvas;for(const n of e){if(n.inner_spots!=null){this.draw_raw_spot(n,t)}else if(n.empty){this.draw_empty_spot(n.node,n.optional,n.set,t)}else{this.draw_spot(n.node.get_spot(),n.node,n.optional,n.set,t)}}}draw_static_spots(e,t,n){var r;(r=n)!=null?r:n=this.static_canvas;for(const r of e){if(r.inner_spots){this.draw_raw_static_spot(r,t,n)}else if(!r.optional||!r.empty){this.draw_static_spot(r.node,t,n)}}}draw_static_spot(e,t,n){var r;(r=n)!=null?r:n=this.static_canvas;const i=new(s.get_composer("StaticAtom"))(e);n.append(i.canvas);if(t){t.on("click",(()=>{i.canvas.trigger("vmousedown")}))}}draw_spot(e,t,n,r,i){var o;let a;(o=i)!=null?o:i=this.canvas;if(e==="DynamicAtom"||e==="Atom"){a=new(s.get_composer("DynamicAtom"))({callback:this.make_spot_callback(t),display:t.display(),val:typeof r==="function"?t:t.get_static(),optional:n,set:r,path:t.path()})}else{a=new(s.get_composer(e))({node:t,callback:this.make_spot_callback(t),optional:n})}i.append(a.canvas)}should_wrap_spot_in_parens(e){let{inner_spots:t,outermost:n}=e;if(!this.expression_parens){return false}if(n){return false}if(t.length===1){return false}if(t.length===2&&t[1].empty){return false}return true}maybe_wrap_in_parens(e,t,n){if(!this.should_wrap_spot_in_parens(t)){return}const r=o.div("parens spot parens-left property-editor-control optional no-editor");e.prepend(r);const i=o.div("parens spot parens-right property-editor-control optional no-editor");e.append(i);const s=t.obvious_parens_when_inactive&&n;r.toggleClass("parens-transparent",!!s);i.toggleClass("parens-transparent",!!s);r.toggleClass("dynamic",!!n);i.toggleClass("dynamic",!!n)}draw_raw_static_spot(e,t,n){var r;(r=n)!=null?r:n=this.canvas;const i=o.div("nested",n);this.draw_static_spots(e.inner_spots,t,i);const s=true;this.maybe_wrap_in_parens(i,e,s)}draw_raw_spot(e,t){var n;(n=t)!=null?n:t=this.canvas;const r=o.div("nested",t);this.draw_spots(e.inner_spots,r);this.maybe_wrap_in_parens(r,e)}draw_empty_spot(e,t,n,r){if(!this.expression_parens){this.canvas.find(c.SPOT+".empty.optional").hide();this.canvas.find(".dropdown-caption.new-composer.empty").parent().parent().parent().hide()}setTimeout((()=>{o.run_once(30,(()=>{if(typeof n==="function"){return y.convert_to_legacy(n()).get_options()}else{return n.get_options()}}),((r,i)=>{if(r){l.log(r);return}if(!t&&(typeof n==="function"||n.has_finite_options())&&(i==null?void 0:i.length)===1&&(typeof n==="function"?n().get_new_option_accelerator()==null:n.add_new().length===0)){this.make_spot_callback(e)({action:"change",value:i[0].value});o.wait_for_updates((()=>{this.open_next_mandatory()}))}}))}),1);const i=new(s.get_composer("DynamicAtom"))({callback:this.make_spot_callback(e),optional:t,set:n,path:e.path()});r.append(i.canvas)}is_not_finished(){const e=this.flat_spots_list();if(e.length===0){return false}for(const t of e){if(t.empty&&!t.optional){return true}}return false}delete_into(){const e=this.flat_spots_list();for(const t of e.reverse()){if(!t.empty){const e=t.node.path();i.select(e);i.call_on_owner(e,"open");break}}}open_next_mandatory(){let e;const t=this.flat_spots_list();for(const n of t){if(n.empty&&!n.optional){e=n.node.path();i.select(e);i.call_on_owner(e,"open");return}}const n=t[t.length-1];i.select(n.node.path())}write_node(e,t){const n=this.node();if(e.path()===n.path()){this.write(t);n.commit();return}const r=o.json_deep_copy(n.raw());const i=e.path().replace(n.path()+".","");const s=i.split(".");let a=r;for(const e of s.slice(0,s.length-1)){var l;a=(l=a)==null?void 0:l[e]}if(a!=null){a[s[s.length-1]]=t}this.write(r);n.commit()}make_spot_callback(e){return t=>{var n,r,s,a;let l;switch(t.action){case"change":if((n=t.value)!=null&&n.just_do_change){this.write_node(e,t.value.val)}else if((r=t.value)!=null&&r.stay_on_this_node){this.write_node(e,t.value.val);l=e.path();setTimeout((()=>{i.select(l);i.call_on_owner(l,"open")}),0)}else{if(t.value!=null){var c,d,p,f,m,g;let n;const r=((c=e.next)==null?void 0:c.call(e))!=null&&!e.next().is_empty();let i=(d=e.parent_expression())==null?void 0:(p=d.get_value)==null?void 0:(f=(m=p.call(d)).get_message)==null?void 0:f.call(m,t.value.name);if((g=i)!=null&&g.arg_btype()){var v,b;t.value.args=(v=e.args)==null?void 0:(b=v.call(e))==null?void 0:b.raw()}if(i!=null){if(r){n=i.ret_btype().get_message(e.next().name());if(!n.is_not_found()){var y,w;t.value.next=(y=e.next)==null?void 0:(w=y.call(e))==null?void 0:w.raw()}}}else if(e instanceof u.DataSource){i=h.simulate_insert(t.value,{node:e});if(r){var x,j,A;n=(x=i)==null?void 0:(j=x.get_value)==null?void 0:(A=j.call(x))==null?void 0:A.get_message(e.next().name());if(n!=null&&!n.is_not_found()&&n.ret_btype_id()!=="null"){var M,E;t.value.next=(M=e.next)==null?void 0:(E=M.call(e))==null?void 0:E.raw()}}}}this.write_node(e,t.value);this.open_next_mandatory()}break;case"go_to_next":this.open_next_mandatory();break;case"delete":const S=(s=e.next)==null?void 0:(a=s.call(e))==null?void 0:a.raw();if(S&&S.args==null&&e.parent_expression().get_value!=null){this.write_node(e,S);if(_.has_feature_enabled("reorg_component_selection")){l=e.path();setTimeout((()=>{i.select(l);i.call_on_owner(l,"open")}),0)}}else{let t,n;this.write_node(e,null);if(e.path()===this.node().path()){var k,O;t=true;n=(k=(O=this.owner).find_previous_entry)==null?void 0:k.call(O,this.node())}this.write_node(e,null);if(t){if(n){this.owner.delete_into_child(this.node())}}else{this.delete_into()}}break;default:throw new o.UnexpectedError("unrecognized: "+t.action)}}}copy(){const e=this.node().json.raw();o.add_source_appname_tracker(e,_.appname());o.local_storage_put("bubble_composer_expression_clipboard",e)}can_paste(){return o.local_storage_get("bubble_composer_expression_clipboard")!=null}clear_expression(){this.write_node(this.node(),null)}paste(){const e=o.local_storage_get("bubble_composer_expression_clipboard");this.write_node(this.node(),e)}}j.ExpressionComposer=M;class E extends r{constructor(e){let{owner:t,json:n,default_value:r,no_swatches:i,empty_possible:s,right_aligned_swatch:o,get_css_classes:a}=e;const l={no_swatches:i,empty_possible:s,right_aligned_swatch:o,get_css_classes:a};super({owner:t,json:n,default_value:r,initialize_args:l})}initialize(e){var t;(t=e)!=null?t:e={};this.no_swatches=e.no_swatches;this.empty_possible=e.empty_possible;this.right_aligned_swatch=e.right_aligned_swatch;this.canvas=o.div("dynamic-composer-color property-editor-control");this._color_ar=null;o.autorun((()=>{const t=this.node().raw();if(t==null||typeof t==="string"){if(this._was_static){return}if(this._color_ar!=null){this._color_ar.destroy()}this._color_ar=o.autotop((()=>{this.canvas.empty();this._was_static=true;const t=new(s.get_composer("Color"))({owner:this.owner,json:this.json,default_value:this.default_value,no_swatches:this.no_swatches,empty_possible:this.empty_possible,right_aligned_swatch:this.right_aligned_swatch,get_css_classes:e.get_css_classes});const n=t.get_canvas();this.canvas.append(n);const r=o.div("insert-dynamic",this.canvas);const a=o.div("insert-dynamic-button color",r,"Insert dynamic data");r.hide();t.ip.on("focus",(e=>{e.preventDefault();i._position_dynamic_button(this.canvas,r);r.show()}));a.on("vmousedown",(e=>{e.preventDefault();t._changing=true;t.destroy();const n=u.RAW.Empty();n.is_dynamic=true;this.write(n);this.node().commit();setTimeout((()=>{o.wait_for_updates((()=>{var e;(e=this.dynamic_composer)==null?void 0:e.open_next_mandatory()}))}),100)}));t.ip.on("blur",(()=>{r.hide()}))}))}else if(typeof t==="object"){this._was_static=false;this.canvas.empty();this.dynamic_composer=new M({owner:this.owner,json:this.json,expected_value:"text",optional:this.empty_possible});this.canvas.append(this.dynamic_composer.get_canvas())}}))}}j.DynamicColor=E},{"../../../client/analytics":20,"../../../constants/composer":54,"../../../constants/segment_events":85,"../../../core/core_datasources/utilities/core_ds_composer_utilities":231,"../../../lang/appquery":651,"../../../lang/btypes":653,"../../../lang/lang":714,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../contextmenu":558,"../../css":560,"../../highlightbox":578,"../ExpressionComposer/DatasourceContents":518,"../ExpressionComposer/MessageContents":521,"../compatibility/sets":533,"../utilities/dropdown_contents":556,"./ComposerBase":537,"./control":542,"./registry":546,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],544:[function(e,t,n){"use strict";const r=e("../../../u");r.edit_mode_only();const i=e("./dynamicData");const s=e("./control");const o=e("./atoms");const a=e("./utilities");const l=e("./palettes");const c=e("./staticData");const u=e("../../../lang/appquery");const d=e("./registry");const p=n;p.Composer=d.register_composer("ExpressionComposer",i.ExpressionComposer);p.DynamicColor=d.register_composer("DynamicColor",i.DynamicColor);p.delay_autorun=s.delay_autorun;p.select=s.select;p.selected=s.selected;p.clear_owner=s.clear_owner;p.call_on_owner=s.call_on_owner;p.get_owner=s.get_owner;p.file_storage_error_handler=s.file_storage_error_handler;p.IconPalette=d.register_composer("IconPalette",l.IconPalette);p.ComposerPalette=d.register_composer("ComposerPalette",l.ComposerPalette);p.StaticAtom=d.register_composer("StaticAtom",o.StaticAtom);p.DynamicAtom=d.register_composer("DynamicAtom",o.DynamicAtom);p.SlidableAtom=d.register_composer("SlidableAtom",o.SlidableAtom);p.LongTextComposer=d.register_composer("LongTextComposer",c.LongTextComposer);p.ShortTextComposer=d.register_composer("ShortTextComposer",c.ShortTextComposer);p.CodeComposer=d.register_composer("CodeComposer",c.CodeComposer);p.ListManager=d.register_composer("ListManager",c.ListManager);p.TextBox=d.register_composer("TextBox",c.TextBox);p.MultilineTextBox=d.register_composer("MultilineTextBox",c.MultilineTextBox);p.NumberBox=d.register_composer("NumberBox",c.NumberBox);p.DateBox=d.register_composer("DateBox",c.DateBox);p.GeographicBox=d.register_composer("GeographicBox",c.GeographicBox);p.Image=d.register_composer("Image",c.Image);p.JsonFile=d.register_composer("JsonFile",c.JsonFile);p.File=d.register_composer("File",c.File);p.Dropdown=d.register_composer("Dropdown",c.Dropdown);p.ArrowlessDropdown=d.register_composer("ArrowlessDropdown",c.ArrowlessDropdown);p.CSSDimensionBox=d.register_composer("CSSDimensionBox",c.CSSDimensionBox);p.Dropdown_Button=d.register_composer("Dropdown_Button",c.Dropdown_Button);p.Autocomplete=d.register_composer("Autocomplete",c.Autocomplete);p.Checkbox=d.register_composer("Checkbox",c.Checkbox);p.Color=d.register_composer("Color",c.Color);p.Slider=d.register_composer("Slider",c.Slider);p.IconInput=d.register_composer("IconInput",c.IconInput);p.TextInput=d.register_composer("TextInput",c.TextInput);p.NumberInput=d.register_composer("NumberInput",c.NumberInput);p.KeyCombinationInput=d.register_composer("KeyCombinationInput",c.KeyCombinationInput);p.Owner=d.register_composer("Owner",a.Owner);p.AppSettingsEditor=d.register_composer("AppSettingsEditor",a.AppSettingsEditor);p.get_settings_composer=function(e,t,n,i,s,o,a,l,c){const d=r.autorun_return((()=>{const n=e?u.get_public_setting_node(t):u.get_private_setting_node(t);return n.path()}));const _=new p.AppSettingsEditor({path:d,fn(n){if(n===""){n=null}u.set_setting(e,t,n)},cls:n!=null?n:"TextBox",default_value:o!=null?o:u.settings_default(e,t),set:i,optional:s,dropdown_width_override:a,on_change:l,validation_fn:c});const f=_.get_composer();f.canvas.addClass("bubble-ui");return f}},{"../../../lang/appquery":651,"../../../u":823,"./atoms":540,"./control":542,"./dynamicData":543,"./palettes":545,"./registry":546,"./staticData":547,"./utilities":548}],545:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./control");const i=e("../../../u");const s=e("../../../lib");const o=e("../../../u/shared/decaf");const a=e("../../documentationpalette");const l=e("../../css");const c=e("../../slidablepalette");const u=e("../../../webfonts");const d=e("../../../u/shared/b_array");const p=n;class _{constructor(e){let{target:t,set:n,optional:r,cb:s,current_val:o,real_time_search_box:a,path:l,numerical_step:c,right_align:u,sticky_section:d,empty_display:p}=e;this.target=t;this.set=n;this.optional=r;this.cb=s;this.current_val=o;this.real_time_search_box=a;this.path=l;this.numerical_step=c;this.right_align=u;this.sticky_section=d;this.empty_display=p;this.canvas=i.div("composer-palette");$(document.body).append(this.canvas);this.canvas.hide();this.MAX_HEIGHT=350;if(this.target.parents(".new-field").length){this.canvas.addClass("new-field-form")}}_is_element_picker(){if(this.target.parents(".element-picker").length){return true}}_is_responsive_mode(){if(this.target.parents(".responsive-mode-dropdown").length){return true}}_is_directly_on_page(){return r._is_directly_on_page(this.target,this.path,this.canvas)}show(e){var t,n,p;this.canvas.empty();this.canvas.hide();this.currently_hovered={};if(!this.numerical_step&&!r._is_debugger()){$(document).off("keydown.composer-palette");$(document).on("keydown.composer-palette",(e=>{if(this.canvas.is(":visible")){e.stopPropagation();if(e.keyCode===27){this.hide()}else if([$.ui.keyCode.DOWN,$.ui.keyCode.UP,$.ui.keyCode.ENTER].includes(e.keyCode)){var t,n;(t=this.currently_hovered)==null?void 0:(n=t.opt_div)==null?void 0:n.removeClass("hovered");if([$.ui.keyCode.DOWN,$.ui.keyCode.UP].includes(e.keyCode)){var s,o;if(((s=this.currently_hovered)==null?void 0:s.n)==null){var a;(a=this.currently_hovered)!=null?a:this.currently_hovered={};this.currently_hovered.n=-1}if(e.keyCode===$.ui.keyCode.UP){if(m[this.currently_hovered.n-1]==null){if(this.target.find("input").length){this.target.find("input").focus();this.currently_hovered={}}}else{this.currently_hovered=m[this.currently_hovered.n-1]}}else{if(m[this.currently_hovered.n+1]!=null){this.currently_hovered=m[this.currently_hovered.n+1]}else{this.currently_hovered=m[0]}}(o=this.currently_hovered.opt_div)==null?void 0:o.addClass("hovered");if(this.currently_hovered.opt_div){const e=i.isScrolledIntoView(this.currently_hovered.opt_div,".composer-palette");if(!e.status){const e=this.currently_hovered.opt_div.offset().top+this.canvas.scrollTop();this.canvas.scrollTop(Math.max(e-150,0))}}}else if(e.keyCode===$.ui.keyCode.ENTER){r._select_dropdown_option(this,this.currently_hovered.option)}}}}))}this._is_directly_on_page();if(this._is_element_picker()){this.canvas.addClass("element-picker")}else if(this._is_responsive_mode()){this.canvas.addClass("responsive-picker")}i.SetFocusOwner(this.canvas,this.target);if(this.optional){var _;const w=i.div("section empty-choice",this.canvas);const x=new(s().sets.Option)((_=this.empty_display)!=null?_:"",null);const{opt_div:j}=r._draw_dropdown_option(this,r.option_divs_cache,x);w.append(j)}const f=(t=(n=(p=this.set).get_section_order)==null?void 0:n.call(p,e))!=null?t:o.object_keys(e);const h=[];let m=[];let g=0;let v;for(let A=0,M=A;A<f.length;A++,M=A){const E=f[M];const k=e[E];let O="section ";if(this.sticky_section!=null&&E===this.sticky_section){O+="stick-me "}O+=E;v=i.div(O,this.canvas);h[M]={section_div:v,options_list:[]};const S=[];for(let D=0;D<k.length;D++){const C=k[D];const T=r._draw_dropdown_option(this,r.option_divs_cache,C,g);S.push(T.opt_div);h[M].options_list.push(T);if(!T.option.disabled){m[g]=T;g++}}for(const N of S){v[0].appendChild(N[0])}if(!k.length){v.hide()}}const b=this.set.add_new();if(b!=null&&b.length){for(let P=0;P<b.length;P++){const I=b[P];const R=i.div("dropdown-option",this.canvas);R.text(I.display);const L=()=>{var e;if(I.hide_dropdown){this.hide()}I.fn(R,(e=this.real_time_search_box)==null?void 0:e.call(this),((e,t)=>{if(!e){this.cb(t)}}));return null};r._add_dropdown_option_handlers(this,R,I,P);R.on("vclick",(()=>L()));m[g]={n:g,option:{value:{cb_fn:()=>L()}},opt_div:R};if(I.thumbnail_id){a.DocumentationPalette().add(R,I.thumbnail_id)}}}setTimeout((()=>{const e=()=>{this.position_me();if(!this.canvas.is(":visible")){var e;this.canvas.show();this.position_me();(e=y)==null?void 0:e()}};if(this.target.parents(l.SLIDABLE_PALETTE).length!==0){i.WaitFor(c.SlidablePalette().opening_key,e)}else{e()}}),10);if(this.real_time_search_box){this.canvas.addClass("support-realtime-search");i.autorun((()=>{let e;const t=this.real_time_search_box();if(b!=null&&b.length){e=m[m.length-1]}m=[];g=0;for(const{section_div:e,options_list:i}of h){e.hide();for(const{option:s,opt_div:o}of i){if(!t||String(s.display).toLowerCase().indexOf(t.toLowerCase().trim())!==-1){o.show();e.show();m[g]={option:s,opt_div:o,n:g};g++}else{var n,r;o.hide();if(((n=this.currently_hovered)==null?void 0:n.option)!=null&&((r=this.currently_hovered)==null?void 0:r.option.value)===s.value){this.currently_hovered={}}}}}if(e){m[g]=e}}))}let y;if(this.set.preview_fonts){y=()=>{this.canvas.scrollTop(0);i.revealInScreen(this.canvas.find(".dropdown-option.currently-selected-option"),".composer-palette");setTimeout((()=>{q()}),200)};const z=()=>{const e=this.canvas.height();if(!this.font_data||e!==this.font_data.palette_height){this.font_data={};const t=this.canvas.find(".dropdown-option")[0];this.font_data.palette_height=e;this.font_data.option_height=$(t).height()+parseInt($(t).css("padding-top"))+parseInt($(t).css("padding-bottom"));this.font_data.number_of_fonts=Math.floor(this.font_data.palette_height/this.font_data.option_height)+1}};function B(e,t){const n=u.get_quoted_face_and_variant(t);const r={"font-family":n.font_family+", Source Sans 3"};if(n.variant){r["font-weight"]=n.variant}e.css(r)}const q=()=>{let e;z();const t=this.canvas.scrollTop();const n=this.canvas.find(".dropdown-option");const r=Math.max(Math.floor(t/this.font_data.option_height),0);const i=d.range(r,r+this.font_data.number_of_fonts+1);const s=[];for(const t of i){e=$(n[t]).data("font_value");if(u.already_loaded.includes(e)){B($(n[t]),e)}else{s.push(e)}}setTimeout((()=>{const r=this.canvas.scrollTop();if(r===t){u.load_for_preview(s,(()=>{for(const t of i){e=$(n[t]).data("font_value");B($(n[t]),e)}}))}}),500)};this.canvas.addClass("font-dropdown");this.canvas.on("scroll",q)}}hide(){if(this.canvas.is(":visible")){this.canvas.hide()}}position_me(){let e=this.target.offset().top+this.target.outerHeight()-1;if(!this._is_directly_on_page()&&!this._is_element_picker()&&!this._is_responsive_mode()||r._is_debugger()){e-=$(document).scrollTop()}let t=i.make_zindex(this.target);t=Math.max(t,50000002);const n=Math.max(Math.min(this.MAX_HEIGHT,$(window).height()-(this.target.offset().top+this.target.outerHeight()-1-$(document).scrollTop())-30),100);let s=this.target.offset().left-$(document).scrollLeft();if(this.right_align){s+=this.target.outerWidth()-this.canvas.outerWidth()}this.canvas.css({position:"fixed",top:Math.min(e,$(window).height()-n-5),left:Math.min(s,$(window).width()-this.canvas.width()),"z-index":t+1,height:"auto","max-height":n,"overflow-y":"scroll"})}destroy(){this.canvas.remove()}}p.ComposerPalette=_;class f extends _{constructor(e){let{target:t,icon_list:n,optional:r,cb:i,node:s,default_value:o,real_time_search_box:a}=e;super({target:t,optional:r,cb:i,real_time_search_box:a});this.icon_list=n;this.node=s;this.default_value=o}show(){var e;this.canvas.empty();this.MAX_HEIGHT=280;this.canvas.addClass("icon_palette");const t=(e=this.node.raw())!=null?e:this.default_value;const n=[];for(const e of this.icon_list.set){var r,s;const o=i.div("dropdown-option "+e,this.canvas);(r=(s=this.icon_list).fn)==null?void 0:r.call(s,o,e);if(e===t){o.addClass("currently-selected-option")}o.on("vclick",(()=>{this.cb(e);return null}));n.push({class_name:e,option_div:o})}this._is_directly_on_page();setTimeout((()=>{this.position_me();if(!this.canvas.is(":visible")&&this.target.is(":visible")){this.canvas.show();this.canvas.scrollTop(0);i.revealInScreen(this.canvas.find(".dropdown-option.currently-selected-option"),".composer-palette")}}),10);if(this.real_time_search_box){this.canvas.addClass("support-realtime-search");i.autorun((()=>{const e=this.real_time_search_box();for(const{class_name:t,option_div:r}of n){if(!e||t.toLowerCase().indexOf(e.toLowerCase().trim())!==-1){r.show()}else{r.hide()}}}))}}}p.IconPalette=f},{"../../../lib":741,"../../../u":823,"../../../u/shared/b_array":835,"../../../u/shared/decaf":844,"../../../webfonts":858,"../../css":560,"../../documentationpalette":565,"../../slidablepalette":587,"./control":542,"core-js/modules/web.dom-collections.iterator.js":1123}],546:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.registry=n.register_composer=n.get_composer=void 0;const r={};n.registry=r;const i=(e,t)=>{r[e]=t;return t};n.register_composer=i;const s=e=>r[e];n.get_composer=s},{}],547:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");e("core-js/modules/es.array.at.js");e("core-js/modules/es.string.at-alternative.js");const r=e("./control");const i=e("./registry");const s=e("./ComposerBase");const o=e("./TextComposer");const a=e("../../../u");const l=e("../../../db/values/db_values");const c=e("../../../db/hydrate");const u=e("../../../geolocation/b_location");const d=e("../../../geolocation/shared/b_location_utils");const p=e("../../../core/core_elements/shared/image_utils");const _=e("../../../core/input_mask");const f=e("../../../lib");const h=e("../../../lang/appquery");const m=e("../../../core/widgets");const g=e("../../../constants/editor");const v=e("../../css");const b=e("../../../logger");const y=e("../../../client/analytics");const w=e("../../../constants/colors");const{DEFAULT_USER_TOKENS:x}=e("../../../constants/tokens");const{sorted_user_tokens:j}=e("../../../lang/tokens");const A=e("../../../constants/segment_events");const M=e("lodash/debounce");const{COMPOSER_INPUT_TYPES:E}=e("../../../constants/composer");const{variable_to_token_variant:k,token_variant_to_properties:O}=e("../../../lang/color_tokens");const S=e("lodash/escape");const D=e("../../../u/shared/b_object");const C=e("../../../u/shared/uuid");const T=n;class N extends o{constructor(e){let{owner:t,json:n,default_value:r,validation_fn:i,no_enter:s,focus_cb:o}=e;super({owner:t,json:n,default_value:r,validation_fn:i});this.no_enter=s;this.focus_cb=o}get css(){return["text-composer property-editor-control","long-text-composer"]}editor_html(){return new B(this.no_enter,this.focus_cb)}add_entry_div_callback(e,t){const n=a.div(h.has_feature_enabled("reorg_component_selection")?"clickable-area-reorg":"clickable-area");const r=a.MakeKey(null,"appended key");a.wait_for_attached(e,(()=>{let i,s;const o=e.parent().css("display");try{var l;if(o!=="inline-block"){e.parent().css("display","inline-block")}const t=e.parent().prev(".textcomposer-entry");const n=e.parent().next(".textcomposer-entry");s=t!=null&&t.length?t.offset().top:this.canvas.offset().top;i=(n!=null&&n.length?n.offset().top:this.canvas.offset().top+this.canvas.height())-s-((l=t==null?void 0:t.height())!=null?l:0)}finally{if(o!=="inline-block"){e.parent().css("display",o)}}if(i){n.css("height",i);n.css("top",s-this.canvas.offset().top);if(h.has_feature_enabled("reorg_component_selection")){let e=this.rows.find(".clickable-area-container");if(e.length===0){this.rows.prepend(a.div("clickable-area-container"));e=this.rows.find(".clickable-area-container")}e.append(n)}else{this.rows.append(n)}r.turn();n.on("vmousedown",t)}}));return()=>a.WaitFor(r,(()=>n.remove()))}}T.LongTextComposer=N;class P extends o{get css(){if(h.has_feature_enabled("reorg_component_selection")){return["text-composer","property-editor-control","short-text-composer","reorg-temp"]}else{return["text-composer property-editor-control","short-text-composer"]}}editor_html(){return new z}}T.ShortTextComposer=P;const I=/[{}[\]()]/g;class R extends s{constructor(e){let{owner:t,json:n,default_value:r,mode:i,advanced_editing:s,custom_hints:o,simple_custom_hints:a,validation_fn_on_blur:l,autocomplete:c,on_blur_only:u}=e;const d={mode:i,autocomplete:c};super({owner:t,json:n,default_value:r,initialize_args:d});this.advanced_editing=s;this.custom_hints=o;this.simple_custom_hints=a;this.validation_fn_on_blur=l;this.on_blur_only=u}get html(){return'<div class="CodeComposer property-editor-control"></div>'}initialize(e){var t,n,i;(t=e)!=null?t:e={};this.mode=(n=e.mode)!=null?n:"htmlmixed";this.autocomplete=(i=e.autocomplete)!=null?i:"anyword";this.canvas=$(this.html);const s={mode:this.mode,lineWrapping:true,lineNumbers:true,styleActiveLine:true,indentUnit:4};if(this.advanced_editing){a.extend(s,{extraKeys:{"Ctrl-Space":"autocomplete"},autoCloseBrackets:true,foldGutter:true,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]})}const o=()=>{this.code_mirror=CodeMirror((e=>{this.canvas.append($(e))}),s);this.code_mirror.force_commit=()=>this.commit();if(this.advanced_editing){const e=a.div("fullscreen-btn light-button",this.canvas,"enter full screen mode (Esc to come back)");e.on("vclick",(()=>{this.code_mirror.setOption("fullScreen",true);this.canvas.addClass("fullscreen");const e=()=>{this.code_mirror.setOption("fullScreen",false);this.canvas.removeClass("fullscreen");return t.remove()};const t=a.div("esc-mention",$("body"),"Esc to get back to the editor...");t.on("vclick",(()=>{e()}));$(document).off("keydown.esc-codecomposer");return $(document).on("keydown.esc-codecomposer",(t=>{if(t.keyCode===27&&this.code_mirror.getOption("fullScreen")){t.stopPropagation();e()}}))}));const t=a.div("theme light-button",this.canvas,"use dark theme");t.on("vclick",(()=>{if(this.code_mirror.getOption("theme")==="night"){this.code_mirror.setOption("theme","default");t.text("use dark theme")}else{this.code_mirror.setOption("theme","night");t.text("use light theme")}}))}a.autorun((()=>{var e,t;const n=(e=(t=this.node().get_literal())!=null?t:this.default_value)!=null?e:"";if(n!==this.code_mirror.getValue()&&!this.is_focused){this.code_mirror.setValue(n)}}));this.code_mirror.on("change",(()=>{if(this.is_focused&&!this.on_blur_only){this.update();n()}}));let e=false;this.code_mirror.off("focus");this.code_mirror.on("focus",(()=>{var t,n;r.delay_autorun(true);this.code_mirror.setOption("hintOptions",{completeSingle:false,list:a.unique((t=(n=this.simple_custom_hints)==null?void 0:n.call(this))!=null?t:[]),hint:(e,t)=>{var n;const r=(n=this.custom_hints)==null?void 0:n.call(this);if(r){let t,n;const i=e.getCursor();const s=e.getLine(i.line);const o=s.split(" ")[s.split(" ").length-1].trim();if(o.indexOf(".")!==-1){const e=o.split(".");const r=e[e.length-2].split(I);n=r[r.length-1];const i=e[e.length-1].split(I);for(const e of i){if(![null,"",undefined].includes(e)){t=e}}}else{n=o}if(r[n]){if(["",null,undefined].includes(t)){return{from:i,to:i,list:r[n]}}else{const e=r[n].filter((e=>e.indexOf(t)===0));if(e.length){return{from:{line:i.line,ch:i.ch-t.length},to:i,list:e}}}}}return CodeMirror.hint[this.autocomplete](e,t)}});this.is_focused=true;this.canvas.addClass("focused");this.select_node();if(!e){e=true;return this.code_mirror.on("blur",(()=>{this.deselect_node();this.commit();this.is_focused=false;this.canvas.removeClass("focused");return r.delay_autorun(false)}))}}));if(this.validation_fn_on_blur){this.code_mirror.on("blur",(()=>{this.validation_fn_on_blur(this.code_mirror.getValue())}))}if(!this.on_blur_only){this.canvas.on("input",(()=>{this.update();n()}))}if(this.advanced_editing){this.code_mirror.on("inputRead",(()=>{if(!this.code_mirror.state.completionActive){var e;const t=(e=this.code_mirror.getTokenAt(this.code_mirror.getCursor()).string)==null?void 0:e.trim().replace(/[,/#!$%^&*;:{}=\-_`~()]/g,"");if(!["",null,undefined].includes(t)){CodeMirror.showHint(this.code_mirror)}}}))}let t=null;const n=()=>{if(t!=null){clearTimeout(t)}t=setTimeout((()=>this.commit()),600)}};const l=()=>{if(this.canvas.is(":visible")){o()}else{setTimeout(l,100)}};l()}update(){const e=this.code_mirror.getValue();if(e===this.node().get_literal()){return}this.write(e);this._to_commit=true}force_blur(){this.code_mirror.trigger("blur")}commit(){this.update();if(this._to_commit){this.node().commit();this._to_commit=false}}}T.CodeComposer=R;class L{on(e,t){return this.textarea.on(e,t)}off(e,t){return this.textarea.off(e,t)}select(){return this.textarea.focus().select()}selectionEnd(){return this.textarea[0].selectionEnd}selectionStart(){return this.textarea[0].selectionStart}data(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return this.textarea.data(...t||[])}mousedown(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return this.textarea.on("vmousedown",...t)}parent(){return this.textarea.parent()}is(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return this.textarea.is(...t||[])}closest(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return this.textarea.closest(...t||[])}}class z extends L{constructor(){super();this.autostretch=a.div("autostretch");this.textarea=a.input();this.textarea.css("width","20px");this.span=$('<span class="autotarg" style="display:none"></span>');this.autostretch.append(this.textarea);this.autostretch.append(this.span);const e=()=>{const e=this.span.width();return this.textarea.css("width",e+this.PADDING_FACTOR)};this.auto_stretch=t=>{var n;(n=t)!=null?n:t="";this.span=this.textarea.siblings("span").first();this.span.text(this.textarea.val()+t);return a.wait_for_attached(this.autostretch,e)};this.textarea.on("keypress",(e=>{if(e.which!==0&&e.charCode!==0){const t=String.fromCharCode(e.keyCode||e.charCode);return this.auto_stretch(t)}}));this.textarea.on("keydown",(e=>{if(e.which===8||e.which===46){return this.auto_stretch("")}}));this.textarea.on("keyup",(()=>this.auto_stretch()));this.textarea.on("keydown",(()=>this.auto_stretch(this.val()===""?" ":"")))}get PADDING_FACTOR(){return 0}val(e){if(e!==undefined){this.textarea.val(e);return this.auto_stretch(e===""?" ":"")}else{return this.textarea.val()}}get_canvas(){return this.autostretch}get_editable(){return this.textarea}}class B extends L{constructor(e,t){super();this.autostretch=a.div("autostretch");this.textarea=$('<textarea class="autostretch"></textarea>');r.fix_grammarly(this.textarea);this.autostretch.append(this.textarea);this.autotarg=a.div("autotarg",this.autostretch);this.auto_stretch=e=>{var t;(t=e)!=null?t:e="";this.autotarg.html(a.escape(e).replace(/\n/g,"<br/>")+"<br/>")};this.textarea.on("input",(()=>{this.auto_stretch(this.textarea.val())}));this.textarea.on("focus",(()=>{t==null?void 0:t()}));if(e){this.textarea.on("keydown.long_text_ignore_neter",(e=>{if(e.which===$.ui.keyCode.ENTER){e.preventDefault();e.stopPropagation()}}))}}get PADDING_FACTOR(){return 0}get_canvas(){return this.autostretch}get_editable(){return this.textarea}val(e){if(e!==undefined){this.textarea.val(e);return this.auto_stretch(e)}else{return this.textarea.val()}}}class q extends s{constructor(e){let{owner:t,json:n,set:r,default_value:i,on_change:s,inner_composer:o}=e;const a={set:r,on_change:s,inner_composer:o};super({owner:t,json:n,default_value:i,initialize_args:a})}scroll_to_bottom(){setTimeout((()=>{this.list_wrapper.scrollTop(this.list_wrapper.height())}),20)}initialize(e){var t;(t=e)!=null?t:e={};this.set=e.set;this.on_change=e.on_change;this.inner_composer=e.inner_composer;if(this.inner_composer.composer_type!=="no-composer"){const e=new(i.get_composer(this.inner_composer.composer_type))({owner:i.get_composer("Owner")(null),set:this.inner_composer.set,placeholder:this.inner_composer.placeholder,list_element:true,with_time:true});e.get_canvas().addClass("bubble-ui");const t=a.Box(5);this.canvas=a.div("composer-list-manager",this.canvas);this.list_wrapper=a.div("list-wrapper",this.canvas);const n=a.div("bubble-ui show-primary-btn see-more-btn",this.canvas,"See more items");n.on("vclick",(()=>{t(t()+5);this.scroll_to_bottom()}));a.autorun((()=>{this.list_wrapper.empty();const e=this.owner.get();const r=Array.isArray(e);let s=false;if(r){for(let n=0;n<e.length;n++){const r=e[n];if(n<t()){if(r!=null){s=true;const t=a.div("item-h1",this.list_wrapper);if(this.inner_composer.composer_type==="DateBox"){a.div("item-element",t,a.format_date(r,"m/d/yyyy h:MM:ss tt"))}else if(this.inner_composer.composer_type==="Image"){const e=new T.Image({owner:i.get_composer("Owner")(r),clear_disabled:true});t.removeClass("item-h1");t.addClass("image-wrapper");t.append(e.get_canvas().addClass("bubble-ui image-input"))}else if(this.inner_composer.composer_type==="File"){const e=new T.File({owner:i.get_composer("Owner")(r),clear_disabled:true});t.removeClass("item-h1");t.addClass("file-wrapper");t.append(e.get_canvas().addClass("bubble-ui file-input"))}else if(this.inner_composer.composer_type==="GeographicBox"){a.div("item-element",t,u.get_address(r))}else if(this.inner_composer.ret_value==="dateinterval"){a.div("item-element",t,a.print_date_interval(r))}else if(this.inner_composer.primary_field==="email"){a.div("item-element",t,r.get_email())}else if(typeof r==="object"){let e;const n=r.child(this.inner_composer.primary_field).get();if(l.registry.is(n,l.LIST_WRAPPER)){var o;e=(o=n.get_children(0,3))==null?void 0:o.join(", ")}else{e=n}a.div("item-element",t,e)}else if(this.inner_composer.composer_type==="Dropdown"){a.div("item-element",t,this.inner_composer.set.get_display(r))}else{a.div("item-element",t,r)}const c=a.div("bubble-ui delete-btn",t);c.on("vclick",(()=>{const t=[].concat(e);t.splice(n,1);this.write(t);this.node().commit()}))}}}}if(s){this.canvas.removeClass("no-item");this.list_wrapper.show()}else{this.canvas.addClass("no-item");this.list_wrapper.hide()}if(!(e!=null&&e.length)||e.length<=t()){n.hide()}else{n.show()}}));const r=a.div("input-wrapper",this.canvas);r.append(e.get_canvas());const s=a.div("bubble-ui light btn small-height ",r,"Add");if(this.inner_composer.composer_type==="Image"||this.inner_composer.composer_type==="File"){s.addClass("upload-file-space")}s.on("vclick",(()=>{const n=[].concat(this.owner.get());if(e.owner.get()!=null){const r=c.rehydrate_tree(f().db_instance(h.appname(),h.app_version()),e.owner.get());if(r){n.push(r)}else{n.push(e.owner.get())}e.owner.set(null);this.write(n);this.node().commit();t(n.length);this.scroll_to_bottom()}}))}}}T.ListManager=q;class U extends s{constructor(e){let{owner:t,json:n,default_value:r,validation_fn:i,on_change:s,on_blur_only:o,no_resize:a,optional:l,rows:c,on_blur_transform:u,display_formatter:d,custom_transform:p,placeholder:_,get_css_classes:f}=e;let h=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const m={owner:t,on_change:s,on_blur_only:o,no_resize:a,optional:l,rows:c,on_blur_transform:u,display_formatter:d,custom_transform:p,placeholder:_,subclass_args:h,get_css_classes:f};super({owner:t,json:n,default_value:r,validation_fn:i,initialize_args:m})}get html(){return'<input class="TextBox property-editor-control"></input>'}initialize(e){var t,n,i;(t=e)!=null?t:e={};this.owner=e.owner;this.on_change=e.on_change;this.on_blur_only=e.on_blur_only;this.no_resize=e.no_resize;this.optional=e.optional;this.rows=e.rows;this.on_blur_transform=e.on_blur_transform;this.display_formatter=e.display_formatter;this.custom_transform=e.custom_transform;this.placeholder=e.placeholder;(n=this.optional)!=null?n:this.optional=(i=this.owner.property)==null?void 0:i.optional;this.canvas=$(this.html);this.init(e.subclass_args);if(this.custom_transform!=null){this.original_transform=this.transform;this.transform=e=>this.custom_transform(this.original_transform(e))}this.canvas.toggleClass("mandatory",!this.optional);if(typeof this.placeholder==="function"){a.autorun((()=>{this.canvas.attr("placeholder",this.placeholder(this.owner.node))}))}else if(this.placeholder!=null){this.canvas.attr("placeholder",this.placeholder)}if(this.integer_percentage){var s;(s=this.display_formatter)!=null?s:this.display_formatter=function(e){if(!(e>0&&e<1)){return e}return`${100*e}%`}}else{var o;(o=this.display_formatter)!=null?o:this.display_formatter=e=>e}this.pristine=true;a.autorun((()=>{var t,n;const r=(t=(n=this.node().get_literal())!=null?n:this.default_value)!=null?t:"";const i=this.get_canvas().val();for(const[t,n]of Object.entries((s=(o=(a=e).get_css_classes)==null?void 0:o.call(a))!=null?s:{})){var s,o,a;n?this.canvas.addClass(t):this.canvas.removeClass(t)}if(this.transform(r)!==this.transform(i)){this.canvas.empty();if(this.pristine&&this.custom_transform){this.canvas.val(this.display_formatter(this.original_transform(r)))}else{this.canvas.val(this.display_formatter(this.transform(r)))}}this.canvas.toggleClass("empty",r===undefined||r==="")}));this.canvas.on("focus",(()=>{this.select_node();a.one_blur(this.canvas,(()=>{this.deselect_node();this.commit();this.canvas.blur()}))}));if(!this.on_blur_only){this.canvas.on("input",(e=>{this.update(false);c();this.emit("input",e)}))}let l=null;const c=()=>{if(l!=null){clearTimeout(l)}l=setTimeout((()=>this.commit()),600)};this.canvas.on("focus",(()=>{var e;(e=this.resize)==null?void 0:e.call(this);this.canvas.one("blur",(()=>{var e;if(this.on_blur_transform){const e=this.on_blur_transform(this.canvas.val());this.canvas.val(this.display_formatter(e));this.write(e)}(e=this.remove_resize)==null?void 0:e.call(this)}))}));this.canvas.on("focus",(()=>{this.canvas.one("keydown",(()=>{r.delay_autorun(true);this.canvas.one("blur remove",(()=>{r.delay_autorun(false)}))}))}));this.canvas.on("keydown",(e=>{this.emit("keydown",e)}))}update(e){var t,n;(t=e)!=null?t:e=true;if(this._disabled){return}this.pristine=false;const r=this.transform(this.canvas.val());if(this.validation_fn!=null&&!this.validation_fn(r)){this.canvas.val(this.node().get_literal());return}if(this.node().is_empty()&&r===((n=this.default_value)!=null?n:"")){return}if(r===this.node().get_literal()){return}if(e){var i;this.write(r);(i=this.on_change)==null?void 0:i.call(this,r)}this._to_commit=true}commit(){this.update();if(this._to_commit){this.node().commit();this._to_commit=false}}init(){}transform(e){return e}select(){this.select_node();a.wait_for_visible(this.canvas,(()=>{this.canvas.focus().select()}))}enable(){this.get_canvas().attr("readonly",false);this.get_canvas().removeClass("disabled");this._disabled=false}disable(){this.get_canvas().attr("readonly",true);this.get_canvas().addClass("disabled");this._disabled=true}force_blur(){this.canvas.trigger("blur")}}T.TextBox=U;class F extends U{get html(){return'<textarea class="MultilineTextBox property-editor-control"></textarea>'}initialize(e){super.initialize(e);r.fix_grammarly(this.canvas);if(this.rows){return this.canvas.attr("rows",this.rows)}}resize(){if(!this.no_resize){var e,t;return(e=(t=window.optional_modules).autosize)==null?void 0:e.call(t,this.get_canvas())}}remove_resize(){if(!this.no_resize){var e;return(e=window.optional_modules.autosize)==null?void 0:e.destroy(this.get_canvas())}}}T.MultilineTextBox=F;class W extends U{constructor(e){let{owner:t,json:n,default_value:r,validation_fn:i,on_change:s,on_blur_only:o,optional:a,placeholder:l,integer:c,integer_percentage:u,get_css_classes:d}=e;const p={integer:c,integer_percentage:u};super({owner:t,json:n,default_value:r,validation_fn:i,on_change:s,on_blur_only:o,optional:a,placeholder:l,get_css_classes:d},p)}get html(){return'<input class="NumberBox property-editor-control"></input>'}initialize(e){super.initialize(e);r.add_arrow_handlers_numeric_box(this.canvas,(e=>{this.canvas.val(e);this.update()}))}init(e){var t;(t=e)!=null?t:e={};this.integer=e.integer;this.integer_percentage=e.integer_percentage;a.make_numeric(this.canvas,this.integer)}transform(e){if(this.integer_percentage&&e.indexOf!=null&&e.indexOf("%")!==-1){e=parseInt(e)/100}else if(this.integer){e=parseInt(e)}else{e=parseFloat(e)}if(isNaN(e)){e=null}return e}}T.NumberBox=W;class G extends U{constructor(e){let{owner:t,json:n,default_value:r,validation_fn:i,with_time:s,on_change:o,seconds:a}=e;const l={with_time:s,seconds:a};super({owner:t,json:n,default_value:r,validation_fn:i,on_change:o},l)}get html(){return'<input class="DateBox property-editor-control"></input>'}_get_val(){var e,t;return(e=(t=this.node().raw())!=null?t:this.default_value)!=null?e:""}_get_formatted_val(e){if(this.with_time){if(this.seconds){return a.format_date(e,"mm/dd/yyyy HH:MM:ss")}else{return a.format_date(e,"mm/d/yyyy hh:MM tt")}}else{return a.format_date(e,"mm/d/yyyy")}}initialize(e){var t,n,r;(t=e)!=null?t:e={};this.owner=e.owner;this.on_change=e.on_change;(n=this.optional)!=null?n:this.optional=(r=this.owner.property)==null?void 0:r.optional;e=e.subclass_args;this.with_time=e.with_time;this.seconds=e.seconds;this.canvas=$(this.html);if(this.with_time){if(this.seconds){this.canvas.inputmask(_.masks.date_time.mask)}else{this.canvas.inputmask(_.masks.date_time_no_seconds.mask)}}else{this.canvas.inputmask(_.masks.date.mask)}this.canvas.toggleClass("mandatory",!this.optional);a.autorun((()=>{const e=this._get_val();if(this.transform(e)!==this.transform(this.canvas.val())){this.canvas.empty();this.canvas.val(this._get_formatted_val(e))}this.canvas.toggleClass("empty",e===undefined||e==="")}));this.canvas.on("focus",(()=>{this.select_node();a.one_blur(this.canvas,(()=>{if(this.canvas.val()!==this._get_formatted_val(this._get_val())){this.deselect_node();this.commit();this.canvas.blur()}}))}))}transform(e){if(!e&&e!==0){return null}if(e!=null){if(e instanceof Date){if(!this.with_time){e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0)}return e.valueOf()}else if(typeof e==="number"){return e}else{const t=new Date(e);return t.valueOf()}}}}T.DateBox=G;class V extends U{get html(){return'<input class="GeographicBox property-editor-control"></input>'}initialize(e){var t;(t=e)!=null?t:e={};this.on_change=e.on_change;this.canvas=$(this.html);this.canvas.toggleClass("mandatory",!this.optional);a.autorun((()=>{var e,t;let n=(e=(t=this.node().raw())!=null?t:this.default_value)!=null?e:"";this.canvas.empty();if(n===""){this.canvas.val("")}else{n=d.rehydrate_b_location(n);if(n.raw!=null){n=n.raw()}this.canvas.val(u.get_address(n))}this.canvas.toggleClass("empty",n===undefined||n==="")}));this.canvas.on("focus",(()=>{this.select_node();a.one_blur(this.canvas,(()=>{this.deselect_node();this.commit();this.canvas.blur()}))}));this.canvas.on("blur",(()=>{this.update()}))}transform(e,t){a.run_once(30,(()=>u.from_address(d.rehydrate_b_location(e),true)),((e,n)=>{if(e){b.log(e);window.alert("Oops, we are having a problem resolving the address... please try again later");return}if(t!=null){return t(n)}else{return n}}))}update(){this.transform(this.canvas.val(),(e=>{var t;if(e===this.node().get_literal()){return}this.write(e);(t=this.on_change)==null?void 0:t.call(this,e);this._to_commit=true}))}}T.GeographicBox=V;class H extends s{constructor(e){let{owner:t,json:n,default_value:i,on_change:s,clear_disabled:o}=e;super({owner:t,json:n,default_value:i});this.canvas=a.div("composer-image");this.input=a.input("property-editor-control",this.canvas,"file");this.text=a.div("placeholder-text",this.canvas);this.text.text("Upload");this.img=a.img(undefined,this.canvas);const l=a.div("button-clear-composer-image bubble-ui light-grey-btn",this.canvas,"clear");l.click((()=>{this.write("");this.node().commit();this.input.val("");s==null?void 0:s()}));const c=$('<a class="download-btn bubble-ui light-grey-btn" target="_blank">see</a>');this.canvas.append(c);a.autorun((()=>{var e;const t=(e=this.node().get_literal())!=null?e:this.default_value;if(t){this.img.attr("src",p.optimize_image(t,100,100));this.img.show();this.text.hide();this.text.removeClass("empty");const e=t.split("/");const n=e[-1+e.length];const r=decodeURIComponent(n);this.text.text(r);this.input.attr("title",r);c.attr("href",t);c.show();l.show()}else{this.text.show();this.img.hide();this.text.text("Upload");this.input.removeAttr("title");this.text.addClass("empty");c.hide();l.hide()}if(o){l.hide()}}));const u=e=>{this.write(e);this.node().commit();s==null?void 0:s(e)};m.MakeImageUploader({input:this.input,get_additional_data:null,cb_success:u,cb_fail:r.file_storage_error_handler,max_file_size_fn(){return g.MAX_FILE_COMPOSER_SIZE}});if(o){l.hide()}}}T.Image=H;T.JsonFile=function(){return new(e("./JsonFile"))(...arguments)};class X extends s{constructor(e){let{owner:t,json:n,default_value:i,on_change:s,file_type:o,clear_disabled:l}=e;super({owner:t,json:n,default_value:i});this.canvas=a.div("composer-file");this.input=a.input("property-editor-control",this.canvas,"file");this.text=a.div("placeholder-text",this.canvas);this.text.text("Upload");this.clear=()=>{this.write("");this.node().commit();this.input.val("");s==null?void 0:s()};const c=a.div("button-clear-composer-file bubble-ui light-grey-btn",this.canvas,"clear");c.click(this.clear);const u=$('<a class="download-btn bubble-ui light-grey-btn" target="_blank">see</a>');this.canvas.append(u);a.autorun((()=>{var e;const t=(e=this.node().get_literal())!=null?e:this.default_value;if(t){const e=t.split("/");const n=e[-1+e.length];const r=decodeURIComponent(n);this.text.text(r);this.input.attr("title",r);this.text.removeClass("empty");u.attr("href",t);u.show();c.show()}else{this.text.text("Upload");this.text.addClass("empty");this.input.removeAttr("title");u.hide();c.hide()}if(l){c.hide()}}));const d=e=>{if(o&&e.split(".")[e.split(".").length-1]!==o){window.MessagePanel({title:"Upload File",message:"The file you uploaded isn't of type "+o+". Please try with another file"});return}this.write(e);this.node().commit();s==null?void 0:s(e)};m.MakeImageUploader({input:this.input,text:"We're uploading your file...",get_additional_data:null,cb_success:d,cb_fail:r.file_storage_error_handler,max_file_size_fn(){return g.MAX_FILE_COMPOSER_SIZE}});if(l){c.hide()}}}T.File=X;class Y extends s{constructor(e){let{owner:t,json:n,default_value:s,set:o,optional:l,dropdown_width_override:c,placeholder:u,on_change:d,numerical_step:p,real_time_search_placeholder:_,right_align:f,sticky_section:h,get_css_classes:m,empty_display:g}=e;super({owner:t,json:n,default_value:s});this.set=o;this.optional=l;this.dropdown_width_override=c;this.on_change=d;this.canvas=a.div(this.css_class);a.autorun((()=>{var e;let t;this.canvas.empty();if(!r._is_debugger()){var n;t=(n=this.node().get_literal())!=null?n:this.default_value}else{t=this.node().raw()}const s=this.set.get_display(t);if(this.set.get_display_style){const e=this.set.get_display_style();this.canvas.css(e)}this.spot=new(i.get_composer("DynamicAtom"))({callback:e=>this.spot_callback(e),display:s,val:t,optional:this.optional,set:this.set,placeholder:u,path:this.node().path(),numerical_step:p,real_time_search_placeholder:_,from_dropdown:this.hide_click_placeholder,add_tooltip:true,right_align:f,sticky_section:h,empty_display:g});for(const[e,t]of Object.entries((o=m==null?void 0:m())!=null?o:{})){var o;if(t===true){this.spot.add_class(e)}}this.spot.add_class(this.css_class+"-"+((e=this.dropdown_width_override)!=null?e:this.set.dropdown_width()));if(!r._is_debugger()){setTimeout((()=>{if(!this.optional&&this.set.has_finite_options()){a.run_once(120,(()=>{var e,t,n;if(!((e=(t=this.set).add_new)!=null&&(n=e.call(t))!=null&&n.length)){return this.set.get_only_option()}}),((e,t)=>{if(e){b.log(e);return}if(t&&t.value!==this.spot.val){this.spot_callback({action:"change",value:t.value,merge:true})}}))}}),1)}this.canvas.append(this.spot.canvas);if(this._disabled){this.disable()}else{this.enable()}}))}get css_class(){return"composer-dropdown"}get hide_click_placeholder(){return true}spot_callback(e){var t;switch(e.action){case"change":this.write(e.value);if(!r._is_debugger()){if(e.merge){this.node().commit_merge()}else{this.node().commit()}}(t=this.on_change)==null?void 0:t.call(this,e.value);break;case"delete":this.write(null);this.node().commit();break;default:throw new a.UnexpectedError("unrecognized: "+e.action)}if(this.set.editor_type()===E.REAL_TIME_SEARCH){r.deselect(this.json.path(),this.spot)}}open(){this.spot.open()}disable(){super.disable();this.spot.disable()}enable(){super.enable();this.spot.enable()}select(){r.call_on_owner(this.node().path(),"open")}}T.Dropdown=Y;class K extends Y{constructor(e){super(e);this.params=e}get css_class(){return"arrowless-composer-dropdown"}get hide_click_placeholder(){return false}}T.ArrowlessDropdown=K;class J extends s{constructor(e){let{owner:t,json:n,default_value:s,optional:o,placeholder:l}=e;super({owner:t,json:n,default_value:s});this.canvas=a.div("composer-cssdimension");const c=f().sets.get_set("Object")({px:"px",percentage:"%"});this.focus=new a.HasFocus(this.canvas,null);this.focus.on("blur",(()=>{var e;(e=this.dropdown_open)==null?void 0:e.call(this,false)}));this.dropdown_open=a.Box(false);a.autorun((()=>{var e,t,n,u,d;let p;if(!r._is_debugger()){var _;p=(_=this.node().get_literal())!=null?_:this.default_value}else{p=this.node().raw()}(e=p)!=null?e:p=s;this.number_val=parseFloat(p);if(isNaN(this.number_val)){this.number_val=null}const f=(t=p)!=null&&(n=t.endsWith)!=null&&n.call(t,"%")?"percentage":"px";if(this.number_val===parseFloat((u=this.input)==null?void 0:u.canvas.val())&&f===this.old_unit_val){return}this.old_unit_val=f;(d=this.dropdown)==null?void 0:d.destroy();this.dropdown=null;this.canvas.empty();this.input=new oe({val:this.number_val,default_val:"",cb:e=>this.write_full(e,f),integer_only:false,optional:o});this.canvas.append(this.input.canvas);r.add_arrow_handlers_numeric_box(this.input.canvas,(e=>{this.input.canvas.val(e);this.write_full(e,f)}));if(l!=null){this.input.canvas.attr("placeholder",l)}this.dropdown_open(false);const h=a.div("dropdown-arrow",this.canvas);h.on("vclick",(()=>{this.dropdown_open(!this.dropdown_open());if(this.dropdown_open()){r.select(this.node().path())}}));h.toggleClass("unit-pixel",f==="px");this.ensure_dropdown=()=>{if(this.dropdown){return}this.dropdown=new(i.get_composer("ComposerPalette"))({target:h,set:c,optional:this.optional,cb:e=>{if(this.number_val!=null){this.write_full(this.number_val,e)}else if(e==="percentage"){this.write_full(100,e)}this.dropdown_open(false)},current_val:f,path:this.node().path()});this.dropdown.canvas.addClass("composer-cssdimension-short")}}));a.autorun((()=>{const e=this.dropdown_open()&&r.selected(this.node().path());if(e){var t;this.focus.focus=true;this.canvas.addClass("selected");this.ensure_dropdown();const e=(t=window)!=null&&t.composer_revamp?c.section_names():c.get_section_options();this.dropdown.show(e)}else{var n;this.canvas.removeClass("selected");(n=this.dropdown)==null?void 0:n.hide()}}))}write_full(e,t){var n;let i;if(e!=null&&t!=null){const n={px:"px",percentage:"%"};i=`${e}${n[t]}`}else{i=null}this.write(i);if(!r._is_debugger()){this.node().commit()}(n=this.on_change)==null?void 0:n.call(this,i)}}T.CSSDimensionBox=J;class Z extends s{constructor(e){let{owner:t,json:n,default_value:r,show_captions:i,add_title:s,set:o,get_css_classes:l}=e;super({owner:t,json:n,default_value:r});this.set=o;this.canvas=a.div("composer-dropdown-button");a.autorun((()=>{var e;const t=(e=this.node().get_literal())!=null?e:this.default_value;this.canvas.empty();for(const[e,t]of Object.entries((n=l==null?void 0:l())!=null?n:{})){var n;t?this.canvas.addClass(e):this.canvas.removeClass(e)}const r=this.set.get_section_options();for(const e in r){const n=r[e];const o=a.div(e,this.canvas);for(const e of n){const n=a.div("button",o);if(i){n.text(e.display)}if(s){n.attr("title",e.display)}n.attr("button_value",e.value);if(e.value===t){n.addClass("selected")}n.on("vclick",(()=>{this.write(e.value);this.node().commit();return null}))}}}))}}T.Dropdown_Button=Z;class Q extends s{constructor(e){let{owner:t,json:n,default_value:i,set:s,optional:o,dropdown_width_override:l,placeholder:c}=e;super({owner:t,json:n,default_value:i});this.set=s;this.optional=o;this.dropdown_width_override=l;this.object_value_matcher={};this.canvas=a.div(this.css_class);const u=a.input("autocomplete-input",this.canvas,undefined,c);u.typeahead({minLength:1,highlight:true},{source:(e,t)=>{a.run_once(30,(()=>this.set.autocomplete_fn(e)),((e,n)=>{if(e){b.log(e);return}for(const{text:e,value:t}of n){this.object_value_matcher[e]=t}t(n.map((e=>({value:e.text}))))}))},templates:{suggestion(e){return`<p>${S(e.value)}</p>`}}});let d=null;const p=e=>{if(!e){return null}return this.object_value_matcher[e]};const _=()=>{const e=u.typeahead("val");const t=p(e);if(t==null){u.typeahead("val","");this.update(null)}else{this.update(t)}};u.on("typeahead:closed",(()=>_()));u.on("blur.autocomplete",(()=>_()));u.on("typeahead:opened",(()=>{const e=this.canvas.offset().top+this.canvas.outerHeight()-1;let t=a.make_zindex(this.canvas);t=Math.max(t,50000002);const n=Math.min(300,$(window).height()-(e-$(document).scrollTop())-30);d.css({top:e,left:this.canvas.offset().left-$(document).scrollLeft(),"z-index":t+1,height:"auto","max-height":n})}));a.wait_for_visible(this.canvas,(()=>{d=this.canvas.find(".tt-dropdown-menu");d.detach();$("body").append(d);d.removeClass("tt-dropdown-menu");d.addClass("tt-autocomplete-dropdown-menu");r._is_directly_on_page(u,this.json.path(),d)}));a.autorun((()=>{var e,t;const n=(e=(t=this.node().get_literal())!=null?t:this.default_value)!=null?e:"";if(n!==p(this.canvas.val())){let e;if(n){e=this.set.from_val_to_text(n);this.object_value_matcher[e]=n}u.typeahead("val",e)}this.canvas.toggleClass("empty",n===undefined||n==="")}),(()=>{var e;(e=d)==null?void 0:e.remove()}))}get css_class(){return"composer-autocomplete"}update(e){var t;if(this.node().is_empty()&&e===((t=this.default_value)!=null?t:"")){return}if(e===this.node().get_literal()){return}this.write(e);this._to_commit=true}commit(){this.update();if(this._to_commit){this.node().commit();this._to_commit=false}}select(){this.select_node();a.wait_for_visible(this.canvas,(()=>{this.canvas.focus().select()}))}}T.Autocomplete=Q;class ee extends s{constructor(e){let{owner:t,json:n,default_value:r,on_change:i,get_css_classes:s}=e;const o={on_change:i,get_css_classes:s};super({owner:t,json:n,default_value:r,initialize_args:o})}initialize(e){var t;(t=e)!=null?t:e={};this.on_change=e.on_change;this.canvas=a.div("composer-checkbox");a.autorun((()=>{var t;this.canvas.empty();const n=a.div("component-checkbox property-editor-control");this.canvas.append(n);for(const[t,o]of Object.entries((r=(i=(s=e).get_css_classes)==null?void 0:i.call(s))!=null?r:{})){var r,i,s;o?n.addClass(t):n.removeClass(t)}if((t=this.node().get_literal())!=null?t:this.default_value){n.addClass("checked")}else{n.removeClass("checked")}n.on("vclick",(()=>{if(!this._disabled){var e;n.toggleClass("checked");const t=n.hasClass("checked");this.write(t);this.node().commit();(e=this.on_change)==null?void 0:e.call(this,t)}return null}))}))}}T.Checkbox=ee;class te extends s{constructor(e){let{owner:t,json:n,default_value:r,no_swatches:i,empty_possible:s,right_aligned_swatch:o,write_on_close:a,get_css_classes:l}=e;const c={no_swatches:i,empty_possible:s,right_aligned_swatch:o,write_on_close:a,get_css_classes:l};super({owner:t,json:n,default_value:r,initialize_args:c})}initialize(e){var t;(t=e)!=null?t:e={};this.no_swatches=e.no_swatches;this.empty_possible=e.empty_possible;this.right_aligned_swatch=e.right_aligned_swatch;this.color_picker=null;this.write_on_close=e.write_on_close;this.event_id=C.LUID();this.canvas=a.div("composer-color property-editor-control");this.swatch=a.div("color-swatch");this.ip=a.input("color-input",this.canvas);if(this.right_aligned_swatch){this.canvas.append(this.swatch)}else{this.canvas.prepend(this.swatch)}a.autorun((()=>{if(!this.ip.is(":focus")){this.ip[0].value=this.get_input_value()}this.swatch.css("background",this.get_current());for(const[i,s]of Object.entries((t=(n=(r=e).get_css_classes)==null?void 0:n.call(r))!=null?t:{})){var t,n,r;s?this.canvas.addClass(i):this.canvas.removeClass(i)}}));this.canvas.on("vmousedown",(e=>{if(!this.canvas.hasClass("selected")){i()}}));const n=M((e=>{y.track(A.COLOR_PICKER_VALUE_SET,{app:h.appname(),type:e})}),100);this.ip.on("keydown",(e=>{if(this.color_token_set()){this.ip[0].value="";this.ip.removeClass("token-chosen")}}));this.ip.on("input",(e=>{if(this.color_picker!=null){this.color_picker.setColor(e.target.value,true)}n("Manual entry");this.write(window.AColorPicker.parseColor(e.target.value,"rgbacss"))}));this.ip.on("blur",(()=>{if(!this.color_token_set()&&this.empty_possible&&[null,undefined,"","#"].includes(this.ip.val())){this.write(null);this.swatch.css("background","none")}this.ip[0].value=this.get_input_value()}));const i=()=>{const e=this;$(document).on("mousedown.hide_picker"+this.event_id,(t=>{const{canvas:n}=e;if(n.hasClass("selected")&&!n.is(t.target)&&!$.contains(n[0],t.target)){this.destroy()}}));r.delay_autorun(true);this.color_picker=window.AColorPicker.createPicker($(this.canvas),{showHSL:false,showRGB:false,showHEX:true,showAlpha:false,slBarSize:[198,148],hueBarSize:[182,12]}).on("change",((e,t)=>{if(!this.write_on_close){this.write(`rgba(${e.rgba.toString()})`);n("Manual entry")}}));this.panel=$(this.color_picker.element);this.hex_row=this.canvas.find(".a-color-picker-rgbhex");this.hex_row.children("label").remove();this.hex_input_div=a.div("hex-input",this.hex_row);const t=this.canvas.find(".a-color-picker-circle");this.hex_input=this.canvas.find("input[nameref='RGBHEX']");this.hex_input_div.append(t);this.hex_input_div.append(this.hex_input);a.autorun_top((()=>{s()}));if(!this.no_swatches){o()}if(this.color_token_set()){const{token_set:e,variant:t}=this.color_token_set();const{name:n}=O(e,t);this.hex_input[0].value=n}this.color_picker.setColor(this.get_color(),true);a.autorun((()=>{this.canvas.find(".a-color-picker-palette-color").removeClass("token-chosen");if(this.color_token_set()){const{token_set:e,variant:t}=this.color_token_set();const{name:n}=O(e,t);this.hex_input[0].value=n;this.hex_input.addClass("token-chosen");this.canvas.find(`.a-color-picker-palette-color.${e}.${t}`).addClass("token-chosen")}else{this.hex_input.removeClass("token-chosen")}}));this.canvas.addClass("selected");const{left:i,top:l}=this.canvas.offset();const c=l+this.canvas.height();const u={};u.position="fixed";u.zIndex=5;u.top=c;u.left="auto";const d=i+this.panel.width();const p=d>$(window).width();if(p){const e=d-$(window).width();u.left=i-(e+15);u.top=c;u.position="fixed"}const _=l+this.panel.height();const f=_>$(window).height();if(f){const e=_-$(window).height();u.top=l-(e+5);if(!p){u.left=i;u.position="fixed"}}this.panel.css(u)};const s=()=>{this.hex_row.children(".composer-input.number-input").remove();const e=e=>{let t;if(this.color_token_set()){const{token_set:n,variant:r}=this.color_token_set();if(this.alpha_ip.canvas[0].value){e=e/100;t=`rgba(var(--color_${n}_${r}_rgb), ${e})`;this.write(t)}else{this.write(`var(--color_${n}_${r})`)}}else{const{code:n}=a.rgb_to_hex(this.get_color());t=a.hex_to_rgb(n,e);this.write(t)}this.color_picker.setColor(this.get_color(),true);n("Manual entry")};this.alpha_ip=new oe({val:"0%",cb:e,integer_only:true,numerical_step:1});const t=()=>{if(!this.get_current()||this.alpha_ip.canvas.is(":focus")){return}const e=a.rgb_to_hex(this.get_color()).opacity;const t=`${Math.max(Math.min(Math.round(e*100),100),0)}%`;if(this.color_token_set()&&!this.get_current().includes(w.RGB_VAR_IDENTIFIER)){this.alpha_ip.canvas.val("");this.alpha_ip.canvas[0].placeholder=t}else{this.alpha_ip.canvas[0].placeholder="0%";this.alpha_ip.canvas.val(t)}};this.hex_row.append(this.alpha_ip.canvas);this.alpha_ip.canvas.addClass("alpha");this.alpha_ip.canvas.on("focus",(()=>{this.canvas.addClass("selected");this.alpha_ip.canvas.val(this.alpha_ip.canvas[0].value.replace("%",""));this.select_node();a.one_blur(this.alpha_ip.canvas,(()=>{this.deselect_node();this.alpha_ip.canvas.blur();t();focus.focus=false}))}));a.autorun(t)};const o=()=>{a.autorun((()=>{var e,t,n,r,i;const s=(e=h.get_public_setting("color_tokens"))!=null?e:w.DEFAULT_COLOR_TOKENS;const o=(t=h.get_public_setting("color_tokens_user"))!=null?t:D.json_deep_copy(x);(n=this.panel)==null?void 0:n.children(".palette-title").remove();(r=this.panel)==null?void 0:r.children(".a-color-picker-palette").remove();const l=a.div("a-color-picker-row palette-title",this.panel);a.div("palette-title-text",l,"Color variables");const c=a.div("palette-title-link",l,"edit ");c.on("mousedown.style_variables",(()=>{$(v.STYLES_TAB).click();f().styles_canvas.open_tab("Style Variables")}));const u=a.div("a-color-picker-palette a-color-picker-row");(i=this.panel)==null?void 0:i.append(u);w.SORTED_DEFAULT_TOKENS.forEach((e=>{w.COLOR_VARIANTS.forEach((t=>{const n=a.div("a-color-picker-palette-color",u);n.addClass(`${e} ${t}`);n[0].title=w.DEFAULT_TOKEN_NAMES_DESCRIPTIONS[e].name+" ("+a.rgb_to_hex(s[e][t]).code.toUpperCase()+")";n==null?void 0:n.css("background-color",s[e][t]);n.on("mousedown.token_chosen",(n=>{this.write(`var(--color_${e}_${t})`);this.color_picker.setColor(this.get_color(),true);this.hex_input[0].value=w.DEFAULT_TOKEN_NAMES_DESCRIPTIONS[e].name}))}))}));Object.keys(o).forEach((e=>{j(o[e]).forEach((t=>{const{rgba:n,name:r}=O(t,e);const i=a.div("a-color-picker-palette-color",u);i.addClass(`${t} ${e}`);i[0].title=r+" ("+a.rgb_to_hex(n).code.toUpperCase()+")";i==null?void 0:i.css("background-color",n);i.on("mousedown.token_chosen",(n=>{this.write(`var(--color_${t}_${e})`);this.color_picker.setColor(this.get_color(),true);this.hex_input[0].value=r}))}))}))}))}}get_current(){var e;return(e=this.node().get_literal())!=null?e:this.default_value}get_input_value(){if(!this.get_current()){return""}const e=a.rgb_to_hex(this.get_color()).code;if(this.color_token_set()){const{token_set:t,variant:n}=this.color_token_set();const{name:r}=O(t,n);this.ip.addClass("token-chosen");return`${r} (${e.toUpperCase()})`}else{this.ip.removeClass("token-chosen");return e.toUpperCase()}}destroy(){var e;r.delay_autorun(false);this.hex_input.blur();if(this.write_on_close){this.write(`rgba(${this.color_picker.rgba.toString()})`);y.track(A.COLOR_PICKER_VALUE_SET,{app:h.appname(),type:"Manual Entry"})}this.node().commit();$(document).off("mousedown.hide_picker"+this.event_id);(e=this.color_picker)==null?void 0:e.destroy();this.canvas.removeClass("selected")}color_token_set(){if(!this.get_current()){return null}return k(this.get_current())}get_color(){if(this.color_token_set()){const{token_set:e,variant:t}=this.color_token_set();const{rgba:n}=O(e,t);if(this.get_current().includes(w.RGB_VAR_IDENTIFIER)){const e=a.rgba_to_array(n).slice(0,-1);const t=a.rgba_to_array(this.get_current()).at(-1);return`rgba(${e.toString()},${t})`}else{return n}}else{return this.get_current()}}}T.Color=te;class ne extends s{constructor(e){let{owner:t,json:n,default_value:r,on_change:i,min:s,max:o,step:a}=e;const l={step:a,on_change:i,min:s,max:o};super({owner:t,json:n,default_value:r,initialize_args:l})}initialize(e){var t,n;(t=e)!=null?t:e={};this.step=(n=e.step)!=null?n:1;this.on_change=e.on_change;this.min=e.min;this.max=e.max;this.canvas=a.div("composer-slider property-editor-control");this.canvas.slider();const r={min:this.min,max:this.max,step:this.step,slide:(e,t)=>{this.update()},stop:(e,t)=>{this.commit()}};for(const e in r){const t=r[e];this.canvas.slider("option",e,t)}a.autorun((()=>{var e,t;const n=(e=(t=this.node().get_literal())!=null?t:this.default_value)!=null?e:"";if(this.transform(n)!==this.transform(this.get_canvas().val())){this.canvas.slider("value",this.transform(n))}}))}update(){var e;const t=this.transform(this.canvas.slider("value"));if(this.node().is_empty()&&t===this.default_value){return}if(t===this.node().get_literal()){return}this.write(t);(e=this.on_change)==null?void 0:e.call(this,t)}transform(e){e=parseFloat(e);if(isNaN(e)){e=null}return e}commit(){this.update();this.node().commit()}select(){this.select_node()}enable(){this.get_canvas().slider("option","disabled",false);this.get_canvas().removeClass("disabled")}disable(){this.get_canvas().slider("option","disabled",true);this.get_canvas().addClass("disabled")}}T.Slider=ne;const re={};class ie extends s{constructor(e){let{owner:t,json:n,default_value:r,icon_list:i}=e;const s={icon_list:i};super({owner:t,json:n,default_value:r,initialize_args:s})}initialize(e){var t,n,r;(t=e)!=null?t:e={};this.icon_list=e.icon_list;this.canvas=$('<button class="btn IconInput property-editor-control"></button>');this.caption=a.div("button-caption",this.canvas);this.icon_preview=$("<i></i>");this.canvas.append(this.icon_preview);this._display_caption();this.focus=new a.HasFocus(this.canvas,null);this.focus.on("blur",(()=>{this.close()}));(r=re[n=this.node().path()])!=null?r:re[n]=a.Box(false);const s=a.Box(null);this.icon_palette=new(i.get_composer("IconPalette"))({target:this.canvas,icon_list:this.icon_list,cb:e=>this.change(e),node:this.node(),default_value:this.default_value,real_time_search_box:s});this.icon_palette.hide();a.autorun((()=>{var e;this.assign_icon((e=this.node().get_literal())!=null?e:this.default_value)}));a.SetFocusOwner(this.icon_palette.canvas,this.canvas);a.autorun((()=>{if(re[this.node().path()]()){this.icon_palette.show();this.canvas.addClass("selected");this.focus.focus=true;this.caption.text("");this.icon_preview.hide();this.ip=a.input("composer-input text-input",this.canvas,undefined,"Type to search...");s(null);this.ip.on("keyup",(()=>{s(this.ip.val())}));this.ip.on("change",(e=>{e.stopPropagation()}));a.wait_for_attached(this.ip,(()=>{this.ip.focus()}))}else{var e;this.icon_palette.hide();(e=this.ip)==null?void 0:e.remove();this._display_caption();this.canvas.removeClass("selected")}}),(()=>{this.icon_palette.destroy()}));this.canvas.on("vclick",(()=>{if(!re[this.node().path()]()){this.open()}else{this.close()}return null}))}_display_caption(){this.caption.text("Choose an icon ");this.icon_preview.show()}assign_icon(e){var t,n;this.icon_preview.attr("class","");this.icon_preview.addClass(e);(t=(n=this.icon_list).fn)==null?void 0:t.call(n,this.icon_preview,e)}change(e){var t;this.close();if(e!==((t=this.node().get_literal())!=null?t:this.default_value)){this.write(e);this.node().commit()}}select(){return this.open()}open(){return re[this.node().path()](true)}close(){return re[this.node().path()](false)}}T.IconInput=ie;class se{constructor(e,t,n,i){var s,o,l;this.val=e;this.default_value=t;this.cb=n;(s=i)!=null?s:i="composer-input text-input";this.canvas=a.input(i);this.canvas.val((o=(l=this.val)!=null?l:this.default_value)!=null?o:"");this.canvas.on("change",(()=>this.cb(this.canvas.val())));r.enter_is_change(this.canvas)}is_focused(){return this.canvas[0]===document.activeElement}set_delete_cb(e){return this.canvas.on("keydown.composer-selected",(t=>{if([$.ui.keyCode.BACKSPACE,$.ui.keyCode.DELETE].includes(t.which)){if(!this.canvas.val()){return e()}}}))}}T.TextInput=se;class oe extends se{constructor(e){let{val:t,default_value:n,cb:i,integer_only:s,numerical_step:o,optional:l}=e;super(t,n,(()=>undefined),"composer-input number-input");this.integer_only=s;this.numerical_step=o;this.optional=l;this.cb=e=>{let t=(this.integer_only?parseInt:parseFloat)(e);if(isNaN(t)){if(this.optional){t=null}else{t=0}}i(t)};a.make_numeric(this.canvas,this.integer_only);if(this.numerical_step){r.add_arrow_handlers_numeric_box(this.canvas,this.cb,this.numerical_step)}}}T.NumberInput=oe;class ae extends se{constructor(e,t,n){super(e,t,n,"composer-input keyboard-input");a.make_key_combo_listener(this.canvas)}}T.KeyCombinationInput=ae},{"../../../client/analytics":20,"../../../constants/colors":53,"../../../constants/composer":54,"../../../constants/editor":60,"../../../constants/segment_events":85,"../../../constants/tokens":93,"../../../core/core_elements/shared/image_utils":363,"../../../core/input_mask":383,"../../../core/widgets":421,"../../../db/hydrate":429,"../../../db/values/db_values":476,"../../../geolocation/b_location":621,"../../../geolocation/shared/b_location_utils":626,"../../../lang/appquery":651,"../../../lang/color_tokens":657,"../../../lang/tokens":730,"../../../lib":741,"../../../logger":744,"../../../u":823,"../../../u/shared/b_object":839,"../../../u/shared/uuid":855,"../../css":560,"./ComposerBase":537,"./JsonFile":538,"./TextComposer":539,"./control":542,"./registry":546,"core-js/modules/es.array.at.js":1114,"core-js/modules/es.string.at-alternative.js":1119,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/debounce":1311,"lodash/escape":1313}],548:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../../u");const i=e("../../../lib");const s=e("../../../lang/appquery");const{get_composer:o}=e("../compatibility/composers");const{shrink:a,expand:l,shrink_object:c}=e("../../../lang/shrink");const u=n;u.Owner=function(e){return new d(e)};class d{constructor(e){this.value=e;this.json=new p(this,[]);this._dependency=r.Dependency();this._id=r.LUID();this._on_change=[]}get virtual(){return true}toUniqueString(){return"Owner:"+this._id}get(){this._dependency.register();return this.value}set(e){return this.write_child(null,e)}write_child(e,t){if(t!==this.value){this.value=t;this._dependency.invalidate();for(const e of this._on_change){e(this.value)}}}get_expression_owner(){return this}on_change(e){return this._on_change.push(e)}}class p{constructor(e,t){this.owner=e;this._json_path=t;this._children={}}appname(){return s.appname()}app_version(){return s.app_version()}_child(e){return this.child(l(e))}child(e){var t,n;(n=(t=this._children)[e])!=null?n:t[e]=new p(this.owner,this._json_path.concat(e));return this._children[e]}child_names(){const e=this.raw();if(typeof e==="object"&&e!=null){return Object.keys(e)}return[]}children(){return this.child_names().map((e=>this.child(e)))}empty(){return this.raw()==null}exists(){return this.raw()!=null}_gchild(e,t){return this._child(e)._child(t)}get(){const e=this.raw();if(typeof e==="object"){return null}return e}get_undostack(){return i().undostack}_name(){return a(this.name())}name(){return this._json_path[this._json_path.length-1]}_path(){return a(this.path())}path(){return this.owner._id+this._json_path.join(".")}path_cache(){return this.path()}parent(){if(this._json_path.length===0){return null}return new p(this.owner,this._json_path.slice(0,-1))}_raw(){return c(this.raw())}raw(){this._register();let e=this.owner.value;for(const n of this._json_path){var t;e=(t=e)==null?void 0:t[n]}return e}_raw_child(e){return this._child(e)._raw()}_raw_gchild(e,t){return this._gchild(e,t)._raw()}raw_type(){return typeof this.raw()}_register(){this.owner._dependency.register()}root(){return this.owner.json}smart_cache(e,t,n){return t(this,n)}toUniqueString(){return"OwnerJSON:"+this.path()}}u.AppSettingsEditor=class e{constructor(e){this.settings=e;this.property={optional:true}}get_composer(){this.settings.json=s.app().json.child_by_path(this.settings.path);return o(this.settings.cls,this,this.settings)}write_child(e,t){this.settings.fn(t)}get_expression_owner(){return s.app()}}},{"../../../lang/appquery":651,"../../../lang/shrink":728,"../../../lib":741,"../../../u":823,"../compatibility/composers":532,"core-js/modules/web.dom-collections.iterator.js":1123}],549:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.CheckboxComposer=void 0;var r=e("solid-js/web");var i=e("../../components/utils/prop_utils");var s=e("../utilities/focusTracking");const o=(0,r.template)(`<div></div>`,2);const a=e=>(()=>{const t=o.cloneNode(true);(0,r.use)(s.applyFocusHere,t,(()=>e.id));t.$$click=()=>{if(!e.disabled){e.setCurrentValue(!e.currentValue)}};(0,r.effect)((n=>{var s,o;const a=e.id,l=`component-checkbox property-editor-control new-composer ${(s=e.class)!=null?s:""}`,c=(0,i.merge_class_lists)({checked:(o=e.currentValue)!=null?o:false},e.classList);a!==n._v$&&(0,r.setAttribute)(t,"id",n._v$=a);l!==n._v$2&&(0,r.className)(t,n._v$2=l);n._v$3=(0,r.classList)(t,c,n._v$3);return n}),{_v$:undefined,_v$2:undefined,_v$3:undefined});return t})();n.CheckboxComposer=a;(0,r.delegateEvents)(["click"])},{"../../components/utils/prop_utils":516,"../utilities/focusTracking":557,"solid-js/web":2315}],550:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.DateBoxComposer=l;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("../../../u");var o=e("../../../core/input_mask");const a=(0,r.template)(`<input>`,1);function l(e){let t;function n(t){if(e.with_time){if(e.seconds){return(0,s.format_date)(t,"mm/dd/yyyy HH:MM:ss")}else{return(0,s.format_date)(t,"mm/d/yyyy hh:MM tt")}}else{return(0,s.format_date)(t,"mm/d/yyyy")}}const[l,c]=(0,i.createSignal)(null);const u=(0,i.createMemo)((()=>{var t;return n((t=l())!=null?t:e.currentValue)}));function d(e){if(e==null){return null}return new Date(e)}return(()=>{const n=a.cloneNode(true);n.addEventListener("blur",(()=>{e.setCurrentValue(d(t.value));c(null)}));n.addEventListener("focus",(()=>{c(e.currentValue)}));(0,r.use)((n=>{t=n;if(e.with_time){if(e.seconds){$(n).inputmask(o.masks.date_time.mask)}else{$(n).inputmask(o.masks.date_time_no_seconds.mask)}}else{$(n).inputmask(o.masks.date_time.mask)}}),n);(0,r.effect)((()=>{var t;return(0,r.className)(n,`DateBox bubble-ui ${(t=e.class)!=null?t:""}`)}));(0,r.effect)((()=>n.value=u()));return n})()}},{"../../../core/input_mask":383,"../../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],551:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.DropdownComposer=d;var r=e("solid-js/web");var i=c(e("../../components/design/dropdown/AutocompleteDropdown"));var s=e("../../../constants/composer");var o=e("../../components/design/dropdown/Dropdown");var a=e("solid-js");var l=e("../utilities/focusTracking");function c(e){return e&&e.__esModule?e:{default:e}}const u=(0,r.template)(`<div></div>`,2);function d(e){(0,a.onMount)((()=>{if(!e.contents.is_optional()&&s.FINITE_OPTION_INPUT_TYPES.has(e.contents.get_input_type())&&!e.contents.get_new_option_accelerator()){return}const t=e.contents.all();if(t.length===1&&e.currentValue===undefined){e.setCurrentValue(t[0].value,"automatic-change")}}));return(()=>{const t=u.cloneNode(true);(0,r.use)((t=>{if(window.composer_revamp){(0,l.applyFocusHere)(t,(()=>e.id))}}),t);(0,r.insert)(t,(0,r.createComponent)(i.default,{get contents(){return e.contents},onSelect:(t,n)=>{e.setCurrentValue(t,n)},get currentlySelected(){var t;return(t=e.currentValue)!=null?t:null},get autcompletePlaceholder(){return e.searchPlaceholder},captionPlaceholder:"",get showingSignal(){return[()=>e.showing,e.setShowing]},get disabledKeyboardInputs(){return e.numericalStep?["ArrowUp","ArrowDown"]:[]},equals:o.equalByReference,get["class"](){var t;return`new-composer ${(t=e.class)!=null?t:""}`},get hideArrow(){var t;return(t=e.hideArrow)!=null?t:false},get emptyDisplay(){return e.emptyDisplay},get disabled(){return e.disabled}}));(0,r.effect)((n=>(0,r.classList)(t,{"property-editor-control":true,"composer-container":true,"new-composer":true,mandatory:!e.contents.is_optional(),optional:e.contents.is_optional(),disabled:e.disabled,empty:e.currentValue==null,[`composer-dropdown-${e.contents.get_dropdown_width()}`]:true},n)));return t})()}},{"../../../constants/composer":54,"../../components/design/dropdown/AutocompleteDropdown":498,"../../components/design/dropdown/Dropdown":499,"../utilities/focusTracking":557,"solid-js":2313,"solid-js/web":2315}],552:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.MultilineTextBoxComposer=l;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("../utilities/focusTracking");var s=e("solid-js");var o=e("./TextBoxComposerBase");const a=(0,r.template)(`<textarea class="MultilineTextBox property-editor-control"></textarea>`,2);function l(e){let t;const[n,l]=(0,s.createSignal)(false);const c=s=>(()=>{const o=a.cloneNode(true);o.addEventListener("blur",(()=>{if(!e.no_resize&&!n()){const e=window.optional_modules.autosize;e==null?void 0:e.destroy(t);l(true)}}));o.addEventListener("focus",(()=>{if(!e.no_resize){l(false);const e=window.optional_modules.autosize;e==null?void 0:e(t)}}));const c=t;typeof c==="function"?(0,r.use)(c,o):t=o;(0,r.use)(i.applyFocusHere,o,(()=>e.id));(0,r.setAttribute)(o,"data-gramm_editor",false);(0,r.spread)(o,(0,r.mergeProps)({get rows(){var t;return(t=e.rows)!=null?t:2}},s),false,false);return o})();return(0,r.createComponent)(o.TextBoxComposerBase,(0,r.mergeProps)({class:""},e,{children:c}))}},{"../utilities/focusTracking":557,"./TextBoxComposerBase":555,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],553:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.NumberBoxComposer=s;var r=e("solid-js/web");var i=e("./TextBoxComposer");function s(e){function t(t){if(t==null){return null}let n;if(e.integer_percentage&&t.indexOf!=null&&t.includes("%")){n=parseInt(t)/100}else if(e.integer){n=parseInt(t)}else{n=parseFloat(t)}if(isNaN(n)){n=null}return n}return(0,r.createComponent)(i.TextBoxComposer,(0,r.mergeProps)(e,{get["class"](){var t;return`NumberBox ${(t=e.class)!=null?t:""}`},fromDisplay:t,toDisplay:t=>{if(t==null){return t}else if(e.integer_percentage){if(t<0||t>1){return String(t)}else{return`${100*t}%`}}else{return String(t)}},onKeyDown:e=>{function t(e){const t=String(e);if(!t.includes(".")){return 0}else{return t.split(".")[1].length}}let n=parseFloat(e.currentTarget.value);if(isNaN(n)){n=parseFloat(e.currentTarget.placeholder);if(isNaN(n)){n=0}}const r=e.shiftKey?5:1;const i=Math.max(t(n),t(r));let s=null;switch(e.key){case"ArrowUp":s=(n+r).toFixed(i);break;case"ArrowDown":s=(n-r).toFixed(i);break}if(s!=null){const t=new Event("input",{bubbles:true,cancelable:true});e.currentTarget.value=s;e.currentTarget.dispatchEvent(t)}}}))}},{"./TextBoxComposer":554,"solid-js/web":2315}],554:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.TextBoxComposer=a;var r=e("solid-js/web");var i=e("../utilities/focusTracking");var s=e("./TextBoxComposerBase");const o=(0,r.template)(`<input>`,1);function a(e){const t=t=>(()=>{const n=o.cloneNode(true);(0,r.use)(i.applyFocusHere,n,(()=>e.id));(0,r.spread)(n,(0,r.mergeProps)(t,{type:"text"}),false,false);return n})();return(0,r.createComponent)(s.TextBoxComposerBase,(0,r.mergeProps)(e,{children:t}))}},{"../utilities/focusTracking":557,"./TextBoxComposerBase":555,"solid-js/web":2315}],555:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.TextBoxComposerBase=a;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../components/utils/prop_utils");var i=e("../utilities/focusTracking");var s=e("solid-js");const o=600;function a(e){var t,n;let a=null;const l=t=>e.sanitizeFn?e.sanitizeFn(t):t;const c=t=>{var n;return(n=e.toDisplay?e.toDisplay(t):t)!=null?n:""};const u=t=>e.fromDisplay?e.fromDisplay(t||null):t||null;const d=t=>e.validationFn?e.validationFn(t):true;const[p,_]=(0,s.createSignal)(null);const f=()=>{var t,n;return l((t=(n=p())!=null?n:c(e.currentValue))!=null?t:"")};const h=e=>{if(d(e)){m()}else{_(null)}};function m(){var t;const n=(t=e.flush_timeout)!=null?t:o;if(a!=null){clearTimeout(a)}const r=f();a=setTimeout((()=>{e.setCurrentValue(u(r));if(!i.GlobalComposerFocusTracker.isFocused(e.id)){_(null)}}),n)}return e.children({classList:(0,r.merge_class_lists)({"property-editor-control":true,"new-composer":true,[(t=e.class)!=null?t:"TextBox"]:true,mandatory:!e.optional,disabled:e.disabled,empty:!e.currentValue},e.classList),id:e.id,readOnly:e.disabled,placeholder:(n=e.placeholder)!=null?n:"",onInput:t=>{const n=t.currentTarget.value;_(null);_(c(u(l(n))));if(!e.onBlurOnly){h(u(n))}},onChange:e=>h(u(e.currentTarget.value)),onFocus:()=>{var t;_(f());(t=e.onFocus)==null?void 0:t.call(e)},onBlur:()=>{if(!a)_(null)},value:f(),onKeyDown:e.onKeyDown})}},{"../../components/utils/prop_utils":516,"../utilities/focusTracking":557,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],556:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.SINGLE_SECTION=n.DropdownContents=void 0;n.sort_by_display=p;e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js");var i=e("../../../constants/composer");var s=o(e("lodash/isEqual"));function o(e){return e&&e.__esModule?e:{default:e}}const a="main";n.SINGLE_SECTION=a;class l{constructor(e,t){this._content=void 0;this.content=void 0;this.strategy=void 0;this.strategy=t!=null?t:"Eager";this.content=()=>{var t;(t=this._content)!=null?t:this._content=(0,r.createMemo)(e,{},{equals:s.default});return this._content()};if(this.strategy==="Eager"){this.content()}}all(){return Object.values(this.content()).flat()}section_names(){return Object.keys(this.content())}section(e){return this.content()[e]}find(e,t){if(t){var n;return(n=this.content()[t])==null?void 0:n.find(e)}for(const t of Object.values(this.content())){const n=t.find(e);if(n!=null){return n}}return undefined}filter(e){return new l((()=>Object.fromEntries(Object.entries(this.content()).map((t=>{let[n,r]=t;return[n,r.filter(e)]})).filter((e=>{let[t,n]=e;return n.length>0})))))}map(e){return new l((()=>Object.fromEntries(Object.entries(this.content()).map((t=>{let[n,r]=t;return[n,r.map(e)]})))),this.strategy)}flatMap(e){return new l((()=>Object.fromEntries(Object.entries(this.content()).map((t=>{let[n,r]=t;return[n,r.flatMap(e)]})))),this.strategy)}sort(e){return new l((()=>Object.fromEntries(Object.entries(this.content()).map((t=>{let[n,r]=t;return[n,[...r].sort(e)]})))),this.strategy)}sort_section(e,t){return new l((()=>Object.fromEntries(Object.entries(this.content()).map((n=>{let[r,i]=n;return[r,r===e?[...i].sort(t):[...i]]})))),this.strategy)}add_items(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return new l((()=>{const e={...this.content()};for(const[r,i]of t){var n;e[r]=[...(n=e[r])!=null?n:[],...i]}return e}),this.strategy)}}class c extends l{constructor(e){super((()=>({[a]:e})))}}class u{constructor(){this.names=void 0;this.contents=void 0;this.names=[];this.contents=[]}section(e,t){this.names.push(e);this.contents.push(t);return this}build(e){return d.multi_section((()=>Object.fromEntries(this.names.map((e=>typeof e==="function"?e():e)).map(((e,t)=>[e,this.contents[t]()])))),e)}}class d{constructor(e,t){this._sections=void 0;this._options=void 0;this._sections=e;this._options=t}static empty(e){return d.no_sections((()=>[]),e)}static fromObject(e,t){const n=Object.entries(e).map((e=>{let[t,n]=e;return{display:n,value:t}}));return new d(new c(n),t!=null?t:{})}static fromList(e,t){return new d(new c(e.map((e=>({display:String(e),value:e})))),t!=null?t:{})}static no_sections(e,t){return new d(new l((()=>({[a]:e()})),t==null?void 0:t.evaluation_strategy),t!=null?t:{})}static multi_section(e,t,n){if(typeof t==="function"){return new d(new l((()=>{const n=e();const r={};for(const e of n){var i;const n=t(e);(i=r[n])!=null?i:r[n]=[];r[n].push(e)}return r}),n==null?void 0:n.evaluation_strategy),n!=null?n:{})}else{return new d(new l(e,n==null?void 0:n.evaluation_strategy),t!=null?t:{})}}static builder(){return new u}filter(e){return new d(this._sections.filter(e),this._options)}map(e,t){return new d(this._sections.map(e),{...this._options,new_option_accelerator:t?undefined:this._options.new_option_accelerator})}flatMap(e,t){return new d(this._sections.flatMap(e),{...this._options,new_option_accelerator:t?undefined:this._options.new_option_accelerator})}sort(e){return new d(this._sections.sort(e),this._options)}sort_section(e,t){return new d(this._sections.sort_section(e,t),this._options)}with_options(e){return new d(this._sections,{...this._options,...e})}add_items(){return new d(this._sections.add_items(...arguments),this._options)}all(){return this._sections.all()}section_names(){const e=this._sections.section_names();if(this._options.section_order){const t=Object.fromEntries(this._options.section_order.map(((e,t)=>[e,t])));e.sort(((e,n)=>{var r,i;return((r=t[e])!=null?r:Infinity)-((i=t[n])!=null?i:Infinity)}))}return e}section(e){return this._sections.section(e)}find(e,t){return this._sections.find(e,t)}get_input_type(){var e;return(e=this._options.input_type)!=null?e:i.COMPOSER_INPUT_TYPES.REAL_TIME_SEARCH}get_dropdown_width(){var e;return(e=this._options.dropdown_width)!=null?e:"long"}get_new_option_accelerator(){return this._options.new_option_accelerator}should_show_sections(){var e;return(e=this._options.show_sections)!=null?e:false}is_optional(){var e;return(e=this._options.optional)!=null?e:false}get_display_for_literal(e){if(this._options.get_display_for_literal!=null){return this._options.get_display_for_literal(e)}else{return null}}get_value_for_literal(e){if(this._options.get_value_for_literal!=null){return this._options.get_value_for_literal(e)}else{return undefined}}ignore_type_check(){var e;return(e=this._options.ignore_type_check)!=null?e:false}section_classes(){var e;return(e=this._options.section_classes)!=null?e:{}}get_virtualize_options(){return this._options.virtualize?this._options:{virtualize:false}}}n.DropdownContents=d;function p(e,t){return e.display.toLowerCase()<t.display.toLowerCase()?1:-1}},{"../../../constants/composer":54,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/isEqual":1321,"solid-js":2313}],557:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.trackExclusiveFocus=n.applyFocusHere=n.GlobalComposerFocusTracker=n.FocusTracker=n.DONT_FIRE_EVENTS=n.DOCUMENT_FOCUS=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js");var i=e("../../components/utils/directives");var s=o(e("lodash/isEqual"));function o(e){return e&&e.__esModule?e:{default:e}}const a=false;function l(){if(a){console.log(...arguments)}}const c="document";n.DOCUMENT_FOCUS=c;class u{constructor(){this.focusSelection=void 0;this.setFocusSelection=void 0;const e=(0,r.createSignal)(null,{equals:s.default});this.focusSelection=e[0];this.setFocusSelection=e[1]}getFocusedId(){var e,t;return(e=(t=this.focusSelection())==null?void 0:t.id)!=null?e:null}isFocused(e){return this.getFocusState(e).isFocused}isChildFocused(e){return this.getFocusState(e,((e,t)=>t.startsWith(e))).isFocused}getFocusState(e,t){const n=this.focusSelection();const r=t!=null?t:(e,t)=>e===t;return n&&r(e,n.id)?{isFocused:true,metadata:n.metadata}:{isFocused:false}}setFocus(){var e;l(`Set Focus signal ${(e=arguments.length<=0?undefined:arguments[0])!=null?e:"null"}`);this.setFocusSelection((arguments.length<=0?undefined:arguments[0])!=null?{id:arguments.length<=0?undefined:arguments[0],metadata:arguments.length<=1?undefined:arguments[1]}:arguments.length<=0?undefined:arguments[0])}setFocusIfSelected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++){n[r-1]=arguments[r]}if(this.isFocused(e))this.setFocus(...n)}}n.FocusTracker=u;const d=(e,t,n)=>{e.tabIndex=-1;m(e,t,n)};n.trackExclusiveFocus=d;const p=(e,t,n)=>{(0,r.createEffect)((n=>{const r=g.getFocusState(t());if(n===undefined&&!r.isFocused)return false;if(n===r.isFocused)return r.isFocused;if(r.isFocused&&!r.metadata.dont_fire_events){l(`Trigger Focus ${t()}`);e.focus()}else if(!r.isFocused){const n=g.getFocusState(c);if(!n.isFocused||!n.metadata.dont_fire_events){l(`Trigger Blur ${t()}`);e.blur()}}return r.isFocused}),undefined);m(e,t,n)};n.applyFocusHere=p;let _=false;const f={dont_fire_events:true};n.DONT_FIRE_EVENTS=f;let h=null;const m=(e,t,n)=>{const r=e=>g.isFocused(e);let s=false;let o=false;(0,i.onElementEvent)(e,"mousedown",(()=>()=>{s=true;_=true;o=false;l(`Mousedown ${t()}`)}));(0,i.onElementEvent)(e,n?"focusin":"focus",(()=>()=>{const e=t();if(!r(e)){l(`Focus Event ${t()}`);if(s){o=true}else{const t=g.getFocusState(c);let n={};if(t.isFocused&&t.metadata.prev_focus===e){n={...t.metadata};delete n.prev_focus;delete n.dont_fire_events}g.setFocus(e,{...f,...n})}}}));(0,i.onElementEvent)(e,"mouseup",(()=>()=>{l(`Mouseup ${t()}`);const e=t();if(o&&!r(e)){g.setFocus(e,f)}else if(h!=null&&r(h)){const t=g.getFocusState(h);g.setFocus(c,{...t.metadata,dont_fire_events:true,prev_focus:e})}h=null;s=false;_=false}));(0,i.onElementEvent)(e,n?"focusout":"blur",(()=>()=>{l(`Blur event ${t()}`);const e=t();const n=g.getFocusState(e);if(n.isFocused&&!_){g.setFocus(c,{...n.metadata,dont_fire_events:true,prev_focus:e})}else if(n.isFocused){h=e}}))};const g=new u;n.GlobalComposerFocusTracker=g},{"../../components/utils/directives":514,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/isEqual":1321,"solid-js":2313}],558:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../u");const i=e("./../safe_require");const s=e("./thumbnail");const o=e("./documentationpalette");const{initializeContextMenu:a,showContextMenu:l}=e("./components/design/context_menu");r.edit_mode_only();let c=null;t.exports=()=>{var e;return(e=c)!=null?e:c=new u};i.safe_register("./editor/contextmenu",t.exports);if(typeof window!=="undefined"&&window!==null){window.contextmenu_off=()=>{window.context_menu_off=true}}class u{add_handler(e,t){e.on("contextmenu",(e=>{if(window.context_menu_off){return true}e.preventDefault();e.stopPropagation();t(e)}))}constructor(){this.canvas=r.div();this.canvas.css("position","fixed");this.canvas.css("z-index",50000004);$(document.body).append(this.canvas);this.canvas.hide();this.solid_canvas=r.div();$(document.body).append(this.solid_canvas);a==null?void 0:a(this.solid_canvas[0])}set_focus_owner(e){r.SetFocusOwner(this.canvas,e);r.SetFocusOwner(this.solid_canvas,e)}open(e,t,n,i){this.close();this.close_cb=i;this.focus=new r.HasFocus(this.canvas,null);this.focus.focus=true;this.focus.on("blur",(()=>{this.close()}));this.canvas.attr("class","");if(t){this.canvas.addClass(t.toLowerCase())}this.canvas.empty();for(const e of n!=null?n:[]){var a;let[n,i,l,c,u,d,p]=e;let _;if(n instanceof jQuery){_=n.text()}else if(typeof n==="function"){_=n()}else{_=n}let f;if(!p){f=r.create_css_class_from_label(_)}else{f=""}const h=["context-menu-item",f];if(typeof c==="function"){c=c()}if(typeof c==="string"){c=[c]}h.push(...(a=c)!=null?a:[]);let m;if(n instanceof jQuery){m=n;m.addClass(h.join(" "));this.canvas.append(m)}else{m=r.div(h,this.canvas);if(n!==this.SEPARATOR){m.text(n)}}if(l!=null&&l()||n===this.SEPARATOR){m.addClass("disabled");m.on("vclick",(e=>e.stopPropagation()))}else{m.on("vclick",(e=>{this.close();i();e.stopImmediatePropagation();return false}))}if(u){s().add(m,u);m.attr("element_id",u)}else if(_!=="SEPARATOR"&&!["top-menu help","top-menu user_menu"].includes(t)&&!(l!=null&&l())){o.DocumentationPalette().add(m,"Documentation.Interface.Menu."+_)}d==null?void 0:d(m)}let l,c;if(this.canvas.hasClass("context-menu")){this.canvas.css("max-height","none");l=$(window).height()-this.canvas.height()-20;c=$(window).width()-this.canvas.width()-10}else{var u,d;c=(u=e.pageX)!=null?u:$(e).offset().left;l=(d=e.pageY)!=null?d:$(e).offset().top+$(e).outerHeight()}let p,_;if(e.pageX){_=Math.min(e.pageX,c);p=Math.max(Math.min(e.pageY,l),0)}else{_=Math.min($(e).offset().left,c);p=Math.min($(e).offset().top+$(e).outerHeight(),l)}this.canvas.css("top",p);this.canvas.css("left",_);if(this.canvas.hasClass("context-menu")){this.canvas.css("max-height",$(window).height()-20-p)}else{this.canvas.css("max-height",$(window).height()-80)}this.canvas.show()}open_new(e){let{anchor:t,options:n,class:i,close_cb:s}=e;this.close();this.close_cb=s;l({anchor:t,options:n,class:i,onSelection:e=>{var t;if(!((t=e.subOptions)!=null&&t.length)){this.close()}}});this.focus=new r.HasFocus(this.solid_canvas,null);this.focus.focus=true;this.focus.on("blur",(()=>{this.close()}))}close(){var e,t;(e=this.focus)==null?void 0:e.destroy();this.focus=null;this.canvas.hide();l(null);(t=this.close_cb)==null?void 0:t.call(this);this.close_cb=null}}u.prototype.SEPARATOR="SEPARATOR"},{"./../safe_require":777,"./../u":823,"./components/design/context_menu":497,"./documentationpalette":565,"./thumbnail":590,"core-js/modules/web.dom-collections.iterator.js":1123}],559:[function(e,t,n){"use strict";const r=e("./../u");r.edit_mode_only();const i=e("./../content/tutorial_videos");const s=e("./slidablepanel");const o=e("./../lib");const a=n;const l="bubble_element_intro_videos";class c extends s.SlidablePanel{constructor(){super({title:"Contextual video"});this.video_zone=r.div("video-zone",this.canvas);this.invisible_draggable_div=r.div("invisible-draggable-div",this.canvas);this.invisible_draggable_div.css("display","none");this.disabled=false;u.is_user_newer_than_three_weeks((()=>{this.is_new_user=true;r.WaitFor(o().visual_edit_is_ready,(()=>o().visual_edit.toogle_show_short_videos(d.get_setting("show_short_videos"))))}))}disable(){this.disabled=true}start_video(e){setTimeout((()=>{this.video_zone.html('<iframe src="https://player.vimeo.com/video/'+e+'?title=0&amp;byline=0&amp;portrait=0&amp;color=0000FF&amp;autoplay=1" width="330" height="238" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>');r.add_finish_cb_to_vimeo(this.video_zone,e,(()=>{this.hide()}))}),300)}show_hide_help_button(e,t){if(this.get_video_id(e)){t.show()}else{t.hide()}}show(e,t){var n;(n=t)!=null?n:t=false;this.canvas.css("z-index",-1);if(!this.disabled&&!p.TutorialVideoPalette().is_visible()){const n=this.get_video_id(e);if(n&&(this.should_show_video(e)&&!r.is_on_mobile_or_tablet()||t)){const t=this.get_saved_data();if(!t.includes(e)){this.set_cookie_data(t.concat([e]))}this.start_video(n);this.reveal((()=>{this.canvas.css("z-index","auto")}))}}}hide(e){super.hide(e);setTimeout((()=>{this.video_zone.html("")}),300)}get_saved_data(){var e,t;const n=window.localStorage.getItem(l);if(n){var i;return(i=JSON.parse(n))!=null?i:[]}const s=(e=JSON.parse((t=r.readCookie(l))!=null?t:"[]"))!=null?e:[];this.set_cookie_data(s);r.eraseCookie(l);return s}set_cookie_data(e){window.localStorage.setItem(l,JSON.stringify(e))}should_show_video(e){return!this.get_saved_data().includes(e)&&this.is_new_user&&o().visual_edit.show_short_videos}get_video_id(e){return i.contextual_videos[e]}}a.ContextualVideoPalette=r.singleton(c);const u=e("./tour");const d=e("./editor_settings");const p=e("./tutorial_video_palette")},{"./../content/tutorial_videos":98,"./../lib":741,"./../u":823,"./editor_settings":570,"./slidablepanel":588,"./tour":591,"./tutorial_video_palette":592}],560:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.WORKFLOW_TAB=n.VISUAL_TAB=n.VISUAL_EDIT_TOOLBOX=n.VISUAL_CANVAS=n.VERSIONS_TAB=n.VERSIONS_CANVAS=n.TRANSITIONS=n.TOOLBOX_PANE=n.TEMPLATE_TAB=n.TEMPLATE_CANVAS=n.TAB_NAME_TO_TAB_SELECTOR=n.TAB_NAME_TO_CANVAS_SELECTOR=n.TABBAR_WIDTH=n.STYLES_TAB=n.STYLES_CANVAS=n.STATS_TAB=n.STATS_CANVAS=n.SPOT=n.SLIDABLE_PALETTE=n.SHAREDTECH_TAB=n.SHAREDTECH_CANVAS=n.SETTINGS_TAB=n.SETTINGS_CANVAS=n.SEARCH_PALETTE=n.PROP_ROW=n.PROP_NAME_SELECTOR=n.PROP_NAME=n.PROPERTY_EDITOR=n.PRIVACY_SUBTAB=n.PLUGIN_TAB=n.PLUGIN_CANVAS=n.MAIN_TABS_TAB_PLUGIN=n.MAIN_TABS_TAB=n.MAIN_TABS=n.MAINWINDOW=n.LOGS_TAB=n.LOGS_CANVAS=n.IMAGE_EDITOR_PALETTE=n.HIGHLIGHT_BOX=n.GENERAL_TAB=n.GENERAL_CANVAS=n.FEEDBACK_WINDOW=n.ELEMENTS_TAB=n.ELEMENTS_CANVAS=n.DOCS_CANVAS=n.DEFAULT_TOOLBOX_WIDTH=n.DEDICATED_PALETTE=n.DATA_TAB=n.DATA_CANVAS=n.CONTEXTUAL_VIDEO_PALETTE=n.CONDITIONAL=n.APPEARANCE=n.API_TAB=n.API_CANVAS=n.ACTION_CANVAS=n.ACTIONS_TAB=n.ACTIONS_CANVAS=void 0;var r=i(e("./../safe_require"));function i(e){return e&&e.__esModule?e:{default:e}}let s,o,a,l,c,u,d,p,_,f,h,m,g,v,b,y,w,x,j,A,M,E,k,O,S,D,C,T,N,P,I,R,L,z,B,q,U,F,W,$,G,V,H,X,Y,K,J,Z,Q,ee,te,ne,re,ie,se,oe,ae;n.TAB_NAME_TO_TAB_SELECTOR=ae;n.TAB_NAME_TO_CANVAS_SELECTOR=oe;n.VISUAL_EDIT_TOOLBOX=se;n.TOOLBOX_PANE=ie;n.TABBAR_WIDTH=re;n.DEFAULT_TOOLBOX_WIDTH=ne;n.SPOT=te;n.HIGHLIGHT_BOX=ee;n.PROP_NAME_SELECTOR=Q;n.PROP_ROW=Z;n.PROP_NAME=J;n.CONTEXTUAL_VIDEO_PALETTE=K;n.IMAGE_EDITOR_PALETTE=Y;n.SEARCH_PALETTE=X;n.DEDICATED_PALETTE=H;n.FEEDBACK_WINDOW=V;n.SLIDABLE_PALETTE=G;n.TRANSITIONS=$;n.CONDITIONAL=W;n.APPEARANCE=F;n.PROPERTY_EDITOR=U;n.PRIVACY_SUBTAB=q;n.STATS_CANVAS=B;n.VERSIONS_CANVAS=z;n.ACTIONS_CANVAS=L;n.ELEMENTS_CANVAS=R;n.API_CANVAS=I;n.SHAREDTECH_CANVAS=P;n.GENERAL_CANVAS=N;n.DOCS_CANVAS=T;n.TEMPLATE_CANVAS=C;n.LOGS_CANVAS=D;n.SETTINGS_CANVAS=S;n.PLUGIN_CANVAS=O;n.STYLES_CANVAS=k;n.DATA_CANVAS=E;n.ACTION_CANVAS=M;n.VISUAL_CANVAS=A;n.TEMPLATE_TAB=j;n.STATS_TAB=x;n.LOGS_TAB=w;n.VERSIONS_TAB=y;n.SETTINGS_TAB=b;n.ACTIONS_TAB=v;n.PLUGIN_TAB=g;n.ELEMENTS_TAB=m;n.STYLES_TAB=h;n.API_TAB=f;n.DATA_TAB=_;n.SHAREDTECH_TAB=p;n.WORKFLOW_TAB=d;n.GENERAL_TAB=u;n.VISUAL_TAB=c;n.MAIN_TABS_TAB_PLUGIN=l;n.MAIN_TABS_TAB=a;n.MAIN_TABS=o;n.MAINWINDOW=s;r.default.safe_register("./editor/css",n);n.MAINWINDOW=s=".mainwindow";n.MAIN_TABS=o=".main-tab-bar";n.MAIN_TABS_TAB=a=o+" [data-tab-item]";n.MAIN_TABS_TAB_PLUGIN=l=o+" .tab";n.VISUAL_TAB=c=o+' [data-tab-item="Design"]';n.GENERAL_TAB=u=o+" .tabs-1";n.WORKFLOW_TAB=d=o+' [data-tab-item="Workflow"]';n.SHAREDTECH_TAB=p=o+" .tabs-2";n.DATA_TAB=_=o+' [data-tab-item="Data"]';n.API_TAB=f=o+" .tabs-3";n.STYLES_TAB=h=o+' [data-tab-item="Styles"]';n.ELEMENTS_TAB=m=o+" .tabs-4";n.PLUGIN_TAB=g=o+' [data-tab-item="Plugins"]';n.ACTIONS_TAB=v=o+" .tabs-5";n.SETTINGS_TAB=b=o+' [data-tab-item="Settings"]';n.VERSIONS_TAB=y=o+" .tabs-6";n.LOGS_TAB=w=o+' [data-tab-item="Logs"]';n.STATS_TAB=x=o+" .tabs-7";n.TEMPLATE_TAB=j=o+' [data-tab-item="Template"]';n.TAB_NAME_TO_CANVAS_SELECTOR=oe=e=>{let t="tabs-1";switch(e){case"Design":t="tabs-1";break;case"Workflow":t="tabs-2";break;case"Data":t="tabs-3";break;case"Styles":t="tabs-4";break;case"Plugins":t="tabs-5";break;case"Settings":t="tabs-6";break;case"Logs":t="tabs-7";break;case"Template":t="tabs-8";break;default:t="tabs-1"}return t};n.TAB_NAME_TO_TAB_SELECTOR=ae=e=>{let t=c;switch(e){case"Design":t=c;break;case"Workflow":t=d;break;case"Data":t=_;break;case"Styles":t=h;break;case"Plugins":t=g;break;case"Settings":t=b;break;case"Logs":t=w;break;case"Template":t=j;break;default:t=c}return t};n.VISUAL_CANVAS=A=".tabcanvas.tabs-1";n.ACTION_CANVAS=M=".tabcanvas.tabs-2";n.DATA_CANVAS=E=".tabcanvas.tabs-3";n.STYLES_CANVAS=k=".tabcanvas.tabs-4";n.PLUGIN_CANVAS=O=".tabcanvas.tabs-5";n.SETTINGS_CANVAS=S=".tabcanvas.tabs-6";n.LOGS_CANVAS=D=".tabcanvas.tabs-7";n.TEMPLATE_CANVAS=C=".tabcanvas.tabs-8";n.DOCS_CANVAS=T=".tabcanvas.tabs-9";n.GENERAL_CANVAS=N=".tabcanvas.tabs-1.general";n.SHAREDTECH_CANVAS=P=".tabcanvas.tabs-2.sharedtech";n.API_CANVAS=I=".tabcanvas.tabs-3.api";n.ELEMENTS_CANVAS=R=".tabcanvas.tabs-4.elements";n.ACTIONS_CANVAS=L=".tabcanvas.tabs-5.actions";n.VERSIONS_CANVAS=z=".tabcanvas.tabs-6.versions";n.STATS_CANVAS=B=".tabcanvas.tabs-7.stats";n.PRIVACY_SUBTAB=q=".tab-caption.privacy";n.PROPERTY_EDITOR=U=".property-editor-2";n.APPEARANCE=F=".tab-1";n.CONDITIONAL=W=".tab-2";n.TRANSITIONS=$=".tab-3";n.SLIDABLE_PALETTE=G=".slidable-palette";n.FEEDBACK_WINDOW=V=".feedback-window";n.DEDICATED_PALETTE=H=".dedicated-palette";n.SEARCH_PALETTE=X=".search-palette";n.IMAGE_EDITOR_PALETTE=Y=".image-editor-palette";n.CONTEXTUAL_VIDEO_PALETTE=K=".contextual-video-palette";n.PROP_NAME=J="prop_name";n.PROP_ROW=Z=".row";n.PROP_NAME_SELECTOR=Q=function(e){return Z+"["+J+'="'+e+'"]'};n.DEFAULT_TOOLBOX_WIDTH=ne=186;n.TABBAR_WIDTH=re=60;n.HIGHLIGHT_BOX=ee=".highlight-box";n.SPOT=te=".spot";n.TOOLBOX_PANE=ie=".toolbox-pane";n.VISUAL_EDIT_TOOLBOX=se=".visual-edit-toolbox"},{"./../safe_require":777}],561:[function(e,t,n){var r,i,s,o,a,l,c,u,d,p,_,f,h,m,g,v,b,y,w,x,j,A,M,E,k,O=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1},S=function(e,t){for(var n in t){if(D.call(t,n))e[n]=t[n]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},D={}.hasOwnProperty;_=n;k=e("./../u");k.edit_mode_only();a=e("./../lib");E=e("../constants/special_keys");w=e("papaparse");l=e("../client/analytics");b=e("./../logger");x=e("./../parse_objects");m=e("./utils/editor_exposure");f=e("../lang/btypes_dropdowns").customTypes;g=e("./composer/compatibility/composers").get_composer;o=e("./composer/compatibility/solid_conversion/DropdownComposerInterface");if(k.on_client()){y=e("../../vendor/jquery_plugins/moment.timezone.min.js")}else{M=e;y=M("moment-timezone")}s=5e3;j=function(e){var t,n,r,i,s,o,l,u,d,p,_,f,h,m,g,v,b,y,w;w=e.type,p=e.json_data,u=e.field_mapping,y=e.results,i=e.current_row,t=e.analyze_progress_div,n=e.analyze_results_cb,f=e.modify_mode;if(y==null){y=[]}if(i==null){i=0}d={};l={};r={};_={};for(o in u){d[o]=(h=u[o])!=null?h.field_name:void 0;l[o]=(m=u[o])!=null?(g=m.ret_btype)!=null?g.id():void 0:void 0;r[o]=(v=u[o])!=null?v.composite_field:void 0;_[o]=(b=u[o])!=null?b.list_delimiter:void 0}s=a().db_instance(c.appname(),c.app_version());k.run_once(120,(function(){var e,t;if(p.length>0){try{t=x.row_to_object({row:p[i],field_names:d,field_btypes:l,list_delimiters:_,composite_fields:r,db_instance:s,type:w,modify_mode:f});return{object:t}}catch(t){e=t;if(!(e instanceof x.ParseError)){throw e}return{error_message:e.message+". Please fix: this is row "+(i+1)+"."}}}}),(function(e,r){var s,o,a,l;l=r!=null?r:{},o=l.error_message,a=l.object;if(o!=null||e){if(e!=null){o=e.message}n({results:y,error_message:o});return}if(a==null){a={}}y.push(a);if(i===p.length){n({results:y})}else{t.text("Processed "+i+" records of "+p.length);s=function(){return j({type:w,json_data:p,field_mapping:u,results:y,current_row:i+1,analyze_progress_div:t,analyze_results_cb:n,modify_mode:f})};if(i%500===0){setTimeout(s,1)}else{s()}}}))};_.CSVUploader=k.singleton(i=function(){function e(){var e,t,n,r,i,u,_,v,b;this.canvas=k.div(["modal-popup","csv-uploader-window"],$(document.body));t=k.div("popup-content",this.canvas);this.canvas.on("vclick",function(e){return function(t){if(k.did_event_pass_through(t,".children")||k.is_on_mobile_or_tablet()){return true}e.hide();return true}}(this));t.append(this.create_header());e=k.div("children",t);this.sub_child=k.div("inner-children",e);u=k.div("panel",this.sub_child);i=k.div("",u);_=k.div("",u);this.current_upload_task=k.Box(null);this.currently_uploading=k.Box(null);this.instructions=k.div("instructions caption");this.type_node=d.Owner();this.type_node.on_change(function(e){return function(){return e.reset_data_options()}}(this));k.div("type-dropdown-caption",i,"Type of data");if(c.has_feature_enabled("reorg_component_selection")){b=new o.DropdownComposerInterface({owner:this.type_node,contents:f()})}else{b=g("Dropdown",this.type_node,{set:a().sets.get_set("CustomTypes")(true,false)})}b.get_canvas().addClass("bubble-ui");i.append(b.get_canvas());h.DocumentationPalette().add(b.get_canvas(),"Documentation.Interface.CSVUploader.type_to_create");this.delimiter_node=d.Owner();this.delimiter_node.on_change(function(e){return function(){return e.reset_data_options()}}(this));k.div("delimiter-dropdown-caption",i,"Data delimiter");n=g("Dropdown",this.delimiter_node,{default_value:"comma",set:a().sets.get_set("Object")(p.csv_separators),optional:false,dropdown_width_override:"short"});n.get_canvas().addClass("bubble-ui");i.append(n.get_canvas());h.DocumentationPalette().add(n.get_canvas(),"Documentation.Interface.CSVUploader.delimiter");this.pick_file_button=k.div("btn bubble-ui grey pick-csv-file",i,"Pick a file to upload");this.file_name=$('<span class="csv-file-name">No file chosen</span>');i.append(this.file_name);this.real_input=k.input("csv-file-input bubble-ui",i,"file");this.real_input.hide();this.pick_file_button.on("vclick",function(e){return function(){return e.real_input.click()}}(this));h.DocumentationPalette().add(this.pick_file_button,"Documentation.Interface.CSVUploader.pick_file_button");this.file_to_parse=null;this.real_input.on("change",function(e){return function(){e.reset_data_options();if(e.real_input[0].files.length!==0){e.file_to_parse=e.real_input[0].files[0];e.file_name.text(e.file_to_parse.name);if(e.type_node.get()){return e.populate_field_mapping_area()}}else{e.file_to_parse=null;return e.file_name.text("No file chosen")}}}(this));this.get_fields_button=k.div("btn get-fields",i,"Map fields");this.get_fields_button.on("vclick",function(e){return function(){return e.populate_field_mapping_area()}}(this));h.DocumentationPalette().add(this.get_fields_button,"Documentation.Interface.CSVUploader.get_fields");this.field_mapping_area=k.div("field-mapping-area",i);this.empty_count_box=k.div("empty-counts-box",i);k.div("type-dropdown-caption overwrite-empty",this.empty_count_box,"Overwrite data when the field value is empty");this.overwrite_with_empty=d.Owner();r=g("Checkbox",this.overwrite_with_empty,{});r.get_canvas().addClass("bubble-ui");this.empty_count_box.append(r.get_canvas());h.DocumentationPalette().add(this.empty_count_box,"Documentation.Interface.CSVUploader.overwrite_with_empty");this.analyze_data_btn=k.div("btn analyze-data",i,"Validate data");this.analyze_data_btn.on("vclick",function(e){return function(){if(e.analyze_data_btn.hasClass("clicked")){return}e.analyze_data_btn.addClass("clicked");return e.analyze_data()}}(this));this.analyze_data_btn.hide();h.DocumentationPalette().add(this.analyze_data_btn,"Documentation.Interface.CSVUploader.analyse_data");this.analysis_result=k.div("analysis-result",i);this.analysis_result.hide();this.upload_button=k.div("btn upload-data",i);this.upload_button.on("vclick",function(e){return function(){l.track("Data Action Done",{app:c.appname(),action_type:e.modify_mode?"Bulk modify":"Bulk upload"});m.maybe_increase_event_count(m.EVENTS.DATA_ACTION);if(e.upload_button.hasClass("clicked")){return}e.upload_button.addClass("clicked");e.analyze_data_btn.addClass("clicked");e.get_fields_button.addClass("clicked");e.field_mapping_area.hide();return e.upload_data()}}(this));this.upload_button.hide();h.DocumentationPalette().add(this.upload_button,"Documentation.Interface.CSVUploader.upload_button");this.upload_text=k.div("upload-text",_);this.upload_progress_bar=k.div("progresss-wrapper",_);this.report_upload_progress=A.get_bar(this.upload_progress_bar).report_progress;this.processing_wrapper=k.div("",_);this.processing_text=k.div("processing-text",this.processing_wrapper);this.processing_progress_bar=k.div("progress-wrapper",this.processing_wrapper);this.report_processing_progress=A.get_bar(this.processing_progress_bar).report_progress;this.processing_wrapper.hide();this.upload_status=k.div("upload-status",_);this.cancel_button=k.div("btn cancel-upload",_,"Cancel Upload");this.cancel_button.on("vclick",function(e){return function(){return e.cancel_current_task()}}(this));k.autorun(function(e){return function(){var t,n,r,o,a,l,c,u;n=e.current_upload_task();r=e.currently_uploading();if(n!=null||r!=null){if(r!=null||n.state==="fileupload"){e.upload_status.text("Uploading '"+(r!=null?r:n!=null?n.file_name:void 0)+"' (do not close)...");e.upload_text.text("Uploading file...");e.cancel_button.text("Cancel Upload");e.cancel_button.show();e.processing_wrapper.hide()}else{e.report_upload_progress(1,1);e.upload_text.text("Uploading file... Done!");e.processing_wrapper.show();if(n.state==="reading"){e.report_processing_progress(n.cursor,n.size);e.upload_status.text("Processing upload of '"+n.file_name+"' on server in background. Feel free to come back later.");a="Processing file...";if(n.cursor>0){o=n.current_timestamp-n.initial_timestamp;u=o*(n.size-n.cursor)/n.cursor;c=k.timestamp()-n.current_timestamp;u=Math.max(u-c,s);a+=" Remaining: ~"+k.print_date_interval(u)}e.processing_text.text(a);e.cancel_button.text("Cancel CSV Import");e.cancel_button.show()}else if(n.state==="done"){t=k.format_date(new Date(n.current_timestamp),"mmm d, yyyy h:MM tt");if(n.error!=null){e.report_processing_progress(0,1);e.processing_text.text("Processing file... error.");e.upload_status.text("Import of '"+n.file_name+"' failed on "+t+" with the following error:\n"+((l=n.error.translation)!=null?l:n.error.message))}else{e.report_processing_progress(1,1);e.processing_text.text("Processing file... Done!");e.upload_status.text("Import of '"+n.file_name+"' completed on "+t+"!")}e.cancel_button.hide()}}i.hide();return _.show()}else{i.show();return _.hide()}}}(this));this.list_current_uploads();v=function(){return u.css("max-height",$(window).height()-280)};$(window).resize(function(e){return function(){if(e._is_open){return v()}}}(this));v();this.sub_child.append(this.create_footer());$(document).off("keydown.escape-uploadcsv");$(document).on("keydown.escape-uploadcsv",function(e){return function(t){if(t.keyCode===27){e.hide()}}}(this))}e.prototype.cancel_current_task=function(){var e,t,n;e=(t=this.current_upload_task())!=null?t.file_id:void 0;if(e!=null){this.cancel_upload_task(e)}if((n=this.current_request)!=null){n.abort()}this.current_upload_task(null);this.poll_for_uploads();return this.reset_data_options()};e.prototype.reset_data_options=function(){this.field_mapping_area.empty();this.field_mapping_area.show();this.field_data={};this.analyze_data_btn.hide();this.upload_button.removeClass("clicked");this.analyze_data_btn.removeClass("clicked");this.get_fields_button.removeClass("clicked");this.analysis_result.hide();return this.upload_button.hide()};e.prototype.get_settings=function(){var e,t,n;n=this.type_node.get();e=(t=this.delimiter_node.get())!=null?t:"comma";e=e==="tab"?"\t":p.csv_separators[e];return{type:n,delimiter:e}};e.prototype.populate_field_mapping_area=function(e){var t,n,r,i,s;r=this.get_settings(),t=r.delimiter,i=r.type;s=this.modify_mode?"modify":"upload";if(!this.file_to_parse){this.show_message("Please choose a file to "+s+".",true);return}if(!i){this.show_message("Please choose the type of thing you are trying to "+s+".",true);return}n=function(t){return function(n,r){var s,o,l,c;e=n.meta.fields;t.field_data={};c=a().sets.get_set("CustomFields")({btype_name:i,writeable:true,add_email_field_for_user_type:i==="user",add_unique_id:t.modify_mode,add_pw:i==="user"&&!t.modify_mode});for(o=0,l=e.length;o<l;o++){s=e[o];if(s!==null&&s!==void 0&&s!==""){(function(e){var n,r,s,o,l,_;k.div("field-caption",t.field_mapping_area,e);t.field_data[e]={bubble_field:d.Owner()};t.field_data[e].bubble_field.on_change((function(n){var r,s,o,l,c;t.upload_button.hide();t.analysis_result.hide();c=u.get(i).get_message(n).ret_btype();if((s=t.field_data[e].composite_field_composer)!=null){s.get_canvas().remove()}if((o=t.field_data[e].list_delimiter_composer)!=null){o.get_canvas().remove()}delete t.field_data[e].composite_field_composer;delete t.field_data[e].list_delimiter_composer;if(c.custom_type()!=null||c.is_list()&&c.inner().custom_type()!=null){if(c.custom_type()){r=a().sets.get_set("CustomFields")({btype_name:c.id(),add_email_field_for_user_type:c.id()==="user",add_unique_id:true})}else{r=a().sets.get_set("CustomFields")({btype_name:c.inner().id(),add_email_field_for_user_type:c.inner().id()==="user",add_unique_id:true})}t.field_data[e].composite_field=d.Owner();t.field_data[e].composite_field_composer=g("Dropdown",t.field_data[e].composite_field,{set:r,placeholder:"Field to match...",on_change:function(){t.upload_button.hide();return t.analysis_result.hide()}});t.field_data[e].composite_field_composer.get_canvas().addClass("bubble-ui composer-field-picker");t.field_data[e].bubble_field_composer.get_canvas().after(t.field_data[e].composite_field_composer.get_canvas());h.DocumentationPalette().add(t.field_data[e].composite_field_composer.get_canvas(),"Documentation.Interface.CSVUploader.bubble_composite_field")}if(x.is_list(c)){t.field_data[e].list_delimiter=d.Owner();t.field_data[e].list_delimiter_composer=g("Dropdown",t.field_data[e].list_delimiter,{set:a().sets.get_set("Object")(p.csv_separators),dropdown_width_override:"short",on_change:function(){t.upload_button.hide();return t.analysis_result.hide()}});t.field_data[e].list_delimiter_composer.get_canvas().addClass("bubble-ui list-delimiter-field-picker");((l=t.field_data[e].composite_field_composer)!=null?l:t.field_data[e].bubble_field_composer).get_canvas().after(t.field_data[e].list_delimiter_composer.get_canvas());return h.DocumentationPalette().add(t.field_data[e].list_delimiter_composer.get_canvas(),"Documentation.Interface.CSVUploader.list_delimiter_composer")}}));t.field_data[e].bubble_field_composer=g("Dropdown",t.field_data[e].bubble_field,{set:c,optional:true,placeholder:"ignore this column"});t.field_data[e].bubble_field_composer.get_canvas().addClass("bubble-ui");t.field_mapping_area.append(t.field_data[e].bubble_field_composer.get_canvas());h.DocumentationPalette().add(t.field_data[e].bubble_field_composer.get_canvas(),"Documentation.Interface.CSVUploader.bubble_field");o=c.get_options();for(r=0,s=o.length;r<s;r++){l=o[r],_=l.value,n=l.display;if(!(e===n)){continue}t.field_data[e].bubble_field.set(_);break}})(s)}}return t.analyze_data_btn.show()}}(this);this.field_mapping_area.empty();this.upload_button.hide();this.analysis_result.hide();return w.parse(this.file_to_parse,{header:true,delimiter:t,preview:1,complete:n,skipEmptyLines:true})};e.prototype.analyze_data=function(){var e,t,n,r;this.upload_button.hide();this.upload_button.removeClass("clicked");this.analysis_result.show();this.analysis_result.text("Please wait...");n=this.get_settings(),t=n.delimiter,r=n.type;e=function(e){return function(t){var n,i,s,o,a,l,c,d,_,f,h,m,g,v,b;h=t.data;if(t.errors.length>0){c=function(){var e,n,r,i;r=t.errors;i=[];for(f=e=0,n=r.length;e<n;f=++e){l=r[f];if(f<20){i.push("<br>Row: "+l.row+" "+l.message)}}return i}();e.show_message("There was an issue parsing your data. Details: "+c.toString());return}e.field_mapping={};i=[];b=u.get(r);g=e.field_data;for(_ in g){a=g[_];d=a.bubble_field.get();if(d){if(O.call(i,d)>=0){e.show_message("The field "+b.custom_type().field(d).display()+" has been used twice. Please check your settings.");return}i.push(d);e.field_mapping[_]={field_name:d,ret_btype:b.get_message(d).ret_btype()};if(b.get_message(d).ret_btype().custom_type()!=null||b.get_message(d).ret_btype().is_list()&&b.get_message(d).ret_btype().inner().custom_type()!=null){o=a.composite_field.get();if(!o){e.show_message("The field "+b.custom_type().field(d).display()+" is a composite field. Please specify which field we should use to map the data.");return}e.field_mapping[_].composite_field=o}if(x.is_list(b.get_message(d).ret_btype())){m=a.list_delimiter.get();if(!m){e.show_message("The field "+b.custom_type().field(d).display()+" is a list. Please pick a delimiter.");return}e.field_mapping[_].list_delimiter=p.csv_separators[m]}}}if(r==="user"&&O.call(function(){var e,t;e=this.field_mapping;t=[];for(n in e){a=e[n];t.push(a.field_name)}return t}.call(e),"email")<0){e.show_message("You are trying to create some users, but haven't selected a field for the email. This is mandatory.");return}if(e.modify_mode&&(v=E.UNIQUE_ID,O.call(function(){var e,t;e=this.field_mapping;t=[];for(n in e){a=e[n];t.push(a.field_name)}return t}.call(e),v)<0)){e.show_message("You are trying to modify some existing data, but haven't selected a field for the Unique ID. This is mandatory.");return}s=function(t){var n,r;r=t.results,n=t.error_message;if(n!=null){e.analysis_result.text("There was an error analyzing your data: "+n)}else{e.rows=r;e.analysis_result.text("Your data set is ready for "+(e.modify_mode?"modification":"upload"));e.upload_button.show()}e.analysis_result.show();e.analyze_data_btn.removeClass("clicked")};e.field_array=t.meta.fields;e.analysis_result.show();j({type:r,json_data:h,field_mapping:e.field_mapping,analyze_progress_div:e.analysis_result,analyze_results_cb:s,modify_mode:e.modify_mode})}}(this);return w.parse(this.file_to_parse,{header:true,delimiter:t,preview:10,complete:e,skipEmptyLines:true})};e.prototype.show_message=function(e,t){window.MessagePanel({title:this.upload_mode?"Modify data":"Upload Data",message:e});if(!t){this.analyze_data_btn.removeClass("clicked");return this.analysis_result.hide()}};e.prototype.upload_data=function(){var e,t,n,r,i,s,o;n=this.get_settings(),e=n.delimiter,o=n.type;s=this.rows.length;r=this.file_to_parse.size;t=this.file_to_parse.name;this.currently_uploading(t);this.report_upload_progress(0,r);i=function(n){return function(s){if(s==null){s=10}return a().location.post("server://appeditor/schedule_csv_upload",{appname:c.app().appname(),app_version:c.app().app_version(),size:r,file_name:t,timezone_string:a().current_timezone()}).callback((function(l,u){var d,p,_,f,h,m;if(l!=null){if(s>0){return i(s-1)}else{n.currently_uploading(null);return window.alert(b.human_friendly(l))}}else{n.current_upload_task({state:"fileupload",file_name:t});n.currently_uploading(null);d=u.file_id;p=new FormData;f=u.fields;for(_ in f){h=f[_];p.append(_,h)}p.append("file",n.file_to_parse);m=new XMLHttpRequest;m.onload=function(){var i,s,u,p,_,f,h,g,v,y,w,x,j,A;if(m.status===204){n.report_upload_progress(r,r);n.current_upload_task({state:"reading",file_name:t,cursor:0,size:r});p=[];u=[];i=[];g=[];v=n.field_array;for(_=f=0,h=v.length;f<h;_=++f){s=v[_];p[_]=(y=n.field_mapping[s])!=null?y.field_name:void 0;u[_]=(w=n.field_mapping[s])!=null?(x=w.ret_btype)!=null?x.id():void 0:void 0;i[_]=(j=n.field_mapping[s])!=null?j.composite_field:void 0;g[_]=(A=n.field_mapping[s])!=null?A.list_delimiter:void 0}return a().location.post("server://appeditor/schedule_csv_upload",{appname:c.app().appname(),app_version:c.app().app_version(),delimiter:e,type:o,file_name:t,file_id:d,field_names:p,field_values:u,composite_fields:i,list_delimiters:g,size:r,modify_mode:n.modify_mode,overwrite_with_empty:n.overwrite_with_empty.get(),timezone_string:a().current_timezone()},(function(e,t){if(e!=null){window.alert(b.human_friendly(e));return n.cancel_upload_task(d)}}))}else{l=void 0;if(m.status>=400&&m.status<=499){if(m.responseText.indexOf("EntityTooLarge")!==-1){l=new k.UserError("FILE_TOO_LARGE")}}if(l==null){l=a().location.response_to_error(m)}window.alert(b.human_friendly(l));return n.current_upload_task(null)}};m.onerror=function(){l=a().location.response_to_error(m);window.alert(b.human_friendly(l));return n.current_upload_task(null)};m.upload.onprogress=function(e){if(e.lengthComputable){return n.report_upload_progress(e.loaded,r)}};m.open("POST",u.url,true);m.send(p);return n.current_request=m}}))}}(this);return i()};e.prototype.list_current_uploads=function(){return a().location.post("server://appeditor/list_csv_uploads",{appname:c.appname(),app_version:c.app_version()},function(e){return function(t,n){if(t){b.log(t)}return e.current_upload_task(n!=null?n[0]:void 0)}}(this))};e.prototype.poll_for_uploads=function(){clearInterval(this.list_upload_interval);return this.list_upload_interval=setInterval(function(e){return function(){return e.list_current_uploads()}}(this),s)};e.prototype.cancel_upload_task=function(e){return a().location.post("server://appeditor/cancel_csv_upload",{appname:c.appname(),app_version:c.app_version(),file_id:e},function(e){return function(t,n){if(t){b.log(t)}return e.current_upload_task(null)}}(this))};e.prototype.show=function(e,t){var n;this.modify_mode=e;this.final_cb=t;this._is_open=true;if(this.modify_mode!==this.passed_modify_mode){this.reset_data_options()}this.passed_modify_mode=this.modify_mode;n="Please export your data as a CSV file (comma separated values), with the columns label in the first row of the file.";if(this.modify_mode){this.header.text("Modify data through CSV - "+c.app_version()+" database");this.empty_count_box.show();this.instructions.text(n+" To modify data as CSV, you need one column to contain the ID of the thing you want to modify.");this.upload_button.text("Modify data")}else{this.header.text("Upload data as CSV - "+c.app_version()+" database");this.empty_count_box.hide();this.instructions.text(n);this.upload_button.text("Upload data")}$("body").css("overflow","hidden");k.velocity(this.canvas,"fadeIn",{duration:300});this.list_current_uploads();return this.poll_for_uploads()};e.prototype.hide=function(){this._is_open=false;k.velocity(this.canvas,"fadeOut",{duration:300,complete_cb:function(e){return function(){$("body").css("overflow","auto");return e.canvas.hide()}}(this)});return clearInterval(this.list_upload_interval)};e.prototype.create_header=function(){this.header=k.div("popup-title");return this.header};e.prototype.do_show_modified_footer=function(){var e;e=this.current_upload_task();return(e!=null?e.state:void 0)==="done"};e.prototype.create_footer=function(){var e,t,n;t=k.div("bottom-stripe");e=k.div("btn bubble-ui submit-button",t);e.on("vclick",function(e){return function(){if(e.do_show_modified_footer()){return e.cancel_current_task()}else{return e.hide()}}}(this));n=k.div(["btn","btn-cancel"],t,"Close");n.on("vclick",function(e){return function(){return e.hide()}}(this));k.autorun(function(t){return function(){if(t.do_show_modified_footer()){e.text("NEW UPLOAD");return n.show()}else{e.text("CLOSE");return n.hide()}}}(this));return t};return e}());_.CSVLanguageUploader=r=function(e){S(t,e);function t(){var e,t,n,r,i;this.canvas=k.div(["modal-popup","csv-uploader-window"],$(document.body));t=k.div("popup-content",this.canvas);this.canvas.on("vclick",function(e){return function(t){if(k.did_event_pass_through(t,".children")||k.is_on_mobile_or_tablet()){return true}e.hide();return true}}(this));t.append(this.create_header());e=k.div("children",t);this.sub_child=k.div("inner-children",e);r=k.div("panel",this.sub_child);this.instructions=k.div("instructions caption");this.delimiter_node=d.Owner();this.delimiter_node.on_change(function(e){return function(){return e.reset_data_options()}}(this));k.div("delimiter-dropdown-caption",r,"Data delimiter");n=g("Dropdown",this.delimiter_node,{default_value:"comma",set:a().sets.get_set("Object")(p.csv_separators),optional:false,dropdown_width_override:"short"});n.get_canvas().addClass("bubble-ui");r.append(n.get_canvas());h.DocumentationPalette().add(n.get_canvas(),"Documentation.Interface.CSVUploader.delimiter");this.pick_file_button=k.div("btn bubble-ui grey pick-csv-file",r,"Pick a file to upload");this.file_name=$('<span class="csv-file-name">No file chosen</span>');r.append(this.file_name);this.real_input=k.input("csv-file-input bubble-ui",r,"file");this.real_input.hide();this.pick_file_button.on("vclick",function(e){return function(){return e.real_input.click()}}(this));h.DocumentationPalette().add(this.pick_file_button,"Documentation.Interface.CSVUploader.pick_file_button");this.file_to_parse=null;this.real_input.on("change",function(e){return function(){e.reset_data_options();if(e.real_input[0].files.length!==0){e.file_to_parse=e.real_input[0].files[0];e.file_name.text("Chosen file: "+e.file_to_parse.name);return e.populate_field_mapping_area()}else{e.file_to_parse=null;return e.file_name.text("No file chosen")}}}(this));this.analyze_data_btn=k.div("btn analyze-data",r,"Validate data");this.analyze_data_btn.on("vclick",function(e){return function(){if(e.analyze_data_btn.hasClass("clicked")){return}e.analyze_data_btn.addClass("clicked");return e.analyze_data()}}(this));this.analyze_data_btn.hide();h.DocumentationPalette().add(this.analyze_data_btn,"Documentation.Interface.CSVUploader.analyse_data");this.analysis_result=k.div("analysis-result",r);this.analysis_result.hide();this.upload_button=k.div("btn upload-data",r);this.upload_button.on("vclick",function(e){return function(){l.track("Data Action Done",{app:c.appname(),action_type:e.modify_mode?"Bulk modify":"Bulk upload"});m.maybe_increase_event_count(m.EVENTS.DATA_ACTION);if(e.upload_button.hasClass("clicked")){return}e.upload_button.addClass("clicked");e.analyze_data_btn.addClass("clicked");return e.upload_data()}}(this));this.upload_button.hide();h.DocumentationPalette().add(this.upload_button,"Documentation.Interface.CSVUploader.upload_button");this.progress_bar=k.div("progress-wrapper",r);this.progress_bar.hide();i=function(){return r.css("max-height",$(window).height()-280)};$(window).resize(function(e){return function(){if(e._is_open){return i()}}}(this));i();this.sub_child.append(this.create_footer());$(document).off("keydown.escape-uploadcsv");$(document).on("keydown.escape-uploadcsv",function(e){return function(t){if(t.keyCode===27){e.hide()}}}(this))}t.prototype.reset_data_options=function(){this.analyze_data_btn.hide();this.upload_button.removeClass("clicked");this.analyze_data_btn.removeClass("clicked");this.analysis_result.hide();this.upload_button.hide();return this.progress_bar.hide()};t.prototype.get_settings=function(){var e,t;e=(t=this.delimiter_node.get())!=null?t:"comma";e=e==="tab"?"\t":p.csv_separators[e];return{delimiter:e}};t.prototype.populate_field_mapping_area=function(e){var t,n,r,i,s;r=this.get_settings(),t=r.delimiter,i=r.type;s=this.modify_mode?"modify":"upload";if(!this.file_to_parse){this.show_message("Please choose a file to "+s+".",true);return}n=function(e){return function(t,n){e.columns_header=t.meta.fields;return e.analyze_data_btn.show()}}(this);this.upload_button.hide();this.analysis_result.hide();this.progress_bar.hide();return w.parse(this.file_to_parse,{header:true,delimiter:t,preview:1,complete:n,skipEmptyLines:true})};t.prototype.analyze_data=function(){var e,t,n,r;this.upload_button.hide();this.upload_button.removeClass("clicked");this.progress_bar.hide();this.analysis_result.show();this.analysis_result.text("Please wait...");t=this.get_settings().delimiter;r=v.available_languages();n=v.get_language_data("english");e=function(e){return function(t){var r,i,s,o,a,l,c,u,d,p,_,f,h;u=t.data;if(t.errors.length>0){o=function(){var e,n,r,i;r=t.errors;i=[];for(l=e=0,n=r.length;e<n;l=++e){s=r[l];if(l<20){i.push("<br>Row: "+s.row+" "+s.message)}}return i}();e.show_message("There was an issue parsing your data. Details: "+o.toString());return}a={};r=[];for(c=0,d=u.length;c<d;c++){_=u[c];p=_.plugin_name,f=_.text_code,h=_.text_name;if(!f){e.show_message("The text_code field is missing");return}if(!p){e.show_message("The plugin_name field is missing");return}if(p==="USER_TEXTS"&&!h){e.show_message("The text_name field is missing");return}if(n[p]){i=n[p];if(!i[f]){e.show_message("The following text code is invalid: "+f);return}}else{if(!n[p]&&p!=="USER_TEXTS"){e.show_message("The plugin name is not recognized: "+p);return}}}e.rows=u;e.analysis_result.text("Your data set is ready for "+(e.modify_mode?"modification":"upload")+": "+e.rows.length+" elements");e.upload_button.show();e.analysis_result.show();return e.analyze_data_btn.removeClass("clicked")}}(this);return w.parse(this.file_to_parse,{header:true,delimiter:t,complete:e,skipEmptyLines:true})};t.prototype.upload_data=function(){var e,t,n,r,i,s;if(!this.rows||!this.rows.length){this.show_message("There is nothing to upload");return}r=A.get_bar(this.progress_bar).report_progress;this.progress_bar.show();i=this.rows.length;n=new Set;t=function(){var e;e=Array.from(n);if(e.length>0){return"\n\n"+e.length+" texts have been skipped because they did not exist in your app. Please make sure you only add texts that are already in your app. Skipped "+e.join(", ")}else{return""}};s=function(e){return function(s,o){var l,u,d,p,_,f,h,m,g,b,y,w,x,j,A,M,E,k,S,D;S=0;A=[];u={};l=v.available_languages();f=v.get_language_data("english");E=a().sets.get_set("AppTexts")();j=null;if(typeof window!=="undefined"&&window!==null?window.composer_revamp:void 0){j=E.all()}else{j=E.get_options()}d=function(){var e,t,n;n=[];for(e=0,t=j.length;e<t;e++){D=j[e];n.push(D.value)}return n}();for(g=0,w=l.length;g<w;g++){m=l[g];y=v.get_language_data(m);u[m]=y}h=function(e){var t;return(t=f[e])!=null?t:e==="USER_TEXTS"};p=function(e,t){var r,i,s,o,a,p,_,f,g,v;s=e.plugin_name,g=e.text_name,f=e.text_code;if(h(s)){for(r in e){v=e[r];if(r!=="plugin_name"&&r!=="text_code"&&r!=="text_name"){if(O.call(l,r)>=0){m=r;if(s==="USER_TEXTS"){_="text."+m+"."+s+"."+g;i=c.get_public_setting(_)}else{_="text."+m+"."+s+"."+f;i=(o=u[m])!=null?(a=o[s])!=null?(p=a[e[m]])!=null?p.trim():void 0:void 0:void 0}if(e[m]&&i!==e[m]){if(s==="USER_TEXTS"){if(O.call(d,g)>=0){c.set_setting(true,_,e[m])}else{n.add(g)}}else{c.set_setting(true,_,e[m])}}}}}}};_=function(){A[0]();return A=A.slice(1)};for(b=0,x=s.length;b<x;b++){M=s[b];p(M,o);S++;r(S,i)}k="Your data has been successfully uploaded to the "+c.app().app_version()+"  version of your app! "+t();return e.show_message(k)}}(this);e=function(e){return function(n){var r,i;if(e.modify_mode){i="modified"}else{i="uploaded"}if(n.length){e.show_message("The following entries could not be "+i+" "+JSON.stringify(n))}else{r="Your data has been successfully uploaded to the "+c.app().app_version()+"  version of your app! "+t();e.show_message(r)}return typeof e.final_cb==="function"?e.final_cb():void 0}}(this);return s(this.rows,e)};t.prototype.show=function(e,t){var n;this.modify_mode=e;this.final_cb=t;this._is_open=true;if(this.modify_mode!==this.passed_modify_mode){this.reset_data_options()}this.passed_modify_mode=this.modify_mode;n="Please export your data as a CSV file (comma separated values), with the columns label in the first row of the file.";this.header.text("Upload application texts from CSV");this.instructions.text(n);this.upload_button.text("Upload data");$("body").css("overflow","hidden");return k.velocity(this.canvas,"fadeIn",{duration:300})};t.prototype.hide=function(){this._is_open=false;return k.velocity(this.canvas,"fadeOut",{duration:300,complete_cb:function(e){return function(){$("body").css("overflow","auto");e.reset_data_options();return e.canvas.hide()}}(this)})};t.prototype.create_footer=function(){var e,t;t=k.div("bottom-stripe");e=k.div("btn bubble-ui submit-button",t,"CLOSE");e.on("vclick",function(e){return function(){e.hide();return e.reset_data_options()}}(this));return t};return t}(i);u=e("./../lang/btypes");d=e("./composer/legacy");p=e("./../core/core_actions/utilities/core_actions_consts");h=e("./documentationpalette");c=e("./../lang/appquery");A=e("./progressbar");v=e("./../languages")},{"../../vendor/jquery_plugins/moment.timezone.min.js":2353,"../client/analytics":20,"../constants/special_keys":87,"../lang/btypes_dropdowns":654,"./../core/core_actions/utilities/core_actions_consts":173,"./../lang/appquery":651,"./../lang/btypes":653,"./../languages":739,"./../lib":741,"./../logger":744,"./../parse_objects":755,"./../u":823,"./composer/compatibility/composers":532,"./composer/compatibility/solid_conversion/DropdownComposerInterface":535,"./composer/legacy":544,"./documentationpalette":565,"./progressbar":583,"./utils/editor_exposure":593,papaparse:2267}],562:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("pluralize");const s=e("../u");const o=e("../u/shared/uuid");const a=e("../u/shared/errors");s.edit_mode_only();const l=e("../db/hydrate");const c=e("../logger");const u=e("../constants/locations");const d=e("../shared/apps_utilities");const p=e("../shared/environment_utilities");const _=e("../constants/eval");const f=e("../constants/security");const h=e("../constants/special_keys");const m=e("../shared/data_panel");const g=e("../client/analytics");const v=e("../core/input_mask");const b=e("../shared/slug");const y=e("./scheduler_controls");const w=e("../geolocation/b_location");const x=e("../locations");const j=e("../constants/db");const A=e("../lang/btype_ids");const M=e("./utils/url_params");const E=e("../core/core_datasources/utilities/core_ds_editor_utilities");const k=e("./utils/editor_exposure");const O=e("./paywall/paywallpanel_sources");const{ignoreError:S}=e("../u/shared/callbacks");const D=e("./css");const{render:C}=e("solid-js/web");const{Breadcrumbs:T}=e("./components/design/breadcrumbs/Breadcrumbs");const N=e("lodash/isEqual");const{customTypes:P}=e("../lang/btypes_dropdowns");let I;if(!s.on_server()){I=e("../notifier/client")}else{I={watch:()=>{}}}const{AppSettingTopic:R}=e("../constants/notifier_topics");const{get_composer:L}=e("./composer/compatibility/composers");const z=5e3;const B="type_id";const q="view_id";let U=s.Box(null);const F=s.Box(null);let W="";function G(){var e,t;M.setParam(B,(e=U())==null?void 0:e.id());if(((t=F())==null?void 0:t.indexOf("default_view_"))===0){M.clearParam(q)}else{M.setParam(q,F())}}const V=s.autorun_cache({fn:()=>{const e={};Te.custom_types(undefined,undefined,true).forEach((t=>{const n=m.create_default_view(t);e[n.id]=n}));return e},compare_fn:N});function H(e){if(e==null){return null}if(Ie()!=null&&e in Ie()){return Ie()[e]}return V()[e]}function X(e){const t=H(e);if(!t){U(null);F(null)}else{U(Ee.get(t.type).custom_type());F(e)}G()}const Y=(e,t)=>{De.DocumentationPalette().add(e,t)};r.add_switch_button=function(e,t){var n;const r=x.get_db_version(Te.app_version());const i=r===u.LIVE_VERSION?"Switch to dev database":"Switch to live database";const o=(n="switch-db "+t)!=null?n:"";const a=s.div(o,e,i);a.on("vclick",(()=>{const e=r===u.TEST_VERSION?u.LIVE_VERSION:u.TEST_VERSION;g.track("Database Navigated",{app:Te.appname(),changed_to:e});window.change_to_version(e)}));Y(a,"Documentation.Interface.DatabaseViewer.switch_db")};const K=function(e){const t=s.div("copy-db",e,"Copy and restore database");if(!window.pancakes){t.addClass("margin-left-auto")}t.on("vclick",(()=>new be));Y(t,"Documentation.Interface.DatabaseViewer.copy_db")};let J=false;const Z={text:{column_type:"text"},image:{column_type:"image"},file:{column_type:"text"},boolean:{column_type:"text"},number:{column_type:"numeric"},geographic_address:{column_type:"text"},date:{column_type:"date"}};function Q(e,t,n){if(ke.use_app_credentials_in_editor){const r={appname:Te.appname(),app_version:Te.app_version(),path:["appeditor"]};return Ce().location.post(Ce().location.format_pieces(r)+"/"+e,t,n)}else{return Ce().location.post("server://appeditor/"+e,t,n)}}function ee(e){if(Ce().current_user_rights().permissions.data!=="can_edit"){window.MessagePanel({title:"Importing data",message:"You do not have permission to modify the application database."});return}e()}function te(e){if(Ce().current_user().get_email()===e){return true}return["can_edit","can_view"].includes(Ce().current_user_rights().permissions.data)}function ne(){return Ce().location.get_query().server_bulk_ops==="true"}r.activate=function(){s.autorun((()=>{const e=U();const t=H(F());if(e&&(t==null||t.type!==e.to_value())){X(m.create_default_view(e).id)}else if(t!=null){X(F())}}))};r.deactivate=function(){M.clearParam(B);M.clearParam(q)};const re=(e,t)=>{var n;const r=Ee.get(e==null?void 0:e.type);if(!r.custom_type().exists()||r.custom_type().deleted()){return false}return(e==null?void 0:e.display.toLowerCase().includes(t))||((n=r.display())!=null?n:"").toLowerCase().includes(t)};const ie=e=>e.type_id||A.custom_type_name(e.type);const se=e=>e?1:0;const oe=(e,t,n)=>{const r="en";const i=e.default_view?e:n[`default_view_${ie(e)}`];const s=t.default_view?t:n[`default_view_${ie(t)}`];const o=i.display;const a=s.display;const l={sensitivity:"accent"};return(o==null?void 0:o.localeCompare(a,r,l))||se(t.default_view)-se(e.default_view)||e.display.localeCompare(t.display,r,l)};const ae=(e,t)=>{const n=new Set(Object.values(e).filter((e=>re(e,t))).flatMap((e=>{var t;return[e.id,`default_view_${(t=e.type_id)!=null?t:A.custom_type_name(e.type)}`]})));return Object.values(e).filter((e=>n.has(e.id)))};const le=()=>{s.autorun((()=>{const e=M.getParam(B);const t=M.getParam(q);if(F()){return}if(t){X(t)}if(e&&F()==null){const t=Te.custom_type(e);if(t&&Ee.get(t.to_value(),{miss_okay:true}).id()!=="null"){X(m.create_default_view(t).id)}}}))};r.implement=function(e,t,n){U=n?n.currently_editing:undefined;r.activate();le();const i=s.div("data-tab-content");s.autorun((()=>{e.empty();if(d.is_local_editable(Te.appname())||!["can_edit","can_view","can_view_limited"].includes(Ce().current_user_rights().permissions.data)){e.empty();s.div("message",e,"You can't access the App Data tab for this application.")}else{e.append(i)}}));const o=s.div("display-flex",i);const u=s.div("section-title views",o);if(!window.pancakes){s.div("data-section-main-title-caption",s.div("",u),"App data")}else{const e=s.div("h2",s.div("padding-top-10",u));s.autorun((()=>{const t=Te.app_version();const n=x.get_db_display(t);e.text(n)}))}const v=s.div("section-title data",o);if(window.pancakes){v.addClass("display-flex padding-top-15 padding-bottom-10")}const b=s.div(window.pancakes?"breadcrumbs-container":"data-section-right-title-caption",v);const w=s.div("display-flex margin-left-auto",v);K(w);r.add_switch_button(w);const j=s.div("display-flex",i);const M=s.div("display-flex left-pane-controls",j);const E=s.div("btn bubble-ui light create-view",M,"New view");E.on("vclick",(()=>new _e(undefined,(e=>ot(e,e.id)))));Y(E,"Documentation.Interface.DatabaseViewer.create_view");const N=s.div("btn bubble-ui light primary-fields",M,"Primary fields");N.on("vclick",(()=>ge((()=>bt()))));Y(N,"Documentation.Interface.DatabaseViewer.ShowPrimaryFieldPopup");const P=s.div("display-flex width-fill right-pane-controls-container",j);const I=s.div("display-flex width-fill space-between right-pane-controls-bar",P);const R=s.div("",I);s.div("quick-search-caption",R,"Search");const B=s.input("bubble-ui quick-search-bar",R);B.attr("placeholder","Data entries");Y(B,"Documentation.Interface.DatabaseViewer.quick_search");const q=s.div("entries-count",R);q.hide();y.sync_from_server();const G={json:"to JSON",csv:"to CSV",ndjson:"to Newline-Delimited JSON (NDJSON)"};const re=Ce().composer.Owner("csv");const se=s.Box([]);let de=null;function fe(e){let{options:t,selected_option_handle:n}=e;const r=L("Dropdown",n,{set:Ce().sets.get_set("Object")(t),optional:false,dropdown_width_override:"extra_extra_large"});const i=r.get_canvas();i.addClass("bubble-ui field");return i}function ve(e){let{format:t,view:n}=e;Se.set_general_message("Starting the export...");return Ce().location.post("server://appeditor/schedule_data_export",{appname:Te.appname(),app_version:Te.app_version(),view_id:n.id,export_format:t,timezone_string:Ce().current_timezone()},(e=>{Se.hide_general_message();if(e){var t;c.log(e);window.MessagePanel({title:"Error scheduling export",message:`${e==null?void 0:e.message}:\n\n${e==null?void 0:(t=e.args)==null?void 0:t.code}\n\nPlease try again later.`});return}return window.MessagePanel({title:"Success",message:"Hang on tight, you will receive an e-mail containing a link to your data export"})}))}const be=e=>{let{filename:t,task_div:n}=e;return Ce().location.post("server://appeditor/cancel_data_export",{appname:Te.appname(),app_version:Te.app_version(),filename:t},((e,t)=>{if(e){c.log(e);return}if(t.success){return n.remove()}}))};const ye=()=>Ce().location.post("server://appeditor/list_data_exports",{appname:Te.appname(),app_version:Te.app_version()},((e,t)=>{if(e){c.log(e)}return se(t)}));function xe(e){let{current_export_tasks:t,canvas:n}=e;n.empty();t.forEach((e=>{const t=s.div("current-task-row light-button",n);s.div("export-row-filename",t,e.filename);const r=e.error?"Export failed. Dismiss":"cancel";const i=s.div("export-row-cancel light-button",t,r);s.div("export-row-progress",t,ke(e));return i.on("vclick",(()=>{i.addClass("disabled");i.text("cancelling...");be({filename:e.filename,task_div:t})}))}))}function ke(e){let{cursor:t,total_length:n,error:r}=e;if(r!=null){return"ERROR"}if(!n){return"0%"}if(t>n){return"100%"}return`${t}/${n} (${(t/n*100).toFixed(0)}%)`}const Oe=e=>({title:"Exporting data",cancel_caption:"Close",confirm_caption:"START EXPORT",build(t){s.div("instruction",t,`How do you want to export the current view, "${e.display}"?`);t.append(fe({selected_option_handle:re,options:G}));const n=s.div("instruction",t);const r=s.div("instruction",t);const i=s.div("instruction list-running-tasks",t);s.autorun((()=>{const e="You will receive an email with a link to the CSV when it's ready. Note that large datasets can take a significant amount of time to complete";n.text(e);const t=se().length>0?"Currently running export tasks:":"No currently running tasks";r.text(t);return xe({canvas:i,current_export_tasks:se()})}))},cb_yes(){const t=re.get();g.track("Data Action Done",{app:Te.appname(),action_type:"Bulk export",format:t});k.maybe_increase_event_count(k.EVENTS.DATA_ACTION);clearInterval(de);Se.show_general_message_immediate(`Exporting ${e.display} ${G[t]}`);return ve({format:t,view:e})},cb_no(){return clearInterval(de)}});const De=s.Box(null);s.autorun((()=>De(me())));const Ne=e=>{const t=s.div("btn bubble-ui light create-entry",e,"New entry");t.on("vclick",(()=>{ee((()=>{var e;return new ue(undefined,{preset_type:(e=H(F()))==null?void 0:e.type,force_refresh:bt,email_confirm_condition:De},true)}))}));Y(t,"Documentation.Interface.DatabaseViewer.CreateEntry")};const Le=e=>{const t=s.div("btn bubble-ui light delete-entry disabled",e,"Delete (0)");t.on("vclick",(()=>ee((()=>{const e=Object.values(mt).filter((e=>{var t,n;return(t=(n=e.box).get)==null?void 0:t.call(n)})).length;if(!e){return}const t=[];for(const e in mt){var n,r;const i=mt[e];if((n=(r=i.box).get)!=null&&n.call(r)){t.push(l.dehydrate_tree(i.entry))}}return window.ConfirmPanel({title:"Delete entries",message:"Are you sure you want to delete "+e+" "+Ee.get(H(F()).type).custom_type().display()+(e>1?"s":""),cb_yes(){const e={appname:Te.app().appname(),app_version:Te.app().app_version(),things:t};Se.show_general_message("Please wait, the entries are being deleted...");return Q("delete_thing",e).callback((n=>{Se.hide_general_message();if(n){window.MessagePanel({title:"Deleting an entry",message:"There was an issue deleting the entries / "+n})}else{var r;g.track("Data Action Done",{app:Te.appname(),action_type:"Delete",data_type:H(F()).type,number_things_deleted:(r=e.things)==null?void 0:r.length});k.maybe_increase_event_count(k.EVENTS.DATA_ACTION);window.MessagePanel({title:"Deleting an entry",message:"The entries was successfully deleted",offer_hide_next:true});bt();t.forEach((e=>{if(mt[e]){var t;mt[e].box.set(false);(t=mt[e].div)==null?void 0:t.remove();delete mt[e]}}))}}))}})}))));return t};const ze=e=>{const t=s.div("btn upload-csv bubble-ui light",e,"Upload");t.on("vclick",(()=>ee((()=>Re.show_popup_to_upgrade({title:"Importing data",feature_id:"import_export_csv",source:O.APP_DATA_UPLOAD,cb_yes(){return we({action_name:"upload",on_close(){return je.CSVUploader().show()}})}})))));Y(t,"Documentation.Interface.DatabaseViewer.ImportCSV")};const Be=e=>{const t=s.div("btn upload-csv bubble-ui light",e,"Modify");t.on("vclick",(()=>ee((()=>Re.show_popup_to_upgrade({title:"Importing data",feature_id:"import_export_csv",source:O.APP_DATA_MODIFY,cb_yes(){return we({action_name:"import",on_close(){return je.CSVUploader().show(true,(()=>Ot()))}})}})))));Y(t,"Documentation.Interface.DatabaseViewer.ModifyCSV")};const qe=e=>{const t=s.div("btn export-csv bubble-ui light",e,"Export");t.on("vclick",(()=>{ye();de=setInterval(ye,z);return Re.show_popup_to_upgrade({title:"Exporting data",feature_id:"import_export_csv",source:O.APP_DATA_EXPORT,cb_yes(){return we({action_name:"export",on_close(){const e=H(F());return window.ConfirmPanel(Oe(e,se))}})}})}));Y(t,"Documentation.Interface.DatabaseViewer.ExportCSV");return t};const Ue=e=>{const t=s.div("btn bulk-action bubble-ui light",e,"Bulk");t.on("vclick",(()=>ee((()=>Re.show_popup_to_upgrade({title:"Bulk Operations",feature_id:"bulk",source:O.APP_DATA_BULK,cb_yes(){if(ne()){return we({action_name:"bulk operation",on_close(){const e=[];for(const r in mt){var t,n;const i=mt[r];if((t=(n=i.box).get)!=null&&t.call(n)){e.push(l.rehydrate_tree(Ce().db_instance(Te.appname(),Te.app_version()),i.entry))}}return Ae.BulkOperationBox().show(H(F()),dt(),e)}})}else{const n=[];for(const r in mt){var e,t;const i=mt[r];if((e=(t=i.box).get)!=null&&e.call(t)){n.push(l.rehydrate_tree(Ce().db_instance(Te.appname(),Te.app_version()),i.entry))}}return Ae.BulkOperationBox().show(H(F()),dt(),n)}}})))));Y(t,"Documentation.Interface.DatabaseViewer.BulkAction")};const Fe=s.div("display-flex",I);Ne(Fe);const We=Le(Fe);ze(Fe);Be(Fe);const $e=qe(Fe);Ue(Fe);const Ge=s.div("light-button hidden-fields",i);const Ve=s.div("custom-type-search views-list",i);s.text("",Ve,"Search");const He=s.input("custom-type-search bubble-ui",Ve);He.attr("placeholder","Views or data types");He.val(W);const Xe=s.Box(W);He.keyup((e=>{const t=e.target.value.toLowerCase();Xe(t);W=t}));const Ye=s.div("views-list padding-bottom-20",i);const Ke=s.div("data-base-view",i);const Je=s.div("excel-table fs-mask",Ke);const Ze=s.div("no-view-mention",Ke,"No view is selected. Pick a view on the left to see and modify data.");const Qe=s.div("light-button refresh",i,"Refresh data");const et=s.div("light-button load-more",i);const tt=s.Box(10);const nt=s.Box(null);const rt=()=>$(window).height()-305;const it=new Handsontable(Je[0],{autoColumnSize:false,autoRowSize:false,columnSorting:true,sortIndicator:true,manualColumnResize:true,manualColumnMove:true,autoWrapRow:true,readOnly:true,rowHeights:20,width:$(window).width()-410,viewportRowRenderingOffset:10});function st(){const e=$(window).width();const t=$(window).height();Ye.css("height",t-305);Ke.css("height",rt());B.css("width",e-1154);s.autorun_top((()=>{if((tt==null?void 0:tt())<Math.floor(rt()/20+1)){return tt(Math.floor(rt()/20+1))}}));return it==null?void 0:it.updateSettings({height:rt()})}$(window).on("resize",(()=>st()));st();function ot(e,t){var n;X(e==null?void 0:e.id);const r=s.json_deep_copy((n=Ie())!=null?n:{});if(e!=null){if(e.id.indexOf("default_view_")===0){e.id=s.UUID()}r[e.id]=e}else{X(null);delete r[t]}Ie(r);X(e==null?void 0:e.id);B.val("");nt("")}const at=e=>{const t=s.div("bubble-ui delete-btn");t.on("vclick",(()=>window.ConfirmPanel({title:"Delete view",message:"Delete view "+e.display+"?",cb_yes(){g.track("Data Views Changed",{app:Te.appname(),data_type:e.display,edit_type:"Delete"});return ot(null,e.id)}})));return t};const lt=e=>{const t=s.div("action-wrapper flex-row");const n=e.default_view;if(!n){t.addClass("visible-on-select");t.append(at(e))}const r=s.div("bubble-ui copy-btn",t);r.on("vclick",(t=>{t.stopPropagation();return new _e(e,(e=>ot(e,e.id)),true)}));const i=s.div("bubble-ui modify-btn",t);i.on("vclick",(()=>new _e(e,(e=>ot(e,e.id)))));return t};const ct=(e,t)=>{const n=s.div("type-info-row flex-row space-between");s.div("table-size-container subhead2",n,"");const r=Te.custom_type(e.type_id).json.raw().privacy_role;const i=s.div("privacy-rule-container cursor-pointer subhead2",n,r?"Privacy rules applied":"Publicly visible");i.on("vclick",(()=>{$(D.PRIVACY_SUBTAB).click()}));return n};const ut=(e,t)=>{const n=e.default_view;const r=s.div("nested-view-box padding-right-10 padding-left-10",t);n?window.pancakes?r.addClass("default-view flex-column padding-top-10 margin-top-5 margin-bottom-5"):r.addClass("default-view suspension-vertical margin-top-5 margin-bottom-5"):r.addClass("custom-view margin-left-auto suspension-vertical");const i=s.div("flex-row space-between",r);r.on("vclick",(()=>{X(e.id)}));s.div("nested-view-title subhead1",i,e.display);i.append(lt(e));if(window.pancakes&&n){r.attr("height","60px");r.append(ct(e))}return r};function dt(){const e=H(F());if(e!=null&&e.default_view&&!Te.custom_type(e.type_id).exists()){X(null)}return m.resolve_search_from_view({view_data:e,quick_search_content:nt()})}const pt=s.Watcher((()=>{if(dt()!=null){return dt().length()}}));s.autorun((()=>{var e;const t=H(F());b.empty();if(window.pancakes){if(t){const e=t.default_view;const n=[];if(!e){const e=ie(t);const r=H("default_view_"+e);const i=function(){X("default_view_"+e)};n.push({label:r.display,onClick:i})}const r=t.display;n.push({label:r});C((()=>T({items:n})),b[0])}else{C((()=>T({items:[{label:"Application data"}]})),b[0])}}else{if(t){b.text("Application data - "+t.display+" - "+x.get_db_display(Te.app_version())+" version")}else{b.text("Application data")}}return $e.toggleClass("disabled",!(t&&((e=dt())==null?void 0:e.length())>0))}));let _t=[];s.autorun((()=>{var e;const t=s.json_deep_copy((e=Ie())!=null?e:{});for(const e in t){const n=t[e];if(n!=null){delete n.default_view}}const n=V();Object.assign(t,n);Ye.empty();_t=[];const r=ae(t,Xe());const i=r.sort(((e,t)=>oe(e,t,n)));i.forEach((e=>{_t.push({div:ut(e,Ye),view_id:e.id})}));const o=H(F());if(!o){return}_t.forEach((e=>{let{div:t,view_id:n}=e;if(n===o.id){t.addClass("selected")}else{t.removeClass("selected")}}))}));const ft=s.Box(false);const ht=()=>ft(!ft());let mt={_all:{box:false}};function gt(e){for(const n in mt){if(n!=="_all"){var t;(t=mt[n])==null?void 0:t.box.set(e)}}}const vt=s.Box(false);const bt=()=>vt(!vt());let yt=false;let wt=0;function xt(){var e;const t=Array(3).fill([]);it.updateSettings({data:t});for(const e in mt){var n;const{div:t,box:r}=mt[e];t==null?void 0:t.remove();r==null?void 0:(n=r.set)==null?void 0:n.call(r,false)}q.text("");et.hide();Qe.hide();mt={_all:{box:false}};s.autorun_top((()=>tt(Math.max(Math.floor(rt()/20+11),50))));wt=0;return(e=Mt)==null?void 0:e()}function jt(){it.updateSettings({columnSorting:{column:0},sortOrder:false});return it.updateSettings({columnSorting:false})}const At="data-admin-progress";let Mt=null;let Et;let kt=Et=false;s.autorun((()=>{var e;if(!kt){kt=true;xt()}const n=H(F());if(!n){q.hide();Je.hide();Ze.show();return}Je.show();Ze.hide();const r=Ee.get(n.type).custom_type();const i=n.fields_to_show.filter((e=>r.field(e).exists()||f.BUILTIN_FIELDS.includes(e)||e==="_id"));let o=s.sort_data_fields(i.map((e=>({value:e,display:r.field(e).display()})))).map((e=>e.value));const u=pe(r).length-n.fields_to_show.filter((e=>e.length>0)).length;Ge.text(ce(u));if(u>0){Ge.show()}else{Ge.hide()}const d=[""];const g=[{data:"selected",renderer(e,t,n,r,i,o,a){var c,u;if(t.done){if(!o){if(t.done==="empty"){return t}else{Handsontable.Dom.empty(t);t.done="empty";return t}}else if(t.done===o&&t.getElementsByClassName("cell-btn-wrapper").length){return t}}const d=s.div("cell-btn-wrapper");if(!o){t.appendChild(d[0]);t.done="empty";return t}(u=(c=mt)[o])!=null?u:c[o]={box:Me.Owner(),entry:o};const p=L("Checkbox",mt[o].box,{});p.get_canvas().addClass("bubble-ui selectbox");Handsontable.Dom.empty(t);d.append(p.get_canvas());ht();t.done=o;const _=s.div("bubble-ui modify-btn",d);_.on("vclick",(()=>s.run_once(30,(()=>{const e=l.rehydrate_tree(Ce().db_instance(Te.appname(),Te.app_version()),o);e.raw();return e}),S((e=>new ue(e,{value:o,force_refresh:bt,email_confirm_condition:De},false))))));t.appendChild(d[0]);return t}}];if(n.type==="user"){g.push({data:"run_as",renderer(e,t,n,r,i,o,a){if(!o){Handsontable.Dom.empty(t);t.value=null;return}if(t.value===o){return}return s.run_once(30,(()=>{const e=Ce().db_instance(Te.appname(),Te.app_version()).get(o);return e.child("authentication").child("email").child("email").get()}),S((e=>{if(!te(e)){return}Handsontable.Dom.empty(t);t.value=o;const n=s.div("run-as-btn",undefined,"Run as ");t.appendChild(n[0]);return n.on("vclick",(()=>s.run_once(30,(()=>({should_do:p.is_production(),page:Ce().visual_edit.get_root().type()==="Page"?Ce().visual_edit.get_root().name():"index"})),((e,t)=>{var n;if(e){c.log(e);return}let{should_do:r,page:i}=t;(n=r)!=null?n:r=false;const s=Ce().location.get_base_for_meta()+"/appeditor/authenticate_as/"+Te.appname()+"/"+Te.app_version()+"/"+o+"/"+r+"/"+i;window.open(s,"preview_tab");return window.focus()}))))})))}});d.push("")}const v=he(n.type);if(v&&v!=="_id"&&(o||[]).includes(v)){const e=s.json_deep_copy(o);s.array_remove(e,v);o=[v].concat(e);if((n.type==null||n.type==="user")&&De()){o=o.concat(["email_confirmed"]);n.fields_to_show.push("email_confirmed")}}const b={checkbox:55,run_as_user:63,email:180,date:140,uuid:240,number:100,address:200,image:40,text:60,email_confirmed:100};const y={0:b.checkbox};const{widths:w,offset:x}=n.type==="user"?{offset:2,widths:{...y,1:b.run_as_user}}:{offset:1,widths:y};const j=(e=o)!=null?e:[];j.forEach(((e,t)=>{var i,o;let a,l;if(n.type==="user"&&e==="email"){a="Email";l="text";w[t+x]=b.email}else if(["Created Date","Modified Date","Created By","Slug"].concat(f.USER_FIELDS.map((e=>e.value))).includes(e)){a=e;l=["Created Date","Modified Date"].includes(e)?"date":"text";w[t+x]=b.date}else if(e==="email_confirmed"){a="Email Confirmed";l="boolean";w[t+x]=b.email_confirmed}else if(e===h.UNIQUE_ID){a="Unique id";l="text";w[t+x]=b.uuid}else{a=r.field(e).display();l=r.field(e).value();if(l==="number"){w[t+x]=b.number}else if(l==="geographic_address"){w[t+x]=b.address}}a=s.escape(a);if(r.field(e).value()&&A.is_custom_type(r.field(e).value())||e==="Created By"){a+='<div class="show-primary-field-btn"></div>'}d.push(a);const c={data:e,type:(i=(o=Z[l])==null?void 0:o.column_type)!=null?i:"text"};if(["image",A.list_type("image")].includes(l)){delete c.type;c.renderer=function(e,t,n,r,i,o,a){var c;if(l==="image"){o=[o]}else if(o){o=o.split(", ")}const u=o||[];o=u.map((e=>m.optimize_image(e==null?void 0:e.trim(),undefined,40)));if(s.json_stringify(t.done)===s.json_stringify(o)){return}t.done=o;Handsontable.Dom.empty(t);if((c=o)!=null&&c.length){o.forEach((e=>{if(e!=null){const n=document.createElement("IMG");n.src=e;n.height=15;n.style["margin-top"]="4px";n.style["margin-right"]="2px";Handsontable.Dom.addEvent(n,"mousedown",(e=>e.preventDefault()));t.appendChild(n)}}))}return t};w[t+x]=b.image}if(["date","numeric"].includes(c.type)){c.validator=(e,t)=>t(true)}if(c.type==="numeric"){c.format="0,00.[00]"}g.push(c)}));function M(e){if(e===0){if(mt._all.box){return'<div class="composer-checkbox bubble-ui selectbox header"><div class="component-checkbox property-editor-control checked"></div></div>'}else{return'<div class="composer-checkbox bubble-ui selectbox header"><div class="component-checkbox property-editor-control"></div></div>'}}else if(e===1&&n.type==="user"){return""}else{return d[e]}}const E=$(window).width();const k=1+Object.keys(o).length;const O=410;function D(e){if(w[e]){return w[e]}else{const e=E-O-k-Object.values(w).reduce(((e,t)=>e+t),0);return Math.max(e/(g.length-Object.values(w).length),b.text)}}it.updateSettings({colHeaders:M,columns:g,colWidths:D});return s.autorun((()=>{nt();if(!kt){kt=true;xt()}return s.autorun((()=>{if(t.currently_open()!=="App Data"){return}vt();pt.get();const e=dt();if(!e){return}return s.autorun((()=>{if(!Et){Et=true;jt()}Mt=Se.show_NProgres_edit_mode(Ke,At);function t(e){var t,r,i;if(!J&&JSON.stringify(e.raw()).length>10*1024*1024){J=true;window.MessagePanel({title:"Large Data Item",message:"Some items in your database exceed 10MB. This can slow down your application considerably. You should save this information as a file."})}const s=m.get_printable_object({entry:e,view_data:n,only_text:true,primary_fields:Pe()});for(const e in s){const t=s[e];if(typeof t==="number"&&String(t).indexOf("e")!==-1){s[e]=String(t)+" (e)"}}s.selected=l.dehydrate_tree(e);if(n.type==="user"){s.run_as=e._id()}(i=(t=mt)[r=s.selected])!=null?i:t[r]={box:Me.Owner(),entry:s.selected};return s}return s.run_once(10*60*1e3,(()=>{const n=F();const r=e.get_children(0,tt());const i=Ce().db_instance(Te.appname(),Te.app_version());e.length();function s(e){if(typeof e==="string"){if(e.indexOf(_.HYDRATE_STRING)!==-1){const t=e.replace(_.HYDRATE_STRING,"");return i.get(t).precache()}}}r.forEach((e=>{i.get(e.id).precache();const t=e.raw();for(const e in t){const n=t[e];if(Array.isArray(n)){n.forEach((e=>{s(e)}))}else{s(n)}}}));const o=[];r.forEach((e=>{o.push(t(e))}));const a={};o.forEach((e=>{a[e.selected]=true}));for(const e in mt){const t=mt[e];const n=t.entry;if(n&&!a[n]){delete mt[e]}}return{previous_view_id:n,data:o}})).callback(((t,n)=>{var r;if(t){var i;const e="Please try again in a few minutes...";$(".modal-popup.message-panel-popup").remove();window.MessagePanel({title:"Retrieving Data",message:`There was an issue retrieving your data.\n${a.to_owner_display(t,e)}`});(i=Mt)==null?void 0:i();return}const{previous_view_id:o,data:l}=n;if(!l.length&&kt){var c;(c=Mt)==null?void 0:c();return}if(o!==F()){var u;(u=Mt)==null?void 0:u();return}it.updateSettings({data:l});wt=l.length;s.autorun((()=>{var e;ft();const t=Object.values((e=mt)!=null?e:{}).filter((e=>{var t,n;return(t=(n=e.box).get)==null?void 0:t.call(n)})).length;We.text("Delete ("+t+")");if(t===0){return We.addClass("disabled")}else{return We.removeClass("disabled")}}));q.text(s.add_thousand_sep(e.length())+" entries \n(displaying "+s.add_thousand_sep(wt)+")");q.show();(r=Mt)==null?void 0:r();kt=false;Et=false;yt=false;et.text("Load 50 more items...");et.removeClass("disabled");et.show();Qe.show();return it.updateSettings({columnSorting:true})}))}))}))}))}));function Ot(){Ce().db_instance(Te.appname(),Te.app_version()).flush_all();bt()}Qe.on("vclick",(()=>Ot()));Ge.on("vclick",(()=>new _e(H(F()),(e=>ot(e,e.id)))));et.on("vclick",(()=>{if(yt){return}yt=true;setTimeout((()=>{et.text("Loading more items...");et.addClass("disabled");Mt=Se.show_NProgres_edit_mode(Ke,At);function e(){et.text("Load 50 more items...");bt();yt=false}s.run_once(120,(()=>{var e;return(e=dt().get_children(0,tt()+50))!=null?e:[]}),((t,n)=>{var r;(r=Mt)==null?void 0:r();if(t){c.log(t);et.text("There was an issue... Please try again in a few seconds");setTimeout(e,3e3)}else if(n.length===wt){return et.text("No more items")}else{tt(n.length);e()}}))}),1)}));Handsontable.hooks.add("beforeOnCellMouseDown",((e,t,n)=>{if(t.row<0){e.stopImmediatePropagation();const t=$(e.realTarget);if(t.hasClass("component-checkbox")){if(t.hasClass("checked")){gt(false);mt._all.box=false;t.removeClass("checked")}else{gt(true);mt._all.box=true;t.addClass("checked")}}else if(t.hasClass("show-primary-field-btn")){ge((()=>bt()))}}if(t.col<=0){e.stopImmediatePropagation()}if(n.textContent==="Run as "){return e.stopImmediatePropagation()}}),it);r.init_search=e=>s.autorun((()=>{const t=e._type();const n=t.split(".")[1];const r=Te.custom_types(undefined,undefined,true).to_array();const i=r.find((e=>{if(n===e.json.__name){return true}else{return false}}));if(!i){return}const s=m.create_default_view(i);X(s);B.val(e.id);nt(B.val())}));B.on("change",(()=>{if(H(F())){nt(B.val())}}))};function ce(e){return`${e} additional ${i("field")}`}class ue{constructor(e,t,n){var r,i,o,a,c;this.data=e;this.create=n;const u=this.data?"Modify an existing database entry":"Create a new database entry";const d=new xe.ModalPopup(u,true);const p=d.get_canvas();p.addClass("modify-db-entry");const _=d.children_div;const h=s.div("panel",_);this.type_node=Me.Owner((r=(i=this.data)==null?void 0:(o=i._type)==null?void 0:o.call(i))!=null?r:t==null?void 0:t.preset_type);s.div("type-dropdown caption",h,"Type of thing");let v;if(Te.has_feature_enabled("reorg_component_selection")){v=new Le({owner:this.type_node,contents:P().with_options({dropdown_width:"mid_extra_large"})})}else{v=L("Dropdown",this.type_node,{set:Ce().sets.get_set("CustomTypes")(true,false),dropdown_width_override:"mid_extra_large"})}v.get_canvas().addClass("bubble-ui field");h.append(v.get_canvas());if((a=this.data)!=null&&(c=a._type)!=null&&c.call(a)){v.disable()}else{this.type_node.on_change((()=>{this.field_nodes={}}))}this.field_nodes={};const y=s.div("field-list",h);s.autorun((()=>{const e=this.type_node.get();if(!e){y.hide();return}y.show();const n=Ee.get(e);let r=n.custom_type().writeable_fields();r=s.sort_data_fields(r);if(e==="user"){r.push({value:"email",display:"Email"})}if(this.data){r.push(...f.DATE_FIELDS||[]);if(e!=="user"){r.push(...f.CREATOR_FIELD||[])}else{if(Te.get_public_setting("twofa_auth")){r.push({display:"Two-factor auth",value:"uses_2fa"})}}}r.push({display:"Slug",value:"Slug"});if(e==null&&e==="user"&&t.email_confirm_condition()){r.push({value:"email_confirmed",display:"Email Confirmed"})}y.empty();r.forEach((e=>{const t=n.get_message(e.value);let{composer_type:r,set:i,placeholder:o}=de(t.ret_btype().id(),e.value);if(r==="TextBox"&&this.type_node.get()!=="user"&&t.name()!=="email"&&t.name()!=="Slug"){r="MultilineTextBox"}const a=s.div("field-zone",y);const c=s.div("field-caption",a,s.FirstLetterCapitalize(e.display));c.attr("title",e.display);this.field_nodes[e.value]={};if(r&&r!=="no-composer"){let n;const c=t.evaluate(this.data);if(r!=="ListManager"){this.field_nodes[e.value].node=Me.Owner(l.dehydrate_tree(c))}else{if(c){this.field_nodes[e.value].node=Me.Owner(c.all())}else{this.field_nodes[e.value].node=Me.Owner(null)}}if(r==="ListManager"){const e=A.list_element_type(t.ret_btype().id());n=de(e)}const u=L(r,this.field_nodes[e.value].node,{set:i,inner_composer:n,placeholder:o,with_time:true,rows:r==="MultilineTextBox"?1:undefined});if(this.type_node.get()==="user"&&t.name()==="uses_2fa"){if([false,"false"].includes(c)){u.disable()}}this.field_nodes[e.value].composer=u;if(u.get_canvas()){u.get_canvas().addClass("bubble-ui value-field");a.append(u.get_canvas())}if(r==="Autocomplete"){const e=s.div("show-primary-btn",a,"Change search field");e.on("vclick",(()=>ge()))}}else{var u;s.input("bubble-ui value-field read-only",a,"text").attr("value",m.get_printable_field({field_object:t.ret_btype(),item_value:(u=this.data)==null?void 0:u.child(e.value).get()})).prop("readonly",true)}}));if(this.data){const e=s.div("field-zone",y);s.div("field-caption",e,"Unique id");return s.input("bubble-ui value-field read-only",e,"text").attr("value",this.data._id()).prop("readonly",true)}}));const w=s.div("bottom-stripe",_);const x=s.div(["btn","btn-create","bubble-ui"],w);x.text(this.data?"SAVE":"CREATE");const j=s.div(["btn","btn-cancel"],w);j.text("Cancel");j.on("vclick",(()=>{d.hide();this.destroy()}));x.on("vclick",(()=>{x.addClass("disabled");ee((()=>{this.get_entered_data((e=>{let{type:n,data:r}=e;if(!n){window.MessagePanel({title:"Create a new thing",message:"Please select a type of thing to create a new entry"});return}let i;if(r!=null&&r.Slug!=null&&r.Slug!==""){const e=b.bad_slug_formatting_message(r.Slug);if(e!=null){const t=this.create?"Creating a new entry":"Modifying an entry";window.MessagePanel({title:t,message:e});x.removeClass("disabled");return}}if(this.create){i={appname:Te.app().appname(),app_version:Te.app().app_version(),thing_type:n,to_create:r};Se.show_general_message("Please wait, the entry is being created...");return Q("upload_thing",i).callback((e=>{Se.hide_general_message();if(e){window.MessagePanel({title:"Creating a new entry",message:"There was an issue creating the entry: "+e.message});x.removeClass("disabled")}else{g.track("Data Action Done",{app:Te.appname(),action_type:"Create single",data_type:i.thing_type});k.maybe_increase_event_count(k.EVENTS.DATA_ACTION);window.MessagePanel({title:"Creating a new entry",message:"The entry was successfully created",offer_hide_next:true});t.force_refresh();x.removeClass("disabled");d.hide()}}))}else{i={appname:Te.app().appname(),app_version:Te.app().app_version(),thing:t.value,new_values:r};return Q("modify_thing",i).callback((e=>{if(e){window.MessagePanel({title:"Modifying an entry",message:"There was an issue modifying the entry "+e.message});x.removeClass("disabled")}else{window.MessagePanel({title:"Modifying an entry",message:"The entry was successfully modified",offer_hide_next:true});g.track("Data Action Done",{app:Te.appname(),action_type:"Modify single"});k.maybe_increase_event_count(k.EVENTS.DATA_ACTION);Ce().db_instance(Te.appname(),Te.app_version()).flush(this.data._id());t.force_refresh();x.removeClass("disabled");d.hide()}}))}}))}))}));const M=()=>h.css("max-height",$(window).height()-170);$(window).on("resize.modify-db-entry",(()=>M()));M();d.show()}get_entered_data(e){return s.run_once(30,(()=>{for(const t in this.field_nodes){var e;const{composer:n}=this.field_nodes[t];n==null?void 0:(e=n.force_blur)==null?void 0:e.call(n)}}),(()=>{const t=this.type_node.get();const n={};for(const e in this.field_nodes){const{node:t}=this.field_nodes[e];if(t!=null){if(Array.isArray(t.get())){n[e]=t.get().map((e=>l.dehydrate_tree(e)))}else{n[e]=t.get()}}}if(t==="user"&&!this.data){n.user_signed_up=true}e({data:n,type:t})}))}destroy(){return $(window).off("resize.modify-db-entry")}}const de=function(e,t){let n,r,i,s;if(["Created Date","Modified Date","Created By"].includes(t)){n="no-composer"}else if(["uses_2fa","email_confirmed"].includes(t)){n="Checkbox"}else{switch(e){case"text":n="TextBox";break;case"file":n="File";break;case"Checkbox":n="CheckBox";break;case"image":n="Image";break;case"number":n="NumberBox";break;case"dateinterval":n="NumberBox";break;case"date":n="DateBox";break;case"boolean"||"sys.bool":n="Dropdown";i=Ce().sets.get_set("FromOptionsList")([[Ce().get_text("BUILT_IN","YES"),true],[Ce().get_text("BUILT_IN","NO"),false]].map((e=>new(Ce().sets.Option)(e[0],e[1]))));break;case"geographic_address":n="GeographicBox";break;default:if(A.is_custom_type(e)||e==="user"){n="Autocomplete";s=he(e);i={autocomplete_fn(t){const n=t.trim();const r=Ce().db_instance(Te.appname(),Te.app_version());const i=Ee.get(e).get_message(s).ret_btype();const a=i.id();const c=s===h.UNIQUE_ID&&o.is_UUID(n);const u=a==="text";let d;if(c){const t=r.get(n);d=t!=null&&t.exists()&&t._type()===e?[t]:[]}else{let i;if(u&&s!==h.UNIQUE_ID){if(e==="user"&&s==="email"){i=[{constraint_type:"email_prefix_search",value:n.toLowerCase()},{key:"user_signed_up",constraint_type:"equals",value:true}]}else{i=[{constraint_type:t.indexOf(" ")!==-1?"match_phrase_prefix":"prefix_search",key:s,value:n.toLowerCase()}]}}else if(a==="number"){i=[{constraint_type:"equals",key:s,value:parseFloat(n)}]}else if(a==="geographic_address"){i=[{constraint_type:"geographic_search",key:s,value:{origin_address:w.from_address(n),range:1,unit:"miles"}}]}else{i=[{constraint_type:"contains_all_fields",key:h.ALL_DB_FIELDS,value:n}]}const o=r.find(e,i,[],j.DATA_PANEL_SEARCH_FAKE_EVAL_NODE);d=o.get_children(0,10)}const p=[];d.forEach((t=>{let r;if(e==="user"&&s==="email"){r=t.get_email()}else if(i.custom_type()){var o,c;r=(o=(c=t.child(s).get())==null?void 0:c._id())!=null?o:""}else{var d;r=String((d=t.child(s).get())!=null?d:"")}if(u||r.includes(String(n))){p.push({text:r,value:l.dehydrate_tree(t)})}else if(a==="geographic_address"){p.push({text:t.child(s).child("address").get(),value:l.dehydrate_tree(t)})}}));return p},from_val_to_text(t){const n=l.rehydrate_tree(Ce().db_instance(Te.appname(),Te.app_version()),t);if(s==="_id"){return n._id()}else{const t=Ee.get(e).get_message(s).ret_btype();const r={field_object:t};if(e==="user"&&s==="email"){r.item_value=n.get_email()}else{r.item_value=n.child(s).get()}return m.get_printable_field(r)}}};const t=Ee.get(e).custom_type();const a=t.field(s).display();if(a){const e=t.display();r="Type a "+e+"'s "+a+"..."}}else if(A.is_option_set(e)){n="Dropdown";i=Ce().sets.get_set("OptionValues")(e,false,true)}else{if(A.is_list(e)){n="ListManager"}else{n="no-composer"}}}}return{composer_type:n,set:i,placeholder:r,primary_field:s,ret_btype:e}};r.get_composer_for_field=de;function pe(e){const t=s.sort_data_fields(e.readable_fields());if(e.id()==="user"){const e=f.USER_FIELDS||[];e.forEach((e=>t.push(e)))}t.push(new(Ce().sets.Option)("unique id",h.UNIQUE_ID));return t}class _e{constructor(e,t,n){var r,i,o,a,l,c;this.data=e;this.cb=t;if(n){const t=s.json_deep_copy(this.data);t.id=s.UUID();t.display=fe(e.display,"copied");this.cb(t);return}const u=(this.data?"Modify an existing ":"Create a new ")+"database view";const d=new xe.ModalPopup(u);const p=d.get_canvas();p.addClass("db-view-popup");const _=d.children_div;const f=s.div("panel",_);s.div("view-name caption",f,"Name");this.view_name_input=s.input("bubble-ui view-name-input field",f);this.view_name_input.val((r=this.data)==null?void 0:r.display);this.type_node=Me.Owner((i=this.data)==null?void 0:i.type);s.div("type-dropdown caption",f,"Type of things");let m;if(Te.has_feature_enabled("reorg_component_selection")){m=new Le({owner:this.type_node,contents:P().with_options({dropdown_width:"extra_large"})})}else{m=L("Dropdown",this.type_node,{set:Ce().sets.get_set("CustomTypes")(true,false),dropdown_width_override:"extra_large"})}m.get_canvas().addClass("bubble-ui field");f.append(m.get_canvas());this.view_id=(o=(a=this.data)==null?void 0:a.id)!=null?o:s.UUID();this.sort_node=Me.Owner((l=this.data)==null?void 0:l.sort_field);this.descending_node=Me.Owner((c=this.data)==null?void 0:c.descending);this.constraints_nodes={};this.field_nodes={};const v=s.div("sort-field-zone",f);const b=s.div("descending-sort-zone",f);s.autorun((()=>{const e=this.type_node.get();if(!e){v.hide();return}v.show();v.empty();s.div("sort-dropdown caption",v,"Sort by");const t=E.get_fields_set({to_find_name:e,db_fields_only:true,sortable_fields_only:true});const n=L("Dropdown",this.sort_node,{set:t,dropdown_width_override:"extra_large"});n.get_canvas().addClass("bubble-ui field");v.append(n.get_canvas());return s.autorun((()=>{if(!this.sort_node.get()){b.hide();return}b.empty();b.show();s.div("descending-caption",b,"Descending");const e=L("Checkbox",this.descending_node,{});e.get_canvas().addClass("bubble-ui");return b.append(e.get_canvas())}))}));const y=s.div("fields-to-display-zone",f);s.div("field-to-display-caption",y,"Fields to display in this view");const w=s.div("select-all-wrapper",y);const x=s.div("field-list",y);s.autorun((()=>{const e=this.type_node.get();if(!e){y.hide();return}y.show();const t=Ee.get(e).custom_type();const n=pe(t);x.empty();n.forEach((e=>{var t,n;const r=s.div("field-zone",x);s.div("field-caption",r,s.FirstLetterCapitalize(e.display));const i=Me.Owner(((t=(n=this.data)==null?void 0:n.fields_to_show)!=null?t:[]).includes(e.value));const o=L("Checkbox",i,{});o.get_canvas().addClass("bubble-ui");r.append(o.get_canvas());this.field_nodes[e.value]=i}));return s.autorun((()=>{w.empty();const e=[];for(const t in this.field_nodes){e.push(t)}const t=[];for(const e in this.field_nodes){if(this.field_nodes[e].get()){t.push(e)}}const n=s.div("select-all bubble-ui light-grey-btn",w);if(t.length===e.length){n.text("(deselect all)");n.on("vclick",(()=>{for(const e in this.field_nodes){this.field_nodes[e].set(false)}}))}else{n.text("(select all)")}n.on("vclick",(()=>{for(const n in this.field_nodes){this.field_nodes[n].set(!(t.length===e.length))}}))}))}));const j=s.div("constraints-zone",f);s.div("constraints-caption",j,"Search constraints for this view");const A=s.div("constraints-list",j);const M=e=>{const t=s.div("constraint-div",A);const n=this.type_node.get();const r=Ee.get(n);const i=Me.Owner(e==null?void 0:e.key);const o=Me.Owner(e==null?void 0:e.constraint_type);const a=Me.Owner(e==null?void 0:e.value);const l=E.get_fields_set({to_find_name:n,db_fields_only:true,hide_unique_id:true});const c=L("Dropdown",i,{set:l,dropdown_width_override:"extra_large"});c.get_canvas().addClass("bubble-ui constraint-field");t.append(c.get_canvas());const u=s.div("operator",t);s.autorun((()=>{const e=i.get();if(!e){u.hide();return}u.empty();u.show();let t;if(e==="email"&&n==="user"){t="email"}else if(e!==h.ALL_DB_FIELDS){t=r.get_message(e).ret_btype()}else{t=e}const s=Ce().sets.get_set("Filtered")(Ce().sets.get_set("SearchOperators")(t),(e=>!["not in","in"].includes(e.value)));const a=L("Dropdown",o,{set:s});a.get_canvas().addClass("bubble-ui operator-field");return u.append(a.get_canvas())}));const d=s.div("value",t);s.autorun((()=>{const e=o.get();if(!e){d.hide();return}d.empty();d.show();let t;if(e==="contains_all_fields"){t="text"}else if(!["is_empty","is_not_empty","empty","not empty"].includes(e)){const e=r.get_message(i.get()).ret_btype();if(e.is_list()){t=e.inner().id()}else{t=e.id()}}if(!t){return}const{composer_type:n,set:l,placeholder:c}=de(t);if(n&&n!=="no-composer"){const e=L(n,a,{set:l,placeholder:c,with_time:true});e.get_canvas().addClass("bubble-ui value-field");d.append(e.get_canvas());if(n==="Autocomplete"){const e=s.div("show-primary-btn",d,"Change search field");return e.on("vclick",(()=>ge()))}}}));const p=s.LUID();this.constraints_nodes[p]={field_node:i,operator_node:o,value_node:a};const _=s.div("bubble-ui delete-btn",t);return _.on("vclick",(e=>{delete this.constraints_nodes[p];t.remove();return e.stopPropagation()}))};s.autorun((()=>{var e,t;const n=this.type_node.get();if(!n){j.hide();return}j.show();A.empty();const r=(e=(t=this.data)==null?void 0:t.constraints)!=null?e:[];r.forEach((e=>{M(e)}))}));const k=s.div("bubble-ui btn grey add-constraint",j,"Add a constraint");k.on("vclick",(()=>M()));const O=s.div("bottom-stripe",_);const S=s.div(["btn","btn-create","bubble-ui"],O);S.text(this.data?"SAVE":"CREATE");const D=s.div(["btn","btn-cancel"],O);D.text("Cancel");D.on("vclick",(()=>{d.hide();return this.destroy()}));S.on("vclick",(()=>{const{msg:e,data:t,changed:n}=this.is_info_valid();g.track("Data Views Changed",{app:Te.appname(),data_type:t.type,edit_type:"Create / Modify"});if(e){window.MessagePanel({title:"Create a new view",message:e});return}d.hide();if(n){return this.cb(t)}}));const C=()=>f.css("max-height",$(window).height()-170);$(window).on("resize.view-db-popup",(()=>C()));C();d.show();this.view_name_input.focus()}destroy(){return $(window).off("resize.view-db-popup")}get_entered_data(){const e=[];for(const n in this.constraints_nodes){var t;const r=this.constraints_nodes[n];const i={key:r.field_node.get(),constraint_type:r.operator_node.get()};if(((t=r.value_node)==null?void 0:t.get())!=null){const e=r.value_node.get();i.value=e instanceof Date?e.valueOf():e}e.push(i)}const n=[];for(const e in this.field_nodes){if(this.field_nodes[e].get()){n.push(e)}}const r={id:this.view_id,display:this.view_name_input.val(),type:this.type_node.get(),fields_to_show:n,sort_field:this.sort_node.get(),descending:this.descending_node.get(),constraints:e};for(const e in r){if(r[e]==null){delete r[e]}}return r}is_info_valid(){let e;const t=this.get_entered_data();if(!t.display){e="Please enter a name for this view."}else if(!t.type){e="Please pick a type to search for this view."}else if(!t.fields_to_show.length){e="Please select at least one field to show."}let n;if(this.data){for(const e in t){const r=t[e];if(JSON.stringify(this.data[e])!==JSON.stringify(r)){n=true;break}}if(n&&this.data.default_view&&this.data.display===t.display){t.display=fe(t.display,"modified");t.id=s.UUID()}}else if(!s.is_empty(t)){n=true}return{msg:e,data:t,changed:n}}}function fe(e,t){const n=e.includes(t)?e.slice(0,e.indexOf(t)+t.length):`${e} ${t}`;const r={};const i=Ie();for(const e in i){const t=i[e];r[t.display]=true}if(r[n]){let e=2;while(r[`${n} ${e}`]){e+=1}return`${n} ${e}`}return n}function he(e){return m.get_primary_field(e,Pe())}function me(){if(Te.app_version()===u.LIVE_VERSION){return false}if(!window.current_user_is_admin){return false}if(!Te.app_uses_action("SendConfirmationEmail")&&!Te.app_uses_action("SignUp")){return false}return true}const ge=e=>s.run_once(30,(()=>Pe==null?void 0:Pe()),((t,n)=>{if(t){c.log(t);return}return new ve(n,(t=>{Pe(t);return e==null?void 0:e()}))}));r.show_primary_field_popup=ge;class ve{constructor(e,t){this.data=e;this.cb=t;const n=new xe.ModalPopup("Define primary display fields");const r=n.get_canvas();r.addClass("primary-field-popup");const i=n.children_div;const o=s.div("panel",i);s.div("instruction",o,"You can pick the field that should be used to display or search for things of a custom type.");const a=s.div("type-list",o);const l=Te.custom_types(undefined,undefined,true).sort(Oe.sort_types_fn);this.field_nodes={};l.forEach((e=>{const t=e.to_value();const n=Ee.get(t).custom_type();const r=s.div("type-zone",a);s.div("type-caption",r,n.display());const i=n.readable_fields();if(t==="user"){i.push(...f.USER_FIELDS||[])}return s.run_once(30,(()=>{var n,r;return(n=(r=this.data)==null?void 0:r[e.id()])!=null?n:m.guess_primary_field(t)}),S((n=>{const i=Me.Owner(n);const s=Ce().sets.get_set("CustomFields")({btype_name:t,add_email_field_for_user_type:t==="user",add_unique_id:true});const o=L("Dropdown",i,{set:s,dropdown_width_override:"extra_large"});o.get_canvas().addClass("field-dropdown bubble-ui");r.append(o.get_canvas());this.field_nodes[e.id()]=i})))}));const c=s.div("bottom-stripe",i);const u=s.div(["btn","btn-create","bubble-ui"],c);u.text("SAVE");const d=s.div(["btn","btn-cancel"],c);d.text("Cancel");d.on("vclick",(()=>{n.hide();this.destroy()}));u.on("vclick",(()=>{e=this.get_entered_data();n.hide();this.destroy();this.cb(e)}));const p=()=>o.css("max-height",$(window).height()-170);$(window).on("resize.primary-field-popup",p);p();n.show()}destroy(){$(window).off("resize.primary-field-popup")}get_entered_data(){const e={};for(const t in this.field_nodes){const n=this.field_nodes[t];e[t]=n.get()}return e}}class be{constructor(){this.conf_text={from_live_to_test:{text:`from ${u.LIVE_ENVIRONMENT_DISPLAY.toLowerCase()} to ${u.DEVELOPMENT_ENVIRONMENT_DISPLAY.toLowerCase()}`,validation:`COPY FROM ${u.LIVE_ENVIRONMENT_DISPLAY.toUpperCase()} TO ${u.DEVELOPMENT_ENVIRONMENT_DISPLAY.toUpperCase()}`,appeditor_path:"copy_db_live_to_test"},from_test_to_live:{text:`from ${u.DEVELOPMENT_ENVIRONMENT_DISPLAY.toLowerCase()} to ${u.LIVE_ENVIRONMENT_DISPLAY.toLowerCase()}`,validation:`COPY FROM ${u.DEVELOPMENT_ENVIRONMENT_DISPLAY.toUpperCase()} TO ${u.LIVE_ENVIRONMENT_DISPLAY.toUpperCase()}`,appeditor_path:"copy_db_test_to_live"},restore_db:{validation:"RESTORE DATA TO PAST VERSION"},wipe_db_history:{validation:"WIPE DATABASE CHANGE HISTORY"}};this.popup=new xe.ModalPopup("Copy and restore database");const e=this.popup.get_canvas();e.addClass("copying-db-versions");const t=this.popup.children_div;const n=s.div("panel",t);const r=s.div("copy-panel",n);const i=s.div("restore-panel",n);const o=s.div("wipe-db-history-panel",n);s.div("caption",r,"Please wait, we are retrieving your database information...");this.check_progress("test",(e=>this.check_progress("live",(t=>{r.empty();if(e!=null||t!=null){const n=(e,t)=>{if(!e){return}const n=e.op_fn==="rewind_app";const i=s.div("show-progress",r);const{title:o,message:a}=n?{title:"Restoring database",message:"Your database has been successfully restored"}:{title:"Copying database",message:"Your database has been successfully copied"};if(n){s.div("caption",i,"You are currently restoring the "+x.get_db_display(t)+" of your database...")}else{s.div("caption",i,"You are currently copying your database...")}const l=s.div("progress-wrapper",i);return this.show_progess_bar(l,t,o,a)};n(e,"test");n(t,"live");i.remove();o.remove();return s.div("caption",r,"You will be able to start new database operation once this is finished, please wait.")}else{const a=s.div("instruction",r);a.html(`You can copy your data between ${u.DEVELOPMENT_ENVIRONMENT_DISPLAY} and ${u.LIVE_ENVIRONMENT_DISPLAY} versions. This is a <b>dangerous operation</b>, as it will entirely overwrite your existing database. In particular, if you copy from ${u.DEVELOPMENT_ENVIRONMENT_DISPLAY} to ${u.LIVE_ENVIRONMENT_DISPLAY}, ${u.LIVE_ENVIRONMENT_DISPLAY} data will be lost.`);this.button_areas=s.div("button-areas",r);this.create_big_button("from_live_to_test");this.create_big_button("from_test_to_live");this.conf_copy_box=s.div("confirmation-box",r);this.conf_copy_box.hide();const l=s.div("instruction",i);s.run_once(10*60*1e3,(()=>{var e;return(e=Te.app_plan(true))==null?void 0:e.db_backup}),S((e=>l.text("You can restore your database to a previous version. Given your plan, you can go back "+this.convert_plan_to_time(e)+". Be careful, this will overwrite all data in your application, and can take a long time to complete for large databases."))));const d=s.div("version-picker-wrapper",i);s.div("caption",d,"Database version to restore");const p=Me.Owner(x.get_db_version(Te.app_version()));const _=Ce().sets.get_set("Object")({test:u.DEVELOPMENT_ENVIRONMENT_DISPLAY,live:u.LIVE_ENVIRONMENT_DISPLAY});const f=L("Dropdown",p,{set:_});f.get_canvas().addClass("db-version bubble-ui");d.append(f.get_canvas());const h=this.build_type_picker("restore_db",i);s.div("caption timestamp",i,"Time to restore to");const m=s.div("inject-today caption",i,"(current time)");m.on("vclick",(()=>{const e=new Date;g.val(s.format_date(e,"mm/dd/yyyy"));b.val(s.format_date(e,"HH:MM:ss"));return w()}));const g=s.input("timestamp-restore-db day bubble-ui",i);g.inputmask(v.masks.date.mask);const b=s.input("timestamp-restore-db hour bubble-ui",i);b.inputmask(v.masks.time.mask);const y=s.Box(null);function w(){if(!g.val()||!b.val()){return y(null)}else{const e=g.val()+" "+b.val();const t=new Date(e);return y(t.getTime())}}g.on("keydown blur",(()=>w()));b.on("keydown blur",(()=>w()));const j=s.div("bubble-ui btn grey conf restore",i,"Restore to this date");s.autorun((()=>j.toggleClass("disabled",y()===null)));this.conf_restore_box=s.div("confirmation-box",i);this.conf_restore_box.hide();j.on("vclick",(()=>{if(!j.hasClass("disabled")){this.button_areas.find(".copy-db-btn").removeClass("selected");this.build_confirmation_box("restore_db",h,this.conf_restore_box,(e=>{j.addClass("disable");return this.make_sure_plans_allow_this(y(),(()=>this.restore_db(y(),p.get(),e)),(e=>{const t=e===0?"Your current plan doesn't let you use version control, please upgrade to use this feature.":"Your current plan doesn't let you go back more than "+this.convert_plan_to_time(e)+". Please upgrade to get back earlier in time.";j.removeClass("disable");return window.MessagePanel({title:"Restore a previous database",message:t})}))}))}}));const A=s.div("confirmation-box",o);return this.build_confirmation_box("wipe_db_history",undefined,A,(()=>Q("nuke_db_change_history",{appname:Te.app().appname(),app_version:Te.app_version(),safety:"yesdoit"}).callback((e=>{if(e){window.MessagePanel({title:"Wiping database change history",message:"There was an issue wiping the change history: "+c.human_friendly(e)})}else{window.MessagePanel({title:"Wiping database change history",message:"You have successfully wiped your database change history."})}return this.popup.hide()}))),true)}}))));const a=s.div("bottom-stripe",t);const l=s.div(["btn","btn-create","bubble-ui"],a,"CLOSE");l.on("vclick",(()=>this.popup.hide()));this.popup.show()}check_progress(e,t){return Q("check_operation_state",{appname:Te.app().appname(),app_version:e}).callback(((e,n)=>{if(e){c.log(e);return}return t(n)}))}restore_db(e,t,n){return this.check_progress(t,(r=>{if(r!=null){return window.MessagePanel({title:"Restoring database",message:"There is already a database operation happening, please try again."})}else{return Q("restore_db",{appname:Te.app().appname(),app_version:t,timestamp:e,type:n}).callback((n=>{if(n){window.MessagePanel({title:"Restoring database",message:"There was an issue restoring the database: "+c.human_friendly(n)});return}g.track("Database restored",{app:Te.appname(),app_version:t});return this.show_progess_bar(this.conf_restore_box,t,"Restoring database","Your database has been successfully restored to as it was on "+s.format_date(new Date(e),"m/dd/yy, HH:MM:ss"))}))}}))}make_sure_plans_allow_this(e,t,n){return s.run_once(10*60*1e3,(()=>{var e;return(e=Te.app_plan(true))==null?void 0:e.db_backup}),((r,i)=>{if(r){return c.log(r)}else if(i===true||(Date.now()-e)/(1e3*60*60)<=i){return t()}else{return n(i)}}))}convert_plan_to_time(e){if(e===1e13||e===true){return"to any point in time"}else{return"up to "+Math.floor(e/24)+" days"}}create_big_button(e){const t=s.div("bubble-ui btn light copy-db-btn "+e,this.button_areas);if(e==="from_live_to_test"){t.text(`Copy ${u.LIVE_ENVIRONMENT_DISPLAY} data into the ${u.DEVELOPMENT_ENVIRONMENT_DISPLAY} database`)}else{t.text(`Copy ${u.DEVELOPMENT_ENVIRONMENT_DISPLAY} data into the ${u.LIVE_ENVIRONMENT_DISPLAY} database`)}return t.on("vclick",(()=>{this.button_areas.find(".copy-db-btn").removeClass("selected");t.addClass("selected");return this.build_confirmation_box(e,undefined,this.conf_copy_box,(t=>{const n=this.conf_text[e].appeditor_path==="copy_db_live_to_test"?"test":"live";return this.check_progress(n,(r=>{if(r!=null){return window.MessagePanel({title:"Restoring database",message:"There is already a database operation happening, please try again."})}else{return Q(this.conf_text[e].appeditor_path,{appname:Te.app().appname(),type:t}).callback((t=>{if(t){window.MessagePanel({title:"Copying database",message:"There was an issue copying the database: "+c.human_friendly(t)});return}g.track("Database copied",{app:Te.appname(),copy_direction:this.conf_text[e].text});return this.show_progess_bar(this.conf_copy_box,n,"Copying database","Your database has been successfully copied from "+this.conf_text[e].text)}))}}))}))}))}show_progess_bar(e,t,n,r){const{report_progress:i,finish_progress:s}=Ne.get_bar(e);let o=null;const a=()=>this.check_progress(t,(e=>{if(e===null){clearInterval(o);s();this.popup.hide();window.MessagePanel({title:n,message:r});return Ce().db_instance(Te.appname(),Te.app_version()).flush_all()}else{return i(e.completion*100,100)}}));return setTimeout((()=>{a();o=setInterval((()=>a()),20*1e3)}),100)}build_type_picker(e,t){const n=s.div("pick-type-wrapper",t);if(e==="restore_db"){s.div("caption",n,"Data type to restore")}else{s.div("caption",n,"Data type to copy")}let r;const i=Me.Owner("_all");if(Te.has_feature_enabled("reorg_component_selection")){const e=P().add_items(["",[{value:"_all",display:"All types"}]]).with_options({section_order:["","Data Types"]});r=new Le({owner:i,contents:e})}else{var o;const e={_all:"All types"};const t=Ce().sets.get_set("CustomTypes")(true);if((o=window)!=null&&o.composer_revamp){t.all().forEach((t=>{e[t.value]=t.display}))}else{t.get_options().forEach((t=>{e[t.value]=t.display}))}r=L("Dropdown",i,{set:Ce().sets.get_set("Object")(e)})}r.get_canvas().addClass("bubble-ui type-picker");n.append(r.get_canvas());return i}build_confirmation_box(e,t,n,r,i){this.conf_copy_box.hide();this.conf_restore_box.hide();n.empty();n.show();if(!["restore_db","wipe_db_history"].includes(e)){t=this.build_type_picker(e,n)}const o=s.div("instruction",n);o.text("Type in the box '"+this.conf_text[e].validation+"' and press 'Confirm' to perform the operation.");const a=s.input("bubble-ui confirmation-input",n);const l=s.div("bubble-ui btn conf disabled",n,"Confirm");l.on("click",(()=>{var n,i;if(l.hasClass("disabled")){return}if(a.val()!==this.conf_text[e].validation){return}l.addClass("disabled");const s=((n=t)==null?void 0:n.get())==="_all"?undefined:(i=t)==null?void 0:i.get();return r(s)}));a.on("keyup",(()=>{l.toggleClass("disabled",a.val()!==this.conf_text[e].validation)}));const c=s.div("bubble-ui btn grey conf",n,"Cancel");return c.on("vclick",(()=>{if(i){a.val("")}else{n.hide()}}))}}function ye(e){let t=null;const n=s.Box();function r(e){var r;n(e);(r=t)!=null?r:t=s.MakeKey(null,"loading");return t.turn()}return function(i){if(i===undefined){if(!t){t=s.MakeKey(30,"loading "+e);Ce().location.get("server://appeditor/app_setting/"+Te.appname()+"/"+e).done((e=>r(e)));if(!d.is_test(Te.appname())){const t=Date.now();I.watch([R,Te.appname(),e],(()=>t),(()=>{Ce().location.get("server://appeditor/app_setting/"+Te.appname()+"/"+e).done((e=>r(e)))}))}}s.ensure_ready(t);return n()}else{r(i);return Ce().location.post("server://appeditor/app_setting/"+Te.appname()+"/"+e,i).done()}}}function we(e){let{on_close:t,action_name:n}=e;if(y.is_paused()){var r;(r=n)!=null?r:n="action";return window.ConfirmPanel({title:`This ${n} requires the scheduler to be unpaused`,message:`The scheduler is currently paused for this version of the application. The ${n} can still be registered but won't run until the scheduler is unpaused. Would you like to resume it?`,button_caption:"RESUME",cancel_caption:"GOT IT",cb_yes(){y.resume_scheduler();return t()},cb_no:t})}else{return t()}}const xe=e("../core/widgets");const je=e("./csv_uploader");const Ae=e("./bulk_operation_dialog");const Me=e("./composer/legacy");const Ee=e("../lang/btypes");const ke=e("../client_config");const Oe=e("../types");const Se=e("../core/status_bar");const De=e("./documentationpalette");const Ce=e("../lib");const Te=e("../lang/appquery");const Ne=e("./progressbar");const Pe=ye("data_admin_panel_primary_fields");const Ie=ye("data_admin_panel_primary_db_views");r.saved_views=Ie;const Re=e("./subscription");const{DropdownComposerInterface:Le}=e("./composer/compatibility/solid_conversion/DropdownComposerInterface")},{"../client/analytics":20,"../client_config":41,"../constants/db":58,"../constants/eval":64,"../constants/locations":74,"../constants/notifier_topics":76,"../constants/security":84,"../constants/special_keys":87,"../core/core_datasources/utilities/core_ds_editor_utilities":233,"../core/input_mask":383,"../core/status_bar":415,"../core/widgets":421,"../db/hydrate":429,"../geolocation/b_location":621,"../lang/appquery":651,"../lang/btype_ids":652,"../lang/btypes":653,"../lang/btypes_dropdowns":654,"../lib":741,"../locations":743,"../logger":744,"../notifier/client":747,"../shared/apps_utilities":788,"../shared/data_panel":791,"../shared/environment_utilities":793,"../shared/slug":808,"../types":812,"../u":823,"../u/shared/callbacks":843,"../u/shared/errors":846,"../u/shared/uuid":855,"./bulk_operation_dialog":490,"./components/design/breadcrumbs/Breadcrumbs":493,"./composer/compatibility/composers":532,"./composer/compatibility/solid_conversion/DropdownComposerInterface":535,"./composer/legacy":544,"./css":560,"./csv_uploader":561,"./documentationpalette":565,"./paywall/paywallpanel_sources":582,"./progressbar":583,"./scheduler_controls":585,"./subscription":589,"./utils/editor_exposure":593,"./utils/url_params":598,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/isEqual":1321,pluralize:2275,"solid-js/web":2315}],563:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=y;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=g(e("../../lib"));var o=m(e("../../shared/responsive/responsive_layout"));var a=m(e("../../shared/responsive/responsive_css"));var l=m(e("../../lang/evaluation/element_eval"));var c=e("../../renderer/solid_utils/autorun_signals");var u=e("../../core/core_elements/components/utils/repeating_border_styles");var d=e("../../u/shared/async/autorun");var p=e("../../lang/btypes");var _=m(e("../../u/client/resize_observer"));var f=e("../../core/core_elements/components/utils/repeating_groups");function h(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(h=function(e){return e?n:t})(e)}function m(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=h(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function g(e){return e&&e.__esModule?e:{default:e}}const v=(0,r.template)(`<div></div>`,2),b=(0,r.template)(`<div class="list-dummy"></div>`,2);function y(e){const t=e.instance;const n=t.repeating_group_layout;if(!n)return[];const h=()=>n.scroll_direction();const m=()=>n.is_masonry();const g=()=>n.columns();const y=()=>n.rows();let x;const[j,A]=(0,i.createSignal)(0);const[M,E]=(0,i.createSignal)("");const[k,O]=(0,i.createSignal)(0);const[S,D]=(0,i.createSignal)(0);const C=(0,i.createMemo)((()=>k()>=50&&S()>=150));const T=(0,i.createMemo)((()=>{if((t==null?void 0:t.get_static_property("group_type"))!=null){return(0,p.display_matcher)(e.instance.get_static_property("group_type")).slice(0,20)}return null}));(0,c.onAfterMount)((()=>{n.list_item=$(x);const e=t.autorun((()=>{const e=t.get_canvas();e.addClass("bubble-rg-edit-guess");A(Math.max(Math.min(n.guess_number_of_cells(),100)-1,0));e.removeClass("bubble-rg-edit-guess")}));let r=false;const i=t.autorun((()=>{for(const r of t.element.elements()){var e,n;r.json.register_dependency();(e=r.get_style())==null?void 0:(n=e.json)==null?void 0:n.register_dependency();s.default.or_throw().visual_edit.turned_on(r.id())}if(!r){r=true;(0,d.wait_for_updates)((()=>{setTimeout((()=>{const e=$(x).clone();e.find(".resize-handle").remove();e.find(".visual-indicator-wrapper").remove();e.find(".r-margin-show, .r-margin-side").remove();e.find(".element").css({"-webkit-box-shadow":"none","box-shadow":"none","-moz-box-shadow":"none"});e.find(".selected").removeClass(".selected");e.find(".element").removeClass("element").addClass("dummy-element");e.find(".container").removeClass("container");E(e.html());r=false}),100)}))}}));_.observe(x,(e=>{O(e.contentRect.height);D(e.contentRect.width)}));t.get_children_drawn_key().turn();return()=>{e.destroy();i.destroy();_.unobserve(x)}}));const N=(0,i.createMemo)((()=>{const e=t.element.container_layout();const n=o.LAYOUT_PROPERTIES[e].container_properties;const r={};for(const e in n){const i=n[e];r[i]=l.evaluate_property(t,e)}return a.container_properties(r)}));const P=(0,i.createMemo)((()=>o.LAYOUT_PROPERTIES[t.element.container_layout()].classes));const I=(0,f.createIndexFns)({get rows(){return y()},get columns(){return g()},get scrollDirection(){return h()}});function R(t){return(0,u.createBorderStyle)((0,i.mergeProps)(e,{get hasTopBorder(){return!m()&&I().indexToRow(t)>0},get hasLeftBorder(){return!m()&&I().indexToColumn(t)>0},get firstRow(){return m()&&I().indexToRow(t)===0},includeMargin:true,hasRightBorder:false,hasBottomBorder:false}))}const L=R(0);return[(()=>{const n=v.cloneNode(true);const s=x;typeof s==="function"?(0,r.use)(s,n):x=n;(0,r.insert)(n,(0,r.createComponent)(i.Show,{get when(){return(0,r.memo)((()=>t.children.length===0))()&&C()},get children(){return(0,r.createComponent)(w,{cellIndex:1,get dataTypeRG(){return T()}})}}),null);(0,r.insert)(n,(()=>e.children),null);(0,r.effect)((t=>{const i=`list-item bubble-r-container ${P()}`,s={...e.cellSizing,...N(),...L()};i!==t._v$&&(0,r.className)(n,t._v$=i);t._v$2=(0,r.style)(n,s,t._v$2);return t}),{_v$:undefined,_v$2:undefined});return n})(),(0,r.createComponent)(i.Index,{get each(){return Array(j())},children:(n,s)=>{const o=R(s+1);return(0,r.createComponent)(i.Show,{get when(){return t.children.length>0},get fallback(){return(()=>{const t=b.cloneNode(true);(0,r.insert)(t,(0,r.createComponent)(i.Show,{get when(){return C()},get children(){return(0,r.createComponent)(w,{cellIndex:s+2,get dataTypeRG(){return T()},additionalClass:"dummy"})}}));(0,r.effect)((n=>(0,r.style)(t,{...e.cellSizing,...N(),...o()},n)));return t})()},get children(){const t=b.cloneNode(true);(0,r.effect)((n=>{const i={...e.cellSizing,...N(),...o()},s=M();n._v$3=(0,r.style)(t,i,n._v$3);s!==n._v$4&&(t.innerHTML=n._v$4=s);return n}),{_v$3:undefined,_v$4:undefined});return t}})}})]}function w(e){return(()=>{const t=v.cloneNode(true);(0,r.insert)(t,(()=>{var t;return`${(t=e.dataTypeRG)!=null?t:"Repeating group"} item ${e.cellIndex}`}));(0,r.effect)((()=>{var n;return(0,r.className)(t,`rg-label ${(n=e.additionalClass)!=null?n:""}`)}));return t})()}},{"../../core/core_elements/components/utils/repeating_border_styles":279,"../../core/core_elements/components/utils/repeating_groups":280,"../../lang/btypes":653,"../../lang/evaluation/element_eval":690,"../../lib":741,"../../renderer/solid_utils/autorun_signals":774,"../../shared/responsive/responsive_css":803,"../../shared/responsive/responsive_layout":804,"../../u/client/resize_observer":820,"../../u/shared/async/autorun":830,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],564:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.EditRepeatingTable=f;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=e("solid-js");var s=e("../../u/shared/async/autorun");var o=e("../../renderer/solid_utils/autorun_signals");var a=e("../../core/core_elements/components/utils/table_element");var l=e("../../u/shared/async/b_async");var c=d(e("../../renderer/EditorContext"));var u=e("../../lang/evaluation/element_eval");function d(e){return e&&e.__esModule?e:{default:e}}const p=(0,r.template)(`<div class="bubble-cross-axis"></div>`,2),_=(0,r.template)(`<div class="table-dummy-cell"></div>`,2);function f(e){const t=e.instance;const n=e.instance.parent();const d=(0,i.useContext)(a.TableContext);const f=(0,i.useContext)(c.default);if(!n||!d)return[];const h=n.table_element_layout;if(!h)return[];const[m,g]=(0,i.createSignal)(0);const[v,b]=(0,i.createSignal)([]);const[y,w]=(0,i.createSignal)({});const[x,j]=(0,i.createSignal)(false);const A=(0,i.createMemo)((()=>{if(x()){return 0}else if(t.get_static_property("fixed_number_repeating_axis")){var e;return Math.max(((e=(0,u.evaluate_property)(t,"fixed_number_repeating_axis_count"))!=null?e:1)-1,0)}else{return m()}}));(0,i.createEffect)((()=>{e.setNumDummies(A())}));const M=()=>{if(t.get_static_property("fixed_number_repeating_axis")){g(0);return}j(true);const e=Math.max(Math.min(h.guess_number_of_cells(t),100)-1,0);g(e);j(false)};(0,o.onAfterMount)((()=>{const r=new ResizeObserver((()=>{M()}));r.observe(e.instance.canvas[0]);r.observe(n.canvas[0]);let o;(0,i.createRoot)((e=>{o=e;(0,i.createEffect)((()=>{t.get_static_property("fixed_number_repeating_axis");h.guess_number_of_cells(t);queueMicrotask(M)}));(0,i.createEffect)((()=>{const e=n.children.filter((e=>e.element.type()==="TableCrossAxis"&&e!==t));e.forEach((e=>{var t;(0,l.ensure_ready)(e.get_skeleton_ready_key());const n=(t=e.canvas)==null?void 0:t[0];if(!n)return;r.observe(n);(0,i.onCleanup)((()=>{r.unobserve(n)}))}))}))}));let a=false;function c(){if(!a){a=true;(0,s.wait_for_updates)((()=>{setTimeout((()=>{if(t.destroy_started())return;const e=t.children.map((e=>{if(e.canvas==null)return"";const t=e.canvas.clone();t.find(".resize-handle").remove();t.find(".visual-indicator-wrapper").remove();t.find(".r-margin-show, .r-margin-side").remove();t.find(".element").css({"-webkit-box-shadow":"none","box-shadow":"none","-moz-box-shadow":"none"});t.find(".selected").removeClass(".selected");t.find(".element").removeClass("element").addClass("dummy-element");t.find(".container").removeClass("container");return t[0].outerHTML}));b(e);const n=t.canvas[0].style;const r={};for(let e=0;e<n.length;e++){const t=n[e];r[t]=n.getPropertyValue(t)}w(r);a=false}),100)}))}}const u=new MutationObserver(c);u.observe(e.instance.canvas[0],{subtree:true,attributes:true,childList:true,characterData:true});c();t.get_children_drawn_key().turn();return()=>{r.disconnect();u.disconnect();o()}}));const E=t=>({opacity:"0.8","box-sizing":"border-box",[`border-${d.direction==="horizontal"?"bottom":"right"}`]:t===d.lastMainAxis?"none":e.dummySeparatorCss,...d.mainAxisSizingStyling(t)});const k=e=>{const t=f==null?void 0:f.state.elements[e];if(t==null)return false;return t.hovered||t.draggedOver};return(0,r.createComponent)(i.Show,{get when(){return A()>0},get children(){return(0,r.createComponent)(i.Index,{get each(){return Array(A())},children:(n,s)=>(()=>{const n=p.cloneNode(true);(0,r.spread)(n,(0,r.mergeProps)({get style(){return{...y(),...e.cellSizing,[`border-${d.direction==="horizontal"?"right":"bottom"}`]:s===A()-1?"none":`${e.separatorWidth}px ${e.separatorStyle} ${e.separatorColor}`}}},(()=>t.edit_mode()?{}:{innerHTML:v().join("")})),false,true);(0,r.insert)(n,(()=>{const e=(0,r.memo)((()=>!!t.edit_mode()));return()=>e()&&(0,r.createComponent)(i.For,{get each(){return t.children},children:(e,t)=>(()=>{const n=_.cloneNode(true);(0,r.effect)((i=>{const o=!!(f!=null&&f.state.selected[e.element_id()]),a=!!k(e.element_id()),l=!!(s===A()-1),c=!!(d.direction==="vertical"),u=!!(d.direction==="horizontal"),p={...E(e.get_static_property("cell_main_axis_id")),...d.tableCellSizing(e),position:"relative"},_=v()[t()];o!==i._v$&&n.classList.toggle("selected",i._v$=o);a!==i._v$2&&n.classList.toggle("hovered",i._v$2=a);l!==i._v$3&&n.classList.toggle("bottom",i._v$3=l);c!==i._v$4&&n.classList.toggle("vertical",i._v$4=c);u!==i._v$5&&n.classList.toggle("horizontal",i._v$5=u);i._v$6=(0,r.style)(n,p,i._v$6);_!==i._v$7&&(n.innerHTML=i._v$7=_);return i}),{_v$:undefined,_v$2:undefined,_v$3:undefined,_v$4:undefined,_v$5:undefined,_v$6:undefined,_v$7:undefined});return n})()})})());return n})()})}})}},{"../../core/core_elements/components/utils/table_element":281,"../../lang/evaluation/element_eval":690,"../../renderer/EditorContext":766,"../../renderer/solid_utils/autorun_signals":774,"../../u/shared/async/autorun":830,"../../u/shared/async/b_async":832,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],565:[function(e,t,n){"use strict";const r=e("./../u");const i=e("./../safe_require");const s=e("../lib");r.edit_mode_only();const o=e("../u/shared/b_string");const a=e("./../logger");const l=e("./../lang/appquery");const c=e("../client/analytics");const u=e("./../content/reference_id_to_url");const d=e("../shared/environment_utilities");const p=e("../constants/time");const{NotReadyError:_}=e("../u/shared/errors");const f=n;i.safe_register("./editor/documentationpalette",f);const h={};const m="reference_snippet";class g{constructor(){$(document).on("vmousedown",(()=>{if(this._start_rendering_timeout){clearTimeout(this._start_rendering_timeout)}if(this._visible){this.hide()}}))}add(e,t){if(this.disabled){return}const n=this.get_documentation_url(t);if(!n){return}e.data("documentation_url",n);e.mouseenter((()=>{this.show_palette(e)}));e.mouseleave((()=>{clearTimeout(this._start_rendering_timeout);clearTimeout(this._start_fetching_timeout);setTimeout((()=>{if(!this.hovering_palette){this.hide()}}),10)}))}show_palette(e){clearTimeout(this._start_rendering_timeout);clearTimeout(this._start_fetching_timeout);const t=p.SECOND_MS;const n=3*p.SECOND_MS;this._start_rendering_timeout=setTimeout((()=>{this.render_palette_contents(e,false)}),t);try{if(!l.has_feature_enabled("reference_snippet")){return}}catch(e){const t=e;if(t instanceof _){return}throw t}this._start_fetching_timeout=setTimeout((()=>{const t=e.data("documentation_url");if(h[t]){e.data(m,h[t]);this.render_palette_contents(e,true);return}s().location.post("server://appeditor/get_reference_entry",{url:t},((n,r)=>{if(n){a.warn(n);return}h[t]=r;e.data(m,h[t]);this.render_palette_contents(e,true)}))}),n)}render_palette_contents(e,t){const n=this.get_canvas();const i=250;this._visible=true;if(!e.is(":visible")||$(".insert-dynamic").is(":visible")||b().is_visible()){return}const s=e.data(m);if(t&&s!=null){this.reference_snippet_canvas.text(o.eager_first_sentence_cut(s,i));this.manual_link_canvas.text("See more ")}else{this.reference_snippet_canvas.empty();this.manual_link_canvas.text("See reference ")}n.off("vmousedown");n.on("vmousedown",(t=>{t.stopPropagation();const n=e.data("documentation_url");c.track("Reference Viewed",{app:l.appname(),source:"contextual",target:e.data("documentation_url")});window.open(n,"reference_tab");this.hide()}));n.velocity("stop");n.show();r.velocity(n,{opacity:1},{duration:300});this.position_palette(e)}position_palette(e){const t=this.get_canvas();const n=(e.height()-25)/2;let r=e.offset().left+e.outerWidth()-$(document).scrollLeft()-1;const i=e.offset().top-$(document).scrollTop()+Math.max(n,0);if(r+t.outerWidth()>$(window).width()){r=e.offset().left-$(document).scrollLeft()-t.outerWidth()+1;t.addClass("reverse")}t.css({left:r,top:i})}hide(){this._visible=false;const e=this.get_canvas();e.velocity("stop");e.css("opacity",0);e.hide();e.removeClass("reverse")}get_canvas(){if(!this.canvas){this.canvas=r.div("reference-palette-canvas");this.reference_snippet_canvas=r.div("reference-snippet",this.canvas);this.manual_link_canvas=r.div("manual-link",this.canvas);$(document.body).append(this.canvas);this.canvas.mouseenter((()=>{this.hovering_palette=true;this.canvas.velocity("stop");return this.canvas.show()}));this.canvas.mouseleave((()=>{this.hovering_palette=false;return this.hide()}))}return this.canvas}content_missing(e){if(!v(e)){return true}return false}get_documentation_url(e){if(!e){return}e=e.split("Documentation.")[1].trim();if(this.content_missing(e)){if(!d.is_production()){a.error("missing documentation",{documentation_id:e})}return}return v(e)}}function v(e){const t=e.split(".").reverse();let n=t.pop();let r=null;let i=u.mapping;while(n!=null&&((s=i.subsections)==null?void 0:s[n])!=null){var s,o,a;i=(o=i.subsections)==null?void 0:o[n];if(i.section_url!=null){r=i.section_url}n=t.pop();if(((a=i.subsections)==null?void 0:a[n])==null){n=[n].concat(t.reverse()).join(".")}}return r}f.DocumentationPalette=r.singleton(g);const b=e("./thumbnail")},{"../client/analytics":20,"../constants/time":92,"../lib":741,"../shared/environment_utilities":793,"../u/shared/b_string":841,"../u/shared/errors":846,"./../content/reference_id_to_url":96,"./../lang/appquery":651,"./../logger":744,"./../safe_require":777,"./../u":823,"./thumbnail":590}],566:[function(e,t,n){"use strict";const r=e("./../u");const i=e("./../lib");const s=e("./../core/widgets");const o=e("./composer/legacy");const{get_composer:a}=e("./composer/compatibility/composers");r.edit_mode_only();n.DowngradePanel=class e{constructor(e){let{to_free_plan:t,cb_yes:n}=e;this.popup=new s.ModalPopup("Downgrading your plan");const l=this.popup.get_canvas();l.addClass("downgrade-popup");const c=this.popup.children_div;r.div("instruction",c).html("It looks like you are making some big changes!");const u=o.Owner(null);const d=["No longer pursuing idea","Business has spun down","Switching to code / another platform","Taking a break (will return)","Only needed app temporarily","App no longer needed","Product limitations","Too difficult to learn","Was testing it out","Upgraded by accident","Price or budget concerns","Subscribed / upgraded by mistake","Account / plan management","Ownership transfer","Other"];const p=i().sets.get_set("List")(d);const _=a("Dropdown",u,{set:p,placeholder:"Select reason"});_.get_canvas().addClass("bubble-ui");c.append(_.get_canvas());r.div("instruction",c).html("Please explain your reason for downgrading");const f=r.textarea("bubble-ui textarea",c);f.attr("placeholder","Explain why you're downgrading (optional)");const h=o.Owner(false);const m=a("Checkbox",h,{});const g=r.div("checkbox-row",c);r.div("caption",g,"Would you be willing to speak to a member of our Product team to learn about why you're downgrading your plan?");g.append(m.get_canvas());m.get_canvas().addClass("bubble-ui");if(t){const e=r.div("confirmation-warning",c);r.div("confirmation-msg",e,'By selecting "Okay", you confirm: ');r.div("confirmation-msg indented",e,"  You won't be able to stay on your paid plan for the timeframe you've paid for");r.div("confirmation-msg indented",e,"  You won't be refunded for the remaining time");r.div("confirmation-msg",e,"");r.div("confirmation-msg new-paragraph",e,"We suggest you use your plan until its expiration date.")}const v=r.div(["btn","btn-create","disabled","bubble-ui"],c);v.text("OKAY");const b=r.div(["btn","btn-cancel"],c);b.text("Cancel");b.on("vclick",(()=>this.popup.hide()));r.autorun((()=>v.toggleClass("disabled",!(u!=null?u.get():undefined))));v.on("vclick",(()=>{if(!v.hasClass("disabled")){this.popup.hide();const e=()=>n({bucketed:u!=null?u.get():undefined,feedback:f.val(),willing_to_chat:h.get()});return e()}}));this.popup.show();f.focus()}show(){this.popup.show()}}},{"./../core/widgets":421,"./../lib":741,"./../u":823,"./composer/compatibility/composers":532,"./composer/legacy":544}],567:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../u");const i=n;const s=e("./../lang/appquery");const o=e("./../lang/lang");const a=e("./../lib");const l=e("./../logger");const c=e("./utils/evaluate_condition");const{VERSION_STYLE_OVERRIDES:u}=e("./../constants/elements");const d=e("./editor_language").get_text;const p=["start_workflow","information","switch_element","element_style","reset_overrides","select_parent","edit_custom_definition","reveal_in_tree"];i.current_multi_element=null;i.find_common_fields=function(e){const t=[];const n=s.element(e[0]);const r=e.slice(1).map((e=>s.element(e)));const o=[n,...r];const l={};const _={};for(const e of o){_[e.id()]=e.fields()}for(const e of _[n.id()]){if(!p.includes(e.name)){let i=n.property(e.name,true).raw();const s=i!=null;if(n.is_styleable_property(e.name)&&!i){var f;i=(f=n.get_style_if_exists())==null?void 0:f.get_static_property(e.name)}let a=true;for(const t of r){if(t.type()!==n.type()&&e.name==="element_style"){a=false;break}const r=_[t.id()];if(!r.map((e=>e.name)).includes(e.name)){a=false;break}let s=t.property(e.name,true).raw();if(t.is_styleable_property(e.name)&&!s){var h;s=(h=t.get_style_if_exists())==null?void 0:h.get_static_property(e.name)}if(i!=null&&i!==s&&JSON.stringify(i)!==JSON.stringify(s)||i==="[object Object]"){i=undefined}}if(a){l[e.name]={no_states:true};if(i!=null){e.default=i;l[e.name].default=i}else if(s){delete e.default}e.on_blur_only=true;if(e.name==="delete_element"){e.pretty.width=""}const n=["on_change","click_cb"];for(const t of n){if(e[t]){const n={};o.forEach((r=>{const i=_[r.id()].find((t=>t.name===e.name))[t];if(i){n[r.id()]=i}}));e[t]=e=>{o.forEach((e=>{if(n[e.id()]){n[e.id()](e)}}))}}}if(e.condition){const t={};o.forEach((n=>{const r=_[n.id()].find((t=>t.name===e.name)).condition;if(r){t[n.id()]=r}}));e.condition=e=>o.every((e=>{if(!t[e.id()]){return true}return c(t[e.id()],e)}))}t.push(e)}}}let m=n.type();let g=n.get_style_id();for(const e of r){if(e.get_style_id()!==g){g=undefined}if(m!==e.type()){m=false;break}}if(!t.length){return}const v=[];if(m&&m!=="CustomElement"){v.push({name:"element_style",caption:"Style Attribute",editor:"Dropdown",optional:true,default:g,no_write_child:true,prop_node(e){return e.get_style_node()},on_change(e){i.current_multi_element.set_style(e);if(e!=null){i.current_multi_element.clear_style_overrides();o.forEach((e=>{e.clear_style_overrides()}))}},set:a().sets.get_set("Styles")(m,null,null,(()=>i.current_multi_element.has_overridden_style())),pretty:{section:"ElementStyle",dropdown_width:"extra_extra_large"}});t.push({name:"reset_overrides",button_caption:"Reset",editor:"Button",optional:true,condition:e=>o.every((e=>e.element_version()>=u))&&i.current_multi_element.get_style_id()!=null&&i.current_multi_element.num_style_overrides()>0,click_cb:e=>{i.current_multi_element.clear_style_overrides();o.forEach((e=>{e.clear_style_overrides()}))},pretty:{section:"Appearance Settings",no_caption:true,width:"tiny"},include_in_redesign:false});const e=["edit_style","delete_style","reset_overrides_label"];e.forEach((e=>{const n=t.find((t=>t.name===e));const r=n.condition;n.condition=()=>g&&r()}))}if(a().visual_edit.responsive_version()>0){v.push({name:"group_elements",button_caption:d("group_elements_fixed"),editor:"Button",optional:true,condition(){return a().edit_canvas.can_group_elements()},click_cb(e){a().edit_canvas.do_group_elements_fixed()},pretty:{section:"ElementMetaActions"}})}else{v.push({name:"group_elements",button_caption:d("group_elements"),editor:"Button",optional:true,condition(){return a().edit_canvas.can_group_elements()},click_cb(e){a().edit_canvas.do_group_elements()},pretty:{section:"ElementMetaActions"}})}v.push(...t);return{fields:v,field_names:l,first_element:n,other_elements:r}};i.show_property_editor=function(e){if(!e||e.length<=1){return}r.run_once(30,(()=>i.find_common_fields(e)),((t,n)=>{if(t){l.log(t);return}const{fields:r,field_names:s,first_element:o,other_elements:c}=n;i.current_multi_element=_(r,s,e.length,o,c);a().visual_edit.currently_editing("fake_element_multiedit");a().visual_edit.should_show_property_editor(true)}))};function _(e,t,n,s,c){const u="fake_element_multiedit_"+r.UUID();const d=o.VirtualEditorJSON().child("elements").child(u);const p={name:"FakeMultiElement"};const _=o.new_element(d);const f=a().visual_edit.responsive_version()>0;const h=[s,...c];const m=h.map((e=>e.id()));if(c.every((e=>e.get_style_id()===s.get_style_id()))){_.json.child("style").set(s.get_style_id(),p)}r.extend(_,{type(){return"FakeMultiElement"},id(){return u},property_is_overriden(e){if(_.property(e).raw()!=null)return true;return h.some((t=>t.property(e).raw()!=null))},E:{fields(){const e=i.find_common_fields(m);t=e.field_names;r.run_once(30,(()=>{const e=_.json.child("properties").raw();for(const n in e){const r=e[n];const i=t[n].default;if(r!==i){_.json.child("properties").child(n).set(i)}}}),((e,t)=>{if(e){l.log(e)}}));return e.fields},field_names:t,property_supports_states:false,property_supports_transitions:false,uses_css_responsive:f,primary_field(){return e[0].name},is_visible_on_page_load(){return true}},set_property(e,t){_.json.child("properties").child(e).set(t,p);h.forEach((n=>{n.set_property(e,t)}))},original_property:_.property,property(e){var n;if((n=t[e])!=null&&n.default){return s.property(e)}return _.original_property(e)},set_style(e){_.json.child("style").set(e,p);h.forEach((t=>{t.set_style(e)}))},get_style_if_exists(){if(_.json.child("style").get()!=null){return s.get_style_if_exists()}return null},element_version(e){return s.element_version(e)},gen_name(){const e=s.type();if(h.every((t=>t.type()===e))){return"Edit "+n+" "+e+"s"}return"Edit "+n+" elements"},all_elements(){return h}});return _}},{"./../constants/elements":61,"./../lang/appquery":651,"./../lang/lang":714,"./../lib":741,"./../logger":744,"./../u":823,"./editor_language":569,"./utils/evaluate_condition":594,"core-js/modules/web.dom-collections.iterator.js":1123}],568:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./experimentation/amplitude");const i=e("../constants/experiments");const s=e("../logger");const o=e("../lib");const a=e("../u");const l=e("../u/shared/mode_check");const c=n;const u=10;let d;a.edit_mode_only();if(l.is_edit_mode()){c.is_initialized=a.MakeKey(u,"Initializing experimentation")}const p={amplitude:false,meta:false};const _=e=>{p[e]=true;if(p.amplitude&&p.meta){c.is_initialized.turn()}};const f={};c.initialize=async()=>{if(!d){d=Promise.all([new Promise((e=>e(m()))),r.initialize().then((()=>_("amplitude")))])}return await d};const h=e=>{const t=e==null?void 0:e.split("-");if(t.length>1){const e=t[0];const n=parseInt(t[1]);f[e]=n}};const m=()=>o().location.post("server://appeditor/check_user_experiments",{},(function(e,t){if(e){s.error(e);return}const n=t||[];n.forEach((e=>{h(e)}));let r=false;for(const e in i.BUBBLE_FRAMEWORK_EXPERIMENTS){const t=i.BUBBLE_FRAMEWORK_EXPERIMENTS[e].isActive;if(t){var a;const t=g(e);(a=f[e])!=null?a:f[e]=t;const i=`${e}-${t}`;const s=!n.includes(i);if(s){r=true;n.push(i)}}}if(r){o().location.post("server://appeditor/update_user_experiments",{experiment_list:n})}_("meta")}));const g=e=>o().experiment(e,i.EDITOR_EXPERIMENTS[e].numGroups);c.variant=e=>{var t,n;a.ensure_ready(c.is_initialized);if((t=i.EDITOR_EXPERIMENTS[e])!=null&&t.isAmplitude){return r.variant(e)}return(n=f[e])!=null?n:0};c.get_from_payload=(e,t)=>{var n;const i=r.all();const s=(n=i[e])==null?void 0:n.payload;return s==null?void 0:s[t]}},{"../constants/experiments":65,"../lib":741,"../logger":744,"../u":823,"../u/shared/mode_check":851,"./experimentation/amplitude":573,"core-js/modules/web.dom-collections.iterator.js":1123}],569:[function(e,t,n){"use strict";const r=e("./../u");const i=e("./../safe_require");const s=n;const o=e("./../logger");i.safe_register("./editor/editor_language",s);s.data={};s.get_text=function(e,t){const n=r.extract_from_object(s.data,e.split("."));if(!n&&!t){o.error("Missing editor language",{id:e})}return n}},{"./../logger":744,"./../safe_require":777,"./../u":823}],570:[function(e,t,n){"use strict";const r=n;const i=e("./../u");const s={show_short_videos:false,show_long_property_editor:{status:true,manually_changed:false},snap_mode:"edge",show_grid:false,show_gutter:true,show_lines:true,grid_step:60,grid_color:"rgba(210, 210, 210, 0.50)",gutter_step:20,gutter_color:"rgba(210, 210, 210, 0.20)",start_gutter:true,show_borders:false,border_color:"rgba(220, 220, 220)",xray_mode:false,lock_propeditor:false,show_visual_indicators:true,show_distances:true,distance_color:"rgba(255, 0, 0)",only_show_hidden:true,show_release:true,show_collaboration_arrows:true,no_thumbnails:false,dark_mode:false};const o={};const a="bubble_editor_settings";function l(){var e;let t=i.json_parse((e=i.readCookie(a))!=null?e:"{}",true);if(typeof t!=="object"){t={};i.eraseCookie(a)}return t}function c(){const e=window.localStorage.getItem(a);if(e){return JSON.parse(e)}const t=l();u(t);i.eraseCookie(a);return t}function u(e){window.localStorage.setItem(a,JSON.stringify(e))}const d=function(e){var t,n;if(s[e]==null){throw new i.UnexpectedError("Missing default for editor settings "+e)}const r=c();const a=(t=r[e])!=null?t:s[e];(n=o[e])!=null?n:o[e]=i.Box(a);return a};r.write=function(e,t){var n;const r=c();r[e]=t;u(r);(n=o[e])==null?void 0:n.call(o,t!=null?t:s[e])};r.get_setting=function(e){if(o[e]==null){d(e)}return o[e]()}},{"./../u":823}],571:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.createCrossAxis=u;n.createMainAxis=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../core/core_elements/components/utils/table_element");var i=l(e("../../lang/appquery"));var s=l(e("../../lang/lang"));var o=l(e("../../lib"));var a=e("../../u");function l(e){return e&&e.__esModule?e:{default:e}}const c=(e,t)=>{var n,l;const c=i.default.element(e);const u=c.parent();if(!u){throw new a.UnexpectedError("Couldn't find table parent of main axis.")}(n=(l=o.default.or_throw().visual_edit.current_editor_canvas).createElement)==null?void 0:n.call(l,{type:"TableMainAxis",goesOnDocument:false,mode:"select",isComponent:false,additionalOptions:{neighborId:e,direction:t}},u.id(),{left:0,top:0,width:0,height:0},(e=>{const t=(0,r.getAxes)(u,"TableCrossAxis");for(const n of t){const t=i.default.uid();const r={id:t,type:"TableCell",properties:{cell_main_axis_id:e},default_name:"Cell"};n.new_child_element(t,r)}s.default.wait_for_stable((()=>{i.default.commit_merge()}))}))};n.createMainAxis=c;function u(e,t){var n,r;const s=i.default.element(e);const a=s.parent();if(a==null)return;(n=(r=o.default.or_throw().visual_edit.current_editor_canvas).createElement)==null?void 0:n.call(r,{type:"TableCrossAxis",goesOnDocument:false,mode:"select",isComponent:false,additionalProperties:s.json.child("properties").raw(),additionalOptions:{neighborId:e,direction:t}},a.id(),{left:0,top:0,width:0,height:0})}},{"../../core/core_elements/components/utils/table_element":281,"../../lang/appquery":651,"../../lang/lang":714,"../../lib":741,"../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],572:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../u");r.edit_mode_only();const i=e("./slidablepanel");const s=e("./../lib");const o=e("../lang/btype_ids");const{get_composer:a}=e("./composer/compatibility/composers");const{allowableBtypes:l}=e("../lang/btypes_dropdowns");const c=n;c.ElementInspector=r.singleton(class e extends i.SlidablePanel{constructor(){super({title:"Element inspector"});this.inspector_zone=r.div("element-inspector-zone",this.canvas)}show(e){this.reveal();this.inspector_zone.empty();r.div("section-title",this.inspector_zone,"Custom states");const t=r.div("states-wrapper",this.inspector_zone);r.autorun((()=>{t.empty();const n=e=>{const n=r.div("state-row",t);r.autorun((()=>{if(s().composer.delay_autorun.dangerously_peek()){s().composer.delay_autorun.get();return}n.empty();const t=a("TextBox",s().composer.Owner(e.display()),{});t.get_canvas().on("blur",(()=>{if(t.get_canvas().val()!==e.display()){e.change_value(t.get_canvas().val(),e.value(),e.default_val())}}));t.get_canvas().addClass("state-caption");n.append(t.get_canvas());const i=p.get(e.value());const c=s().composer.Owner(e.is_list()?i.inner().id():i.id());const u=s().composer.Owner(e.is_list());const d=s().composer.Owner(e.default_val());function m(){let t;let n=c.get();if(u.get()){n=o.list_type(n)}if(n!==e.value()){t=undefined}else{t=d.get()}e.change_value(undefined,n,t)}let g;if(f.has_feature_enabled("reorg_component_selection")){g=new h({owner:c,contents:l().with_options({dropdown_width:"medium-large-large"}),on_change:m})}else{g=a("Dropdown",c,{set:s().sets.get_set("AllowableValues")(),on_change:m,dropdown_width_override:"medium-large-large"})}g.get_canvas().addClass("state-value");n.append(g.get_canvas());r.div("list-caption",n,"List");const v=a("Checkbox",u,{on_change:m});v.get_canvas().addClass("state-list");n.append(v.get_canvas());const b=r.div("delete-btn bubble-ui",n);b.on("vclick",(()=>e.delete()));if(e.can_have_default()){const t=r.div("default-wrapper",n);r.div("list-caption default",t,"Default value");const{composer_type:i,set:s}=_.get_composer_for_field(e.value());const o=a(i,d,{set:s,on_change:m,optional:true,dropdown_width_override:"short"});o.get_canvas().addClass("state-default");t.append(o.get_canvas())}}))};if(e.type()==="CustomElement"){const n=r.div("add-state-btn clickable",t,"This element is a reusable element, click here to edit the definition and modify states");n.on("vclick",(()=>{const t=f.custom_definition(e.get_static_property("custom_id")).get_name();if(t!=null){return window.change_to_custom(t)}}));return}for(const t of e.element_custom_states()){if(t.exists()){n(t)}}const i=r.div("add-state-btn clickable",t,"Add a new custom state");i.on("vclick",(()=>({display:"Create a new custom state...",hide_dropdown:true,thumbnail_id:"Documentation.Elements.GeneralConcepts.States.CustomStates",fn:(t,n,r)=>s().visual_edit.show_create_new_state_modal({div:t,preset_val:n,cb:r,element:e,is_message:false})}.fn(r.div(),undefined,(()=>{})))))}));function n(e,t){const n=r.div("item-row clickable",t);r.div("caption",n,e.display());n.on("vclick",(()=>u().show(e)));return n}const i={event:{fn:"find_events_using_this_element"},action:{fn:"find_actions_using_this_element"},other_element:{caption:"Other element",fn:"find_elements_using_this_element"}};for(const t in i){const{caption:s,fn:o}=i[t];const a=(s!=null?s:r.toTitleCase(t))+"s";r.div("section-title",this.inspector_zone,a);const l=r.div(t+" wrapper",this.inspector_zone);r.autorun((()=>{l.empty();const i=e[o]();if(i.length){for(const e of i){const r=n(e,l);if(t==="other_element"){d().add(r,e.id())}}}else{r.div("item-row nothing",l,"No "+a.toLowerCase()+" are associated with this element.")}}))}}});const u=e("./highlightbox");const d=e("./thumbnail");const p=e("./../lang/btypes");const _=e("./data_admin_panel");const f=e("./../lang/appquery");const{DropdownComposerInterface:h}=e("./composer/compatibility/solid_conversion/DropdownComposerInterface")},{"../lang/btype_ids":652,"../lang/btypes_dropdowns":654,"./../lang/appquery":651,"./../lang/btypes":653,"./../lib":741,"./../u":823,"./composer/compatibility/composers":532,"./composer/compatibility/solid_conversion/DropdownComposerInterface":535,"./data_admin_panel":562,"./highlightbox":578,"./slidablepanel":588,"./thumbnail":590,"core-js/modules/web.dom-collections.iterator.js":1123}],573:[function(e,t,n){"use strict";var r=e("@amplitude/experiment-js-client");const i=n;const s=e("../../client_config");const o=e("../../lib");const a=e("../../client/analytics");const l=s.amplitude_experiment_key||"unknown";const c=s.amplitude_experiments_enabled;let u;i.initialize=()=>{if(!u){if(c){u=r.Experiment.initialize(l,{exposureTrackingProvider:{track(e){a==null?void 0:a.track("$exposure",e)}}})}else{u={fetch(){return Promise.resolve(true)},variant(){return 0}}}}const e={user_id:o().current_user().id};return u.fetch(e)};i.variant=e=>{const t=u.variant(e);return t};i.all=()=>u.all()},{"../../client/analytics":20,"../../client_config":41,"../../lib":741,"@amplitude/experiment-js-client":861}],574:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../u");r.edit_mode_only();const i=e("../constants/known_plugins");const s=e("../services/shared/plugin_registry");const o=n;const a=e("./../core/core_elements/shared/image_utils");const l=e("./../logger");const c=e("../u/shared/decaf");o.ExternalImagePanel=r.singleton(class e{constructor(){this.canvas=r.div("modal-popup");$(document.body).append(this.canvas);this.canvas.hide();this.canvas.css("opacity",0);const e=r.div("popup-content",this.canvas);e.append(this.create_header());const t=r.div("children",e);this.sub_child=r.div("inner-children",t);this.canvas.on("vclick",(e=>{if(r.did_event_pass_through(e,".children")||r.is_on_mobile_or_tablet()){return true}this.hide();return true}));this.canvas.addClass("external-image-popup");r.div("instruction",this.sub_child).html('Search <a href="https://www.pexels.com" target="_blank">Pexels</a> for free pictures.');this.search_box=r.input("bubble-ui search-image",this.sub_child);this.search_box.on("blur",(()=>this.populate_list()));this.search_box.on("keypress",(e=>{if(e.which===13){this.search_box.blur()}}));this.images_area=r.div("images-area",this.sub_child);const n=r.div("bottom-stripe");const i=r.div("btn bubble-ui submit-button");i.text("IMPORT");n.append(i);this.sub_child.append(n);i.on("vclick",(()=>{if(!i.hasClass("disabled")){this.save()}}));this.currently_selected_image=r.Box(null);r.autorun((()=>{i.toggleClass("disabled",this.currently_selected_image()===null)}));const s=r.div("btn btn-cancel",n,"cancel");s.on("vclick",(()=>{this.hide()}));$(document).off("keydown.escape-externalimagepanel");$(document).on("keydown.escape-externalimagepanel",(e=>{if(e.keyCode===27){this.hide()}}));const o=()=>{this.images_area.css({"max-height":$(window).height()-400})};$(window).on("resize.externalimagepanel",(()=>o()));o()}create_header(){this.header=r.div("popup-title");this.header.text("Search for Free Images");return this.header}show(e){this.cb=e;$("body").css("overflow","hidden");this.canvas.show();r.velocity(this.canvas,"fadeIn",{duration:300});this.populate_list();this.currently_selected_image(null);this.images_area.find(".preview-img").removeClass("selected")}populate_list(){this.currently_selected_image(null);const e=this.search_box.val();if(e){this.get_query_pics(e)}else{this.get_latest_pics()}}get_latest_pics(){const e=s.get_hardcoded_plugin(i.PEXELS).get_call("GetFavoritesPexelsImages");r.run_once(30,(()=>({pexels_response:e.execute()})),((e,t)=>{if(e){l.log(e);this.display_pics([])}else{const e=t.pexels_response;this.display_pics(e)}}))}get_query_pics(e){const t=s.get_hardcoded_plugin(i.PEXELS).get_call("GetPexelsImages");r.run_once(30,(()=>({pexels_response:t.execute(undefined,{query:e})})),((e,t)=>{if(e){l.log(e);this.display_pics([])}else{const e=t.pexels_response;this.display_pics(e)}}))}display_pics(e){this.images_area.empty();if(e.length===0){r.div("no-image",this.images_area,"No images were found for that word :(");return}const t=e=>{const t=a.optimize_image(e,160,180,{force:e.indexOf("pexels")===-1});const n=r.img("preview-img",this.images_area,t);n.on("vclick",(()=>{this.currently_selected_image(e);this.images_area.find(".preview-img").removeClass("selected");n.addClass("selected")}))};for(const n of c.array_from(e)){t(n.url)}}save(){if(this.currently_selected_image()){try{const e=u().location.get_server_base()+"fileupload/byurl";let t=this.currently_selected_image().split("/");const n=t[t.length-1];t=n.split(".");const r=t[t.length-1];const i={success:e=>{this.cb(e);d.hide_general_message()},error(e){d.hide_general_message();if(e.responseText.indexOf("exceeded your allowed storage")!==-1){window.MessagePanel({title:"Storage limit",message:"Your application has exceeded your allowed storage. Please upgrade your plan or add storage in the editor."})}else{window.MessagePanel({title:"Error",message:"The image couldn't be fetched from Pexels"})}},type:"post",data:JSON.stringify({file_url:this.currently_selected_image(),data_type:"image/"+r,filename:n,appname:p.appname(),app_version:p.app_version()}),contentType:"application/json"};$.ajax(e,i);d.show_general_message("We're fetching the image...")}catch(e){alert("Issue fetching the image");return}}this.hide()}hide(){r.velocity(this.canvas,"fadeOut",{duration:300,complete_cb:()=>{$("body").css("overflow","auto");this.canvas.hide()}})}});const u=e("./../lib");const d=e("./../core/status_bar");const p=e("./../lang/appquery")},{"../constants/known_plugins":72,"../services/shared/plugin_registry":784,"../u/shared/decaf":844,"./../core/core_elements/shared/image_utils":363,"./../core/status_bar":415,"./../lang/appquery":651,"./../lib":741,"./../logger":744,"./../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],575:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.deferEditMode=u;n.popEnabled=l;n.returnDataCustomEvent=c;n.reusableElementProps=d;n.tableElementOn=a;var r=o(e("../lib"));var i=o(e("../safe_require"));var s=o(e("../lang/appquery"));function o(e){return e&&e.__esModule?e:{default:e}}i.default.safe_register("./editor/flag_check",n);function a(){return r.default.or_throw().location.get_query().table_element==="true"}function l(){return r.default.or_throw().location.get_query().bubble_pop==="true"}function c(){return r.default.or_throw().location.get_query().customeventreturn==="true"}function u(){return r.default.or_throw().location.get_query().defer_hidden_elements==="true"||(0,s.default)().has_feature_enabled("defer_edit_mode")}function d(){return r.default.or_throw().location.get_query().reusable_props==="true"}},{"../lang/appquery":651,"../lib":741,"../safe_require":777}],576:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");e("core-js/modules/web.url-search-params.js");var r=e("../optional/meta/meta_constants");var i=e("./guided_builds/editor_intro");var s=e("./components/bubble/visual_indicators/PropertyEditorIndicators");var o=e("./utils/property_editor_utils");const a=e("./../u");a.edit_mode_only();const l=e("../lang/uids");const c=e("./../logger");const u=e("../client/analytics");const d=e("../constants/segment_events");const p=e("../constants/test_apps");const _=e("./utils/evaluate_condition");const f=e("../lang/evaluation/node_eval");const{PADDING_VERSION:h,VERSION_STYLE_OVERRIDES:m,OLD_VERSION_OVERRIDE_PROPERTIES:g}=e("../constants/elements");const v=e("../lang/field_checker");const{FONT_STYLE_LIST:b}=e("../constants/fonts");const{DropdownContents:y}=e("./composer/utilities/dropdown_contents");const{STYLE_PROPS:w}=e("../constants/style");const{get_composer:x}=e("./composer/compatibility/composers");const j=e("./components/bubble/visual_indicators/PropertyEditorIndicators");const A=a.Box(null);const{createSignal:M}=e("solid-js");const[E,k]=M(false);const O=e("./editor_experiments");const{PROPERTY_EDITOR_WORKFLOW_AND_DATA_ONBOARDING_ID:S,PAYLOAD_KEY_EXPERIMENT_START_DATE:D,TREATMENT_VARIANT_ID:C}=e("../constants/experiments");function T(){const e=A();const t=e==null?void 0:e.currently_editing();if(!t){var n;if(((n=A())==null?void 0:n.tab_name)==="design"&&Re.get_setting("lock_propeditor")){return A().get_root()}return}if(t.indexOf("fake_element_multiedit")===0){return Ie.current_multi_element}let r=e==null?void 0:e.get_node_by_id(t);r=r.ensure_exists();return r}const N={};class P{constructor(){var e;this.is_active=a.Box(false);this.should_show_property_editor=a.Box(false);this.currently_editing=a.Box(null);this.new_element_just_drawn=false;const t=Re.get_setting("show_long_property_editor");this.ignore_clicks_on_button=t.manually_changed;this.always_show_full_property_editor=a.Box((e=t.status)!=null?e:false);F()}activate(){A(this);this.is_active(true)}deactivate(){this.is_active(false)}select(e){if(e.length===1){this.currently_editing(e[0])}else{this.currently_editing(null)}}deselect(){this.currently_editing(null)}edit_current_element(e,t){var n,r,i;(n=e)!=null?n:e=true;(r=t)!=null?r:t=false;if(t){a.run_once(30,(()=>T()),((e,t)=>{if(e){c.log(e);return}if(t&&t.primary_field()){F().current_tab("appearance");const e=t.property(t.primary_field());xe.call_on_owner(e.path(),"select")}}))}if(!(((i=A())==null?void 0:i.tab_name)==="design"&&Re.get_setting("lock_propeditor"))){this.should_show_property_editor(e)}}turn_on_light_design(){F().turn_on_light_design()}turn_off_light_design(){F().turn_off_light_design()}lock_on_screen(e,t){F().lock_on_screen(e,t)}unlock_on_screen(){F().unlock_on_screen()}}t.exports=P;P.get_editor=(e,t,n)=>{const r=v.getChecker(e,t);return new N[t.editor](e,t,n,r)};function I(e){return e.type()==="Popup"}function R(e){return e.type()==="Button"}function L(e){return e.type()==="RepeatingGroup"}function z(e,t,n,o,l,u,d,p){var _;(_=l)!=null?_:l=true;if(n.include_in_redesign){return}const f=a.div(Ae.PROP_ROW,e);f.attr(Ae.PROP_NAME,n.name);if(n.editor!=="ObjectList"){const e=Ce.for_property_editor(t,n,(e=>ze.get_plugin(e).documented()));if(e){De.DocumentationPalette().add(f,e)}}const h=a.div("prop-row-contents",f);let m;if(l){var g;m=(g=n.pretty)!=null?g:{}}else{m=false}a.autorun((()=>{var e,l,_;h.empty();if(!t.exists()&&((e=t.id())==null?void 0:e.indexOf("fake_element_multiedit"))===-1){return}if(!N[n.editor]){c.error("unrecognized editor",{property_editor:n.editor});return}const g=(l=(_=n.node_to_edit)==null?void 0:_.call(n,t))!=null?l:t;const v=P.get_editor(g,n,o);if(!v.condition()){f.addClass("hidden");return}f.removeClass("hidden");let b;if(u){var y;b=(y=n.long_caption)!=null?y:n.caption}else if(m.short_caption){if(m.short_caption===true){b=a.FirstLetterCapitalize($.trim(v.caption().replace(m.section,"")))}else{b=m.short_caption}}else if(!m.no_caption){b=v.caption()}else{b=null}if(m.width){f.addClass(m.width)}if(b){const e=a.div("caption",h);if(n.name.includes("param_")){e.addClass("param")}e.addClass(n.editor);e.text(b);if(b.length>19){e.attr("title",b)}if(n.subcaption){const t=a.div("subcaption",e);t.text(n.subcaption)}f.addClass("has-caption")}else{f.removeClass("has-caption")}a.autorun_once((()=>{const e=a.div("body",h);const o=a.div(["editor",n.editor],e);const l=v.get_canvas();if(d!=null){o.addClass("disabled");o.text(p)}else{o.removeClass("disabled");o.append(l)}function c(){function e(){const e=Ne().current_user().child(r.META_USER_FIELDS.created_date).get();const t=O.get_from_payload(S,D);const n=e>=new Date(t);if(!n)return false;const i=O.variant(S);return(i==null?void 0:i.value)===C}const t=Re.get_setting("show_visual_indicators");return!((window.sunglasses||e())&&t)}const u=e=>e.length===0||e.actions().length===0;function _(e){let n,r;switch(e){case j.ElementType.ButtonWithWorkflow:n=Ne().visual_edit.get_instance(t);r=Ne().action_canvas.get_related_workflows(n.element_id());return u(r);case j.ElementType.PopupWithData:case j.ElementType.RepeatingGroupWithData:return v.prop_node().is_empty();default:return false}}function m(e){return Pe.get_public_setting(i.PROPERTY_EDITOR_SETTINGS[e])===true}function g(){if(L(t)){return j.ElementType.RepeatingGroupWithData}else if(I(t)){return j.ElementType.PopupWithData}else if(R(t)){return j.ElementType.ButtonWithWorkflow}}function b(){let e=null;if(I(t)||L(t)){if(n.name==="group_type"){e={propertyJQuery:l.children(),propertyType:s.ReferencePropertyType.GroupType}}else if(n.name==="data_source"&&E()!==s.ReferencePropertyType.GroupType){e={propertyJQuery:l,propertyType:s.ReferencePropertyType.DataSource}}}else if(R(t)&&n.name==="start_workflow"){e={propertyJQuery:l,propertyType:s.ReferencePropertyType.Workflow}}return e}function y(){const e=b();if(!e)return;if(c())return;const t=g();if(_(t)){j.addHighlight(e.propertyJQuery);if(m(t))return;j.showHoverable(t,e,k,E)}else{if(m(t))return;if(n.name==="group_type"){k(s.ReferencePropertyType.None)}else if(n.name==="data_source"||n.name==="start_workflow"){k(s.ReferencePropertyType.None);(0,i.register_first_interaction_with_pe_property)(t)}}}const w=n.deprecated_date;const x=Pe.creation_date()!=null&&n.deprecated_date<Pe.creation_date();const A=f.hasClass("deprecated");if(w&&x){f.hide()}else{if(w&&!A){f.addClass("deprecated")}f.show();y()}}));if(n.plugin_doc){const e=a.div("show-doc-btn",f);const t=a.div("doc-content",f,n.plugin_doc);t.hide();const r=a.Box(false);a.autorun((()=>{if(r()){t.show();e.text("hide documentation")}else{t.hide();e.text("show documentation")}}));e.on("vclick",(()=>r(!r())))}}));return f}P.create_property_row=z;function B(){var e;a.ensure_ready(Ne().visual_edit_is_ready);if(!((e=window)!=null&&e.is_maison)){var t;if((t=Ne().styles_canvas)!=null&&t.owner.is_active()){return true}if(Ne().visual_edit.is_active()){var n;if(((n=T())==null?void 0:n.element_version(true))>=h){return true}return Ne().visual_edit.responsive_version()>0}return false}else{return false}}function q(){return B()&&Ne().visual_edit.responsive_mode_box()==="responsive"}P.update_name=U;function U(e){let{name:t,node:n}=e;if(n.type()==="Page"&&n.is_protected()){window.MessagePanel({title:"Built-in Page",message:"This page is built in and necessary for your app to function. You can't change its name."});return false}if(n.type()==="Page"){const[e]=Ne().appchange.validate_page_name(t,false);if(e){window.MessagePanel({title:"Renaming Page Element",message:e});return false}}if(n.type()==="CustomDefinition"){const[e]=Ne().appchange.validate_custom_name(t);if(e){window.MessagePanel({title:"Renaming Reusable Element",message:e});return false}}n.set_name(t);n.commit();return true}const F=a.singleton(class e{constructor(){const e="input,textarea,button,select,option,.a-color-picker,.composer, .text-composer, .show-more-less-button";this.canvas=a.div("property-editor-2",$("body"));this.canvas.draggable({cancel:e,start(){var e;(e=$(Ae.CONTEXTUAL_VIDEO_PALETTE))==null?void 0:e.find(".invisible-draggable-div").show()},stop(){var e;(e=$(Ae.CONTEXTUAL_VIDEO_PALETTE))==null?void 0:e.find(".invisible-draggable-div").hide()}});this.canvas.css("left",$(window).width()-o.INITIAL_PE_X_POSITION_OFFSET);this.light_design=a.Box(false);this.title=a.div("title",this.canvas);this.title_wrapper=a.div("title-wrapper",this.title);this.close_button=a.div("close-button",this.title);this.close_button.on("vclick",(()=>{this.hide()}));if(!p.APPS_WITHOUT_PE_HELP_BUTTON.includes(Pe.app().id())){this.comment_button=Te.get_button(this.title,undefined,T);if(this.comment_button){a.autorun((()=>{var e;const t=T();if((t instanceof Ee.GenericElement||t instanceof Ee.WorkflowObject)&&((e=t.id())==null?void 0:e.indexOf("fake_element_multiedit"))===-1){this.comment_button.show();Te.update_icon(t,this.comment_button)}else{this.comment_button.hide()}}))}}if(!p.APPS_WITHOUT_PE_INSPECTOR.includes(Pe.app().id())){this.element_inspector=Se.ElementInspector();this.inspect_button=a.div("inspect-button",this.title);a.autorun((()=>{var e,t;if(((e=T())==null?void 0:(t=e.id())==null?void 0:t.indexOf("fake_element_multiedit"))===-1){this.inspect_button.show()}else{this.inspect_button.hide()}}));this.inspect_button.on("vclick",(()=>{var e,t;(e=this.contextual_video_palette)==null?void 0:e.hide();if((t=this.element_inspector)!=null&&t.is_visible()){var n;(n=this.element_inspector)==null?void 0:n.hide()}else{var r;(r=this.element_inspector)==null?void 0:r.show(T())}}))}if(!p.APPS_WITHOUT_PE_HELP_BUTTON.includes(Pe.app().id())){De.DocumentationPalette().add(this.inspect_button,"Documentation.Interface.ElementInspector");this.contextual_video_palette=Oe.ContextualVideoPalette();this.help_button=a.div("help-button",this.title);this.help_button.on("vclick",(()=>{var e,t;(e=this.element_inspector)==null?void 0:e.hide();if((t=this.contextual_video_palette)!=null&&t.is_visible()){var n;(n=this.contextual_video_palette)==null?void 0:n.hide()}else{var r,i,s,o;(r=this.contextual_video_palette)==null?void 0:r.show(T().type(),true);u.track("Help Video Opened",{app:Pe.appname(),source:"Contextual",topic:(i=T())==null?void 0:i.type(),video:(s=this.contextual_video_palette)==null?void 0:s.get_video_id((o=T())==null?void 0:o.type())})}}))}a.autorun((()=>{if(this.light_design()){this.canvas.addClass("light-design");this.title.hide()}else{this.canvas.removeClass("light-design");this.title.show()}}));this.only_show_mandatory_sections={};this.clicks_on_show_more=0;this.showing_key=a.MakeSwitch(null,"property editor showing_key");this.current_tab=a.Box("appearance");const t=a.div("tabs",this.canvas);const n=a.div("tab "+Ae.APPEARANCE,t);n.addClass("opened");const r=a.div("tab "+Ae.CONDITIONAL,t);De.DocumentationPalette().add(r,"Documentation.Elements.GeneralConcepts.State");const i=a.div("tab "+Ae.TRANSITIONS,t);De.DocumentationPalette().add(i,"Documentation.Elements.GeneralConcepts.Transitions");n.text("Appearance");a.autorun((()=>{var e,t;const n=T();let s="Conditional";const o=n==null?void 0:(e=n.states)==null?void 0:(t=e.call(n))==null?void 0:t.length;if(o>0){s+=" ("+o+")"}const a=B()?i:r;a.text(s)}));a.autorun((()=>{if(B()){r.text("Layout");r.show()}else{var e,t,n,s;const r=T();let o="Transitions";const a=r==null?void 0:(e=r.transitions)==null?void 0:(t=e.call(r))==null?void 0:t.length;if(a>0){o+=" ("+a+")"}i.text(o);i.toggle((n=r==null?void 0:(s=r.property_supports_transitions)==null?void 0:s.call(r))!=null?n:true)}}));n.on("vclick",(()=>{if(!n.hasClass("opened")){this.current_tab("appearance")}}));r.on("vclick",(()=>{if(!r.hasClass("opened")){if(B()){this.current_tab("layout")}else{this.current_tab("conditional")}}}));i.on("vclick",(()=>{if(!i.hasClass("opened")){if(B()){this.current_tab("conditional")}else{this.current_tab("transitions")}}}));this.viewport=a.div("viewport",this.canvas);this.rows=a.div("rows overview",this.viewport);this.scroll_position=0;this.viewport.on("scroll",(()=>{this.scroll_position=this.viewport.scrollTop()}));this.showing_name_input=a.Box(false);$(document).on("keydown.property_editor",(e=>{if(this.showing_key.is_turned()&&!this.light_design()){if(e.keyCode===27){this.hide();Ne().SlidablePalette().hide()}}}));a.autorun((()=>{switch(this.current_tab()){case"appearance":n.addClass("opened");r.removeClass("opened");i.removeClass("opened");break;case"conditional":n.removeClass("opened");if(B()){i.addClass("opened");r.removeClass("opened")}else{r.addClass("opened");i.removeClass("opened")}break;case"transitions":if(B()){this.current_tab("appearance")}else{i.addClass("opened");n.removeClass("opened");r.removeClass("opened")}break;case"layout":if(!B()){this.current_tab("appearance")}else{r.addClass("opened");n.removeClass("opened");i.removeClass("opened")}}}));a.autorun((()=>{var e,t;const n=T();const r=n==null?void 0:(e=n.display)==null?void 0:e.call(n,true);if(!r){return}this.title_wrapper.empty();if((t=n.E)!=null&&t.generate_name){a.div("static-title disabled",this.title_wrapper,r);return}if(this.showing_name_input()){const e=a.input("name-input",this.title_wrapper);e.val(r);a.one_blur(e,(()=>{const t=U({name:e.val(),node:n});if(!t){e.val(r)}this.showing_name_input(false)}));e.on("keydown",(t=>{var n;const r=(n=t.keyCode)!=null?n:t.which;if(r===13){e.change()}return null}))}else{const e=a.div("static-title",this.title_wrapper,r);let t=false;e.on("vmousedown",(()=>{t=true}));e.on("vmouseup",(()=>{if(!t){return}t=false;if(!this.canvas.hasClass("ui-draggable-dragging")){this.showing_name_input(true);a.wait_for_updates((()=>{this.canvas.find(".name-input").focus()}))}}))}}));a.autorun((()=>{var e,t,n;const r=T();let i=r!=null&&((e=A())==null?void 0:e.should_show_property_editor());(t=this.contextual_video_palette)==null?void 0:t.hide(true);(n=this.element_inspector)==null?void 0:n.hide(true);const s=new URLSearchParams(window.location.search);const o=s.get("tab");if(!["tabs-1","tabs-2","tabs-4"].includes(o)){i=false}if(i){var a;i=(r==null?void 0:(a=r.fields)==null?void 0:a.call(r).length)>0}if(i){var l;this.canvas.show();this.showing_key.turn_on();this.make_sure_is_visible();if(((l=r.id())==null?void 0:l.indexOf("fake_element_multiedit"))===-1){const e=A().get_rendered_canvas(r);if(e){this.make_sure_not_hiding_element(e)}}if(!this.light_design()){var c;(c=this.contextual_video_palette)==null?void 0:c.show_hide_help_button(r.type(),this.help_button)}if(A().new_element_just_drawn){var u;(u=this.contextual_video_palette)==null?void 0:u.show(r.type());A().new_element_just_drawn=false}}else{this.canvas.hide();this.showing_key.turn_off()}}));a.autorun((()=>{var e;if(Ne().composer.delay_autorun.dangerously_peek()){Ne().composer.delay_autorun.get();return}a.force_focus_change();const n=T();this.rows.empty();this.rows.attr("node_type",n==null?void 0:(e=n.type)==null?void 0:e.call(n));this.showing_name_input(false);if(n){var r,i,s,o,l,c;t.show();if(n instanceof Ee.GenericElement){var u;(u=this.inspect_button)==null?void 0:u.show()}else{var d;(d=this.inspect_button)==null?void 0:d.hide()}(r=this.canvas.find(".add-new-state"))==null?void 0:r.remove();(i=this.canvas.find(".show-more-less"))==null?void 0:i.remove();(s=this.canvas.find(".add-new-transition"))==null?void 0:s.remove();(o=this.canvas.find(".no-conditionals-text"))==null?void 0:o.remove();(l=this.canvas.find(".info-section"))==null?void 0:l.remove();if(this.current_tab()==="conditional"){this.show_conditional(n)}else if(this.current_tab()==="transitions"&&(c=n.property_supports_transitions)!=null&&c.call(n)){this.show_transitions(n)}else if(this.current_tab()==="layout"){this.show_layout(n)}else{this.show_appearance(n)}if(n.id().indexOf("fake_element_multiedit")===-1){const e=A().get_rendered_canvas(n);if(e){this.make_sure_not_hiding_element(e)}}}this.make_sure_is_visible()}))}show_appearance(e){let t;if(B()){if(Ne().visual_edit.responsive_version()>0){t="appearance"}else{t="legacy_appearance"}}else{t="legacy_appearance"}this.show_properties(e,e.property_sections(t))}show_layout(e){var t;let n;if((t=e.is_style)!=null&&t.call(e)){n="styles_layout"}else if(Ne().visual_edit.responsive_version()>0){n="layout"}else{n="legacy_layout"}this.show_properties(e,e.property_sections(n));if(!this.canvas.find(".section:visible").length){const e=a.div("info-section",this.canvas);e.text("Layout tab settings are only available on certain elements.")}}show_properties(e,t){var n,r,i;const s=e.fields();this.disabled_short_version=(n=A())==null?void 0:n.always_show_full_property_editor();const o=e.id();if(o&&!this.only_show_mandatory_sections[o]){this.only_show_mandatory_sections[o]=a.Box(true)}let l;if(!this.disabled_short_version&&e.mandatory_sections()&&(r=(i=this.only_show_mandatory_sections)[o])!=null&&r.call(i)){const n=e.mandatory_sections();l=t.filter((e=>n.includes(e.name)))}else{l=t}const u=l.map((e=>e.name));const d=t.map((e=>e.name));const p={};for(const e of s){var _;const t=(_=e.pretty)==null?void 0:_.section;p[t]=true}const f={};for(const n of t){if(p[n.name]){var h;f[n.name]=this.create_section(n);if((h=e.get_style_if_exists)!=null&&h.call(e)&&w.includes(n.name)){f[n.name].addClass("style-prop")}else{f[n.name].removeClass("style-prop")}if(u.includes(n.name)){f[n.name].show()}else{f[n.name].hide()}}if(n.name==="Transitions"){this.show_transitions(e,true)}}for(const t of s){var m;const n=(m=t.pretty)==null?void 0:m.section;if(d.includes(n)){if(!f[n]){c.error("property wants to be in section that does not exist",{property_name:t.name,section_name:n})}else{const r=z(f[n],e,t);if(t.additional_class){r.addClass(t.additional_class)}}}}if(!this.disabled_short_version&&e.mandatory_sections()){const e=a.div("show-more-less",this.canvas);const t=a.div("show-more-less-button",e);if(this.only_show_mandatory_sections[o]()){t.text("   Show all properties");t.removeClass("show-less");t.addClass("show-more");t.on("vclick",(()=>{var e;this.only_show_mandatory_sections[o](false);this.clicks_on_show_more++;if(!((e=A())!=null&&e.ignore_clicks_on_button)&&this.clicks_on_show_more>5){var t;(t=A())==null?void 0:t.toogle_show_all_options_property_editor();this.clicks_on_show_more=0}}))}else{t.text("   Simple view");t.addClass("show-less");t.removeClass("show-more");t.on("vclick",(()=>{this.only_show_mandatory_sections[o](true)}))}}for(const e of d){var g,v;if(((g=f[e])==null?void 0:g.find(".row").length)===((v=f[e])==null?void 0:v.find(".row.hidden").length)){var b;(b=f[e])==null?void 0:b.hide()}}if(!this.canvas.is(":visible")){return}if(!this.canvas.find(".section:visible").length){c.verbose("trying to hide the property because it had no visible sections",{sections:t,section_names:d,section_to_display_names:u});$(".section").hide()}}show_conditional(e){var t;if(!((t=e.property_supports_states)!=null&&t.call(e))){const e=a.div("no-conditionals-text",this.canvas);e.text("Conditional expressions cannot be created or edited on multiple elements at this time.");return}let n;if(e.get_style_id()){for(n of e.get_style().states()){this.create_style_state_row(n,e)}}for(n of e.states()){this.create_state_row(n,e)}const r=a.div("add-new-state",this.canvas);const i=a.div("add-new-state-button",r);i.text("   Define another condition");i.on("vclick",(()=>{e.new_state();e.commit();setTimeout((()=>this.scroll_to_bottom()),20)}));Le().add_handler(r,(t=>{Le().open(t,"context-menu composer",[["Paste condition",()=>this.paste_condition(e),()=>!this.can_paste_condition()]]);Le().set_focus_owner(r)}))}select_layout_tab(){this.current_tab("layout")}move_property_editor(e,t){var n,r;(n=e)!=null?n:e=0;(r=t)!=null?r:t=0;if(e){this.canvas.css("left",e)}if(t){this.canvas.css("top",t)}}create_state_toggle(e,t,n){const r=a.div("state_toggle",n);if(q()){r.css("cursor","default");a.autorun((()=>{let n=Ne().visual_edit.get_state_eval_context();if(n){n=a.extend(n,{element:Ne().visual_edit.get_instance(t)})}if(f.evaluate_state_condition(e,n)){r.text("ON")}else{r.text("OFF")}}))}else{r.addClass("toggleable");a.autorun((()=>{const n=t.is_on_edit_mode(e);if(n){r.text("ON")}else{r.text("OFF")}r.toggleClass("showing",n)}));r.on("vclick",(()=>t.toggle_state_edit_mode(e)))}De.DocumentationPalette().add(r,"Documentation.Elements.GeneralConcepts.State.toggle_state")}add_state_context_menu(e,t,n){Le().add_handler(e,(r=>{Le().open(r,"context-menu composer",[["Copy condition",()=>this.copy_condition(t),()=>{}],["Paste condition",()=>this.paste_condition(n),()=>!this.can_paste_condition()]]);Le().set_focus_owner(e)}))}copy_condition(e){const t=a.deep_copy({},e.json.raw());a.add_source_appname_tracker(t,Pe.appname());a.local_storage_put("bubble_state_clipboard",t)}can_paste_condition(){return a.local_storage_get("bubble_state_clipboard")!=null}paste_condition(e){const t=a.local_storage_get("bubble_state_clipboard");const n=e.field_names();if(n!==Ee.DETECT_FIELD_NAMES){for(const e in t.properties){if(!n[e]){delete t.properties[e]}}}e.new_state(t);e.commit();setTimeout((()=>this.scroll_to_bottom()),20)}create_style_state_row(e,t){const n=a.div("state section from-style",this.rows);this.add_state_context_menu(n,e,t);a.autorun((()=>{n.empty();a.div("condition-caption",n,"When");a.div("condition-from-style",n,e.condition().get_tree_display());a.div("style-description",n,"Properties defined in the style "+t.get_style().display())}))}create_state_row(e,t){const n=a.div("state section",this.rows);this.add_state_context_menu(n,e,t);a.autorun((()=>{if(Ne().composer.delay_autorun.dangerously_peek()){Ne().composer.delay_autorun.get();return}n.empty();this.create_state_toggle(e,t,n);const r=a.div("remove-state toggleable",n,"remove condition");De.DocumentationPalette().add(r,"Documentation.Elements.GeneralConcepts.State.remove_state");r.on("vclick",(()=>{e.delete();e.commit()}));if(e.rank()<t.states().length-1){const t=a.div("move-down toggleable",n,"move down");De.DocumentationPalette().add(t,"Documentation.Elements.GeneralConcepts.State.move_down");t.on("vclick",(()=>{const t=n.next();const r=t.height()+15;t.hide();n.css("margin-bottom",r);a.velocity(n,{"margin-top":r,"margin-bottom":0},{duration:500,complete_cb(){e.move_down();e.commit();setTimeout((()=>{n.css("margin-top",0);t.show()}),10)}})}))}if(e.rank()>0){const t=a.div("move-up toggleable",n,"move up");De.DocumentationPalette().add(t,"Documentation.Elements.GeneralConcepts.State.move_up");t.on("vclick",(()=>{const t=n.prev();const r=t.height()+5;t.hide();n.css("margin-top",r);a.velocity(n,{"margin-top":0,"margin-bottom":r},{duration:500,complete_cb(){e.move_up();e.commit();setTimeout((()=>{t.show();n.css("margin-bottom",0)}),10)}})}))}a.div("condition-caption",n,"When");const i=a.div("condition",n);const s={write_child(t,n){e.set_condition(n)},get_expression_owner(){return e}};const o=a.autorun_return((()=>e.condition().json));const l=x("ExpressionComposer",s,{json:o,expected_value:"sys.bool"});De.DocumentationPalette().add(i,"Documentation.Elements.GeneralConcepts.State.condition");i.append(l.get_canvas());const c=t.fields(true);const u=a.div("property-rules",n);const d={};const p=a.autorun_return((()=>e.properties().map((e=>e.node_name()))));for(const n of p){let r=null;for(const e of c){if(e.name===n&&!e.include_in_redesign){r=e;d[e.name]=true}}if(r===null){continue}const i=r.condition;r.condition=()=>_(i,t)||_(i,e);if(!_(r.condition,e)){e.set_property(r.name,null);e.commit_merge();continue}const s=t.property(r.name);const o=r.editor==="Color"&&r.dynamic;if(s.is_static()||o){var f,h;const t=(f=(h=s.get_static)==null?void 0:h.call(s))!=null?f:r.default;if(e.property(r.name).is_empty()&&(r.default!=null||r.empty_possible)){if(o){var m,g;if(!((m=e.property(r.name).raw())!=null&&m.is_dynamic)||r.empty_possible&&!((g=e.property(r.name).raw())!=null&&g.is_dynamic)){e.set_property(r.name,t!=null?t:"#FFFFFF")}}else{e.set_property(r.name,t)}}}const l=z(u,e,r,null,false,true);const p=a.div("delete-state-property-container",l);const v=a.div("delete-state-property");p.append(v);v.on("vclick",(()=>{e.set_property(r.name,null);e.commit()}))}const v=a.div("add-new-property-rule",n);a.autorun((()=>{v.empty();let n=c.filter((e=>!e.no_states&&!d[e.name]&&!["Label","Button"].includes(e.editor)&&!e.name.includes("param_")));n=n.filter((n=>_(n.condition,t)||_(n.condition,e)));const r=[{name:"Position"}].concat(t.property_sections());const i=[];for(const e of r){for(const t of n){if(t.pretty.section===e.name){i.push(t)}}}const s=Ne().sets.get_set("Object")(a.to_object(i.map((e=>{var t;return[e.name,(t=e.long_caption)!=null?t:e.caption]}))));const o=xe.Owner();const l=x("Dropdown",o,{set:s,optional:true,dropdown_width_override:"extra_extra_large",placeholder:"Select a property to change when true"});v.append(l.get_canvas());De.DocumentationPalette().add(l.get_canvas(),"Documentation.Elements.GeneralConcepts.State.properties");o.on_change((t=>{if(t!=null){var n;const r=c.find((e=>e.name===t));e.set_property(t,(r==null?void 0:r.editor)==="Checkbox"?(n=r.default)!=null?n:false:Ee.RAW.Empty());e.commit()}}))}))}))}show_transitions(e,t){var n;if(qe.includes(e.type())||!((n=e.property_supports_transitions)!=null&&n.call(e))){return}if(e.get_style_id()){for(const t of e.get_style().transitions()){this.create_style_transition_row(t,e)}}const r=Object.fromEntries(e.fields(true).map((e=>[e.name,e.transition])));for(const t of e.transitions()){const n=t.prop_name();if(r[n]){this.create_transition_row(t,e)}}const i=a.div("add-new-transition",t?this.rows:this.canvas);const s=e.fields(true);const o={};const l=a.autorun_return((()=>e.transitions().map((e=>e.prop_name()))));for(const t of l){let n=null;for(const e of s){if(e.name===t){n=e;o[e.name]=true}}if(n===null){console.log("could not find property "+t+" on "+e)}}const c=s.filter((e=>e.transition&&!o[e.name]));const u=Ne().sets.get_set("Object")(a.to_object(c.map((e=>{var t;return[e.name,(t=e.long_caption)!=null?t:e.caption]}))));const d=xe.Owner();const p=x("Dropdown",d,{set:u,optional:true,dropdown_width_override:"extra_extra_large",condition(e){return!qe.includes(e.type())},placeholder:"Select a property to define a new transition"});i.append(p.get_canvas());De.DocumentationPalette().add(i,"Documentation.Elements.GeneralConcepts.Transitions.add_new");d.on_change((t=>{if(t!=null){e.add_transition(t);e.commit()}}))}get_transition_title(e){const t=e.prop_name_display();if(B()){return`${t} transition`}else{return t}}create_style_transition_row(e,t){const n=a.div("transition section from-style",this.rows);a.autorun((()=>{n.empty();n.attr("key",e.prop_name());a.div("transition-property",n,this.get_transition_title(e));a.div("transition-from-style",n,"Transition defined in the style "+t.get_style().display())}))}create_transition_row(e,t){const n=a.div("transition section",this.rows);a.autorun((()=>{n.empty();n.attr("key",e.prop_name());a.div("transition-property",n,this.get_transition_title(e));const t=a.div("delete-transition-container",n);const r=a.div("delete-transition",t);De.DocumentationPalette().add(r,"Documentation.Elements.GeneralConcepts.Transitions.remove");r.on("vclick",(()=>{e.delete();e.commit()}));const i=a.div("transition-duration",n);De.DocumentationPalette().add(i,"Documentation.Elements.GeneralConcepts.Transitions.duration");a.autorun((()=>{const t={write_child(t,n){e.set_property("duration",n)},get_expression_owner(){return e}};a.div("duration-caption",i,"Duration (ms)");const n=x("Dropdown",t,{json:e.duration_node(),default_value:500,set:Ne().sets.get_set("Integer")([100,200,500,700,1e3]),numerical_step:1});i.append(n.get_canvas())}));const s=a.div("transition-fn",n);De.DocumentationPalette().add(s,"Documentation.Elements.GeneralConcepts.Transitions.duration_fn");a.autorun((()=>{const t={write_child(t,n){e.set_property("fn",n)},get_expression_owner(){return e}};const n=x("Dropdown",t,{json:e.fn_node(),default_value:"ease",set:Ne().sets.get_set("List")(ke.transition_fns),dropdown_width_override:"medium-large"});s.append(n.get_canvas())}))}))}hide(){var e,t,n,r;if(((e=A())==null?void 0:e.tab_name)==="design"&&Re.get_setting("lock_propeditor")){return}(t=A())==null?void 0:t.should_show_property_editor(false);(n=this.contextual_video_palette)==null?void 0:n.hide(true);(r=this.element_inspector)==null?void 0:r.hide(true)}scroll_to_bottom(){this.viewport.scrollTop(this.rows.height()-this.viewport.height())}make_sure_is_visible(){if(this.canvas.hasClass("ui-draggable-dragging")){return}setTimeout((()=>{if(this.canvas.is(":visible")){let e=this.canvas.offset().top-$(document).scrollTop();const t=this.canvas.height();if(e<-t+50||e>$(window).height()-50){e=130;a.velocity(this.canvas,{top:e},{duration:300})}if(this.canvas.offset().left+this.canvas.width()>$(window).width()){this.canvas.css("left",$(window).width()-this.canvas.width()-5)}}}),20)}make_sure_not_hiding_element(e){if(!e.length||$.contains(this.canvas[0],e[0])||this.canvas.hasClass("ui-draggable-dragging")||e.parents(".composer-palette").length){return}setTimeout((()=>{if(this.canvas.is(":visible")&&a.is_attached(e)){const{top:t}=e.offset();const{left:n}=e.offset();const r=e.height();const i=t+r;const s=e.width();const o=n+s;if(this.canvas.offset().top<t&&t<i&&i<this.canvas.offset().top+this.canvas.height()&&this.canvas.offset().left<n&&n<o&&o<this.canvas.offset().left+this.canvas.width()){let e,i,l;if(o<$(window).width()-this.canvas.width()-150){i=n+s+30}else if(n>this.canvas.width()+40){i=n-this.canvas.width()-30}else if(t>$(window).scrollTop()+$(window).height()/2){l=t-this.canvas.height()-30}else{l=t+r+30}if(l){e={top:l}}else{e={left:i}}a.velocity(this.canvas,e,{duration:300});this.canvas.find(".insert-dynamic").hide()}}}),20)}create_section(e){let t;const n=a.div("section",this.rows);if(typeof e.name==="string"){if(e.show_title){const t=a.div("section-title",n);t.text(e.name)}t=e.name}else{var r,i,s;t=(r=(i=(s=T()).type)==null?void 0:i.call(s))!=null?r:""}n.attr("section_name",t);return n}turn_on_light_design(){this.light_design(true)}turn_off_light_design(){this.light_design(false)}lock_on_screen(e,t){this.locked=true;if(this.canvas.is(":visible")){this._old_position=this.canvas.offset()}this.canvas.draggable("disable");const n=()=>{this.viewport.css("max-height",$(window).height()-(t?175:315))};$(window).off("resize.when-locked");$(window).on("resize.when-locked",n);n();if(e){this.canvas.css(e)}this.close_button.hide()}unlock_on_screen(){if(this.locked===false){return}this.locked=false;if(this._old_position!=null){this.canvas.css(this._old_position);this._old_position=null}this.canvas.draggable("enable");$(window).off("resize.when-locked");const e=()=>{this.viewport.css("max-height",Math.max(470,$(window).height()-200))};$(window).off("resize.when-non-locked");$(window).on("resize.when-non-locked",e);e();this.close_button.show()}});n.only_show_mandatory_sections=F.only_show_mandatory_sections;t.exports.evaluate_condition=_;if(typeof window!=="undefined"&&window!==null){window.PropertyEditor=F;window.make_sure_not_hiding_element=e=>F().make_sure_not_hiding_element(e)}class W{constructor(e,t,n,r){this.node=e;this.property=t;this.parent_editor=n;this.checker=r;if(this.condition()){for(const e of this.required){if(this.property[e]==null){throw new a.UnexpectedError(this.property.editor+" requires you to set ."+e+" for "+this.node.type()+" property "+this.name()+" with the node path being "+this.node.path())}}}}condition(){return this.checker.condition()}optional(){return this.checker.optional()}empty(){return this.prop_node().is_empty()}caption(){return this.checker.caption()}display(){return this.checker.display()}name(){return this.checker.name()}prop_node(){var e,t,n,r,i;return(e=(t=(n=(r=this.property).prop_node)==null?void 0:n.call(r,this.node))!=null?t:(i=this.parent_editor)==null?void 0:i.get_sub_prop_node(this.node,this.name()))!=null?e:this.node.property(this.name())}default(){return this.property.default}get_value_from_style(){var e,t,n,r;if(this.node.type()==="FakeMultiElement"){return null}if(((e=(t=this.node).get_style_if_exists)==null?void 0:e.call(t))!=null&&(n=(r=this.node).is_styleable_property)!=null&&n.call(r,this.name())){const e=this.node.get_style_if_exists();return e.get_styleable_static_property(this.name())}else{return null}}get_canvas(){if(!this.composer){this.composer=this.get_composer()}return this.composer.get_canvas()}write_child(e,t){if(this.property.no_write_child){return}if(this.parent_editor){this.parent_editor.write_sub_node(this.node,this.name(),t)}else{this.node.set_property(this.name(),t)}}get_expression_owner(){var e,t;return(e=(t=this.parent_editor)==null?void 0:t.get_expression_owner())!=null?e:this.node}type_check(e,t){return this.checker.type_check(e,t,this.prop_node())}is_numberlike_text(){return this.checker.is_numberlike_text(this.prop_node())}}W.prototype.required=[];function G(e){const t=e.json.raw();if(t!=null&&typeof t==="string"){const n={name:"ConvertStaticToDynamicExpression"};e.json.set(Ee.RAW.TextExpression([t]),n)}}class V extends W{get_composer(){G(this.prop_node());return x("ShortTextComposer",this,{json:this.prop_node().json,default_value:this.default()})}expected_value(){return this.checker.expected_value()}}N.ShortText=V;class H extends V{get_composer(){G(this.prop_node());const e=this;return x("LongTextComposer",this,{json:this.prop_node().json,default_value:this.default(),no_enter:this.property.no_enter,focus_cb(){F().viewport.scrollTop(F().scroll_position)},get additional_button(){if(e.property.no_rich_text_editing){return null}else{return{get text(){return e.property.html_code_editor?"HTML editor":"Rich text editor"},onClick:e.make_rte_editor.bind(e),class:"rich-text"}}}})}make_rte_editor(){new Me.RichTextEditor(this.node,this.property.name,this.property.html_code_editor)}get_canvas(){if(!this.composer){this.composer=this.get_composer()}const e=a.div("long-text-composer-wrapper");e.append(this.composer.get_canvas());if(this.property.name.indexOf("param_")===0){e.find(".long-text-composer").addClass("param")}if(!window.composer_revamp){if(this.property.no_rich_text_editing){return e}e.addClass("rich-text");const t=a.div("bb-code-button",e,this.property.html_code_editor?"HTML editor":"Rich text editor");t.on("vclick",this.make_rte_editor.bind(this))}return e}}N.LongText=H;class X extends W{editor_value(){let e;if(this.property.editor_value){e=je.get(this.property.editor_value)}else{if(typeof this.property.value==="string"&&this.property.value.indexOf("!")===-1&&this.property.value.indexOf("*")===-1){e=je.get(this.property.value)}if(typeof this.property.value.id==="function"){e=this.property.value}}return e}get_composer(){if(["number","date"].includes(this.property.value)){var e,t;const n={name:"AutoRepairEditorJSON"};if(this.prop_node().type()==="TextExpression"&&!((e=(t=this.prop_node()).entries)!=null&&e.call(t).length)){this.prop_node().json.set(null,n)}else if(this.prop_node().entries!=null){const e=this.prop_node().entries().filter((e=>!e.is_static()||e.get_tree_display()!==""));if(!e.length){this.prop_node().json.set(null,n)}else if(e.length===1){const t=e[0];if(t instanceof Ee.DataSource){this.prop_node().json.set(t.raw(),n)}else if(t instanceof Ee.Literal){const e=t.get_literal();if(this.property.value==="number"&&e!=null&&!isNaN(e)){this.prop_node().json.set(Number(e),n)}}}}}const n=x("ExpressionComposer",this,{json:this.prop_node().json,default_value:this.default(),expected_value:this.property.value,editor_value:this.editor_value(),optional:this.optional(),dont_show_default_value:this.property.dont_show_default_value});function r(e){if(!I(e.node)&&!L(e.node))return;if(e.prop_node().is_empty()){var t;j.addHighlight((t=e.composer)==null?void 0:t.canvas)}else{var n;j.removeHighlight((n=e.composer)==null?void 0:n.canvas)}}function o(e){if(!I(e.node)&&!L(e.node))return;if(!e.prop_node().is_empty()&&E()!==s.ReferencePropertyType.None){var t;k(s.ReferencePropertyType.None);j.removeHighlight((t=e.composer)==null?void 0:t.canvas);if(L(e.node)){(0,i.register_first_interaction_with_pe_property)(j.ElementType.RepeatingGroupWithData)}else if(I(e.node)){(0,i.register_first_interaction_with_pe_property)(j.ElementType.PopupWithData)}}}a.autorun((()=>{if(xe.selected(this.prop_node().path(),true)){if(this.property.value_setter){var e,t;if((e=(t=this.property.value_setter).no_need_to_show_message)!=null&&e.call(t)){if(!this.prop_node().is_empty()){this.property.value_setter.property_modifier(this.prop_node())}}else{this.message_popup=new be(n.get_canvas(),(()=>{this.property.value_setter.property_modifier(this.prop_node())}));a.autorun((()=>{var e;if(I(this.node)||L(this.node)){r(this);o(this)}const t=(e=this.property.value_setter)==null?void 0:e.generate_message(this.prop_node());if(t){const{message:e,button_caption:n}=t;this.message_popup.show(e,n)}else{this.message_popup.hide()}}),(()=>{this.message_popup.remove()}))}}}else{var i;(i=this.message_popup)==null?void 0:i.remove()}}));return n}expected_value(){return this.checker.expected_value()}}X.prototype.required=["value"];N.Basic=X;class Y extends W{optional(){return true}get_composer(){return{get_canvas(){return $('<div class="no-editor-not-found"></div>')}}}}N.NoEditor=Y;function K(e){const t=e.get_style_if_exists();for(const n of b){if(!!t.get_styleable_static_property(n)!==!!e.get_styleable_static_property(n)){return true}}return false}const J=e=>{var t,n,r,i;const s=e.property.name;const o=(t=(n=e.node).element_version)==null?void 0:t.call(n);const a=o>=m||e.property.allow_overrides&&g.includes(s);if(a&&e.node.get_style_if_exists()!=null&&(r=(i=e.node).is_styleable_property)!=null&&r.call(i,s)&&!g.includes(s)){var l,c;if(b.includes(s)){if(!K(e.node)){e.node.decrement_style_overrides(s);return{inherited:true}}else{e.node.increment_style_overrides(s);return{inherited:false}}}const t=e.node.property(s).raw();if(t!=null){e.node.increment_style_overrides(s);return{inherited:false}}if(e.node.type()==="FakeMultiElement"&&(l=(c=e.node).property_is_overriden)!=null&&l.call(c,s)){e.node.increment_style_overrides(s);return{inherited:false}}return{inherited:true}}return{inherited:false}};class Z extends W{get_composer(){var e;return x("Checkbox",this,{json:this.prop_node().json,default_value:(e=this.get_value_from_style())!=null?e:this.default(),on_change:this.property.on_change,get_css_classes:()=>J(this)})}optional(){return true}}N.Checkbox=Z;class Q extends W{get_composer(){return x("TextBox",this,{json:this.prop_node().json,default_value:this.default(),validation_fn:this.property.validation_fn,on_blur_only:this.property.on_blur_only})}}N.StaticText=Q;class ee extends W{get_composer(){const e=x("TextBox",this,{json:this.prop_node().json,default_value:this.default(),validation_fn:this.property.validation_fn,on_blur_only:true,on_blur_transform(e){var t;return(t=Ne().editor_vendor.chrono.parseDate(e))==null?void 0:t.getTime()},display_formatter(e){return String(new Date(e))}});return e}}N.StaticDate=ee;class te extends W{get_composer(){return x("MultilineTextBox",this,{json:this.prop_node().json,default_value:this.default(),on_blur_only:this.property.on_blur_only})}}N.StaticMultiLineText=te;class ne extends W{get_composer(){var e;return x("NumberBox",this,{json:this.prop_node().json,default_value:(e=this.get_value_from_style())!=null?e:this.default(),integer:this.property.integer,validation_fn:this.property.validation_fn,on_blur_only:this.property.on_blur_only,optional:this.optional(),placeholder:this.property.placeholder,get_css_classes:()=>J(this)})}}N.StaticNumber=ne;class re extends W{get_composer(){return x("CSSDimensionBox",this,{json:this.prop_node().json,default_value:this.default(),optional:this.optional(),placeholder:this.property.placeholder})}}N.CSSDimension=re;class ie extends W{get_composer(){var e;let t;if(this.property.dynamic){var n,r,i,s;if((n=(r=this.node).is_style)!=null&&n.call(r)||(i=(s=this.node.context_element()).is_style)!=null&&i.call(s)){t="Color"}else{t="DynamicColor"}}else{t="Color"}return x(t,this,{json:this.prop_node().json,default_value:(e=this.get_value_from_style())!=null?e:this.default(),empty_possible:this.property.empty_possible,get_css_classes:()=>J(this)})}expected_value(){return this.checker.expected_value()}}N.Color=ie;class se extends W{get_composer(){return x("Image",this,{json:this.prop_node().json,default_value:this.default()})}}N.Image=se;class oe extends W{get_composer(){return x("IconInput",this,{json:this.prop_node().json,default_value:this.default(),icon_list:this.property.icon_list})}}N.IconPicker=oe;class ae extends W{get_canvas(){let e;if(this.property.name.indexOf("param_")===0){e=a.div("params-dynamic-image-editor")}else{e=a.div("dynamic-image-editor")}const t=xe.Owner();const n={caption_image_uploader:a.div("caption",e),uploader:x("Image",t,{on_change:this.property.on_change})};n.caption_image_uploader.text("Static image");e.append(n.uploader.get_canvas());const r={caption_text_composer:a.div("caption",e),composer_element:x("ShortTextComposer",this,{json:this.prop_node().json,default_value:this.default()})};r.caption_text_composer.text("Dynamic image");e.append(r.composer_element.get_canvas());const i=e=>{if(e!=null&&e!==s){s=e;this.write_child(null,Ee.RAW.TextExpression([e]));this.prop_node().commit()}};if(!this.property.no_external_library){a.div("caption image-searcher",e,"External sources");const t=a.div("external-image-panel-btn standard-btn",e,"Search for free images");t.on("vclick",(()=>{we.ExternalImagePanel().show((e=>{var t,n;i(e);(t=(n=this.property).on_change)==null?void 0:t.call(n,e)}))}))}let s=null;a.autorun((()=>{const e=this.prop_node();if(!e.is_empty()){if(e.is_static()){const n=e.get_static();t.set(n);s=n}else{t.set(null)}}else{t.set(null)}}));t.on_change((e=>{i(e)}));return e}}N.DynamicImage=ae;class le extends W{get_canvas(){let e;if(this.property.name.indexOf("param_")===0){e=a.div("params-dynamic-file-editor")}else{e=a.div("dynamic-file-editor")}const t=xe.Owner();const n={caption_image_uploader:a.div("caption",e),uploader:x("File",t,{on_change:this.property.on_change,file_type:this.property.file_type})};n.caption_image_uploader.text("Static file");e.append(n.uploader.get_canvas());const r={caption_text_composer:a.div("caption",e),composer_element:x("ShortTextComposer",this,{json:this.prop_node().json,default_value:this.default()})};r.caption_text_composer.text("Dynamic link");e.append(r.composer_element.get_canvas());let i=null;a.autorun((()=>{const e=this.prop_node();if(!e.is_empty()){if(e.is_static()){const n=e.get_static();t.set(n);i=n}else{t.set(null)}}else{t.set(null)}}));t.on_change((e=>{if(e!=null&&e!==i){i=e;this.write_child(null,Ee.RAW.TextExpression([e]));this.prop_node().commit()}}));return e}}N.DynamicFile=le;class ce extends W{get_composer(){if(this.property.set instanceof y){var e,t,n,r;return new Be({owner:this,json:this.prop_node().json,default_value:(e=this.get_value_from_style())!=null?e:this.default(),contents:this.property.set.with_options({optional:this.optional(),dropdown_width:(t=(n=this.property.pretty)==null?void 0:n.dropdown_width)!=null?t:this.property.set.get_dropdown_width()}),numerical_step:this.property.numerical_step,on_change:this.property.on_change,right_align:(r=this.property.pretty)==null?void 0:r.right_align,empty_display:this.property.empty_display,get_css_classes:()=>J(this)})}else{var i,s,o,a,l;return x((i=this.property.pretty)!=null&&i.arrowless?"ArrowlessDropdown":"Dropdown",this,{json:this.prop_node().json,default_value:(s=this.get_value_from_style())!=null?s:this.default(),set:this.property.set,optional:this.optional(),dropdown_width_override:(o=this.property.pretty)==null?void 0:o.dropdown_width,on_change:this.property.on_change,numerical_step:this.property.numerical_step,right_align:(a=this.property.pretty)==null?void 0:a.right_align,sticky_section:(l=this.property.pretty)==null?void 0:l.sticky_section,get_css_classes:()=>J(this),empty_display:this.property.empty_display})}}}ce.prototype.required=["set"];N.Dropdown=ce;class ue extends ce{get_composer(){var e;return x("Dropdown_Button",this,{json:this.prop_node().json,default_value:(e=this.get_value_from_style())!=null?e:this.default(),set:this.property.set,add_title:this.property.add_title,get_css_classes:()=>J(this)})}}N.Dropdown_Button=ue;class de extends W{get_canvas(){const e=a.div("label");if(typeof this.property.label_text==="function"){a.autorun((()=>{const t=this.property.label_text(this.node);e.text(t)}))}else{e.text(this.property.label_text)}if(this.property.click_cb){e.on("vclick",(()=>this.property.click_cb(this.node)));e.addClass("clickable")}return e}empty(){return false}}de.prototype.required=["label_text"];N.Label=de;class pe extends W{get_canvas(){var e;const t=a.div("standard-btn property-editor-button");if(this.property.dynamic_caption){t.text(this.property.dynamic_caption())}else{t.text(this.property.button_caption)}if((e=this.property.pretty)!=null&&e.width){t.addClass(this.property.pretty.width)}t.on("vclick",(()=>{var e,t;(e=(t=this.property).click_cb)==null?void 0:e.call(t,this.node)}));if(this.property.disabled!=null){a.autorun((()=>{t.toggleClass("disabled",this.property.disabled(this.node))}))}return t}}N.Button=pe;class _e extends W{get_canvas(){const e=a.div("cropping_buttons");const t=ye.ImagePalette();a.autorun((()=>{e.empty();if(this.node.property("crop_data").is_empty()){const n=a.div("standard-btn button-crop-image",e);n.text("Crop this image",e);n.on("vclick",(()=>{if(!n.hasClass("disabled")){t.start_cropping(this.node);n.addClass("disabled")}}))}else{const n=a.div("standard-btn button-revert-image",e);n.text("Revert to original",e);n.on("vclick",(()=>{t.revert_to_original(this.node)}))}}));return e}}N.Crop_Button=_e;class fe extends W{constructor(e,t,n,r){super(e,t,n,r);this.range_data_node=Ee.new_expression(this.node.json.child("value").child("range"),this.node.owner);this.unit_data_node=Ee.new_expression(this.node.json.child("value").child("unit"),this.node.owner);this.origin_address_data_node=Ee.new_expression(this.node.json.child("value").child("origin_address"),this.node.owner)}get_canvas(){const e=a.div("geographic-search-constraint");const t=x("ExpressionComposer",this,{json:this.range_data_node.json,expected_value:"number",editor_value:je.get("number")});e.append(t.get_canvas());this.unit_data=this.node.json.child("unit");const n=x("ArrowlessDropdown",this,{json:this.unit_data_node.json,set:Ne().sets.get_set("Object")({kms:"kms",miles:"miles"})});e.append(n.get_canvas());e.append($("<span> of </span>"));this.origin_address_data=this.node.json.child("origin_address");const r=x("ExpressionComposer",this,{json:this.origin_address_data_node.json,expected_value:"geographic_address",editor_value:je.get("geographic_address")});e.append(r.get_canvas());return e}write_child(e,t){if(this.node.get_static_property("constraint_type")!=="geographic_search"){this.node.property("constraint_type").json.set("geographic_search",{name:"ForceGeographicSearchConstraintType"})}const n=this.prop_node().raw();n[e.node_name()]=t;delete n.type;super.write_child(null,n)}}N.GeographicSearch=fe;class he extends W{get_canvas(){const e=a.div("checkbox-list-editor");a.autorun((()=>{var t;e.empty();const n=Array.from(a.json_parse((t=this.prop_node().raw())!=null?t:"[]"));for(const{value:t,display:r}of this.property.set.get_options()){const i=a.div("checkbox-row",e);const s=a.div("caption",i,r);s.addClass("Checkbox");const o=xe.Owner();if(n.includes(t)){o.set(true)}const l=x("Checkbox",o,{on_change:e=>{const r=()=>{this.node.set_property(this.property.name,a.json_stringify(n));this.node.commit()};if(e&&!n.includes(t)){n.push(t);r()}else if(!e&&n.includes(t)){a.array_remove(n,t);r()}}});i.append(l.get_canvas())}}));return e}}N.CheckboxList=he;class me extends W{get_canvas(){const e=a.div("object-list-editor");a.autorun((()=>{var t,n,r;const{id_field:i}=this.property;const s=this.property.static_list().map((e=>({id:e[i],found:false})));const o=((t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n))!=null?t:[]).map((e=>e.raw()));const l=[];for(const e of o){const t=s.find((t=>t.id===e.param_id));if(t!=null){t.found=true;l.push(e)}}for(const{id:e,found:t}of s){if(!t){const t={};t[i]=e;const n=a.to_object(this.property.sub_properties(t,this.node).map((e=>{var t;return[e.name,(t=e.default)!=null?t:Ee.RAW.Empty()]})));n[i]=e;l.push(n)}}this.write_child(null,l);this.prop_node().commit();return e}));a.autorun((()=>{var t,n,r;e.empty();const i=(t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n))!=null?t:[];for(let t=0;t<i.length;t++){const n=i[t];const r=this.create_entry(n,t);e.append(r)}}));return e}_length(){var e,t,n;return((e=(t=this.prop_node())==null?void 0:(n=t.entries)==null?void 0:n.call(t))!=null?e:[]).length}_node_to_index(e){var t,n,r;const i=(t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n).node_name())!=null?t:[];return i.indexOf(e.node_name())}get_sub_prop_node(e,t){var n;return e==null?void 0:(n=e.entry)==null?void 0:n.call(e,t)}write_sub_node(e,t,n){var r,i,s;const o=Array.from((r=(i=this.prop_node())==null?void 0:(s=i.entries)==null?void 0:s.call(i))!=null?r:[]).map(((e,t)=>e.raw()));const a=this._node_to_index(e);if(!o[a]){return}o[a][t]=n;this.write_child(null,o);this.prop_node().commit()}create_entry(e,t){const n=a.div("entry");a.autorun((()=>{n.empty();const r=this.property.sub_properties(e,this.node,t);for(const t of r){z(n,e,t,this)}}));return n}}N.StaticList=me;class ge extends W{get_canvas(){const e=a.div("object-list-editor");a.autorun((()=>{var t,n,r;e.empty();const i=(t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n))!=null?t:[];for(let t=0;t<i.length;t++){const n=i[t];const r=this.create_entry(n,t);e.append(r);const s=this.make_remove_button(n);if(this.property.add_move_up_down_btn){this.make_move_down_button(n,s);this.make_move_up_button(n,s)}e.append(s)}e.append(this.make_new_entry_button());if(this.property.show_expand_all){let t=null;a.autorun((()=>{if(t){t.remove()}t=this.make_expand_all_button();if(t){e.append(t)}}))}}));return e}_length(){var e,t,n;return((e=(t=this.prop_node())==null?void 0:(n=t.entries)==null?void 0:n.call(t))!=null?e:[]).length}_node_to_index(e){var t,n,r;const i=(t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n).node_name())!=null?t:[];return i.indexOf(e.node_name())}make_new_entry_button(){const e=a.div("new-entry-container");const t=a.div("new-entry",e,this.property.button_caption);t.on("vclick",(()=>{var t,n,r;const i=a.to_object(this.property.sub_properties(null,this.node).map((e=>{var t;return[e.name,(t=e.default)!=null?t:Ee.RAW.Empty()]})));if(this.property.id_field){i[this.property.id_field]=l.get_next_uid(Pe.appname())}const s=Array.from((t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n))!=null?t:[]).map((e=>e.raw()));s.push(i);this.write_child(null,s);this.prop_node().commit();if(!this.property.do_not_scroll_to_down){let t;if(e.parents(".slidable-palette").length){t=Ne().SlidablePalette()}else{t=F()}setTimeout((()=>t.scroll_to_bottom()),20)}}));return e}make_expand_all_button(){var e,t;const n=this.property.sub_properties(null,this.node)[0].set.get_options();const r=(e=this.prop_node())==null?void 0:(t=e.entries)==null?void 0:t.call(e).raw().to_array().map((e=>e.key));const i=n.filter((e=>!(r!=null?r:[]).includes(e.value)));if(i.length===0){return null}const s=a.div("bb-code-button",null,"Add all fields");s.on("vclick",(()=>{var e,t,n;const r=a.to_object(this.property.sub_properties(null,this.node).map((e=>{var t;return[e.name,(t=e.default)!=null?t:Ee.RAW.Empty()]})));const s=Array.from((e=(t=this.prop_node())==null?void 0:(n=t.entries)==null?void 0:n.call(t))!=null?e:[]);const o=s.map((e=>e.raw())).concat(i.map((e=>a.extend({},r,{key:e.value}))));this.write_child(null,o);this.prop_node().commit()}));return s}make_remove_button(e){const t=a.div("remover-entry-container");const n=a.div("remove-entry",t,this.property.remove_caption);n.on("vclick",(()=>{var t,n,r;const i=this._node_to_index(e);const s=Array.from((t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n))!=null?t:[]).filter(((e,t)=>t!==i)).map((e=>e.raw()));this.write_child(null,s);this.prop_node().commit()}));return t}_move_up_down(e,t){var n,r,i;const s=Array.from((n=(r=this.prop_node())==null?void 0:(i=r.entries)==null?void 0:i.call(r))!=null?n:[]).map(((e,t)=>e.raw()));const o=s[e-t];s[e-t]=s[e];s[e]=o;this.write_child(null,s);this.prop_node().commit()}make_move_up_button(e,t){const n=this._node_to_index(e);if(n===0){return}const r=a.div("move-up",t,this.property.move_up_caption);r.on("vclick",(()=>{this._move_up_down(n,1)}))}make_move_down_button(e,t){const n=this._node_to_index(e);if(n===this._length()-1){return}const r=a.div("move-down",t,this.property.move_down_caption);r.on("vclick",(()=>{this._move_up_down(n,-1)}))}get_sub_prop_node(e,t){var n;return e==null?void 0:(n=e.entry)==null?void 0:n.call(e,t)}write_sub_node(e,t,n){var r,i,s;const o=Array.from((r=(i=this.prop_node())==null?void 0:(s=i.entries)==null?void 0:s.call(i))!=null?r:[]).map(((e,t)=>e.raw()));const a=this._node_to_index(e);if(!o[a]){return}o[a][t]=n;this.write_child(null,o);this.prop_node().commit()}create_entry(e,t){const n=a.div("entry");a.autorun((()=>{n.empty();const r=this.property.sub_properties(e,this.node,t);for(const t of r){z(n,e,t,this)}}));return n}}ge.prototype.required=["sub_properties"];N.ObjectList=ge;class ve extends W{get_canvas(){const e=a.div("object-list-editor");a.autorun((()=>{var t,n,r;e.empty();const i=(t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n))!=null?t:[];for(let t=0;t<i.length;t++){const n=i[t];const r=this.create_entry(n,t);e.append(r)}e.append(this.make_new_entry_button())}));return e}_length(){var e,t,n;return((e=(t=this.prop_node())==null?void 0:(n=t.entries)==null?void 0:n.call(t))!=null?e:[]).length}_node_to_index(e){var t,n,r;const i=(t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n).node_name())!=null?t:[];return i.indexOf(e.node_name())}make_new_entry_button(){const e=a.div("new-entry-container");const t=a.div("new-entry",e,this.property.create_caption);t.on("vclick",(()=>{var t;const n=a.to_object(this.property.sub_properties(null,this.node).map((e=>{var t;return[e.name,(t=e.default)!=null?t:null]})));if(this.property.id_field){n[this.property.id_field]=l.get_next_uid(Pe.appname())}const r=xe.Owner(n);let i=false;this.open_edit({title:(t=this.property.create_caption)!=null?t:"Add a new ...",confirm_caption:"Add",delete_caption:"Cancel"},new Fe(r.json,this.node),(e=>{var t;r.set({...r.json.raw(),...(t=e.properties)!=null?t:{}})}),(()=>{i=true}),(()=>{var t,n,s;if(i)return;const o=Array.from((t=(n=this.prop_node())==null?void 0:(s=n.entries)==null?void 0:s.call(n))!=null?t:[]).map((e=>e.raw()));const a=r.json.raw();o.push(a);this.write_child(null,o);this.prop_node().commit();if(this.node.type()==="CustomDefinition"){u.track(d.REUSABLE_PROPERTY_CREATED,{app:Pe.appname(),editor_type:a.editor_type,field_type:a.btype_id,optional:a.optional,is_list:a.is_list})}if(!this.property.do_not_scroll_to_down){const t=e.parents(".slidable-palette").length?Ne().SlidablePalette():F();setTimeout((()=>t.scroll_to_bottom()),20)}}))}));return e}get_sub_prop_node(e,t){var n;return e==null?void 0:(n=e.entry)==null?void 0:n.call(e,t)}write_sub_node(e,t,n){var r,i,s;const o=Array.from((r=(i=this.prop_node())==null?void 0:(s=i.entries)==null?void 0:s.call(i))!=null?r:[]).map(((e,t)=>e.raw()));const a=this._node_to_index(e);if(!o[a]){return}o[a][t]=n;this.write_child(null,o);this.prop_node().commit()}create_entry(e,t){const n=a.div("entry display-only");a.autorun((()=>{n.empty();const r=this.property.display_data(e,this.node,t);if(!r.context_info){n.addClass("display-only")}const i=a.div("title-container",n);const s=a.div("caption",i);s.text(r.title);if(r.subtitle){const e=a.div("subtitle",i);e.text(r.subtitle)}const o=a.div("context-box",n);if(r.placeholder_text){n.addClass("has-context");o.addClass("has-context");const e=a.div("context",o);e.addClass("placeholder-text");e.text(r.placeholder_text)}else if(r.context_info){const e=r.context_info;n.addClass("has-context");o.addClass("has-context");if(r.context_type==="image"){const e=a.img("context",o);e.attr("src",r.context_info)}else if(r.context_type==="Color"){const t=a.div("context color-wrapper",o);const n=a.div("color-swatch",t);n.css("background",`${e}`);const r=a.div("hex",t);r.text(e)}else{const t=a.div("context",o);if(e.length>25){t.addClass("text-overflow")}t.text(e)}}const l=a.div("edit-btn fa fa-pencil",o);l.click((()=>{var n,r;this.open_edit({title:(n=this.property.edit_caption)!=null?n:"Edit an existing ...",confirm_caption:(r=this.property.confirm_caption)!=null?r:"Save"},e,(e=>{var n,r,i,s;const o=Array.from((n=(r=this.prop_node())==null?void 0:(i=r.entries)==null?void 0:i.call(r))!=null?n:[]).map((e=>e.raw()));o[t]={...o[t],...(s=e.properties)!=null?s:{}};this.write_child(null,o);this.prop_node().commit()}),(()=>{var t,n,r;const i=this._node_to_index(e);const s=Array.from((t=(n=this.prop_node())==null?void 0:(r=n.entries)==null?void 0:r.call(n))!=null?t:[]).filter(((e,t)=>t!==i)).map((e=>e.raw()));this.write_child(null,s);this.prop_node().commit()}),(()=>{}),true)}))}));return n}open_edit(e,t,n,r,i,s){var o;const a=Ne().SlidablePalette();Ue.add_to_stack({path:t.path(),show:()=>this.open_edit(e,t,n,r,i),slidable_palette:a});(o=t.set_field_data)==null?void 0:o.call(t,(()=>{var e;let n=(e=this.property.sub_properties(t,this.node))!=null?e:[];if(s){const e=n.filter((e=>e.disabled_value!=null)).map((e=>{e.is_disabled=true;return e}));const t=n.filter((e=>!e.disabled_value));n=[...e,...t]}return n}));a.assign_node(t,(e=>{switch(e.action){case"change":n(e.value.val);break;case"delete":r()}}),(()=>{Ue.remove_from_stack({path:t.path()});i()}),true,e);a.show()}}ve.prototype.required=["sub_properties"];N.FlyoutObjectList=ve;class be{constructor(e,t){this.owner_div=e;this.action_cb=t;this.canvas=a.div("message-popup",$("body"));this.text=a.div("explanation",this.canvas);this.button=a.div("button-fix",this.canvas);this.button.on("vmousedown",(()=>{this.action_cb();this.hide()}));this.canvas.hide()}show(e,t){setTimeout((()=>{var n;this.text.text(e);this.button.text(t);this.canvas.show();const r=$(Ae.PROPERTY_EDITOR);const i=$(Ae.SLIDABLE_PALETTE);const s=r.offset().left;let o,l;if(i.is(":visible")&&r.height()<i.height()){o=s;l=r.offset().top+r.height()+40}else{if(s+r.width()>$(window).width()/2){o=s-260}else{o=s+360}if(i.is(":visible")){l=i.offset().top+i.height()+40}}this.canvas.css({opacity:0,left:o,top:((n=l)!=null?n:this.owner_div.offset().top)-$(document).scrollTop()-30});this.canvas.velocity("stop");a.velocity(this.canvas,"fadeIn",{duration:300})}),50)}hide(){this.canvas.velocity("stop");this.canvas.hide()}remove(){this.canvas.velocity("stop");this.canvas.remove()}}const ye=e("./imagepalette");const we=e("./externalimagepanel");const xe=e("./composer/legacy");const je=e("./../lang/btypes");const Ae=e("./css");const Me=e("./richtexteditor");const Ee=e("./../lang/lang");const ke=e("./../lang/elements");const Oe=e("./contextualvideos");const Se=e("./elementinspector");const De=e("./documentationpalette");const Ce=e("./../documentation_id_getter");const Te=e("./commentpanel");const Ne=e("./../lib");const Pe=e("./../lang/appquery");const Ie=e("./edit_multi_elements");const Re=e("./editor_settings");const Le=e("./contextmenu");const ze=e("../lang/plugins");const{DropdownComposerInterface:Be}=e("./composer/compatibility/solid_conversion/DropdownComposerInterface");const{PSEUDO_TABLE_ELEMENTS:qe}=e("../core/core_elements/components/utils/table_element");const Ue=e("./composer/legacy/control");const Fe=e("../lang/expressions/ObjectLiteral")},{"../client/analytics":20,"../constants/elements":61,"../constants/experiments":65,"../constants/fonts":68,"../constants/segment_events":85,"../constants/style":89,"../constants/test_apps":91,"../core/core_elements/components/utils/table_element":281,"../lang/evaluation/node_eval":697,"../lang/expressions/ObjectLiteral":707,"../lang/field_checker":712,"../lang/plugins":726,"../lang/uids":731,"../optional/meta/meta_constants":751,"./../documentation_id_getter":486,"./../lang/appquery":651,"./../lang/btypes":653,"./../lang/elements":680,"./../lang/lang":714,"./../lib":741,"./../logger":744,"./../u":823,"./commentpanel":491,"./components/bubble/visual_indicators/PropertyEditorIndicators":492,"./composer/compatibility/composers":532,"./composer/compatibility/solid_conversion/DropdownComposerInterface":535,"./composer/legacy":544,"./composer/legacy/control":542,"./composer/utilities/dropdown_contents":556,"./contextmenu":558,"./contextualvideos":559,"./css":560,"./documentationpalette":565,"./edit_multi_elements":567,"./editor_experiments":568,"./editor_settings":570,"./elementinspector":572,"./externalimagepanel":574,"./guided_builds/editor_intro":577,"./imagepalette":579,"./richtexteditor":584,"./utils/evaluate_condition":594,"./utils/property_editor_utils":597,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.url-search-params.js":1126,"solid-js":2313}],577:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.register_first_interaction_with_pe_property=n.PROPERTY_EDITOR_SETTINGS=n.INTERACTED_WITH_POPUP=void 0;n.start_editor_intro=k;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=m(e("../../lang/appquery"));var s=h(e("../../u"));var o=h(e("../css"));var a=e("../components/design/vimeo_video_frame/VimeoVideoFrame");var l=e("../components/design/floating_window/InformationalFloatingWindow");var c=e("solid-js");var u=h(e("../../constants/videos"));var d=h(e("../../client/analytics"));var p=h(e("../../constants/segment_events"));var _=e("../components/bubble/visual_indicators/PropertyEditorIndicators");function f(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(f=function(e){return e?n:t})(e)}function h(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=f(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function m(e){return e&&e.__esModule?e:{default:e}}const g={[o.ACTION_CANVAS]:"seen_workflow_tab",[o.DATA_CANVAS]:"seen_data_tab",[o.VISUAL_CANVAS]:"seen_design_tab"};const v={[_.ElementType.ButtonWithWorkflow]:"first_workflow_with_actions_created",[_.ElementType.RepeatingGroupWithData]:"first_repeating_group_data_added",[_.ElementType.PopupWithData]:"first_popup_data_added"};n.PROPERTY_EDITOR_SETTINGS=v;const b={[o.ACTION_CANVAS]:"seen_workflow_tab_video",[o.DATA_CANVAS]:"seen_data_tab_video",[o.VISUAL_CANVAS]:"seen_design_tab_video"};n.INTERACTED_WITH_POPUP=b;const y=e=>{if(e!==null){i.default.set_setting(true,e,true);i.default.commit()}};const w=e=>y(v[e]);n.register_first_interaction_with_pe_property=w;const x=e=>y(g[e]);const j=e=>y(b[e]);function A(e){let{vimeo_id:t,event:n}=e;return(0,a.VimeoVideoFrame)({class:"video",width:590,height:332,vimeo_id:t,onPlay:()=>d.track(n,{appname:i.default.appname()})})}const M={[o.VISUAL_CANVAS]:{title:"Designing your project",description:'The Design tab is where you\'ll create the look (or "front end") of your application. Drag and drop elements from the sidebar on the left to start building your app.',confirmText:"Done",event:p.DWD_DESIGN_VIDEO_POPUP_SEEN,get children(){return A({vimeo_id:u.DESIGNING_IN_BUBBLE_VIMEO_ID,event:p.DWD_DESIGN_VIDEO_PLAYED})}},[o.ACTION_CANVAS]:{title:"Add actions to your project",description:"This is the Workflow tab, where you'll create the actions that bring your app to life. From here you can create workflows to do things like sign a user up, hide and show elements on a page, navigate to a new page, and more.",confirmText:"Done",event:p.DWD_WORKFLOW_VIDEO_POPUP_SEEN,get children(){return A({vimeo_id:u.YOUR_FIRST_WORKFLOW_VIMEO_ID,event:p.DWD_WORKFLOW_VIDEO_PLAYED})}},[o.DATA_CANVAS]:{title:"Creating and storing data for your project",description:"This is the Data tab, which is where the data that powers your application lives. From here you can create the data types and fields that you want your app to store.",confirmText:"Done",event:p.DWD_DATA_VIDEO_POPUP_SEEN,get children(){return A({vimeo_id:u.YOUR_FIRST_DATA_TYPE_VIMEO_ID,event:p.DWD_DATA_VIDEO_PLAYED})}}};const E={};function k(){const[e,t]=(0,c.createSignal)(o.VISUAL_CANVAS);const n=e=>{t("");j(e)};const s=s=>{t(s);const o=M[s];const a=!E[s];if(Object.keys(o).length>0&&a){(0,r.render)((()=>(0,r.createComponent)(c.Show,{get when(){return e()===s},get children(){return(0,r.createComponent)(l.InformationalFloatingWindow,{get title(){return o.title},get description(){return o.description},get confirmText(){return o.confirmText},onConfirm:()=>n(s),onHide:()=>n(s),get children(){return o.children}})}})),document.body);E[s]=true;d.track(o.event,{appname:i.default.appname()})}};s(o.VISUAL_CANVAS);$(o.MAIN_TABS_TAB).on("vclick",(function(n){if(!$(n.target).hasClass("disabled")){var r,o,a,l;const n=(r=(o=$(this))==null?void 0:(a=o.attr("class"))==null?void 0:(l=a.split(" "))==null?void 0:l.filter((e=>e!=="tab"))[0])!=null?r:"";const c=".tabcanvas."+n;if(c!==e()){t("")}const u=b[c];if(u){const e=i.default.get_public_setting(u);if(e===null||e===false){s(c)}x(c)}}}));O()}const O=()=>{s.autorun((()=>{const e=i.default.get_public_setting(b[o.VISUAL_CANVAS]);const t=i.default.get_public_setting(g[o.ACTION_CANVAS])===true;const n=i.default.get_public_setting(g[o.DATA_CANVAS])===true;const r=i.default.get_public_setting(b[o.ACTION_CANVAS])===true;if(e===true){if(!t){$(o.WORKFLOW_TAB).addClass("hotspot")}else{$(o.WORKFLOW_TAB).removeClass("hotspot");if(r&&!n){$(o.DATA_TAB).addClass("hotspot")}else{$(o.DATA_TAB).removeClass("hotspot")}}}if(n){$(o.DATA_TAB).removeClass("hotspot")}if(t){$(o.WORKFLOW_TAB).removeClass("hotspot")}}))}},{"../../client/analytics":20,"../../constants/segment_events":85,"../../constants/videos":94,"../../lang/appquery":651,"../../u":823,"../components/bubble/visual_indicators/PropertyEditorIndicators":492,"../components/design/floating_window/InformationalFloatingWindow":504,"../components/design/vimeo_video_frame/VimeoVideoFrame":513,"../css":560,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],578:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../u");const i=e("./../safe_require");r.edit_mode_only();const s=e("./../logger");class o{constructor(){$(document).ready((()=>{this.highlight_box=r.div(l.HIGHLIGHT_BOX,$("body"));return this.highlight_box.hide()}))}show(e,t){this._last_shown=e.path();$.fx.off=true;this.find(e,(n=>{if(e instanceof c.GenericElement){a().visual_edit.current_editor_canvas.select(e.id(),"overwrite");a().visual_edit.edit_current_element()}$.fx.off=false;if(!n){console.log("find_in_editor for "+e+" did not call back with a div");t==null?void 0:t();return}if(this._last_shown===e.path()){this.highlight(n,(()=>{t==null?void 0:t()}))}}))}handle_api_connector_merge_changes(e,t,n){let r;const i={};const s=[...e];const o=e=>{if(e[1]==="secure"){e[1]="client_safe";t=u.app().json.by_path(e.join("."));n=c.new_expression(t,u.app())}};const a=e=>{let n=false;while(s.indexOf(e)<s.length-2){t=t.parent();s.pop();n=true}return n};if(e[4]&&e[4]==="calls"){o(s);i.property_changed=a("calls");n=c.new_expression(t,u.app());s.splice(4);const e=u.app().json.by_path(s.join("."));const l=e.child("human").raw();const d=t.child("name").raw();r=`API ${l}'s Call${d?` ${d}`:"(s)"}`}else{o(s);i.property_changed=a("apiconnector2");n=c.new_expression(t,u.app());const e=t.child("human").raw();r=`API${e?` ${e}`:"(s)"}`}return{display:r,json:t,node:n,details:i}}resolve_json(e,t,n){const r=e.path().split(".");const i=()=>({node:null,display:e.path()});if(r.length<2){return i()}function o(e,t,n){var i;(i=e)!=null?i:e=t.path().split(".").length-1;const[o,a]=r.slice(e+1,e+3);const l=t.display();const c={};if(o==null){return{context:n,node:t,parent:t,display:l,details:c}}if(a==null&&o){c.property=o;return{context:n,node:t,parent:t,display:l,details:c}}if(a!=null&&o==="properties"){const e=["zindex","name"].includes(a)?t:t.property(a);c.property=a;return{context:n,node:e,parent:t,display:l,details:c}}if(a!=null&&o==="transitions"){const e=t.transition(a);c.transition=a;return{context:n,node:e,parent:t,display:l,details:c}}s.info("Cannot resolve json for highlight box",{path_array:r,node_path:t.path()});return{context:n,node:t,parent:t,display:`${l} ${r.slice(e+1).join(".")}`,details:c}}switch(r[0]){case"comments":{var a;const e=(a=u.by_id(r[1]))!=null?a:u.custom_type(r[1]);if(!e.exists()){return{context:"Comments",node:null,parent:null,display:r.slice(1).join(".")}}return{context:"Comments",node:e,parent:e,display:e.display()}}case"pages":case"element_definitions":case"api":{var l;let s=u.by_id(t);if(n&&s==null){if(r[0]==="api"||r[2]==="workflows"){s=c.new_workflow_item(e)}else{s=c.new_element(e)}}if(s==null){return i()}const a=s.root();const d=a==null?void 0:(l=a.display)==null?void 0:l.call(a);let p=null;if(d!=null){p=d}else if(a!=null&&a.is_api()){p=a.get_name()}return o(null,s,p)}case"settings":{let t;let n={};let i=r.slice(2).join(".");let s="Settings";if(!r[2]){t=c.new_expression(e,u.app())}else if(r[2]==="apiconnector2"){s="API Connector";({display:i,json:e,node:t,details:n}=this.handle_api_connector_merge_changes(r,e,t))}else{const e=r[1]==="client_safe"?u.get_public_setting_node:u.get_private_setting_node;t=e(r[2])}return{context:s,node:t,parent:t,display:i,details:n}}case"styles":{var d;let t=u.style(r[1]);if(n&&!((d=t)!=null&&d.exists())){t=new c.Style(e)}return o(1,t,"Styles")}case"user_types":{const e="Data";const t=u.custom_type(r[1]);const n=t;const i=t.display();const[o,a,l]=r.slice(2,5);const c={};if(o==null){return{context:e,node:t,parent:n,display:i,details:c}}if(a==null&&o){c.property=o;return{context:e,node:t,parent:n,display:i,details:c}}if(o==="fields"&&a!=null){const n=t.field(a);if(n.exists()){c.field=n.display().split(" - deleted")[0];c.property=l}else{c.field=a}return{context:e,node:n,parent:t,display:i,details:c}}if(o==="privacy_role"&&a!=null){const n=t.privacy_role(a);c.privacy_rule=n.display();c.property=l;return{context:e,node:n,parent:t,display:i,details:c}}s.info("Cannot resolve json for highlight box",{path_array:r});return{context:e,node:t,parent:n,display:`${i} ${r.slice(2).join(".")}`,details:c}}case"option_sets":{const e="Data";const t=u.option_set(r[1]);const n=t;const i=t.display();const[o,a,l]=r.slice(2,5);const c={};if(o==null){return{context:e,node:t,parent:n,display:i,details:c}}if(a==null&&o){c.property=o;return{context:e,node:t,parent:n,display:i,details:c}}if(o==="attributes"&&a!=null){const r=t.attribute(a);if(r.exists()){c.attribute=r.display().split(" - deleted")[0];c.property=l}else{c.attribute=a}return{context:e,node:r,parent:n,display:i,details:c}}if(o==="values"&&a!=null){const r=t.value(a);c.value=r.display();c.property=l;return{context:e,node:r,parent:n,display:i,details:c}}s.info("Cannot resolve json for highlight box",{path_array:r});return{context:e,node:t,parent:n,display:`${i} ${r.slice(2).join(".")}`,details:c}}default:return i()}}locate_highlight_box(e){this.highlight_box.css("top",e.offset().top-5);this.highlight_box.css("height",e.outerHeight()+4);this.highlight_box.css("left",e.offset().left-5);this.highlight_box.css("width",e.outerWidth()+4);this.highlight_box.css("z-index",r.make_zindex(e))}highlight(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setTimeout((()=>{let n;if(a().visual_edit.is_active()){n=l.VISUAL_CANVAS}else if(a().action_editor.is_active()){n=l.ACTION_CANVAS}else if(a().data_editor.is_active()){n=l.DATA_CANVAS}else if(a().plugin_editor.is_active()){n=l.PLUGIN_CANVAS}else if(a().settings_editor.is_active()){n=".tab-panel-container"}if(typeof e==="function"){e=e()}if(!e){s.error("trying to highlight a div but passed in null");return}if(e.length===0){return}if(e.parents().find(l.PROPERTY_EDITOR).get().length>0){n=l.PROPERTY_EDITOR+">.viewport"}if(e.is(":visible")||e.css("display")==="inline"){r.revealInScreen(e,n);this.highlight_box.velocity("stop");this.highlight_box.hide();this.highlight_box.css("opacity",0);this.locate_highlight_box(e);r.velocity(this.highlight_box,"fadeIn",{duration:100,complete_cb:()=>{r.velocity(this.highlight_box,"fadeOut",{duration:1e3});t==null?void 0:t()}})}else{t==null?void 0:t()}}),100)}find(e,t){c.wait_for_stable((()=>{var n,i;return e.find_in_editor(true,(e=>r.wait_for_updates((()=>t==null?void 0:t(e)))),(n=e.owner)==null?void 0:(i=n.is_root)==null?void 0:i.call(n))}))}find_element_or_parent(e,t,n){if(!e){return}a().visual_edit.ensure_root(u.element(e).root(),(()=>{let r;$(l.VISUAL_TAB).click();a().visual_edit.responsive_mode_box("builder");let i=$("#"+e);if(i.is(":visible")){r=()=>{a().visual_edit.current_editor_canvas.select(e,"overwrite");a().visual_edit.edit_current_element()}}else{var s;const n=u.element(e);if((s=n.is_page)!=null&&s.call(n)){$(".project-name.menu-item").click();i=$('.context-menu-item[element_id="'+e+'"]:visible')}else{i=$('.state-entry[element_id="'+n.id()+'"]:visible');a().visual_edit.turn_element_on(n.id(),true);if(t){i.click();i=$("#"+e)}}}n({div:i,cb:r})}))}reveal_element(e){this.find_element_or_parent(e,true,(e=>{if(!e){return}const{div:t,cb:n}=e;this.highlight(t,n)}))}}t.exports=r.singleton(o);i.safe_register("./editor/highlightbox",t.exports);if(typeof window!=="undefined"&&window!==null){window.highlight=function(e){if(typeof e==="string"){e=c.deserialize(u.app(),JSON.parse(e))}t.exports().show(e,(()=>console.log(e)))}}const a=e("./../lib");const l=e("./css");const c=e("./../lang/lang");const u=e("./../lang/appquery")},{"./../lang/appquery":651,"./../lang/lang":714,"./../lib":741,"./../logger":744,"./../safe_require":777,"./../u":823,"./css":560,"core-js/modules/web.dom-collections.iterator.js":1123}],579:[function(e,t,n){var r,i,s,o,a,l,c;c=e("./../u");l=e("./../safe_require");c.edit_mode_only();o=n;l.safe_register("./editor/imagepalette",o);a=e("../shared/images");o.ImagePalette=c.singleton(r=function(){function t(){var t;e("../../vendor/jquery_plugins/jquery.Jcrop.min.js");this.canvas=c.div(s.IMAGE_EDITOR_PALETTE,$("body"));this.canvas.hide();t=c.div("buttons-wrapper",this.canvas);this.button_save=c.div("standard-btn btn-validate",t);this.button_save.text("Crop");this.button_save.on("vclick",function(e){return function(){return e.actually_crop((function(){return e.stop_cropping()}))}}(this));this.button_cancel=c.div("standard-btn btn-cancel",t);this.button_cancel.text("Cancel");this.button_cancel.on("vclick",function(e){return function(){return e.stop_cropping()}}(this));this.focus=new c.HasFocus(this.canvas,null);this.focus.on("blur",function(e){return function(){return e.stop_cropping()}}(this))}t.prototype.start_cropping=function(e){var t,n,r,o;this.element=e;if(this.is_cropping){throw new c.UnexpectedError("calling start_cropping while cropping")}this.is_cropping=true;n=this.element.id();t=$("#"+n);this.image=t.find("img");c.revealInScreen(this.image,s.VISUAL_CANVAS);this.invisible_div=this.image.siblings(":last");this.stored_padding_val=$(this.invisible_div).css("padding-top");this.api_is_loaded=c.MakeKey(15e3,"cropping api is loaded");o=this;this.image.Jcrop({bgColor:"transparent"},(function(){o.reference_to_jcrop_api=this;return o.api_is_loaded.turn()}));$(this.invisible_div).css("padding-top","0%");r=$("#"+n).find("img");r.on("vmousedown.when_cropping",(function(){return i().visual_edit.edit_canvas.is_cropping=true}));c.SetFocusOwner(r,this.canvas);this.focus.focus=true;this.locate_palette(t);i().visual_edit.should_show_property_editor(false);return this.canvas.show()};t.prototype.stop_cropping=function(){var e;this.image.off("vmousedown.when_cropping");$(".button-crop-image").removeClass("disabled");i().visual_edit.edit_canvas.is_cropping=false;if((e=this.reference_to_jcrop_api)!=null){e.destroy()}this.canvas.hide();i().visual_edit.should_show_property_editor(true);this.api_is_loaded=null;this.is_cropping=false;return $(this.invisible_div).css("padding-top",this.stored_padding_val)};t.prototype.actually_crop=function(e){return c.WaitFor(this.api_is_loaded,function(t){return function(){var n;n=t.reference_to_jcrop_api.tellSelect();if(!n.w||!n.h){return}t.element.set_property("crop_data",{left_offset:-n.x/n.w,top_offset:-n.y/n.h,height_factor:t.image.innerHeight()/n.h,width_factor:t.image.innerWidth()/n.w});t.element.set_property("height",n.h);t.element.set_property("width",n.w);t.element.set_property("top",t.element.get_top()+n.y);t.element.set_property("left",t.element.get_left()+n.x);t.element.commit();return e()}}(this))};t.prototype.revert_to_original=function(e){this.element=e;return a.get_image_real_dimensions($("#"+this.element.id()).find("img").attr("src"),function(e){return function(t){if(t.height==null){return}e.element.set_property("width",Math.floor(t.width/t.height*e.element.get_height()));e.wipe_crop_data(e.element);return e.element.commit()}}(this))};t.prototype.wipe_crop_data=function(e){return e.set_property("crop_data",null)};t.prototype.locate_palette=function(e){return this.canvas.css({left:e.offset().left+e.width()-140,top:e.offset().top-46})};return t}());s=e("./css");i=e("./../lib")},{"../../vendor/jquery_plugins/jquery.Jcrop.min.js":2349,"../shared/images":796,"./../lib":741,"./../safe_require":777,"./../u":823,"./css":560}],580:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.launch_meta_payment=h;var r=d(e("../../core/status_bar"));var i=e("../../bubble_plans");var s=d(e("../../lib"));var o=d(e("../../client_config"));var a=u(e("../../client/analytics"));var l=u(e("../../constants/segment_events"));function c(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=c(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function d(e){return e&&e.__esModule?e:{default:e}}const p="__subscribe_app";const _=(e,t)=>{var n,r,i;const a=(n=(r=o.default.account_home)!=null?r:(i=(0,s.default)())==null?void 0:i.location.get_base_for_meta())!=null?n:"https://bubble.io";return`${a}/${e}?${t}`};const f=e=>{r.default.show_general_message_immediate("Redirecting for payment...");window.open(e,"_self")};function h(e){const{appname:t,frequency:n,plan:r,trial_end:s,trial_source:o,checkout_caption:c,redirecting_from_error:u=false}=e;const d=(0,i.get_stripe_plan_id)({plan:r,frequency:n,appname:t});const h=window.encodeURIComponent(window.location.href);const m=[`appname=${t}`,`plan_id=${r}`,`stripe_plan_id=${d}`,`redirect_url=${h}`];o&&m.push(`trial_source=${o}`);const g=_(p,m.join("&"));if(u){window.MessagePanel({title:c,message:"There was an error processing your payment: it requires an additional step for validation. Click below to continue",button_caption:"Continue",cb:()=>{f(g)}})}else{const e={appname:t,plan_id:r,stripe_plan_id:d,trial_end:s};a.track(l.REDIRECTED_TO_STRIPE_CHECKOUT,e);f(g)}}},{"../../bubble_plans":14,"../../client/analytics":20,"../../client_config":41,"../../constants/segment_events":85,"../../core/status_bar":415,"../../lib":741,"core-js/modules/web.dom-collections.iterator.js":1123}],581:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../../lib");const s=e("../../core/widgets");const o=e("../composer/legacy/index");const a=e("../../client/analytics");const l=e("../../constants/app_plans");const c=e("../../constants/segment_events");const u=e("../../bubble_plans");const d=e("../../constants/time");const p=e("../../constants/app_plan_features");const{CheckedList:_}=e("../components/design/checked_list/CheckedList");const{render:f}=e("solid-js/web");const{BillingFrequency:h,FREE_TRIAL_DAYS:m,FREE_TRIAL_TEXT:g,SOURCE_EDITOR_PAYWALL:v}=e("../../constants/subscriptions");const b=e("../../shared/pricing_configs");const y=e("../subscription");const w=e("../../lang/appquery");r.edit_mode_only();const x="data-plan";const j=()=>`Start ${g} free trial`;const A=()=>`Get a ${g} free trial on the ${u.get_plan(u.get_trial_plan_id()).display} plan`;const M=(e,t)=>{e=p.SOURCE_TO_FEATURE[t]?p.SOURCE_TO_FEATURE[t]:e;return p.DESCRIPTIONS[e]};const E=(e,t,n)=>{let r;const i=M(e,t);const s=u.get_plan(n);const o=s.display;r=i+` is only available on ${o.toLowerCase()} plan`;if(n!==l.APP_PRODUCTION_2019){r+=" and above"}return r};class k{constructor(e){var t;let{appname:n,app_plan_id:r,app_plan_frequency:i,has_trialed:l,feature_id:p,feature_access_check:_,source:f,ui_type:m,cb_yes:g,enable_analytics:v=true}=e;this.appname=n;this.app_plan_id=r;this.app_plan_frequency=i;this.feature_id=p;this.feature_access_check=_;this.source=f;this.enable_analytics=v;this.cb_yes=g;this.sorted_plans=u.get_sorted_plan_ids();let b,y;const x=Date.now()-w.creation_date()<d.DAY_MS*10;this.should_show_free_trial=x&&u.is_free_plan(this.app_plan_id)&&!l;let j="Update your plan";if(this.feature_id){j="Upgrade to access this feature";const e=typeof this.feature_access_check==="function"?this.feature_access_check:this.feature_id;y=u.get_suggested_app_plan_id(e,this.sorted_plans);b=E(this.feature_id,this.source,y);if(this.should_show_free_trial&&y===u.get_trial_plan_id()){j=A()}}this.popup=new s.ModalPopup(j,false,false,this.enable_analytics,b);const M=this.popup.get_canvas();M.removeClass("modal-popup");M.addClass("buttermilk-modal");$(M).attr("id","paywall-modal");if(this.enable_analytics){const e={app:this.appname,source:this.source,...m&&{ui_type:m}};a.track(c.PAYWALL_MODAL_OPENED,e)}const k=this.popup.children_div;this.billing_frequency=o.Owner((t=this.app_plan_frequency)!=null?t:h.Month);this.create_billing_frequency_buttons(k);this.billing_plan=o.Owner(undefined);if(y){this.billing_plan.set(y)}this.create_plan_columns_and_footer(this.popup,k,y);$(document).off("keydown.enter-messagewindow");$(document).on("keydown.enter-messagewindow",(e=>{if(e.keyCode===13){this.popup.hide()}}))}show(){this.popup.show()}create_billing_frequency_buttons(e){if(y.disallow_annual_plan()){return}const t=r.div("plan-billing-frequency");const n=r.div("billing-frequency-tab padding-20",t,"Bill monthly");const i=r.div("billing-frequency-tab",t,"Bill annually & save");r.autorun((()=>{if(this.billing_frequency.get()===h.Month){n.addClass("selected");i.removeClass("selected")}else{n.removeClass("selected");i.addClass("selected")}}));n.on("vclick",(()=>{this.billing_frequency.set(h.Month)}));i.on("vclick",(()=>{this.billing_frequency.set(h.Year)}));e.append(t)}create_plan_columns_and_footer(e,t,n){const i=r.div("plan-columns flex-row align-items-stretch space-between margin-top-12",t);const s=this.create_footer(e,t);r.autorun((()=>{i.empty();const e=this.sorted_plans;e.forEach(((t,r)=>{let s;if(r>0){s=e[r-1]}const o=this.create_plan_column({plan_id:t,frequency:this.billing_frequency.get(),suggested_plan_id:n,previous_plan_id:s});i.append(o)}));this.render_columns(i);this.render_footer(s)}))}create_footer(e,t){const n=r.div("plan-footer flex-row space-between width-fill",t);if(b.isStateR()){r.span("help-text align-items-center",n).html(`To learn more about our plans, visit the <a class="link" href="${i().location.get_base_for_meta()}/pricing" target="_blank">pricing page.</a>`)}else{r.div("description",n,"")}this.create_footer_buttons(e,n);return n}get_trial_data(e,t){const n=e===u.get_trial_plan_id();const r=t===h.Month;const i=n&&r&&this.should_show_free_trial;if(i){const e=Date.now()+m*d.DAY_MS;return{trial_source:v,trial_end:e}}return null}create_footer_buttons(e,t){const n=r.div("buttons flex-row",t);const i=r.div(["btn","btn-cancel"],n);i.text("Cancel");i.on("vclick",(()=>{e.hide()}));const s=r.div(["btn","btn-ok","disabled"],n);s.on("vclick",(()=>{const t=this.billing_plan.get();const n=this.billing_frequency.get();const r=this.get_trial_data(t,n);if(this.enable_analytics){const e=this.is_downgrade(this.billing_plan.get())?c.PAYWALL_MODAL_PLAN_DOWNGRADE_CLICKED:c.PAYWALL_MODAL_PLAN_UPGRADE_CLICKED;a.track(e,{app:this.appname,new_plan:t,frequency:n})}this.cb_yes(t,n,r);e.hide()}));s.text("Upgrade")}create_plan_column(e){let{plan_id:t,frequency:n,suggested_plan_id:i,previous_plan_id:s}=e;const o=u.get_plan(t);const l=s?u.get_plan(s):null;let d;if(n===h.Month){var p;d=(p=o.monthly_price)!=null?p:0}else{var _;d=(_=o.yearly_price)!=null?_:0}const f=r.div("plan-column");if(i===t){if(b.isStateR()){r.div("col-header-suggested recommended",f,"Recommended for you")}else{r.div("col-header-suggested",f,"Suggested")}}else if(i){r.div(".col-header-empty",f)}const m=r.div("col-content flex-column",f);m.attr(x,t);r.div("plan-name",m,o.display);if(n!=="month"&&!t.includes("free")){const e=r.div("plan-price-wrapper space-between align-items-baseline width-fill",m);r.div("plan-price-line-through",e,"$"+o.monthly_price);r.div("plan-price margin-top-12 margin-bottom-12",e,"$"+d+"/mo")}else{r.div("plan-price margin-top-12 margin-bottom-12",m,"$"+d+"/mo")}const g=r.div("bubble-ui btn grey choose-plan-btn",m);g.on("vclick",(()=>{if(this.enable_analytics){a.track(c.PAYWALL_MODAL_PLAN_CHOSEN,{app:this.appname,new_plan:t,frequency:n})}this.billing_plan.set(t)}));const v=this.list_plan_features(o,l);m.append(v);return f}render_columns(e){e.children(".plan-column").each(((e,t)=>{const n=$(t);const r=n.find(".col-content");const i=r.attr(x);const s=r.find(".choose-plan-btn");const o=this.app_plan_frequency?this.app_plan_frequency===this.billing_frequency.get():true;const a=i===this.app_plan_id&&o;const l=i===u.get_trial_plan_id();const c=i===this.billing_plan.get();const d=this.billing_frequency.get()===h.Month;const p=this.should_show_free_trial&&l&&!c&&d;if(p){s.text(j());s.addClass("free-trial-btn")}else if(a){r.addClass("current");s.text("Current plan");s.addClass("disabled")}else if(c){r.addClass("selected");s.text("Selected plan");s.addClass("disabled")}else{r.removeClass("selected");s.text("Choose plan");s.removeClass("disabled")}}))}render_footer(e){if(!this.billing_plan.get()){return}const t=u.get_plan(this.billing_plan.get());const n=e.find(".description");const r=e.find(".btn-ok");r.removeClass("disabled");if(this.is_downgrade(t.id)){n.text(`Are you sure you want to downgrade to ${t.display}? Youll lose access to some features.`);r.text("Downgrade");r.addClass("destructive")}else{n.text("");r.text(this.create_bill_text(t,this.billing_frequency.get()));r.removeClass("destructive")}}create_bill_text(e,t){var n;if(t===h.Year){var r;return`Bill $${((r=e.yearly_price)!=null?r:0)*d.YEAR_MONTH} annually`}if(this.should_show_free_trial&&e.id===u.get_trial_plan_id()){return j()}return`Bill $${(n=e.monthly_price)!=null?n:0} monthly`}is_downgrade(e){return this.sorted_plans.indexOf(e)<this.sorted_plans.indexOf(this.app_plan_id)}list_plan_features(e,t){const n=u.get_feature_descriptions(e,t);const i=r.div("plan-feature-list");if(t){r.div("feature-list-header margin-bottom-12",i,`Everything on ${t.display}, plus`)}f((()=>_({list:n})),i[0]);return i}}t.exports=k},{"../../bubble_plans":14,"../../client/analytics":20,"../../constants/app_plan_features":46,"../../constants/app_plans":47,"../../constants/segment_events":85,"../../constants/subscriptions":90,"../../constants/time":92,"../../core/widgets":421,"../../lang/appquery":651,"../../lib":741,"../../shared/pricing_configs":800,"../../u":823,"../components/design/checked_list/CheckedList":495,"../composer/legacy/index":544,"../subscription":589,"solid-js/web":2315}],582:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.UPGRADE_TO_DEPLOY=n.APP_DATA_UPLOAD=n.APP_DATA_MODIFY=n.APP_DATA_EXPORT=n.APP_DATA_BULK=void 0;const r="UpgradeToDeploy";n.UPGRADE_TO_DEPLOY=r;const i="Data/AppData/Modify";n.APP_DATA_MODIFY=i;const s="Data/AppData/Upload";n.APP_DATA_UPLOAD=s;const o="Data/AppData/Export";n.APP_DATA_EXPORT=o;const a="Data/AppData/Bulk";n.APP_DATA_BULK=a},{}],583:[function(e,t,n){"use strict";const r=n;const i=e("./../u");r.get_bar=function(e){e.empty();const t=i.div("progress-bar-wrapper",e);const n=i.div("bubble-ui progress-bar",t);const r=i.div("progress-div",n);r.css("width","5px");const s=(e,t)=>r.css("width",Math.round(e/t*n.width()));const o=()=>r.css("width","100%");return{report_progress:s,finish_progress:o}}},{"./../u":823}],584:[function(e,t,n){var r,i,s,o,a,l,c;c=e("./../u");r=e("./../lib");o=e("./composer/compatibility/composers").get_composer;c.edit_mode_only();l=n;l.RichTextEditor=i=function(){function t(t,n,i){var a,l,u,d;this.node=t;this.property_name=n;this.html_code_editor=i;e("../../vendor/optional/jquery_plugins/jquery.sceditor.bbcode.min.js");this.canvas=c.div("modal-popup");$(document.body).append(this.canvas);this.canvas.hide();this.canvas.css("opacity",0);this.canvas.addClass("rich-text-editor");u=c.div("popup-content",this.canvas);u.append(this.create_header());a=c.div("children",u);this.sub_child=c.div("inner-children",a);if(this.html_code_editor){this.html_node=r().composer.Owner(this.build_displayable_string());l=o("CodeComposer",this.html_node,{});l.get_canvas().addClass("html-editor");this.sub_child.append(l.get_canvas())}else{d=c.div("<textarea></textarea>");d.css({width:"100%",height:"100%",border:"none",padding:"0"});this.sub_child.append(d);sceditor.create(d[0],{format:"bbcode",toolbarExclude:"code,youtube,quote,ltr,rtl,emoticon,source,maximize,cut,copy,paste,pastetext,table,unlink,print,date,time",emoticonsEnabled:false,style:"//"+s.cdn_host+"/static/rich_text_input/minified/jquery.sceditor.default.min.css",resizeEnabled:false,colors:"#000000,#C0C0C0,#808080,#FFFFFF|#800000,#FF0000,#800080,#FF00FF|#008000,#00FF00,#808000,#FFFF00|#000080,#0000FF,#008080,#00FFFF"});this.api_instance=d.sceditor("instance");this.sub_child.find(".sceditor-toolbar *").css("box-sizing","content-box");this.sub_child.find(".sceditor-container").css({width:700,height:300});d.hide();this.api_instance.val(this.build_displayable_string())}this.save_button=c.div("btn bubble-ui btn-save",this.sub_child);this.save_button.text("SAVE");this.cancel_button=c.div("btn btn-cancel",this.sub_child);this.cancel_button.text("Cancel");this.save_button.on("vclick",function(e){return function(){return e.save()}}(this));this.cancel_button.on("vclick",function(e){return function(){return e.hide()}}(this));$("body").css("overflow","hidden");this.prop_node=this.node.property(this.property_name);c.velocity(this.canvas,"fadeIn",{duration:300,complete_cb:function(e){return function(){return e.api_instance.focus()}}(this)})}t.prototype.create_header=function(){return c.div("popup-title",void 0,this.html_code_editor?"HTML Editor":"Rich Text Editor")};t.prototype.save=function(){var e,t;e=this.convert_to_composer_data();t=this.prop_node.raw();if(e){if(JSON.stringify(e.entries)!==JSON.stringify(t!=null?t.entries:void 0)){this.node.set_property(this.property_name,e);this.node.commit()}}return this.hide()};t.prototype.hide=function(){return c.velocity(this.canvas,"fadeOut",{duration:300,complete_cb:function(e){return function(){$("body").css("overflow","auto");return e.canvas.remove()}}(this)})};t.prototype.get_entries=function(){var e;e=this.node.property(this.property_name);if(e.is_empty()){return[]}else{return e.entries()}};t.prototype.build_displayable_string=function(){var e,t,n,r,i,s;e=this.get_entries();s="";for(n=0,r=e.length;n<r;n++){t=e[n];if(typeof t==="string"){i=t}else{i=t.get_tree_display()}s+=i}return s};t.prototype.convert_to_composer_data=function(){var e,t,n,r,i,s,o,l,c,u,d,p,_,f,h;if(this.html_code_editor){f=h=this.html_node.get()}else{f=h=this.api_instance.val()}u=this.get_entries();l=[];c=function(){var e,t,n;n=[];for(e=0,t=u.length;e<t;e++){d=u[e];if(!(d instanceof a.Literal)){n.push(d)}}return n}();if(!c.length){return a.RAW.TextExpression([f])}o=[];h=h.replace(/\xA0/g," ");for(n=0,i=c.length;n<i;n++){e=c[n];t=e.get_tree_display().replace(/\xA0/g," ");if(h.indexOf(t)!==-1){o.push(e);if(h.split(t).length>1){h=h.substring(h.indexOf(t)+t.length)}}}if(c.length!==o.length){window.MessagePanel({title:this.html_code_editor?"HTML Editor":"Rich Text Editor",message:"You have modified some dynamic data, the content is reverted to its original version."});return false}for(r=0,s=c.length;r<s;r++){d=c[r];p=d.get_tree_display();_=f.substring(0,f.indexOf(p));f=f.substring(f.indexOf(p)+p.length);l.push(_);l.push(d.raw())}if(f){l.push(f)}return a.RAW.TextExpression(l)};return t}();s=e("./../client_config");a=e("./../lang/lang")},{"../../vendor/optional/jquery_plugins/jquery.sceditor.bbcode.min.js":2356,"./../client_config":41,"./../lang/lang":714,"./../lib":741,"./../u":823,"./composer/compatibility/composers":532}],585:[function(e,t,n){"use strict";const r=e("../u");const i=e("../lib");const s=e("../lang/appquery");const o=e("../client/analytics");const a=e("../locations");const{ignoreError:l}=e("../u/shared/callbacks");const c=n;c.is_paused=r.Box();c.sync_from_server=()=>i().location.post("server://appeditor/get_scheduler_state",{appname:s.appname(),app_version:s.app_version()},l((e=>c.is_paused(e))));c.pause_scheduler=function(e){const t=s.appname();const n=s.app_version();o.track("Scheduler Paused",{app:t,app_version:a.get_db_display(n)});i().location.post("server://appeditor/pause_scheduler",{appname:t,app_version:n},((t,n)=>{if(t==null){c.is_paused(true)}e==null?void 0:e(t)}))};c.resume_scheduler=function(e){const t=s.appname();const n=s.app_version();o.track("Scheduler Resumed",{app:t,app_version:a.get_db_display(n)});i().location.post("server://appeditor/resume_scheduler",{appname:t,app_version:n},((t,n)=>{if(t==null){c.is_paused(false)}e==null?void 0:e(t)}))}},{"../client/analytics":20,"../lang/appquery":651,"../lib":741,"../locations":743,"../u":823,"../u/shared/callbacks":843}],586:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.sidePanelMediator=void 0;var r=e("../u/shared/Mediator");const i=new r.Mediator;n.sidePanelMediator=i},{"../u/shared/Mediator":828}],587:[function(e,t,n){var r,i,s,o,a,l,c,u,d;d=e("./../u");d.edit_mode_only();u=n;u.SlidablePalette=d.singleton(s=function(){function e(){var e,t,n;this.property_editor=$(l.PROPERTY_EDITOR);this.property_editor_zindex=this.property_editor.css("z-index");this.canvas_width=this.property_editor.width();this.ANIMATION_DELAY=300;this.canvas=d.div(l.SLIDABLE_PALETTE,$("body"));this.canvas.hide();t="input,textarea,button,select,option,.a-color-picker,.composer, .text-composer, .show-more-less-button";this.canvas.draggable({cancel:t,start:function(e){return function(t,n){e.initial_position_property_editor=e.property_editor.offset();e.initial_position_slidable_palette=n.offset;return e.screen_scrolltop=$(document).scrollTop()}}(this),drag:function(e){return function(t,n){var r;r=n.offset;return e.property_editor.css({top:e.initial_position_property_editor.top+r.top-e.initial_position_slidable_palette.top-e.screen_scrolltop,left:e.initial_position_property_editor.left+r.left-e.initial_position_slidable_palette.left})}}(this),stop:function(e){return function(){return e.initial_top_property_editor=e.initial_left_property_editor=e.initial_top_slidable_palette=e.initial_left_slidable_palette=e.screen_scrolltop=null}}(this)});this.canvas.css("z-index",this.property_editor_zindex-1);n=d.div("title",this.canvas);this.static_title=d.div("static-title",n);this.viewport=d.div("viewport",this.canvas);this.rows=d.div("rows overview",this.viewport);e=d.div("buttons-wrapper",this.canvas);this.button_save=d.div("btn btn-validate",e);this.button_save.on("vclick",function(e){return function(){return e.slide_back((function(){return e.cb({action:"go_to_next"})}))}}(this));this.button_delete=d.div("btn-delete",e);this.button_delete.on("vclick",function(e){return function(){return e.slide_back((function(){return e.cb({action:"delete"})}))}}(this));this.focus=new d.HasFocus(this.canvas,"click");this.is_open=d.Box(false);this.focus.on("focus",function(e){return function(){var t;t=e.displayed_box();if(window.composer_revamp&&t!=null){return c.GlobalComposerFocusTracker.setFocus(t.node.path(),{})}}}(this));this.focus.on("blur",function(e){return function(){var t;t=e.displayed_box();if(window.composer_revamp&&t!=null){c.GlobalComposerFocusTracker.setFocusIfSelected(t.node.path(),null)}return e.slide_back()}}(this));this.displayed_box=d.Box(null);d.autorun(function(e){return function(){var t,n,r;t=e.displayed_box();e.button_delete.text((n=t!=null?t.button_delete_text:void 0)!=null?n:"Delete");e.button_save.text((r=t!=null?t.button_save_text:void 0)!=null?r:"Close")}}(this));d.autorun(function(e){return function(){var t,n,i,s,o,a;t=e.displayed_box();if(!(t!=null?t.is_valid():void 0)){e.hide();return}if(!e.is_open()){return}s=t.properties();e.rows.empty();a=d.div("section",e.rows);if(!(s!=null?s.length:void 0)){e.hide();return}for(n=0,i=s.length;n<i;n++){o=s[n];r.create_property_row(a,t.node,o,typeof t.parent_editor==="function"?t.parent_editor():void 0,null,null,o.is_disabled,o.disabled_value)}return setTimeout((function(){return e.do_update()}),20)}}(this));d.autorun(function(e){return function(){var t;if((t=e.displayed_box())!=null){e.static_title.text(t.display());return e.button_delete.toggle(t.use_delete===true)}}}(this))}e.prototype.assign_node=function(e,t,n,r,i){this.cb=t;this.cb_close=n;this.run_cb_before_close=r;return this.displayed_box({node:e,properties:function(){return e.fields()},is_valid:function(){return!e.is_empty()},display:function(){var t,n;return(t=(n=i!=null?i.title:void 0)!=null?n:typeof e.get_display_for_sliding_palette==="function"?e.get_display_for_sliding_palette():void 0)!=null?t:e.display()},parent_editor:function(t){return function(){return a(t,e)}}(this),use_delete:true,button_save_text:i!=null?i.confirm_caption:void 0,button_delete_text:i!=null?i.delete_caption:void 0})};e.prototype.assign_properties=function(e){var t,n,r,i;n=e.node,r=e.props_fn,t=e.display_fn,i=e.use_delete,this.cb=e.cb,this.cb_close=e.cb_close;return this.displayed_box({node:n,properties:function(){return r()},is_valid:function(){return true},display:function(){return t()},use_delete:i})};e.prototype.node_box=function(){var e;return(e=this.displayed_box())!=null?e.node:void 0};e.prototype.is_currently_visible=function(){return this.canvas.is(":visible")&&!this.closing};e.prototype.show=function(){if(!this.is_currently_visible()){this.reveal();if(window.PropertyEditor().locked){return this.canvas.draggable("disable")}else{return this.canvas.draggable("enable")}}};e.prototype.reveal=function(e){var t,n;this.opening_key=d.MakeKey(null,"opening_palette");this.is_open(true);n=this.property_editor.offset();this.canvas.css({left:n.left,top:n.top-$(document).scrollTop()});this.canvas.show();if(i.property_editor_utils.SpaceExistsToPositionLeft(n.left,this.canvas_width)){t=n.left-this.canvas_width-10;this.canvas.css("left",n.left-6)}else{t=n.left+this.canvas_width+10}this.do_update();this.canvas.velocity("stop");return d.velocity(this.canvas,{left:t},{duration:this.ANIMATION_DELAY,complete_cb:function(t){return function(){var n;t.opening_key.turn();t.focus.focus=true;n=t.displayed_box();if(window.composer_revamp&&n!=null){c.GlobalComposerFocusTracker.setFocus(n.node.path(),{dont_fire_events:true})}t.canvas.css("z-index",t.property_editor_zindex+1);return typeof e==="function"?e():void 0}}(this)})};e.prototype.slide_back=function(e){var t;this.is_open(false);t=this.property_editor.offset().left;this.closing=true;if(this.canvas.offset().left<t){t-=6}this.canvas.css("z-index",this.property_editor_zindex-1);this.canvas.velocity("stop");return d.velocity(this.canvas,{left:t},{duration:this.ANIMATION_DELAY,complete_cb:function(t){return function(){t.focus.focus=false;t.hide();if(t.run_cb_before_close){if(typeof e==="function"){e()}if(typeof t.cb_close==="function"){t.cb_close()}}else{if(typeof t.cb_close==="function"){t.cb_close()}if(typeof e==="function"){e()}}}}(this)})};e.prototype.hide=function(){this.canvas.hide();this.focus.focus=false;this.closing=false;return this.is_open(false)};e.prototype.do_update=function(){this.MAX_HEIGHT=$(window).height()-this.canvas.offset().top-200+$(document).scrollTop();return this.viewport.css("max-height",this.MAX_HEIGHT)};e.prototype.scroll_to_bottom=function(){return this.viewport.scrollTop(this.rows.height()-this.viewport.height())};return e}());a=function(e,t){var n;n=e.cb;return{get_sub_prop_node:function(e,n){if(e.path()!==t.path()){throw new d.UnexpectedError("slidable paths do not match",{node_path:e.path(),current_node_path:t.path()})}return e.property(n)},write_sub_node:function(e,r,i){var s;if(e.path()!==t.path()){throw new d.UnexpectedError("slidable paths do not match: "+e.path()+" vs "+t.path())}s=d.json_deep_copy(e.raw());if(s){if(s.properties==null){s.properties={}}s.properties[r]=i}return n({action:"change",value:{val:s,just_do_change:true,node:e}})},get_expression_owner:function(){return t.owner}}};if(typeof window!=="undefined"&&window!==null){window.HideSlidable=function(){u.SlidablePalette().slide_back();return u.SlidablePalette().hide()}}o=e("./composer/legacy");r=e("./generic_editor2");l=e("./css");c=e("./composer/utilities/focusTracking");i=e("./utils/property_editor_utils")},{"./../u":823,"./composer/legacy":544,"./composer/utilities/focusTracking":557,"./css":560,"./generic_editor2":576,"./utils/property_editor_utils":597}],588:[function(e,t,n){"use strict";const r=e("./../u/shared/mode_check");const i=e("../u/client/b_ui");r.edit_mode_only();const s=n;s.SlidablePanel=class e{constructor(e){let{title:t}=e;this.title=t;this.property_editor=$(o.PROPERTY_EDITOR);this.property_editor_width=this.property_editor.width();this.canvas=i.div(o.CONTEXTUAL_VIDEO_PALETTE,this.property_editor);this.canvas.hide();this.canvas.css({position:"absolute",top:0});const n=i.div("title",this.canvas);i.div("static-title",n,this.title);this.close_button=i.div("close-button",n);this.close_button.on("vclick",(()=>{this.hide()}))}is_visible(){return this.canvas.is(":visible")}hide(e){if(this.is_visible()){if(e){this.canvas.hide()}else{this.slide_back()}}}reveal(e){if(this.is_visible()){return}const t=this.property_editor.offset();this.canvas.show();this.canvas.css("left",0);let n;if($(window).width()-t.left-this.property_editor_width<320){n=-this.property_editor_width-10}else{n=this.property_editor_width+10}i.velocity(this.canvas,{left:n},{duration:300,complete_cb:()=>e==null?void 0:e()})}slide_back(){i.velocity(this.canvas,{left:0},{duration:300,complete_cb:()=>{this.canvas.hide()}})}};const o=e("./css")},{"../u/client/b_ui":813,"./../u/shared/mode_check":851,"./css":560}],589:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.get_trial_source=n.get_trial_end_note=n.get_important_note=n.get_has_ever_trialed=n.get_billing_frequency=n.default=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=C(e("../lang/appquery"));var i=C(e("../lib"));var s=D(e("../u"));var o=D(e("../logger"));var a=D(e("../client_config"));var l=C(e("lodash/debounce"));var c=C(e("./downgradepanel.js"));var u=D(e("./payments/meta_payment"));var d=D(e("../constants/segment_events"));var p=D(e("./utils/pricing_configs"));var _=C(e("./paywall/paywallpanel.js"));var f=e("../u/shared/callbacks");var h=e("../constants/subscriptions");var m=e("../bubble_plans");var g=e("../constants/app_plans");var v=C(e("../core/status_bar"));var b=D(e("../client/analytics"));var y=D(e("../constants/experiments"));var w=D(e("./editor_experiments"));var x=D(e("../constants/time"));var j=e("../optional/meta/meta_constants");var A=e("./css");var M=e("./utils/organization_metadata");var E=e("solid-js");var k=e("solid-js/web");var O=e("./components/design/popup/InformationalPopup");function S(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(S=function(e){return e?n:t})(e)}function D(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=S(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function C(e){return e&&e.__esModule?e:{default:e}}const T=n;s.edit_mode_only();const N=1e3;const P="Default red text";const I="CTA to upgrade button";T.send_to_plan=()=>{$(A.SETTINGS_TAB).click();i.default.or_throw().settings_editor.settings_canvas.open_tab("Plan");s.wait_for_updates((()=>i.default.or_throw().settings_editor.settings_canvas.tabpanelcontainer.scrollTop(0)))};function R(e,t){const{title:n,description:s,label:o,original_plan:a,new_plan:l,frequency:c,plugin_id:u}=e;const p={appname:r.default.appname(),original_plan:a,new_plan:l,frequency:c,plugin_id:u};b.track(d.CHECKOUT_OPENED,p);B.open({name:n,description:s,currency:"USD",panelLabel:o,billingAddress:true,email:i.default.or_throw().current_user().get_email(),token:e=>{b.track(d.CHECKOUT_COMPLETED,p);t(e)}})}const L=e=>i.default.or_throw().location.post("server://appeditor/has_ever_trialed",{appname:e},((e,t)=>{if(e){o.error(e);return false}return t}));n.get_has_ever_trialed=L;const z=e=>i.default.or_throw().location.post("server://appeditor/get_trial_source",{appname:e},((e,t)=>{if(e){o.error(e);return false}return t}));n.get_trial_source=z;T.show_popup_to_choose_plan=e=>{let{feature_id:t,feature_access_check:n,source:i,ui_type:o,cb_yes:a}=e;const l=r.default.appname();const c=r.default.app_plan();s.run_once(30,(()=>L(l)),(0,f.ignoreError)((e=>{new _.default({appname:l,app_plan_id:c==null?void 0:c.id,app_plan_frequency:c==null?void 0:c.frequency,has_trialed:e,feature_id:t,feature_access_check:n,source:i,ui_type:o,cb_yes:a}).show()})))};T.show_popup_to_upgrade=e=>{let{feature_id:t,feature_access_check:n,source:i,cb_yes:o}=e;return s.run_once(10*60*1e3,(()=>{var e;const n=(e=r.default.app_plan(true))==null?void 0:e[t];if(n!=null){return{has_feature:true}}else{return{has_feature:false,is_enterprise_app:(0,M.is_enterprise_app)(),is_enterprise_owner:(0,M.user_is_enterprise_owner)()}}}),((e,r)=>{if(r!=null&&!r.has_feature&&!r.is_enterprise_app){T.show_popup_to_choose_plan({feature_id:t,feature_access_check:n,source:i,cb_yes(e,t,n){T.prompt_to_modify_plan({plan:e,new_freq:t,trial_data:n})}})}else if(r!=null&&!r.has_feature&&r.is_enterprise_app){(0,E.onCleanup)((0,k.render)((()=>{const e=r.is_enterprise_owner?"Sales":"Owner";const[t,n]=(0,E.createSignal)(true);return(0,O.InformationalPopup)({get showingPopup(){return t()},onHidePopup:()=>n(false),title:`Contact ${e} to Upgrade`,description:`The feature requested is not available on your current\n                          plan. Contact ${e} to upgrade`,showButton:true,buttonText:"Confirm",hideCancelButton:true,onAccept:()=>n(false)})}),document.body))}else{o()}}))};T.enter_upgrade_path=e=>{let{feature_id:t,feature_access_check:n,source:r,ui_type:i}=e;return T.show_popup_to_choose_plan({feature_id:t,feature_access_check:n,source:r,ui_type:i,cb_yes(e,t,n){T.prompt_to_modify_plan({plan:e,new_freq:t,trial_data:n})}})};T.add_mention=function(e){let{feature_id:t,feature_access_check:n,attach_to:r,text:i,source:o,part_of_cta_experiment:a}=e;const l=s.div("explanation need-to-subscribe warning-icon bubble-ui clickable",r);l.html(i+" Click here to adjust your application plan.");l.on("vclick",(()=>{if(a){T.enter_upgrade_path({feature_id:t,feature_access_check:n,source:o,ui_type:P})}else{T.enter_upgrade_path({feature_id:t,feature_access_check:n,source:o})}}));return l};T.create_upgrade_button=e=>{let{feature_id:t,feature_access_check:n,source:r}=e;const i=s.div("buttermilk-button wide grey",undefined);(0,s.autorun)((()=>{if((0,M.is_enterprise_app)()){const e=(0,M.user_is_enterprise_owner)()?"Sales":"Owner";i.text(`Contact ${e} to Upgrade your Plan`);i.addClass("disabled");i.off("vclick")}else{i.text("Upgrade to access this feature");i.removeClass("disabled");i.on("vclick",(()=>T.enter_upgrade_path({feature_id:t,feature_access_check:n,source:r,ui_type:I})))}}));return i};T.add_upgrade_button=e=>{let{feature_id:t,feature_access_check:n,attach_to:r,source:i,label_text:o,additional_classes:a}=e;let l="flex-row space-between clear-both padding-right-30";if(a){l+=" "+a}const c=s.div(l,r);s.div("flex-row align-items-center height-35",c,o);c.append(T.create_upgrade_button({feature_id:t,feature_access_check:n,source:i}));return c};T.access_gated_on_plan=e=>{const t=r.default.app_plan();let n;if(typeof e==="function"){n=e(t)}else{n=Boolean(t&&!t[e])}return n};T.disallow_annual_plan=()=>{const e=i.default.or_throw().current_user();return e.child(j.META_USER_FIELDS.perk_program).get()&&e.child(j.META_USER_FIELDS.credit_balance).get()>0};let B;if(typeof window!=="undefined"&&window!==null){var q;if((q=window.meta_keys)!=null&&q.stripe_public_key&&window.StripeCheckout){B=window.StripeCheckout.configure({key:window.meta_keys.stripe_public_key,locale:"auto",zipCode:true,billingAddress:false,image:"https://s3.amazonaws.com/appforest_uf/f1530470348315x942234361078590200/ItunesArtwork@2x.png"})}}let U;const F=()=>{var e;(e=U)!=null?e:U=i.default.or_throw().location.post("server://appeditor/get_current_user_card",{});return U.sync()};const W=(e,t)=>{const n=n=>{T.modify_app_plan({data:{plan:e,reason:n,frequency:t.frequency},no_card_needed:true,asked_feedback:true,cb:()=>{const e=t.trial_end;if(e){const n=Y();const a=r.default.appname();const l=i.default.or_throw().current_user()._id();s.run_once(30,(()=>z(a)),((r,i)=>{if(r){o.log(s.ensure_bubble_error(r))}const c={appname:a,trial_end_timestamp:t.trial_end,trial_length:n,trial_source:i,trial_start_timestamp:e-n*x.DAY_MS,user_id:l};b.track(d.FREE_TRIAL_CANCELED,{trial_data:c})}))}}})};new c.default.DowngradePanel({to_free_plan:(0,m.is_free_plan)(e),cb_yes:n}).show()};T.prompt_to_modify_plan=e=>{let{plan:t,new_freq:n,trial_data:o,modify_plan_source:a,trial_end_message:l,cb:c,cb_no:u,button_caption:d}=e;return s.run_once(30,(()=>({current_plan:r.default.app_plan(),available_plans:i.default.or_throw().location.request_synchronous("server://appeditor/get_available_plans","post",{appname:r.default.appname(),new_2023_pricing_enabled:p.is_state_r()})})),((e,i)=>{const{current_plan:s,available_plans:p}=i;const _=p[t];if(s&&G(s==null?void 0:s.id,t)){W(t,s)}else{var f;const e=(f=n!=null?n:s==null?void 0:s.frequency)!=null?f:"month";const i=n===h.BillingFrequency.Year&&(s==null?void 0:s.frequency)===h.BillingFrequency.Month;const p=!!o;const g=te({current_plan:s,plan_data:_,freq:e,is_trial:p,trial_end_message:l});o=s!=null&&s.trial_end?{...o,trial_end:h.TRIAL_END_NOW}:o;const v=ne(_,e);T.modify_app_plan({data:{plan:t,frequency:e,stripe_form_title:v,...o,modify_plan_source:a},no_card_needed:_.not_paid_per_app||(0,m.is_free_plan)(t),message:g,checkout_caption:i?"Confirm your annual subscription":r.default.appname(),cb:c,cb_no:u,button_caption:d})}}))};const G=(e,t)=>{if((0,m.is_free_plan)(t)&&!["app_agency","template_app","app_education","app_instructor","app_hackathon"].includes(e)){return true}else if(["app_personal_2019","app_professional_2019","app_personal_2022","app_professional_2022"].includes(t)&&["app_production_2019","app_production_2022"].includes(e)){return true}else if((0,m.is_2023_plan)(e)&&(0,m.is_2023_plan)(t)){return(0,m.is_downgrade)({from_plan_id:e,to_plan_id:t})}else{return false}};const V=(e,t,n)=>{const r=t.workload_overage_rate?"workload tier":"capacity";const i=n?`If you are currently subscribed to any add-ons, those will also be billed annually when you click "confirm."`:`All subscription add-ons are billed annually up front, in addition to your Bubble plan.`;return e===h.BillingFrequency.Year?`\n\nImportant note: ${i} Examples of subscription add-ons include: storage, ${r}, and plugins.`:""};n.get_important_note=V;const H=e=>`Are you sure you want to upgrade this apps plan to a ${h.FREE_TRIAL_TEXT} free trial of the ${e.display} plan?`+"\n\nPlease note that this free trial observes a monthly billing period.";const X=e=>{const t=e?` (${h.BillingFrequencyDisplay[e]})`:"";return t};n.get_billing_frequency=X;const Y=()=>{var e;const t=w.variant(y.FREE_TRIAL_LENGTH_ID);return(e=y.FREE_TRIAL_VARIANT_LENGTHS[t])!=null?e:h.FREE_TRIAL_DAYS};const K=(e,t)=>{if(e.trial_end){return`\n\nYour free trial will end and you will automatically be charged for the ${t.display}${X(e.frequency)} plan starting today.`}return""};n.get_trial_end_note=K;const J=(e,t)=>{const n=Boolean(!e.frequency||e.trial_end);if(n&&e.frequency===h.BillingFrequency.Year&&!t.not_paid_per_app){return"\n\nNote that you will not be able to change the billing period after you pick a plan."}return""};const Z=e=>{const t=(0,m.is_2023_plan)(e.id);if(t){return"\n\nWhen changing to this plan, you will be charged for all previous Workload Unit (WU) usage for this"+" calendar month"}return""};const Q=e=>{if(e===h.BillingFrequency.Year){return' When you click the "confirm" button, you will be charged for a whole year.'}return""};function ee(e,t,n,r,i){if(i){return i}if(t&&e){if(t.display===n.display){return`Are you sure you want to switch to annual billing on your ${t.display} plan?`}else{return`Are you sure you want to switch to from monthly billing on your ${t.display} plan to annual billing on the ${n.display} plan?`}}return`Are you sure you want to modify the plan to ${n.display}${r}?`}const te=e=>{let{current_plan:t,plan_data:n,freq:r,is_trial:i,trial_end_message:s}=e;if(i){return H(n)}const o=r===h.BillingFrequency.Year&&(t==null?void 0:t.frequency)===h.BillingFrequency.Month;const a=X(r);const l=t&&!o?K(t,n):"";const c=t?J(t,n):"";const u=Q(r);const d=Z(n);const p=V(r,n,o);const _=ee(o,t,n,a,s);return`${_}${l}${c}${u}${d}${p}`};const ne=(e,t)=>{let n;if(t===h.BillingFrequency.Year){const t=(0,m.get_yearly_price_total)(e);n=`$${t}/yr`}else{n=`$${e.monthly_price}/mo`}return`${n} ${e.display} plan`};T.should_redirect_to_meta_checkout=re;function re(e){const{original_plan:t,new_plan:n,trial_end:r,coupons:i,credit_balance:s}=e;let o=false;if(t){var a;o=(0,m.is_free_plan)(t)&&!!((a=(0,m.get_app_plan_edit_mode)(n))!=null&&a.monthly_price)}const l=!!r;const c=!!i||!!s;return(o||l)&&!c}const ie=e=>{var t;let{data:n,message:c,checkout_caption:_,panelLabel:f,no_card_needed:y,asked_feedback:w,cb:x,cb_no:j,button_caption:A}=e;const M=(t=n.stripe_form_title)!=null?t:"Bubble";n.appname=r.default.appname();s.run_once(30,(()=>{if(y||!a.plugins_live_here&&a.env!=="local"){return"no_need_card"}const e=r.default.app_plan();if((e==null?void 0:e.paying_user_id)===i.default.or_throw().current_user()._id()||!(e!=null&&e.paying_user_id)){var t;if(e!=null&&(t=e.card_data)!=null&&t.last4){return"no_need_card"}else{return"need_card"}}else if(i.default.or_throw().current_user_rights().admin){if(n.transfer){const e=F();if(e!=null&&e.last4){return"no_need_card"}else{return"need_card"}}else{return"no_need_card"}}else{return"impossible"}}),((e,t)=>{if(e||t==="impossible"){if(e){o.log(s.ensure_bubble_error(e))}window.MessagePanel({title:_,message:"There was an issue subscribing you to a plan, please try again."});return}const a=e=>{const{original_plan:t,new_plan:n,frequency:r}=e;R({title:M,description:_,label:f!=null?f:"Subscribe",original_plan:t,new_plan:n,frequency:r},O)};const E=e=>{var t;const n={title:"Uh oh! Your card was declined",message:"We were unable to validate your payment method. Please review your billing information and try again.",button_caption:"Try again"};const r={title:_,message:(t=e.message)!=null?t:e.to_json().translation};const i=e.display()==="Your card was declined.";return i?n:r};const k=e=>{var l,c,f,j,A;o.info("editor/subscription: Updating user subscription",{data:n,no_card_needed:y,res:t});const M=(l=(c=r.default.app_plan())==null?void 0:c.mrr)!=null?l:0;const k=(f=(j=r.default.app_plan())==null?void 0:j.id)!=null?f:null;const O=(A=r.default.app_plan())==null?void 0:A.frequency;v.default.show_general_message_immediate("We are updating your subscription...");if(e){n.token=e.id}if(p.is_state_r()){n.new_2022_pricing_enabled=true}if((0,m.is_free_plan)(n.plan)){n.cancellation_source=h.SOURCE_EDITOR}void i.default.or_throw().location.post("server://appeditor/subscribe_app_plan",n,((e,t)=>{v.default.hide_general_message();r.default.invalidate_app_plan();if(e){if(e.message==="stripe.NO_CARD_INFO"){window.MessagePanel({title:_,message:"Stripe error: We could not find payment information associated with your account",cb(){return a({original_plan:k,new_plan:n.plan,frequency:n.frequency})}})}else if(e.error_class==="StripePaymentRequiresAction"&&g.AllPlans.includes(n.plan)){u.launch_meta_payment({appname:n.appname,frequency:n.frequency,plan:n.plan,trial_end:n.trial_end,trial_source:n.trial_source,checkout_caption:_,redirecting_from_error:true})}else{const t=E(e);window.MessagePanel(t)}return}x==null?void 0:x();const l=e=>{if((e==null?void 0:e.bucketed)!=null||(e==null?void 0:e.feedback.length)>=4){var t,s;const a={reason_bucketed:(t=e.bucketed)!=null?t:null,reason_feedback:e.feedback,willing_to_chat:(s=e.willing_to_chat)!=null?s:null,appname:r.default.appname(),old_plan:k,mrr_loss:-M,type:(0,m.is_free_plan)(n.plan)?"per_app":"significant_downgrade"};void i.default.or_throw().location.post("server://appeditor/report_cancel_reason",a,(e=>{if(e){o.log(e)}}))}};if((0,m.is_free_plan)(n.plan)&&!["app_agency","template_app","app_instructor"].includes(String(k))&&!w){window.InputPanel({title:"Plan canceled",message:"The plan has been canceled. You can subscribe again any time.\n\nCan you tell us why you canceled your plan? That will help us make Bubble better.",input_is_multiline:true,cb_yes(e){l({feedback:e})}})}else{window.MessagePanel({title:_,message:n.transfer?"The subscription was sucessfully transfered to your account.":"Your application's subscription has been successfully updated."});if(n.reason){l(n.reason)}}if(n.transfer){b.track_with_marketing_metadata(d.USER_APP_TRANSFERRED,{app:n.appname})}else{s.run_once(30,(()=>({new_plan:r.default.app_plan(),user_first_subscription_date:i.default.or_throw().current_user().child("log_triggered_first_subscription_date").get()})),((e,t)=>{if(e){o.log(s.ensure_bubble_error(e));return}const{new_plan:i,user_first_subscription_date:a}=t;const l=i;if(n.plan!=="template_app"&&k==="template_app"){r.default.app().json.child("is_template").set(null,{name:"ModifyAppPlan"})}if((0,m.is_free_plan)(n.plan)){b.track("User unsubscribed an app",{app:n.appname,old_plan:k,mrr_delta:-M})}else{const e=n.modify_plan_source;b.track_with_marketing_metadata(d.USER_SUBSCRIBED_TO_PLAN,{app:n.appname,plan:n.plan,frequency:n.frequency,mrr_delta:l.mrr-M,new_mrr:l.mrr,old_plan:k,old_frequency:O,source:e});if(!a&&l.mrr>0){b.track(d.FIRST_SUBSCRIPTION,{app:n.appname,plan:n.plan,new_mrr:l.mrr,price:l.mrr})}const t=!!l.trial_end&&l.mrr===0&&l.monthly_price>0;if(t){b.track(d.FREE_TRIAL_CREATED_FROM_CLIENT,{app:n.appname,plan:n.plan,new_mrr:l.mrr,price:l.mrr})}if(k==="app_agency"&&l.mrr>0){var c;return b.track("Agency app converted to paid",{app:n.appname,plan:n.plan,new_mrr:l.mrr,agency_id:(c=r.default.app_plan())==null?void 0:c.paying_user_id})}}}))}}))};const O=(0,l.default)(k,N,{leading:true,trailing:false});if(t==="need_card"){var S,D;const e=i.default.or_throw().current_user().child("balance_number").get();const t=i.default.or_throw().current_user().child("coupon_text").get();const s={original_plan:(S=(D=r.default.app_plan())==null?void 0:D.id)!=null?S:null,new_plan:n.plan,trial_end:n.trial_end,coupons:t,credit_balance:e};if(re(s)){u.launch_meta_payment({appname:n.appname,frequency:n.frequency,plan:n.plan,trial_end:n.trial_end,trial_source:n.trial_source,checkout_caption:_})}else{var C,T;a({original_plan:(C=(T=r.default.app_plan())==null?void 0:T.id)!=null?C:null,new_plan:n.plan,frequency:n.frequency})}}else if(c){window.ConfirmPanel({title:_,message:c,cb_yes(){O()},cb_no(){j==null?void 0:j()},button_caption:A})}else{O()}}))};T.modify_app_plan=(0,l.default)(ie,N,{leading:true,trailing:false});T.buy_plugin_once=e=>{let{plugin:t,cb:n}=e;return s.run_once(30,(()=>{if(!a.plugins_live_here&&a.env!=="local"){return"no_need_card"}const e=r.default.app_plan();if((e==null?void 0:e.paying_user_id)===i.default.or_throw().current_user()._id()||!(e!=null&&e.paying_user_id)){var t;if(e!=null&&(t=e.card_data)!=null&&t.last4){return"no_need_card"}else{return"need_card"}}else if(i.default.or_throw().current_user_rights().admin){return"no_need_card"}else{return"impossible"}}),((e,a)=>{var l;let c;const u="Buy a plugin license";if(e||a==="impossible"){if(e){o.log(s.ensure_bubble_error(e))}window.MessagePanel({title:u,message:"There was an issue acquiring this plugin, please try again."});return}const d=e=>{v.default.show_general_message_immediate("We are processing this transaction...");const s=e?{plugin_id:t.id,appname:r.default.appname(),token:e.id}:{plugin_id:t.id,appname:r.default.appname()};void i.default.or_throw().location.post("server://appeditor/buy_plugin_once",s,((e,i)=>{v.default.hide_general_message();r.default.invalidate_app_plan();if(e){var o;window.MessagePanel({title:u,message:(o=e.message)!=null?o:e.to_json().translation});return}n();window.MessagePanel({title:u,message:"The plugin "+t.display()+" was successfully added to your app, you can now use it permanently."});b.track("User bought plugin once",{app:s.appname,plugin:t.display(),plugin_id:t.id,price:t.one_time_price()})}))};if((l=r.default.app_plan())!=null&&l.paid_plugin_free){var p;c=`You can add this plugin for free as the app is on the ${String((p=r.default.app_plan())==null?void 0:p.display)} plan. Keep in mind the app owner will have to subscribe to the plugin when they use this app in production.`}else{c="Are you sure you want to buy this plugin? $"+t.one_time_price()+" will be charged on the card on file for this app. One-time purchases are non-refundable."}if(a==="need_card"){const e=36;let n=`${t.display()} - $${t.one_time_price()}`;if(n.length>e){n=t.display()}R({title:u,description:n,label:"Buy for $"+t.one_time_price(),plugin_id:t.id},d)}else if(a==="no_need_card"){window.ConfirmPanel({title:u,message:c,cb_yes(){d()}})}}))};T.subscribe_to_paid_plugin=(e,t)=>{var n,i;let s;if((n=r.default.app_plan())!=null&&n.paid_plugin_free){var o;s=`You can add this plugin for free as the app is on the ${(o=r.default.app_plan())==null?void 0:o.display} plan. Keep in mind the app owner will have to subscribe to the plugin when they use this app in production.`}else{s=`Are you sure you want to subscribe to this plugin? The current month will be prorated and you will be charged $${e.price()} per month afterwards. Note that installing and uninstalling the plugin will not lead to a full-month charge.`}if(((i=r.default.app_plan())==null?void 0:i.frequency)===h.BillingFrequency.Year){s+="\nNote that since your plan is a yearly plan, you will be charged for the year, but will be prorated the amount as soon as you cancel."}return T.modify_app_plan({data:{plugin_id:e.id},message:s,checkout_caption:"Subscribing to a plugin",cb:t})};var se=T;n.default=se},{"../bubble_plans":14,"../client/analytics":20,"../client_config":41,"../constants/app_plans":47,"../constants/experiments":65,"../constants/segment_events":85,"../constants/subscriptions":90,"../constants/time":92,"../core/status_bar":415,"../lang/appquery":651,"../lib":741,"../logger":744,"../optional/meta/meta_constants":751,"../u":823,"../u/shared/callbacks":843,"./components/design/popup/InformationalPopup":509,"./css":560,"./downgradepanel.js":566,"./editor_experiments":568,"./payments/meta_payment":580,"./paywall/paywallpanel.js":581,"./utils/organization_metadata":595,"./utils/pricing_configs":596,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/debounce":1311,"solid-js":2313,"solid-js/web":2315}],590:[function(e,t,n){"use strict";var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");const i=e("./../u/shared/mode_check");const s=e("./../u/shared/b_array");const o=e("./../u/shared/b_object");const a=e("./../u/client/b_ui");const l=e("./../lang/appquery");const c=e("./../u/shared/async/autorun");const u=e("./../logger");const d=e("./editor_settings");const{ElementThumbnail:p}=e("./ElementThumbnail");const{render:_}=e("solid-js/web");i.edit_mode_only();let f=false;class h{constructor(){this.stack=[];this._thumbnail_num=0;$(document).on("vmousedown",(()=>{this.stack=[];this.update_stack()}))}add(e,t,n){var r;(r=n)!=null?r:n="left";if(!f){f=document.location.href.indexOf("turn_thumbnails_off")!==-1}if(!f){e.data("thumbnail_data",t);e.mouseenter((()=>{this.add_to_stack(e);this.update_stack(n)}));e.mouseleave((()=>{this.remove_from_stack(e);this.update_stack(n)}))}}add_to_stack(e){return this.stack.push(e[0])}remove_from_stack(e){return s.array_remove(this.stack,e[0])}update_stack(e){if(this.stack.length===0){this.set_current_thumb(null,null);this.remove();this.hide();return}let t=this.stack[0];for(const e of this.stack.slice(1)){if(!$.contains(e,t)){t=e}}t=$(t);this.set_current_thumb(t.data("thumbnail_data"),t,e)}set_current_thumb(e,t,n){if(o.json_stringify(e)!==this.current_thumbnail_data){this.change_thumb(e,t,n)}}remove(){var e,t;(e=this._old_thumbnail_instance)==null?void 0:e.container.destroy();(t=this._old_thumbnail_instance)==null?void 0:t.destroy();this._old_thumbnail_instance=null;this._thumbnail_num++;clearTimeout(this._start_rendering_timeout)}change_thumb(e,t,n){this.remove();this.current_thumbnail_data=o.json_stringify(e);let r,i;if(e!=null&&e.text){i=e.text}else{r=e}const s=r||i?300:1;const a=this._thumbnail_num;this._start_rendering_timeout=setTimeout((e=>{const r=this.get_canvas();v.DocumentationPalette().hide();if(i){r.addClass("show-text");r.text(i);r.css({width:"auto",height:"auto"});this.show(t,n)}else if(!d.get_setting("no_thumbnails")){r.removeClass("show-text");c.run_once(30,(()=>{var t,n;return e&&(typeof e==="function"||((t=l.element(e))==null?void 0:t.exists())||((n=l.style(e))==null?void 0:n.exists()))}),((i,s)=>{if(i){u.log(i);return}if(s){c.run_once(60,(()=>{if(a!==this._thumbnail_num){return false}return this.render_thumbnail(r,e)}),((e,r)=>{if(e){u.log(e)}if(r){this.show(t,n)}}),true)}else{this.hide()}}))}}),s,r)}is_visible(){return this._visible}show(e,t,n){if(!e.is(":visible")){return}this._visible=true;let r=this.get_canvas();r.velocity("stop");r.show();a.velocity(r,{opacity:1},{duration:n?0:300});r=this.get_canvas();const i=10;r.removeClass("left bottom reverse");r.addClass(t);let s,o;if(t==="left"){s=e.offset().left+e.outerWidth()+i-$(document).scrollLeft();o=e.offset().top-$(document).scrollTop()-5;if(s+r.outerWidth()>$(window).width()){s=e.offset().left-$(document).scrollLeft()-i-r.outerWidth();r.addClass("reverse")}if(e.height()<20){o-=7}}else if(t==="bottom"){s=e.offset().left-$(document).scrollLeft();o=e.offset().top+e.outerHeight()+i-$(document).scrollTop();if(o+r.outerHeight()>$(window).height()){o=e.offset().top-$(document).scrollTop()-i-r.outerHeight();r.addClass("reverse")}}r.css({left:s,top:o})}hide(e){const t=this.get_canvas();t.velocity("stop");a.velocity(t,{opacity:0},{duration:e?0:300}).queue((e=>{t.hide();t.removeClass("left bottom reverse");e();this._visible=false}))}get_canvas(){if(!this.canvas){this.canvas=a.div("thumbnail-canvas");$(document.body).append(this.canvas)}return this.canvas}render_thumbnail(e,t,n){var i;let s;if(typeof t==="function"){s=t()}else{s=l.element(t);if(!s.exists()){s=l.style(t);s=s.get_element_from_style();if(s==null){u.verbose("trying to render a thumbnail for non-existing element_id",{element_id:t});return true}}if(s.E.no_thumbnail){return false}}let o;if(s.E.custom_definition){o=s.E.custom_definition().get_responsive_version()>0;s.E.custom_definition().use_responsive_algorithm()}else{var c;o=s.is_responsive_v1();(c=s.root())==null?void 0:c.use_responsive_algorithm()}(i=this._cleanup_render)==null?void 0:i.call(this);this._cleanup_render=null;e.empty();if(o){this._cleanup_render=_((()=>(0,r.createComponent)(p,{element:s,maxWidth:200,maxHeight:200})),e[0]);e.css({width:"max-content",height:"max-content"});return true}const d=s.get_width();const f=s.get_height();const h={get_canvas(){return e},get_owner(){return null},add(t){e.append(t.canvas);t.canvas.css({"box-sizing":"border-box",width:d,height:f})},render(e){return $(e)},create_child(e,t){return new m(e,t)},initialize(){},destroy(){var e;return(e=this.child_container)==null?void 0:e.destroy()}};const v=g.ElementInstance(s,g.THUMBNAIL);v.register(null);this._old_thumbnail_instance=v;v.split_namespace();v.create_skeleton(h);v.do_show();v.get_canvas().addClass("rendered-element");v.autorun((()=>{if(!n){n=Math.min(1,200/d);n=Math.min(n,200/f)}e.empty();const t=a.div("thumbnail-area",e);a.apply_scale(v.get_canvas(),n);t.append(v.get_canvas());v.get_canvas().position("absolute");e.css({width:d*n,height:f*n});t.css({height:f*n})}));return true}}t.exports=c.singleton(h);const m=class e{constructor(e,t){this.owner_instance=e;this.container_canvas=t}get_canvas(){return this.container_canvas}get_owner(){return this.owner_instance}create_child(t,n){if(t.element.E.custom_definition&&t.element.E.custom_definition().get_responsive_version()>0){return new b(t,n)}else{return new e(t,n)}}render(e){return $(e)}add(e){if(!e.element.is_visible_on_page_load()){e.canvas.hide()}this.container_canvas.append(e.canvas);e.canvas.css({"box-sizing":"border-box",position:"absolute",left:e.element.get_left(),"z-index":e.element.get_zindex(),top:e.element.get_top(),width:e.element.get_width(),height:e.element.get_height()})}set_height(e,t,n){if(!(n!=null&&n.no_css_update)){e.canvas.css("height",t)}}initialize(){}};t.exports.Container=m;const g=e("./../lang/elements");const v=e("./documentationpalette");const b=e("./ResponsiveThumbnailContainer")},{"./../lang/appquery":651,"./../lang/elements":680,"./../logger":744,"./../u/client/b_ui":813,"./../u/shared/async/autorun":830,"./../u/shared/b_array":835,"./../u/shared/b_object":839,"./../u/shared/mode_check":851,"./ElementThumbnail":487,"./ResponsiveThumbnailContainer":488,"./documentationpalette":565,"./editor_settings":570,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js/web":2315}],591:[function(e,t,n){var r,i,s,o,a,l,c,u;u=e("./../u");u.edit_mode_only();c=e("./../content/tourcontent");r=e("./../lib");o=e("./css");l=e("./../logger");n.is_user_newer_than_three_weeks=function(e,t){return u.run_once(60,function(e){return function(){var e;e=r().current_user();return e.child("Created Date").get()}}(this),function(n){return function(n,r){var i;if(n){l.log(n);if(typeof t==="function"){t()}}i=Date.now();if(!r||r>i-6048e5){return typeof e==="function"?e():void 0}else{return typeof t==="function"?t():void 0}}}(this))};n.pressed_run=false;n.start_tour=function(e,t){var a,d;if(t==null){t=false}if(e==="demo_tour"){a=c.demo_tour;$(".btn.preview").on("click",(function(){n.pressed_run=true;return r().undostack.emit("change")}));u.run_once(30,(function(){return s.app().json.raw()}),(function(e,t){if(e){return l.log(e)}else{return u.local_storage_put("tour_app_data_for_run",t)}}));$(o.VISUAL_TAB).click();window.onbeforeunload=function(){u.eraseCookie("temp_db");return null};return d=new i(a,t)}else if(e==="new_app_tour"){a=c.new_app_tour;return n.is_user_newer_than_three_weeks((function(){return d=new i(a,t)}))}};a=function(e){if((e!=null?e.type:void 0)!=null){switch(e.type){case"Element":return $("#"+e.id);case"UI":if(e.text!=null){return $(e.class_name+":contains("+e.text+")")}else{return $(e.class_name)}}}};i=function(){function e(e,t){this.tour_data=e;this.modal=t;this.container=u.div("tour-popup",$("body"));if(this.modal){this.container.css({position:"fixed",top:0,left:0,width:"100%",height:"100%","z-index":"5000003"});this.container.mousedown(function(e){return function(e){e.stopPropagation();return e.preventDefault()}}(this))}this.canvas=u.div("tour-palette-window",this.container);this.content_zone=u.div("tour-content-zone",this.canvas);this.content_zone.draggable({stop:function(e){return function(t,n){return e.button_hint.text("Move back")}}(this)});this.arrow_top=u.div("arrow-top",this.content_zone);this.title=u.div("learn-title",this.content_zone);this.content=u.div("step-details",this.content_zone);this.content_zone.css({opacity:0,left:screen.width/2-450/2,top:screen.height/2-300});this.button_next=$('<button class="tour-button finish btn bubble-ui submit-button">Next!</button>');this.button_exit=$('<button class="tour-simple-button exit">'+this.tour_data.exit_button.caption+"</button>");this.button_hint=$('<button class="tour-simple-button hint"></button>');this.content_zone.append(this.button_next);this.content_zone.append(this.button_hint);this.content_zone.append(this.button_exit);this.button_next.on("click",function(e){return function(){return e.go_to_next()}}(this));this.button_exit.on("click",function(e){return function(){return e.tour_data.exit_button.run(e.container)}}(this));this.button_hint.on("click",function(e){return function(){if(e.current_step_data().tab==="design"){$(o.VISUAL_TAB).click()}if(e.current_step_data().tab==="workflow"){$(o.WORKFLOW_TAB).click()}setTimeout((function(){return e.load_step()}),20);return e.button_hint.text("")}}(this));r().undostack.on("change",function(e){return function(){if(e.successful_step()){return e.go_to_next()}}}(this));u.SetFocusOwner(this.canvas,null);this.canvas.show();u.velocity(this.content_zone,"fadeIn",{duration:200});this.current_step=0;this.load_step()}e.prototype.current_step_data=function(){return this.tour_data.steps[this.current_step]};e.prototype.go_to_next=function(){var e;if(typeof(e=this.current_step_data()).post_script==="function"){e.post_script()}this.current_step++;return u.wait_for_updates(function(e){return function(){return e.load_step()}}(this))};e.prototype.load_step=function(){var e,t;if(this.current_step_data()!=null){if(this.current_step_data().title){this.title.text(this.current_step_data().title)}this.content.html(this.current_step_data().content.replace(/\n/g,"<br>"));t=a(this.current_step_data().element);this.locate_palette(t);if(this.current_step_data().button_next){this.button_next.text(this.current_step_data().button_next);this.button_next.show()}else{this.button_next.hide();if(!this.current_step_data().validation_function){t.off(this.current_step_data().element.event_type+".tour_hinting");t.one(this.current_step_data().element.event_type+".tour_hinting",function(e){return function(){return e.go_to_next()}}(this))}}if(this.current_step_data().arrow_color){this.arrow_top.css("border-bottom-color",this.current_step_data().arrow_color);this.arrow_top.show()}else{this.arrow_top.hide()}if(this.current_step_data().arrow_position==="left"){this.arrow_top.css("margin-left","3px")}else{this.arrow_top.css("margin-left","138px")}return typeof(e=this.current_step_data()).pre_script==="function"?e.pre_script():void 0}else{return u.velocity(this.canvas,"fadeOut",{duration:200,complete_cb:function(e){return function(){return e.container.remove()}}(this)})}};e.prototype.successful_step=function(){var e;return(e=this.current_step_data())!=null?typeof e.validation_function==="function"?e.validation_function():void 0:void 0};e.prototype.locate_palette=function(e){return u.wait_for_updates(function(t){return function(){var n,r,i;if(e!=null?e.is(":visible"):void 0){r=e.offset(),i=r.top,n=r.left;return u.velocity(t.content_zone,{left:Math.min(Math.max(n+e.width()/2-170,0),$(window).width()-360),top:Math.min(i-$(document).scrollTop()+e.height()+40,$(window).height()-180)},{duration:500})}else{return u.velocity(t.content_zone,{left:screen.width/2-270/2,top:screen.height/2-300},{duration:500})}}}(this))};return e}();s=e("./../lang/appquery")},{"./../content/tourcontent":97,"./../lang/appquery":651,"./../lib":741,"./../logger":744,"./../u":823,"./css":560}],592:[function(e,t,n){var r,i,s,o,a,l,c;l=e("./../u");s=e("./../lang/appquery");o=e("../constants/known_plugins");i=e("../client/analytics");l.edit_mode_only();c=null;n.get_all_videos_id=function(e){if(!c){c=a.get_hardcoded_plugin(o.BUBBLE_PLUGIN).get_call("get_tutorial_videos").execute(void 0,{edit_mode:true})}return c};r=r=function(){function e(){this.canvas=l.div("tutorial-video-palette",$("body"));this.canvas.draggable({cancel:".video-zone",iframeFix:true,start:function(e){return function(){return e.invisible_draggable_div.css("display","block")}}(this),stop:function(e){return function(){return e.invisible_draggable_div.css("display","none")}}(this),containment:"window"});this.canvas.hide();this.close_button=l.div("close-button",this.canvas);this.title=l.div("title",this.canvas);this.video_zone=l.div("video-zone",this.canvas);this.invisible_draggable_div=l.div("invisible-draggable-div",this.canvas);this.invisible_draggable_div.css("display","none");this.close_button.on("vclick",function(e){return function(){return e.hide()}}(this))}e.prototype.show=function(e){i.track("Help Video Opened",{app:s.appname(),source:"Topnav",topic:e.title,video:e.id});this.shown=true;this.title.text(e.title);this.video_zone.html('<iframe src="https://player.vimeo.com/video/'+e.vimeo_id+'?title=0&amp;byline=0&amp;portrait=0&amp;color=0000FF&amp;autoplay=1" width="500" height="313" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>');this.canvas.css("opacity",0);this.canvas.show();l.velocity(this.canvas,"fadeIn",{duration:300});return l.add_finish_cb_to_vimeo(this.video_zone,e.vimeo_id,function(e){return function(){return e.hide()}}(this))};e.prototype.hide=function(){return l.velocity(this.canvas,"fadeOut",{duration:300,complete_cb:function(e){return function(){e.canvas.hide();e.video_zone.html("");return e.shown=false}}(this)})};e.prototype.is_visible=function(){return this.shown};return e}();n.TutorialVideoPalette=l.singleton(r);a=e("../services/shared/plugin_registry")},{"../client/analytics":20,"../constants/known_plugins":72,"../services/shared/plugin_registry":784,"./../lang/appquery":651,"./../u":823}],593:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../constants/time");const s=e("../../lib");const o=e("../../client/analytics");const a=e("../../lang/appquery");r.edit_mode_only();const l=45*i.DAY_MS;const c=21*i.DAY_MS;const u="initial_editor_exposure_counts";const d="Diverse Exposure Reached";const p=n;const _="diverse_exposure_1";const f={[_]:d};p.EVENTS={NEW_ACTION:"new_action",NEW_ELEMENT:"new_element",NEW_OPERATOR:"new_operator",DATA_ACTION:"data_action",INSTALLED_PLUGIN:"installed_plugin"};p.MILESTONE_THRESHOLDS={[_]:{[p.EVENTS.NEW_ACTION]:5,[p.EVENTS.NEW_ELEMENT]:5,[p.EVENTS.NEW_OPERATOR]:5,[p.EVENTS.DATA_ACTION]:5,[p.EVENTS.INSTALLED_PLUGIN]:1}};const h=function(e,t,n){r.createCookie(e,JSON.stringify(t),n)};p.maybe_increase_event_count=function(e){const t=s().current_user().child("Created Date").get();const n=c>Date.now()-t;if(n){g(e)}};const m=function(){const e=s().current_user().child("Created Date").get();const t=l-(Date.now()-e);return t/i.DAY_MS};const g=function(e){const t=r.readCookie(u);const n=t?JSON.parse(t):{};n[e]=parseInt(n[e]?n[e]:0)+1;const i=m();h(u,n,i);v(n,i)};const v=function(e,t){for(const n in p.MILESTONE_THRESHOLDS){if(e[n]){continue}const r=p.MILESTONE_THRESHOLDS[n];if(r){const i=Object.entries(r).every((t=>{let[n,r]=t;return e[n]>=r}));if(i){o.track_with_marketing_metadata(f[n],{app:a.appname()},(()=>{e[n]=Date.now();h(u,e,t)}))}}}}},{"../../client/analytics":20,"../../constants/time":92,"../../lang/appquery":651,"../../lib":741,"../../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],594:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../../lang/lang");const i=e("../../lang/evaluation/element_eval");const{VERSION_STYLE_OVERRIDES:s}=e("../../constants/elements");function o(e,t,n){if(!e){return true}if(typeof e==="string"){e=[e]}if(Array.isArray(e)){for(const o of e){let a,l,c;if(o.indexOf(" is ")!==-1){[a,l]=o.split(" is ")}else{a=o}function u(e){var t,n,r,i;const o=(t=(n=e.element_version)==null?void 0:n.call(e))!=null?t:0;const l=(r=e.is_styleable_property)!=null&&r.call(e,a)?o>=s&&e.property(a).raw()!==null?null:(i=e.get_style_if_exists)==null?void 0:i.call(e):null;if(l){return l.get_static_property(a,true)}else{return e.get_static_property(a,true)}}if(n&&t instanceof r.HasProperties){c=i.evaluate_property(t,a)}else{c=u(t)}if(c==null&&t instanceof r.State){c=u(t.context_element())}if(l){if(l==="false"){l=false}if(c!==l){return false}}else{if(!c||c==="none"){return false}}}return true}if(n&&t!=null&&t.element){return e(t.element)}return e(t)}t.exports=o},{"../../constants/elements":61,"../../lang/evaluation/element_eval":690,"./../../lang/lang":714,"core-js/modules/web.dom-collections.iterator.js":1123}],595:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.is_enterprise_app=u;n.user_in_enterprise=d;n.user_is_enterprise_owner=p;var r=o(e("../../lang/appquery"));var i=o(e("../../lib"));var s=e("../../u");function o(e){return e&&e.__esModule?e:{default:e}}let a;let l;function c(){(0,s.autorun_top)((()=>{var e,t;(e=l)!=null?e:l=(0,s.autorun)((()=>{var e;i.default.or_throw().current_user();i.default.or_throw().location.wipe_request_cache("server://appeditor/get_user_enterprise_permission","POST",{appname:r.default.appname()});(e=a)==null?void 0:e.invalidate()}));(t=a)!=null?t:a=(0,s.Watcher)((()=>i.default.or_throw().location.request_synchronous("server://appeditor/get_user_enterprise_permission","POST",{appname:r.default.appname()})))}));return a.get()}function u(){var e;return((e=r.default.app_plan())==null?void 0:e.id)==="app_organization_free"||c().app_organization!=null}function d(){return c().is_in_org}function p(){return c().is_org_owner}},{"../../lang/appquery":651,"../../lib":741,"../../u":823}],596:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.is_state_r=n.is_state_ar=n.is_state_a_restricted=n.is_state_a=n.initialize=n.get_pricing_plan_key=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=u(e("../../logger"));var i=l(e("../../lib"));var s=u(e("../editor_experiments"));var o=u(e("../../constants/experiments"));var a=u(e("../../shared/pricing_configs"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=c(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}let d;let p;let _;let f;const h=function(){var e;return m()||((e=s.variant(o.NEW_PRICING_PLAN_CHARTS_ID))==null?void 0:e.value)===o.NEW_PRICING_PLAN_CHARTS_VARIANT_ID};n.is_state_a=h;const m=function(){var e;if(g()||(e=window)!=null&&e.cornbread){return true}return d};n.is_state_a_restricted=m;const g=()=>{var e,t;return p||((e=window)==null?void 0:e.brisket)||((t=window)==null?void 0:t.pancakes)};n.is_state_r=g;const v=()=>{var e;return _||((e=window)==null?void 0:e.cornbread)};n.is_state_ar=v;const b=()=>f;n.get_pricing_plan_key=b;const y=async function(e,t){a.registerIsStateRHook(g);a.registerPricingPlanKeyHook(b);const n=i.default.or_throw().location.post("server://appeditor/check_user_state",{},((e,t)=>{if(e){r.warn("Error checking user state",{err:e});d=false}else{d=t.a;p=t.r;_=t.ar}}));const s=i.default.or_throw().location.post("server://appeditor/get_pricing_plan_key",{appname:t},((e,t)=>{if(e){r.warn("Error getting pricing plan key",{err:e});f=undefined}else{f=t}}));return await Promise.all([s,n]).then((()=>{e.turn()}))};n.initialize=y},{"../../constants/experiments":65,"../../lib":741,"../../logger":744,"../../shared/pricing_configs":800,"../editor_experiments":568,"core-js/modules/web.dom-collections.iterator.js":1123}],597:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.property_editor_utils=n.INITIAL_PE_X_POSITION_OFFSET=void 0;var r=e("../css");const i={SpaceExistsToPositionLeft:o};n.property_editor_utils=i;const s=450;n.INITIAL_PE_X_POSITION_OFFSET=s;function o(){var e,t;let n=Number((e=$(r.PROPERTY_EDITOR).offset())==null?void 0:e.left);const i=Number((t=$(r.PROPERTY_EDITOR).offset())==null?void 0:t.top);if(n===0&&i===0){n=Number($(window).width())-s}const o=$(r.PROPERTY_EDITOR).width()?Number($(r.PROPERTY_EDITOR).width()):0;const a=$(window).width()?$(window).width():0;const l=Number(a)/2+30;return n+o>l}},{"../css":560}],598:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.setParam=n.getParam=n.clearParam=void 0;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.url.js");e("core-js/modules/web.url-search-params.js");const r=()=>new URL(document.location.href);const i=e=>r().searchParams.get(e);n.getParam=i;const s=(e,t)=>{const n=r();if(!t){n.searchParams.delete(e)}else{n.searchParams.set(e,t)}window.history.pushState(null,null,n)};n.setParam=s;const o=e=>{const t=r();t.searchParams.delete(e);window.history.pushState(null,null,t)};n.clearParam=o},{"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.url-search-params.js":1126,"core-js/modules/web.url.js":1127}],599:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../lib");const i=e("../u/shared/mode_check");const s=e("../logger");const o=e("../u/shared/async/b_async");const a=e("../u/shared/async/dependency");const l=e("../lang/evaluation/eval_node_state");const c=e("./ExternalValue");const u=2*60*1e3;let d={};let p={};let _=false;let f={};let h={};function m(e,t){for(const n in t){const r=t[n];const i=e[n];if(i&&r&&typeof i==="function"&&typeof r==="function"){if(!m(i,r)){return false}}else{if(i!==r){return false}}}return true}function g(e){var t,n;return(n=(t=h)[e])!=null?n:t[e]=o.MakeSwitch(null,"api data loaded for "+e)}function v(e,t,n,r){var s;if(n.partial){const r=j(e,t);if(r&&!r.partial&&!r.err&&m(r.data,n.data)){return}}const o=e+"_"+t;p[o]=r;d[o]=n;(s=f[o])==null?void 0:s.invalidate();g(o);if(n.partial){h[o].turn_off()}else{h[o].turn_on()}if(i.on_server()){if(!_){_=true;setTimeout(x,u)}}}function b(e,t){j(e,t);const n=e+"_"+t;g(n);return o.ensure_ready(h[n])}function y(e,t){const n=e+"_"+t;g(n);return h[n]}function w(e,t){var n,r;const i=e+"_"+t;d[i]=null;(n=f[i])==null?void 0:n.invalidate();(r=h[i])==null?void 0:r.turn_off()}function x(){_=false;const e=Date.now();const t={};const n={};const r={};const i={};for(const[a,l]of Object.entries(p)){if(e<l){n[a]=l;t[a]=d[a];r[a]=f[a];i[a]=h[a]}else{var s,o;(s=f[a])==null?void 0:s.invalidate();(o=h[a])==null?void 0:o.turn_on()}}d=t;p=n;f=r;h=i}function j(e,t){var n,r;const i=e+"_"+t;const s=d[i];if(s!=null&&Date.now()>p[i]){var o;(o=h[i])==null?void 0:o.turn_off();d[i]=null;return null}(r=(n=f)[i])!=null?r:n[i]=a.Dependency();f[i].register();if(s!=null&&s.err){throw s.err}return s}class A extends c{constructor(e){var t;let{human:n,uid_field:r,build_call_from_uid:i,data_container:s,fields:o,cache_time:a}=e;super();this.storable=true;this.bindable=true;this.human=n;this.uid_field=r;this.build_call_from_uid=i;this.data_container=s;this.fields=o;this.cache_time=a;(t=this.cache_time)!=null?t:this.cache_time=u;this._is_executing={}}convert_to_bubble_instance(e){function t(e){if(e!=null){return String(e)}else{return e}}if(Array.isArray(e)){return r().db_instance().static_list(this.full_name,e.map((e=>t(e==null?void 0:e[this.uid_field]))))}else{return t(e==null?void 0:e[this.uid_field])}}execute_my_call(e,t,n){if(this._is_executing[e]){return}this._is_executing[e]=true;const{name:r,prev:i,properties:a}=this.build_call_from_uid(e);let c=null;const u=setTimeout((()=>{s.warn("APIValue took too long too load",{uid:e,_returned:c,call_name:r,human:this.human})}),29*1e3);o.WaitFor(y(this.full_name,e),(()=>clearTimeout(u)));const d=l.get_current_eval_node();const p=this._service.get_call(r);p.execute_async(i,a,null,{current_eval_node:d,_raw:t},n).callback(((t,n)=>{this._is_executing[e]=false;c={err:t,value:n};if(t){return v(this.full_name,e,{err:t},Date.now()+this.cache_time)}}));return null}lookup_fn(e){const t=this;return function(n,r,i,s,o){var a,l,c;if(!n){return this.ret_btype().cast(null)}const u=(a=(l=n._id)==null?void 0:l.call(n))!=null?a:n;if(t.uid_field===e){return this.ret_btype().cast(u)}let d=j(t.full_name,u);if(d){if(d.data[e]!=null||!d.partial){return this.ret_btype().cast(d.data[e])}}t.execute_my_call(u,s,o);b(t.full_name,u);d=j(t.full_name,u);return this.ret_btype().cast((c=d)==null?void 0:c.data[e])}}get_basic_message(e,t){var n;const r=(n=t.fn)!=null?n:this.lookup_fn(e);return{...super.get_basic_message(e,t),fn:r,is_lookup:false}}display(){return this.human}editable(){return false}service(){return this._service}short_id(){return this.name}export_to_string(e){return`(Data with ID "${e}" from an API)`}debugging_display(e){return`(Data with ID "${e}" from an API)`}equals(e,t){return String(e)===String(t)}get_sample(){return null}cast(e){if(typeof e==="number"){return String(e)}else{return e}}extract(e){return this.flatten_raw(e)}notify(e,t){const n=e==null?void 0:e[this.uid_field];if(n==null){return}if(t.invalidate){w(this.full_name,n)}else{let r;if(t.partial){r={data:e,partial:true}}else{r={data:e}}v(this.full_name,n,r,Date.now()+this.cache_time)}}notify_server_action(e,t){const n=e=>{if(["string","number"].includes(typeof e)){const t={};t[this.uid_field]=e;const n={invalidate:true};return this.notify(t,n)}};if(typeof(e==null?void 0:e.all)==="function"){for(const t of e.all()){n(t)}}else{n(e)}}get_JS_object(e){return e}JS_to_bubble(e){return e}}t.exports=A},{"../lang/evaluation/eval_node_state":694,"../lib":741,"../logger":744,"../u/shared/async/b_async":832,"../u/shared/async/dependency":834,"../u/shared/mode_check":851,"./ExternalValue":602,"core-js/modules/web.dom-collections.iterator.js":1123}],600:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.url.js");e("core-js/modules/web.url-search-params.js");const r=e("querystring");const i=e("../u");const s=e("../u/shared/async/b_async");const o=e("../u/shared/async/b_fiber");const a=e("../u/shared/b_number");const l=e("../u/shared/b_object");const c=e("../u/shared/mode_check");const u=e("../logger");const d=e("../u/shared/errors");const p=e("../db/hydrate");const _=e("../u/shared/async/async_state");const f=e("../u/shared/incremental");const h=e("../u/shared/async/dependency");const m=e("../lang/btype_ids");const g=e("./not_critical_retry_failure");const v={};const b={};const y={};const w={};const x={};const j={};const A=Date.now();function M(e){var t;return!e.method||["get","delete"].includes((t=e.method)==null?void 0:t.toLowerCase())}function E(e){if(M(e)){if(e.data){if(e.url.indexOf("?")===-1){return e.url+"?"+r.stringify(e.data)}else{return e.url+"&"+r.stringify(e.data)}}}return e.url}const k={data_type_for_ajax_call:true,skip_property_security:true};class O{constructor(e){this._execute_built_request=this._execute_built_request.bind(this);this._service=e}static invalidate_client_side_calls(e){var t;(t=e)!=null?t:e=[];for(const t of e){var n,r;(n=v[t])==null?void 0:n.turn();delete v[t];delete w[t];delete y[t];(r=b[t])==null?void 0:r.invalidate()}}service(){return this._service}display(){return this.human}get_value_id(){if(this.is_list){return m.list_type(this.value_id)}else{return this.value_id}}get_value_bubble_null(){return T.get(this.get_value_id()).get_bubble_null()}get_authenticator(){return this.service().get_authenticator()}is_authenticated(){return this.get_authenticator().is_authenticated()}must_proxy(){var e;return(e=this._must_proxy)!=null?e:this.get_authenticator().must_proxy()}get_key(e,t,n){var r,i;return(r=(i=this.override_key)==null?void 0:i[e])!=null?r:this.service().get_key(e,t,n)}get_property(e,t){let n,r;if(this[e]){r=this[e];n=this}else{const t=this.service();if(t[e]){r=t[e];n=t}}if(!r&&!k[e]){if(t){return null}throw new d.UnexpectedError("call "+this.human+" missing property "+e)}if(typeof r==="function"){r=r.call(n)}return r}execute(e,t,n,r,i){var o;const a=N.get_current_eval_node();if(a==null&&c.on_client()&&!c.is_edit_mode()&&this.service_name==="apiconnector2"){u.warn("oddly missing current_eval_node in call.execute",{_raw:r})}const d={current_eval_node:a,_raw:r};const f=this._execute_async.bind(this,e,t,n,d,i);if(((o=_.CurrentNotReadyCatcher)==null?void 0:o.length)>0){return null}if(c.on_server()){return f().block().ret}else{var m,g,A;const r=l.json_stringify(p.dehydrate_tree({full_name:this.full_name,prev:e,properties:t,authentication:n}));(m=b[r])!=null?m:b[r]=h.Dependency();b[r].register();(g=(A=this.service()).notify_call_was_hashed)==null?void 0:g.call(A,r,t);if(!v[r]){v[r]=s.MakeKey(null,"Call.execute key for "+r);const t=f();v[r].name=t.toString.bind(t);t.callback(((t,i)=>{var o,a;if(t){var c;x[r]=t;(c=v[r])==null?void 0:c.turn();return}const{ret:u,properties:d}=i;const _=l.json_stringify(p.dehydrate_tree({full_name:this.full_name,prev:e,properties:d,authentication:n}));y[r]=u;w[_]=u;(o=v[r])==null?void 0:o.turn();(a=v[_])!=null?a:v[_]=s.MakeKey(null,"Call.execute server_hash");v[_].turn();if(_!==r){var f;(f=j[r])!=null?f:j[r]=0;j[r]++;setTimeout((()=>{delete y[r];if(!w[r]){delete v[r]}}),j[r]===1?1:Math.pow(2,j[r])*5e3)}}))}s.ensure_ready(v[r]);if(x[r]){throw x[r]}else{var M;return(M=w[r])!=null?M:y[r]}}}execute_async(e,t,n,r,i){return this._execute_async(e,t,n,r,i).then((e=>{let{ret:t}=e;return t}))}_execute_async(e,t,n,r,i){if(!c.on_server()&&this.must_proxy()){return this.proxy_request(e,t,n,r,i).then((e=>{this.notify_value(e.ret);return e}))}const s={prev:e,properties:t};const a=this.build_request(e,t,n);const l=this._execute_built_request({req:a,test_info:s,prev:e,properties:t,authentication:n});let u;if(this.service().handle_request_failures){u=this.service().handle_request_failures}else{u=r=>{if(r.statusCode){return r}else if(this.service().not_production_critical&&P.is_retryable(r)){return g(this.service().display(),r)}else{if(r.message===o.QUEUE_TIMEOUT){return r}const i=this.service();return new d.UnexpectedError("execute_async error",{err:r,prev:e,properties:t,authentication:n,service_display:i.display(),service_name:i.name})}}}return l.then((e=>({ret:e,properties:t})),u)}_execute_built_request(e){let{req:t,test_info:n,prev:r,properties:l,authentication:c}=e;if(t.dont_do_call){if(this.service().get_action_calls().includes(this.name)&&!t.no_error||t.force_error_message){var u;throw new d.UserError("MISSING_INFO",(u=t.message)!=null?u:D().get_text("CORE","MISSING_INFO")+this.human)}else{return s.Promise(null)}}if(t.override_output){this.notify_value(t.results);return s.Promise(t.results)}return i.Promise(t).block_promise(12e5).then((e=>{a.round_all(e);return e})).then((e=>D().http_request(e).block_promise(12e5).then((t=>{var i;const s=(i=this.modify_and_retry)==null?void 0:i.call(this,e,t);if(s){e=s;return this._execute_built_request({req:e,test_info:n,prev:r,properties:l,authentication:c})}const a=this.service().response_to_data(e,t,this.get_property("return_type",true),this);o.optional_pause("response to data finished");n.result_call=a;const u=this.extract_data(a,l,t,e);o.optional_pause("extract data finished");n.result_processed=u;this.notify_value(u);o.optional_pause("notify value finished");return u}))))}build_request(e,t,n){var r,i;const o=this.build(e,t);if(D().bubble_version()>=25){var a;(a=o.headers)!=null?a:o.headers={};if(!("User-Agent"in o.headers)){o.headers["User-Agent"]="Bubble"}}if(o.dont_do_call||o.override_output){return o}const l=this.get_property("data_type_for_ajax_call");if(l){o.dataType=l}const c=this.get_property("custom_retry_handler",true);if(c){o.custom_retry_handler=c}if(this.get_property("return_type",true)==="raw"){o.encoding=null}(r=o.method)!=null?r:o.method="get";o.method=o.method.toLowerCase();if(o.url&&o.path){throw new d.UnexpectedError("call "+this.name+" @build() call returned an object with both a url and a path: do one or the other")}if(!o.url){var p;o.url=this.get_property("base_url")+((p=o.path)!=null?p:"");delete o.path}const _=this.get_authenticator();(i=_.add_shared_params_and_headers)==null?void 0:i.call(_,o);const f=s.Promise(_.add_authentication(o,n));new URL(o.url).host.split(".").forEach((e=>u.info("External API Call Built",{display:e,method:o.method,url:o.url,headers:o.headers})));return f.block_promise().then((e=>{if(M(e)){e.url=E(e);delete e.data}return e}))}proxy_request(e,t,n,r,i){var o;let a;let{_raw:l,current_eval_node:_}=(o=r)!=null?o:{};e=p.dehydrate_tree(e);t=p.dehydrate_tree(t);if(this.get_property("skip_property_security")){a=s.Promise({skip_property_security:true})}else if(typeof this.generate_server_properties==="function"){a=s.Promise({skip_property_security:true})}else{if(l==null&&!(i!=null&&i.constraint_messsage)){throw new d.UnexpectedError("Missing _raw in proxy_request",{current_eval_node:_})}a=I.serialize_context(i,_)}return a.then((i=>{var s,o;(s=i)!=null?s:i={error_serializing_context:true};_=(o=_)==null?void 0:o.json._path();r={_raw:l,current_eval_node:_,page_name:D().location.get_underlying_page()};const a=D().location.post("server://apiservice/doapicallfromserver",{timezone_string:D().current_timezone(),service_name:this.service().name,version:this.service().version,call_name:this.name,prev:e,properties:t,authentication:n,call_location:r,serialized_context:i,page_load_time:A,app_last_change:c.is_edit_mode()||c.is_plugin_edit_mode()?"edit":C.last_change(),ret_properties:true});return a.then((s=>{var o,a;if((s==null?void 0:(o=s.ret)==null?void 0:o.__bubble_tz_string_in_body)===false){u.info("doapicall request made attempting to pass in tz string and failed!",{appname:C.appname(),attempted_request:{timezone_string:D().current_timezone(),service_name:this.service().name,version:this.service().version,call_name:this.name,prev:e,properties:t,authentication:n,call_location:r,serialized_context:i,page_load_time:A,app_last_change:c.is_edit_mode()||c.is_plugin_edit_mode()?"edit":C.last_change(),ret_properties:true}})}s==null?true:(a=s.ret)==null?true:delete a.__bubble_tz_string_in_body;return s}))}))}extract_data(e,t,n,r){o.optional_pause();if(this.post_processing){e=this.post_processing(e,t,n,r)}let i;if(this.data_container){i=l.extract_from_object(e,this.data_container)}else{i=e}o.optional_pause();const s=T.get(this.value_id);o.optional_pause();const a=e=>{var t,n,r;const i=(t=(n=(r=s.plugin).extract)==null?void 0:n.call(r,e))!=null?t:e;return i};if(Array.isArray(i)){return f.incremental_map(5,i,a)}else{return a(i)}}notify_value(e){if(!e){return}const t=T.get(this.value_id);if(typeof t.plugin.notify!=="function"){return}if(Array.isArray(e)){f.incremental_for_each(5,e,(e=>{t.plugin.notify(e,this)}))}else{t.plugin.notify(e,this)}}get_doc_link(){return this.doc_link}}t.exports=O;const S=e("../db/db");const D=e("../lib");const C=e("../lang/appquery");const T=e("../lang/btypes");const N=e("../lang/evaluation/eval_node_state");const P=e("../retryable");const I=e("../lang/context_serialization/context_serializer");let R=e("../client_config")},{"../client_config":41,"../db/db":427,"../db/hydrate":429,"../lang/appquery":651,"../lang/btype_ids":652,"../lang/btypes":653,"../lang/context_serialization/context_serializer":659,"../lang/evaluation/eval_node_state":694,"../lib":741,"../logger":744,"../retryable":776,"../u":823,"../u/shared/async/async_state":829,"../u/shared/async/b_async":832,"../u/shared/async/b_fiber":833,"../u/shared/async/dependency":834,"../u/shared/b_number":838,"../u/shared/b_object":839,"../u/shared/errors":846,"../u/shared/incremental":848,"../u/shared/mode_check":851,"./not_critical_retry_failure":620,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.url-search-params.js":1126,"core-js/modules/web.url.js":1127,querystring:2279}],601:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");var r,i;function s(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const o=e("lodash/isEqual");const a=e("querystring");const l=e("../logger");const c=e("../lib");const u=e("../lang/appquery");const d=e("../u");const p=e("../u/shared/async/b_fiber");const _=e("../u/shared/b_object");const f=e("../u/shared/decaf");const h=e("../u/shared/errors");const m=e("../u/server/server_errors");const g=e("../u/shared/incremental");const v=e("../constants/lang");const b=e("../constants/locations");const y=e("../constants/plugin");const w=e("../shared/environment_utilities");const x=e("../lang/elements/style_properties");const j=e("../lang/caching");const A=e("../lang/btype_ids");const M=e("../lang/btypes");const E=e("../retryable");const k=e("./ExternalCall");const O=e("./not_critical_retry_failure");const S=e;let D;if(d.on_server()){D=S("lru-cache")}let C;const T=function(){if(C){return C}if(d.on_server()){C=new D({max:500,length(){return 1}})}else{C=new Map}return C};function N(e,t,n){var r;function i(t){let r;if(n.fields){r=n.fields(t)}else{r=L.add_fields_from_parameters(n.parameters,[])}L.add_key_button(e,r);return r}const s={display(e){return n.human},category:(r=n.category)!=null?r:"plugins",fields:i,field_names:v.DETECT_FIELD_NAMES,data_to_refresh:null,return_value(e){if(e!=null&&n.return_value!=null){n.value_id=n.return_value(e);return n.value_id}else{return n.get_value_id()}},get_doc_link(){return n.get_doc_link()},call:n,check_for_errors(e,t){if(n.can_be_used_as_action===false&&!n.must_proxy()){return t(`${e.display()}: You're using this API connector call as an action but it is currently set up as a Data source`)}}};if(n.must_proxy()){s.run=(e,t,r,i)=>{r.get_server_outcome(e,((t,r)=>{if(t){i(t)}else{var s,o,a,l,c;const t=(s=(o=n.value_id)!=null?o:(a=n.return_value)==null?void 0:a.call(n,e))!=null?s:null;const u=n.service().get_calls_to_refresh(n,e);k.invalidate_client_side_calls(u);(l=(c=M.get(t).plugin).notify_server_action)==null?void 0:l.call(c,r,n);i(null,r)}}))};s.server_method="external_call_server_action"}else{s.run=function(){throw new h.OwnerError("Invalid action - this call cannot be set up as an action.")}}return s}class P{constructor(e,t){this.id=e;this.data=t}_raw(){if(!this.data){l.warn("missing element plugin data",{id:this.id});return null}return this.data}display(){var e,t;return(e=(t=this._raw())==null?void 0:t.display)!=null?e:"missing element plugin data for "+this.id}category(){var e,t;return(e=(t=this._raw())==null?void 0:t.category)!=null?e:"missing element plugin data for "+this.id}icon(){var e,t;return(e=(t=this._raw())==null?void 0:t.icon)!=null?e:"missing element plugin data for "+this.id}name(){var e;return(e=this._raw())==null?void 0:e.plugin_name}}let I=(r=j.cached({type:j.AUTORUN,compare_fn:(e,t)=>{if(e!=null&&e.call_raw_data&&t!=null&&t.call_raw_data){return o(e.call_raw_data,t.call_raw_data)}return _.compare(e,t)}}),i=class e{display(){return this.human}toUniqueString(){return"service_"+this.name+"_"+this.version}get_authenticator(e,t){if(typeof this.authenticator==="function"){return this.authenticator(e,t)}else{return this.authenticator}}get_calls_to_refresh(e,t){return[]}error_wrapper(e){if(!this.handle_request_failures){return e()}try{return e()}catch(e){const t=this.handle_request_failures(e);if(t==null){throw new h.UnexpectedError("handle_request_failures should return the original error or a transformed one",{original:e})}throw t}}get_key(e,t,n){const r=this.get_keys();if(!r[e]){if(e==="server_redirect"||n){return null}throw new m.ClientError("missing key for service",{key_name:e,service_name:this.name,human:this.human})}const i=t!=null?t:u.app_version();const s=i!==b.LIVE_VERSION||!w.is_production();const o=u.app();function a(t){if(r[e].type==="client_safe"){return o.get_public_setting(t)}return o.get_private_setting(t)}const l=a(`${this.name}_${e}`);if(!s){return l}const c=a(`${this.name}_${e}_test`);return c!=null?c:l}get_keys(){var e,t,n;const r=(e=this._get_raw_list("keys"))!=null?e:{};(t=(n=this.get_authenticator()).add_generic_authenticator_keys)==null?void 0:t.call(n,r);return r}get_keys_for_editor(){const e={...this.get_keys()};if(this.name!=="stripe"){for(const t in e){const n=e[t];if([null,undefined,"MultilineTextBox"].includes(n.editor)){e[t+"_test"]={...n};e[t+"_test"].caption=n.caption+" - dev."}}}return e}has_keys(){return Object.keys(this.get_keys()).length>0}get_public_key(){return this.get_key("appid")}get_secret_key(){return this.get_key("appsecret")}are_keys_missing(){const e=this.get_authenticator();if(e.are_keys_missing!=null){return e.are_keys_missing()}for(const[e,t]of Object.entries(this.get_keys())){if(t.editor!=="Checkbox"){let n;if(t.type==="secure"){n=u.get_private_setting(this.name+"_"+e)}else{n=u.get_public_setting(this.name+"_"+e)}if(!n&&!t.optional){return true}}}return false}has_custom_settings(){return this.get_settings_panel!=null}has_html_header(){return this.html_header!=null}_get_raw_list(e){if(typeof this[e]==="function"){return this[e]()}else{return this[e]}}get_values(){var e;const t=(e=this._get_raw_list("values"))!=null?e:{};for(const[e,n]of Object.entries(t)){n.name=e;n.full_name=A.api_type(`${this.name}.${e}`);n._service=this}return t}get_call_class(e){return this._get_raw_list("calls")[e]}get_calls(){var e;return Object.keys((e=this._get_raw_list("calls"))!=null?e:{})}get_call(e){return this._instantiate_call(e,this.get_call_class(e))}_instantiate_call(e,t){if(typeof t!=="function"){if(this.dynamic_calls){return}else{if(c().is_edit_mode()){l.error("call is not a class",{call_name:e,name:this.name});return}else{var n;throw new h.OwnerError("The call "+e+" on "+((n=this.display())!=null?n:this.name)+" is not defined")}}}const r=new t(this);const i=this.name+y.PLUGIN_SEPARATOR+e;r.name=e;r.full_name=i;r.service_name=this.name;return r}get_actions(){const e=[];for(const t of this.get_action_calls()){e.push(this.name+y.PLUGIN_SEPARATOR+t)}const t=this._get_raw_list("actions");for(const n in t){e.push(this.name+y.PLUGIN_SEPARATOR+n)}return e}get_events(){var e;return Object.keys((e=this._get_raw_list("events"))!=null?e:{})}get_elements_visual_edit(){return Object.entries(this.get_elements()).map((e=>{let[t,n]=e;return new P(t,n)}))}get_elements(){var e;const t=(e=this._get_raw_list("elements"))!=null?e:{};const n={};for(const[e,r]of Object.entries(t)){const t=this.name+y.PLUGIN_SEPARATOR+e;r.plugin_name=t;n[t]=r}return n}get_action(e){var t,n;const r=R.get_plugin_and_type(e)[1];const i=this._get_raw_list("actions");let s;if(i!=null&&i[r]){var o,a;s=i[r];(a=(o=s).fields)!=null?a:o.fields=e=>{const t=s._fields(e);L.add_key_button(this.name,t);return t}}else{if(this.get_calls().includes(r)){const e=this.get_call(r);s=N(this.name,r,e)}}if(!s){return null}s.is_plugin=true;s.service=this.name;(n=(t=s).category)!=null?n:t.category="plugins";return s}get_local_cache_key(e){return`${this.toUniqueString()}-${e}`}get_event(e){const t=this.get_local_cache_key(e);if(!T().has(t)){var n;const i=R.get_plugin_and_type(e)[1];const s=(n=this._get_raw_list("events"))!=null?n:{};const o=s[i];if(!o){return null}if(o.element_name){var r;B.make_element_event(e,o,true,(r=this.is_testing)==null?void 0:r.call(this))}else{B.make_gen_event(e,o)}o.is_plugin=true;o.service=this.name;T().set(t,o)}return T().get(t)}get_element(e,t){var n;(n=t)!=null?n:t=false;const r=this.get_local_cache_key(e);if(!T().has(r)||t){const t=R.get_plugin_and_type(e)[1];const n=this._get_raw_list("elements");const i=n==null?void 0:n[t];if(!i){return null}i.is_plugin=true;i.service=this.name;z.make_element(e,i,true);const s=!i.is_non_hardcoded_plugin;if(s){for(const[e,t]of f.object_entries(i.field_names)){if(t.in_style){x.register_style_property(e)}}}T().set(r,i)}return T().get(r)}get_public_values(){var e;const t=(e=this._get_raw_list("public_values"))!=null?e:[];const n=this.get_values();for(const e of t){if(!n[e]){throw new h.UnexpectedError("Could not find value "+e+" in "+this.name)}}return t}get_public_calls(){const e=this._get_raw_list("public_calls");return e!=null?e:[]}get_user_calls(){const e=this._get_raw_list("user_calls");return e!=null?e:[]}get_action_calls(){const e=this._get_raw_list("action_calls");return e!=null?e:[]}get_server_actions(){var e;return(e=this.server_actions)!=null?e:[]}get_oauth_providers(){var e;return(e=this._get_raw_list("oauth_providers"))!=null?e:[]}get_oauth_providers_simple(){return this.get_oauth_providers().map((e=>{var t;return(t=e.id)!=null?t:e}))}is_oauth_provider(){return this.get_oauth_providers().length>0}is_storage_provider(){return this.file_upload!=null}is_video_service(){return this._is_video_service}response_to_data(e,t,n,r,i){var s;let{path:o,url:l,uri:c,method:u,data:d,headers:_}=e;(s=n)!=null?s:n="json";let f=false;let m={};if(t.statusCode<200||t.statusCode>299||this.errors_on_200){if(!i){var v;const e=(v=this.get_error_message)==null?void 0:v.call(this,t,r);if(e){const n=new h.OwnerError("Received error from api",{display:e});n.statusCode=t.statusCode;throw n}else if(!this.errors_on_200){var b;if(this.not_production_critical&&E.is_retryable(null,t)){throw O(this.display(),t.statusCode+": "+t.body)}const e=`Error connecting to ${(b=this.display())!=null?b:this.name} (${t.statusCode})`;d={body:t.body.slice(0,1e4),path:o,method:u,data:d,url:l,uri:c,headers:_};throw new h.UnexpectedError(e,d)}}else{f=true;m={status_code:t.statusCode,status_message:t.statusMessage,body:JSON.stringify(t.body)}}}if(!t.body){return null}if(!["json","querystring","raw"].includes(n.toLowerCase())){throw new h.UnexpectedError("unrecognized data_type:"+n)}if(t.body instanceof Error){throw new h.UnexpectedError("Error executing call",{inner_message:t.body.message,inner_stack:t.body.stack})}try{p.optional_pause("about to parse api response");let e;if(!f){switch(n.toLowerCase()){case"json":{var y,w,x;const n=(y=(w=t.body)==null?void 0:(x=w.trim)==null?void 0:x.call(w))!=null?y:t.body;e=g.incremental_json_parse(n);break}case"querystring":e=a.parse(t.body);break;case"raw":e=t.body;break}}else{e={body:t.body,statusCode:t.statusCode,statusMessage:t.statusMessage,error:m}}if(i&&typeof e==="object"){e.returned_an_error=Object.keys(m).length>0}p.optional_pause("finished parsing api response");return e}catch(e){var j,A,M;const n="Error parsing response data";const r=(j=(A=JSON.stringify(t.body)).slice)==null?void 0:j.call(A,0,1e4);const s=`Error parsing data from ${(M=this.display())!=null?M:this.name}: ${r}`;if(!i){throw new h.OwnerError(n,{display:s})}const o=500;m={status_code:o,status_message:n,body:s};return{body:r,statusCode:o,statusMessage:n,error:m,returned_an_error:true}}}},s(i.prototype,"get_call",[r],Object.getOwnPropertyDescriptor(i.prototype,"get_call"),i.prototype),i);t.exports=I;const R=e("../services/shared/service_type_parser");const L=e("../services/client/editor_utils");const z=e("../core/core_elements/core_elements_utilities/element_transformer");const B=e("../core/core_events")},{"../constants/lang":73,"../constants/locations":74,"../constants/plugin":78,"../core/core_elements/core_elements_utilities/element_transformer":285,"../core/core_events":377,"../lang/appquery":651,"../lang/btype_ids":652,"../lang/btypes":653,"../lang/caching":656,"../lang/elements/style_properties":684,"../lib":741,"../logger":744,"../retryable":776,"../services/client/editor_utils":778,"../services/shared/service_type_parser":785,"../shared/environment_utilities":793,"../u":823,"../u/server/server_errors":824,"../u/shared/async/b_fiber":833,"../u/shared/b_object":839,"../u/shared/decaf":844,"../u/shared/errors":846,"../u/shared/incremental":848,"./ExternalCall":600,"./not_critical_retry_failure":620,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/isEqual":1321,querystring:2279}],602:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../u/shared/b_array");const i=e("../u/shared/async/b_fiber");const s=e("../u/shared/b_object");const o=e("../u/shared/b_string");const a=e("../u/shared/incremental");const l=e("../lang/btypes");const c=e("../services/shared/plugin_getter");const u=e("../db/postgres_constraints");const d=e("../core/core_btypes/utilities/list_utilities");const p=e("../lib");const{EMPTY_RAW_STRUCT_ID_ENDING:_}=e("../constants/external_values");const f=e("./make_call_fn");function h(e){var t;const[n,r]=e.call.split(".");const i=c.get_plugin(n).get_call(r);const s=(t=e.caption)!=null?t:o.toTitleCase(r);const a={ret_btype:i.get_value_id(),fn:f(i)};if(typeof s==="function"){a.description=s}else{a.description="'s "+s}if(i.field_names){var l;a.field_names=i.field_names;a.fields=i.fields;a.description_for_sliding_palette=(l=i.description_for_sliding_palette)!=null?l:i.human;a.spot_data="SlidableAtom"}a.section="Data Fields";return a}class m{_fields(){if(typeof this.fields==="function"){var e;return(e=this.fields())!=null?e:{}}else{var t;return(t=this.fields)!=null?t:{}}}is_missing(){return false}flatten_raw(e){if(!e){return{}}const t={};for(const[i,o]of Object.entries(this._fields())){a.optional_pause_tick(20);let c;if(o.extract){c=o.extract(e)}else if(o.no_key){c=e}else{var n;const t=(n=o.path)!=null?n:[i];c=s.extract_from_object(e,t)}if(o.post_call_processing){c=o.post_call_processing(c,e)}if(o.cast_on_fetch&&c!=null){var r;c=l.get((r=o.ret_value)!=null?r:"text").cast(c)}if(c!=null){t[i]=c}}i.optional_pause("finished flatten raw");return t}get_bubble_null(){return null}export_to_string(){return"(Data from an API)"}debugging_display(){return"(Data from an API)"}get_message_names(e){var t;(t=e)!=null?t:e={};const n=Object.keys(this._fields());if(!e.exclude_special_messages){n.push(...Object.keys(this.get_special_messages()))}return r.unique(n)}get_message_names_reorg(e){return this.get_message_names()}get_message(e){let t=this._fields()[e];let n={};if(!t){n=this.get_special_messages();t=n[e];if(t==null){return}}if(t.call){return h(t)}else if(n[e]){return t}else{return this.get_basic_message(e,t)}}get_basic_message(e,t){var n,r,i;const s=(n=t.caption)!=null?n:o.toTitleCase(e);return{description:"'s "+s,ret_btype:(r=(i=t.ret_btype)!=null?i:t.ret_value)!=null?r:"text",fields:t.fields,field_names:t.field_names,spot_data:t.spot_data,section:"Data Fields",description_for_sliding_palette:t.description_for_sliding_palette}}get_special_messages(){if(this.no_special_messages){return{}}return{bubble_is_empty:{description:" is empty",section:"Operators",ret_btype:"sys.bool",fn(e,t){var n;const r=p().bubble_version()>=24&&(e==null?void 0:(n=e.data)==null?void 0:n._id.endsWith(_));return e===undefined||e===null||e===""||r},build_pg_constraint:u.is_empty},bubble_is_not_empty:{description:" is not empty",section:"Operators",ret_btype:"sys.bool",fn(e,t){var n;const r=p().bubble_version()>=24&&(e==null?void 0:(n=e.data)==null?void 0:n._id.endsWith(_));return e!==undefined&&e!==null&&e!==""&&!r},build_pg_constraint:u.is_not_empty},is_not_contained_by_list:d.build_is_not_contained_by_list(this.full_name)}}}t.exports=m},{"../constants/external_values":66,"../core/core_btypes/utilities/list_utilities":202,"../db/postgres_constraints":459,"../lang/btypes":653,"../lib":741,"../services/shared/plugin_getter":783,"../u/shared/async/b_fiber":833,"../u/shared/b_array":835,"../u/shared/b_object":839,"../u/shared/b_string":841,"../u/shared/incremental":848,"./make_call_fn":619,"core-js/modules/web.dom-collections.iterator.js":1123}],603:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../u/shared/hash");const i=e("../db/sample");const s=e("../lang/btypes");const o=e("../db/values/StaticObject");const a=e("../db/values/StaticList");const l=e("../db/values/Dynamic");const c=e("./ExternalValue");const u=e("../lib");const{EMPTY_RAW_STRUCT_ID_ENDING:d}=e("../constants/external_values");class p extends c{constructor(e,t,n){var r;super();(r=n)!=null?r:n={};this.human=e;this.fields=t;if(!this.fields){this.fields={};this.no_extract=true}Object.assign(this,{storable:true,bindable:true,is_lookup:true},n)}display(){return this.human}editable(){return false}short_id(){return this.name}debugging_display(e){return`(Data with ID "${e==null?void 0:e._id()}" from an API)`}equals(e,t){return(e==null?void 0:e._id())===(t==null?void 0:t._id())}get_sample(){return new i.SampleObject(this.full_name)}cast(e){if(e instanceof l){return e}else if(typeof e==="object"&&e!=null){return new o(e,null,this.full_name)}else{return null}}get_basic_message(){return Object.assign(super.get_basic_message(...arguments),{is_lookup:true})}extract(e){if(this.no_extract){return e}const t=typeof e;if(t==="string"){return e}const n=this.flatten_raw(e);if(!n._id){n._id=r.incremental_digest(n);if(u().bubble_version()>=24&&!e){n._id+=d}}return n}convert_to_bubble_instance(e){if(Array.isArray(e)){const t=s.get(this.full_name);if(t.plugin.convert_to_bubble_instance){const n=e.map((e=>t.plugin.convert_to_bubble_instance(e)));return new a(n,undefined,this.full_name)}else{return new a(e,undefined,this.full_name)}}else if(e!=null&&typeof e==="object"){const i={};for(const[o,a]of Object.entries(this._fields())){const l=s.get(a.ret_value);if(l.is_list()){const t=l.inner();if(t.plugin instanceof p){i[o]=t.plugin.convert_to_bubble_instance(e[o])}else{i[o]=l.cast(e[o])}}else{var t,n,r;i[o]=(t=(n=(r=l.plugin).convert_to_bubble_instance)==null?void 0:n.call(r,e[o]))!=null?t:e[o]}}i._id=e._id;return new o(i,undefined,this.full_name)}else{return this.cast(e)}}get_JS_object(e){if(e==null){return null}if(e.raw!=null){e=e.raw()}const t={};for(const n of this.get_message_names({exclude_special_messages:true})){const r=this.get_message(n);t[n]=s.get(r.ret_btype).get_JS_object(e[n])}return t}JS_to_bubble(e){const t={};for(const n of this.get_message_names({exclude_special_messages:true})){const r=this.get_message(n);t[n]=s.get(r.ret_btype).JS_to_bubble(e[n])}return new o(t,undefined,this.full_name)}}t.exports=p},{"../constants/external_values":66,"../db/sample":461,"../db/values/Dynamic":465,"../db/values/StaticList":471,"../db/values/StaticObject":473,"../lang/btypes":653,"../lib":741,"../u/shared/hash":847,"./ExternalValue":602,"core-js/modules/web.dom-collections.iterator.js":1123}],604:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u/shared/decaf");const i=e("../../u/shared/errors");const s={access_type:true,scope:true,user_scope:true,data_type:true,prompt:true,additional_query_url_to_delete:true,add_to_url:true,add_to_header:true,header_key:true,expires_in:true,add_basic_authentication:true,key_prefix:true,grant_type:true,use_cliend_id_secret:true,use_username_password:true,server_redirect:true};class o{constructor(e){this.params=e}id(){return this.service_name()}get_property(e,t){var n,r;let o=(n=(r=this.params)==null?void 0:r[e])!=null?n:this.service()[e];if(!o&&!s[e]){if(t){return null}throw new i.UnexpectedError("could not find property "+e+" for authenticator of service "+this.id()+", and property "+e+" is not set as optional")}if(typeof o==="function"){o=o(this)}return o}display(){var e;return(e=this._display)!=null?e:l.get_plugin(this.service_name()).display()}service(){if(!this._service){throw new i.UnexpectedError("this authenticator doesnt have @_service set.  should set it in add_service in services.coffee")}return this._service}is_user_credentials(){return false}service_name(){return this.service().name}edit_mode_login(){return false}get_key(e,t,n){return this.service().get_key(e,t,n)}get_public_key(){return this.service().get_public_key()}get_secret_key(){return this.service().get_secret_key()}get_user_authentication_node(e){return e.child("authentication").child(this.id())}get_service_id(e){return this.get_user_authentication_node(e).child("id").get()}are_keys_missing(){for(const[e,t]of r.object_entries(this.service().get_keys())){if(t.editor!=="Checkbox"){let n;if(t.type==="secure"){n=a.get_private_setting(this.service().name+"_"+e)}else{n=a.get_public_setting(this.service().name+"_"+e)}if(!n&&!t.optional){return true}}}return false}}t.exports=o;const a=e("../../lang/appquery");const l=e("../../lang/plugins")},{"../../lang/appquery":651,"../../lang/plugins":726,"../../u/shared/decaf":844,"../../u/shared/errors":846,"core-js/modules/web.dom-collections.iterator.js":1123}],605:[function(e,t,n){"use strict";const r=e("./Authenticator");const i=e("./authenticator_utils");class s extends r{must_proxy(){return true}add_authentication(e,t){i.add_basic_authentication(e,t,this);return e}is_authenticated(){return true}}t.exports=s},{"./Authenticator":604,"./authenticator_utils":616}],606:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u/shared/mode_check");const i=e("../../constants/known_plugins");const s=e("../../u/shared/errors");const o=e("../../u/shared/uuid");const a=e("./Authenticator");const l=e("./authenticator_utils");const c={};class u extends a{must_proxy(){return true}build_token(e){const t=l.kv_hash(e);const n=!e.user_id;if(!c[t]||r.running_test()){const r={typ:"JWT",alg:"RS256",kid:e.public_key_id};const i={iss:e.apikey,sub:n?e.enterprise_id:e.user_id,box_sub_type:n?"enterprise":"user",aud:this.get_property("claims_aud"),jti:o.UUID(),exp:Math.floor(Date.now()/1e3+55)};const s=token_utilities.generate_jws(r,i);const a={client_id:e.appid,client_secret:e.appsecret,grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:s};const l={method:"POST",url:this.get_property("generate_token_from_code_uri"),form:a};const u=this.service().error_wrapper((()=>d().http_request(l).block()));const p=this.service().response_to_data(l,u);c[t]=p.access_token;setTimeout((()=>c[t]=null),p.expires_in*1e3)}return c[t]}get_token(){const e={};for(const t in this.service().keys){e[t]=this.get_key(t);if(!e[t]&&t!=="user_id"){throw new s.OwnerError("App missing credential",{display:"Sorry, it looks like this is app is missing a "+this.service().display()+" credential: "+this.service().keys[t].caption})}}if(!e.user_id){const t=this.build_token(e);const n=p.get_hardcoded_plugin(i.BOX).get_call("create_user").execute(null,null,t).id;d().app().get_private_setting_node(this.service().name+"_user_id").json.set(n,{name:"CreateBoxAuthToken"});e.user_id=n}return this.build_token(e)}add_authentication(e,t){var n;const r=t!=null?t:this.get_token();(n=e.headers)!=null?n:e.headers={};e.headers.Authorization="Bearer "+r;return e}}t.exports=u;const d=e("../../lib");const p=e("../../services/shared/plugin_registry")},{"../../constants/known_plugins":72,"../../lib":741,"../../services/shared/plugin_registry":784,"../../u/shared/errors":846,"../../u/shared/mode_check":851,"../../u/shared/uuid":855,"./Authenticator":604,"./authenticator_utils":616,"core-js/modules/web.dom-collections.iterator.js":1123}],607:[function(e,t,n){"use strict";const r=e("../../u/shared/mode_check");const i=e("../../u/shared/errors");const s=e("./authenticator_utils");const o=e("./Oauth2PWFlow");class a extends o{anti_babel_function(){}}t.exports=a},{"../../u/shared/errors":846,"../../u/shared/mode_check":851,"./Oauth2PWFlow":612,"./authenticator_utils":616}],608:[function(e,t,n){"use strict";const r=e("./Authenticator");class i extends r{must_proxy(){return false}add_authentication(e){return e}is_authenticated(){return true}is_user_credentials(){return true}}t.exports=i},{"./Authenticator":604}],609:[function(e,t,n){"use strict";const r=e("../../u/shared/mode_check");const i=e("../../logger");const s=e("../../u/shared/b_object");const o=e("../../u/shared/async/autorun");const a=e("../../constants/redis");const l=e("./OauthBase");class c extends l{oauth_version(){return"1"}must_proxy(){return true}get_oauth_user_data(e){const t=this.get_token_data(e);const n=this.get_oauth_user_data_call().execute(null,t,t);n.id=String(t.user_id);return{...n!=null?n:{},...t!=null?t:{}}}is_user_credentials(){return true}login(e,t,n){const r=this.get_property("authorize_url");const i={};i[this.get_property("token_param_name")]=n;u().workflow.make_resume_key(e,t);return u().workflow.wait_for_safe(e,(()=>{document.location.href=r+"?"+_.stringify(i)}))}add_authentication(e,t){if(e.headers){return e}let n=t==null?void 0:t.oauth_token_secret;const r=t==null?void 0:t.oauth_token;if(n!=null&&r!=null){this.add_auth_header(e,r,n);return e}n=o.run_once(30,(()=>({oauth_token_secret:this._get_oauth_token_secret(),oauth_token:this._get_oauth_token()})));return n.then((t=>{let{oauth_token_secret:n,oauth_token:r}=t;if(!n||!r){return e}this.add_auth_header(e,r,n);return e}))}get_data_for_login(e){let{oauth_token:t,oauth_verifier:n}=e;if(typeof t!=="string"||typeof n!=="string"){i.warn("odd OAuth1 params after redirection, clearing",{oauth_token:t,oauth_verifier:n});return{oauth_provider:this.id(),oauth_token:"",oauth_verifier:""}}return{oauth_provider:this.id(),oauth_token:t!=null?t:"",oauth_verifier:n!=null?n:""}}get_token_data(e){const t=this.get_property("access_token_url");const n=this.get_property("data_type");const r={url:t,method:"POST",data:e};this.add_auth_header(r,e.oauth_token,u().KeyValueDB().get(a.INSTANCE_NAMES.SMALL,e.oauth_token));const i=this.service().error_wrapper((()=>u().http_request(r).block()));const s=this.service().response_to_data(r,i,n);return s}_get_oauth_token_secret(){return this.get_user_authentication_node(u().current_user()).child("oauth_token_secret").get()}_get_oauth_token(){return this.get_user_authentication_node(u().current_user()).child("oauth_token").get()}is_authenticated(){return this._get_oauth_token()!=null&&this._get_oauth_token_secret()!=null&&this._get_user_id()!=null}generate_validity_object(e){return{oauth_token:e.oauth_token,oauth_token_secret:e.oauth_token_secret,provider_user_id:e.user_id}}build_validity_request(e){return this.get_oauth_user_data_call().build_request(null,{user_id:e.provider_user_id},e)}}t.exports=c;const u=e("../../lib");const d=e("url");const p=e("../../lang/appquery");const _=e("querystring")},{"../../constants/redis":81,"../../lang/appquery":651,"../../lib":741,"../../logger":744,"../../u/shared/async/autorun":830,"../../u/shared/b_object":839,"../../u/shared/mode_check":851,"./OauthBase":613,querystring:2279,url:981}],610:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u/shared/b_object");const i=e("../../u/shared/b_string");const s=e("../../u/shared/errors");const o=e("../../u/shared/uuid");const a=e("../../u/shared/async/autorun");const l=e("./OauthBase");const c=e("./authenticator_utils");const u=e("../../lang/evaluation/node_eval");const d=e("../../apiconnectorbase/parsing_utils");class p extends l{oauth_version(){return"2"}get_additional_fields(){var e;const t=(e=this.get_property("auth_url_params",true))!=null?e:{};return Object.entries(t).map((e=>{let[t,n]=e;return{name:t,caption:`${n.key} (Login Redirect)`,editor:"ShortText",default:!n.allow_blank?n.value:null,optional:n.optional||n.allow_blank}}))}must_proxy(){return false}_get_access_token(){return this.get_user_authentication_node(_().current_user()).child("access_token").get()}is_authenticated(){return this._get_access_token()!=null&&this._get_user_id()!=null}is_user_credentials(){return true}add_authentication(e,t){var n,r;const i=this.get_property("token_param_name");let s=(n=t==null?void 0:t.access_token)!=null?n:(r=e.data)==null?void 0:r[i];const o=t=>{if(this.get_property("add_to_url")){if(e.url.includes("?")){e.url+="&"}else if(!e.url.endsWith("?")){e.url+="?"}e.url+=i+"="+t}else if(this.get_property("add_to_header")){var n;(n=e.headers)!=null?n:e.headers={};const r=this.get_property("header_key");if(r){const[n,i]=r.split(":");if(i!=null){e.headers[n.trim()]=i.trim()+" "+t}else{e.headers[n.trim()]=t}}else{e.headers.Authorization="Bearer "+t}}else{var r;(r=e.data)!=null?r:e.data={};e.data[i]=t}return e};if(s!=null){return o(s)}s=a.run_once(30,(()=>this._get_access_token()));return s.then((e=>o(e)))}add_generic_authenticator_keys(e){e.server_redirect={type:"client_safe",editor:"Checkbox"};if(_().is_edit_mode()){e.server_redirect.caption="Use a generic redirect URL ("+c.get_redirect_url()+")"}}use_server_side_redirect(){return this.get_key("server_redirect")}login(e,t,n){var s;let a=document.location.href;if(a[a.length-1]==="?"){a=a.slice(0,a.length-1)}let l,p;if(n){p=f.parse(a);delete p.search;delete p.hash;delete p.query;a=f.format(p)}const m=f.parse(document.location.href,true).query;m.oauth_provider=this.id();if(e&&t){m.resume_key=_().workflow.make_resume_key(e,t)}m.used_redirect_url=a;if(this.use_server_side_redirect()){a=c.get_redirect_url();if(_().location.get_page()==="index"){if(i.starts_with(_().location.get_server_base(),m.used_redirect_url)){p=f.parse(m.used_redirect_url);if(p.path==="/"&&m.used_redirect_url.slice(-1)!=="/"){m.used_redirect_url=m.used_redirect_url+"/"}}}m.redirect_unique_id=o.UUID()}const g=i.fixedEncodeURIComponent(r.json_stringify(m));const v={client_id:this.get_public_key(),redirect_uri:a,response_type:"code",state:g};const b=this.get_property("expires_in");if(b){v.expires_in=b}const y=this.get_property("access_type");if(y){v.access_type=y}const w=this.get_property("prompt");if(w){v.prompt=w}const x=this.get_property("scope");if(x){v.scope=x}const j=d.apply_template_params(this.get_property("authentication_url"),"bracket",(s=this.get_property("auth_url_params",true))!=null?s:{},((n,r)=>{const i=t?u.eval_property(t,n,e,null,r.value):r.value;return i}));if(!j.includes("?")){l=j+"?"+h.stringify(v)}else{l=j+"&"+h.stringify(v)}return _().workflow.wait_for_safe(e,(()=>document.location.href=l))}get_data_for_login(e){var t;let n;if(this.use_server_side_redirect()){n=c.get_redirect_url()}else{var r;n=(r=e.used_redirect_url)!=null?r:""}return{oauth_provider:this.id(),code:(t=e.code)!=null?t:"",redirect_uri:n}}}t.exports=p;const _=e("../../lib");const f=e("url");const h=e("querystring")},{"../../apiconnectorbase/parsing_utils":8,"../../lang/evaluation/node_eval":697,"../../lib":741,"../../u/shared/async/autorun":830,"../../u/shared/b_object":839,"../../u/shared/b_string":841,"../../u/shared/errors":846,"../../u/shared/uuid":855,"./OauthBase":613,"./authenticator_utils":616,"core-js/modules/web.dom-collections.iterator.js":1123,querystring:2279,url:981}],611:[function(e,t,n){"use strict";const r=e("../../u/shared/b_object");const i=e("./Oauth2PWFlow");class s extends i{_get_token_request(){return this.service().get_call("token_call").build()}}t.exports=s},{"../../u/shared/b_object":839,"./Oauth2PWFlow":612}],612:[function(e,t,n){"use strict";const r=e("../../u/shared/errors");const i=e("../../constants/redis");const s=e("./Authenticator");const o=e("./authenticator_utils");class a extends s{must_proxy(){return true}add_authentication(e,t){var n;const r=t!=null?t:this.get_token();(n=e.headers)!=null?n:e.headers={};e.headers.Authorization="Bearer "+r;return e}is_authenticated(){return true}}t.exports=a;const l=e("../../lib")},{"../../constants/redis":81,"../../lib":741,"../../u/shared/errors":846,"./Authenticator":604,"./authenticator_utils":616}],613:[function(e,t,n){"use strict";const r=e("../../logger");const i=e("./Authenticator");class s extends i{get_oauth_user_data_call(){return this.service().get_call("oauth_user_data_call")}get_oauth_user_data(e){const t=this.get_token_data(e);const n=this.get_oauth_user_data_call(e).execute(null,null,t);if(n.id!=null){n.id=String(n.id)}return{...n!=null?n:{},...t!=null?t:{}}}build_validity_request(e){return this.get_oauth_user_data_call().build_request(null,null,e)}is_still_valid(e){const t=this.build_validity_request(e);let n,i;try{i=o().http_request(t).block();n=null}catch(e){n=e;i=null}if(i&&i.statusCode>=200&&i.statusCode<300){return true}if(a.is_retryable(n,i)){let e;if(n){e=n}else{e=i.statusCode+": "+i.body}r.warn("Temporarily unable to validate Oauth connection",{service:this.service().display(),reason:e});return true}return false}_get_user_id(){return this.get_service_id(o().current_user())}tested(){return true}}t.exports=s;const o=e("../../lib");const a=e("../../retryable")},{"../../lib":741,"../../logger":744,"../../retryable":776,"./Authenticator":604}],614:[function(e,t,n){"use strict";const r=e("../../u/shared/errors");const i=e("./Authenticator");class s extends i{must_proxy(){return true}add_authentication(e,t){var n;(n=t)!=null?n:t=this.get_secret_key();if(this.params.key_prefix){t=this.params.key_prefix+t}if(!this.params.token_param_name){throw new r.UnexpectedError("PrivateKey authenticator missing token_param_name")}if(this.params.add_to_url){if(!e.url.includes("?")){e.url+="?"}if(e.url[e.url.length-1]!=="?"){e.url+="&"}e.url+=this.params.token_param_name+"="+t}else if(this.params.add_to_header){var i;(i=e.headers)!=null?i:e.headers={};e.headers[this.params.token_param_name]=t}else{var s;(s=e.data)!=null?s:e.data={};e.data[this.params.token_param_name]=t}return e}is_authenticated(){return true}}t.exports=s},{"../../u/shared/errors":846,"./Authenticator":604}],615:[function(e,t,n){"use strict";const r=e("./BasicAuth");class i extends r{add_authentication(e,t){Object.assign(e,{cert:this.get_key("cert_file"),key:this.get_key("key_file")});return e}}t.exports=i},{"./BasicAuth":605}],616:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../u");const s=e("../../u/shared/mode_check");const o=e("../../lib");const a=e("../../u/shared/decaf");r.MISSING_ACCESS_TOKEN="missing access_token getting data";r.PLUGIN_OAUTH_REDIRECT="sys/pluginoauth";r.SERVER_OAUTH_REDIRECT="oauth_redirect";r.get_redirect_url=l;r.add_basic_authentication=c;r.kv_hash=u;function l(){let e;if(p.is_local_editable(d.appname())){e="live"}else{e=d.app_version()}let t;if(_.env!=="local"||d.appname()==="meta"){t=d.domain()}return o().location.format_pieces({domain:t,appname:d.appname(),path:["api","1.1",r.SERVER_OAUTH_REDIRECT],app_version:e},{protocol:"https:"})}function c(e,t,n){var r;let s,o;if(!t){o=n.get_public_key();s=n.get_secret_key()}else{o=t.user;s=t.pw}const a=i.base64(o+":"+s);(r=e.headers)!=null?r:e.headers={};e.headers.Authorization="Basic "+a}function u(e){return a.object_entries(e).map((e=>{let[t,n]=e;return`${t}:${n}`})).join(",")}const d=e("../../lang/appquery");const p=e("../../shared/apps_utilities");let _=e("../../client_config")},{"../../client_config":41,"../../lang/appquery":651,"../../lib":741,"../../shared/apps_utilities":788,"../../u":823,"../../u/shared/decaf":844,"../../u/shared/mode_check":851,"core-js/modules/web.dom-collections.iterator.js":1123}],617:[function(e,t,n){"use strict";const r=n;const i=e("./authenticator_utils");const s=e("./Authenticator");const o=e("./BasicAuth");const a=e("./BoxAuthentication");const l=e("./JWT");const c=e("./NoAuth");const u=e("./Oauth1");const d=e("./Oauth2");const p=e("./Oauth2Custom");const _=e("./Oauth2PWFlow");const f=e("./PrivateKey");const h=e("./SSLProtocol");r.MISSING_ACCESS_TOKEN=i.MISSING_ACCESS_TOKEN;r.PLUGIN_OAUTH_REDIRECT=i.PLUGIN_OAUTH_REDIRECT;r.SERVER_OAUTH_REDIRECT=i.SERVER_OAUTH_REDIRECT;r.get_redirect_url=i.get_redirect_url;r.Authenticator=s;r.BasicAuth=o;r.BoxAuthentication=a;r.JWT=l;r.NoAuth=c;r.Oauth1=u;r.Oauth2=d;r.Oauth2Custom=p;r.Oauth2PWFlow=_;r.PrivateKey=f;r.SSLProtocol=h},{"./Authenticator":604,"./BasicAuth":605,"./BoxAuthentication":606,"./JWT":607,"./NoAuth":608,"./Oauth1":609,"./Oauth2":610,"./Oauth2Custom":611,"./Oauth2PWFlow":612,"./PrivateKey":614,"./SSLProtocol":615,"./authenticator_utils":616}],618:[function(e,t,n){"use strict";const r=n;const i=e("./ExternalValue");const s=e("./StructValue");const o=e("./APIValue");const a=e("./ExternalCall");const l=e("./ExternalService");const c=e("./make_call_fn");const u=e("./authenticators");const d=e("../safe_require");d.safe_register("./external",r);class p{display(){return"Pass Through"}extract(e){return e}}r.Authenticator=u.Authenticator;r.BasicAuth=u.BasicAuth;r.BoxAuthentication=u.BoxAuthentication;r.JWT=u.JWT;r.NoAuth=u.NoAuth;r.Oauth1=u.Oauth1;r.Oauth2=u.Oauth2;r.Oauth2Custom=u.Oauth2Custom;r.Oauth2PWFlow=u.Oauth2PWFlow;r.PrivateKey=u.PrivateKey;r.SSLProtocol=u.SSLProtocol;r.MISSING_ACCESS_TOKEN=u.MISSING_ACCESS_TOKEN;r.PLUGIN_OAUTH_REDIRECT=u.PLUGIN_OAUTH_REDIRECT;r.SERVER_OAUTH_REDIRECT=u.SERVER_OAUTH_REDIRECT;r.get_redirect_url=u.get_redirect_url;r.APIValue=o;r.Call=a;r.ExternalValue=i;r.PassThroughValue=p;r.Service=l;r.StructValue=s;r.make_call_fn=c},{"../safe_require":777,"./APIValue":599,"./ExternalCall":600,"./ExternalService":601,"./ExternalValue":602,"./StructValue":603,"./authenticators":617,"./make_call_fn":619}],619:[function(e,t,n){"use strict";const r=e("../u/shared/errors");t.exports=function e(t){return function(e,n,s,o,a){if(n){throw new r.UnexpectedError("external.js make_call_fn - This line should be unreachable")}if(!e){return this.ret_btype_null()}if(t.is_authenticated()){const n=t.execute(e,s,null,o,a);return i.convert_api_call_to_db_object(n,t)}}};const i=e("../core/core_datasources/utilities/core_ds_db_ops_utilities")},{"../core/core_datasources/utilities/core_ds_db_ops_utilities":232,"../u/shared/errors":846}],620:[function(e,t,n){"use strict";const r=e("../u/shared/errors");t.exports=function e(t,n){return new r.OwnerError("service unavailable",{display:"Sorry, "+t+" is temporarily unavailable",reason:n})}},{"../u/shared/errors":846}],621:[function(e,t,n){"use strict";const r=e("../lib");const i=e("ngeohash");const s=e("./core");const o=e("./shared/b_location_utils");const a=e("../constants/geolocation");const l=n;const c=e("../safe_require");c.safe_register("./geolocation/b_location",l);for(const e in o){l[e]=o[e]}l.ensure_valid_location=function(e,t){if(o.is_hashed(e)){return l.convert_to_new_format(e,t)}if(o.is_b_location(e)){return e}return null};l.convert_to_old_format=function(e){var t;const n=(e,t)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t);let r;if(e.components){r="/"+JSON.stringify(e.components)}else{if(e.address!=null){r="/"+JSON.stringify(l.get_components(e))}else{r=""}}return i.encode(n(e.lat,5),n(e.lng,5),a.GEOHASH_PRECISION)+"/"+((t=e.address)!=null?t:"")+r};l.convert_to_new_format=function(e,t){const n=e.split("/")[0];const{latitude:r,longitude:s}=i.decode(n);const o=e.split("/")[1];let a;if(!t){a=l.get_components({lat:r,lng:s,address:o})}return{lat:r,lng:s,address:o,components:a}};l.is_equal=function(e,t){if(l.ensure_valid_location(e)){e=l.ensure_valid_location(e).address}if(l.ensure_valid_location(t)){t=l.ensure_valid_location(t).address}return e===t};function u(e,t,n){if(!e){return t(null)}if(o.is_hashed(e)){e=l.convert_to_new_format(e)}if(t(e)){return t(e)}if(typeof e==="string"){return t(d("geocode",{address:e},{throw_not_ready:n}))}return t(d("geocode_latlong",e,{throw_not_ready:n}))}l.get_address=e=>u(e,(e=>{var t;return(t=e==null?void 0:e.address)!=null?t:""}));l.get_components=(e,t)=>u(e,(e=>e==null?void 0:e.components),t);l.from_address=function(e,t){var n;(n=t)!=null?n:t=false;if(l.ensure_valid_location(e)){return l.ensure_valid_location(e)}if(!e||typeof e!=="string"){return e}return d("geocode",{address:e},{alert_on_failure:t})};l.from_place_id=function(e,t){var n;(n=t)!=null?n:t=false;if(!e||typeof e!=="string"){return e}return d("geocode",{place_id:e},{alert_on_failure:t})};function d(e,t,n){var i;(i=n)!=null?i:n={};if(t.place_id==null&&t.address==null&&t.lat==null&&t.lng==null){return null}const a={request_type:e,language:r().app_language(),...t};o.round_lat_lng(a);function l(e,t){const{formatted_address:n}=e;const r=o.to_json_components(e);function i(e){if(typeof e==="function"){return e()}else{return e}}return{lat:i(e.geometry.location.lat),lng:i(e.geometry.location.lng),address:n,placeId:e.place_id,components:r}}return s.request_geocode(a,l,n)}},{"../constants/geolocation":69,"../lib":741,"../safe_require":777,"./core":624,"./shared/b_location_utils":626,ngeohash:2266}],622:[function(e,t,n){"use strict";const r=e("../../u/shared/async/b_async");const i=e("../../u/shared/b_object");const s=e("./google_maps");const o=e("../shared/b_location_utils");const a=e("../../logger");const l=e("../core");const c=e("../../u/shared/b_date").require_moment();const u=n;const d={};const p={};function _(e){e={...e};e.timestamp=c(e.timestamp*1e3).utc().startOf("day").valueOf();return JSON.stringify(e)}function f(e){const t=_(e);if(!d[t]){d[t]=r.MakeKey(null,"address_timezone_key");s.proxy_geolocation_request(e,t,((e,t)=>{if((e==null?void 0:e.status)==="OK"){p[t]=e}else{a.error("Timezone fetching issue",{res:e})}d[t].turn()}))}r.ensure_ready(d[t]);return p[t]}const h={};function m(e,t){let n;const{input:a,types:l,location:c,radius:u}=e;if(o.is_b_location(c)&&u){n=c.lat+","+c.lng}else{n=null}const d=a+u+n;if(h[d]){t(h[d]);return}if(s.using_bubble_key()){s.proxy_geolocation_request({input:a,types:l,radius:u,location:n,request_type:"autocomplete"},d,((e,n)=>{if(!e||e.status!=="OK"){t([])}else{h[n]=e.predictions;t(e.predictions)}}))}else{var p,_,f;if(typeof google==="undefined"||((p=google)==null?void 0:(_=p.maps)==null?void 0:(f=_.places)==null?void 0:f.AutocompleteService)==null){s.load_google_map_api()}r.WaitFor(s.load_google_map_api(),(()=>{const e=new window.google.maps.places.AutocompleteService;const r={input:a,types:l};if(n){i.extend(r,{location:new google.maps.LatLng(c),radius:u})}e.getQueryPredictions(r,((e,n)=>{if(n===google.maps.places.PlacesServiceStatus.OK){h[d]=e;t(e)}else{t([])}}))}))}}const g={};function v(e,t,n,o){const l=i.json_stringify(e);const{alert_on_failure:c,throw_not_ready:u}=o;if(!g[l]){g[l]=r.MakeKey(null,"address_localization_keys");function _(e,t,r){n(null);g[t].turn();if(r){alert("There was an error converting the address "+t+" into a geographic location. Error message: "+e)}}function f(e,r){n(t(e));g[r].turn()}if(s.using_bubble_key()){s.proxy_geolocation_request(e,l,((e,t)=>{if(!e||e.status!=="OK"){_(e==null?void 0:e.status,t,c)}else{f(e.results[0],t)}}))}else{var d,p;if(typeof google==="undefined"||((d=google)==null?void 0:(p=d.maps)==null?void 0:p.Geocoder)==null){s.load_google_map_api()}r.WaitFor(s.load_google_map_api(),(()=>{const t=new window.google.maps.Geocoder;const n=5;const r=n;function i(r,s){let o;if(e.place_id!=null){o={placeId:e.place_id}}else if(e.address!=null){o={address:e.address}}else if(e.lat!=null&&e.lng!=null){o={latLng:new window.google.maps.LatLng(e.lat,e.lng)}}const u=5e3;let d=false;const p=setTimeout((()=>{a.owner_error("Probably invalid Geocoding API key",{display:"Geocoding Service: cannot connect to the service, please check the Geocode API key"});d=true;_(google.maps.GeocoderStatus.REQUEST_DENIED,l,c)}),u);t.geocode(o,((e,t)=>{clearTimeout(p);if(d){return}if(t===google.maps.GeocoderStatus.OK){f(e[0],r)}else if(t===google.maps.GeocoderStatus.OVER_QUERY_LIMIT&&s>0){const e=s-1;setTimeout((()=>{i(r,e)}),(n-e)*(n-e)*1e3)}else{if(t===google.maps.GeocoderStatus.REQUEST_DENIED){a.owner_error("Unauthorized Geocoding API key",{display:"Geocoding Service: This API project is not authorized to use this API.  For more information on authentication and Google Maps JavaScript API services check https://developers.google.com/maps/documentation/javascript/get-api-key"})}_(t,r,c)}}))}i(l,r)}))}}r.ensure_ready(g[l],!u)}u.init=()=>{l.init("client",{request_timezone:f,request_geocode:v,request_autocomplete:m,localization_hasher:i.json_stringify})}},{"../../logger":744,"../../u/shared/async/b_async":832,"../../u/shared/b_date":836,"../../u/shared/b_object":839,"../core":624,"../shared/b_location_utils":626,"./google_maps":623}],623:[function(e,t,n){"use strict";const r=e("../../lib");const i=e("../../languages");const s=e("querystring");const o=e("../../lang/appquery");const a=e("../../logger");const l=e("../../shared/apps_utilities");const c=e("../../u/shared/errors");const u=e("../../u/shared/async/b_async");const d=e("../../u/shared/async/autorun");const p=n;let _=null;let f=null;function h(){if(!f){f=window.gm_key;delete window.gm_key}return f}p.load_google_map_api=function(){if(!_){_=u.MakeKey(null,"google_map_api_loaded");window.initialize_google_map_api=()=>{_.turn()};const e=document.createElement("script");e.type="text/javascript";const t={v:3,callback:"initialize_google_map_api"};if(!p.using_bubble_key()){t.libraries="places"}d.run_once(30,(()=>({map_key:h(),app_language:r().app_language(true)})),((n,r)=>{let{map_key:o,app_language:a}=r;if(n){throw c.ensure_bubble_error(n)}if(a){a=i.get_iso_code(a).split("_")[0];t.language=a}if(o){t.key=o}e.src="https://maps.googleapis.com/maps/api/js?"+s.stringify(t);document.getElementsByTagName("head")[0].appendChild(e)}))}return _};p.using_bubble_key=function(){var e;const t=o.appname();if(l.is_hardcoded(t)||t==="meta"){return false}return[null,undefined,""].includes((e=o.get_public_setting("general_keys.google_map_key"))==null?void 0:e.trim())};p.proxy_geolocation_request=function(e,t,n){e.language=r().app_language();e.appname=o.appname();const i=!p.using_bubble_key()&&e.request_type==="timezone"?"server://api/1.1/geolocation/google_proxy":"server://api/1.1/places";r().location.post(i,e,((e,r)=>{if(e){a.log(e);n({status:e.message},t)}n(r,t)}))}},{"../../lang/appquery":651,"../../languages":739,"../../lib":741,"../../logger":744,"../../shared/apps_utilities":788,"../../u/shared/async/autorun":830,"../../u/shared/async/b_async":832,"../../u/shared/errors":846,querystring:2279}],624:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.init=p;n.request_autocomplete=c;n.request_from_cache=u;n.request_geocode=d;n.request_timezone=l;var r=e("../u/shared/errors");var i=o(e("./shared/shared_core"));function s(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(s=function(e){return e?n:t})(e)}function o(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=s(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;if(a&&(a.get||a.set)){Object.defineProperty(r,o,a)}else{r[o]=e[o]}}}r.default=e;if(n){n.set(e,r)}return r}let a;function l(e){if(a===undefined){throw new r.UnexpectedError("Request Timezone Called before init")}return a.request_timezone(e)}function c(e,t){if(a===undefined){throw new r.UnexpectedError("Request Autocomplete called before init!")}return a.request_autocomplete(e,t)}function u(e){if(a===undefined){throw new r.UnexpectedError("Request from cache called before init!")}return i.get_from_cache(e,a.localization_hasher)}function d(e,t,n){if(a===undefined){throw new r.UnexpectedError("Request Geocode Called Before Init!")}return i.request_geocode(e,t,n,a.localization_hasher,a.request_geocode)}function p(e,t){if(a!==undefined&&a.prev_category!==e){throw new r.UnexpectedError("Conflicting initializes called!",{category:e,prev_category:a.prev_category})}a={...t,prev_category:e}}},{"../u/shared/errors":846,"./shared/shared_core":627,"core-js/modules/web.dom-collections.iterator.js":1123}],625:[function(e,t,n){"use strict";const r=e("../lib");const i=e("../logger");const s=e("../u/shared/async/b_async");const o=e("../u/shared/async/autorun");const a=n;const l=e("./shared/b_location_utils");const c=e("./core");const u=e("../u/shared/b_object");let d=null;const p=o.Box(null);a.get_current_geographic_position=function(){if(navigator.geolocation){var e;if(!d){d=s.MakeKey(Infinity,"waiting_for_current_location_watcher");function o(e){const t=p();const n={lat:t==null?void 0:t.lat,lng:t==null?void 0:t.lng};if(!p()||l.geographic_distance(n,{lat:e.coords.latitude,lng:e.coords.longitude})>.01){return p({lat:e.coords.latitude,lng:e.coords.longitude})}}const a=()=>{navigator.geolocation.watchPosition(o,(e=>console.log(e)),{enableHighAccuracy:true})};navigator.geolocation.getCurrentPosition((e=>{o(e);d.turn();a()}),(e=>{i.owner_error(e.message);if(e.message.includes("User denied Geolocation")){d.turn();return}d.turn();a()}),{enableHighAccuracy:false,maximumAge:30*60*1e3})}s.ensure_ready(d);const t=p();l.round_lat_lng(t);const n={request_type:"geocode_latlong",language:r().app_language(),...t};return(e=c.request_from_cache(n))!=null?e:t}else{return null}};a.get_timezone_for_location=function(e){if(!e||!l.is_b_location(e)){return""}const t=e.lat;const n=e.lng;const r=parseInt(Date.now()/1e3);const i={latitude:t,longitude:n,timestamp:r,request_type:"timezone"};return c.request_timezone(i)};a.get_address_place_autocomplete=(e,t)=>c.request_autocomplete(u.extend({request_type:"autocomplete"},e),t)},{"../lib":741,"../logger":744,"../u/shared/async/autorun":830,"../u/shared/async/b_async":832,"../u/shared/b_object":839,"./core":624,"./shared/b_location_utils":626}],626:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../db/hydrate");const i=e("../../lib");const s=e("../../constants/eval");const o=e("../../constants/geolocation");const a=e("../../lang/appquery");const l=n;l.is_hashed=function(e){if(typeof e!=="string"){return false}if(e.length<=o.GEOHASH_PRECISION){return false}const t=e.indexOf("/");if(t===-1||t!==o.GEOHASH_PRECISION){return false}const n=e.substring(0,o.GEOHASH_PRECISION);if(/[^0-9b-hjkmnp-z]/.test(n)){return false}return true};l.is_b_location=e=>e!=null&&e.lat!=null&&e.lng!=null;l.google_fields={"room number":{google_field:"room"},floor:{},"street number":{google_field:"street_number"},street:{google_field:"route"},neighborhood:{},premise:{},subpremise:{},city:{google_field:["locality","sublocality","postal_town"]},"state code":{google_field:"administrative_area_level_1",short:true},state:{google_field:"administrative_area_level_1"},county:{google_field:"administrative_area_level_2"},"zip code":{google_field:"postal_code"},country:{},"country code":{google_field:"country",short:true}};l.to_json_components=function(e){const t={};for(const r in l.google_fields){var n;const i=l.google_fields[r];let s=(n=i.google_field)!=null?n:r;if(!Array.isArray(s)){s=[s]}function o(){for(const t of s){for(const n of e.address_components){if(n.types.includes(t)){if(i.short){return n.short_name}else{return n.long_name}}}}}const a=o();if(a!=null){t[r]=a}}return t};l.rehydrate_b_location=function(e){if(typeof e!=="string"||e.indexOf(s.HYDRATE_STRING)===-1){return e}return r.rehydrate_tree(i().db_instance(a.appname(),a.app_version()),e)};l.round_lat_lng=function(e){if(e!=null&&e.lat&&e!=null&&e.lng){e.lat=Math.floor(e.lat*1e4)/1e4;e.lng=Math.floor(e.lng*1e4)/1e4}};l.geographic_distance=function(e,t,n){let r;if(n==="miles"){r=3958}else{r=6371}const i=e=>e*Math.PI/180;const s=i(t.lat-e.lat);const o=i(t.lng-e.lng);const a=i(e.lat);const l=i(t.lat);const c=Math.sin(s/2)*Math.sin(s/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(a)*Math.cos(l);const u=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));const d=r*u;return d}},{"../../constants/eval":64,"../../constants/geolocation":69,"../../db/hydrate":429,"../../lang/appquery":651,"../../lib":741,"core-js/modules/web.dom-collections.iterator.js":1123}],627:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.get_from_cache=i;n.request_geocode=s;const r={};function i(e,t){const n=t(e);return r[n]}function s(e,t,n,i,s){const o=i(e);if(!r[o]){const i=e=>{r[o]=e;if(e!=null){r[e.address]=e}};s(e,t,i,n)}return r[o]}},{}],628:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./u");const i=e("./logger");const s=e("./u/shared/b_file_shared");const o=n;o.ignore_imgix_fn=function(e,t,n){if(n){return false}if(!u.image_optimization_service||e.indexOf("ignore_imgix")!==-1||t||e.indexOf(".svg")!==-1){return true}if(!s.is_file_cdn_url(e)&&!u.always_proxy_user_files){return true}return false};function a(e,t){if(e.indexOf("//")===0){e=c().location.parsed_url().protocol+e}else if(e.indexOf("https://")!==0&&e.indexOf("http://")!==0){e=c().location.parsed_url().protocol+"//"+e}if(u.always_proxy_user_files){return c().location.parsed_url().host+"/user/iop/"+r.fixedEncodeURIComponent(e)+"?"+d.stringify(t)}else{return u.image_optimization_service+"/"+r.fixedEncodeURIComponent(e)+"?"+d.stringify(t)}}function l(e){e=e*1.1;const t=Math.floor(Math.log2(e));const n=Math.pow(2,t)*1.5;if(e>=n){return Math.pow(2,t+1)}else{return n}}o.get_reduced_file_url=function(e,t,n,s){var o;let c;if(t){const e=l(t);c=e/t;t=e}else{c=null}if(n){if(c){n=Math.round(c*n)}else{n=l(n)}}function u(r){if(isNaN(r)||r==null){var o;if((o=Number.isNaN)!=null&&o.call(Number,r)){i.warn("Picture with NaN dimensions",{src:e,width:t,height:n,options:s})}return null}else{return r.toString()}}const p={w:u(t),h:u(n),auto:"compress"};if(s){r.extend(p,s)}let _=e.split("?")[1];if(_){_=d.parse(_);r.extend(p,_)}(o=p.fit)!=null?o:p.fit="max";return a(e.split("?")[0],p)};o.get_image_json_data=function(e,t){const n={fm:"json"};const i=e.split("?")[1];if(i){const e=d.parse(i);e.fm="json";r.extend(n,e);switch(e.fit){case"crop":case"facearea":case"clamp":case"min":case"scale":if(e.w!=null&&e.h!=null){const n={width:e.w,height:e.h};t(n)}else{t(null)}return}if(e.ar){t(null);return}}e=c().location.parsed_url().protocol+"//"+a(e.split("?")[0],n);const s=$.ajax(e);s.done(((e,n,r)=>{let i,s;if([6,8].includes(e.Orientation)){s=e.PixelHeight;i=e.PixelWidth}else{s=e.PixelWidth;i=e.PixelHeight}if(!s||!i){t(null)}else{const e={width:s,height:i};t(e)}}));return s.fail(((e,n,r)=>t(null)))};o.add_processing_options=function(e,t){if((e==null?void 0:e.split)==null){return""}const n={};const i=e.split("?")[1];if(i){r.extend(n,d.parse(i))}if(t.auto_enhance){n.auto="enhance"}if(t.red_eye){if(t.auto){n.auto+=",redeye"}else{n.auto="redeye"}}if(t.extract_face){var s;n.fit="facearea";n.facepad=(s=t.facepad)!=null?s:1}else if(t.crop_to_fit){n.fit="crop"}for(const e of["blur","sepia"]){if(t[e]){n[e]=t[e+"_level"]}}if(t.pixel){n.px=t.pixel_level}if(t.mono){n.mono=r.rgb_to_hex(t.mono_level).code.split("#")[1]}if(t.mask){n.mask="ellipse"}if(t.q!=null){n.q=t.q}if(t.fm){n.fm=t.fm}return e.split("?")[0]+"?"+d.stringify(n)};const c=e("./lib");const u=e("./client_config");const d=e("querystring")},{"./client_config":41,"./lib":741,"./logger":744,"./u":823,"./u/shared/b_file_shared":837,"core-js/modules/web.dom-collections.iterator.js":1123,querystring:2279}],629:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});Object.defineProperty(n,"EmptyJSON",{enumerable:true,get:function(){return r.EmptyJSON}});Object.defineProperty(n,"JSONBase",{enumerable:true,get:function(){return r.JSONBase}});Object.defineProperty(n,"RuntimeJSON",{enumerable:true,get:function(){return i.default}});Object.defineProperty(n,"VirtualJSON",{enumerable:true,get:function(){return s.default}});Object.defineProperty(n,"escape_app_json_key",{enumerable:true,get:function(){return o.escape_app_json_key}});Object.defineProperty(n,"raw_to_child_names",{enumerable:true,get:function(){return o.raw_to_child_names}});Object.defineProperty(n,"unescape_app_json_key",{enumerable:true,get:function(){return o.unescape_app_json_key}});var r=e("./json_base");var i=a(e("./runtime_json"));var s=a(e("./virtual_json"));var o=e("./json_utils");function a(e){return e&&e.__esModule?e:{default:e}}},{"./json_base":630,"./json_utils":631,"./runtime_json":632,"./virtual_json":633}],630:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.EmptyJSON=l;n.JSONBase=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("./json_utils");var i=e(".././shrink");var s=e("../../constants/app_json");var o=e("../shrink");class a{child_by_path(e){return this.by_path((0,o.shrink_path)(e))}by_path(e){const t=e.split(".");let n=this;for(const e of t){if(e){n=n._child(e)}}return n}child(e){return this._child((0,i.shrink)(e))}name(){return(0,i.expand)(this._name())}path(){const e=this._path();if(!e){return e}return e.split(".").map((e=>(0,i.expand)(e))).join(".")}get is_json(){return true}by_id(e){const t=this.raw_index("id_to_path",e);const n=this.root();if(t){n.pre_cache(t,true)}if(t==null){return l(this,e)}return n.by_path(t)}read_index(){const e=this.raw_index(...arguments);if(e!=null&&typeof e==="object"){delete e[s.OBJECT_MARKER];delete e.length}return e}children(){return this._child_names().map((e=>this._child(e)))}child_names(){return this._child_names().map((e=>(0,i.expand)(e)))}is_equal_to(e){var t;return(e==null?void 0:(t=e.toUniqueString)==null?void 0:t.call(e))===this.toUniqueString()}_raw_to_child_names(e){return(0,r.raw_to_child_names)(e)}raw(){const e=this._raw();if(e===undefined)return e;return(0,i.expand_object)(e)}_raw_child(e){return this._child(e)._raw()}_raw_gchild(e,t){return this._gchild(e,t)._raw()}set(e,t){this._set((0,i.shrink_object)(e),t)}pre_cache(e,t){if(!e&&!this._path()){return}let n=this;if(e){for(const r of e.split(".").filter((e=>e))){if(t){n=n._child(r)}else{n=n.child(r)}}}n.ensure_loading()}toString(){return"JSON Base"}}n.JSONBase=a;function l(e,t,n){return new c(e,t,n)}class c extends a{constructor(e,t,n){super();this.owner=void 0;this._id=void 0;this.search=void 0;this.owner=e;this._id=t;this.search=n}empty(){return true}exists(){return false}_raw(){return undefined}raw_type(){return typeof undefined}get(){return null}id(){var e;return(e=this._id)!=null?e:""}to_id(){return this}to_path(){return this}toString(){var e,t;return"EmptyJSON<"+((e=this._id)!=null?e:"")+((t=this.search)!=null?t:"")+">"}toUniqueString(){return this.toString()+"_"+this.owner.toString()}path_cache(){return this.toString()+"_"+this.owner.toString()}ensure_exists(){return null}_path(){return""}_name(){return""}parent(){return null}_child(e){return l(this.owner,null,`${this.toString()}.child(${String(e)})`)}_gchild(e,t){return l(this.owner,null,`${this.toString()}.gchild(${String(e)},${String(t)})`)}pre_cache(e,t){this.owner.pre_cache(e,t)}ensure_loading(){}_child_names(){return[]}root(){return this.owner.root()}application(){return this.owner.application()}appname(){return this.owner.appname()}app_version(){return this.owner.app_version()}raw_index(){return this.owner.raw_index(...arguments)}register_indexer(){}smart_cache(e,t,n){return t(this,n)}_set(e,t){}serialize(){return{}}}},{"../../constants/app_json":45,".././shrink":728,"../shrink":728,"./json_utils":631,"core-js/modules/web.dom-collections.iterator.js":1123}],631:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.escape_app_json_key=d;n.raw_to_child_names=o;n.unescape_app_json_key=p;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var r=e("../../constants/app_json");var i=e("../../u/shared/regexUtilities");const s=100;function o(e){let t;if(e==null||typeof e!=="object"){t=[]}else{if(Array.isArray(e)){t=e.map(((e,t)=>String(t)))}else{let n=-1;t=[];Object.entries(e).filter((e=>{let[t,n]=e;return n!==undefined&&!["length",r.OBJECT_MARKER].includes(t)})).forEach((e=>{let[r,i]=e;if(n!=null){const e=parseInt(r);if(String(e)!==String(r)){n=null}else{n=Math.max(e,n)}}t.push(r)}));if(n!=null&&n>-1&&n<s*t.length){t=[];for(let e=0;e<=n;e++){t.push(String(e))}}else{t.sort()}}}return t}const a={".":"^{p1}","^":"^{c1}"};const l={};Object.keys(a).forEach((e=>{l[a[e]]=e}));const c=new RegExp((0,i.oneOf)(...Object.keys(a)),"g");const u=new RegExp((0,i.oneOf)(...Object.values(a)),"g");function d(e){return e.replace(c,(e=>a[e]))}function p(e){return e.replace(u,(e=>l[e]))}},{"../../constants/app_json":45,"../../u/shared/regexUtilities":852,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],632:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=l(e("../../u"));var i=e("./json_base");var s=l(e("../nodes/registry"));var o=e("../../u/shared/errors");function a(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=a(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function c(e,t){const n=e;return n==null?void 0:n[t]}class u extends i.JSONBase{constructor(e,t,n,i,s,a){super();this.cache=undefined;this._parent=null;this.__name=undefined;this._root=undefined;this._appname=undefined;this._app_version=undefined;this._unique_id=undefined;this._children={};this._child_names_cache=undefined;this._smart_cache=undefined;this.__path=void 0;this._indexers=void 0;this._has_indexers=void 0;this.cache=e;this._parent=t;this.__name=String(n);this._appname=s;this._app_version=a;if(this.is_root()){this._root=this;this.__path="";this.__name=""}else if(this.is_leaf()){this._root=i;this.__path=this._parent.__path?this._parent.__path+"."+this.__name:this.__name}else{throw new o.UnexpectedError("Must be root or leaf!")}this._unique_id=r.LUID()}toString(){var e,t;return`RuntimeJSON<${(e=this._appname)!=null?e:""}_${this.app_version().toString()}_${(t=this.__path)!=null?t:""}>`}toUniqueString(){var e;return(e=this._unique_id)!=null?e:""}path_cache(){var e;return(e=this._unique_id)!=null?e:""}id(){var e;const t=this.cache;return(e=t==null?void 0:t.id)!=null?e:null}_name(){var e;return(e=this.__name)!=null?e:""}to_id(){return this}to_path(){return this}parent(){return this._parent}_path(){return this.__path}get(){return typeof this.cache==="object"?null:this.cache}empty(){return this.cache==null}appname(){return this._root._appname}app_version(){return this._root._app_version}exists(){return this.cache!=null}ensure_exists(){return this.exists()?this:null}_child(e){var t,n;const r=String(e);(n=(t=this._children)[r])!=null?n:t[r]=new u(c(this.cache,r),this,r,this._root,this._appname,this._app_version);return this._children[r]}_gchild(e,t){return this._child(e)._child(t)}_raw_child(e){return c(this.cache,e)}_raw_gchild(e,t){var n;return c((n=c(this.cache,e))!=null?n:undefined,t)}_child_names(){if(!this._child_names_cache){this._rebuild_child_names()}return this._child_names_cache}_rebuild_child_names(){this._child_names_cache=this._raw_to_child_names(this.cache)}pre_cache(e,t){}raw_index(){var e,t,n;let r=(e=(t=this._root)==null?void 0:(n=t.cache)==null?void 0:n._index)!=null?e:null;for(var i=arguments.length,s=new Array(i),o=0;o<i;o++){s[o]=arguments[o]}for(const e of s){var a;r=(a=r)==null?void 0:a[String(e)]}return r}root(){return this._root}application(){return s.create("FakeApplication",this._root)}_raw(){return this.cache}raw_type(){return typeof this.cache}register_indexer(e,t){var n,r;(n=this._indexers)!=null?n:this._indexers={};this._indexers[e]=t;const i=this._root;if(i==null){return}(r=i._has_indexers)!=null?r:i._has_indexers={};i._has_indexers[this._path()]=this}smart_cache(e,t,n){var r;const i=(r=this._smart_cache)!=null?r:this._smart_cache={};if(!(e in i)){i[e]=t(this,n)}return i[e]}ensure_loading(){}add_to_tree(e){e.add_to_tree(json_shared.json_dependency_path(this),this)}uid(){var e,t,n;const i=(e=(t=this._root)==null?void 0:t.cache)!=null?e:{};(n=i.counter)!=null?n:i.counter=0;i.counter++;return r.short_uid(i.counter,-1)}_set(e,t){const n=this.parent();if(n){if(n.cache!=null){n.cache[this._name()]=e}n._child_names_cache=undefined;this.cache=e;this._child_names_cache=undefined}else{throw new r.UnexpectedError("we do not support setting the root object")}}force_index(e){var t,n,r;(t=e)!=null?t:e=false;const i=s.create("ApplicationVersion",this._root);const o=[...this._root.child("pages").children().map((e=>s.new_element(e))),...this._root.child("element_definitions").children().map((e=>s.create("CustomDefinition",e)))];o.forEach((e=>e.find_elements()));const a=o.flatMap((e=>e.events())).concat(i.api().events());a.forEach((e=>e.actions()));const l={};Object.entries((n=(r=this._root)==null?void 0:r._has_indexers)!=null?n:{}).forEach((e=>{var t;let[n,r]=e;Object.entries((t=r._indexers)!=null?t:{}).forEach((e=>{var t;let[n,i]=e;if(["issues_list","issues_sub"].includes(n)){var s,o,a;const e=n;l[e]=(s=this._root)==null?void 0:(o=s.cache)==null?void 0:(a=o._index)==null?void 0:a[e];return}const[c,u]=(t=i(r))!=null?t:[null,null];if(c!=null){let e=l;for(const t of c.slice(0,c.length-1)){var d,p;e=(p=(d=e)[t])!=null?p:d[t]={}}e[c[c.length-1]]=u}}))}));const c=this._root.cache;c._index=l;delete this._root._children._index;if(!e){var u,d;this.force_index(true);(d=(u=c._index).id_to_path)!=null?d:u.id_to_path={};const e=t=>{if(t._name()==="id"){var n,r;c._index.id_to_path[String(t.get())]=(n=(r=t.parent())==null?void 0:r._path())!=null?n:""}for(const n of t.children()){e(n)}};e(this._root)}}get_loader(){return{map:()=>({path_last_modified:()=>Date.now(),child_names_last_modified:()=>Date.now()})}}different_modifications(){return false}modified(){return Date.now()}serialize(){return{type:"JSON",uid:{appname:this.appname(),app_version:this.app_version(),_path:this._path()}}}is_leaf(){return this._parent!=null}is_root(){return this._parent==null}}n.default=u},{"../../u":823,"../../u/shared/errors":846,"../nodes/registry":724,"./json_base":630,"core-js/modules/web.dom-collections.iterator.js":1123}],633:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.default=l;var r=a(e(".././shrink"));var i=s(e("./runtime_json"));function s(e){return e&&e.__esModule?e:{default:e}}function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function l(e,t){return new i.default(r.shrink_object(t),e.parent(),e._name(),e.root(),e.appname(),e.app_version())}},{".././shrink":728,"./runtime_json":632,"core-js/modules/web.dom-collections.iterator.js":1123}],634:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../nodes");const s=e("../../lib");const o=e("../appquery");const a=e("./RAW");const l=e("../../locations");t.exports=class e extends i.AppNode{constructor(e){super(e);if(e.app_version()!=="live"||l.is_hardcode(e.appname(),e.app_version())){e.register_indexer("issues_list",(()=>{if(s().visual_edit.allow_issue_indexer_runs()){const e=["issues_list",this.id()];return[e,r.json_stringify([])]}}));e.register_indexer("issues_sub",(()=>{const e=["issues_sub",this.id()];const t=this.events().map((e=>e.id()));return[e,r.json_stringify(t)]}))}}id(){return"api"}type(){return"API"}get_name(){return"Backend workflows"}is_api(){return true}is_page(){return false}is_custom_definition(){return false}root(){return this}get_new_event_json(){return this.json.child(r.LUID())}parent(){return null}events(e){const t=this.json.children().map((e=>i.new_workflow_item(e)));return i.filter_array(e,t)}find_events(e){return this.events(e)}find_actions(e){return this.events().flatMap((t=>{var n;return(n=t.all_next(e))!=null?n:[]}))}find_expressions(e){return this.events().flatMap((t=>{var n;return(n=t.find_expressions(e))!=null?n:[]}))}new_event(e,t){const{new_data:n}=a.copy(t,e);const i={root_id:this.id(),id:e,data:n};r.add_source_appname_tracker_to_change_args(n,i,o.appname());const l=s().changes.create_change("CreateEvent",i);l.execute()}find_elements(){return[]}check_for_errors(){}run_indexers(){return this.json.run_indexers()}find_in_editor(e,t){s().visual_edit.responsive_mode_box("builder");return s().visual_edit.ensure_root(this,t)}property(e){if(e==="wf_folder_list"){return o.get_public_setting_node("api_wf_folder_list")}}set_property(e,t){if(e.indexOf("wf_folder_list")===0){o.set_setting(true,"api_"+e,t);this.commit()}}get_static_property(e){if(e==="wf_folder_list"){return o.get_public_setting("api_wf_folder_list")}}}},{"../../lib":741,"../../locations":743,"../../u":823,"../appquery":651,"../nodes":721,"./RAW":646}],635:[function(e,t,n){"use strict";const r=e("../../lib");t.exports=class e{constructor(e){this._appname=e}appname(){return this._appname}domain(){return r().app_domain()}}},{"../../lib":741}],636:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var r,i;function s(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const o=e("../../u");const a=e("../../u/shared/decaf");const l=e("../nodes");const c=e("../caching");const u=e("../btype_ids");const d=e("../../constants/plugin");const p=e("../../constants/locations");const _=e("../../constants/domain");const f=e("../../constants/security");const h=e("../../shared/domain_utilities");const m=e("../../client/analytics");const g=e("../consolidate_paths");const v=e("../../shared/environment_utilities");const b=e("../../lib");const y=e("../../locations");const w=e("../appquery");const x=e("../../services/shared/plugin_registry");const j=e("../../services/shared/plugin_getter");const A=e("../../services/shared/service_type_parser");const M=e("../plugins");const{GROUP_TYPES:E}=e("../../constants/custom_elements");const k=e("./RAW");const{DEPRECATED_EXPERIMENTS:O,FEATURE_FLAGS_PATH:S}=e("../../constants/editor");const{ADVANCED_FEATURES:D,ADVANCED_FEATURE_JSON_SETTINGS_PATH:C}=e("../../constants/advanced_features");const T=e("../../u/shared/mode_check");const N=e("../../notifier/client");const P=e("../../constants/notifier_topics");const I=e("../../constants/segment_events");const R=e("../../shared/pricing_configs");const{SETTINGS_TAB:L,PLUGIN_TAB:z}=e("../../editor/css");const B=e("../../core/core_elements/shared/pages");let q=e("../../client_config");if(o.on_server()){const t=e;q=t("../../configuration")}const U=f.SECURABLE_PREFIX;const F=e("./builtins");const{LATEST_ELEMENT_VERSION:W}=e("../../constants/elements");const G="-no-reply@bubbleapps.io";t.exports=(r=c.cached({type:c.AUTORUN}),i=class e extends l.AppNode{constructor(e){super(e);this._styles_cache={};this._paid_plugin_install_checked=false;if(T.is_edit_mode()){const e=Date.now();N.watch([P.AppPlanChangeTopic,this.appname()],(()=>e),(()=>{this.invalidate_app_plan()}))}}find_expressions(e){const t=this.pages().flatMap((t=>t.find_expressions(e)));const n=this.custom_definitions().flatMap((t=>t.find_expressions(e)));const r=this.api().find_expressions(e);return[...t,...n,...r]}application(){return this.json.application()}appname(){return this.application().appname()}app_version(){return this.json.app_version()}creation_date(){return this.json.child("creation_date").get()}exists(){var e;const t=this.json.child("settings").child("client_safe").child("bubble_version");const n=this.json.child("last_change");return((e=t.get())!=null?e:n.get())!=null}domain(){return this.application().domain()}invalidate_app_plan(){var e,t;b().location.wipe_request_cache("server://appeditor/get_app_plan","post",{appname:this.appname(),check_admin:true,new_2023_pricing_enabled:R.isStateR()});b().location.wipe_request_cache("server://appeditor/get_app_plan","post",{appname:this.appname(),check_admin:false,new_2023_pricing_enabled:R.isStateR()});(e=this._plan_invalidation_box_true)==null?void 0:e.call(this,!this._plan_invalidation_box_true());return(t=this._plan_invalidation_box_false)==null?void 0:t.call(this,!this._plan_invalidation_box_false())}app_plan(e){var t;(t=e)!=null?t:e=false;if(b().is_edit_mode()){var n,r;(r=this[n="_plan_invalidation_box_"+e])!=null?r:this[n]=o.Box(false);this["_plan_invalidation_box_"+e]();const t=b().location.request_synchronous("server://appeditor/get_app_plan","post",{appname:this.appname(),check_admin:e,new_2023_pricing_enabled:R.isStateR()});if(t){var i;(i=t.display)!=null?i:t.display=o.toTitleCase(t.id);if(!e&!this._paid_plugin_install_checked){this._paid_plugin_install_checked=true;const e=true;const n=a.object_entries(t.paid_plugins).filter((e=>{let[t,n]=e;return!n.free}));n.forEach((t=>{let[n,r]=t;if(!this.has_plugin(n)){o.run_once(30,(()=>M.get_plugin(n)),((t,r)=>{if(t){throw t}else if(r.exists()){this.install_plugin(n,r.latest_version(),e)}}))}}))}}return t!=null?t:{}}else{return b().app_plan()}}display(){var e;return(e=this.domain())!=null?e:this.appname()}use_shared_sendgrid_key(){if(this.appname()==="meta"){return false}if(!b().app_plan().custom_domain){return true}if(w.get_public_setting("sendgrid_verified")){return false}return true}get_sendgrid_key(){if(this.use_shared_sendgrid_key()){return q.shared_sendgrid_key}else{return w.get_private_setting("sendgrid_key")}}admin_email(){const e=this.admin_email_hostname();const t=this.appname();if(!t){return q.ADMIN_NO_REPLY}const n=e===q.PROD_DOMAINS.main&&t!=="meta";if(n||this.use_shared_sendgrid_key()&&this.get_public_setting("use_sendgrid")){if(t.indexOf("_")!==-1){return q.ADMIN_NO_REPLY}return this.appname()+G}else{return this.custom_domain_admin_email()}}custom_domain_admin_email(){var e;const t=(e=this.get_public_setting("admin_email"))!=null?e:"admin";return t.trim()+"@"+this.admin_email_hostname()}admin_email_hostname(){var e;if(this.get_public_setting("app_topdomain")){return this.get_public_setting("app_topdomain")}let t=(e=this.domain())!=null?e:_.META_HOSTNAME;const{top_domain:n}=o.get_domain_components(t);if(h.is_host_aws(n)){t=_.META_HOSTNAME}return n}find_oauth_providers(){return Object.entries(this.get_plugin_versions()).filter((e=>{let[t,n]=e;return n})).flatMap((e=>{let[t,n]=e;const r=j.get_plugin(t,n);if(r!=null&&r.is_oauth_provider()){var i;return(i=r.get_oauth_providers_simple())!=null?i:[]}else{return[]}}))}get_oauth_providers(){var e;return(e=b().derived("OAuthProviders").content())!=null?e:[]}load_plugin_main_headers(){const e={};for(const t of p.OKAY_VERSIONS){e[t]=[]}Object.entries(this.get_plugin_versions()).filter((e=>{let[t,n]=e;return n!==true})).forEach((t=>{let[n,r]=t;const i=j.get_plugin(n,r);if(i!=null&&i.has_html_header()){for(const t of p.OKAY_VERSIONS){const r=i.get_html_header();const s=r.params;let o=r.snippet;a.object_entries(s).forEach((e=>{var n;let[r,{key:s}]=e;const a=(n=i.get_key("header_"+r,t))!=null?n:"";const l=o.split("_*_"+s+"_*_");o=l[0];for(const e of l.slice(1)){o+=a+e}}));e[t].push(`\x3c!-- ${n} --\x3e\n`+o)}}}));return e}get_plugin_main_headers(){return b().derived("AppWidePluginHeaders").content()}get_plugin_values_properties(){return b().derived("PluginValuesProperties").content()}get_user_calls(){if(o.is_plugin_edit_mode()){return[]}return b().derived("UserCalls").content()}find_user_calls(){return Object.entries(this.get_plugin_versions()).filter((e=>{let[t,n]=e;return n})).flatMap((e=>{var t;let[n,r]=e;const i=j.get_plugin(n,r);const s=(t=i==null?void 0:i.get_user_calls())!=null?t:[];return s.map((e=>n+d.PLUGIN_SEPARATOR+e))}))}_get_stripe_version(){if(!v.is_production()){return p.TEST_VERSION}return y.get_db_version(this.app_version())}stripe_client_id(){const e="stripe_client_id_"+this._get_stripe_version();return this.get_public_setting(e)}stripe_public_key(){const e="stripe_public_key_"+this._get_stripe_version();return this.get_public_setting(e)}stripe_private_key(){const e="stripe_private_key_"+this._get_stripe_version();return this.get_private_setting(e)}get_public_setting_node(e){if(!e){throw new o.UnexpectedError("missing name")}const t=e.split(".");let n=this.json.child("settings").child("client_safe");for(const e of t){n=n.child(e)}return l.new_expression(n,this)}get_public_setting(e){var t,n,r;const i=this.appname();const s=(t=q.public_app_settings_override)==null?void 0:(n=t[i])==null?void 0:n[e];if(s!=null){return s}return(r=this.get_public_setting_node(e).get_static())!=null?r:this.settings_default(true,e)}get_private_setting_node(e){if(!e){throw new o.UnexpectedError("missing name")}const t=e.split(".");let n=this.json.child("settings").child("secure");for(const e of t){n=n.child(e)}return l.new_expression(n,this)}get_private_setting(e){var t,n,r;const i=this.appname();const s=(t=q.private_app_settings_override)==null?void 0:(n=t[i])==null?void 0:n[e];if(s!=null){return s}return(r=this.get_private_setting_node(e).get_static())!=null?r:this.settings_default(false,e)}settings_default(e,t){if(e&&t==="admin_email"){return"admin"}else if(e&&t==="app_language"){return"en_us"}else{var n;return(n=x.defaults_for_plugins_settings[t])!=null?n:null}}_id(){return this.appname()}id(){return this.appname()}is_template(){return this.json.child("is_template").get()}from_template(){return![null,undefined,""].includes(this.template_id())}template_id(){return this.json.child("template_id").get()}page(e){if(!e){return null}return l.create(l.PAGE,this.json.by_id(e))}pages(e){const t=b().derived("PageByName");t.set_app(this);const n=t.content();const r=a.object_values(n).map((e=>{let{_path:t}=e;return this.json.by_path(t)}));for(const e of r){e.child("id").pre_cache();e.child("type").pre_cache()}const i=r.map(l.new_element).filter((e=>e.exists()&&e.type()==="Page"));i.sort(((e,t)=>{const n=e.json.name();const r=t.json.name();if(n<r){return-1}else if(r<n){return 1}else{return 0}}));return l.filter_array(e,i)}custom_definition(e){if(!e){return null}return l.create(l.CUSTOM_DEFINITION,this.json.by_id(e))}custom_definitions(e){const t=this.json.child("element_definitions").children().map((e=>l.create(l.CUSTOM_DEFINITION,e)));return l.filter_array(e,t)}api(){return l.create(l.API_WORKFLOWS,this.json.child("api"))}custom_type(e){if(!e){return null}if(u.is_custom_type(e)){throw new o.UnexpectedError("This is a value id, not a custom type: "+e+".  Please do values.get(id).custom_type() instead.")}if(e.startsWith(U)){const t=e.split(U);return this.securable_type(t[1],t[2])}return l.create(l.CUSTOM_TYPE,this.json.child("user_types").child(e))}securable_type(e,t){return l.create(l.SECURABLE_TYPE,e,t,this.json.child("user_types").child(U+e+U+t))}custom_types(e,t,n){this.json.child("user_types").pre_cache();const r=e=>e!=="user"&&!e.startsWith(U);const i=this.json.child("user_types").children();const s=i.filter((e=>r(e.name()))).map((e=>l.create(l.CUSTOM_TYPE,e)));const o=l.create(l.CUSTOM_TYPE,this.json.child("user_types").child("user"));const a=t?F.SPECIAL_TYPES:[];let c=[...s,o,...a];if(n){c=c.filter((e=>!e.deleted()))}return l.filter_array(e,c)}option_set(e){if(!e){return null}if(u.is_option_set(e)){throw new o.UnexpectedError("This is a value id, not a custom option set: "+e+".")}return l.create(l.OPTION_SET,this.json.child("option_sets").child(e))}option_sets(e,t){let n=this.json.child("option_sets").children().map((e=>l.create(l.OPTION_SET,e)));if(t){n=n.filter((e=>!e.deleted()))}return l.filter_array(e,n)}element(e){var t;if(!e){return null}const n=this.json.by_id(e);if(n&&o.on_server()){n.child("type").ensure_loading();n.child("id").ensure_loading();n.child("properties").ensure_loading();n.child("custom_states").ensure_loading()}if(((t=n.parent())==null?void 0:t.name())==="styles"){return l.new_element(n,true)}return l.new_element(n)}workflow_item(e){if(!e){return null}return l.new_workflow_item(this.json.by_id(e))}event(e){if(!e){return null}return l.new_workflow_item(this.json.by_id(e))}action(e){if(!e){return null}return l.new_workflow_item(this.json.by_id(e))}by_id(e){var t,n,r;if(!e){return null}const i=this.json.by_id(e);if(!i.exists()){return null}const s=(t=i.parent())==null?void 0:t.name();const o=["workflows","actions","api"].includes(s);const a=((n=i.parent())==null?void 0:(r=n.parent())==null?void 0:r.name())==="actions";if(o||a){return this.workflow_item(e)}else{return this.element(e)}}get_page_by_name(e){if(!e){return null}const t=b().derived("PageByName");t.set_app(this);const n=t.content();if(n[e]){const t=this.json.by_path(n[e]._path);return l.create(l.PAGE,t)}else{return null}}get_custom_by_name(e){var t;const n=b().derived("CustomByName");n.set_app(this);const r=(t=n.content()[e])==null?void 0:t.id;if(r){return this.custom_definition(r)}else{return null}}last_change(){var e;return(e=this.json.child("last_change").get())!=null?e:"no_last_change"}favicon(){const e=this.json.child("favicon").get();if(["//s3.amazonaws.com/appforest_uf/f1438203816318x881656567333266200/favicon_rounded.png","//s3.amazonaws.com/appforest_uf/f1462750401796x354019699618220350/apple_touch_icon_precomposed.png"].includes(e)){return"//meta.cdn.bubble.io/f1530294839424x143528842134401200/Icon-no-clearspace.png"}return e}plugin_special(){return this.json.child("plugin_special").get()}get_undostack(){return this.json.get_undostack()}app_uses_event(e,t){return this.find_events(e,t).length>0}app_uses_action(e,t){return this.find_actions(e,t).length>0}app_uses_element(e,t){return this.find_elements(e,false,t).length>0}find_actions(e,t){const n=this._find(e,"Action",t).map(l.new_workflow_item);return l.filter_array(e,n)}find_elements(e,t,n){if(e==="Page"){return this.pages()}else if(e==="CustomDefinition"){return this.custom_definitions(e)}else{const r=this._find(e,"Element").map((e=>l.new_element(e)));const i=l.filter_array(e,r);const s=E[e]!=null;if(t&&s){const r=t=>t.get_static_property("element_type")===e;r._type="CustomDefinition";i.push(...this.find_elements(r,t,n))}return i}}find_events(e,t){const n=this._find(e,"Event",t).map(l.new_workflow_item);return l.filter_array(e,n)}_find(e,t,n){e=l.make_filter(e);if(!e._type){throw new o.UnexpectedError("Can only use application.find_ functions with a given type")}const r=this._find_by_type_derived(e._type,t,n);if(o.is_edit_mode()){for(const e of g.consolidate(r)){this.json.by_path(e).ensure_loading()}}return r.map((e=>this.json.by_path(e)))}_find_by_type_derived(e,t,n){if(t==="Event"){return b().derived("EventTypeToPath").content(n)[e]||[]}else if(t==="Action"){return b().derived("ActionTypeToPath").content(n)[e]||[]}else if(t==="Element"){return b().derived("ElementTypeToPath").content(n)[e]||[]}else{throw new o.UnexpectedError(`unknown plugin type ${t}`)}}styles(){return this.json.child("styles").children().map((e=>l.create(l.STYLE,e)))}style(e){var t,n;const r=this.json.child("styles").child(e);(n=(t=this._styles_cache)[e])!=null?n:t[e]=l.create(l.STYLE,r);return this._styles_cache[e]}get_style_default(e){var t;return(t=this.get_public_setting("default_styles"))==null?void 0:t[e]}get_plugin_versions(){var e;return(e=this.get_public_setting("plugins"))!=null?e:{}}get_plugin_version(e){return this.get_public_setting_node("plugins").json.child(e).get()}has_plugin(e){return Boolean(this.get_plugin_version(e))}list_plugins(){return Object.keys(this.get_plugin_versions())}remove_plugin(e){var t;const n=(t=this.get_public_setting("plugins"))!=null?t:{};delete n[e];this.set_setting(true,"plugins",n);this.commit();m.track(I.PLUGIN_UNINSTALLED,{app:w.appname(),plugin_id:e,plugin_name:M.get_plugin(e).display()})}install_plugin(e,t,n){var r;const i=(r=this.get_public_setting("plugins"))!=null?r:{};i[e]=t!=null?t:true;if(o.is_UUID(e)&&t==null||!o.is_UUID(e)&&![true,null,undefined,"current"].includes(t)){throw new o.UnexpectedError("about to write invalid plugin version",{plugins_data:i,id:e,version:t})}this.set_setting(true,"plugins",i);if(i[e]===true){const t=M.get_plugin(e).get_service();const n=t.get_keys();a.object_entries(n).forEach((e=>{let[n,r]=e;const i=r.default_value!=null;const s=t.get_key(n)==null;if(i&&s){const e=r.type==="client_safe";this.set_setting(e,n,r.default_value)}}));const r={ionic:1,materialicons:1,progressbar:1,chartjs:1,handsontable:1,fullcalendar:1,slickcarousel:1,draggableui:1,multifileupload:1,disqus:1,recorderjs:1,addtoany:1,jtinder:1,selectpdf:1,ziggeo:1};if(r[e]!=null){this.set_setting(true,`${e}_installed_version`,r[e])}}this.commit();if(!q.plugins_live_here&&!M.is_hardcoded(e)){b().location.post("server://appeditor/copy_plugin_meta_data",{plugin_id:A.get_plugin_id(e),raw:M.get_plugin(e).data})}if(!n){m.track_with_marketing_metadata(I.PLUGIN_INSTALLED,{app:w.appname(),plugin_id:e,plugin_name:M.get_plugin(e).display(),plugin_price:M.get_plugin(e).price()})}}check_for_errors(e,t,n){var r;const i=y.is_hardcode(w.appname(),"test");const s=["template_app","forum_apps","app_employee"].includes((r=w.app_plan())==null?void 0:r.id);if(!i&&!s){function o(){const e=e=>["geographic_address",u.list_type("geographic_address")].includes(e);const t=t=>!t.deleted()&&e(t.value());const n=e=>!e.deleted()&&e.fields().some(t);const r=w.custom_types().some(n);if(r){return true}return false}const a=w.get_private_setting("general_keys.google_geocode_key");if(a==null&&o()){e("Your app needs its own Google Geocode API Key to process addresses. Please add one in the Settings Tab.")}const l=w.get_public_setting("general_keys.google_map_key");if(l==null){const c="AutocompleteDropdown.choices_style=geographic_places";let d,p;if(n){p=()=>w.app_uses_element("GoogleMap");d=()=>w.find_elements(c).length>0}else{p=()=>w.find_elements("GoogleMaps").some((e=>e.root()!=null));d=()=>w.find_elements(c).some((e=>e.root()!=null))}if(p()){e("Your app needs its own Google Map key for the map elements to function properly. Please add one in the Settings Tab.")}else if(d()){e("Your app needs its own Google Map key for the geographic search boxes to function properly. Please add one in the Settings Tab.")}}}if(n){return}return{children:[...this.custom_types(undefined,undefined,true),...this.styles()]}}find_in_editor(e,t,n,r){if(r!=null&&r.path_array&&["apiconnector2","plugins"].includes(r==null?void 0:r.path_array[2])){$(z).click();return}$(L).click();b().settings_editor.settings_canvas.open_tab("General");o.wait_for_updates((()=>t==null?void 0:t($(".apikeys-wrapper"))))}new_page(e,t,n){let r;const i=w.uid();[r,e]=V(b().appchange.validate_page_name(e));if(r){throw new o.UnexpectedError(r)}if(t){n=w.page(t).raw()}if(!n){var s;n={type:"Page",properties:{}};n.properties.new_responsive=true;n.properties.fixed_width=true;n.properties.width=1080;n.properties.height=767;n.properties.min_width_px=0;n.properties.responsive_version=(s=w.get_public_setting("base_responsive_version"))!=null?s:0;n.properties.element_version=W;if(w.get_public_setting("default_page_title")){n.properties.title=k.TextExpression([w.get_public_setting("default_page_title")])}if(w.get_public_setting("default_page_preset_width")){const e=w.get_public_setting("default_page_preset_width");n.properties.preset_width=e;if(B.preset_page_widths[e].width!=null){n.properties.width=B.preset_page_widths[e].width}}}const{new_data:a}=k.copy(n,i);a.name=e;const l={root_path:"pages",id:i,data:a};o.add_source_appname_tracker_to_change_args(a,l,w.appname());const c=b().changes.create_change("CreateElement",l);c.execute()}new_custom(e,t,n){const[r,i]=b().appchange.validate_custom_name(e);if(r){throw new o.UnexpectedError(r)}if(t){n=w.custom_definition(t).raw()}if(!n){n={type:"CustomDefinition",properties:{width:200,height:200,element_type:"Group",min_width_px:20,element_version:W}}}const s=w.uid();const{new_data:a}=k.copy(n,s);a.name=i;const l={root_path:"element_definitions",id:s,data:a};o.add_source_appname_tracker_to_change_args(a,l,w.appname());const c=b().changes.create_change("CreateElement",l);c.execute();return s}create_custom_type(e,t,n,r){const i={display:t};if(n!=null){i.privacy_role=n}else if(w.get_public_setting("new_types_private")){i.privacy_role={everyone:{display:"everyone",permissions:{view_all:false,view_attachments:false,search_for:false,auto_binding:false}},rule_1_:{display:"Rule 1",permissions:{view_all:true,view_attachments:true,search_for:true,auto_binding:false}}}}const s={name:e,data:i};o.maybe_add_source_appname_to_object(s,w.appname(),r);const a=b().changes.create_change("WriteCustom",s);a.execute()}create_option_set(e,t,n){const r={display:t,creation_source:n};const i=b().changes.create_change("WriteOptionSet",{name:e,data:r});i.execute()}change_favicon(e){const t=this.favicon();if(e!==t){const n=b().changes.create_change("ChangeAppSetting",{path:"favicon",value:e,old_value:t});n.execute()}}set_setting(e,t,n){const r=e?this.get_public_setting_node(t):this.get_private_setting_node(t);const i=r.raw();if(n!==i){const e={path:r.path(),value:n,old_value:i};o.add_source_appname_tracker_to_change_args(n,e,w.appname());const t=b().changes.create_change("ChangeAppSetting",e);t.execute()}}create_new_style(e,t,n,r,i,s,a){var l;if(s&&(l=this.style(s))!=null&&l.exists()){s=undefined}if(!s){const n=t+"_"+e.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();let r="";const i=()=>n+"_"+r;while((c=this.style(i()))!=null&&c.exists()){var c;r=(r||0)+1}s=i()}const u={display:e,type:t,properties:n,states:r,transitions:i,id:s};const d={name:s,data:u};o.maybe_add_source_appname_to_object(d,w.appname(),a);const p=b().changes.create_change("CreateStyle",d);p.execute();this.commit();return s}delete_style(e){const t=w.style(e);const n=t.raw();const r=b().changes.create_change("DeleteStyle",{name:e,data:n});r.execute();this.commit()}set_style_default(e,t){var n;const r=(n=this.get_public_setting("default_styles"))!=null?n:{};r[e]=t;this.set_setting(true,"default_styles",r);this.commit()}apply_theme(e,t,n){const r={};for(const e of V(this.styles())){if(e.from_theme()){r[e.id()]=e.json.raw()}}const i=b().changes.create_change("ApplyTheme",{theme_id:e,theme_data:t,old_theme:r,theme_display:n});i.execute();this.commit()}comments(){const e=["Element","Event","Action","CustomType","CustomField","PrivacyRole","Style"];function t(t,n){const r=t.child("type").get();const i=n.child("type").get();const s=e.indexOf(r);const o=e.indexOf(i);return o-s}const n=[];const r=this.json.child("comments").children();for(const e of r.sort(t)){if(e.child("content").get()){n.push(l.create(l.COMMENT,e))}if(e.child("comments").exists()){const r=e.child("comments").children();for(const e of r.sort(t)){n.push(l.create(l.COMMENT,e))}}}return n}comment(e,t){const n=t?this.json.child("comments").child(t.id()):this.json;return l.create(l.COMMENT,n.child("comments").child(e))}repair_ids(e){const t=e.child("type").get();const n=e.child("id").get();if(t&&!n){const t=e.raw();t.id=w.uid();b().changes.set_id_cache({json:e,data:t});e.set(t,{name:"ApplicationRepairIds"});console.log(`added id ${t.id} to type ${t.type}, path: ${e._path()}`)}else if(n&&!t){console.log(`WARNING, missing type for id ${n}, ${e._path()}`)}for(const t of e.child("elements").children()){this.repair_ids(t)}}get_editor_link(e){const t=e?"https://local.bubble.is":b().location.get_base_for_meta();const n=w.appname();const r=w.app_version();let i=`${t}/page?id=${n}&version=${r}`;const s=b().location.get_pieces().path[0];if(s){i+=`&name=${s}`}return i}with_feature_flag(e){let{feature_name:t,old_fn:n,new_fn:r}=e;return o.error_append(`with limited_rollout: ${t}`,(()=>{if(this.has_feature_enabled(t)){return r()}else{return n()}}))}has_feature_enabled(e){var t;if(O[e]&&!((t=O[e].test_app_exceptions)!=null&&t.includes(this.appname()))&&this.get_public_setting("bubble_version")>=O[e].deprecation_bv){return false}return this.get_public_setting(`${S}${e}`)===true}has_fallback_path_enabled(e){var t,n;switch(e[0]){case"experimental_feature":return this.has_feature_enabled(e[1]);case"raw_path":return(t=(n=this.json.by_path(e[1]))==null?void 0:n.raw())!=null?t:false;default:return false}}has_advanced_feature_enabled(e){var t;const n=D[e];if(this.get_public_setting("bubble_version")<22){if(n!=null&&n.fallback){return this.has_fallback_path_enabled(n.fallback)}return false}if(n!=null&&n.parent_advanced_feature){const e=n.parent_advanced_feature;if(!this.has_advanced_feature_enabled(e)){return false}}const r=this.get_public_setting(`${C}.${e}`);if(r!=null){return r}if(n!=null&&n.fallback){return this.has_fallback_path_enabled(n.fallback)}return(t=n==null?void 0:n.enabled_by_default)!=null?t:false}set_advanced_feature_enabled(e,t){var n,r;const i=D[e];if(!i){return}this.set_setting(true,`${C}.${e}`,t);if(i.fallback){switch(i.fallback[0]){case"experimental_feature":(n=this.json.by_path(i.fallback[1]))==null?void 0:n.set(t);break;case"raw_path":(r=this.json.by_path(i.fallback[1]))==null?void 0:r.set(t);break}}this.commit()}can_run_issue_checker(){return this.app_version()!=="live"||y.is_hardcode(this.appname(),this.app_version())}toString(){return this.app_version()}context_element(){return null}},s(i.prototype,"get_user_calls",[r],Object.getOwnPropertyDescriptor(i.prototype,"get_user_calls"),i.prototype),i);function V(e){return Array.from(e)}},{"../../client/analytics":20,"../../client_config":41,"../../constants/advanced_features":42,"../../constants/custom_elements":57,"../../constants/domain":59,"../../constants/editor":60,"../../constants/elements":61,"../../constants/locations":74,"../../constants/notifier_topics":76,"../../constants/plugin":78,"../../constants/security":84,"../../constants/segment_events":85,"../../core/core_elements/shared/pages":366,"../../editor/css":560,"../../lib":741,"../../locations":743,"../../notifier/client":747,"../../services/shared/plugin_getter":783,"../../services/shared/plugin_registry":784,"../../services/shared/service_type_parser":785,"../../shared/domain_utilities":792,"../../shared/environment_utilities":793,"../../shared/pricing_configs":800,"../../u":823,"../../u/shared/decaf":844,"../../u/shared/mode_check":851,"../appquery":651,"../btype_ids":652,"../caching":656,"../consolidate_paths":658,"../nodes":721,"../plugins":726,"./RAW":646,"./builtins":649,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],637:[function(e,t,n){"use strict";const r=e("../nodes");t.exports=class e extends r.AppNode{name(){return this.json.name()}set(e,t,n){if([null,""].includes(t)){this.json.child("type").set(null,{name:"DeleteCommentTarget"});this.get_content_node().set(null,{name:"DeleteComment"});this.json.child("parent").set(null,{name:"DeleteCommentParent"})}else{this.json.child("type").set(e,{name:"SetCommentTarget"});this.get_content_node().set(t,{name:"SetComment"});this.json.child("parent").set(n,{name:"SetCommentParent"})}}get_content_node(){return this.json.child("content")}get(){return this.get_content_node().get()}get_type(){return this.json.child("type").get()}get_parent(){return this.json.child("parent").get()}id(){return this.name()}}},{"../nodes":721}],638:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../../lib");const s=e("../btypes");const o=e("../nodes");const a=e("./CustomFieldState");t.exports=class e extends a{deleted(){return this.json.child("deleted").get()}name(){return this.json.name()}parent(){return o.create(o.CUSTOM_TYPE,this.json.parent().parent())}is_custom(){return s.is_custom_type(this.value())}set_deleted(e){const t=i().changes.create_change("WriteCustomField",{custom_name:this.parent().name(),name:this.name(),path:"deleted",data:e});t.execute()}set_display(e){const t=i().changes.create_change("WriteCustomField",{custom_name:this.parent().name(),name:this.name(),path:"display",data:e});t.execute()}set_default_val(e){const t=i().changes.create_change("WriteCustomField",{custom_name:this.parent().name(),name:this.name(),path:"default_val",data:e});t.execute()}find_in_editor(e,t){this.parent().find_in_editor(false,(()=>{r.wait_for_updates((()=>{if(e){if(window.is_maison){t==null?void 0:t($(`.data.types .field-composer-row[key='${this.id()}']`))}else{t==null?void 0:t($(`.data.types .field[key='${this.id()}']`))}}else{t==null?void 0:t()}}))}))}}},{"../../lib":741,"../../u":823,"../btypes":653,"../nodes":721,"./CustomFieldState":639}],639:[function(e,t,n){"use strict";const r=e("../nodes");const i=e("../btype_ids");const s=["text","number","date","boolean","file","image","geographic_address"];t.exports=class e extends r.AppNode{display(){return this.json.child("display").get()}value(){return this.json.child("value").get()}default_val(){if(!this.can_have_default()){return null}return this.json.child("default_val").raw()}can_have_default(){if(this.name()==null||this.is_list()){return false}const e=this.value();return s.includes(e)||i.is_option_set(e)}is_list(){return i.is_list(this.value())}exists(){return this.json.child("value").get()!=null}id(){return this.name()}}},{"../btype_ids":652,"../nodes":721}],640:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../nodes");const s=e("../../lib");const o=e("../appquery");const a=e("../btypes");const l=e("../btype_ids");const{DATA_TAB:c}=e("../../editor/css");t.exports=class e extends i.AppNode{constructor(e){e.ensure_loading();super(e)}name(){return this.json.name()}id(){return this.name()}to_value(){const e=this.name();return e==="user"?"user":l.custom_type(e)}deleted(){return this.json.child("deleted").get()}display(){return this.json.child("display").get()}exposed_api(){return this.json.child("exposed_api").get()}fields(){const e=this.json.child("fields").children();return e.map((e=>i.create(i.CUSTOM_FIELD,e)))}field(e){return i.create(i.CUSTOM_FIELD,this.json.child("fields").child(e))}privacy_roles(){const e=this.json.child("privacy_role").children();return e.map((e=>i.create(i.PRIVACY_ROLE,e)))}privacy_role(e){const t=this.json.child("privacy_role").child(e);return i.create(i.PRIVACY_ROLE,t)}default(){return s().derived("DefaultValues").content()[this.name()]}get_default_fields(e){var t;(t=e)!=null?t:e=false;const n=this.json.child("fields").children();return n.map((t=>{const n=i.create(i.CUSTOM_FIELD,t);const r={};r.name=n.name();r.value=n.value();r.display=n.display();if(!e){if(n.default_val()!=null){if(l.is_option_set(n.value())){r.default_val=n.default_val()}else{r.default_val=a.get(n.value()).cast(n.default_val())}}r.deleted=n.deleted()}return r}))}check_for_errors(e){return{children:this.privacy_roles()}}create_initial_default_privacy_roles(){if(this.privacy_roles().length<1){this.create_new_privacy_role(null,true)}if(this.privacy_roles().length===1){this.create_new_privacy_role("Visible to creator");const e=this.privacy_roles()[1];const t={type:"InjectedValue",next:{type:"Message",name:"Created By",next:{type:"Message",name:"equals",args:{type:"CurrentUser"}}}};e.set_condition(t)}}create_new_privacy_role(e,t){var n;(n=t)!=null?n:t=false;let r;if(e===null){r="everyone";e="everyone"}else{const t=e.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();let n="";const i=()=>t+"_"+n;while(this.privacy_role(i()).exists()){n=(n||0)+1}r=i()}const i=this.json.path()+".privacy_role."+r;const a={display:e,permissions:this.starting_permissions(t)};const l=s().changes.create_change("ChangeAppSetting",{path:i,value:a});l.execute();o.commit()}starting_permissions(e){var t;(t=e)!=null?t:e=false;const n=this.exposed_api()?false:undefined;return{view_all:!e,view_attachments:!e,search_for:!e,auto_binding:false,modify_api:n,delete_api:n,create_api:n}}delete_privacy_role(e){const t=this.json.path()+".privacy_role."+e;const n=null;const r=this.privacy_role(e).json.raw();const i=s().changes.create_change("ChangeAppSetting",{path:t,value:n,old_value:r});i.execute();o.commit()}reserved_fields(){return["_id","_rev","type"]}readable_fields(){const e=[new(s().sets.Option)("Created Date","Created Date","Documentation.Data.Messages.CustomType.Created Date"),new(s().sets.Option)("Modified Date","Modified Date","Documentation.Data.Messages.CustomType.Modified Date"),new(s().sets.Option)("Slug","Slug","Documentation.Data.Messages.CustomType.Slug")];const t=[new(s().sets.Option)("Created By","Created By","Documentation.Data.Messages.CustomType.Created By")];return[...this.writeable_fields(),...e,...this.name()==="user"?[]:t]}writeable_fields(){return this.fields().filter((e=>!e.deleted())).map((e=>new(s().sets.Option)(e.display(),e.name(),undefined,undefined,undefined,undefined,(()=>{if(window.confirm("Delete field "+e.display()+"?")){return e.set_deleted(true)}}))))}public_searchable_fields(e){var t,n,r;(t=e)!=null?t:e=true;const i=this.readable_fields();const s=e=>["Created By"].includes(e.value)||a.not_built_in(this.field(e.value).value());if(this.privacy_roles().length<2){return i.filter((t=>!(e&&s(t))))}const o=(n=this.privacy_role("everyone"))==null?void 0:n.get_permissions();if(!o.search_for){return[]}const l=Object.values((r=o.view_fields)!=null?r:{});return i.filter((t=>{if(e&&s(t)){return false}else{return o.view_all||l.includes(t.value)}}))}get_field_option(e){var t;const n=this.field(e);if(n!=null&&n.exists()&&!n.deleted()){return new(s().sets.Option)(n.display(),n.name())}return(t=this.readable_fields().find((t=>t.value===e)))!=null?t:null}get_permissions_editors(){return{view_all:{caption:"View all fields",composer:"Checkbox"},view_attachments:{caption:"View attached files",composer:"Checkbox"},search_for:{caption:"Find this in searches",composer:"Checkbox"},auto_binding:{caption:"Allow auto-binding",composer:"Checkbox"},modify_api:{caption:"Modify via API",composer:"Checkbox"},delete_api:{caption:"Delete via API",composer:"Checkbox"},create_api:{caption:"Create via API",composer:"Checkbox"}}}create_field(e,t,n){const r=s().changes.create_change("WriteCustomField",{custom_name:this.name(),name:e,data:{display:t,value:n}});r.execute()}set_deleted(e){const t=s().changes.create_change("WriteCustom",{name:this.name(),path:"deleted",data:e});t.execute()}set_display(e){const t=s().changes.create_change("WriteCustom",{name:this.name(),path:"display",data:e});t.execute()}set_api(e){const t=s().changes.create_change("WriteCustom",{name:this.name(),path:"exposed_api",data:e});t.execute()}find_in_editor(e,t){$(c).click();s().data_canvas.open_tab("Data Types");s().data_canvas.selection_boxes["Data Types"](this);if(window.is_maison){s().visual_edit.privacy_rules_selected(false)}r.wait_for_updates((()=>{if(e){t==null?void 0:t($(`.custom-type-entry[key='${this.id()}']`))}else{t==null?void 0:t()}}))}}},{"../../editor/css":560,"../../lib":741,"../../u":823,"../appquery":651,"../btype_ids":652,"../btypes":653,"../nodes":721,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],641:[function(e,t,n){"use strict";t.exports=class e{constructor(e){this.version_json=e}domain(){return this.version_json.child("primary_domain").get()}appname(){return this.version_json.child("_id").get()}}},{}],642:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../nodes");const s=e("../../lib");const o=e("./CustomFieldState");t.exports=class e extends o{deleted(){return this.json.child("deleted").get()}name(){return this.json.name()}parent(){return i.create(i.OPTION_SET,this.json.parent().parent())}set_deleted(e){const t=s().changes.create_change("WriteOptionAttribute",{option_set_name:this.parent().name(),name:this.name(),path:"deleted",data:e});t.execute()}set_display(e){const t=s().changes.create_change("WriteOptionAttribute",{option_set_name:this.parent().name(),name:this.name(),path:"display",data:e});t.execute()}find_in_editor(e,t){this.parent().find_in_editor(false,(()=>{r.wait_for_updates((()=>{if(e){t==null?void 0:t($(`.option-set-attributes [key='${this.id()}']`))}else{t==null?void 0:t()}}))}))}}},{"../../lib":741,"../../u":823,"../nodes":721,"./CustomFieldState":639}],643:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../nodes");const s=e("../../lib");const o=e("../../constants/option_sets");const a=e("../../constants/lang");const l=e("../appquery");const c=e("../btype_ids");const{DATA_TAB:u}=e("../../editor/css");t.exports=class e extends i.AppNode{name(){return this.json.name()}id(){return this.name()}to_value(){const e=this.name();return c.option_set_type(e)}deleted(){return this.json.child("deleted").get()}display(){return this.json.child("display").get()}attributes(){const e=this.json.child("attributes").children();return e.map((e=>i.create(i.OPTION_ATTRIBUTE,e)))}attribute(e){const t=this.json.child("attributes").child(e);return i.create(i.OPTION_ATTRIBUTE,t)}values(){const e=this.json.child("values").children();const t=this.json.child("attributes").child("db_value").exists()?a.OPTION_VALUE_FORMATS.name_is_key:a.OPTION_VALUE_FORMATS.name_is_db_value_with_fallback;return e.map((e=>i.create(i.OPTION_VALUE,e,t)))}get_id_to_name_mapping(){const e=this.json.child("attributes").child("db_value").exists();const t=()=>{var t;const n=Object.entries((t=this.json.child("values").raw())!=null?t:{});return Object.fromEntries(n.map((t=>{let[n,r]=t;if(!e&&r.db_value){return[r.db_value,n]}else{return[n,n]}})))};return this.json.smart_cache("OptionSetValueMapping",t)}value(e){var t;const n=(t=this.get_id_to_name_mapping()[e])!=null?t:"null";const r=this.json.child("attributes").child("db_value").exists()?a.OPTION_VALUE_FORMATS.name_is_key:a.OPTION_VALUE_FORMATS.name_is_db_value_with_fallback;return i.create(i.OPTION_VALUE,this.json.child("values").child(n),r)}reserved_attributes(){return["_id","_rev","type","display","deleted","sort_factor","db_value"]}reserved_values(){return["_id","_rev","type",o.ALL_OPTIONS,"null","undefined"]}create_attribute(e,t,n,r){const i=s().changes.create_change("WriteOptionAttribute",{option_set_name:this.name(),name:e,data:{display:t,value:n,creation_source:r}});i.execute()}create_value(e,t,n){var r;(r=n)!=null?r:n={};n.display=t;n.db_value=e;const i=s().changes.create_change("WriteOptionValue",{option_set_name:this.name(),name:l().uid(),data:n});i.execute()}set_deleted(e){const t=s().changes.create_change("WriteOptionSet",{name:this.name(),path:"deleted",data:e});t.execute()}set_display(e){const t=s().changes.create_change("WriteOptionSet",{name:this.name(),path:"display",data:e});t.execute()}find_in_editor(e,t){$(u).click();if(window.is_maison){s().data_canvas.open_tab("OptionSets");s().data_canvas.selection_boxes.OptionSets(this)}else{s().data_canvas.open_tab("Option Sets");s().data_canvas.selection_boxes["Option Sets"](this)}r.wait_for_updates((()=>{if(e){const e=window.is_maison?$(`.optionsets .custom-type-entry[key='${this.id()}']`):$(`.option.sets .custom-type-entry[key='${this.id()}']`);t==null?void 0:t(e)}else{t==null?void 0:t()}}))}clean_order(){const e=this.values().sort(((e,t)=>e.sort_factor()-t.sort_factor()));const t=[];e.forEach(((e,n)=>{if(e.sort_factor()!==n){e.set_sort_factor(n);t.push(e)}}));t.forEach((e=>e.commit()))}reorder_pair(e,t){if(e.sort_factor()===t.sort_factor()){this.clean_order()}const n=e.sort_factor();const r=t.sort_factor();e.set_sort_factor(r);t.set_sort_factor(n);e.commit();t.commit()}}},{"../../constants/lang":73,"../../constants/option_sets":77,"../../editor/css":560,"../../lib":741,"../../u":823,"../appquery":651,"../btype_ids":652,"../nodes":721,"core-js/modules/web.dom-collections.iterator.js":1123}],644:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../nodes");const s=e("../../lib");const o=e("../../constants/lang");t.exports=class e extends i.AppNode{constructor(e,t){super(e);this.format=t}deleted(){return this.json.child("deleted").get()}name(){if(this.format===o.OPTION_VALUE_FORMATS.name_is_key){return this.json.name()}else{var e;return(e=this.json.child("db_value").get())!=null?e:this.json.name()}}id(){return this.name()}display(){return this.json.child("display").get()}sort_factor(){return this.json.child("sort_factor").get()}parent(){return i.create(i.OPTION_SET,this.json.parent().parent())}attr(e){const t=this.json.child(e).raw();if(t&&typeof t==="object"){const e=Object.keys(t).every((e=>e.match(/^\d+$/)));if(e){const e=[];Object.entries(t).forEach((t=>{let[n,r]=t;e[parseInt(n)]=r}));return e}}return t}set_deleted(e){const t=s().changes.create_change("WriteOptionValue",{option_set_name:this.parent().name(),name:this.json.name(),path:"deleted",data:e});t.execute()}set_display(e){const t=s().changes.create_change("WriteOptionValue",{option_set_name:this.parent().name(),name:this.json.name(),path:"display",data:e});t.execute()}set_sort_factor(e){const t=s().changes.create_change("WriteOptionValue",{option_set_name:this.parent().name(),name:this.json.name(),path:"sort_factor",data:e});t.execute()}set_attr(e,t){const n=s().changes.create_change("WriteOptionValue",{option_set_name:this.parent().name(),name:this.json.name(),path:e,data:t});n.execute()}find_in_editor(e,t){this.parent().find_in_editor(false,(()=>{r.wait_for_updates((()=>{if(e){t==null?void 0:t($(`.option-set-values [key='${this.id()}']`))}else{t==null?void 0:t()}}))}))}}},{"../../constants/lang":73,"../../lib":741,"../../u":823,"../nodes":721,"core-js/modules/web.dom-collections.iterator.js":1123}],645:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../nodes");const s=e("../../lib");const o=e("../appquery");const a=e("../btypes");const l=e("../btype_ids");const c=e("../../types");const{DATA_TAB:u}=e("../../editor/css");t.exports=class e extends i.AppNode{display(){if(this.name()==="everyone"){return"everyone"}else{return this.json.child("display").get()}}name(){return this.json.name()}id(){return this.name()}parent(){const e=this.json.parent().parent();return this.app().custom_type(e.name())}condition(){return i.new_expression(this.json.child("condition"),this)}context_element(){return null}check_for_errors(e){if(this.name()!=="everyone"){var t,n,r,i,s,o;const c=this.condition();const u=c.get_eval_value();let d=this.display();const p=l.custom_type((t=this.parent())==null?void 0:(n=t.json)==null?void 0:n.name());const _=a==null?void 0:(r=a.get(p))==null?void 0:(i=r.custom_type)==null?void 0:(s=(o=i.call(r)).display)==null?void 0:s.call(o);if(_){d+=" (type "+_+")"}if(u.matches("null")){return e(d+" privacy rule - the condition should not be empty",c)}else if(!u.matches("sys.bool")){return e(d+' privacy rule - condition must evaluate to "yes" or "no", but this is a '+u.display(),c)}}}get_composer_context(){return{privacy_condition:true,node:{json:this.json,owner:this}}}set_display(e){const t=this.json.path()+".display";const n=this.display();if(e!==n){const r=s().changes.create_change("ChangeAppSetting",{path:t,value:e,old_value:n});r.execute();o.commit()}}set_condition(e){const t=this.json.path()+".condition";const n=this.condition().raw();if(JSON.stringify(n)!==JSON.stringify(e)){const r=s().changes.create_change("ChangeAppSetting",{path:t,value:e,old_value:n});r.execute();o.commit()}}get_injected_display(){return"This "+c.safely_retrieve_display_name(this.parent())}get_injected_value(){return this.parent().to_value()}can_search_for(){const e=this.condition();const t=e.find_expressions("InjectedValue");if(e.is("InjectedValue")){t.push(e)}return!t.some((e=>{var t,n,r,i;return(t=(n=e.next()).next)==null?void 0:(r=(i=t.call(n)).message)==null?void 0:r.call(i).is_lookup()}))}get_permissions(){const e=this.json.child("permissions").raw();if(e){var t;(t=e.auto_binding)!=null?t:e.auto_binding=false}return e}set_permission(e,t){var n;const r=this.json.path()+".permissions."+e;const i=(n=this.get_permissions())==null?void 0:n[e];if(JSON.stringify(i)!==JSON.stringify(t)){const e=s().changes.create_change("ChangeAppSetting",{path:r,value:t,old_value:i});e.execute();o.commit()}}find_in_editor(e,t){$(u).click();if(window.is_maison){s().data_canvas.open_tab("Data Types",{privacy_subsubtab:true,parent:this.parent()})}else{s().data_canvas.selection_boxes.Privacy(this.parent());s().data_canvas.open_tab("Privacy")}r.wait_for_updates((()=>{if(e){if(window.is_maison){t==null?void 0:t($(`.privacy-editor .role-box[key='${this.id()}']`))}else{t==null?void 0:t($(`.privacy .role-div[key='${this.id()}']`))}}else{t==null?void 0:t()}}))}}},{"../../editor/css":560,"../../lib":741,"../../types":812,"../../u":823,"../appquery":651,"../btype_ids":652,"../btypes":653,"../nodes":721}],646:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");let r;const i=e("../../u");const s=e("../nodes");const o=e("../../lib");function a(e){if(e==="CustomDefinition"){return false}return o().load_plugin(o().plugin_prefixes.element+e,true)==null}t.exports=r={Empty(){return{type:"Empty"}},TextExpression(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return{type:"TextExpression",entries:e}},DataSource(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return{type:e,properties:t,next:n}},Message(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;return{type:"Message",properties:t,name:e,next:r,args:n}},CustomType(e){return{display:e.display,fields:e.fields,privacy_role:e.privacy_role,exposed_api:e.exposed_api}},CustomField(e){return{display:e.display,value:e.value,deleted:e.deleted,default_val:e.default_val}},OptionSet(e){return{display:e.display,attributes:e.attributes,values:e.values}},OptionAttribute(e){return{display:e.display,value:e.value,deleted:e.deleted}},OptionValue(e){return e},Application(){var e;let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let r=arguments.length>2?arguments[2]:undefined;let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;(e=r)!=null?e:r={};return{pages:t,user_types:n,option_sets:i,...r}},Page(e){if(!e.name){throw new i.UnexpectedError("all pages must have names")}return r.Element("Page",e)},CustomDefinition(e){return r.Element("CustomDefinition",e)},Element(e,t){var n,r,s,o,l,c,u,d,p;(n=t)!=null?n:t={};const _={properties:(r=t.properties)!=null?r:{},id:(s=t.id)!=null?s:i.LUID(),name:(o=t.name)!=null?o:null,elements:(l=t.elements)!=null?l:null,states:(c=t.states)!=null?c:null,workflows:(u=t.workflows)!=null?u:null,style:(d=t.style)!=null?d:null,custom_states:(p=t.custom_states)!=null?p:null};Object.entries(t).forEach((e=>{let[t,n]=e;if(n!=null&&!_[t]){throw new i.UnexpectedError("sent an unrecognized parameter to lang.RAW.Element: "+t)}}));if(a(e)){_.type="CustomElement";_.properties.custom_id=e}else{_.type=e}return _},State(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return{type:"State",condition:e,properties:t}},Event(e,t){var n,r,s,o;(n=t)!=null?n:t={};const a={type:e,properties:(r=t.properties)!=null?r:null,id:(s=t.id)!=null?s:i.LUID(),actions:(o=t.actions)!=null?o:null};Object.entries(t).forEach((e=>{let[t,n]=e;if(n!=null&&!a[t]){throw new i.UnexpectedError("sent an unrecognized parameter to lang.RAW.Event: "+t)}}));return a},Action(e,t){var n,r,s;(n=t)!=null?n:t={};const o={type:e,properties:(r=t.properties)!=null?r:null,id:(s=t.id)!=null?s:i.LUID()};Object.entries(t).forEach((e=>{let[t,n]=e;if(n!=null&&!o[t]){throw new i.UnexpectedError("sent an unrecognized parameter to lang.RAW.Action: "+t)}}));return o},copy(e,t){if(!t){throw new i.UnexpectedError("must pass in a new id to copy")}const[n,r]=s.deep_copy_with_new_ids(e);if(e.id&&e.id!==t){r[e.id]=r[n.id]=t}s.deep_replace(n,r);n.id=t;return{new_data:n,mapping:r}}}},{"../../lib":741,"../../u":823,"../nodes":721,"core-js/modules/web.dom-collections.iterator.js":1123}],647:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u/shared/decaf");const i=e("../appquery");const s=e("../../services/shared/plugin_getter");const o=e("./CustomType");const a=e("./builtins");const l=e("../btype_ids");t.exports=class e extends o{constructor(e,t,n){super(n);this.no_special_messages=true;this.not_writeable=true;this.plugin=e;this._name=t}name(){return this._name}to_value(){return l.custom_type(this.json.name())}my_data(){var e;return(e=s.get_plugin(this.plugin).securable)==null?void 0:e[this.name()]}display(){var e,t;return(e=(t=this.my_data())==null?void 0:t.display)!=null?e:"[missing: "+this.plugin+" "+this.name()+"]"}get_permissions_editors(){var e,t;return(e=(t=this.my_data())==null?void 0:t.permissions_editors)!=null?e:{}}starting_permissions(){var e,t;return(e=(t=this.my_data())==null?void 0:t.starting_permissions)!=null?e:{}}fields(){var e,t;return r.object_entries((e=(t=this.my_data())==null?void 0:t.fields)!=null?e:{}).map((e=>{let[t,n]=e;return a.create_fake_field(t,n)}))}field(e){var t,n;const r=(t=(n=this.my_data())==null?void 0:n.fields[e])!=null?t:{display:"Missing: "+e,value:"null"};return a.create_fake_field(e,r)}permissions_node(e){return i.app().json.child_by_path(`user_types.${e}.privacy_role`)}}},{"../../services/shared/plugin_getter":783,"../../u/shared/decaf":844,"../appquery":651,"../btype_ids":652,"./CustomType":640,"./builtins":649,"core-js/modules/web.dom-collections.iterator.js":1123}],648:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../lib");const s=e("../appquery");const o=e("../../u/shared/decaf");r.show_privacy_warning=function(e,t,n){if(!s.get_public_setting(e)){s.set_setting(true,e,true);const n=s.custom_types(undefined,undefined,true);const r=n.flatMap((e=>e.privacy_roles().filter((e=>e.name()!=="everyone"))));if(!r.length){t();return}}n==null?void 0:n()};r.page_name_to_id=e=>{var t;return(t=i().derived("PageByName").content()[e])==null?void 0:t.id};r.page_id_to_name=function(e){const t=i().derived("PageByName").content();const n=o.object_keys(t).find((n=>t[n].id===e));return n!=null?n:null};r.custom_name_to_id=e=>{var t;return(t=i().derived("CustomByName").content()[e])==null?void 0:t.id};r.custom_id_to_name=function(e){const t=i().derived("CustomByName").content();const n=o.object_keys(t).find((n=>t[n].id===e));return n!=null?n:null};const a=["index","reset_pw","404"];const l="index";const c=["reset_pw","404"];function u(e,t){if(e.toLowerCase()<t.toLowerCase()){return-1}else{return 1}}r.get_sorted_list_of_pages=function(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const{skip_builtin:t}=e;const n=i().derived("PageByName").content();const r=n[l]?[l]:[];const s=o.object_keys(n).filter((e=>!a.includes(e)));s.sort(u);const d=t?[]:c;return[...r,...s,...d]};r.get_sorted_list_of_custom_definitions=function(){const e=i().derived("CustomByName").content();const t=o.object_keys(e);t.sort(u);return t}},{"../../lib":741,"../../u/shared/decaf":844,"../appquery":651,"core-js/modules/web.dom-collections.iterator.js":1123}],649:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=t.exports;const i=e("../../u");const s=e("../../u/shared/decaf");const o=e("../appquery");const a=e("../btypes");r.create_fake_field=function(e,t){let n,r,i;if(typeof t==="object"){i=t.value;n=t.deleted;r=t.display}else{i=t;n=false;r=e}return{name:()=>e,raw:()=>true,value:()=>i,exists:()=>true,display:()=>r,deleted:()=>n}};function l(e,t,n){return{exists:()=>true,name:()=>e,field:e=>r.create_fake_field(e,t[e]),fields:()=>s.object_entries(t).filter((e=>{let[t,n]=e;return typeof n!=="object"||n.display})).map((e=>{let[t,n]=e;return r.create_fake_field(t,n)})),no_rename:true,display:()=>e,privacy_roles:()=>s.object_entries(n).map((e=>{let[t,n]=e;return c(t,n)})),privacy_role(e){if(n!=null&&n[e]){return c(e,n[e])}}}}function c(e,t){return{get_permissions:()=>t.permissions,condition:()=>({json:()=>({raw:t.condition}),get_eval_value:()=>a.get("sys.bool")})}}const u={run_id:{value:"sys.uid"},charge_user_id:{value:"sys.uid"},status:{value:"sys.uid"}};const d={plan_id:{value:"sys.uid",display:"Plan id"},done:{value:"boolean",display:"Subscription was successful"},coupon_id:{value:"sys.uid",display:"Coupon id"},quantity:{value:"number",display:"Quantity"},trial_end:{value:"date",display:"Trial End"},tax_percent:{value:"number",display:"Tax percent"},user_id:{value:"sys.uid"},subscribe_id:{value:"sys.uid"},stringified_properties:{value:"sys.uid"}};const p={amount:{value:"number",display:"Amount"},amount_received:{value:"number",display:"Amount Received (including coupons)"},app_fee:{value:"number",display:"Application Fee"},currency:{value:"sys.uid",display:"Currency"},StripeChargeID:{value:"sys.uid",display:"Charge Id"},captured:{value:"boolean",display:"Captured"},payment_intent_id:{value:"text",display:"Payment intent id"},description:{value:"text",display:"Order description"},charged_user_email:{value:"sys.uid",display:"Email of charged user"},product_name:{value:"text",display:"Product name"},image:{value:"text",display:"Product image"},statement_descriptor:{value:"text",display:"Statement descriptor"},charge_user_action_id:{value:"sys.uid"},charged_user_id:{value:"sys.uid"},charged_user:{value:"sys.uid"},payee_user:{value:"sys.uid"},authorize_only:{value:"boolean"},allow_promotion_codes:{value:"boolean"}};const _=l("Order",i.extend({},u,p));const f=l("SubscriptionOrder",i.extend({},u,d));const h={used:"boolean",user_id:"custom",token_text:"text",email:"text"};const m={everyone:{permissions:{}},no_one:{condition:false,permissions:{}}};const g={used:"boolean",user_id:"custom",email:"text",validity_ms:"number",spage_thing:"text",fpage_thing:"text",succ_page_name:"text",fail_page_name:"text",s_additional_parameters:"text",f_additional_parameters:"text",success_page:"text",failure_page:"text"};const v=l("password_reset",h,m);const b=l("magic_link",g,m);const y=l("confirmation email entry",h,m);r.SPECIAL_TYPES=[_,f,v,y,b];r.SPECIAL_ALL={"Modified Date":"date","Created Date":"date","Created By":"custom",Slug:"text",recurring_scheduling:"json"};const w={StripeCustomerID:"custom",stripeauthtoken:"not_indexed",email:"custom",user_signed_up:"boolean"};const x={max_number_of_app:"long"};r.get_special_fields=function(e,t){const n=[r.SPECIAL_ALL];if(t){n.push(t)}if(e.name()==="user"){n.push(w);if(o.app().plugin_special()==="meta"){n.push(x)}}return n.flatMap((e=>s.object_entries(e).map((e=>{let[t,n]=e;return r.create_fake_field(t,n)}))))}},{"../../u":823,"../../u/shared/decaf":844,"../appquery":651,"../btypes":653,"core-js/modules/web.dom-collections.iterator.js":1123}],650:[function(e,t,n){"use strict";const r=n;const i=e("../nodes");const s=e("./FakeApplication");const o=e("./Application");const a=e("./ApplicationVersion");const l=e("./API");const c=e("./CustomType");const u=e("./SecurableType");const d=e("./CustomFieldState");const p=e("./CustomField");const _=e("./PrivacyRole");const f=e("./OptionSet");const h=e("./OptionAttribute");const m=e("./OptionValue");const g=e("./Comment");const v=e("./builtins");const b=e("./application_utils");i.add(i.FAKE_APPLICATION,s);i.add(i.APPLICATION,o);i.add(i.APPLICATION_VERSION,a);i.add(i.API_WORKFLOWS,l);i.add(i.CUSTOM_TYPE,c);i.add(i.SECURABLE_TYPE,u);i.add(i.CUSTOM_FIELD_STATE,d);i.add(i.CUSTOM_FIELD,p);i.add(i.PRIVACY_ROLE,_);i.add(i.OPTION_SET,f);i.add(i.OPTION_ATTRIBUTE,h);i.add(i.OPTION_VALUE,m);i.add(i.COMMENT,g);r.get_special_fields=v.get_special_fields;r.SPECIAL_TYPES=v.SPECIAL_TYPES;r.show_privacy_warning=b.show_privacy_warning;r.page_name_to_id=b.page_name_to_id;r.page_id_to_name=b.page_id_to_name;r.custom_name_to_id=b.custom_name_to_id;r.custom_id_to_name=b.custom_id_to_name;r.get_sorted_list_of_pages=b.get_sorted_list_of_pages;r.get_sorted_list_of_custom_definitions=b.get_sorted_list_of_custom_definitions},{"../nodes":721,"./API":634,"./Application":635,"./ApplicationVersion":636,"./Comment":637,"./CustomField":638,"./CustomFieldState":639,"./CustomType":640,"./FakeApplication":641,"./OptionAttribute":642,"./OptionSet":643,"./OptionValue":644,"./PrivacyRole":645,"./SecurableType":647,"./application_utils":648,"./builtins":649}],651:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./../u");const i=e("./../safe_require");i.safe_register("./lang/appquery",o);const s=n;t.exports=o;function o(e,t){return a().app(e,t)}o.app=o;o.add_methods=function(e){for(const t of r.all_keys(e.prototype)){o[t]=s[t]=function(){const e=a().app();if(!e[t]){var n;throw new r.UnexpectedError("Current Lib().app() is missing function",{k:t,cur_app:String(e),cur_app_keys:String(r.all_keys(e)),cur_app_constructor:e==null?void 0:(n=e.constructor)==null?void 0:n.name,app_fn:String(a().app)})}return e[t](...arguments)}}};if(typeof window!=="undefined"&&window!==null){window.appquery=o}const a=e("./../lib")},{"./../lib":741,"./../safe_require":777,"./../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],652:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.api_type=m;n.api_type_inner=g;n.bubble_null=void 0;n.custom_type=p;n.custom_type_name=_;n.is_api_type=h;n.is_custom_type=d;n.is_list=a;n.is_option_set=b;n.list_element_type=c;n.list_type=l;n.option_set_name=w;n.option_set_type=y;var r=s(e("../safe_require"));var i=e("../logger");function s(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./lang/btype_ids",n);const o="list.";function a(e){var t;return(t=e==null?void 0:e.startsWith(o))!=null?t:false}function l(e){return`${o}${e}`}function c(e){if(!a(e)){(0,i.warn)("btype_ids assertion failure!",{function:"list",btype_id:e})}return e.slice(o.length)}const u="custom.";function d(e){var t;return(t=e==null?void 0:e.startsWith(u))!=null?t:false}function p(e){return`${u}${e}`}function _(e){if(e==="user"){return"user"}if(!d(e)){(0,i.warn)("btype_ids assertion failure!",{function:"custom",btype_id:e})}return e.slice(u.length)}const f="api.";function h(e){var t;return(t=e==null?void 0:e.startsWith(f))!=null?t:false}function m(e){return`${f}${e}`}function g(e){if(!h(e)){(0,i.warn)("btype_ids assertion failure!",{function:"api",btype_id:e})}return e.slice(f.length)}const v="option.";function b(e){var t;return(t=e==null?void 0:e.startsWith(v))!=null?t:false}function y(e){return`${v}${e}`}function w(e){if(!b(e)){(0,i.warn)("btype_ids assertion failure!",{function:"option_set",btype_id:e})}return e.slice(v.length)}const x="null";n.bubble_null=x},{"../logger":744,"../safe_require":777}],653:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("./../u");const s=e("../u/shared/decaf");const o=e("./btype_ids");const a=e("./../safe_require");a.safe_register("./lang/btypes",r);const l=e("./../lib");const c=e("./appquery");const u=e("./caching");const d=e("./../logger");const p=e("./btypes_registry");const _=e("./missing_btype");r.get=function(e,t){var n;const{miss_okay:r}=t!=null?t:{};if((n=e)!=null&&n.get_message){return e}if(typeof e!=="string"){if(e!=null){var i;d.info("non-string btype_id",{type:typeof e,stringified:(i=e)==null?void 0:i.toString()})}e="null"}if(e!=null&&_.is_missing(e)){return f([_.strip_prefix(e),r])}if(e==="date_unix"){return f(["date",r])}return f([e,r])};r.is_custom_type=e=>e==="user"||typeof e==="string"&&o.is_custom_type(e);const f=u.standalone({type:u.RUN_MODE,parameters:1},(e=>{let[t,n]=e;if(!t){t="null"}const r=c.toUniqueString();return h(t,r,n)}));r.list=i.autorun_cache((e=>{var t;if(!e){return p.plugins.entries().filter((e=>{let[t,n]=e;return!n.dont_list})).map((e=>{let[t,n]=e;return r.get(t)}))}const n=e.split(".");const i=l().load_plugin(l().plugin_prefixes.btype+n[0]);const s=n.slice(1).join(".");const o=s===""?i:i.get(s);return((t=o.list())!=null?t:[]).map((t=>r.get(e+"."+t)))}));r.search=function(e){const t=r.list();const n=p.providers.entries().filter((e=>{let[t,n]=e;return typeof n.list==="function"})).flatMap((e=>{let[t,n]=e;return r.list(t)}));const i=[...t,...n];return i.filter((t=>t.matches(e)))};const h=i.autorun_cache((function(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return new m(e,n)}));class m{constructor(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this._id=typeof e==="string"?e:"null";const[n,...r]=this._id.split(".");const i=r.join(".");const s=l().load_plugin(l().plugin_prefixes.btype+n,t);const o=i!==""?s==null?void 0:s.get(i):s;this.plugin=typeof o==="function"?o():o;if(!this.plugin){this.plugin=_.get(this._id)}}id(){return this._id}get_message(e){var t;const n=(t=this.plugin.get_message(e))!=null?t:{description:" [not found: "+e+"]",not_found:true,fn:()=>{}};return new r.Message(e,n,this._id)}get_messages(e){return s.array_from(this.plugin.get_message_names({exclude_special_messages:e})).map((e=>this.get_message(e)))}get_message_reorg(e){var t;if(!this.plugin.get_message_reorg){return this.get_message(e)}const n=(t=this.plugin.get_message_reorg(e))!=null?t:{description:" [not found: "+e+"]",not_found:true,fn:()=>{}};return new r.Message(e,n,this._id)}get_messages_reorg(e){if(!this.plugin.get_message_names_reorg){return this.get_messages(e)}return s.array_from(this.plugin.get_message_names_reorg({exclude_special_messages:e})).map((e=>this.get_message_reorg(e)))}call(e,t,n,r){return this.get_message(e).evaluate(t,n,r)}display(){return this.plugin.display()}display_for_issue(){if(typeof this.plugin.display_for_issue==="function"){return this.plugin.display_for_issue()}if(this.id()==="null"){return"empty"}return this.display()}is_aggregate(){return this.plugin.is_aggregate}equals(e,t){return this.plugin.equals(e,t)}get_sample(){return this.plugin.get_sample()}get_bubble_null(){if(typeof this.plugin.get_bubble_null!=="function"){d.warn("missing get_bubble_null",{btype:this});return null}return this.plugin.get_bubble_null()}cast(e){var t;if(typeof this.plugin.cast!=="function"){return e}return(t=this.plugin.cast(e))!=null?t:null}is_missing(){var e,t,n;return(e=(t=(n=this.plugin).is_missing)==null?void 0:t.call(n))!=null?e:false}from_human(e,t){if(this.plugin.from_human){return this.plugin.from_human(e,t)}return this.cast(e)}runmode_display(e,t){if(!this.plugin.runmode_display){var n;if((n=window)!=null&&n.current_user_is_admin){console.log(`trying to render a ${this.id()} to string, but no V.runmode_display function`)}return""}return this.plugin.runmode_display(e,t)}has_runmode_display(){return this.plugin.runmode_display!=null}export_to_string(e,t){return this.plugin.export_to_string(e,t)}has_export_to_string(){return this.plugin.export_to_string!=null}debugging_display(e,t){return this.plugin.debugging_display(e,t)}has_debugging_display(){return this.plugin.debugging_display!=null}can_sort(){return this.plugin.can_sort}custom_type(){var e,t;return(e=(t=this.plugin).custom_type)==null?void 0:e.call(t)}option_set(){var e,t;return(e=(t=this.plugin).option_set)==null?void 0:e.call(t)}can_get_JS_object(){if(this.plugin.get_JS_object!=null){return true}d.error("No get_JS_object for btype",{id:this._id});return false}get_JS_object(e){return this.plugin.get_JS_object(e)}can_JS_to_bubble(){return this.plugin.JS_to_bubble!=null}JS_to_bubble(e){return this.plugin.JS_to_bubble(e)}matches(e){if(typeof this.plugin.matches==="function"){return this.plugin.matches(e)}else{return y(e)(this)}}synonyms(){if(this.inner()){var e;const t=(e=this.inner().plugin.synonyms)!=null?e:[];return[this.id(),...t.map((e=>o.list_type(e)))]}else{var t;return[this.id(),...(t=this.plugin.synonyms)!=null?t:[]]}}storable(){return this.plugin.storable}bindable(){return this.plugin.bindable}get_composer_input_type(){return this.plugin.composer_input_type}inner(){var e,t;return(e=(t=this.plugin).inner)==null?void 0:e.call(t)}inner_including_ranges(){if(this.plugin.inner){return this.plugin.inner()}const e=/_range$/;if(this.id().match(e)){return r.get(this.id().replace(e,""))}return this}is_range(){return this.plugin.inner==null&&/_range$/.test(this.id())}is_list(){return this.plugin.is_list}}function g(e){const t=t=>t.id()!==e;t.display=()=>"anything but a "+r.get(e).display();return t}function v(e){function t(t){return t.synonyms().includes(e.id())||e.synonyms().includes(t.id())}t.display=()=>"a "+e.display();t.display_for_issue=()=>e.display_for_issue();return t}function b(e){const t=e+".";const n=e=>e.id().startsWith(t);n.display=()=>"any "+r.get(e).display();return n}function y(e){if(typeof e==="object"&&typeof e.id==="function"){return v(e)}else if(typeof e==="string"){if(e.startsWith("!")){return g(e.slice(1))}else if(e==="list*bindable"){return r.compound}else if(e.endsWith("*")){return b(e.slice(0,-1))}else{return v(r.get(e))}}else if(typeof e==="function"){if(!e.display){d.error("every matcher function must have a display function",{str_or_fn:e});e.display=()=>"a thing"}return e}else{throw new i.UnexpectedError("blank or invalid matcher",{str_or_fn:e})}}r.Message=class e{constructor(e,t,n){this.evaluate=this.evaluate.bind(this);this.evaluate_without_cast=this.evaluate_without_cast.bind(this);this._name=e;this.M=t;this.btype=n;this.fn=this.M.fn}is_not_found(){return this.M.not_found}no_composer(e){var t,n;return(t=(n=this.M).no_composer)==null?void 0:t.call(n,e)}has_args(){return this.M.arg_btype!=null}no_arg_no_properties(){return!this.has_args()&&this.spot_data()!=="SlidableAtom"}public_for_plugins(){return this.M.public_for_plugins}arg_btype(){if(this.M.arg_btype){return r.get(this.M.arg_btype)}else{return null}}name(){return this._name}ret_btype_id(e){if(typeof this.M.ret_btype==="function"){return this.M.ret_btype(e)}else{var t;return(t=this.M.ret_btype)!=null?t:"null"}}ret_btype(e){return r.get(this.ret_btype_id(e))}check_for_errors(e,t){if(this.M.check_for_errors){this.M.check_for_errors(e,t)}}ret_btype_null(){return this.ret_btype(...arguments).get_bubble_null()}spot_data(){return this.M.spot_data}fields(e,t){var n,r,i;return(n=(r=(i=this.M).fields)==null?void 0:r.call(i,e,t))!=null?n:[]}field_names(){var e;if(this.M.fields&&!this.M.field_names){throw new i.UnexpectedError("missing field_names for message "+this._name)}return(e=this.M.field_names)!=null?e:{}}description(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const r=typeof this.M.description==="function"?this.M.description(e,n):this.M.description;const i=/^'s /;if(t&&r.match(i)){return r.replace(i,"")}else{return r}}filter_context(e){if(e.privacy_condition){if(this.M.privacy_condition_okay===false){return false}const e=this.M.build_pg_constraint;const t=this.M.build_pg_relationship&&this.M.build_pg_r_constraint;if(e&&(t||!this.M.arg_btype)){return true}if(["and_","or_"].includes(this._name)){return true}return this.is_lookup()}const t=["format_boolean","format_boolean_number"];if(e.is_style&&t.includes(this._name)){return false}if(!this.M.filter_context){return true}return this.M.filter_context(e)}filter_context_new(e){if(e.owner_type==="PrivacyRole"){if(this.M.privacy_condition_okay===false){return false}const e=this.M.build_pg_constraint;const t=this.M.build_pg_relationship&&this.M.build_pg_r_constraint;if(e&&(t||!this.M.arg_btype)){return true}if(["and_","or_"].includes(this._name)){return true}return this.is_lookup()}const t=["format_boolean","format_boolean_number"];if(e.owner_type==="State"&&e.is_style&&t.includes(this._name)){return false}if(!this.M.filter_context_new){return true}return this.M.filter_context_new(e)}is_lookup(){return this.M.is_lookup}get_lookup_name(){if(typeof this.M.is_lookup==="string"){return this.M.is_lookup}else{return this._name}}evaluate(e,t,n,r,i){const s=this.evaluate_without_cast(e,t,n,r,i);if(!this.is_lookup()){return s}return this.ret_btype(r).cast(s)}evaluate_without_cast(e,t,n,r,i){var s;const o=e==null?void 0:(s=e._type)==null?void 0:s.call(e);if(o&&o!==this.btype){return this.ret_btype(r).get_bubble_null()}if(this.is_lookup()){var a,l,c;return e==null?void 0:(a=e.child)==null?void 0:(l=(c=a.call(e,this.get_lookup_name())).get)==null?void 0:l.call(c)}else{return this.fn(e,t,n,r,i)}}build_pg_relationship(e,t){if(this.M.arg_btype==null){return[this._name+" does not take args so no relationship"]}if(!this.M.build_pg_relationship){return["no pg relationship for "+this._name]}else{return[null,this.M.build_pg_relationship(e,t)]}}build_pg_constraint(e,t){if(!this.M.build_pg_constraint){return["no pg constraint for "+this._name]}else{return[null,this.M.build_pg_constraint(e,t)]}}build_pg_r_constraint(e,t){if(this.M.arg_btype==null){return[this._name+" does not take args so no reversed"]}if(!this.M.build_pg_r_constraint){return["no pg reversed constraint for "+this._name]}else{return[null,this.M.build_pg_r_constraint(e,t)]}}no_frozen_state(e){var t;let{prev:n}=e;return(n==null?void 0:(t=n.query)==null?void 0:t.t)==="NodeList"||this.M.no_frozen_state}message_cache_id(e){var t,n;let{raw:r,properties:i}=e;return(t=(n=this.M).message_cache_id)==null?void 0:t.call(n,{raw:r,properties:i})}can_shortcircuit_args(){return this.M.can_shortcircuit_args}properties_for_pre_evaluation(e){let{_properties:t}=e;if(this.M.properties_for_pre_evaluation)return this.M.properties_for_pre_evaluation({_properties:t});return t}};r.any=e=>true;r.any.display=()=>"any";r.saveable=function(e){var t,n;const r=(t=e==null?void 0:e.custom_type())!=null?t:{};return!r.not_writeable&&!((n=r.deleted)!=null&&n.call(r))&&typeof r.writeable_fields==="function"};r.saveable.display=()=>"anything saveable";r.saveable.get_name=()=>"saveable";r.compound=e=>e&&e.bindable();r.compound.display=()=>"any thing";r.stringable=e=>(e==null?void 0:e.has_runmode_display())&&e.id()!=="null";r.stringable.display=()=>"anything that can be printed as text";r.not_built_in=e=>/^(list\.)?custom/.test(e);r.not_built_in.display=()=>"anything that is not a built-in type";r.display_matcher=function(e){var t,n;const r=y(e);return(t=(n=r.display_for_issue)==null?void 0:n.call(r))!=null?t:r.display()}},{"../u/shared/decaf":844,"./../lib":741,"./../logger":744,"./../safe_require":777,"./../u":823,"./appquery":651,"./btype_ids":652,"./btypes_registry":655,"./caching":656,"./missing_btype":717,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],654:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.allowableBtypes=void 0;n.api_list=G;n.customTypeAccelerator=B;n.customTypes=void 0;n.custom_fields=q;n.custom_states=U;n.displayableInListBtypes=void 0;n.file_storage_providers=H;n.filters=I;n.oauth_providers=V;n.option_values=F;n.registerAddPlugin=j;var r=e("solid-js/web");e("core-js/modules/web.dom-collections.iterator.js");var i=y(e("../safe_require"));var s=e("../editor/composer/utilities/dropdown_contents");var o=e("./btypes");var a=e("../services");var l=e("./btype_ids");var c=e("solid-js");var u=y(e("../lib"));var d=e("./missing_btype");var p=e("../constants/special_keys");var _=y(e("./appquery"));var f=e("../u/shared/async/autorun");var h=e("./application");var m=e("../editor/css");var g=e("../constants/option_sets");var v=e("../services/shared/plugin_getter");var b=e("../u/shared/mode_check");function y(e){return e&&e.__esModule?e:{default:e}}const w=(0,r.template)(`<div></div>`,2);let x=null;function j(e){x=e}i.default.safe_register("./lang/btypes_dropdowns",n);function A(e){var t,n;if(e==null){return null}if(typeof e!=="string"){return String(e)}if((0,d.is_missing)(e)){return e}const r=(0,o.get)(e);const i=r==null?void 0:r.display();if(i!=null&&(t=r.custom_type)!=null&&(n=t.call(r))!=null&&n.deleted()){return i+" (deleted)"}return i!=null?i:e}function M(e){return{display:e.display(),value:e.id()}}function E(){var e;return(e=(0,o.list)().filter((e=>e.storable()&&e.id()!=="user")).map(M))!=null?e:[]}function k(){var e;return[M((0,o.get)("user")),...(e=S().sort(s.sort_by_display))!=null?e:[]]}function O(){var e;return(e=(0,o.list)("option").map(M))!=null?e:[]}function S(){var e;return(e=(0,o.list)("custom").map(M))!=null?e:[]}function D(){var e;if((0,b.is_plugin_edit_mode)()){return[]}return(e=(0,a.get_value_ids)().map((e=>M((0,o.get)(e)))))!=null?e:[]}function C(){var e;if((0,b.is_plugin_edit_mode)()){return[]}return(e=(0,o.list)("api").filter((e=>{var t;return(t=e.storable)==null?void 0:t.call(e)})).map(M))!=null?e:[]}let T;let N;let P;function I(){var e,t,n;(e=T)!=null?e:T=(0,c.createRoot)((()=>(0,c.createMemo)((()=>D().map((e=>e.value))),[])));(t=N)!=null?t:N=(0,c.createRoot)((()=>(0,c.createMemo)((()=>E().map((e=>e.value))),[])));(n=P)!=null?n:P=(0,c.createRoot)((()=>(0,c.createMemo)((()=>C().map((e=>e.value))),[])));return{no_plugins:e=>!T().includes(e.value),no_primitives:e=>!N().includes(e.value),no_data_types:e=>!(e.value==="user"||(0,l.is_custom_type)(e.value)),no_api:e=>!P().includes(e.value),no_option_sets:e=>!(0,l.is_option_set)(e.value),no_ranges:e=>!["date_range","number_range"].includes(e.value)}}const R=()=>s.DropdownContents.multi_section((()=>({"Data Types":k(),"Option Sets":O().sort(s.sort_by_display),"Basic Types":E(),"Plugin Types":D().sort(s.sort_by_display)})),{show_sections:true,get_display_for_literal:A});n.displayableInListBtypes=R;const L=()=>s.DropdownContents.multi_section((()=>({"Data Types":k(),"Option Sets":O().sort(s.sort_by_display),"Basic Types":E(),"Plugin Types":C().sort(s.sort_by_display)})),{show_sections:true,get_display_for_literal:A});n.allowableBtypes=L;const z=()=>s.DropdownContents.multi_section((()=>({"Data Types":k()})),{show_sections:true,get_display_for_literal:A});n.customTypes=z;function B(){let t;return{display:"Create a new type...",onClick:n=>{if(t==null){const[n,i]=(0,c.createSignal)(false);const[s,o]=(0,c.createSignal)((()=>{}));const a=(0,r.render)((()=>{if((0,b.is_edit_mode)()){const{InputPopup:t}=e("../editor/components/design/popup/InputPopup");return(0,r.createComponent)(t,{title:"New Type",get showingPopup(){return n()},textfield:true,onHidePopup:()=>i(false),inputCaption:"Type Name:",submitHandler:e=>{const t=e.trim();if(t!=null&&t!==""){const e=u.default.or_throw().type_editor.add_new_user_type(t);s()(true,e)}i(false)}})}else{return w.cloneNode(true)}}),document.body);(0,c.onCleanup)((()=>{a();t=null}));t={showing:n,setShowing:i,setOnCreation:o}}t.setShowing(true);t.setOnCreation((()=>n))}}}function q(e){let t;if(typeof e.btype_name==="string"){t=e.btype_name}else{var n;t=(n=e.btype_name)==null?void 0:n.id()}const r=(0,o.get)(t).custom_type();const i={email:e.add_email_field_for_user_type,StripeCustomerId:(r==null?void 0:r.id())==="user"&&e.add_stripe_customer_id,[p.UNIQUE_ID]:e.add_unique_id,[p.ALL_DB_FIELDS]:e.include_all_fields,email_confirmed:(r==null?void 0:r.id())==="user"&&e.add_email_confirmed_field_for_user,password:(r==null?void 0:r.id())==="user"&&e.add_pw,[p.RANDOM_SORTING]:e.show_random_sort_option,[p.DYNAMIC_SORTING_FIELD]:e.show_dynamic_sort_option};const a=s.DropdownContents.no_sections((()=>{var t;let n;switch(e.field_kind){case"builtins":n=r==null?void 0:r.public_searchable_fields(true);break;case"public_searchable":n=r==null?void 0:r.public_searchable_fields(true);break;case"writeable":n=r==null?void 0:r.writeable_fields();break;case"readable":case undefined:n=r==null?void 0:r.readable_fields();break}return[{display:"email",value:"email",documentation_id:"Documentation.Data.Messages.User.email"},...(t=n)!=null?t:[],{display:"Stripe Customer ID",value:"StripeCustomerId"},{display:"email confirmed",value:"email_confirmed",documentation_id:"Documentation.Data.Messages.User.email_confirmed"},{value:"password",display:"password"},{display:"Any field",value:p.ALL_DB_FIELDS,documentation_id:"Documentation.Data.SearchOperator.AnyField"},{display:"unique id",value:p.UNIQUE_ID,documentation_id:"Documentation.Data.Messages.CustomType._id"},{display:"Change which field...",value:p.DYNAMIC_SORTING_FIELD,documentation_id:"Documentation.Data.SearchOperator.sort_field.use_dynamic_sort_field"},{display:"Random sorting",value:p.RANDOM_SORTING}]})).filter((e=>{var t;return(t=i[e.value])!=null?t:true}));if(e.field_kind!=="writeable"||e.disable_accelerator===true||r==null||r.not_writeable){return a}else{return a.with_options({new_option_accelerator:{display:"Create a new field...",hide_dropdown:true,onClick:e=>u.default.or_throw().visual_edit.show_create_new_field_modal({div:$(""),cb:function(){if((arguments.length<=0?undefined:arguments[0])==null){e(true,arguments.length<=1?undefined:arguments[1])}},custom_type:r,is_message:false})}})}}function U(e){const t=s.DropdownContents.no_sections((()=>_.default.element(e).element_custom_states().map((e=>({display:e.display(),value:e.name(),delete_fn:()=>{u.default.or_throw().visual_edit.show_confirm_delete_state_modal({custom_state:e})}}))))).sort(((e,t)=>e.display<t.display?-1:1));if(_.default.element(e).type()==="CustomElement"){return t.with_options({new_option_accelerator:{display:"Go to the Reusable Element to add a custom state",hide_dropdown:true,onClick:()=>{void(0,f.run_once)(30,(()=>(0,h.custom_id_to_name)(_.default.element(e).get_static_property("custom_id"))),((e,t)=>{window.change_to_custom(t!=null?t:"");$(m.VISUAL_TAB).click()}))}}})}else{return t.with_options({new_option_accelerator:{display:"Create a new custom state...",hide_dropdown:true,documentation_id:"Documentation.Elements.GeneralConcepts.States.CustomStates",onClick:t=>u.default.or_throw().visual_edit.show_create_new_state_modal({div:$(""),cb:function(){if((arguments.length<=0?undefined:arguments[0])==null){t(true,arguments.length<=1?undefined:arguments[1])}},element:_.default.element(e),is_message:false})}})}}function F(e,t,n){const r=typeof e==="string"?(0,o.get)(e).option_set():e;return s.DropdownContents.multi_section((()=>({null_values:[{display:"(none)",value:null}],all_values:[{display:"All options",value:g.ALL_OPTIONS}],values:r.values().filter((e=>!e.deleted())).map((e=>({display:e.display(),value:e.name()})))})),{show_sections:false}).filter((e=>{if(e.value===null){return n!=null?n:false}else if(e.value===g.ALL_OPTIONS){return t!=null?t:false}else{return true}}))}const W=["interactions.get_mouse_data"];function G(){return s.DropdownContents.no_sections((()=>{var e;return Object.entries((e=(0,a.get_api_calls)())!=null?e:{}).filter((e=>{let[t]=e;return!W.includes(t)})).map((e=>{let[t,n]=e;return{display:n.display(),value:t}}))}),{new_option_accelerator:{display:"Add more APIs...",hide_dropdown:true,onClick:()=>{var e;(e=x)==null?void 0:e({types:["api"]})}}})}function V(){return s.DropdownContents.no_sections((()=>{var e;return Object.values((e=(0,v.get_app_plugins)())!=null?e:{}).flatMap((e=>{var t;return((t=e==null?void 0:e.get_oauth_providers())!=null?t:[]).map((t=>{if(typeof t==="string"){return{display:e.display(),value:t}}else if(t.id!=null&&t.display!=null){return{display:t.display,value:t.id}}else{return null}})).filter((e=>e!=null))}))}),{new_option_accelerator:{display:"Add more login services...",hide_dropdown:true,onClick:()=>{var e;(e=x)==null?void 0:e({types:["login service"]})}}}).sort(s.sort_by_display)}function H(){return s.DropdownContents.no_sections((()=>[{display:"Bubble Storage",value:"bubble"},...(0,v.get_app_plugins)().filter((e=>e==null?void 0:e.is_storage_provider())).map((e=>({display:e.display(),value:e.name})))]))}},{"../constants/option_sets":77,"../constants/special_keys":87,"../editor/components/design/popup/InputPopup":510,"../editor/composer/utilities/dropdown_contents":556,"../editor/css":560,"../lib":741,"../safe_require":777,"../services":780,"../services/shared/plugin_getter":783,"../u/shared/async/autorun":830,"../u/shared/mode_check":851,"./application":650,"./appquery":651,"./btype_ids":652,"./btypes":653,"./missing_btype":717,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],655:[function(e,t,n){"use strict";const r=n;const i=e("../logger");class s{constructor(){this.items={}}get(e){return this.items[e]}add(e,t){if(e in this.items){i.warn("Adding duplicate btype definition",{name:e})}this.items[e]=t}keys(){return Object.keys(this.items)}values(){return Object.values(this.items)}entries(){return Object.entries(this.items)}}r.plugins=new s;r.providers=new s},{"../logger":744}],656:[function(e,t,n){"use strict";const r=n;const i=e("../u");const s=e("../lib");r.RUN_MODE="run";r.ALL_MODES="all";r.AUTORUN="autorun";r.cached=function(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const{type:t,parameters:n=0,...s}=e;if(t===r.AUTORUN){return a(s)}else if(t===r.ALL_MODES){return o(r.all_cache)}else if(t===r.RUN_MODE){if(n===0){return o(r.run_cache)}else if(n===1){return o(r.run_cache_1_param)}}throw new i.UnexpectedError("Unsupported cache options",{type:t,parameters:n})};r.standalone=function(e,t){var n;const i=(n=t.name)!=null?n:"fn";const s={[i]:t};const o=Object.getOwnPropertyDescriptor(s,i);const a=r.cached(e);const l={[i]:a(s,i,o).value};return l[i].bind(l)};function o(e){return function(t,n,r){return{...r,value:e(n,r.value)}}}function a(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return(t,n,r)=>({...r,value:i.autorun_cache(i.extend({},{fn:r.value},e))})}r.run_cache=function(e,t){if(i.on_client()&&!i.is_edit_mode()){return function(){const n=t.call(this);this[e]=()=>n;return n}}else{return t}};r.run_cache_1_param=function(e,t){if(!i.on_client()){return t}return function(n){const r=e+"_run_cache_1_param";if(!this[r]){if(!s().is_edit_mode()){const e={};this[r]=function(n){var r;(r=e[n])!=null?r:e[n]=t.call(this,n);return e[n]}}else{this[r]=t}}return this[r](n)}};r.all_cache=function(e,t){return function(){const n=t.call(this);this[e]=()=>n;return n}}},{"../lib":741,"../u":823}],657:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.add_user_color_token=b;n.color_property_to_rgba=v;n.default_color_tokens_to_property=w;n.delete_user_color_token=y;n.is_user_color_token=h;n.token_variant_to_properties=m;n.user_color_tokens_to_property=x;n.variable_to_token_variant=f;e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");var r=e("../constants/colors");var i=e("../constants/tokens");var s=e("../u/client/color");var o=_(e("../safe_require"));var a=_(e("./appquery"));var l=p(e("./../client/analytics"));var c=e("./../constants/segment_events");var u=e("../u/shared/b_object");function d(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(d=function(e){return e?n:t})(e)}function p(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=d(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function _(e){return e&&e.__esModule?e:{default:e}}o.default.safe_register("./lang/color_tokens",n);function f(e){if(e!=null&&e.includes(r.VAR_IDENTIFIER)){var t;const n=(t=e.match(r.TOKEN_NAME))==null?void 0:t[1];if(!n)return null;const i=r.COLOR_VARIANTS.find((e=>{if(n.includes(e)){return true}return false}));if(!i)return null;const s=n.replace(`_${i}`,"");const o=s.replace(r.RGB_VAR_IDENTIFIER,"");return{variant:i,token_set:o}}return null}function h(e){return!r.SORTED_DEFAULT_TOKENS.includes(e)}function m(e,t){var n,s;const o=(n=a.default.get_public_setting("color_tokens"))!=null?n:r.DEFAULT_COLOR_TOKENS;const l=(s=a.default.get_public_setting("color_tokens_user"))!=null?s:(0,u.json_deep_copy)(i.DEFAULT_USER_TOKENS);if(!h(e)){return{name:r.DEFAULT_TOKEN_NAMES_DESCRIPTIONS[e].name,description:r.DEFAULT_TOKEN_NAMES_DESCRIPTIONS[e].description,rgba:o[e][t],deleted:false}}else{var c;const n=(c=l[t][e])!=null?c:{name:r.MISSING_USER_COLOR_TOKEN_TEXT,description:r.MISSING_USER_COLOR_TOKEN_TEXT,rgba:r.DEFAULT_USER_COLOR_TOKEN_RGBA,deleted:false};return{name:n.name,description:n.description,rgba:n.rgba,deleted:n.deleted}}}function g(e,t){if(t==null){return e}const n=e==null?void 0:e.match(r.CAPTURE_ALPHA);if(n!=null){return`rgba(${n.groups.base},${t})`}else{return`rgba(${e},${t})`}}function v(e){var t,n,s,o,l;const c=f(e);if(c==null)return e;const d=(t=e.match(r.CAPTURE_ALPHA))==null?void 0:(n=t.groups)==null?void 0:n.opacity;const p=(s=a.default.get_public_setting("color_tokens"))!=null?s:r.DEFAULT_COLOR_TOKENS;if((o=p[c.token_set])!=null&&o[c.variant]){var _;return g((_=p[c.token_set])==null?void 0:_[c.variant],d)}const h=(l=a.default.get_public_setting("color_tokens_user"))!=null?l:(0,u.json_deep_copy)(i.DEFAULT_USER_TOKENS);return g(h[c.variant][c.token_set].rgba,d)}function b(e,t){var n;let s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"default";const o=(n=a.default.get_public_setting("color_tokens_user"))!=null?n:(0,u.json_deep_copy)(i.DEFAULT_USER_TOKENS);const d=a.default.uid();o[s][d]={rgba:r.DEFAULT_USER_COLOR_TOKEN_RGBA,name:e,description:t,order:Object.keys(o[s]).length,deleted:false};l.track(c.STYLES_VARIABLE_CREATED,{app:a.default.appname(),token:d,variant:s,name:e,description:t,type:"Color"});a.default.set_setting(true,"color_tokens_user",o);a.default.commit()}function y(e,t){var n;const r=(n=a.default.get_public_setting("color_tokens_user"))!=null?n:(0,u.json_deep_copy)(i.DEFAULT_USER_TOKENS);const s=r[e][t].order;for(const t in r[e]){if(r[e][t].order>s){r[e][t].order-=1}}l.track(c.STYLES_VARIABLE_DELETED,{app:a.default.appname(),token:t,variant:e,name:r[e][t].name,description:r[e][t].description,type:"Color"});r[e][t].deleted=true;r[e][t].name+=i.DELETED_USER_TOKEN_STRING;a.default.set_setting(true,"color_tokens_user",r);a.default.commit()}function w(){var e;const t=(e=a.default.get_public_setting("color_tokens"))!=null?e:r.DEFAULT_COLOR_TOKENS;const n={};for(const e in t){for(const o of r.COLOR_VARIANTS){var i;n[`--color_${e}_${o}`]=t[e][o];const r=(i=(0,s.rgba_to_array)(t[e][o]))==null?void 0:i.slice(0,-1).toString();n[`--color_${e}_${o}_rgb`]=r!=null?r:""}}return n}function x(){var e;const t=(e=a.default.get_public_setting("color_tokens_user"))!=null?e:(0,u.json_deep_copy)(i.DEFAULT_USER_TOKENS);const n={};for(const e in t){for(const i in t[e]){var r;if(!t[e][i].rgba){continue}n[`--color_${i}_${e}`]=t[e][i].rgba;const o=(r=(0,s.rgba_to_array)(t[e][i].rgba))==null?void 0:r.slice(0,-1).toString();n[`--color_${i}_${e}_rgb`]=o!=null?o:""}}return n}},{"../constants/colors":53,"../constants/tokens":93,"../safe_require":777,"../u/client/color":817,"../u/shared/b_object":839,"./../client/analytics":20,"./../constants/segment_events":85,"./appquery":651,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],658:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;r.consolidate=function(e){var t;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};(t=n.prefer_roots)!=null?t:n.prefer_roots=false;if(e.length===0){return e}const r=new Map;const i=new Set;for(const t of e){let e=r;for(const n of t.split(".")){if(!e.has(n)){e.set(n,new Map)}e=e.get(n)}i.add(e)}const s=[];function o(e,t,r){const a=r.startsWith("api")?t+1:t;if(i.has(e)||a===2&&e.size>0&&n.prefer_roots||a===2&&e.size>4||a>2&&e.size>1){s.push(r)}else{e.forEach(((e,n)=>o(e,t+1,r===""?n:r+"."+n)))}}o(r,0,"");return s}},{"core-js/modules/web.dom-collections.iterator.js":1123}],659:[function(e,t,n){"use strict";const r=n;const i=e("../../u/shared/uuid");const s=e("../../u/shared/async/b_async");const o=e("../../core/core_datasources/utilities/core_ds_workflow_utilities");const a=e("../evaluation/page_state");const l=e("../evaluation/FrozenState");r.serialize_context=c;function c(e,t){e={...e};e.duplicated_from_context=e.object_id;e.object_id=i.UUID();e.duplicated_at="context_serializer.serialize_context";if(!e.frozen_state){e.frozen_state=new l(e)}let n;if(t!=null){n=e.frozen_state.freeze_node(t)}else{n=s.Promise()}return n.then((()=>{var t;return{client_state:e.frozen_state.get_client_state(),element_id:(t=e.element)==null?void 0:t.element_id(),uid_generator:e.uid_generator,random_seed:e.random_seed,current_date_time:a.get_page_data("Current Date/Time",e).getTime(),timezone_offset:(new Date).getTimezoneOffset(),timezone_string:d().current_timezone(),inputs_must_be_valid:e.inputs_must_be_valid,advanced_search:e.advanced_search,constraint_messsage:e.constraint_messsage,current_wf_params:o.dehydrate_wf_params(e,(e=>u.dehydrate_tree(e)))}}))}const u=e("../../db/hydrate");const d=e("../../lib")},{"../../core/core_datasources/utilities/core_ds_workflow_utilities":236,"../../db/hydrate":429,"../../lib":741,"../../u/shared/async/b_async":832,"../../u/shared/uuid":855,"../evaluation/FrozenState":687,"../evaluation/page_state":698}],660:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.action_types=k;n.app_languages=w;n.app_texts=x;n.custom_definitions=v;n.custom_events=b;n.custom_events_from_reusable=y;n.element_types=A;n.event_types=E;n.filter_custom_events=M;n.filter_element_types=j;n.page_events_by_type=O;n.pages=void 0;n.styles=S;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../core/core_elements/core_elements_utilities/element_registry");var i=e("../../editor/composer/utilities/dropdown_contents");var s=h(e("../plugins"));var o=e("../../languages");var a=h(e("../../lib"));var l=h(e("../application"));var c=h(e("../appquery"));var u=f(e("../../editor/add_plugin"));var d=e("../../core/core_events");var p=e("../../core/core_actions");function _(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(_=function(e){return e?n:t})(e)}function f(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=_(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function h(e){return e&&e.__esModule?e:{default:e}}function m(e,t){return e.display<t.display?-1:1}const g=e=>{const t=l.default.get_sorted_list_of_pages({skip_builtin:e});return i.DropdownContents.no_sections((()=>t.map((e=>({display:e,value:l.default.page_name_to_id(e)})))),{new_option_accelerator:{display:"Create a new page...",hide_dropdown:true,onClick:e=>{window.make_new_page({current_page_to_clone_id:undefined,existing_raw:undefined,cb(t){if(t){const n=l.default.page_name_to_id(t);e(true,n)}else{e(false)}}})}}})};n.pages=g;function v(){return i.DropdownContents.no_sections((()=>l.default.get_sorted_list_of_custom_definitions().map((e=>{const t=l.default.custom_name_to_id(e);return{value:t,display:e,documentation_id:t}}))))}function b(e){let t;if(e!=null){t=()=>{var t,n;return((t=(n=e.root())==null?void 0:n.events("CustomEvent"))!=null?t:[]).filter((t=>t.id()!==e.event().id()))}}else{t=()=>c.default.find_events("CustomEvent")}return i.DropdownContents.no_sections((()=>t().map((e=>{var t;return{display:(t=e.get_static_property("event_name"))!=null?t:"(not yet named)",value:e.id()}}))))}function y(e,t){return i.DropdownContents.no_sections((()=>{var n,r,i;return((n=(r=c.default.custom_definition(t))==null?void 0:(i=r.events)==null?void 0:i.call(r,"CustomEvent"))!=null?n:[]).filter((t=>t.id()!==(e==null?void 0:e.event().id()))).map((e=>{var t;return{display:(t=e.get_static_property("event_name"))!=null?t:"(not yet named)",value:e.id()}}))}))}function w(){return i.DropdownContents.no_sections((()=>{var e;const t=(0,o.get_languages_data)();const n=(e=c.default.get_public_setting("text"))!=null?e:{};return Object.entries(t!=null?t:{}).filter((e=>{let[t,r]=e;return!r.deprecated||n[t]!=null})).map((e=>{let[t,n]=e;return{display:`${n.caption} (${t})`,value:t}}))}),{new_option_accelerator:{display:"Request another language...",hide_dropdown:true,onClick:()=>{const e="...";const t="mailto:support@bubble.io?subject=Adding a language to Bubble&body=Hi, I would like to use "+e+" in Bubble!";window.open(t)}}}).sort(m)}function x(){return i.DropdownContents.no_sections((()=>{const e=c.default.get_public_setting("user_text_ids");return Object.entries(e!=null?e:{}).map((e=>{let[t,n]=e;return{display:n===true?t:n,value:t,delete_fn:()=>(0,o.delete_user_text)(t)}}))}),{new_option_accelerator:{display:"Define another text...",hide_dropdown:true,onClick:e=>{a.default.or_throw().visual_edit.app_texts_input_panel((function(){if((arguments.length<=0?undefined:arguments[0])==null){e(true,arguments.length<=1?undefined:arguments[1])}}))}}}).sort(m)}function j(e){return["GroupWithFocus","Table","TableMainAxis","TableCrossAxis","TableCell"].includes(e.value)}function A(e,t){return i.DropdownContents.multi_section((()=>{const e=s.default.get_app_plugins_by_tags("element",t).map((e=>e.id));return(0,r.get_full_list_elements)().map(r.get_element_object).filter((n=>(t==null||n.category===t)&&(!n.is_plugin||n.is_plugin&&e.includes(n.service)))).map((e=>({display:(0,r.get_element_display)(e.plugin_name),value:e})))}),(e=>{switch(e.value.category){case"visual elements":return"Visual Elements";case"input forms":return"Input Forms";case"containers":return"Containers";default:return"Other"}}),{section_order:["Visual Elements","Input Forms","Containers","Other"],new_option_accelerator:e?{display:"Install more elements...",hide_dropdown:true,onClick(){u.show({types:["element"],categories:t?[t]:[]})}}:undefined}).sort(((e,t)=>e.value.list_order-t.value.list_order)).map((e=>({...e,value:e.value.plugin_name})))}function M(e){return e.value!=="CustomEvent"}function E(e){return i.DropdownContents.no_sections((()=>{const e=s.default.get_app_plugins_by_tags("event").map((e=>e.id));return Object.values((0,d.get_full_list_events)()).flatMap((t=>t.filter((e=>{let{type:t}=e;return t!=null})).map((e=>{let{type:t}=e;return(0,d.get_event_object)(t)})).filter((t=>t!=null&&(!t.is_plugin||t.is_plugin&&e.includes(t.service)))).map((e=>({display:e.display(undefined,true),value:e.type})))))}),{new_option_accelerator:e?{display:"Install more events...",hide_dropdown:true,onClick(){u.show({types:["event"]})}}:undefined})}function k(e){return i.DropdownContents.no_sections((()=>{const e=s.default.get_app_plugins_by_tags("action").map((e=>e.id));return Object.values((0,p.get_full_list_actions)()).flatMap((t=>{const n=new Set(t.map((e=>{let{type:t}=e;return t})));return Array.from(n.values()).map(p.get_action_object).filter((t=>t!=null&&(!t.is_plugin||t.is_plugin&&e.includes(t.service)))).map((e=>({display:e.display(),value:e.type})))}))}),{new_option_accelerator:e?{display:"Install more actions...",hide_dropdown:true,onClick(){u.show({types:["action"]})}}:undefined})}function O(e,t,n){return i.DropdownContents.no_sections((()=>{var r,i;let s=(r=(i=e.root())==null?void 0:i.events())!=null?r:[];if(a.default.or_throw().action_canvas!=null){s=a.default.or_throw().action_canvas.sort_workflows(s)}const o=e!=null&&e.is_api()?true:undefined;if(t!=null){s=s.filter((e=>e.type()===t))}return s.flatMap((e=>[{display:e.display(o),value:e.id()},...n?e.actions().map((e=>({display:`      ${e.display(o)}`,value:e.id()}))):[]]))}))}function S(e,t,n){return i.DropdownContents.no_sections((()=>{const t=c.default.styles().filter((t=>t.type()!=null&&e==null||t.type()===e));const n={};const i={};for(const e of t){n[e]=(0,r.get_element_display)(e.type());i[e]=e.display().toLowerCase()}function s(e,t){if(n[e]<n[t]){return-1}else if(n[e]>n[t]){return 1}if(i[e]<i[t]){return-1}else{return 1}}return t.sort(s).map((e=>({display:e.display(),value:e.name(),documentation_id:e.name()})))}),{new_option_accelerator:n?{display:"+ Create a new style...",hide_dropdown:true,onClick:n=>a.default.or_throw().visual_edit.show_create_new_style_modal({div:$(""),cb:function(){if((arguments.length<=0?undefined:arguments[0])==null){n(true,arguments.length<=1?undefined:arguments[1])}},element_type:e,element_id:t})}:undefined})}},{"../../core/core_actions":162,"../../core/core_elements/core_elements_utilities/element_registry":284,"../../core/core_events":377,"../../editor/add_plugin":489,"../../editor/composer/utilities/dropdown_contents":556,"../../languages":739,"../../lib":741,"../application":650,"../appquery":651,"../plugins":726,"core-js/modules/web.dom-collections.iterator.js":1123}],661:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.page_elements=d;n.page_elements_by_type=p;n.page_instances=f;n.parent_elements=h;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../editor/composer/utilities/dropdown_contents");var i=u(e("../../core/core_datasources/utilities/core_ds_composer_utilities"));var s=u(e("../lang"));var o=u(e("../workflow/WorkflowObject"));var a=e("../../u/shared/sorting");var l=e("../../core/core_elements/core_elements_utilities/element_registry");var c=u(e("../appquery"));function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t,n,i){const s=t!=null?t:"Element";function o(t){const r=y(t);let s=r.flatMap((t=>b(e,t,i)));if(n){s=[e.root()].concat(s)}return s}return r.DropdownContents.no_sections((()=>{const e=o(s);return e.map(m).sort(g)}))}function p(e,t,n,i){const s=t!=null?t:"Element";const o=n!=null?n:false;const a=i!=null?i:["Self","CustomDefinition","CustomElement","Popup","Group","GroupWithFocus","FloatingGroup","RepeatingGroup","HTML","Shape","Image","Text","Icon","Button","Link"];return r.DropdownContents.multi_section((()=>{const t={};const n=y(s);for(const e of n){t[e]=[]}const r=b(e);for(const e of r){var i,a;const n=e.type();if(n in t){t[n].push(e)}else if("Popup"in t&&n==="CustomElement"&&(i=(a=e.E).is_popup)!=null&&i.call(a)){t.Popup.push(e)}}if(o&&e!=null){t.Self=[e.root()]}const l=Object.entries(t).map((e=>{let[t,n]=e;return[t,n.map(m).sort(g)]}));return Object.fromEntries(l)}),{section_order:a})}const _={};function f(e){function t(e){var t,n;if(!e){return}(n=_[t=e.element_id()])!=null?n:_[t]=e.element.get_name();let r=_[e.element_id()];if(!e.is_visible()){r+=" (invisible)"}return r}return r.DropdownContents.no_sections((()=>{let n=[];const r=e=>{for(const s of(i=e.children)!=null?i:[]){var i;const e=t(s);if(e){n.push({value:s,display:e})}r(s)}};r(e);n=n.sort(g);n=[{value:e,display:t(e)}].concat(n);return n}))}function h(e){return r.DropdownContents.multi_section((()=>{const t={Parents:[],Children:[]};let n=e==null?void 0:e.parent();while(n){t.Parents.push(m(n));n=n.parent()}const r=[];for(const t of(i=e==null?void 0:e.elements())!=null?i:[]){var i;r.push(t)}r.sort(v);for(const e of r){t.Children.push(m(e))}return t}))}function m(e){var t,n;return{value:e.id(),display:(t=(n=c.default.element(e.id()))==null?void 0:n.get_name())!=null?t:"this element",documentation_id:e.id()}}const g=(0,a.create_sort_function)((e=>{var t;return(t=e.display)==null?void 0:t.toLowerCase()}));const v=(0,a.create_sort_function)((e=>e.get_top()));function b(e,t,n,r){if(n===true||e instanceof o.default&&e.is_action()){const o=n?e:e.context_element();let a=i.default.get_visible_elements(o,t);if(r){i.default.sort_elements_by_type(a)}if(t!=null){a=s.default.filter_array(t,a)}if(o&&"is"in o&&typeof o.is==="function"&&o.is(t)&&!a.map((e=>e.id())).includes(o.id())){a.push(o)}return a}else{var a,l;if(t==="Element"){t=undefined}return(a=(l=e.root())==null?void 0:l.find_elements(t))!=null?a:s.default.enhance_array([])}}function y(e){let t;if(e==="Element"){t=Object.keys(l.elements_list).filter((e=>!["Page","GroupItem"].includes(e)))}else if(Array.isArray(e)){t=e}else{t=[e]}return t}},{"../../core/core_datasources/utilities/core_ds_composer_utilities":231,"../../core/core_elements/core_elements_utilities/element_registry":284,"../../editor/composer/utilities/dropdown_contents":556,"../../u/shared/sorting":853,"../appquery":651,"../lang":714,"../workflow/WorkflowObject":736,"core-js/modules/web.dom-collections.iterator.js":1123}],662:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.page_folders=c;n.wf_folders=l;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../editor/composer/utilities/dropdown_contents");var i=a(e("../appquery"));var s=e("../../u");var o=a(e("../../lib"));function a(e){return e&&e.__esModule?e:{default:e}}function l(e){const t=o.default.or_throw().visual_edit.wf_folders_add_new()[0];return r.DropdownContents.no_sections((()=>{var t;return Object.entries((t=e==null?void 0:e.get_static_property("wf_folder_list"))!=null?t:{}).map((e=>{let[t,n]=e;return{display:n===true?(0,s.toTitleCase)(t):n,value:t}}))}),{new_option_accelerator:{display:t.display,hide_dropdown:t.hide_dropdown,onClick:e=>{t.fn($(""),"",(function(){if((arguments.length<=0?undefined:arguments[0])==null){e(true,arguments.length<=1?undefined:arguments[1])}}))}}})}function c(){const e=o.default.or_throw().visual_edit.page_folders_add_new()[0];return r.DropdownContents.no_sections((()=>{var e;return Object.entries((e=i.default.get_public_setting("page_folders"))!=null?e:{}).map((e=>{let[t,n]=e;return{value:t,display:n,delete_fn:()=>i.default.set_setting(true,`page_folders.${t}`,null)}}))}),{new_option_accelerator:{display:e.display,hide_dropdown:e.hide_dropdown,onClick:t=>{e.fn($(""),"",(function(){if((arguments.length<=0?undefined:arguments[0])==null){t(true,arguments.length<=1?undefined:arguments[1])}}))}}})}},{"../../editor/composer/utilities/dropdown_contents":556,"../../lib":741,"../../u":823,"../appquery":651,"core-js/modules/web.dom-collections.iterator.js":1123}],663:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.font_families=p;n.font_weights=_;n.fonts=d;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var r=e("../../constants/fonts");var i=e("../../editor/composer/utilities/dropdown_contents");var s=u(e("../appquery"));var o=e("../../webfonts");var a=e("../../u/shared/b_object");var l=e("../../constants/tokens");var c=e("../tokens");function u(e){return e&&e.__esModule?e:{default:e}}function d(){return i.DropdownContents.no_sections((()=>{var e;return[...Object.keys((e=s.default.get_public_setting("fonts"))!=null?e:{}).map((e=>({display:e,value:e+r.CUSTOM_FONT_FLAG,font_family:e}))),...(0,o.get_font_list)().map((e=>({display:(0,o.pretty_font)(e),value:e,font_family:e})))]}),{ignore_type_check:true})}function p(){return i.DropdownContents.multi_section((()=>{var e,t,n;const i=(e=s.default.get_public_setting("font_tokens"))!=null?e:r.DEFAULT_TOKENS;const u=(t=s.default.get_public_setting("font_tokens_user"))!=null?t:(0,a.json_deep_copy)(l.DEFAULT_USER_TOKENS);return{Tokens:Object.keys(i).map((e=>({display:`${r.TOKEN_NAMES[e]} (${i[e].replace(r.CUSTOM_FONT_FLAG,"")})`,value:`var(--font_${e})`,font_family:`var(--font_${e})`}))),"User Tokens":Object.keys(u).flatMap((e=>(0,c.sorted_user_tokens)(u[e]).filter((t=>!u[e][t].font_family)).map((t=>{const n=u[e][t];return{display:`${n.name} (${n.font_family.replace(r.CUSTOM_FONT_FLAG,"")})`,value:`var(--font_${t}_${e})`,font_family:`var(--font_${t}_${e})`}})))),Families:[...Object.keys((n=s.default.get_public_setting("fonts"))!=null?n:{}).map((e=>({display:e,value:e+r.CUSTOM_FONT_FLAG,font_family:e}))),...(0,o.get_font_families)().map((e=>({display:(0,o.pretty_font)(e),value:e,font_family:e})))]}}),{ignore_type_check:true,show_sections:true,section_classes:{Tokens:["sticky"]},virtualize:true,overscan_count:50})}function _(){return i.DropdownContents.no_sections((()=>r.ALL_WEIGHTS.map((e=>{var t;return{display:(t=r.SPECIAL_DISPLAY[e])!=null?t:e,value:e}}))),{ignore_type_check:true})}},{"../../constants/fonts":68,"../../constants/tokens":93,"../../editor/composer/utilities/dropdown_contents":556,"../../u/shared/b_object":839,"../../webfonts":858,"../appquery":651,"../tokens":730,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],664:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.get_set=m;var r=e("../../constants/composer");var i=e("../../constants/special_keys");var s=e("../../editor/composer/ExpressionComposer/MessageContents");var o=e("../../editor/composer/utilities/dropdown_contents");var a=e("../../u");var l=e("../btypes");var c=e("../btypes_dropdowns");var u=e("./app_nodes");var d=e("./elements");var p=e("./folders");var _=e("./fonts");var f=e("./operators");const h={Pages:e=>{var t,n;return(0,u.pages)((t=e==null?void 0:e.skip_builtin)!=null?t:false).add_items([o.SINGLE_SECTION,(n=e==null?void 0:e.add_pages)!=null?n:[]])},CustomDefinitions:u.custom_definitions,CustomEvents:u.custom_events,CustomEventsFromReusable:u.custom_events_from_reusable,AppLanguages:u.app_languages,AppTexts:u.app_texts,ElementTypes:(e,t,n)=>{const r=(0,u.element_types)(!t,e);if(n){return r}else{return r.filter(u.filter_element_types)}},EventTypes:(e,t)=>{const n=(0,u.event_types)(!e);if(t){return n.filter(u.filter_custom_events)}else{return n}},ActionTypes:e=>(0,u.action_types)(!e),PageEventsByType:u.page_events_by_type,Styles:(e,t,n)=>(0,u.styles)(e,t,!n),DisplayableInListValues:(e,t,n)=>{const r=(0,c.filters)();const i=(0,c.displayableInListBtypes)().filter((n=>{let i=true;if(!e){i&&(i=r.no_primitives(n));i&&(i=r.no_data_types(n))}if(t){i&&(i=r.no_plugins(n))}return i}));if(n!=null){return i.add_items(["Basic",n.map((e=>({display:(0,l.get)(e).display(),value:e})))])}else{return i}},AllowableValues:(e,t,n)=>{const r=(0,c.filters)();return(0,c.displayableInListBtypes)().filter((i=>{let s=true;if(e){s&&(s=r.no_api(i));s&&(s=r.no_data_types(i))}if(t){s&&(s=r.no_plugins(i))}return s&&!n.includes(i.value)}))},ExcludeOptionValues:(e,t,n)=>h.AllowableValues(e,t,n).filter((0,c.filters)().no_option_sets),CustomFields:e=>{var t;const n=typeof e.btype_name==="string"?e.btype_name:(t=e.btype_name)==null?void 0:t.id();const r=(0,l.get)(n).custom_type();return(0,c.custom_fields)({...e,field_kind:e.public_searchable?e.include_not_builtins?"public_searchable":"builtins":e.writeable?"writeable":"readable",disable_accelerator:e.not_add_new}).filter((t=>{var n,i,s;return r!=null||!((n=e.btypes_to_filter_out)!=null&&n.includes(t.value))&&((i=(s=e.white_list_btypes)==null?void 0:s.includes(t.value))!=null?i:true)}))},CustomStates:c.custom_states,ObjectValues:()=>(0,c.allowableBtypes)().filter((0,c.filters)().no_option_sets).filter((0,c.filters)().no_primitives),CustomTypes:(e,t)=>(0,c.allowableBtypes)().filter((t=>(0,c.filters)().no_option_sets(t)&&(0,c.filters)().no_primitives(t)&&(0,c.filters)().no_api(t)&&e===true||t.value!=="user")).with_options({new_option_accelerator:t?(0,c.customTypeAccelerator)():undefined}),OptionSets:e=>(0,c.allowableBtypes)().filter((e=>(0,c.filters)().no_primitives(e)&&(0,c.filters)().no_api(e)&&(0,c.filters)().no_data_types(e))).with_options({new_option_accelerator:e?(0,c.customTypeAccelerator)():undefined}),OptionValues:c.option_values,APIList:c.api_list,OauthProviders:c.oauth_providers,FileStorageProviders:c.file_storage_providers,MessagesForType:e=>(0,s.allMessages)((0,l.get)(e)).map((e=>({...e,value:e.value.name()}))),MessagesWithoutArguments:e=>{var t;const n=typeof e.btype_name==="string"?e.btype_name:(t=e.btype_name)==null?void 0:t.id();return(0,s.allMessages)((0,l.get)(n)).map((e=>({...e,value:e.value.name()}))).filter((t=>{var n,r,i;return!((n=e.btypes_to_filter_out)!=null&&n.includes(t.value))&&((r=(i=e.white_list_btypes)==null?void 0:i.includes(t.value))!=null?r:true)})).add_items(["Advanced",[{display:"Advanced...",value:i.ADVANCED_SEARCH_CONSTRAINT,documentation_id:"Documentation.Data.SearchOperator.AdvancedFilter"},{display:"Change which field...",value:i.DYNAMIC_SORTING_FIELD,documentation_id:"Documentation.Data.SearchOperator.sort_field.use_dynamic_sort_field"},{display:"Random sorting",value:i.RANDOM_SORTING}].filter((t=>{switch(t.value){case i.ADVANCED_SEARCH_CONSTRAINT:return e.add_advanced;case i.DYNAMIC_SORTING_FIELD:return e.show_dynamic_sort_option;case i.RANDOM_SORTING:return e.show_random_sort_option;default:return false}}))])},Numeric:e=>o.DropdownContents.fromList(e,{input_type:r.COMPOSER_INPUT_TYPES.NUMBER}),Integer:(e,t,n)=>{const i=o.DropdownContents.fromList(e,{input_type:r.COMPOSER_INPUT_TYPES.INTEGER});const s=n==null?void 0:n.display_formatting_fn;if(s!=null){return i.map((e=>({...e,display:s(e.value)})))}else{return i}},Filtered:(e,t)=>{const n=e.filter((e=>e.value==null||t(e)));return n.with_options({get new_option_accelerator(){const t=e.get_new_option_accelerator();if(t)return t;if(n.all().length!==0)return undefined;return{display:"No available option...",onClick:()=>{}}}})},Object:(e,t)=>o.DropdownContents.fromObject(e,{input_type:t!=null?t:r.COMPOSER_INPUT_TYPES.REAL_TIME_SEARCH}),List:(e,t,n)=>{const i=o.DropdownContents.no_sections((()=>e.map((e=>({display:n?e:(0,a.FirstLetterCapitalize)(e),value:e})))),{input_type:t!=null?t:r.COMPOSER_INPUT_TYPES.REAL_TIME_SEARCH});if(t===r.COMPOSER_INPUT_TYPES.TEXT){return i.with_options({get_display_for_literal:e=>{if(typeof e==="string"){return e}else{return null}},get_value_for_literal:e=>e})}else{return i}},FromOptionsList:e=>o.DropdownContents.no_sections((()=>e.map((e=>({display:e.display,delete_fn:e.delete_cb,disabled:e.disabled,caption:e.caption,documentation_id:e.thumbnail_id,value:e.value}))))),Fonts:_.fonts,FontFamilies:function(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!e){return(0,_.font_families)().filter((e=>e.value.startsWith("var(")))}else{return(0,_.font_families)()}},FontWeights:_.font_weights,SearchOperators:f.search_operators,ChangeActions:f.change_actions,EditorOnly:()=>o.DropdownContents.empty(),NullSet:()=>o.DropdownContents.empty(),WFFolders:p.wf_folders,PageFolders:p.page_folders,PageElements:d.page_elements,PageElementsByType:(e,t,n,r,i)=>(0,d.page_elements_by_type)(e,t,n,r),PageInstances:d.page_instances,ParentElements:d.parent_elements,APIReturnTypes:f.api_return_types};function m(e){if(e in h){return h[e]}throw new a.UnexpectedError("Trying to get an unimplemented DropdownContents")}},{"../../constants/composer":54,"../../constants/special_keys":87,"../../editor/composer/ExpressionComposer/MessageContents":521,"../../editor/composer/utilities/dropdown_contents":556,"../../u":823,"../btypes":653,"../btypes_dropdowns":654,"./app_nodes":660,"./elements":661,"./folders":662,"./fonts":663,"./operators":665}],665:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.api_return_types=p;n.change_actions=d;n.search_operators=u;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../../editor/composer/utilities/dropdown_contents");var i=e("../../constants/special_keys");var s=e("../../constants/apiworkflow");const o={contains:"contains","not contains":"doesn't contain",equals:"=","not equal":"<>","greater than":">",gte:"","less than":"<",lte:"","text contains string":"contains","not text contains string":"doesn't contain","text contains":"contains keyword(s)","not text contains":"doesn't contain keyword(s)",empty:"is empty","not empty":"isn't empty",in:"is in","not in":"isn't in",is_empty:"is empty",is_not_empty:"isn't empty",contains_all_fields:"contains",advanced_search_constraint:"Advanced: ",email_equals:"=",email_contains_string:"contains",geographic_search:"is within",range_contains:" contains range ",range_contains_point:" contains (point) ",range_contained_by:" is contained by ",range_overlaps:" overlaps with ",range_greater_than:"is greater ",range_greater_than_point:" is greater (point) ",range_less_than:" is smaller ",range_less_than_point:" is smaller (point) "};const a={equals:[i.UNIQUE_ID,"StripeCustomerID"],"not equal":[i.UNIQUE_ID,"StripeCustomerID"],contains_all_fields:[i.ALL_DB_FIELDS],advanced_search_constraint:[i.ADVANCED_SEARCH_CONSTRAINT],in:[i.UNIQUE_ID],"not in":[i.UNIQUE_ID],email_equals:["email"],email_contains_string:["email"]};const l={contains:e=>e.is_list(),"not contains":e=>e.is_list(),equals:e=>e.matches("user")||e.matches("custom*")||e.matches("boolean"),"not equal":e=>e.matches("user")||e.matches("custom*")||e.matches("boolean"),"greater than":e=>e.matches("text")||e.storable(),gte:e=>e.storable(),"less than":e=>e.matches("text")||e.storable(),lte:e=>e.storable(),"text contains string":e=>e.matches("text"),"not text contains string":e=>e.matches("text"),"text contains":e=>e.matches("text"),"not text contains":e=>e.matches("text"),empty:e=>e.is_list(),"not empty":e=>e.is_list(),in:e=>e.matches("user")||e.matches("custom*")||e.matches("boolean")||e.matches("text")||e.storable(),"not in":e=>e.matches("user")||e.matches("custom*")||e.matches("boolean")||e.matches("text")||e.storable(),is_empty:e=>["geographic_address","number_range","date_range"].includes(e.id()),is_not_empty:e=>["geographic_address","number_range","date_range"].includes(e.id()),contains_all_fields:()=>false,advanced_search_constraint:()=>false,email_equals:()=>false,email_contains_string:()=>false,geographic_search:e=>e.id()==="geographic_address",range_contains:e=>["number_range","date_range"].includes(e.id()),range_contains_point:e=>["number_range","date_range"].includes(e.id()),range_contained_by:e=>["number_range","date_range"].includes(e.id()),range_overlaps:e=>["number_range","date_range"].includes(e.id()),range_greater_than:e=>["number_range","date_range"].includes(e.id()),range_greater_than_point:e=>["number_range","date_range"].includes(e.id()),range_less_than:e=>["number_range","date_range"].includes(e.id()),range_less_than_point:e=>["number_range","date_range"].includes(e.id())};const c={"text contains string":"text","not text contains string":"text","text contains":"text","not text contains":"text",contains:"list","not contains":"list",empty:"list","not empty":"list",contains_all_fields:"any data field",email_equals:"email",email_contains_string:"email",geographic_search:"geographic search",range_contains:"range",range_contains_point:"range",range_contained_by:"range",range_overlaps:"range",range_greater_than:"range",range_greater_than_point:"range",range_less_than:"range",range_less_than_point:"range"};function u(e,t){return r.DropdownContents.no_sections((()=>{const n=e==null;return Object.entries(o).map((e=>{let[t,r]=e;return{value:t,display:n&&c[t]!=null?`${r} (${c[t]})`:r,documentation_id:t==="contains_all_fields"?"Documentation.Data.SearchOperator.AnyField":t==="advanced_search_constraint"?"Documentation.Data.SearchOperator.AnyField":undefined}})).filter((n=>{if(e==null){return t}if(typeof e==="string"){var r,i;return(r=(i=a[n.value])==null?void 0:i.includes(e))!=null?r:false}else{return l[n.value](e)}}))}))}function d(){return r.DropdownContents.fromObject({add:"add",remove:"remove",set_list:"set list",add_list:"add list",remove_list:"remove list",clear_list:"clear list"}).map((e=>({...e,documentation_id:`Documentation.actions.ChangeThing.changes.${e.value}`})))}function p(){return r.DropdownContents.multi_section((()=>({"Built-In":[{display:s.API_RETURN_TYPES_IDENTIFIERS.plain_text.caption,value:s.API_RETURN_TYPES_IDENTIFIERS.plain_text.value},{display:s.API_RETURN_TYPES_IDENTIFIERS.json.caption,value:s.API_RETURN_TYPES_IDENTIFIERS.json.value}],"User Defined":[{display:s.API_RETURN_TYPES_IDENTIFIERS.custom.caption,value:s.API_RETURN_TYPES_IDENTIFIERS.custom.value}]})))}},{"../../constants/apiworkflow":44,"../../constants/special_keys":87,"../../editor/composer/utilities/dropdown_contents":556,"core-js/modules/web.dom-collections.iterator.js":1123}],666:[function(e,t,n){"use strict";var r=i(e("./Root"));function i(e){return e&&e.__esModule?e:{default:e}}class s extends r.default{constructor(e){super(e,{_type:"CustomDefinition"})}is_custom_definition(){return true}is_page(){return false}is_api(){return false}element_type(){return this.get_static_property("element_type")}}t.exports=s},{"./Root":672}],667:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../../lib");const s=e("../nodes");const o=e("../missing_btype");const a=e("../btype_ids");const l=e("../application/CustomFieldState");t.exports=class e extends l{name(){return a.custom_type(this.json.name())}make_static(){return this.json.child("make_static").get()}parent(){return s.create(s.ELEMENT,this.json.parent().parent())}default_val(){if(this.is_list()){return[]}return super.default_val()}change_value(e,t,n){var s;t={value:(s=t)!=null?s:this.value(),display:e!=null?e:this.display(),default_val:n,make_static:this.make_static()};if(o.is_missing(t.value)){t.value=this.value()}const l={value:this.value(),display:this.display(),default_val:this.default_val(),make_static:this.make_static()};if(r.json_stringify(t)!==r.json_stringify(l)){const e=i().changes.create_change("ModifyCustomState",{element_id:this.parent().id(),name:a.custom_type_name(this.name()),old_value:l,value:t});e.execute();return this.commit()}}delete(){const e=i().changes.create_change("DeleteCustomState",{element_id:this.parent().id(),name:a.custom_type_name(this.name()),data:{value:this.value(),display:this.display()}});e.execute();return this.commit()}}},{"../../lib":741,"../../u":823,"../application/CustomFieldState":639,"../btype_ids":652,"../missing_btype":717,"../nodes":721}],668:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../../lib");const s=e("../../logger");const o=e("../../services/shared/plugin_getter");e("../../services/shared/plugin_registry");const a=e("../nodes");const l=e("./elements_utils");const c=e("./GenericElement");const u=/\./g;t.exports=class e extends c{constructor(e,t,n){super(e,t,n);this.maybe_register_issue_indexers();this.setup_autofixer()}maybe_register_issue_indexers(){if(!this.fake&&l._use_issue_checker()&&this.is_top_level()&&this.app().can_run_issue_checker()&&!this.issue_checker_registered){this.issue_checker_registered=true;this.json.register_indexer("issues_list",(()=>{if(i().visual_edit.allow_issue_indexer_runs()){const e=a.new_element(this.json);const t=e.id();if(!t){return}const n=i().apptests.check_issues(e);const s=["issues_list",t];return[s,r.json_stringify(n)]}}))}}setup_autofixer(){if(r.is_edit_mode()&&!this.fake&&this.E.autofix_issues!=null){queueMicrotask((()=>{let e=false;let t=null;t=r.autotop((()=>{var n;if(this.root()==null){var r;e=true;(r=t)==null?void 0:r.destroy();return}if(this.root().id()===((n=i().visual_edit.get_root())==null?void 0:n.id())){this.E.autofix_issues(this)}}));if(e){t.destroy()}}))}}can_animate(){if(this.E.can_animate){return this.E.can_animate(this)}else{return!(this.E.do_show||this.E.workflow_show)}}is_top_level(){var e;const t=this.json.path();return(t==null?void 0:(e=t.match(u))==null?void 0:e.length)===3}check_for_errors(e,t,n){var r,i;const s=(r=(i=this.E).check_for_errors)==null?void 0:r.call(i,this,e,t);if(s===true){return}const a=super.check_for_errors(e);const l=o.get_app_plugins().filter(Boolean).map((e=>e.name));if(this.E.is_plugin&&!l.includes(this.E.service)){const t=this.display();const n=o.get_plugin(this.E.service).display();e(`${t} - You're using this element but haven't installed the plugin ${n}`)}let c=this.events().concat(this.states(),a.children);if(!n){const e=this.elements();e.maybe_register_issue_indexers();c=c.concat(e)}return{children:c}}get_static_property(e,t){if(r.is_edit_mode()&&!t){if(!t){const t=this.field_names();if(!t){throw new r.UnexpectedError("missing field names for "+this._type)}const n=t[e];if(n&&!n.no_states){s.error("called get_static_property on a property that does not have no_states set",{name:e,type:this._type})}}}return super.get_static_property(e)}}},{"../../lib":741,"../../logger":744,"../../services/shared/plugin_getter":783,"../../services/shared/plugin_registry":784,"../../u":823,"../nodes":721,"./GenericElement":670,"./elements_utils":679}],669:[function(e,t,n){(function(n){(function(){"use strict";e("core-js/modules/web.immediate.js");e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=e("solid-js");var s=R(e("../../u/shared/decaf"));var o=I(e("../../logger"));var a=I(e("../../constants/eval"));var l=R(e("../caching"));var c=R(e("../../shared/responsive/responsive_layout"));var u=I(e("../../constants/elements"));var d=R(e("./elements_utils"));var p=I(e("./rendering_perf"));var _=I(e("../../u/client/resize_observer"));var f=R(e("lodash/debounce"));var h=R(e("../evaluation/FrozenState"));var m=R(e("../evaluation/page_state"));var g=I(e("../../renderer/drawstate"));var v=R(e("../../lib"));var b=R(e("../expressions"));var y=R(e("../../client_config"));var w=R(e("../appquery"));var x=R(e("../../db/hydrate"));var j=e("../../u/shared/loggable");var A=e("../../u/shared/async/autorun");var M=e("../../u/shared/async/dependency");var E=e("../../u/shared/errors");var k=e("../../u/shared/async/b_async");var O=I(e("../../u/shared/uuid"));var S=e("../../u/client/b_window");var D=e("../../renderer/RenderElement");var C,T,N;function P(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(P=function(e){return e?n:t})(e)}function I(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=P(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function R(e){return e&&e.__esModule?e:{default:e}}function L(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}var z=function(e){e["RUN"]="run";e["EDIT"]="edit";e["THUMBNAIL"]="thumbnail";e["RESPONSIVE"]="responsive";e["REUSABLE_EDIT"]="reusable_edit";return e}(z||{});const B=Object.values(z);const q={NONE:0,CONSTRUCTED:1<<0,REGISTERED:1<<1,HAS_SKELETON:1<<2,DRAWN:1<<3,CHILDREN_REGISTERED:1<<4,CHILDREN_DEFERRED:1<<5,CHILDREN_DRAWN:1<<6,SOLID_INITIALIZED:1<<7,CHILDREN_BEING_REGISTERED:1<<8};const U={};function F(e){if(U[e]==null){U[e]=0;return e}else{const t=e+"_"+String(U[e]);U[e]++;return t}}let W=(C=l.default.cached({type:l.default.RUN_MODE}),T=(N=class e{constructor(e,t){this.element=void 0;this.mode=void 0;this.status=void 0;this.canvas=void 0;this._parent=void 0;this.container=void 0;this.child_container=void 0;this.__to_string=void 0;this._destroy_fns=[];this._watchers={};this._created_watchers={};this._msg_handlers={};this._states={};this._has_been_hidden=null;this._has_become_visible=void 0;this._is_visible=null;this._is_visible_cbs=[];this._first_draw_cbs=[];this._is_drawing=false;this._is_visible_dependency=(0,M.Dependency)();this.repeating_layout_type=void 0;this.repeating_group_layout=void 0;this.table_element_layout=void 0;this.activeTimeouts=void 0;this._setting_visible=false;this._is_animating_me=false;this._instance_opacity=void 0;this._is_animating=false;this._is_animating_dependency=void 0;this.__is_visible_me=false;this._is_visible_me_dependency=void 0;this.evaluating_visibility=false;this._wait_for_visible_polls=0;this._destroy_started=void 0;this._id_namespace=void 0;this._our_children_registered=void 0;this._our_skeleton_ready=void 0;this._is_ready_key=void 0;this._our_children_drawn=void 0;this.__dimension_box_width=void 0;this.__dimension_box_height=void 0;this._sizing_setup=false;this._p_context=void 0;this._children=void 0;this.draw_signal=void 0;this._old_width=void 0;this._transforms=void 0;if(!B.includes(t)){throw new E.UnexpectedError("unrecognized: "+t)}this.element=e;this.mode=t;this.status=q.CONSTRUCTED;if(t!==z.RUN){this._children=[]}p.record_lifecycle(p.LifecycleEvent.Constructed);this.__to_string="ElementInstance:"+this.element.type();this._has_become_visible=(0,k.MakeKey)(undefined,"Become Visible Key");this._is_visible_me=(0,A.autorun_top)((()=>this.element.is_visible_on_page_load()));this.state("current_width",(e=>{e.setup_sizing();return e.state("current_width")}));this.state("current_height",(e=>{e.setup_sizing();return e.state("current_height")}))}_set_immediate(e){n(e)}_update_visible(){let e=true;if(!this.container){e=false}else if(!this._is_visible_me){e=false}else{const t=this.parent();if(t&&(!t._is_visible||t._setting_visible)){if(this.element.added_to_container()||this.element.type()==="GroupItem"){e=false}}if(this.element.type()==="TableCell"){const t=this.find_instance_by_id_no_retry(this.get_static_property("cell_main_axis_id"));if(t&&(!t._is_visible||t._setting_visible)){e=false}}}if(e!==this._is_visible){this._is_visible=e;this._setting_visible=true;const r=this._is_visible_cbs;this._is_visible_cbs=[];(0,A.autorun_top)((()=>{for(const e of r){e()}}));if(e){this._has_become_visible.turn()}this._setting_visible=false;for(const e of this.current_children){e._update_visible()}if(this.element.type()==="TableMainAxis"){var t,n;const e=(t=(n=this.parent())==null?void 0:n.children.filter((e=>e.element.type()==="TableCrossAxis")))!=null?t:[];for(const t of e){for(const e of t.children.flatMap((e=>{if(e.element.type()==="TableCell"){return[e]}else{return e.children}}))){if(e.get_static_property("cell_main_axis_id")===this.element_id()){e._update_visible()}}}}this._is_visible_dependency.invalidate()}}set_animating(e){if(this._is_animating_me!==e){this._is_animating_me=e;this._update_animating()}}_update_animating(){var e;const t=this._is_animating_me||((e=this.parent())==null?void 0:e._is_animating);if(this._is_animating!==t){var n;this._is_animating=!!t;for(const e of this.current_children){e._update_animating()}(n=this._is_animating_dependency)==null?void 0:n.invalidate()}}is_animating(e){if(!e){var t;(t=this._is_animating_dependency)!=null?t:this._is_animating_dependency=(0,M.Dependency)();this._is_animating_dependency.register()}return this._is_animating}set _is_visible_me(e){var t;this.__is_visible_me=e;(t=this._is_visible_me_dependency)==null?void 0:t.invalidate()}get _is_visible_me(){return this.__is_visible_me}is_visible_me(){var e;(e=this._is_visible_me_dependency)!=null?e:this._is_visible_me_dependency=(0,M.Dependency)();this._is_visible_me_dependency.register();return this._is_visible_me}is_visible(e){if(this.evaluating_visibility){const e=this.element.get_name(true);throw new E.OwnerError(`Recursion when evaluating visibility on element "${e}"`)}this._update_visible();if(!e){this._is_visible_dependency.register()}return!!this._is_visible}wait_for_visible_lite(e,t){if(this.is_destroyed()){return}if(this.thumbnail_mode()&&!t){e();return}if(this.canvas==null){this.wait_for_first_draw((()=>this.wait_for_visible_lite(e,t)));return}if(this.is_visible(true)){e()}else{this._is_visible_cbs.push(e)}}notify_width(e){var t,n;this._dimension_box("width",e);(t=(n=this.element.E).notify_width)==null?void 0:t.call(n,this,e)}wait_for_visible(e){if(this.is_destroyed()){return}if(this.canvas==null){this.wait_for_first_draw((()=>this.wait_for_visible(e)));return}let t=0;if(this.is_visible(true)){if(this.is_destroyed()){return}if(this.canvas.is(":visible")){e()}else{const n=new MutationObserver(((n,r)=>{if(this.canvas.is(":visible")){r.disconnect();e();return}this._wait_for_visible_polls+=1;t+=1;if(this._wait_for_visible_polls%100===0){if(Math.random()<.01){o.info("poll from wait_for_visible increment of 100",{polls:t,all_polls:this._wait_for_visible_polls,element_name:this.element.get_name(true),element_type:this.element.type()})}}if(t>=50&&t%50===0){if(Math.random()<.05){o.info("polls from one wait_for_visible call over 50 increment of 50",{polls:t,all_polls:this._wait_for_visible_polls,element_name:this.element.get_name(true),element_type:this.element.type()})}}}));n.observe(this.canvas[0],{attributes:true,childList:true,attributeFilter:["style"]});let r=this.parent();while(r&&r.element.type()!=="Page"){const e=r.canvas[0];n.observe(e,{attributes:true,childList:true,attributeFilter:["style"]});r=r.parent()}this.on_destroy((()=>{n.disconnect()}))}}else{this.wait_for_visible_lite(this.wait_for_visible.bind(this,e),true)}}ensure_visible(){const e=(0,k.MakeKey)(undefined,"element visible lite key");this.wait_for_visible_lite((()=>e.turn()),true);(0,k.ensure_ready)(e);const t=(0,k.MakeKey)(undefined,"element visible key");const n=()=>{var e;if((e=this.canvas)!=null&&e.is(":visible")){this.clearInterval(r);t.turn()}};const r=this.setInterval(n,150);n();(0,k.ensure_ready)(t)}setTimeout(e,t){var n;const r=setTimeout((()=>{var t;(t=this.activeTimeouts)==null?void 0:t.delete(r);e()}),t);this.activeTimeouts=(n=this.activeTimeouts)!=null?n:new Set;this.activeTimeouts.add(r);return r}clearTimeout(e){var t;(t=this.activeTimeouts)==null?void 0:t.delete(e);clearTimeout(e)}setInterval(e,t){var n;const r=setInterval((()=>{var t;(t=this.activeTimeouts)==null?void 0:t.delete(r);e()}),t);this.activeTimeouts=(n=this.activeTimeouts)!=null?n:new Set;this.activeTimeouts.add(r);return r}clearInterval(e){var t;(t=this.activeTimeouts)==null?void 0:t.delete(e);clearInterval(e)}destroy(){var e,t;if(this._destroy_started){return}this._destroy_started=true;if((e=this.canvas)!=null&&e[0].bubble_data){delete this.canvas[0].bubble_data}for(const e of(n=this.activeTimeouts)!=null?n:[]){var n;clearTimeout(e)}for(const e of this.current_children){e.destroy()}for(const e of this._destroy_fns){e()}this._destroy_fns=[];(t=this.canvas)==null?void 0:t.trigger("destroy.dot");this.canvas="destroyed";this._msg_handlers=undefined;this._watchers=undefined;this.children=undefined;this._is_visible_cbs=[]}is_destroyed(){return this.canvas==="destroyed"}destroy_started(){return!!this._destroy_started}on_destroy(e){if(this.is_destroyed()){e()}else{this._destroy_fns.push(e)}}get_canvas(){return this.canvas}get_outer_canvas(){var e;return this.edit_mode()?(e=this.canvas)==null?void 0:e.parent():this.canvas}get_children_canvas(){var e,t;return(e=(t=this.element.E).get_children_canvas)==null?void 0:e.call(t,this)}total_descendants(){return this.children.reduce(((e,t)=>e+t.total_descendants()),this.children.length)}toString(){return this.__to_string}element_id(){return this.element.id()}parent(){var e,t;return(e=this._parent)!=null?e:(t=this.container)==null?void 0:t.get_owner()}split_namespace(){this._id_namespace={};this._id_namespace[this.element_id()]=this}mark_children_registered(){var e;this.status|=q.CHILDREN_REGISTERED;(e=this._our_children_registered)==null?void 0:e.turn()}mark_skeleton_ready(){var e;this.status|=q.HAS_SKELETON;(e=this._our_skeleton_ready)==null?void 0:e.turn();if(this.element.can_defer_drawing()){var t;(t=this._is_ready_key)==null?void 0:t.turn()}}mark_solid_initialized(){this.status|=q.SOLID_INITIALIZED;if(this.element.can_defer_drawing()){var e;(e=this._is_ready_key)==null?void 0:e.turn()}}mark_drawn(){if(!this.is_drawn){var e;this.status|=q.DRAWN;p.record_lifecycle(p.LifecycleEvent.Drawn);p.element_counts.element_instances.add(this.element.type(),1);(e=this._is_ready_key)==null?void 0:e.turn();this.run_draw_cbs()}}get_skeleton_ready_key(){if(this.has_skeleton){return(0,k.FakeKey)()}else{var e;(e=this._our_skeleton_ready)!=null?e:this._our_skeleton_ready=(0,k.MakeKey)(undefined,`_our_skeleton_ready_${this.toUniqueString()}`);return this._our_skeleton_ready}}get_children_drawn_key(){var e;(e=this._our_children_drawn)!=null?e:this._our_children_drawn=(0,k.MakeKey)(undefined,`_our_children_drawn_${this.toUniqueString()}`);return this._our_children_drawn}get_children_registered_key(){if(this.children_are_registered){return(0,k.FakeKey)()}else{var e;(e=this._our_children_registered)!=null?e:this._our_children_registered=(0,k.MakeKey)(undefined,"_our_children_registered");return this._our_children_registered}}get_is_ready_key(){if(this.is_ready){return(0,k.FakeKey)()}else{var e;(e=this._is_ready_key)!=null?e:this._is_ready_key=(0,k.MakeKey)(undefined,"_self_ready");return this._is_ready_key}}get_namespace(){var e,t;return(e=this._id_namespace)!=null?e:(t=this.parent())==null?void 0:t.get_namespace()}add_to_namespace(e,t){var n;(n=t)!=null?n:t=e.element_id();const r=this.get_namespace();if(r!=null){r[t]=e}}child_namespace_prefix(){const e=this.parent();if(!e){return""}if(this._id_namespace){return this.toUniqueString()+":"}return e.child_namespace_prefix()}toUniqueString(){var e,t;return((e=(t=this.parent())==null?void 0:t.child_namespace_prefix())!=null?e:"")+this.element_id()}dehydrate(){var e,t;(e=h.default.dehydrate_context)==null?void 0:(t=e.instance)==null?void 0:t.call(e,this);return x.default.dehydrate_prefix(a.ELEMENT_INSTANCE_DEHYDRATE)+this.toUniqueString()}try_register(e,t){var n;let r=this.find_instance_by_id_no_retry(e.id());if(r==null){const t=e.parent();if(t!=null){r=this.try_register(t,e.id())}}(n=r)==null?void 0:n.register_children();if(t!=null){var i,s,o;return(i=(s=r)==null?void 0:(o=s.get_namespace())==null?void 0:o[t])!=null?i:null}return null}find_instance_by_id(e){if(!e||!this.get_namespace()){return null}const t=this.find_instance_by_id_no_retry(e);if(t){if(t.is_ready){return t}else{(0,k.ensure_ready)(t.get_is_ready_key())}}let n=e.includes("_group_item_")?w.default.element(e.split("_group_item_")[0]):w.default.element(e).parent();if(n!=null&&w.default.has_feature_enabled("defer_element_instances")){queueMicrotask(this.try_register.bind(this,n))}const r=[];while(n){if(n.draws_own_children()){r.push(n.id())}const e=this.find_instance_by_id_no_retry(n.id());if(e){(0,k.ensure_ready)(e.get_children_registered_key(),false)}n=n.parent()}if(r.length>0){let e=this.parent();while(((i=e)==null?void 0:i.parent())!=null){var i;const t=e.parent().element;if(t.draws_own_children()&&r.includes(t.id())){(0,k.ensure_ready)(e.get_children_registered_key())}e=e.parent()}}if((t==null?void 0:t.element.type())==="TableMainAxis"){return t}return null}find_instance_by_id_no_retry(e){let t=this;do{const n=t.get_namespace();if(n!=null&&n[e]){return n[e]}t=t.parent()}while(t);return null}get_visible_instances(){const e={};const t=this.get_namespace();s.default.object_entries(t).forEach((t=>{let[n,r]=t;e[n]=r}));const n=this.parent();for(const t of(r=n==null?void 0:n.get_visible_instances())!=null?r:[]){var r,i,o;(o=e[i=t.element_id()])!=null?o:e[i]=t}return Object.values(e)}get_static_property(e,t){return this.element.get_styleable_static_property(e,t)}get_styleable_static_property(e,t){return this.element.get_styleable_static_property(e,t)}_dimension_box(e,t){var n;const r=`__dimension_box_${e}`;const i=(n=this[r])!=null?n:this[r]=(0,A.Box)(t!=null?t:this.element[`get_${e}`]());if(t!=null){i(t);return}return i()}_observe_canvas(){if(this._sizing_setup){_.observe(this.canvas[0],(0,f.default)((e=>{if(e.borderBoxSize&&e.borderBoxSize.length>0){this.state("current_width",e.borderBoxSize[0].inlineSize);this.state("current_height",e.borderBoxSize[0].blockSize)}else{this.state("current_width",e.target.offsetWidth);this.state("current_height",e.target.offsetHeight)}}),50,{leading:true,trailing:true,maxWait:100}));this.on_destroy((()=>_.unobserve(this.canvas[0])))}}setup_sizing(){if(this._sizing_setup){return}if(this.canvas!=null&&document.contains(this.canvas[0])){this.state("current_width",this.canvas.outerWidth());this.state("current_height",this.canvas.outerHeight())}else{this.state("current_width",0);this.state("current_height",0)}this._sizing_setup=true;if(this.canvas){this._observe_canvas()}}current_width(){return this.state("current_width")}current_height(){return this.state("current_height")}get_injected_context(e,t){var n;const r=(n=this.prop_eval_context())!=null?n:{element:this,datasources:{}};return{...r,datasources:{...r.datasources,injected_value:()=>e,injected_value_btype:()=>t}}}prop_eval_context(e){if(!this._p_context){this._p_context={element:this,datasources:m.default.get_basic_datasources(this.element.root()),random_seed:Math.random()}}if(e){this._p_context.random_generator=new O.Random(this._p_context.random_seed)}return this._p_context}on_run_eval_error(e,t){o.log((0,E.ensure_bubble_error)(t).extend({element_instance:(0,j.to_loggable)(this),prop_name:e}))}autorun(e,t){const n=(0,A.autorun)((()=>this._run_if_not_destroying(e)),t);this.on_destroy((()=>n.destroy()));return n}_run_if_not_destroying(e){if(!this._destroy_started){return e()}return undefined}message(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++){n[r-1]=arguments[r]}if(!this.supports_message(e)){o.error("Element does not support message name",{element_type:this.element.type(),name:e})}(0,A.autorun_top)((()=>{var t;const r=(t=this._msg_handlers[e])!=null?t:[];for(const e of r){e(...n)}}))}supports_message(e){var t,n,r;return this.element.get_messages().includes(e)||((t=(n=(r=this.element.E).get_private_messages)==null?void 0:n.call(r,this.element))!=null?t:[]).includes(e)}get_messages(){return this.element.get_messages()}on_message(e,t){var n,r;const i=(r=(n=this._msg_handlers)[e])!=null?r:n[e]=[];i.push(t)}state(e,t,n){var r,i;const s=(i=(r=this._states)[e])!=null?i:r[e]=(0,A.Box)(undefined);if(t!==undefined){if(t===u.STATE_NOT_READY){s(undefined,true)}else{s(t)}return undefined}else{const e=s();if(typeof e==="function"&&!n){return e(this)}else{return e}}}responsive_mode(){return this.mode===z.RESPONSIVE}thumbnail_mode(){return this.mode===z.THUMBNAIL||this.mode===z.REUSABLE_EDIT}reusable_edit_mode(){return this.mode===z.REUSABLE_EDIT}edit_mode(){return this.mode===z.EDIT}run_mode(){return this.mode===z.RUN}is_secure(){var e,t;return!!((e=(t=this.element.E).is_secure)!=null&&e.call(t,this))}is_self_nested_custom(){const e=this.element.get_static_property("custom_id");if(!e){return false}let t=this.parent();while(t){if(t.element.id()===e||t.element.get_static_property("custom_id")===e){return true}t=t.parent()}return false}get is_registered(){return!!(this.status&q.REGISTERED)}get has_skeleton(){return!!(this.status&q.HAS_SKELETON)}get is_drawn(){return!!(this.status&q.DRAWN)}get is_solid_initialized(){return!!(this.status&q.SOLID_INITIALIZED)}get is_ready(){if(this.element.can_defer_drawing()){return this.has_skeleton||this.is_solid_initialized}else{return this.is_drawn}}get children_are_registered(){return!!(this.status&q.CHILDREN_REGISTERED)}get children_being_registered(){return!!(this.status&q.CHILDREN_BEING_REGISTERED)}get children_are_drawn(){return!!(this.status&q.CHILDREN_DRAWN)}register(e){this.register_self(e);this.register_children_deep()}register_self(e){var t,n;if(this.is_registered){return}this._parent=e;if([z.RUN,z.EDIT,z.REUSABLE_EDIT].includes(this.mode)){var r;(r=this.parent())==null?void 0:r.add_to_namespace(this)}(t=(n=this.element.E).register)==null?void 0:t.call(n,this);this.status|=q.REGISTERED;p.record_lifecycle(p.LifecycleEvent.Registered)}register_children_deep(){if(!this.run_mode()||!w.default.has_feature_enabled("defer_element_instances")||g.mustRegisterId(this.element_id())){this.register_children();this.children.forEach((e=>e.register_children_deep()))}}register_children(){if(this.children_are_registered||this.children_being_registered){return}this.status|=q.CHILDREN_BEING_REGISTERED;if(this.element.E.register_children){this._children=[];this.element.E.register_children(this);this.status|=q.CHILDREN_REGISTERED}else{this._default_register_children(this.element.elements())}}_default_register_children(t){this._children=[];for(const n of t){if(!n.exists()){continue}if(!this.thumbnail_mode()||n.is_visible_on_page_load()){const t=new e(n,this.mode);this.children.push(t);t.register_self(this)}}this.mark_children_registered()}get children(){if(!this._children){(0,A.autorun_top)((()=>this.register_children()))}return this._children}set children(e){this._children=e}get current_children(){var e;return(e=this._children)!=null?e:[]}set_containers(e){if(!this.is_solid_initialized){this.container=e;this.mark_solid_initialized();this._update_visible();const[n,r]=(0,i.createSignal)(false);this.draw_signal={get:n,set:r};if(this.element.solid_component){var t;if(this.element.can_have_children()&&(!this.element.draws_own_children()||this.thumbnail_mode()&&(t=this._children)!=null&&t.length)){const e=this.container.create_child(this);this.child_container=e;(0,k.WaitFor)(this.get_children_registered_key(),(()=>{for(const t of this.children){t.set_containers(e)}this.children.sort(e.layout().sort_fn)}))}else{this.children=[]}}}}create_skeleton(e){if(this.has_skeleton){o.warn("Attempting to create skeleton for an element that already has one! "+this.toUniqueString());return}this.container=e;this.canvas=this.container.render(this.get_html());this.canvas.addClass(this.element.type());if(!this._is_visible_me){this._hide_me()}this._observe_canvas();if(y.default.run_mode_ids&&this.run_mode()){this.canvas.attr("id",F(this.element_id()))}const t=this.element.E;if(typeof t.position_canvas==="function"&&!this.thumbnail_mode()){this.position_canvas()}else{this.container.add(this)}this.create_child_skeletons();this.mark_skeleton_ready()}create_child_skeletons(){var e;if(this.element.E.create_child_skeletons){this.element.E.create_child_skeletons(this);return}if((e=v.default.or_throw().element)!=null&&e.new_rendering){const e=this.element.E.custom_definition;if(e!=null&&e().get_responsive_version()>0){const e=this.container.create_child(this,this.get_children_canvas());this.child_container=e;for(const t of this.children){t.set_containers(e)}this.children.sort(e.layout().sort_fn);(0,r.render)((()=>this.children.map((e=>(0,r.createComponent)(D.RenderElement,{instance:e})))),e.container_canvas[0]);return}}if(this.element.can_have_children()){const e=this.get_children_canvas();const r=this.container.create_child(this,e);this.child_container=r;let i;if(!this.element.is_responsive_v1()){var t,n;(t=(n=this.element.E).initialize_container_width)==null?void 0:t.call(n,this,r);i=this.children}else{const e=c.default.LAYOUT_PROPERTIES[this.element.container_layout()];i=this.children.sort(e.sort_fn)}for(const e of i){e.create_skeleton(r)}r.initialize()}}wait_for_first_draw(e){if(this.is_drawn){e()}else{this._first_draw_cbs.push(e)}}with_canvas(e){this.ensure_drawn();this.wait_for_first_draw((()=>{e(this.canvas)}))}start_draw_tree(){g.watchDraw(this,{onDraw:e=>{const t=p.get_current_phase()===p.DrawPhase.InitialDraw?p.DrawReason.VisibleOnPageLoad:p.DrawReason.BecameVisible;e.do_draw(t)},onSizeDraw:e=>{e.do_size_only_draw()}});this.handle_individual_draw()}handle_individual_draw(){if(!this.run_mode()){this.do_draw(p.DrawReason.DeferFlagOff)}else if(!this.element.can_defer_drawing()||this.is_solid_initialized&&this.element.solid_component==null&&this.children.length>0){this.do_draw(p.DrawReason.CantDefer)}this.start_child_drawing()}do_size_only_draw(){if(this.is_drawn){return}let e;if(this.element.E.attempt_size_only_draw){e=!this.element.E.attempt_size_only_draw(this)}else{e=!this.element.no_size_when_hidden()}if(e){this.do_draw(p.DrawReason.SizeNeeded)}}run_draw_cbs(){const e=this._first_draw_cbs;this._first_draw_cbs=[];for(const t of e){t()}}setup_canvas_hooks(){this.canvas[0].bubble_data={bubble_instance:this};const e=v.default.or_throw().workflow.debugger;if(e){if(!(0,S.is_on_mobile_or_tablet)()){this.canvas.on("mouseenter.debugger",(()=>e.element_hovered(this)));this.on_destroy((()=>this.canvas.off("mouseenter.debugger")))}this.canvas.on("click.debugger",(t=>{if(e.element_clicked(this,this.get_partial())){t.stopPropagation()}}));this.on_destroy((()=>this.canvas.off("click.debugger")))}}initialize_canvas(){var e;(e=this.element.root())==null?void 0:e.get_responsive_version();this.initialize();this.setup_canvas_hooks();this.mark_drawn()}do_draw(e){if(this.is_drawn||this._is_drawing){return}p.with_draw_reason(e,(()=>{this._is_drawing=true;O.count("draw children element created: "+this.element.type());if(this.is_solid_initialized){var t,n;(t=this.draw_signal)==null?void 0:t.set(true);(n=this.parent())==null?void 0:n.do_draw(e)}else{this.initialize_canvas()}}));this._is_drawing=false}start_child_drawing(){var e,t,n;if((e=v.default.or_throw().styles_editor)!=null&&(t=e.element_styles_editor())!=null&&(n=t.owner)!=null&&n.is_active()){return}if(this.element.draws_own_children()&&this.element.E.draw_children){this.element.E.draw_children(this);this.status|=q.CHILDREN_DRAWN;return}if(this.children_are_drawn){return}const r=()=>{for(const e of this.children){if(!e.element.added_to_container())e.start_draw_tree();else e.handle_individual_draw()}};if(this.child_container){(0,k.WaitFor)(this.get_children_registered_key(),r)}else if(this.children.length>0){(0,k.WaitFor)(this.get_skeleton_ready_key(),r)}this.status|=q.CHILDREN_DRAWN;this.get_children_drawn_key().turn()}ensure_drawn(){if(this.is_drawn){return}const e=()=>{this.do_draw(p.DrawReason.Unknown);this.start_child_drawing()};if(this.is_solid_initialized){(0,i.batch)(e)}else{e()}}get_partial(){return b.default.make_partial_expression_evaluator(this.prop_eval_context())}set_height(e,t){if(this.destroy_started()){return}this._dimension_box("height",e);this.container.set_height(this,e,t)}position_canvas(e){this.element.E.position_canvas(e!=null?e:this.canvas,this)}attach_to_body(){var e,t,n;return(e=(t=(n=this.element.E).attach_to_body)==null?void 0:t.call(n,this))!=null?e:!this.element.added_to_container()}on_resize(e){var t;if((t=this.element.root())!=null&&t.use_responsive_algorithm()){if(this.run_mode()){const t="resize."+this.element.type()+"-"+this.toUniqueString();$(window).on(t,(()=>{if($(window).width()!==this._old_width){this._old_width=$(window).width();e(this._old_width)}}));this.on_destroy((()=>$(window).off(t)))}else if(this.responsive_mode()){this.container.on("resize_width",e);this.on_destroy((()=>this.container.removeListener("resize_width",e)))}}}initialize(){if(this.is_drawn){throw new E.UnexpectedError("can only call initialize once")}(0,A.autorun_top)((()=>{this.element.E.initialize(this)}))}get_html(){return this.element.E.get_html(this)}workflow_show(e,t,n){if(this.element.E.workflow_show){this.element.E.workflow_show(this,e,t,n)}else{this.do_show(e,t,n)}}workflow_hide(e,t,n){if(this.element.E.workflow_hide){this.element.E.workflow_hide(this,e,t,n)}else{this.do_hide(e,t,n)}}rendering_using_solid(){return this.is_solid_initialized&&this.element.solid_component!=null&&!(this.edit_mode()&&this.element.E.use_legacy_in_editor)&&!(this.thumbnail_mode()&&this.element.E.use_legacy_in_thumbnail)}_display_me(){if(this.element.is_responsive_v1()){var e;if(this.rendering_using_solid())return;(e=this.canvas)==null?void 0:e.css("visibility","")}else{var t;(t=this.canvas)==null?void 0:t.css("display","")}}_hide_me(){var e;if(this.rendering_using_solid()){return}(e=this.canvas)==null?void 0:e.css(this.get_hidden_css())}get_hidden_css(){return this.element.is_responsive_v1()?{visibility:"hidden",display:null}:{display:"none"}}do_show(e,t,n){this.with_canvas((r=>{if(this._has_been_hidden===false&&!n){return}const i=this._has_been_hidden==null;this._has_been_hidden=false;const{do_show:s}=this.element.E;if(s){return s(this,e,t,n,i)}else{var o;this._is_visible_me=true;(o=r.velocity)==null?void 0:o.call(r,"stop",true);if(!n){this._display_me();this._update_visible()}else{d.default.perform_animate_in(this,e,t)}}}))}do_hide(e,t,n){if(this._has_been_hidden===true&&!n){return}const r=this._has_been_hidden==null;this._has_been_hidden=true;const i=this.element.E.do_hide;if(i){i(this,e,t,n,r)}else{if(!n){var s,o;(s=this.canvas)==null?void 0:(o=s.velocity)==null?void 0:o.call(s,"stop",true);this._hide_me();this._is_visible_me=false;this._update_visible()}else{this.with_canvas((n=>{var r;(r=n.velocity)==null?void 0:r.call(n,"stop",true);d.default.perform_animate_out(this,e,t)}))}}}register_workflows(e){for(const t of e){const e=t.register(this);if(e!=null){this.on_destroy(e)}}}can_register_workflows(){var e,t,n,r;return(e=(t=(n=this.element.E).can_register_workflows)==null?void 0:t.call(n,this))!=null?e:(r=this.parent())==null?void 0:r.can_register_workflows()}get_transition_styling(){const e=this.element.E;let t="";const n=this.element.field_names();s.default.object_keys(n).forEach((n=>{var r;if((r=e.transition_properties)!=null&&r[n]){const r=this.element.transition(n);if(r!=null&&r.exists()){var i;const n=(i=e.transition_properties)==null?void 0:i[r.prop_name()];t+=`${n} ${r.duration()}ms ${r.fn()}, `}}}));return t}get_transition_css(e){const t=this.get_transition_styling();if(t){var n,r,i;const s=this.get_canvas();const o=s.prop("outerHTML");const a=(n=e[o])!=null?n:e[o]={};(r=a.target)!=null?r:a.target=s;(i=a.css_prop)!=null?i:a.css_prop="";a.css_prop+=t}}show_borders(){var e,t;(e=(t=this.element.E).show_borders)==null?void 0:e.call(t,this)}hide_borders(){var e,t;(e=(t=this.element.E).hide_borders)==null?void 0:e.call(t,this)}},N.modes=z,N.ALL_MODES=B,N.lifecycle_statuses=q,N.rehydrate=function(e,t){var n;const r=t.split(":");let i=(n=v.default.or_throw().element)==null?void 0:n.get_page();for(const e of r){var s;i=(s=i)==null?void 0:s.find_instance_by_id(e)}return i},N),L(T.prototype,"is_self_nested_custom",[C],Object.getOwnPropertyDescriptor(T.prototype,"is_self_nested_custom"),T.prototype),T);t.exports=W}).call(this)}).call(this,e("timers").setImmediate)},{"../../client_config":41,"../../constants/elements":61,"../../constants/eval":64,"../../db/hydrate":429,"../../lib":741,"../../logger":744,"../../renderer/RenderElement":769,"../../renderer/drawstate":772,"../../shared/responsive/responsive_layout":804,"../../u/client/b_window":814,"../../u/client/resize_observer":820,"../../u/shared/async/autorun":830,"../../u/shared/async/b_async":832,"../../u/shared/async/dependency":834,"../../u/shared/decaf":844,"../../u/shared/errors":846,"../../u/shared/loggable":849,"../../u/shared/uuid":855,"../appquery":651,"../caching":656,"../evaluation/FrozenState":687,"../evaluation/page_state":698,"../expressions":711,"./elements_utils":679,"./rendering_perf":683,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,"lodash/debounce":1311,"solid-js":2313,"solid-js/web":2315,timers:2334}],670:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var r=X(e("../../u"));var i=V(e("../../u/shared/decaf"));var s=X(e("../../logger"));var o=V(e("./style_properties"));var a=V(e("../caching"));var l=V(e("../nodes"));var c=V(e("../application/RAW"));var u=V(e("../evaluation/evaluate_static"));var d=V(e("../../shared/responsive/responsive_algorithm"));var p=V(e("../../shared/responsive/responsive_layout"));var _=X(e("../../constants/elements"));var f=V(e("./elements_utils"));var h=X(e("./elements_state"));var m=V(e("./missing_element"));var g=X(e("./property_sections"));var v=V(e("./State"));var b=V(e("./Transition"));var y=X(e("../../shared/server_rendering/evaluation_cache"));var w=V(e("../../core/core_elements/elements_versioning"));var x=V(e("../../lib"));var j=V(e("../btypes"));var A=X(e("../../editor/css"));var M=X(e("../shrink"));var E=V(e("../appquery"));var k=V(e("../../shared/responsive_v0"));var O=V(e("../../core/property_applications"));var S=V(e("../lang_utils"));var D=V(e("../nodes/nodes_utils"));var C=V(e("../nodes/registry"));var T=V(e("../nodes/node_types"));var N=X(e("../btype_ids"));var P=e("../../constants/lang");var I=e("../../constants/custom_elements");var R=e("../../u/shared/loggable");var L=e("../evaluation/allow_overrides_check");var z,B,q,U,F,W,G;function V(e){return e&&e.__esModule?e:{default:e}}function H(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(H=function(e){return e?n:t})(e)}function X(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=H(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function Y(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const K={};const J={};let Z;function Q(){if(!Z){Z={};const e=o.default.get_style_properties();for(const t in e){const n=e[t];Z[M.shrink(t)]=n}}return Z}function ee(e,t){const n={};for(let a=0;a<t.length;a++){const l=t[a];const c=e.property(l);const u=D.default.make_filter("GetElement");const d=D.default.make_filter("ThisElement");const p=[...c.find_expressions(u),...c.find_expressions(d)];if(x.default.or_throw().is_edit_mode()){n[e.json._id]=true}else{n[e.json.id()]=true}for(let e=0;e<p.length;e++){var r,i,o;const t=p[e];const a=(r=t.raw())==null?void 0:r.properties;if(a==null){s.debug("missing entry properties object",{raw:(0,R.to_loggable)(t.raw()),path:t.path()});continue}if(n[(i=a.element_id)!=null?i:""]){return true}n[(o=a.element_id)!=null?o:""]=true}}return false}let te=(z=a.default.cached({type:a.default.AUTORUN}),B=a.default.cached({type:a.default.RUN_MODE,parameters:1}),q=a.default.cached({type:a.default.RUN_MODE}),U=a.default.cached({type:a.default.ALL_MODES}),F=a.default.cached({type:a.default.RUN_MODE}),W=a.default.cached({type:a.default.RUN_MODE,parameters:1}),G=class t extends l.default.HasID{make_new(){return C.default.new_element(...arguments)}constructor(e,t){var n,i;let s=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};e=e.to_id();super(e);this.E=void 0;this.fake=void 0;this._type=void 0;this.json=void 0;this.definition_or_self=void 0;this.style_override_properties=void 0;this.num_style_overrides=void 0;this._property_watcher_fns=void 0;this.is_missing=void 0;this.__solid_component=void 0;this._get_responsive_data_watcher=void 0;this._precomputed=void 0;this.json=e;this.fake=t;this._type=(n=(i=s._type)!=null?i:e.child("type").get())!=null?n:P.MISSING_TYPE;this.style_override_properties=new Set;this.num_style_overrides=r.Box(0);this.definition_or_self=this;if(this._type==="CustomElement"){const e=x.default.or_throw().load_custom(this);this.E=e;this.definition_or_self=e.custom_definition();const t=this.property.bind(this);const n=this.get_default.bind(this);const r=this.get_static_property.bind(this);this.property=e.property_transformer(this,t);this.get_static_property=e.get_static_property_transformer(this,r);this.get_default=e.default_transformer(this,n);this.get_style_if_exists=e.get_style_if_exists_transformer();this.get_responsive_data=()=>{var e;const t=(e=this.property("custom_id").get_static())!=null?e:"";const n=this.app().custom_definition(t);return n.get_responsive_data()};this.get_visible_workflows=function(){return e.get_visible_workflows(this)};this.get_related_workflows=e.get_related_workflows(this);if(!x.default.or_throw().is_edit_mode()){var o,a;const t=(o=(a=e.custom_states)==null?void 0:a.call(e))!=null?o:D.default.enhance_array([]);const n=f.default.get_states_from_raw_json(this.json).map((e=>new v.default(e)));const r=[...t,...n];this.states=()=>r}}else if(!this._type){this.E=m.default}else{var l;this.E=(l=x.default.or_throw().load_plugin(`${x.default.or_throw().plugin_prefixes.element}${this._type}`,true))!=null?l:m.default}this.is_missing=this.E===m.default}get solid_component(){if(this.__solid_component==null){this.build_solid_component()}return this.__solid_component}build_solid_component(){var e;this.__solid_component=(e=this.E.solid_component)==null?void 0:e.buildComponent(this,y.getPropertyCache(this.ssr_key()));return this.__solid_component}display(e){return this.get_name(e)}E_object(){return this.E}get_name(e){var t,n;if((t=(n=this.E).generate_name)!=null&&t.call(n,this)){return this.E.generate_name(this)}const r=this.json.child("name").get();if(r){h.seen_custom_names[r]=true;return r}else{var i;if(!e&&x.default.or_throw().workflow.debugger!=null){e=true}const t=(i=this.gen_name(e))!=null?i:this.default_name();h.seen_default_names[t]=true;return t}}name_for_datasource(){var e,t,n;return(e=(t=(n=this.E).name_for_datasource)==null?void 0:t.call(n,this))!=null?e:this.get_name()}get_responsive_data(){if(!this.exists()){return{}}if(r.is_edit_mode()){this._get_responsive_data_watcher=r.Watcher((()=>{let e;if(this.root().use_responsive_algorithm()){e=k.default.calculate_lines(this)}else{e=k.default.build_push_tree(this)}return S.default.simplify_data(e)}));return this._get_responsive_data_watcher.get()}const e=x.default.or_throw().derived("Responsive",this.root().json._path(),this.root().use_responsive_algorithm());e.set_app(this.app());return e.content()[this.id()]}default_name(){return this.json.child("default_name").get()}gen_name(e){var t;if(!x.default.or_throw().is_edit_mode()&&!e){return undefined}const n=["text","placeholder","label","icon","group_type"];if(ee(this,n)){return this.default_name()}const i=this.toUniqueString();if(J[i]){return this.default_name()}J[i]=true;(t=K[i])!=null?t:K[i]=r.Watcher((()=>{const e=e=>{const t=f.default.get_short_display(this.type());if(t==="CustomElement"){var n;const e=this.get_static_property("custom_id");const t=(n=E.default.custom_definition(e))==null?void 0:n.name();if(t){return t}}return t+" "+e};for(const r of n){if(r==="group_type"){const n=this.get_static_property(r);if(n){var t;const r=(t=j.default.get(n))==null?void 0:t.display();if(r){return e(r)}}}else{const t=this.property(r);if(!t.is_empty()){const n=t.get_tree_display().slice(0,20);return e(n)}}}return undefined}));delete J[i];const[s,o]=K[i].get_current();return s?o:undefined}get_type_display(){var e,t,n;return(e=(t=(n=this.E).get_type_display)==null?void 0:t.call(n,this))!=null?e:f.default.get_short_display(this.type())}is_equal_to(e){if(!super.is_equal_to(e)){return false}if(this._type!==e._type){return false}if(this._type==="CustomElement"){var t,n;return((t=this.E)==null?void 0:t.base_name)===((n=e.E)==null?void 0:n.base_name)}return true}toUniqueString(){return super.toUniqueString()+this._type}type(){return this._type}is_input(){var e,t;return(e=(t=this.E)==null?void 0:t.is_input)!=null?e:false}is_root(){var e,t;return((e=this.is_page)==null?void 0:e.call(this))||((t=this.is_custom_definition)==null?void 0:t.call(this))}is_page(){return false}is_custom_definition(){return false}id(){return this.json.id()}ssr_key(){return this.id()}get_styleable_static_property(e,t){if(this.is_styleable_property(e)){const t=this.get_style_if_exists();if(t){if((0,L.allow_overrides_check)(this,e)){const n=this.definition_or_self.property(e).raw();if(n==null){return t.get_static_property(e)}else{return n}}else{return t.get_static_property(e)}}}return this.get_static_property(e,t)}get_precomputed(){if(this._precomputed){return this._precomputed}else{const e=this.json._raw_child(M.S.properties);if(this.type()==="CustomElement"){for(const t in e){if(!I.ON_ELEMENT.includes(M.expand(t))){delete e[t]}}const t=this.E.custom_definition().json._child(M.S.properties)._raw();for(const n in t){if(!I.ON_ELEMENT.includes(M.expand(n))&&!["height","width"].includes(M.expand(n))){e[n]=t[n]}}}const t=this.get_style_if_exists();const n=t?Q():{};const r={};for(const i in e){if(t&&(n[i]||this.is_styleable_property(i))&&!(0,L.allow_overrides_check)(this,i)){continue}const s=e[i];if(u.default.is_static(s)){r[i]=u.default.get_static(s)}else{r[i]=_.NOT_STATIC_PROP}}const s={};Object.entries(r).forEach((e=>{let[t,n]=e;s[M.expand(t)]=n}));if(t){i.default.object_entries(t.get_precomputed()).forEach((e=>{let[t,n]=e;if(this.is_styleable_property(t)){var r;(r=s[t])!=null?r:s[t]=n}}))}const o=this.element_version(false);const a=this.element_version(true);for(const e of this.states()){for(const t of e.property_names()){s[t]=_.NOT_STATIC_PROP;for(const e of w.default.get_unmapped_properties(o,a,t)){s[e]=_.NOT_STATIC_PROP}}}this._precomputed=s;return this._precomputed}}default_states(){var e;return(e=this.E.default_states)!=null?e:[]}added_to_container(){if(typeof this.E.added_to_container==="function"){return this.E.added_to_container(this)}return this.E.position_canvas==null}container_layout(){var e;return(e=this.E.standard_container_layout)!=null?e:this.get_static_property("container_layout")}should_add_extra_wrapper(){if(this.container_layout()!==p.default.FIXED_LAYOUT){for(const i of this.definition_or_self.elements()){var e,t;const s=(e=i.get_static_property("min_height_css",true))!=null?e:"";const o=(t=i.get_static_property("max_height_css",true))!=null?t:"";if(s.includes("%")||o.includes("%")){return true}for(const e of i.states()){var n,r;const t=(n=e.get_static_property("min_height_css"))!=null?n:"";const i=(r=e.get_static_property("max_height_css"))!=null?r:"";if(t.indexOf("%")!==-1||i.indexOf("%")!==-1){return true}}}if(["FloatingGroup","GroupFocus","Popup"].includes(this.type())){const e=this.definition_or_self.elements().find((e=>e.type()==="RepeatingGroup"&&!e.get_static_property("fit_height")));if(e){return true}}if(this.container_layout()==="column"&&!this.never_fits_height()){const e=this.definition_or_self.elements().find((e=>e.container_layout()==="relative"&&!e.get_static_property("single_height")&&!e.fit_height()));if(e){return true}}}return false}container_locked(){const e=this.container_layout();return e!=null&&e!=="fixed"}compute_initial_properties(e,t,n){var i,s;if(!this.E.is_pseudo&&this.E.get_min_width!=null&&t!=null&&t.exists()){const n=()=>e.properties.left<50&&t.get_width()>300&&e.properties.width<150;const i=e.properties.left+e.properties.width;const s=()=>t.get_width()>300&&t.get_width()-i<50&&e.properties.left>150;if(t.is_responsive_v1()){e.properties.can_fit_height=this.can_fit_height();if(!(this.goes_on_document()||this.goes_on_document_for_drawing())){const n=x.default.or_throw().visual_edit.current_editor_canvas.getFirstContainer(t);r.extend(e.properties,n.get_new_element_properties(e.properties))}else{const t=d.default.get_default_sizing(e.properties);if(e.properties.min_width_css!=null){t.min_width_css=e.properties.min_width_css;t.single_width=false}if(e.properties.min_height_css!=null){t.min_height_css=e.properties.min_height_css}r.extend(e.properties,t)}delete e.properties.can_fit_height}else{if(t.get_width()/e.properties.width>2.3||e.properties.width<=60){if(e.properties.width>300){e.properties.min_width=Math.floor(300/e.properties.width*100)}else{e.properties.fixed_width=true}}if(n()){e.properties.responsive_alignment="left"}else if(s()){e.properties.responsive_alignment="right"}}}(i=(s=this.E).compute_initial_properties)==null?void 0:i.call(s,e,t,n)}get_new_event_json(){return this.json.child("workflows").child(r.LUID())}events(e){return this.json.smart_cache("events_"+String(e),(t=>{const n=t.child("workflows").children();const r=n.map((e=>C.default.new_workflow_item(e)));return D.default.filter_array(e,r)}))}find_events(e){return this.events(e)}find_actions(e){return this.events().flatMap((t=>t.all_next(e)))}find_customs(){const e=this.app();const t=new Set;const n=[this];const r=[];let i;while((i=n.pop())!=null){i.find_elements("CustomElement").forEach((i=>{const s=i.get_static_property("custom_id");const o=e.custom_definition(s);if(o!=null&&!t.has(s)){t.add(s);n.push(o);r.push(o)}}))}return r}find_actions_custom(e){const t=this.find_actions(e);const n=this.find_customs().flatMap((t=>t.find_actions(e)));return[...t,...n]}elements(e){if(!this.can_have_children()){return D.default.enhance_array([])}const t=this.json.child("elements").children();const n=t.filter((e=>e.child("id").exists())).map((e=>C.default.create_generic("element",e)));const r=D.default.enhance_array(n);return D.default.filter_array(e,r)}find_elements(e){const t=r.autorun_return((()=>f.default.find_elements(D.default.to_raw(this),e)));return D.default.from_raw_array(this.json,C.default.new_element,t)}find_elements_custom(e){const t=D.default.make_filter(e);const n=this.elements().filter((e=>t(e)));const r=this.elements().flatMap((e=>e.find_elements_custom(t)));const i=this.find_customs().flatMap((e=>e.find_elements(t)));const s=[...n,...r,...i];return D.default.enhance_array(s)}find_expressions(e){const t=r.autorun_return((()=>f.default.element_find_expressions(D.default.to_raw(this),e)));return D.default.from_raw_array(this.json,C.default.new_expression,t)}parent(){var e;if(this.fake){return null}const t=(e=this.json.parent())==null?void 0:e.parent();if(t){return C.default.new_element(t)}return null}parents(e){const t=[];let n=this;while(n=n.parent()){t.push(n)}return D.default.filter_array(e,t)}context_element(){return this}root(){var e;return(e=this.parent())==null?void 0:e.root()}get_width(){return this.get_static_property("width")}get_height(){return this.get_static_property("height")}get_left(){return this.get_static_property("left")}get_top(){return this.get_static_property("top")}get_zindex(){return this.get_static_property("zindex")}can_be_variable_width(){if(this.E.must_be_fixed_size!=null){return!this.E.must_be_fixed_size(this)}else{return this.E.get_min_width!=null}}fixed_width(){return!this.can_be_variable_width()||this.get_static_property("fixed_width")}min_width_adjustable_legacy(){return this.can_be_variable_width()&&!this.get_static_property("fixed_width")&&this.E.get_min_width(this)<this.get_width()}max_width_adjustable_legacy(){return this.min_width_adjustable_legacy()&&!this.E.not_max_adjustable_legacy&&!this.not_max_adjustable()}not_max_adjustable(){if(typeof this.E.not_max_adjustable==="function"){return this.E.not_max_adjustable(this)}else{var e;return(e=this.E.not_max_adjustable)!=null?e:false}}default_min_width(){var e,t;const n=(e=(t=this.root())==null?void 0:t.get_width())!=null?e:0;if(n>600){return Math.round(this.get_width()*.2)}else{return this.get_width()}}get_min_width(){if(this.E.get_min_width==null||this.get_static_property("fixed_width")){return this.get_width()}const e=this.get_static_property("min_width");const t=this.get_width();const n=(e!=null?e:0)/100*t;const r=this.E.get_min_width(this);return Math.max(n,r)}get_max_width(){if(this.E.get_min_width==null||this.get_static_property("fixed_width")){return this.get_width()}if(!this.get_static_property("use_max_width")){return null}const e=this.get_static_property("max_width");const t=this.get_width();return(e!=null?e:100)/100*t}responsive_show(){return this.get_static_property("responsive_show")}responsive_show_width(){return this.get_static_property("responsive_show_width")}is_fixed_dimension(e){return this.get_static_property(`single_${e}`)}force_fixed(){return!this.E.no_fixed_sizing&&this.container_layout()==="fixed"}root_min_width(){if(this.force_fixed()){return this.get_width()}else{return this.get_static_property("min_width_px")}}root_max_width(){if(this.force_fixed()){return this.get_width()}else if(!this.not_max_adjustable()){return this.get_static_property("max_width_px")}else{return null}}root_min_height(){if(this.force_fixed()){return this.get_height()}else{return this.get_static_property("min_height_px")}}root_max_height(){if(this.force_fixed()){return this.get_height()}else if(!this.not_max_adjustable()){return this.get_static_property("max_height_px")}else{return null}}can_fit_width(){if(typeof this.E.can_fit_width==="function"){return this.E.can_fit_width(this)}else{var e;return(e=this.E.can_fit_width)!=null?e:false}}can_fit_height(){if(typeof this.E.can_fit_height==="function"){return this.E.can_fit_height(this)}else{var e;return(e=this.E.can_fit_height)!=null?e:false}}fit_width(){if(this.E.uses_css_responsive&&this.can_fit_width()&&!this.force_fixed()&&!this.get_static_property("single_width")){return this.get_static_property("fit_width")}else{return false}}fit_height(){if(!this.E.uses_css_responsive){return true}if(this.can_fit_height()&&!this.force_fixed()&&!this.get_static_property("single_height")){return this.get_static_property("fit_height")}else{return false}}never_fits_width(){var e;if(!this.can_fit_width()||this.force_fixed()){return true}const t=(e=this.parent())==null?void 0:e.container_layout();if(t===p.default.DIMENSION_TO_CROSS_AXIS.width){if(!this.get_static_property("fit_width")){return true}const e=this.get_static_property("horiz_alignment",true);const t=this.states().some((e=>e.get_static_property("horiz_alignment")!=="stretch"));return e==="stretch"&&!t}else if(t===p.default.FIXED_LAYOUT){return true}else{return!this.get_static_property("fit_width")}}never_fits_height(){var e;if(!this.can_fit_height()||this.force_fixed()){return true}const t=(e=this.parent())==null?void 0:e.container_layout();if(t===p.default.DIMENSION_TO_CROSS_AXIS.height){if(this.get_static_property("single_height")){return true}const e=this.get_static_property("vert_alignment",true);const t=this.states().some((e=>e.get_static_property("vert_alignment")!=="stretch"));return e==="stretch"&&!t}else if(t===p.default.FIXED_LAYOUT){return true}else{return!this.get_static_property("fit_height")}}can_fix_aspect_ratio(){var e,t,n;return(e=(t=(n=this.E).can_fix_aspect_ratio)==null?void 0:t.call(n,this))!=null?e:false}has_fixed_aspect_ratio(){var e;return this.can_fix_aspect_ratio()&&((e=this.parent())==null?void 0:e.container_layout())!=="fixed"&&this.get_static_property("use_aspect_ratio")}uses_css_responsive(){var e;return(e=this.E.uses_css_responsive)!=null?e:false}get_containing_element(){return this.parent()}no_margins(){var e,t,n;return(e=(t=(n=this.E).no_margins)==null?void 0:t.call(n,this))!=null?e:false}state_by_name(e){return new v.default(this.json.child("states").child(e))}get_messages(){var e,t,n;return(e=(t=(n=this.E).get_messages)==null?void 0:t.call(n,this))!=null?e:[]}add_specific_messages(e){var t,n;(t=(n=this.E).add_specific_messages)==null?void 0:t.call(n,e,this)}get_states(){var e,t,n;return(e=(t=(n=this.E).get_states)==null?void 0:t.call(n,this))!=null?e:[]}get_state_value(e){var t,n,r;return j.default.get((t=(n=(r=this.E).get_state_value)==null?void 0:n.call(r,this,e))!=null?t:"null")}_fields(e){return this.E.fields(this,e)}field(e){var t;return(t=this.fields)==null?void 0:t.call(this).find((t=>t.name===e))}field_names(){return this.E.field_names}is_styleable_property(e){return this.get_styleable_properties()[e]}get_property_applications(){var e;let t=(e=this.E.property_applications)!=null?e:[];if(typeof t==="function"){t=t(this)}if(this._type==="CustomDefinition"){return t}else{return[...t,new O.default.UniqueID]}}get_value_id(){var e,t,n;return(e=(t=(n=this.E).get_value_id)==null?void 0:t.call(n,this))!=null?e:"element."+this.id()}get_visible_workflows(){return D.default.filter_array((e=>!e.json._raw_gchild(M.S.properties,"workflow_disabled")),this.parents().flatMap((e=>e.events())))}get_related_workflows(e){const t=this.id();const n=this.get_visible_workflows().filter((n=>n.element_id()===t&&n.type()===e));return D.default.enhance_array(n)}can_have_children(){var e,t,n;return(e=(t=(n=this.E).can_have_children)==null?void 0:t.call(n,this))!=null?e:false}tell_editcanvas(){return true}is_visible_on_page_load(){return this.E.is_visible_on_page_load(this)}modal(){var e,t,n;return(e=(t=(n=this.E).modal)==null?void 0:t.call(n,this))!=null?e:false}not_draggable(){var e,t,n;return(e=(t=(n=this.E).not_draggable)==null?void 0:t.call(n,this))!=null?e:false}not_resizable(){var e,t,n;return(e=(t=(n=this.E).not_resizable)==null?void 0:t.call(n,this))!=null?e:false}goes_on_document(){var e,t,n;return(e=(t=(n=this.E).goes_on_document)==null?void 0:t.call(n,this))!=null?e:false}draws_own_children(){var e,t,n;return(e=(t=(n=this.E).draws_own_children)==null?void 0:t.call(n,this))!=null?e:false}can_reference(){var e,t,n;return(e=(t=(n=this.E).can_reference)==null?void 0:t.call(n,this))!=null?e:true}goes_on_document_for_drawing(){var e,t,n;return(e=(t=(n=this.E).goes_on_document_for_drawing)==null?void 0:t.call(n))!=null?e:this.goes_on_document()}no_edit_draw_children(){var e,t,n;return(e=(t=(n=this.E).no_edit_draw_children)==null?void 0:t.call(n,this))!=null?e:false}find_in_editor_raw(e,t){r.run_once(30,(()=>this.root()),((n,r)=>{r==null?void 0:r.find_in_editor(false,(()=>{$(A.VISUAL_TAB).click();x.default.or_throw().visual_edit.responsive_mode_box("builder");x.default.or_throw().visual_edit.current_editor_canvas.select(this.id(),"overwrite");x.default.or_throw().visual_edit.edit_current_element();e()}),t)}))}find_in_editor(e,t,n){this.find_in_editor_raw((()=>{x.default.or_throw().property_editor.current_tab("appearance");r.wait_for_updates((()=>{if(e){t($("#"+this.id()))}else{t()}}))}),n)}is_on_edit_mode(e){const t="state:"+e.toUniqueString();return h.is_state_on_edit_mode(t)}toggle_state_edit_mode(e){const t="state:"+e.toUniqueString();h.toggle_state_edit_mode(t)}get_style_node(){return C.default.new_expression(this.json.child("style"),this)}get_style_id(){var e;return(e=this.json.child("style").get())!=null?e:undefined}get_style(){return this.app().style(this.get_style_id())}clear_style_overrides(){const e=this.get_style_id();this.style_override_properties.clear();this.num_style_overrides(0);if(!e)return;this.set_style(e,undefined,_.OLD_VERSION_OVERRIDE_PROPERTIES)}increment_style_overrides(t){if(!this.style_override_properties.has(t)){this.style_override_properties.add(t);this.num_style_overrides(this.style_override_properties.size);const n=e("../../optional/analytics");n.track("PE Style Overridden",{app:E.default.appname(),style_name:t})}}decrement_style_overrides(e){if(this.style_override_properties.has(e)){this.style_override_properties.delete(e);this.num_style_overrides(this.style_override_properties.size)}}set_style(e,t,n){var i,s,o,a;const l=(i=this.get_style())!=null&&i.exists()?this.get_style().json:this.json;const c={target_id:this.id(),old_value:this.get_style_id(),value:e,style_properties:{...l.child("properties").raw()},element_properties:{...r.json_deep_copy((s=this.json.child("properties").raw())!=null?s:{})},old_states:{...l.child("states").raw(),...r.json_deep_copy((o=this.json.child("states").raw())!=null?o:{})},old_transitions:{...l.child("transitions").raw(),...r.json_deep_copy((a=this.json.child("transitions").raw())!=null?a:{})},ignore_padding:n};r.maybe_add_source_appname_to_object(c,E.default.appname(),t);const u=x.default.or_throw().changes.create_change("AssignStyle",c);u.execute()}property_supports_states(){var e;return(e=this.E.property_supports_states)!=null?e:true}property_supports_transitions(){var e;return(e=this.E.property_supports_transitions)!=null?e:true}primary_field(){var e,t;return(e=(t=this.E).primary_field)==null?void 0:e.call(t,this)}mandatory_sections(){var e,t,n;return(e=(t=(n=this.E).mandatory_sections)==null?void 0:t.call(n,this))!=null?e:null}can_copy_style(){var e;return(e=this.E.can_copy_style)!=null?e:true}property_sections(e){var t;return(t=g.for_mode[e])!=null?t:g.for_mode.all}exclusively_responsive_sections(){return[{name:"Responsive",show_title:false},{name:"Margins",show_title:false},{name:"PaddingFields",show_title:false},{name:"ResponsiveContainer",show_title:false}]}set_name(e,t){if(this.is_root()){let n;if(this.is_page()){[n,e]=x.default.or_throw().appchange.validate_page_name(e,t);if(n){throw new r.UnexpectedError(n)}}else if(this.is_custom_definition()){[n,e]=x.default.or_throw().appchange.validate_custom_name(e);if(n){throw new r.UnexpectedError(n)}}}const n=this.json.child("name").get();if(e!==n){const t=x.default.or_throw().changes.create_change("SetData",{target_id:this.id(),path:"name",old_value:n,value:e});return t.execute()}}move_to(e){const t=x.default.or_throw().changes.create_change("MoveElement",{old_parent:this.parent().id(),id:this.id(),new_parent:e.id()});t.execute()}new_child_element(e,t){if(!t){throw new r.UnexpectedError("must provide raw data")}const{new_data:n,mapping:i}=c.default.copy(t,e);r.run_once(30,(()=>{r.walk(n,(e=>{const t=e;if(t!=null&&t.id){var n;t.default_name=x.default.or_throw().appchange.gen_name(this.root(),t.type,(n=t.properties)==null?void 0:n.custom_id)}}))}),(t=>{if(t){s.error(r.ensure_bubble_error(t),{context:"temporary error creating your new element.",time_since_load:Date.now()-window.editor_loading_started});alert("Sorry, we had a temporary error creating your new element.  Please try again in a minute");return}const i={parent_id:this.id(),id:e,data:n};r.add_source_appname_tracker_to_change_args(n,i,E.default.appname());const o=x.default.or_throw().changes.create_change("CreateElement",i);o.execute()}));return i}new_state(e){const t={element_id:this.id(),data:e!=null?e:c.default.State()};r.add_source_appname_tracker_to_change_args(e,t,E.default.appname());const n=x.default.or_throw().changes.create_change("NewState",t);n.execute()}delete(e){r.run_once(30,(()=>{let e,t;const n=this.elements();if(this.id()){t=this.get_visible_workflows().filter((e=>e.element_id()===this.id()));e=this.get_visible_workflows().flatMap((e=>e.actions(".element_id="+this.id())))}else{s.warn("Element missing id attribute",{path:this.path()});t=[];e=[]}return[n,t,e]}),((t,n)=>{var i;if(t){s.log(r.ensure_bubble_error(t));window.alert("Oops, we hit a temporary error processing the element deletion... please try again in a bit");return}const[o,a,l]=n;const c=(i=this.id())!=null?i:this.path();for(const t of o){t.delete({user_action:"Deleted by parent element",parent_user_action:e==null?void 0:e.user_action,parent_id:c})}for(const t of a){t.delete({user_action:"Deleted by related element",parent_user_action:e==null?void 0:e.user_action,parent_id:c})}for(const t of l){t.delete({user_action:"Deleted by related element",parent_user_action:e==null?void 0:e.user_action,parent_id:c})}if(this.json.exists()){var u,d;const t=x.default.or_throw().changes.create_change("RemoveElement",{parent_id:(u=this.parent())==null?void 0:u.id(),root_path:(d=this.json.parent())==null?void 0:d.name(),id:this.id(),data:this.json.raw(),intent_details:{user_interaction:"Direct Element Delete",user_action:e==null?void 0:e.user_action,parent_user_action:e==null?void 0:e.parent_user_action,parent_id:e==null?void 0:e.parent_id}});t.execute()}}))}switch_to_new_type(e){var t,n;const r=this.json.child("properties").raw();const i=x.default.or_throw().changes.create_change("ReplaceElement",{old_type:this._type,new_type:e,id:this.id(),old_properties:r,old_style:this.get_style_id()});i.execute();if((t=(n=x.default.or_throw().load_plugin(`${x.default.or_throw().plugin_prefixes.element}${e}`)).goes_on_document)!=null&&t.call(n)){this.move_to(this.root())}this.commit()}element_custom_states(){if(this.E.element_custom_states){return this.E.element_custom_states()}else{const e=this.json.child("custom_states").children();return e.map((e=>C.default.create(T.default.CUSTOM_STATE,e)))}}element_custom_state(e){if(!e){return null}if(this.E.element_custom_state){return this.E.element_custom_state(e)}else{const t=N.custom_type_name(e);const n=this.json.child("custom_states").child(t);return C.default.create(T.default.CUSTOM_STATE,n)}}create_custom_state(e,t,n){const r=e.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();let i=0;const s=()=>r+"_"+String(i||"");while(this.element_custom_state(N.custom_type(s())).exists()){i=i+1}const o=s();const a={display:e,value:t,default_val:n,make_static:true};const l=x.default.or_throw().changes.create_change("CreateCustomState",{element_id:this.id(),name:o,data:a});l.execute();if(n===undefined){this.commit()}return N.custom_type(o)}transitions(){const e=this.json.child("transitions").children();const t=e.map((e=>new b.default(e,this)));return D.default.enhance_array(t)}transition(e){if(this.E.transition){return this.E.transition(e)}const t=this.json.child("transitions").child(e);if(t.exists()){return new b.default(t,this)}const n=this.get_style_if_exists();if(n){return n.transition(e)}return undefined}add_transition(e){const t=x.default.or_throw().changes.create_change("AddTransition",{element_id:this.id(),prop_name:e,data:b.default.default_transition});t.execute();this.commit()}find_events_using_this_element(){var e,t;const n=this.id();const r=(e=(t=x.default.or_throw().visual_edit.root_node())==null?void 0:t.events())!=null?e:[];return r.filter((e=>e.element_id()===n||e.find_my_expressions("GetElement.element_id="+n).length))}find_actions_using_this_element(){var e,t;const n=this.id();const r=(e=(t=x.default.or_throw().visual_edit.root_node())==null?void 0:t.events())!=null?e:[];const i=r.flatMap((e=>e.actions()||[]));return i.filter((e=>e.element_id()===n||e.find_my_expressions("GetElement.element_id="+n).length))}find_elements_using_this_element(){var e,t,n;const r=this.id();const i=(e=(t=x.default.or_throw().visual_edit.root_node())==null?void 0:(n=t.find_elements)==null?void 0:n.call(t))!=null?e:[];return i.filter((e=>e.id()!==r&&e.find_expressions("GetElement.element_id="+r).length))}states(){const e=f.default.get_states_from_raw_json(this.json);const t=e.map((e=>new v.default(e)));return D.default.enhance_array(t)}get_styleable_properties(){var e;const t=o.default.get_style_properties();const n=(e=this.E.styleable_properties)!=null?e:{};return r.extend({},t,n)}get_style_if_exists(){const e=this.json._child(M.S.style).get();if(e==null){return null}const t=this.app().style(String(e));if(!t.exists()){return null}return t}has_overridden_style(){const e=["top","bottom","left","right"].filter((e=>this.property(`padding_${e}`).raw()!=null)).length>0;let t=false;if(this.get_style_if_exists()&&this.element_version()>=_.VERSION_STYLE_OVERRIDES&&(this.num_style_overrides()>0||e)){t=true}return t}can_defer_drawing(){if(typeof this.E.can_defer_drawing!=="function"){return false}return this.E.can_defer_drawing(this)}no_size_when_hidden(){var e;const t=this.get_static_property("collapse_when_hidden");const n=!this.added_to_container();const r=this.is_responsive_v1()&&((e=this.parent())==null?void 0:e.container_layout())===p.default.FIXED_LAYOUT;return t||n||r}ignores_child_sizes(){return this.is_responsive_v1()&&this.uses_css_responsive()&&this.never_fits_width()&&this.never_fits_height()}element_version(e){var t,n,r,i,s,o;if(e&&this.get_style_if_exists()!=null){return E.default.get_public_setting("style_version")}if(((t=(0,x.default)())==null?void 0:(n=t.derived_name)==null?void 0:n.call(t))==="Responsive"||((r=(0,x.default)())==null?void 0:(i=r.derived_name)==null?void 0:i.call(r))==="ResponsiveDependencies"){return _.VERSION_STYLE_OVERRIDES-1}return(s=(o=this.root())==null?void 0:o.get_static_property("element_version"))!=null?s:_.LATEST_ELEMENT_VERSION}is_responsive_v1(){var e,t;return((e=(t=this.root())==null?void 0:t.get_responsive_version())!=null?e:1)>0}},Y(G.prototype,"should_add_extra_wrapper",[z],Object.getOwnPropertyDescriptor(G.prototype,"should_add_extra_wrapper"),G.prototype),Y(G.prototype,"get_related_workflows",[B],Object.getOwnPropertyDescriptor(G.prototype,"get_related_workflows"),G.prototype),Y(G.prototype,"states",[q],Object.getOwnPropertyDescriptor(G.prototype,"states"),G.prototype),Y(G.prototype,"get_styleable_properties",[U],Object.getOwnPropertyDescriptor(G.prototype,"get_styleable_properties"),G.prototype),Y(G.prototype,"get_style_if_exists",[F],Object.getOwnPropertyDescriptor(G.prototype,"get_style_if_exists"),G.prototype),Y(G.prototype,"element_version",[W],Object.getOwnPropertyDescriptor(G.prototype,"element_version"),G.prototype),G);t.exports=te},{"../../constants/custom_elements":57,"../../constants/elements":61,"../../constants/lang":73,"../../core/core_elements/elements_versioning":320,"../../core/property_applications":412,"../../editor/css":560,"../../lib":741,"../../logger":744,"../../optional/analytics":749,"../../shared/responsive/responsive_algorithm":802,"../../shared/responsive/responsive_layout":804,"../../shared/responsive_v0":805,"../../shared/server_rendering/evaluation_cache":806,"../../u":823,"../../u/shared/decaf":844,"../../u/shared/loggable":849,"../application/RAW":646,"../appquery":651,"../btype_ids":652,"../btypes":653,"../caching":656,"../evaluation/allow_overrides_check":688,"../evaluation/evaluate_static":696,"../lang_utils":715,"../nodes":721,"../nodes/node_types":722,"../nodes/nodes_utils":723,"../nodes/registry":724,"../shrink":728,"./State":674,"./Transition":677,"./elements_state":678,"./elements_utils":679,"./missing_element":681,"./property_sections":682,"./style_properties":684,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],671:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../lib");const i=e("../shrink");const s=e("../../services/shared/service_type_parser");const o=e("./Root");const a=e("../../constants/app_json");const l=e("../../../vendor/jquery_plugins/moment.timezone.min.js");const{has_adv_timezone_overridden:c}=e("../timezone_override_settings");t.exports=class e extends o{constructor(e){super(e,{_type:"Page"})}get_plugin_element_headers(){const e=this.json.path();const t=i.shrink(e.split(".")[0])+"."+e.split(".")[1];return r().derived("PagePluginHeaders",t).content()}load_plugin_element_headers(){const e=[];for(const o of this.get_element_types()){var t,n,i;const[a,l]=s.get_plugin_and_type(o);const c=/_current/.test(a);const u=(t=r().load_plugin(r().plugin_prefixes.element+o,true,c))==null?void 0:(n=(i=t).element_html_header)==null?void 0:n.call(i);if(![null,undefined,""].includes(u)&&!e.includes(u)){e.push(`\x3c!-- ${l} --\x3e\n`+u+"\n")}}return e}is_custom_definition(){return false}is_page(){return true}is_api(){return false}is_editor(){return this.json.child("is_editor").get()}is_plugin_editor(){return this.json.child("is_plugin_editor").get()}required_js_files(){return this.E.required_js_files(this)}required_css_files(){return this.E.required_css_files(this)}get_page_timezone(){const e=c()?"_overridden":"";switch(this.get_static_property(`tz_type${e}`)){case"static":return this.get_static_property(`tz_static${e}`);default:return l.tz.guess()}}is_protected(){return a.PROTECTED_PAGE_NAMES.has(this.get_name())}}},{"../../../vendor/jquery_plugins/moment.timezone.min.js":2353,"../../constants/app_json":45,"../../lib":741,"../../services/shared/service_type_parser":785,"../shrink":728,"../timezone_override_settings":729,"./Root":672,"core-js/modules/web.dom-collections.iterator.js":1123}],672:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../u/shared/mode_check");const s=e("../nodes");const o=e("../../lib");const a=e("../application/RAW");const l=e("./elements_utils");const c=e("./GenericElement");const u=e("../../logger");t.exports=class e extends c{constructor(e,t){super(e,false,t);if(l._use_issue_checker()&&this.app().can_run_issue_checker()){e.register_indexer("issues_list",(()=>{if(o().visual_edit.allow_issue_indexer_runs()){const e=s.new_element(this.json);if(!e.id()){return}const t=o().apptests.check_issues(e);const n=["issues_list",e.id()];return[n,r.json_stringify(t)]}}))}if(this.app().can_run_issue_checker()){e.register_indexer("issues_sub",(()=>{const e=s.new_element(this.json);if(!e.id()){return}const t=["issues_sub",e.id()];const n=e.elements().map((e=>e.id()));const i=e.events().map((e=>e.id()));const o=[...n,...i];return[t,r.json_stringify(o)]}))}}use_responsive_algorithm(){return d.get_public_setting("no_legacy_responsive")||this.get_responsive_version()>0||this.get_static_property("new_responsive")}get_responsive_version(e){var t,n;if(i.on_server()&&!o().force_responsive_version&&!e){return 0}return(t=(n=this.get_static_property("responsive_version"))!=null?n:d.get_public_setting("base_responsive_version"))!=null?t:0}default_width(){return this.get_static_property("default_width")}run_indexers(e){return this.json.run_indexers(e)}parent(){return null}root(){return this}is_api(){return false}name(){return this.json.child("name").get()}get_element_types(){return o().derived("ElementTypesUsed",this.json._path()).content()}get_custom_definitions_used(){return o().derived("CustomDefinitions",this.json._path()).content()}get_styles_used_directly(){if(this.json._path()==null)return[];return o().derived("StylesUsed",this.json._path()).content()}get_own_styles_used(){if(this.json._path()==null){return[]}const e=new Set(this.get_styles_used_directly());for(const n of(t=this.get_custom_definitions_used())!=null?t:[]){var t;const r=d.custom_definition(n);const i=r.get_styles_used_directly();if(i==null){return null}for(const t of i){e.add(t)}}return Array.from(e)}check_for_errors(e,t){var n,r;(n=(r=this.E).check_for_errors)==null?void 0:n.call(r,this,e,t);const i=super.check_for_errors(e);return{children:this.states().concat(i.children)}}find_in_editor(e,t,n){o().visual_edit.responsive_mode_box("builder");o().visual_edit.ensure_root(this,(()=>{if(n){$(p.VISUAL_TAB).click();o().visual_edit.select_to_edit(this.id())}r.wait_for_updates(t)}))}new_event(e,t){const{new_data:n}=a.copy(t,e);const i={root_id:this.id(),id:e,data:n};r.add_source_appname_tracker_to_change_args(n,i,d.appname());const s=o().changes.create_change("CreateEvent",i);s.execute()}delete(e){if(this.is_protected()){u.warn("UI somehow allowing protected root deletion",{id:this.json.id(),options:e});return}const t=o().changes.create_change("RemoveElement",{root_path:this.json.parent().name(),id:this.id(),data:this.json.raw(),intent_details:{user_interaction:"Direct Root Delete",user_action:e==null?void 0:e.user_action,parent_user_action:e==null?void 0:e.parent_user_action,parent_id:e==null?void 0:e.parent_id}});t.execute()}};const d=e("../appquery");const p=e("../../editor/css")},{"../../editor/css":560,"../../lib":741,"../../logger":744,"../../u":823,"../../u/shared/mode_check":851,"../application/RAW":646,"../appquery":651,"../nodes":721,"./GenericElement":670,"./elements_utils":679,"core-js/modules/web.dom-collections.iterator.js":1123}],673:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");var r=l(e("./ElementInstance"));var i=a(e("../../constants/elements"));var s=l(e("../../u/shared/incremental"));function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function l(e){return e&&e.__esModule?e:{default:e}}class c extends r.default{constructor(e){super(e,r.default.modes.RUN);this.cached_server_props={};this.dynamic_catcher=false;this._server_states=void 0}state(e,t,n){var r;(r=this._server_states)!=null?r:this._server_states={};if(t!==undefined){this._server_states[e]=t;return}this.dynamic_catcher=true;const s=this._server_states[e];if(s===i.STATE_NOT_READY&&s!==t){throw Error()}if(typeof s==="function"&&!n){return s()}else{return s}}compute_properties(e){const t=this.element.E;if(t.solid_component){this.container=e;this._update_visible();this.mark_solid_initialized();this.children=[];if(this.element.can_have_children()){if(t.create_server_children){t.create_server_children(this)}else{const e=this.container.create_child(this);s.default.incremental_for_each(this.element.elements(),(e=>{if(e.exists()){this.children.push(new c(e))}}));this.child_container=e}}return t.solid_component.computeProperties(this)}else{return null}}find_instance_by_id(e){if(e==null){return null}const t=this.get_namespace();if(t==null){return null}if(t[e]!=null){return t[e]}const n=this.parent();const r=n==null?void 0:n.find_instance_by_id(e);if(r){return r}return null}is_visible(){this.dynamic_catcher=true;return this.element.is_visible_on_page_load()}is_visible_me(){this.dynamic_catcher=true;return this.element.is_visible_on_page_load()}is_animating(){this.dynamic_catcher=true;return false}}t.exports=c},{"../../constants/elements":61,"../../u/shared/incremental":848,"./ElementInstance":669,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123}],674:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i,s;function o(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const a=e("../../u");const l=e("../../lib");const c=e("../nodes");const u=e("../caching");const d=e("../shrink");const{S:p}=d;const _=e("./elements_utils");let f=(r=u.cached({type:u.RUN_MODE}),i=u.cached({type:u.RUN_MODE}),s=class e extends c.AppNode{property(e){return c.new_expression(this.json._gchild(p.properties,d.shrink(e)),this)}get_injected_value(){var e,t;return(e=(t=this.context_element().E).get_injected_value)==null?void 0:e.call(t,this.context_element())}get_injected_display(){var e,t;return(e=(t=this.context_element().E).get_injected_display)==null?void 0:e.call(t)}properties(){return this.json._child(p.properties).child_names().map((e=>this.property(e)))}find_expressions(e){return c.from_raw_array(this.json,c.new_expression,_.state_find_expressions(c.to_raw(this),e))}rel_path(){return"states."+this.json.name()}get_static_property(e){return this.property(e).get_static()}context_element(){return c.new_element(this.json.parent().parent())}root(){return this.context_element().root()}no_margins(){return this.context_element().no_margins()}get_containing_element(){return this.context_element().get_containing_element()}added_to_container(){return this.context_element().added_to_container()}force_fixed(){return this.context_element().force_fixed()}not_resizable(){return this.context_element().not_resizable()}uses_css_responsive(){return this.context_element().uses_css_responsive()}has_fixed_aspect_ratio(){return this.context_element().has_fixed_aspect_ratio()}is_fixed_dimension(e){return this.context_element().is_fixed_dimension(e)}can_be_variable_width(){return this.context_element().can_be_variable_width()}not_max_adjustable(){return this.context_element().not_max_adjustable()}type(){return this.context_element().type()}get_style_if_exists(){return this.context_element().get_style_if_exists()}element_version(e){return this.context_element().element_version(e)}get_type_display(){return this.context_element().get_type_display()}check_for_errors(e){const t=this.context_element();const n=this.condition().get_eval_value();if(n.matches("null")){if(this.property_names().length>0){e(t.display()+" - remember to fill out when we should show this conditional state",this.condition())}}else if(!n.matches("sys.bool")){e(t.display()+' - states must evaluate to "yes" or "no", but this is a '+n.display(),this.condition())}const r=[];for(const n of this.property_names()){const i=a.extend({},t._field_data(n,true));const s=l().getChecker(this,i);const o=s.type_check((()=>t.display()+" (state)"),e);if(o){r.push(this.property(n))}}return{children:[this.condition(),...r]}}find_in_editor(e,t,n){a.run_once(30,(()=>this.context_element()),((e,r)=>{r.find_in_editor_raw((()=>{l().property_editor.current_tab("conditional");a.wait_for_updates(t)}),n)}))}set_condition(e){const t=this.condition().raw();if(JSON.stringify(t)===JSON.stringify(e)){return}const n=this.context_element().id();const r=this.rel_path()+".condition";const i=l().changes.create_change("SetData",{target_id:n,path:r,old_value:t,value:e});i.execute()}set_property(e,t){const n=this.property(e).raw();if(JSON.stringify(n)===JSON.stringify(t)){return}const r=this.context_element().id();const i=this.rel_path()+".properties."+e;const s=l().changes.create_change("SetData",{target_id:r,path:i,old_value:n,value:t});s.execute()}delete(){const e=this.context_element().id();const t=l().changes.create_change("RemoveState",{element_id:e,name:this.json.name(),data:this.json.raw()});t.execute()}rank(){return this.context_element().states().map((e=>e.json.name())).indexOf(this.json.name())}move_up(){const e=this.context_element().id();const t=this.rank();const n=this.rank()-1;const r=l().changes.create_change("ReorderState",{element_id:e,old_index:t,new_index:n});r.execute()}move_down(){const e=this.context_element().id();const t=this.rank();const n=this.rank()+1;const r=l().changes.create_change("ReorderState",{element_id:e,old_index:t,new_index:n});r.execute()}property_names(){return this.json._child(p.properties).children().map((e=>e.name()))}condition(){return c.new_expression(this.json._child(p.condition),this)}},o(s.prototype,"property_names",[r],Object.getOwnPropertyDescriptor(s.prototype,"property_names"),s.prototype),o(s.prototype,"condition",[i],Object.getOwnPropertyDescriptor(s.prototype,"condition"),s.prototype),s);t.exports=f},{"../../lib":741,"../../u":823,"../caching":656,"../nodes":721,"../shrink":728,"./elements_utils":679,"core-js/modules/web.dom-collections.iterator.js":1123}],675:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i,s;function o(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const a=e("../../u");const l=e("../../u/shared/decaf");const c=e("../../lib");const u=e("../../logger");const d=e("../caching");const p=e("../evaluation/evaluate_static");const _=e("../nodes");const f=e("../application/RAW");const h=e("../shrink");const{S:m}=h;const g=e("../../constants/elements");const v=e("./elements_utils");const b=e("./elements_state");const y=e("./property_sections");const w=e("./missing_element");const x=e("./Transition");const j=e("lodash/debounce");const A=e("../../optional/analytics");const M=e("../../constants/segment_events");let E=(r=d.cached({type:d.RUN_MODE}),i=d.cached({type:d.RUN_MODE}),s=class e extends _.HasProperties{constructor(){super(...arguments);this.debounce_element_style_event=j((e=>{A.track(M.ELEMENT_STYLE_EDITED,{style_name:this.name(),name:e,appname:k.appname(),element_type:this.type()})}),200)}is_style(){return true}root(){return null}is_responsive_v1(){return true}get_type_display(){return v.get_short_display(this.type())}from_theme(){return this.json.child("from_theme").get()}theme_display(){return this.json.child("theme_display").get()}display(){var e;return(e=this.json.child("display").get())!=null?e:""}set_display(e){const t=this.display();if(t!==e){const n=c().changes.create_change("SetStyleData",{style_name:this.name(),name:"display",value:e,old_value:t});n.execute();this.commit()}}set_name(e){this.set_display(e)}set_property(e,t){var n;if(typeof((n=t)==null?void 0:n.raw)==="function"){t=t.raw()}const r=this.property(e).raw();if(JSON.stringify(r)===JSON.stringify(t)){return}const i=c().changes.create_change("SetStyleData",{style_name:this.name(),name:e,value:t,old_value:r});i.execute();this.debounce_element_style_event(e)}check_for_errors(e){return{children:this.states()}}parent(){return null}field(e){return this.fields().find((t=>t.name===e))}name(){return this.json.name()}id(){return this.name()}type(){return this.json.child("type").get()}property_supports_states(){return true}property_supports_transitions(){return true}mandatory_sections(){return[]}get_styleable_static_property(e){return this.get_static_property(e)}get_element_from_style(){const e=this.json.exists();if(!e){return null}if(!this.json.child("id").get()||!this.json.to_id().child("type").get()){u.warn("legacy situation, no id or type on style",{path:this.json.path(),value:this.json.raw()});this.json.child("id").set(this.name(),{name:"LegacyStyleChange"});c().changes.set_id_cache({json:this.json,data:this.json.raw()})}return _.new_element(this.json,true)}E_object(){var e;if(!this.type()){return w}return(e=c().load_plugin(c().plugin_prefixes.element+this.type(),true))!=null?e:w}get_width(){return this.get_default("width")}get_height(){return this.get_default("height")}get_default(e){var t,n;return(t=this.field_names())==null?void 0:(n=t[e])==null?void 0:n.default}context_element(){return this}force_fixed(){return false}get_value_id(){return"style."+this.type()}get_style_id(){return null}get_style_if_exists(){return null}element_version(e){return k.get_public_setting("style_version")}state_by_name(e){return _.create(_.STYLE_STATE,this.json.child("states").child(e))}transitions(){return _.enhance_array(this.json.child("transitions").children().map((e=>_.create(_.TRANSITION,e,this))))}transition(e){return _.create(_.TRANSITION,this.json.child("transitions").child(e),this)}_fields(e){return this.E_object().fields(this,e)}use_responsive_algorithm(){return k.get_public_setting("no_legacy_responsive")}get_property_applications(){const e=this.E_object();if(typeof e.property_applications==="function"){return e.property_applications(this)}else{return e.property_applications}}property_sections(e){var t;return(t=y.for_mode[e])!=null?t:y.for_mode.all}new_state(e){const t=c().changes.create_change("NewStyleState",{style_name:this.name(),name:k.uid(),data:e!=null?e:f.State()});t.execute()}is_on_edit_mode(e){const t="state:"+e.toUniqueString();return b.is_state_on_edit_mode(t)}toggle_state_edit_mode(e){const t="state:"+e.toUniqueString();b.toggle_state_edit_mode(t)}add_transition(e){const t=c().changes.create_change("AddTransition",{element_id:this.name(),prop_name:e,data:x.default_transition});t.execute();this.commit()}find_in_editor_raw(e){this.find_in_editor(undefined,e)}find_in_editor(e,t){$(O.STYLES_TAB).click();a.wait_for_updates((()=>{if(this.type()!==c().styles_editor.element_styles_editor().element_type_node.get()){c().styles_editor.element_styles_editor().element_type_node.set(null)}c().styles_editor.element_styles_editor().currently_displayed_style(this.id());a.wait_for_updates((()=>{c().property_editor.current_tab("appearance");if(e){t==null?void 0:t(window.is_maison?$(`[key='${this.id()}'].style-list-item`):$(`[key='${this.id()}'].style-box`))}else{t==null?void 0:t()}}))}))}get_precomputed(){if(!this._precomputed){const e=this.json._raw_child(m.properties);const t={};l.object_entries(e).forEach((e=>{let[n,r]=e;const i=h.expand(n);t[i]=p.get_static(r)}));for(const e of this.states()){for(const n of e.property_names()){t[n]=g.NOT_STATIC_PROP}}this._precomputed=t}return this._precomputed}field_names(){if(!this.E_object()){return null}return this.E_object().field_names}states(){return _.enhance_array(v.get_states_from_raw_json(this.json).map((e=>_.create(_.STYLE_STATE,e))))}},o(s.prototype,"field_names",[r],Object.getOwnPropertyDescriptor(s.prototype,"field_names"),s.prototype),o(s.prototype,"states",[i],Object.getOwnPropertyDescriptor(s.prototype,"states"),s.prototype),s);t.exports=E;const k=e("../appquery");const O=e("../../editor/css")},{"../../constants/elements":61,"../../constants/segment_events":85,"../../editor/css":560,"../../lib":741,"../../logger":744,"../../optional/analytics":749,"../../u":823,"../../u/shared/decaf":844,"../application/RAW":646,"../appquery":651,"../caching":656,"../evaluation/evaluate_static":696,"../nodes":721,"../shrink":728,"./Transition":677,"./elements_state":678,"./elements_utils":679,"./missing_element":681,"./property_sections":682,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/debounce":1311}],676:[function(e,t,n){"use strict";const r=e("../../lib");const i=e("./elements_utils");const s=e("./State");const o=e("./Style");t.exports=class e extends s{context_element(){return new o(this.json.parent().parent())}toUniqueString(){return new s(this.json).toUniqueString()}delete(){const e=r().changes.create_change("RemoveStyleState",{style_name:this.context_element().name(),name:this.json.name(),data:this.json.raw()});e.execute()}set_condition(e){const t=this.condition().raw();if(JSON.stringify(t)===JSON.stringify(e)){return}if(!i._is_state_basic(e)){alert("This state should be basic: width/height, hovered, pressed, focused, clickable, or valid");return}const n=r().changes.create_change("SetStyleStateCondition",{style_name:this.context_element().name(),state_name:this.json.name(),value:e,old_value:t});n.execute()}set_property(e,t){const n=this.property(e).raw();if(JSON.stringify(n)===JSON.stringify(t)){return}const i=r().changes.create_change("SetStyleStateData",{style_name:this.context_element().name(),state_name:this.json.name(),name:e,value:t,old_value:n});i.execute()}check_for_errors(e){const t=this.context_element();if(!t.type()){return}const n=this.condition().get_eval_value();const r="Style "+t.display();if(n.matches("null")){if(this.property_names().length>0){return e(r+" - remember to fill out when we should show this conditional state",this.condition())}}else if(!n.matches("sys.bool")){return e(r+' - states must evaluate to "yes" or "no"',this.condition())}}}},{"../../lib":741,"./State":674,"./Style":675,"./elements_utils":679}],677:[function(e,t,n){"use strict";var r;const i=e("../../u");const s=e("../../logger");const o=e("../../lib");const a=e("../nodes");const l=["ease","ease-in","ease-out","ease-in-out","linear","step-start","step-end"];t.exports=(r=class e extends a.HasProperties{constructor(e,t){super(e);this.owner=t;if(!this.owner){s.error("transition created without owner")}}context_element(){var e;return(e=this.owner)!=null?e:a.new_element(this.json.parent().parent())}prop_name(){return this.json.name()}prop_name_display(){var e;const t=this.context_element().fields(true);const n=t.find((e=>e.name===this.prop_name()));if(!n){console.log("could not find property "+this.prop_name()+" on node "+this.context_element())}return(e=n.long_caption)!=null?e:n.caption}duration_node(){return this.json.child("duration")}duration(){return this.duration_node().get()}fn_node(){return this.json.child("fn")}fn(){return this.fn_node().get()}find_in_editor(e,t,n){i.run_once(30,(()=>this.context_element()),((r,s)=>{s.find_in_editor_raw((()=>{var n;if(((n=s.root())==null?void 0:n.get_responsive_version())>0){o().property_editor.current_tab("appearance")}else{o().property_editor.current_tab("transitions")}i.wait_for_updates((()=>{if(e){t==null?void 0:t($(`#${this.prop_name()}.transition.section`))}else{t==null?void 0:t()}}))}),n)}))}set_property(e,t){const n=this.property(e).raw();if(n===t){return}const r=o().changes.create_change("ModifyTransition",{element_id:this.context_element().id(),prop_name:this.prop_name(),sub_prop_name:e,value:t,old_value:n});r.execute();this.commit()}delete(){const e=o().changes.create_change("RemoveTransition",{element_id:this.context_element().id(),prop_name:this.prop_name(),data:{duration:this.duration(),fn:this.fn()}});e.execute();this.commit()}},r.transition_fns=l,r.default_transition={duration:200,fn:"ease"},r)},{"../../lib":741,"../../logger":744,"../../u":823,"../nodes":721}],678:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.toggle_state_edit_mode=n.seen_default_names=n.seen_custom_names=n.is_state_on_edit_mode=void 0;var r=e("../../u/shared/async/autorun");const i={};n.seen_custom_names=i;const s={};n.seen_default_names=s;let o,a;n.toggle_state_edit_mode=a;n.is_state_on_edit_mode=o;const l={};n.is_state_on_edit_mode=o=e=>{var t;(t=l[e])!=null?t:l[e]=(0,r.Box)(false);return l[e]()};n.toggle_state_edit_mode=a=e=>{const t=l[e];t(!t())}},{"../../u/shared/async/autorun":830}],679:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("../../u");const s=e("../../u/shared/b_object");const o=e("../../u/shared/mode_check");const a=e("../../lib");const l=e("../shrink");const c=e("../nodes");const u=e("../expressions/expression_utils");const d=e("../workflow/workflow_utils");const p=e("../../logger");const _=e("../../services/shared/service_type_parser");const{S:f}=l;const h=e("../evaluation/element_eval");const m=e("../../core/core_elements/legacy/responsive_v0/shared/containers");r._use_issue_checker=()=>{var e,t;return(e=(t=a().visual_edit)==null?void 0:t.issue_checker_on)!=null?e:true};const g=[];r.create_layout_resizing_keylist=function(e){const t=i.MakeKeyList();g.push(t);i.wait_for_updates((()=>{i.WaitFor(t,(()=>{i.array_remove(g,t);e()}))}))};r.add_layout_resizing_key=function(){const e=i.MakeKey(30,"layout_resizing_key");g.forEach((t=>{t.add_key(e)}));return e};r.make_opacity_transition=function(e,t){var n;let r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;const o=e.get_static_property("opacity",true);if(((n=e.element)==null?void 0:n.field("opacity"))==null&&o==null){return t.animation}if(r==null||r===""){r=o/100}else{r=parseFloat(r)}if(r===1){return t.animation}const a="custom_"+r+"_"+t.animation;let l=false;let c;if(t.animation in $.Velocity.RegisterEffect.packagedEffects){c=s.json_deep_copy($.Velocity.RegisterEffect.packagedEffects[t.animation])}else if(t.animation in i.custom_transitions){c=s.json_deep_copy(i.custom_transitions[t.animation])}else{p.warn("Could not find animation",{name:t.animation});return t.animation}for(const e of c.calls){if("opacity"in e[0]){if(typeof e[0].opacity==="number"){e[0].opacity*=r;l=true}else{e[0].opacity.forEach(((t,n)=>{if(typeof t==="number"){e[0].opacity[n]*=r;l=true}}))}}}if(l){window.$.Velocity.RegisterEffect(a,c)}return l?a:t.animation};r.perform_animate_in=function(e,t,n){var s,a,l,c,u;let d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;const p=e.get_canvas();d||(d=!e.element.E.uses_css_responsive);(s=e._transforms)!=null?s:e._transforms={};(l=(a=e._transforms).initial_transform)!=null?l:a.initial_transform=p[0].style.transform;const _=e.element.type()==="Dropdown";(u=(c=e._transforms).initial_opacity)!=null?u:c.initial_opacity=p[0].style.opacity;e._is_visible_me=true;e._update_visible();e._display_me();e.state("opacity_override",0);p[0].style.opacity=0;r.create_layout_resizing_keylist((()=>{if(e._has_been_hidden===true){return}i.run_once(30,(()=>{let s;if(!d){if(e._is_animating){s=e._instance_opacity}else{var a;e._instance_opacity=s;s=((a=h.evaluate_property(e,"opacity"))!=null?a:100)/100}}e.set_animating(true);const l=p.data("velocity");if(l){l.transformCache={}}const c=r.make_opacity_transition(e,t,s);i.velocity(p,c,{...n,complete_cb(){var t;e.set_animating(false);p[0].style.transform=e._transforms.initial_transform;if(_){p[0].style.opacity=e._transforms.initial_opacity}e._transforms=undefined;e.state("opacity_override",null);if(!o.running_test()&&(((t=e.element.root())==null?void 0:t.get_responsive_version())<1||!e.element.E.uses_css_responsive)){m.resize_container_width(e)}},display:""})}))}))};r.perform_animate_out=function(e,t,n){var s,o,a,l,c,u;let d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;const p=e.get_canvas();(s=p.velocity)==null?void 0:s.call(p,"stop",true);(o=e._transforms)!=null?o:e._transforms={};(l=(a=e._transforms).initial_opacity)!=null?l:a.initial_opacity=p[0].style.opacity;(u=(c=e._transforms).initial_transform)!=null?u:c.initial_transform=p[0].style.transform;const _=p.data("velocity");if(_){_.transformCache={}}const f={...e.get_hidden_css(),...n,complete_cb:()=>{e.set_animating(false);p[0].style.transform=e._transforms.initial_transform;p[0].style.opacity=e._transforms.initial_opacity;e._transforms=undefined;e._is_visible_me=false;e._update_visible();e.state("opacity_override",null);d==null?void 0:d()}};let h;if(e._is_animating){h=e._instance_opacity}else{h=p[0].style.opacity;e._instance_opacity=h;e.state("opacity_override",h)}e.set_animating(true);const m=r.make_opacity_transition(e,t,h);i.velocity(p,m,f)};r.get_states_from_raw_json=e=>e.child("states").children().filter((e=>e.exists()));function v(e){return c.create(c.STATE,e)}const b=/ /g;r.get_short_display=function(e){var t,n;const r=a().load_plugin(a().plugin_prefixes.element+e,true);return(t=r==null?void 0:(n=r.display)==null?void 0:n.replace(b,""))!=null?t:_.get_plugin_and_type(e)[1]};r.find_elements=function(e,t){if(!e){return[]}t=c.make_filter(t);const n=c.raw_children(e,f.elements);const i=[];for(const e of n){if(t(e)){i.push(e)}i.push(...r.find_elements(e,t))}return i};r.element_find_expressions=function(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!e||n[e._raw.id]){return[]}n[e._raw.id]=true;t=c.make_filter(t);const i=c.raw_properties(e,(e=>c.new_element(e)));const s=i.filter(t);const o=i.flatMap((e=>u.expression_find_expressions(e,t)));const a=c.raw_children(e,f.states);const l=a.flatMap((e=>r.state_find_expressions(e,t)));const p=c.raw_children(e,f.workflows);const _=p.flatMap((e=>d.event_find_expressions(e,t)));const h=r.find_elements(e);const m=h.flatMap((e=>r.element_find_expressions(e,t,n)));return[...s,...o,...l,..._,...m]};r.state_find_expressions=function(e,t){if(!e){return[]}t=c.make_filter(t);const n=[];function r(e){if(t(e)){n.push(e)}return n.push(...u.expression_find_expressions(e,t))}const i=c.raw_child(e,f.condition,e);if(i){c.set_owner(i,e,v);r(i)}for(const t of c.raw_properties(e,v)){r(t)}return n};const y=["is_focused","isnt_focused","isnt_pressed","is_pressed","isnt_hovered","is_hovered","isnt_valid","is_clickable","isnt_clickable","is_valid","isnt_valid","get_width","get_height"];r._is_state_basic=function(e){if(!e||!e.type){return true}let t;switch(e.type){case"Message":t=["or_","and_"].includes(e.name)&&r._is_state_basic(e.next);break;case"ThisElement":t=!e.next||y.includes(e.next.name);break;case"PageData":t=["Current Page Width","Current Page Scrolling Position"].includes(e.properties.name);break;case"CurrentUser":t=true;break;default:t=false}if(!t){return false}else if(!e.next||!e.next.next){return true}else if(["get_width","get_height"].includes(e.next.name)){e=e.next;if(!e.next.next){return true}}let n;switch(e.next.next.name){case"or_":case"and_":n=r._is_state_basic(e.next.next.args);break;case"is_true":case"is_false":n=r._is_state_basic(e.next.next.next);break;default:n=false}return n}},{"../../core/core_elements/legacy/responsive_v0/shared/containers":351,"../../lib":741,"../../logger":744,"../../services/shared/service_type_parser":785,"../../u":823,"../../u/shared/b_object":839,"../../u/shared/mode_check":851,"../evaluation/element_eval":690,"../expressions/expression_utils":710,"../nodes":721,"../shrink":728,"../workflow/workflow_utils":738,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],680:[function(e,t,n){"use strict";const r=n;const i=e("../nodes");const s=e("./elements_utils");const o=e("./elements_state");const a=e("./ElementInstance");const l=e("./ServerElementInstance");const c=e("./State");const u=e("./Transition");const d=e("./GenericElement");const p=e("./Element");const _=e("./Style");const f=e("./StyleState");const h=e("./CustomState");const m=e("./Root");const g=e("./Page");const v=e("./CustomDefinition");const b=e("../../constants/elements");i.add(i.STATE,c);i.add(i.TRANSITION,u);i.add(i.GENERIC_ELEMENT,d);i.add(i.ELEMENT,p);i.add(i.STYLE,_);i.add(i.STYLE_STATE,f);i.add(i.CUSTOM_STATE,h);i.add(i.ROOT,m);i.add(i.PAGE,g);i.add(i.CUSTOM_DEFINITION,v);i.add_generic("element",((e,t)=>e.smart_cache("element",y,t)));function y(e,t){const n=e.child("type").get();if(n==="Page"){return new g(e)}else if(n==="CustomDefinition"){return new v(e)}else{return new p(e,t)}}r.ElementInstance=function(e,t){return new a(e,t)};r.ServerElementInstance=e=>new l(e);r.STATE_NOT_READY=b.STATE_NOT_READY;r.NOT_STATIC=b.NOT_STATIC_PROP;r.seen_custom_names=o.seen_custom_names;r.seen_default_names=o.seen_default_names;r.create_layout_resizing_keylist=s.create_layout_resizing_keylist;r.add_layout_resizing_key=s.add_layout_resizing_key;r.perform_animate_in=s.perform_animate_in;r.get_short_display=s.get_short_display;r._is_state_basic=s._is_state_basic;for(const e in a.modes){const t=a.modes[e];r[e]=t}r.transition_fns=u.transition_fns;const w=e("../../db/db");w.ElementInstance=a;e("../workflow");e("../expressions")},{"../../constants/elements":61,"../../db/db":427,"../expressions":711,"../nodes":721,"../workflow":737,"./CustomDefinition":666,"./CustomState":667,"./Element":668,"./ElementInstance":669,"./GenericElement":670,"./Page":671,"./Root":672,"./ServerElementInstance":673,"./State":674,"./Style":675,"./StyleState":676,"./Transition":677,"./elements_state":678,"./elements_utils":679}],681:[function(e,t,n){"use strict";const r=e("../../core/core_elements/core_elements_utilities/element_meta_actions");const{EditorType:i}=e("./types");const{PLUGIN_TAB:s}=e("../../editor/css");t.exports={get_html(){return"<div>missing element</div>"},fields(e){const t=[{name:"information",label_text:"This element was offered by a plugin that has been deleted. You can reinstall the plugin to keep using the element or delete the element with the button below.",click_cb(){return $(s).click()},editor:i.Label,pretty:{section:"InputContent"}}];t.push(r.replace_element_property(e));t.push(r.delete_element_property(e));t.push(r.select_parent_property(e));t.push(r.reveal_in_tree_property(e));return t},field_names:{},is_visible_on_page_load(){return true},initialize(){},property_applications:[],add_an_invisible_div_on_the_top:false}},{"../../core/core_elements/core_elements_utilities/element_meta_actions":282,"../../editor/css":560,"./types":685}],682:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.for_mode=void 0;let r;n.for_mode=r;const i=[{name:"ChangeMultiElements",show_title:false}];const s=[{name:"Text",show_title:false},{name:"TextResponsive",show_title:false},{name:"PageTitle",show_title:false},{name:"Image",show_title:false},{name:"InputContent",show_title:false},{name:"AddToAnyContent",show_title:false},{name:"AudioRecordContent",show_title:false},{name:"DisqusContent",show_title:false},{name:"FacebookContent",show_title:false},{name:"IonicContent",show_title:false},{name:"MultiFileContent",show_title:false},{name:"ProgressBarContent",show_title:false},{name:"RecaptchaContent",show_title:false},{name:"RichTextLegacyContent",show_title:false},{name:"SlidebarMenuContent",show_title:false},{name:"StarRatingContent",show_title:false},{name:"TwilioVideoContent",show_title:false},{name:"PluginElement",show_title:false},{name:"CheckboxContent",show_title:false},{name:"FileInputContent",show_title:false},{name:"SliderContent",show_title:false},{name:"DropdownContent",show_title:false},{name:"DateInputContent",show_title:false},{name:"CalendarContent",show_title:false},{name:"CalendarFormat",show_title:false},{name:"MapContent",show_title:false},{name:"MapFormat",show_title:false},{name:"CarouselContent",show_title:false},{name:"CarouselFormat",show_title:false},{name:"ChartContent",show_title:false},{name:"ChartFormat",show_title:false},{name:"LinkBehavior",show_title:false},{name:"VideoBehavior",show_title:false},{name:"HTML",show_title:false},{name:"IconStyle",show_title:false},{name:"FloatingReference",show_title:false},{name:"GroupType",show_title:false},{name:"Parameters",show_title:false},{name:"RepeatingGroupLayout",show_title:false},{name:"TableProperties",show_title:false},{name:"TableGroupLayout",show_title:false},{name:"TableType",show_title:false},{name:"TableContent",show_title:false},{name:"StartWorkflow",show_title:false}];const o=[{name:"ResponsiveContainer",show_title:false},{name:"ShortPosition",show_title:false},{name:"Position",show_title:false},{name:"Responsive",show_title:false},{name:"Position2",show_title:false},{name:"Margins",show_title:false}];const a=[{name:"ElementStyle",show_title:false},{name:"Appearance Settings",show_title:false},{name:"Opacity",show_title:false},{name:"Font",show_title:false},{name:"PlaceholderColor",show_title:false},{name:"CenterVertically",show_title:false},{name:"BackdropBackground",show_title:false},{name:"Stripes",show_title:false},{name:"Background",show_title:false},{name:"ButtonBackground",show_title:false},{name:"Border",show_title:false},{name:"Padding",show_title:true},{name:"InputPadding",show_title:false},{name:"FontShadow",show_title:false},{name:"Boxshadow",show_title:false},{name:"ToolTipRotation",show_title:false}];const l=[{name:"ElementMetaActions",show_title:false},{name:"SearchEngineData",show_title:false},{name:"UniqueID",show_title:false},{name:"PageFolder",show_title:false}];const c=[{name:"PaddingFields",show_title:false}];n.for_mode=r={all:i.concat(s).concat(o).concat(c).concat(a).concat(l),layout:i.concat(o).concat(c),styles_layout:c,legacy_layout:i.concat(c),responsive:i.concat(o).concat([{name:"ElementMetaActions",show_title:false}]),legacy_appearance:i.concat(s).concat(o).concat(a).concat([{name:"Transitions",show_title:false}]).concat(l),appearance:i.concat(s).concat(a).concat([{name:"SizingPreviews",show_title:false},{name:"Transitions",show_title:false}]).concat(l)}},{}],683:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.element_counts=n.counts=n.LifecycleEvent=n.DrawReason=n.DrawPhase=void 0;n.get_current_phase=h;n.measure_initial_draw=f;n.record_defer=p;n.record_lifecycle=_;n.with_draw_reason=d;var r=i(e("../../u/shared/Counter"));function i(e){return e&&e.__esModule?e:{default:e}}let s=function(e){e["Unknown"]="Unknown";e["DeferFlagOff"]="DeferFlagOff";e["VisibleOnPageLoad"]="VisibleOnPageLoad";e["BecameVisible"]="BecameVisible";e["CantDefer"]="CantDefer";e["NeedsChildrenSize"]="NeedsChildrenSize";e["SizeNeeded"]="SizeNeeded";return e}({});n.DrawReason=s;let o=function(e){e["Constructed"]="Constructed";e["Registered"]="Registered";e["Drawn"]="Drawn";return e}({});n.LifecycleEvent=o;let a=function(e){e["NotStarted"]="NotStarted";e["InitialDraw"]="InitialDraw";e["PostInitialDraw"]="PostInitialDraw";return e}({});n.DrawPhase=a;const l={draw_phase:a.NotStarted,draw_reason:s.VisibleOnPageLoad};const c={lifecycle:r.default.onClient(),elements:{initially_drawn:r.default.onClient().withTotal(),initially_deferred:r.default.onClient(),eventually_drawn:r.default.onClient().withTotal()}};n.counts=c;const u={element_instances:r.default.onClient().withTotal()};n.element_counts=u;if(typeof window!=="undefined"){window.element_performance_counts=c}function d(e,t){const n=l.draw_reason;try{l.draw_reason=e;return t()}finally{l.draw_reason=n}}function p(e){if(l.draw_phase===a.InitialDraw){c.elements.initially_deferred.add(e)}}function _(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;c.lifecycle.add(e,t);const{draw_phase:n,draw_reason:r}=l;if(e===o.Drawn){if(n===a.InitialDraw){c.elements.initially_drawn.add(r,t)}else{c.elements.eventually_drawn.add(r,t)}}}function f(e,t){const{deferred_drawing_enabled:n=false}=e;l.draw_phase=a.InitialDraw;l.draw_reason=s.VisibleOnPageLoad;try{t()}finally{l.draw_phase=a.PostInitialDraw;l.draw_reason=s.Unknown}if(n){const e=c.elements.initially_drawn;return{deferred_drawing_enabled:true,elements_initially_drawn:e.total,elements_initially_deferred:c.elements.initially_deferred.total,elements_drawn_because_visible:e.get(s.VisibleOnPageLoad),elements_drawn_because_undeferrable:e.get(s.CantDefer),elements_drawn_because_size:e.get(s.NeedsChildrenSize)}}else{return{deferred_drawing_enabled:false}}}function h(){return l.draw_phase}},{"../../u/shared/Counter":826}],684:[function(e,t,n){"use strict";const r=n;const i={};r.register_style_property=e=>{i[e]=true};r.get_style_properties=()=>i;r.is_style_property=e=>i[e]===true},{}],685:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.EditorType=void 0;let r=function(e){e["ShortText"]="ShortText";e["LongText"]="LongText";e["Basic"]="Basic";e["NoEditor"]="NoEditor";e["CheckBox"]="Checkbox";e["StaticText"]="StaticText";e["StaticDate"]="StaticDate";e["StaticMultiLineText"]="StaticMultiLineText";e["StaticNumber"]="StaticNumber";e["CSSDimension"]="CSSDimension";e["Color"]="Color";e["Image"]="Image";e["IconPicker"]="IconPicker";e["DynamicImage"]="DynamicImage";e["DynamicFile"]="DynamicFile";e["Dropdown"]="Dropdown";e["Label"]="Label";e["Button"]="Button";e["CropButton"]="Crop_Button";e["GeographicSearch"]="GeographicSearch";e["CheckboxList"]="CheckboxList";e["StaticList"]="StaticList";e["ObjectList"]="ObjectList";e["FlyoutObjectList"]="FlyoutObjectList";e["DropdownButton"]="Dropdown_Button";return e}({});n.EditorType=r},{}],686:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../u");class s extends Array{is_equal_to(e){return Array.isArray(e)&&e.length===this.length&&this.every(((t,n)=>i.compare(t,e[n])))}toString(){return"Enhanced Array: "+this.to_array()}to_array(){return Array.from(this)}sort(e){return this.constructor.from(this.to_array().sort(e))}}s.prototype[Symbol.isConcatSpreadable]=true;r.EArray=s;r.build_class=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const n=class extends s{};Object.assign(n.prototype,t);e.forEach((e=>{var t,r;(r=(t=n.prototype)[e])!=null?r:t[e]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}return this.flatMap((t=>{if(t==null){return null}else if(typeof t[e]!=="function"){throw new i.UnexpectedError("EArray child missing",{name:e})}else{return t[e](...n)}}))}}));return n}},{"../u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],687:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");e("core-js/modules/es.error.cause.js");const r=e("../../u");const i=e("../../u/shared/async/b_fiber");const s=e("../../db/hydrate");const o=e("../../u/shared/async/async_state");const a=e(".././../logger");const l=e("../../constants/eval");const c=e("../../shared/investigations");const u=e("../../u/shared/decaf");const d=e("./node_eval");const p=e("../../core/core_datasources/utilities/core_ds_element_utilities");const _=e("./page_state");const f=e("./state_keys");const h="NOT_FOUND";function m(e,t){const n=g.dehydrate_context;try{g.dehydrate_context=e;return t()}finally{g.dehydrate_context=n}}class g{static from_client_state(e,t){const n=new g(t);r.extend(n,e);return n}static deserialize(e,t){const n=new g(e);r.extend(n,t);return n}constructor(e){this.context=e;if(this.context.frozen_state){throw new r.UnexpectedError("this frozen state already has a context")}this.context.frozen_state=this;this.cache={};this.exists={};this.trustworthy={};this.element_instances={};this.element_state={};this.other_data={};this.unshrunk_keys={};this.raw_access_log=[]}_save_element_instance(e,t,n){if(n){var r,i;(i=(r=this.element_instances)[t])!=null?i:r[t]=h}else{var o,a,l,c,u,d;const n={dehydrated:s.dehydrate_tree(e),parent_element_id:s.dehydrate_tree((o=e.parent())==null?void 0:o.element_id())};(l=(a=this.element_instances)[t])!=null?l:a[t]=n;(d=(c=this.element_instances)[u=e.toUniqueString()])!=null?d:c[u]=n;if(e.element.type()==="CustomElement"&&e.element_id()!==t){var p,_,f;(f=(p=this.element_instances)[_=`${e.toUniqueString()}:${t}`])!=null?f:p[_]=n}}}instance_id_not_found(e){return this.element_instances[e]===h}element_id_to_instance_id(e,t){if(this.instance_id_not_found(e)){throw new r.UnexpectedError("instance id not found -- should not hit this",{element_id:e})}const n=this.element_instances[e];if(!n){const n=this.element_instances[t];if(n!=null){a.warn("using fallback dehydrated, why is this not in frozen state?",{element_id:e,fallback_id:t});return n.dehydrated}throw new r.UnexpectedError("could not find element id in frozen state",{element_id:e})}return n.dehydrated}element_id_to_parent_element_id(e,t){if(this.instance_id_not_found(e)){throw new r.UnexpectedError("instance id not found -- should not hit this",{element_id:e})}const n=this.element_instances[e];if(!n){const n=this.element_instances[t];if(n!=null){a.warn("using fallback parent_element_id, why is this not in frozen state?",{element_id:e,fallback_id:t});return n.parent_element_id}throw new r.UnexpectedError("could not find element id in frozen state",{element_id:e})}return n.parent_element_id}shorten(e){e=String(e);if(e.length>50){return r.incremental_digest(e)}else{return e}}freeze_node(e){return this._build_freeze_promise((()=>{this._freeze_current_element();this._find_element_references(e,"find_expressions")}))}freeze_workflows(e,t){const n=this._build_freeze_promise((()=>{this._freeze_workflows(e)}));n.callback(t)}_build_freeze_promise(e){return r.run_once(60,(()=>{r.ensure_ready(r.scheduled_key,false);b().app_language();const t={};return m({instance:e=>{if(!t[e.toUniqueString()]){t[e.toUniqueString()]=true;this._save_element_instance(e,e.element_id())}},save_to_state:(e,t,n)=>{var r,i,o,a;const l=s.dehydrate_tree(e);(i=(r=this.element_state)[l])!=null?i:r[l]={};(a=(o=this.element_state[l])[t])!=null?a:o[t]=s.dehydrate_tree(n!=null?n:null)}},(()=>e()))}),null,true)}_freeze_current_element(){if(this.context.element){const f=p.get_runtime_parent(this.context);if(f){var e,t,n,r,i;let p=s.dehydrate_tree(f);this._save_element_instance(f,f.element_id());(n=(e=this.element_state)[t=p])!=null?n:e[t]={};(i=(r=this.element_state[p]).group_data)!=null?i:r.group_data=s.dehydrate_tree(f.state("group_data"));let h=f;const m=[];while(h!=null&&h.element.type()!=="GroupItem"){var o,a;h=(o=(a=h).parent)==null?void 0:o.call(a);m.push(h)}if(h){var l,c,u,d,_;for(const e of m){p=s.dehydrate_tree(e);this._save_element_instance(f,p)}p=s.dehydrate_tree(h);(u=(l=this.element_state)[c=p])!=null?u:l[c]={};(_=(d=this.element_state[p]).cell_index)!=null?_:d.cell_index=h.state("cell_index")}}this._save_element_instance(this.context.element,this.context.element.element_id())}}_freeze_workflows(e,t){var n;(n=t)!=null?n:t={};for(const n of e){let e=n;while(e){this._freeze(e);if(["TriggerCustomEvent","TriggerCustomEventFromReusable"].includes(e.type())){const n=v.event(e.get_static_property("custom_event"));if(n.exists()){if(t[n.id()]!=null){if(t[n.id()]!=="REPORTED"){t[n.id()]="REPORTED";a.owner_error("This custom event is triggering a custom event that triggers itself (directly or indirectly)",{event:n})}}else{let s;if(e.type()==="TriggerCustomEventFromReusable"){var i;s=this.context.element;this.context.element=(i=this.context.element)==null?void 0:i.find_instance_by_id(e.get_static_property("element_id"))}try{const i={};i[n.id()]="SEEN";this._freeze_workflows([n],r.extend({},t,i))}finally{if(e.type()==="TriggerCustomEventFromReusable"){this.context.element=s}}}}}e=e.next()}}this._freeze_current_element()}has_invalid_state(){for(const e of u.object_values(this.element_state)){for(const t of u.object_values(e)){if(t!=null&&t[l.NV_MARKER]){return true}}}return false}retrieve_element_state(e,t){var n;const i=s.dehydrate_tree(e);const o=(n=this.element_state[i])==null?void 0:n[t];if(o!=null&&o[l.NV_MARKER]){throw new r.UnexpectedError("not valid input data made it to server")}if(o!==undefined){return s.rehydrate_tree(b().db_instance(),o)}else{if(t==="value"){return this.retrieve_element_state(e,"value_that_is_valid")}throw new r.UnexpectedError("trying to retrieve missing element state",{instance_id:i,state:t})}}_freeze(e){if(!e.is_action()){if(b().workflow.uses_server(e)){var t,n;(n=(t=this.context)._temp_db_instance)!=null?n:t._temp_db_instance=y.new_instance();let r=b().current_user();if(r){r=this.context._temp_db_instance.get(r._id())}b.extend({db_instance:this.context._temp_db_instance,current_user:r},(()=>{d.evaluate_event_condition(e,this.context)}))}else{d.evaluate_event_condition(e,this.context)}}const r=e.element_id();if(r!=null){var i;const e=(i=this.context.element)==null?void 0:i.find_instance_by_id(r);if(e){this._save_element_instance(e,r)}else{this._save_element_instance(null,r,true)}}this._find_element_references(e,"find_my_expressions")}_find_element_references(e,t){let n=e[t]("GetElement");for(const e of n){const t=e.element_id();this._add_element(t,e)}n=e[t]("ThisElement");for(const e of n){const t=e.context_element().id();this._add_element(t,e)}n=e[t]("ElementAncestor");for(const e of n){const t=e.get_static_property("ancestor_type");const n=p.get_ancestor_element(t,e);this._add_element(n.id(),e);if(t==="TableMainAxis"){const t=n.parent();this._add_element(t.id(),e)}}const r=e=>{var t;return e._raw[A.type]==="GetDataFromAPI"&&((t=e._raw[A.properties])==null?void 0:t.provider)==="ipify.GetIP"};for(const n of e[t](r)){w.evaluate_json(n.json,this.context)}if(!this.other_data["Current Position"]&&e[t]("PageData.\name=Current Position").length>0){this.other_data["Current Position"]=_.get_page_data("Current Position",this.context)}if(!this.other_data["Current Page Scroll Position"]){this.other_data["Current Page Scroll Position"]=_.page_current_scroll_position()}if(!this.other_data["Current Page Width"]){this.other_data["Current Page Width"]=_.page_width()}}_add_element(e,t){var n;const r=(n=this.context.element)==null?void 0:n.find_instance_by_id(e);if(!r){this._save_element_instance(null,e,true)}else{var i;const n=s.dehydrate_tree(r);this._save_element_instance(r,e);const l=t.next();const c=l==null?void 0:(i=l.name)==null?void 0:i.call(l);if(c){var o,a;(a=(o=this.element_state)[n])!=null?a:o[n]={};const t=x.get("element."+e).get_message(c);const i={state:e=>{const t=r.state(e);this.element_state[n][e]=s.dehydrate_tree(t!=null?t:null);if(typeof t==="string"&&r.is_secure()){if(t.trim().length>2){var i,o;(o=(i=this.other_data).secure_list)!=null?o:i.secure_list=[];this.other_data.secure_list.push(t.trim())}}return t},is_visible:()=>{const e=r.is_visible();this.element_state[n].is_visible=s.dehydrate_tree(e!=null?e:null);return e},toUniqueString:()=>r.toUniqueString(),element:r.element,element_id:()=>r.element_id(),find_instance_by_id:e=>r.find_instance_by_id(e),is_destroyed:()=>r.is_destroyed(),run_mode:()=>r.run_mode(),get_static_property:(e,t)=>r.get_static_property(e,t),_watchers:r._watchers,_created_watchers:r._created_watchers,is_fake_instance:true};t.evaluate(i,null,null,null,this.context)}}}clone(e){const t=new g(e);for(const e of["cache","exists","element_instances","element_state","other_data"]){t[e]=r.json_deep_copy(this[e])}for(const e of u.object_values(t.element_state)){for(const[t,n]of u.object_entries(e)){if(n!=null&&n[l.NV_MARKER]){delete e[t]}}}return t}get_client_state(){return{element_instances:this.element_instances,element_state:this.element_state,other_data:this.other_data,cache:this.cache,exists:this.exists}}update_from_action(e,t,n,o){const a={};const c=(e,t)=>{this.set(e,t);a[e]={v:t}};const d=f.PreviousStep(e.id());if(t){c(d,t)}if(e.return_value().id()){c(d+"_value",e.return_value().id())}return n.then((t=>{var n;i.optional_pause();const c=(n=e.get_data_to_refresh(t,o))!=null?n:{};i.optional_pause();u.object_entries(c).forEach((e=>{let[t,n]=e;i.optional_pause();if(n!=null){if(n===l.NULL_VALUE_TO_REGISTER){n=null}this.set(t,n);a[t]={v:n}}else{this.clear(t);a[t]={x:true}}if(r.on_server()&&t.indexOf(l.ESTATE_PREFIX)===0){const e=t.replace(l.ESTATE_PREFIX,"");if(this.element_state[e]){u.object_entries(n).forEach((t=>{let[n,r]=t;i.optional_pause();if(r!=null){this.element_state[e][n]=s.dehydrate_tree(r)}}))}}}));return a}))}get(e){const t=this.shorten(e);const n=this.exists[t]?this.cache[t]:undefined;if(c.frozen_state_debugging.active()){this.push_raw_access_log({action:"get",key:e,short_key:t,value:n!=null?n:null})}const r=s.rehydrate_tree(b().db_instance(),n);return r}set(e){var t;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(((t=o.CurrentNotReadyCatcher)==null?void 0:t.length)>0){return}const r=this.shorten(e);const i=s.dehydrate_tree(n);this.cache[r]=i;this.exists[r]=true;if(c.frozen_state_debugging.active()){this.unshrunk_keys[r]=e;this.push_raw_access_log({action:"set",key:e,short_key:r,value:i})}}clear(e){const t=this.shorten(e);delete this.cache[t];delete this.exists[t];if(c.frozen_state_debugging.active()){this.push_raw_access_log({action:"clear",short_key:t})}}has_key(e){const t=this.shorten(e);const n=this.exists[t];if(c.frozen_state_debugging.active()){this.push_raw_access_log({action:"has_key",short_key:t,value:n!=null?n:false})}return this.exists[t]}push_raw_access_log(e){var t;let{action:n,key:r,short_key:i,value:s,rehydrated:o}=e;this.raw_access_log.push({action:n,short_key:i,key:r,value:s,rehydrated:o,timestamp:Date.now(),stack:((t=(new Error).stack)==null?void 0:t.split("\n").slice(2,52).join("\n"))||"Stack unavailable."})}is_trusted(e){if(r.on_client()){return true}else{const t=this.shorten(e);return this.trustworthy[t]===true}}trust(e){if(!r.on_client()){const t=this.shorten(e);this.trustworthy[t]=true}}serialize(){return{cache:this.cache,exists:this.exists,element_instances:this.element_instances,element_state:this.element_state,other_data:this.other_data}}}g.dehydrate_context=null;t.exports=g;const v=e(".././appquery");const b=e("../../lib");const y=e("../../db/client_db");const w=e("./evaluate");const x=e(".././btypes");const j=e(".././shrink");const{S:A}=j},{"../../constants/eval":64,"../../core/core_datasources/utilities/core_ds_element_utilities":234,"../../db/client_db":424,"../../db/hydrate":429,"../../lib":741,"../../shared/investigations":798,"../../u":823,"../../u/shared/async/async_state":829,"../../u/shared/async/b_fiber":833,"../../u/shared/decaf":844,".././../logger":744,".././appquery":651,".././btypes":653,".././shrink":728,"./evaluate":695,"./node_eval":697,"./page_state":698,"./state_keys":699,"core-js/modules/es.error.cause.js":1116,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],688:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.allow_overrides_check=void 0;var r=e("../../constants/elements");const i=(e,t,n)=>{var i,s,o;const a=e.element_version();(i=n)!=null?i:n=e.definition_or_self.field_names();const l=a>=r.VERSION_STYLE_OVERRIDES;const c=(s=((o=n[t])==null?void 0:o.allow_overrides)&&r.OLD_VERSION_OVERRIDE_PROPERTIES.includes(t))!=null?s:false;return l||c};n.allow_overrides_check=i},{"../../constants/elements":61}],689:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.edit_eval=l;n.get_border_widths=d;n.get_container_width=c;e("core-js/modules/web.dom-collections.iterator.js");var r=a(e("../../lib"));var i=a(e("./node_eval"));var s=a(e("../../safe_require"));var o=e("./allow_overrides_check");function a(e){return e&&e.__esModule?e:{default:e}}s.default.safe_register("./lang/evaluation/element_edit_eval",n);function l(e,t,n){var s;const a=n!=null?n:t==null?void 0:t.element;const l=a.get_style_if_exists();let c=null;const u=(t==null?void 0:t.responsive_mode())||((t==null?void 0:t.edit_mode())||(t==null?void 0:t.reusable_edit_mode()))&&t.element.is_responsive_v1()&&r.default.or_throw().visual_edit.responsive_mode_box()==="responsive";let d;if(u){d=r.default.or_throw().visual_edit.get_state_eval_context()}if(d){d=Object.assign(d,{element:t})}const p=[];if(l&&a.is_styleable_property(e)){p.push(...l.states())}p.push(...a.states());p.reverse();const _=p.find((t=>{if(!t.property_names().includes(e)){return false}else{return d?i.default.evaluate_state_condition(t,d):a.is_on_edit_mode(t)}}));c=(s=_==null?void 0:_.property(e))!=null?s:null;if(c===null){if(l&&a.is_styleable_property(e)&&(!(0,o.allow_overrides_check)(a,e)||a.definition_or_self.property(e).raw()==null)){c=l.property(e)}}if(c===null){c=a.property(e)}if(c.is_empty()){var f;return(f=a.get_default(e))!=null?f:null}else if(c.is_static()){return c.get_static()}else{const t=a.field(e);if((t==null?void 0:t.editor)==="Color"&&t!=null&&t.dynamic){var h;return(h=a.get_default(e))!=null?h:null}if(c.get_eval_value().matches("text")){const t=a.type()==="HTML"&&e==="html";return c.get_tree_display(t)}return null}}function c(e){if(e.E.get_container_width){return e.E.get_container_width(e)}else{const t=l("four_border_style",null,e)?u(e,"left")+u(e,"right"):2*u(e);return e.get_width()-t}}function u(e,t){const n=t?`_${t}`:"";const r=l(`border_style${n}`,null,e);if(r===undefined||r==="none"){return 0}else{var i;return(i=l(`border_width${n}`,null,e))!=null?i:0}}function d(e){const t=["left","right","bottom","top"];const n={};if(l("four_border_style",null,e)){for(const r of t){n[r]=u(e,r)}}else{const r=u(e);for(const e of t){n[e]=r}}return n}},{"../../lib":741,"../../safe_require":777,"./allow_overrides_check":688,"./node_eval":697,"core-js/modules/web.dom-collections.iterator.js":1123}],690:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.eval_property_with_states=T;n.evaluate_property=O;n.get_property_watcher=k;n.is_state_on=C;n.on_property_change=D;n.pre_cache=S;e("core-js/modules/web.dom-collections.iterator.js");var r=j(e("../../lib"));var i=x(e("../../logger"));var s=e("../shrink");var o=x(e("../../constants/elements"));var a=j(e("./node_eval"));var l=x(e("../../u/shared/errors"));var c=x(e("../../u/shared/async/b_fiber"));var u=x(e("../../u/shared/async/b_async"));var d=x(e("../../u/shared/async/autorun"));var p=j(e("../../u/shared/async/async_state"));var _=x(e("../../u/shared/mode_check"));var f=x(e("./element_edit_eval"));var h=x(e("./element_run_eval"));var m=j(e("../../core/core_elements/elements_versioning"));var g=x(e("./element_server_eval"));var v=j(e("../elements/ServerElementInstance"));var b=j(e("../../safe_require"));var y=e("./allow_overrides_check");function w(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(w=function(e){return e?n:t})(e)}function x(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=w(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function j(e){return e&&e.__esModule?e:{default:e}}b.default.safe_register("./lang/evaluation/element_eval",n);function A(e,t){if(r.default.or_throw().is_edit_mode()){return e=>f.edit_eval(t,e)}else{var n,i;(n=e._property_watcher_fns)!=null?n:e._property_watcher_fns={};let r;if(!_.on_server()&&(r=e._property_watcher_fns[t])){return r}const u=e.is_styleable_property(t)?e.get_style_if_exists():null;let d=e=>e.property_names().includes(t);const p=((i=u==null?void 0:u.states())!=null?i:[]).filter(d);const f=m.default.get_mapped_property(e.element_version(false),e.element_version(true),t);if(f){d=e=>e.property_names().includes(f)}p.push(...e.states().filter(d));let g;if(u&&(!(0,y.allow_overrides_check)(e,t)||e.definition_or_self.property(t).raw()==null)){if(p.length===0){return u.get_static_property(t)}}else{var a;let n=e.property(t).json._raw();if(((a=n)==null?void 0:a[s.S.type])==="Empty"){n=null}if(n==null||typeof n!=="object"){var l,c;g=(l=(c=n)!=null?c:e.get_default(t))!=null?l:null}else{g=o.NOT_STATIC_PROP}if(g!==o.NOT_STATIC_PROP&&p.length===0){return g}}e._property_watcher_fns[t]=n=>h.run_eval(t,u,p,g,n,e);return e._property_watcher_fns[t]}}function M(e,t){const n=A(e.element,t);if(typeof n!=="function"){return d.FakeWatcher(n)}const i=n;let s;if(t==="is_visible"){s=d.Watcher((()=>{e.evaluating_visibility=true;try{return i(e)}finally{e.evaluating_visibility=false}}))}else{s=d.Watcher((()=>i(e)))}if(!r.default.or_throw().is_edit_mode()){s.on_error((n=>e.on_run_eval_error(t,n)))}e.on_destroy((()=>s.destroy()));return s}function E(e,t,n){if(e._watchers[t]){return true}if(e._created_watchers[t]){return false}e._created_watchers[t]=true;e._watchers[t]=n();return true}function k(e,t){const n=E(e,t,(()=>M(e,t)));if(!n){throw new l.UnexpectedError("get_property_watcher called recursively")}return e._watchers[t]}function O(e,t,n){var r;if(e==null){return null}if(e.is_destroyed()){return null}if(["height","width"].includes(t)){var s;if(((s=e.element.root())==null?void 0:s.get_responsive_version())===0||!e.element.uses_css_responsive()){var a;if(!e.edit_mode()&&(a=e.element.root())!=null&&a.use_responsive_algorithm()){return e._dimension_box(t)}}else{return e.state(`current_${t}`)}}if(e.run_mode()){const n=e.element.get_precomputed();if(n[t]===undefined){var d;n[t]=(d=e.get_static_property(t,true))!=null?d:null}if(n[t]!==o.NOT_STATIC_PROP){return n[t]}}const _=E(e,t,(()=>M(e,t)));if(!_){const n=e.element.get_name(true);throw new l.OwnerError(`Recursion when evaluating property ${t} on element "${n}"`)}if(n){return}const[f,h,m]=e._watchers[t].get_current(true);if(m){return undefined}if(!p.default.CurrentAutoRun&&!p.default.CurrentNotReadyCatcher&&!((r=c.Fiber)!=null&&r.current)&&e.run_mode()){i.error("Calling evaluate_property outside of an autorun or watcher",{name:t})}if(!f){u.throw_not_ready(h);return undefined}return h}function S(e,t){for(const n of t){O(e,n,true)}}function D(e,t,n){const r=t=>{if(e.element.exists()&&!e.is_destroyed()){try{n(t)}catch(e){const n=e instanceof l.NotReadyError&&e.not_ready_key;if(!n){throw e}else{u.WaitFor(n,(()=>r(t)))}}}};let i;if(typeof t==="string"){if(e.run_mode()){i=e.element.get_precomputed();if(i[t]===undefined){var s;i[t]=(s=e.get_static_property(t,true))!=null?s:null}if(i[t]!==o.NOT_STATIC_PROP){r(i[t]);return}}const n=E(e,t,(()=>M(e,t)));if(!n){throw new l.UnexpectedError("on_property_change called recursively")}e._watchers[t].on_value(r);return}const a={};const c={};if(e.run_mode()){i=e.element.get_precomputed();let n=false;const s=t;for(const t of s){if(i[t]===undefined){var p;i[t]=(p=e.get_static_property(t,true))!=null?p:null}if(i[t]!==o.NOT_STATIC_PROP){a[t]=i[t]}else{n=true;const r=E(e,t,(()=>M(e,t)));if(!r){throw new l.UnexpectedError("on_property_change called recursively")}c[t]=e._watchers[t]}}if(!n){r(a);return}}else{const n=t;for(const t of n){const n=E(e,t,(()=>M(e,t)));if(!n){throw new l.UnexpectedError("on_property_change called recursively")}c[t]=e._watchers[t]}}const _=d.Watcher((()=>{const e={};Object.entries(c).forEach((t=>{let[n,r]=t;e[n]=r.get()}));Object.entries(a).forEach((t=>{let[n,r]=t;e[n]=r}));return e}));_.on_value(r);e.on_destroy((()=>_.destroy()))}function C(e,t){const n=`state:${t.toUniqueString()}`;const r=E(e,n,(()=>d.Watcher((()=>a.default.evaluate_state_condition(t,e.prop_eval_context())))));if(!r){const t=e.element.get_name(true);throw new l.OwnerError(`Recursion when evaluating a condition on element "${t}"`)}const[i,s]=e._watchers[n].get_current();return i&&s}function T(e,t,n){const r=n.element;const i=r.element.states().filter((e=>!e.property(t).is_empty()&&C(r,e)));if(i.length){const e=i[i.length-1];return a.default.eval_property(e,t,n)}else{return a.default.eval_property(e,t,n)}}},{"../../constants/elements":61,"../../core/core_elements/elements_versioning":320,"../../lib":741,"../../logger":744,"../../safe_require":777,"../../u/shared/async/async_state":829,"../../u/shared/async/autorun":830,"../../u/shared/async/b_async":832,"../../u/shared/async/b_fiber":833,"../../u/shared/errors":846,"../../u/shared/mode_check":851,"../elements/ServerElementInstance":673,"../shrink":728,"./allow_overrides_check":688,"./element_edit_eval":689,"./element_run_eval":692,"./element_server_eval":693,"./node_eval":697,"core-js/modules/web.dom-collections.iterator.js":1123}],691:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.get_font_face=d;n.is_fitting_height=g;n.is_fitting_width=m;n.max_height_css=h;n.max_width_css=_;n.min_height_css=f;n.min_width_css=p;var r=u(e("./element_eval"));var i=e("../../constants/elements");var s=l(e("../../webfonts"));var o=l(e("../../shared/responsive/responsive_layout"));var a=l(e("../../safe_require"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=c(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}a.default.safe_register("./lang/evaluation/element_props",n);function d(e){if(e.element.element_version(true)>=i.FONT_FAMILY_VERSION){var t,n;return s.default.to_font_face((t=r.evaluate_property(e,"font_family"))!=null?t:"",(n=r.evaluate_property(e,"font_weight"))!=null?n:"")}else{var o;return(o=r.evaluate_property(e,"font_face"))!=null?o:""}}function p(e){if(!e.element.E.uses_css_responsive){return`${e.element.get_min_width()}px`}if(e.element.can_be_variable_width()&&!e.element.force_fixed()){var t;return(t=r.evaluate_property(e,"min_width_css"))!=null?t:"0px"}else{return`${e.element.get_width()}px`}}function _(e){if(!e.element.E.uses_css_responsive){const t=e.element.get_max_width();return t!=null?`${t}px`:null}if(e.element.can_be_variable_width()&&!e.element.force_fixed()){if(e.get_static_property("single_width")){var t;return(t=r.evaluate_property(e,"min_width_css"))!=null?t:"0px"}else{var n;return(n=r.evaluate_property(e,"max_width_css"))!=null?n:null}}else{return`${e.element.get_width()}px`}}function f(e){if(!e.element.E.uses_css_responsive){return"0px"}if(e.element.can_be_variable_width()&&!e.element.force_fixed()){var t;return(t=r.evaluate_property(e,"min_height_css"))!=null?t:"0px"}else{return`${e.element.get_height()}px`}}function h(e){if(!e.element.E.uses_css_responsive){return null}if(e.element.can_be_variable_width()&&!e.element.force_fixed()){if(e.get_static_property("single_height")){var t;return(t=r.evaluate_property(e,"min_height_css"))!=null?t:"0px"}else{var n;return(n=r.evaluate_property(e,"max_height_css"))!=null?n:null}}else{return`${e.element.get_height()}px`}}function m(e){var t;if(!e.element.E.uses_css_responsive){return false}if(!e.element.can_fit_width()||e.element.force_fixed())return false;const n=(t=e.element.parent())==null?void 0:t.container_layout();if(n===o.default.DIMENSION_TO_CROSS_AXIS.width){return r.evaluate_property(e,"horiz_alignment")!=="stretch"&&e.element.fit_width()}else if(n===o.default.FIXED_LAYOUT){return false}else{return e.element.fit_width()}}function g(e){var t;if(!e.element.E.uses_css_responsive){return true}if(!e.element.can_fit_height()||e.element.force_fixed())return false;const n=(t=e.element.parent())==null?void 0:t.container_layout();if(n===o.default.DIMENSION_TO_CROSS_AXIS.height){return!e.get_static_property("single_height")&&r.evaluate_property(e,"vert_alignment")!=="stretch"}else if(n===o.default.FIXED_LAYOUT){return false}else{return e.element.fit_height()}}},{"../../constants/elements":61,"../../safe_require":777,"../../shared/responsive/responsive_layout":804,"../../webfonts":858,"./element_eval":690,"core-js/modules/web.dom-collections.iterator.js":1123}],692:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.run_eval=m;var r=h(e("../../logger"));var i=_(e("./node_eval"));var s=h(e("../../constants/elements"));var o=h(e("../../u/shared/mode_check"));var a=h(e("../../u/shared/async/b_async"));var l=_(e("../../webfonts"));var c=_(e("../../core/core_elements/elements_versioning"));var u=h(e("./element_props"));var d=h(e("./element_eval"));var p=e("./allow_overrides_check");function _(e){return e&&e.__esModule?e:{default:e}}function f(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(f=function(e){return e?n:t})(e)}function h(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=f(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function m(e,t,n,_,f,h){var m,g,v;(m=h)!=null?m:h=f==null?void 0:f.element;const b=n.filter((e=>d.is_state_on(f,e)));const y=b[b.length-1];const w=h.element_version(false);const x=h.element_version(true);const j=c.default.get_mapped_property(w,x,e);const A=j&&h.states().includes(y);const M=A?j:e;let E;if(y!=null&&(!y.property(M).is_empty()||(g=h.field_names()[M])!=null&&g.allow_empty_condition)){const t=f.prop_eval_context(true);E=i.default.eval_property(y,M,t);if(A){E=c.default.map_property(h.element_version(false),h.element_version(true),e,E)}}else if(t&&(!(0,p.allow_overrides_check)(h,e)||_==null)){E=t.get_static_property(e)}else if(_===s.NOT_STATIC_PROP){const t=f.prop_eval_context(true);E=i.default.eval_property(h,e,t,null,h.get_default(e))}else{E=_}if(["text","html"].includes(e)&&o.on_client()){a.ensure_ready(l.default.active_key);if(window.wait_for_individual_fonts){var k;let e=u.get_font_face(f);if((k=e)!=null&&k.includes("var(")){e=l.default.substitute_font_token(e)}if(e!=null){if(l.default.fontface_keys[e]==null){l.default.fontface_keys[e]=a.MakeKey(undefined,`webfont.fontface_key_${e}`);setTimeout((()=>{r.warn("fontface key never properly turned",{font_face:e});l.default.fontface_keys[e].turn()}),3e3)}a.ensure_ready(l.default.fontface_keys[e])}}else{a.ensure_ready(l.default.fontface_key)}}return(v=E)!=null?v:null}},{"../../constants/elements":61,"../../core/core_elements/elements_versioning":320,"../../logger":744,"../../u/shared/async/b_async":832,"../../u/shared/mode_check":851,"../../webfonts":858,"./allow_overrides_check":688,"./element_eval":690,"./element_props":691,"./node_eval":697,"core-js/modules/web.dom-collections.iterator.js":1123}],693:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.serverside_eval_prop=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=e("./allow_overrides_check");let i},{"./allow_overrides_check":688,"core-js/modules/web.dom-collections.iterator.js":1123}],694:[function(e,t,n){"use strict";const r=n;const i=e("../../u/shared/mode_check");const s=e("../../safe_require");s.safe_register("./lang/evaluation/eval_node_state",r);let o=null;r.get_current_eval_node=function(){return o};r.set_current_eval_node=function(e){o=e};if(i.on_server()){r.with_eval_node=(e,t)=>t()}else{r.with_eval_node=function(e,t){const n=o;o=e;try{return t()}finally{o=n}}}},{"../../safe_require":777,"../../u/shared/mode_check":851}],695:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.reduce=n.make_partial_expression_evaluator=n.evaluate_properties=n.evaluate_json=n.evaluate=n.create_reduced=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=A(e("lodash/isEqual"));var i=j(e("../../u"));var s=j(e("../../u/shared/async/b_fiber"));var o=j(e("../../db/hydrate"));var a=j(e("../../logger"));var l=j(e("../../shared/investigations"));var c=j(e("../../constants/eval"));var u=j(e("../../constants/lang"));var d=j(e("../nodes"));var p=j(e("../expressions/expression_utils"));var _=e("../app_json/json_utils");var f=j(e("../../db/values/db_values"));var h=j(e("./eval_node_state"));var m=j(e("./state_keys"));var g=j(e("../btypes"));var v=A(e("../../lib"));var b=j(e("../../geolocation/b_location"));var y=j(e("../shrink"));var w=A(e("../nodes/node_types"));function x(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(x=function(e){return e?n:t})(e)}function j(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=x(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function A(e){return e&&e.__esModule?e:{default:e}}const{S:M}=y;const E={};const k=function(e,t,n){var r;(r=e)!=null?r:e={};const i={};if(n===u.DETECT_FIELD_NAMES){for(const n in e){const r=e[n];const[s,o]=S(r,t,null,null);if(o==="reduced"){return E}i[y.expand(n)]=s}}else{for(const r in n){const s=e[y.shrink(r)];const o=n[r].default;switch(n[r].prop_type){case c.EVAL_TYPE.thunk:i[r]=e=>{var n;(n=e)!=null?n:e=t;const[r,i]=S(s,e,null,o);if(i==="reduced"){return E}else{return r}};break;case c.EVAL_TYPE.skip:continue;case c.EVAL_TYPE.value:default:{const[e,n]=S(s,t,null,o);if(n==="reduced"){return E}i[r]=e}}}}return i};n.evaluate_properties=k;const O=(e,t,n,r)=>S(e._raw(),t,n,r);n.evaluate_json=O;const S=function(e,t,n,r,i){if(e==null){return[r,"null"]}const s=e[M.type];if(s){switch(s){case"Empty":return[r,"null"];case"Message":return R(e,t,n,i);case"TextExpression":return T(e,t);case"GeoAddress":return C(e);default:if(s==="InjectedValue"&&t.reduce_mode){return W(e,t)}return $(s,e,t)}}if(typeof e==="object"){return N(e,t)}return[e,p.lit_eval_value(typeof e)]};n.evaluate=S;const D=function(e,t,n){t=i.extend({},t,{reduce_mode:true});t.duplicated_from_context=t.object_id;t.object_id=i.UUID();t.duplicated_at="evaluate.reduce";const[r,s]=S(e,t,null,null);if(n){return L(r)}else{return z(r,s)}};n.reduce=D;function C(e){return[b.ensure_valid_location(e[M.val]),"geographic_address"]}function T(e,t){const n=e[M.entries];const r=(0,_.raw_to_child_names)(n);const s=[];const o=[];let l=false;for(const e of r){const r=n[e];const[u,d]=S(r,t,null,null);if(d==="reduced"){l=true}else{const e=g.get(d);const n=e.has_runmode_display();const r=n?e.runmode_display(u,t):"";if(!n&&i.is_debug_mode()&&e.id()!=="null"){var c;const e=e=>e==null?void 0:e.fields;const t=h.get_current_eval_node();const n=t==null?void 0:t.owner;const r=t==null?void 0:t.context_element();const i=e(n)?`property ${String((c=n.field(t.node_name()))==null?void 0:c.caption)}`:"a property";a.owner_warn("trying to display a text value that cannot be displayed as text",{display:`"${String(r==null?void 0:r.display())}" - parts of property ${i} cannot be displayed as text, and will be omitted.`})}s.push(r)}o.push([u,d])}if(l){const e={[M.type]:"TextExpression",[M.entries]:o.map((e=>{let[t,n]=e;return z(t,n)}))};return[e,"reduced"]}else{return[s.join(""),"text"]}}function N(e,t){if(o.is_json_class(e)){return[e]}const n={};const r={};let i=false;for(const s in e){const o=e[s];const[a,l]=S(o,t,null,null);if(l==="reduced"){i=true}n[y.expand(s)]=a;r[s]=[a,l]}if(i){const e={};for(const t in r){const[n,i]=r[t];e[t]=z(n,i)}return[e,"reduced"]}else{return[n]}}function P(e,t,n,i,s){function o(){var s;const o=(s=t())!=null?s:null;if(o!=null&&o[c.NV_MARKER]){return}const l=g.get(n);const u=l.cast(o);if(!(0,r.default)(o,u)){var d,p,_;a.warn("cast resulted in change",{cast:{before:o,before_constructor:(d=o==null?void 0:o.constructor.name)!=null?d:typeof o,before_to_string:String(o),after:u,after_constructor:(p=u==null?void 0:u.constructor.name)!=null?p:typeof u,after_to_string:String(u),value_id:l.id()},state_key:e,_raw:i,current_eval_node:(_=h.get_current_eval_node())==null?void 0:_.serialize()})}return u}let l;const{frozen_state:u}=s;if(!e||!u){l=o()}else if(u.has_key(e)){l=u.get(e)}else{l=o();u.set(e,l);u.trust(e)}const d=i[M.next];if(d!=null){return S(d,s,l,null,n)}else{return[l,n]}}function I(e,t,n,r,i){if(t!==true){t=false}let s,o;if(e==="and_"&&t===false){o=false;s="sys.bool"}else if(e==="or_"&&t===true){o=true;s="sys.bool"}else{o=n;s="reduced"}if(r!=null){return S(r,i,o,null,s)}else{return[o,s]}}function R(e,t,n,r){var o,l;const c=e[M.name];const u=r!=="reduced"?g.get(r):undefined;const d=u==null?void 0:u.get_message(c);const p=(o=d==null?void 0:(l=d.ret_btype(e))==null?void 0:l._id)!=null?o:"null";const _=d==null?void 0:d.can_shortcircuit_args();const f=_==null?void 0:_(n);const h=e[M.args];let v,b;if(f){[v,b]=[null,"null"]}else if(h!=null){[v,b]=S(h,t,null,null)}if(b==="reduced"||r==="reduced"){if(["and_","or_"].includes(c)&&(b!=="reduced"||r!=="reduced")){let r,i;if(b!=="reduced"){r=L(v);i=n}else{r=L(n);i=v}return I(c,r,i,e[M.next],t)}n=z(n,r);return q(e,t,n)}if(!d||d.is_not_found()){return[null,"null"]}if(d.ret_btype==null){a.warn("message missing ret_btype")}else if(!d.ret_btype().cast){a.warn("message has a ret_btype that cannot cast")}if(typeof d.field_names!=="function"){throw new i.UnexpectedError("Message does not have field_names()",{message_name:c,prior_btype_id:r,field_names:d.field_names})}const y=d.properties_for_pre_evaluation({_properties:e[M.properties]});const w=d.field_names();const x=k(y,t,w);if(x===E){n=z(n,r);return q(e,t,n)}let j;if(d.no_frozen_state({prev:n})){j=null}else{const t=d.message_cache_id({raw:e,properties:x});j=m.Message({prev:n,arg:v,message:c,properties:x,additional:t,prior_btype_id:r})}function A(){s.optional_pause("pre-message "+c);const r=d.evaluate(n,v,x,e,t);s.optional_pause("post-message "+c);return r}return P(j,A,p,e,t)}function L(e){if((e==null?void 0:e[M.type])!=="Dehydrated"){return e}else if((e==null?void 0:e[M.next])!=null){return e}else{return o.rehydrate_tree(v.default.or_throw().db_instance(),e[M.properties][M.val])}}const z=p.create_reduced;n.create_reduced=z;function B(e,t){e=i.json_deep_copy(e);let n=e;while(n[M.next]){n=n[M.next]}n[M.next]=t;return e}function q(e,t,n){const r=e[M.name];let i;if(e[M.args]!=null){const[n,r]=S(e[M.args],t,null,null);i=z(n,r)}let s;const o=e[M.properties];if(o){s={};Object.entries(o).forEach((e=>{let[n,r]=e;const[i,o]=S(r,t,null,null);s[n]=z(i,o)}))}const a={[M.name]:r,[M.properties]:s,[M.args]:i,[M.type]:"Message"};const l=B(n,a);return F(l,e[M.next],t)}function U(e,t,n){let r;const i=t[M.properties];if(i){r={};Object.entries(i).forEach((e=>{let[t,i]=e;const[s,o]=S(i,n,null,null);r[t]=z(s,o)}))}const s={[M.properties]:r,[M.type]:e};return F(s,t[M.next],n)}function F(e,t,n){if(t==null){return[e,"reduced"]}return S(t,n,e,null,"reduced")}function W(e,t){const n={[M.type]:"InjectedValue"};return F(n,e[M.next],t)}function $(e,t,n){var r;const i=(r=v.default.or_throw().load_plugin(`${v.default.or_throw().plugin_prefixes.datasource}${e}`,true))!=null?r:p.missing_datasource(e);const s=k(t[M.properties],n,i.field_names);if(s===E){return U(e,t,n)}const o=i.get_unique_string(s,n.element);const l=i.get_runmode_value(t,n,s);if(l==null&&e!=="Dehydrated"){a.warn("Missing ret_btype_id in data eval_data_source",{_raw:t,type:e})}function c(){const e=g.get(l);const r=!(e!=null&&e.is_missing())?e.id():undefined;if(r&&l&&r!==l){a.warn("bad btypes.get in eval_data_source",{post_ret_btype_id:r,ret_btype_id:l})}return i.evaluate(s,n,e,t)}return P(o,c,l,t,n)}const G=function(e){const t=d.get(w.default.MESSAGE_NODE);function n(r){const[s,o]=r instanceof t?n(r.prior()):[undefined,undefined];const a=i.json_deep_copy(r.json._raw());a==null?true:delete a[M.next];try{e.is_in_partial=true;return S(a,e,s,null,o)}finally{e.is_in_partial=false}}return n};n.make_partial_expression_evaluator=G},{"../../constants/eval":64,"../../constants/lang":73,"../../db/hydrate":429,"../../db/values/db_values":476,"../../geolocation/b_location":621,"../../lib":741,"../../logger":744,"../../shared/investigations":798,"../../u":823,"../../u/shared/async/b_fiber":833,"../app_json/json_utils":631,"../btypes":653,"../expressions/expression_utils":710,"../nodes":721,"../nodes/node_types":722,"../shrink":728,"./eval_node_state":694,"./state_keys":699,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/isEqual":1321}],696:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const{raw_to_child_names:i}=e("../app_json/json_utils");const s=e("../shrink");const{S:o}=s;r.is_static=function(e){if(!e){return true}const t=e[o.type];if(t){if(t==="GeoAddress"||t==="Empty"){return true}else if(t==="TextExpression"){var n;const t=(n=e[o.entries])!=null?n:{};return Object.values(t).every((e=>r.is_static(e)))}else{return false}}if(typeof e==="object"){return Object.values(e).every((e=>r.is_static(e)))}return true};r.get_static=function(e){if(e==null){return null}const t=e[o.type];if(t){switch(t){case"Empty":return null;case"Message":return null;case"TextExpression":return r.get_static_text_expression(e);case"GeoAddress":return e[o.val];default:return null}}if(typeof e==="object"){return r.get_static_object_literal(e)}return e};r.get_static_text_expression=function(e){const t=e[o.entries];const n=i(t);const s=n.map((e=>r.get_static(t[e])));return s.join("")};r.get_static_object_literal=function(e){const t={};for(const n in e){const i=e[n];const o=r.get_static(i);t[s.expand(n)]=o}return t}},{"../app_json/json_utils":631,"../shrink":728,"core-js/modules/web.dom-collections.iterator.js":1123}],697:[function(e,t,n){"use strict";const r=n;const i=e("../shrink");const{S:s}=i;const o=e("../../u/shared/mode_check");const a=e("../../u/shared/errors");const l=e("../../u/shared/async/autorun");const c=e("../../u/shared/async/b_async");const u=e("../../u/shared/async/async_state");const d=e("../../u/shared/uuid");const p=e("../../lib");const _=e("./eval_node_state");const f=e("../appquery");const h=e("../nodes/registry");const m=e("../nodes/node_types");const g=e("./evaluate");const v=e("../../safe_require");const b=e("../../monitoring/apm");v.safe_register("./lang/evaluation/node_eval",r);r.evaluate_state_condition=function(e,t){return _.with_eval_node(e,(()=>g.evaluate(e.json._raw_child(s.condition),t,null,null)[0]))};r.evaluate_event_condition=function(e,t){if(e.get_static_property("workflow_disabled")){return false}return b.traceSpan("evaluate event condition",{},(()=>{const n=r.eval_property(e,"condition",t,null,true);b.addTransactionLabels({"evaluation.condition_result":n});return n}))};r.evaluate_action_condition=function(e,t){if(o.on_server()&&e.check_use_visible()&&f().get_public_setting("use_visible")){return false}return b.traceSpan("evaluate action condition",{},(()=>{const n=r.eval_property(e,"condition",t,null,true);b.addTransactionLabels({"evaluation.condition_result":n});return n}))};r.evaluate_action_properties=function(e,t){return b.traceSpan("evaluate action properties",{"workflow.action.id":e.id(),"workflow.action.type":e.type()},(()=>{const n=r.evaluate_action_condition(e,t);if(!n&&!e.A.handle_condition_internally){return{condition:false}}const i=e.json._child(s.properties);const o=i._raw();y(o);const a=_.with_eval_node(e,(()=>g.evaluate_properties(o,t,e.field_names(),i._path())));const l=e.preprocess_properties(a,t);l.condition=n;return l}))};r.evaluate_properties=function(e,t){if(!e){return null}if(h.is(e,m.ACTION)){return r.evaluate_action_properties(e,t)}const n=e.json._child(s.properties);const i=_.with_eval_node(e,(()=>g.evaluate_properties(n._raw(),t,e.field_names(),n._path())));return e.preprocess_properties(i,t)};r.evaluate_wf_properties=function(e,t){var n;if(h.is(e,m.GENERIC_EVENT)){return l.run_once(30,(()=>({condition:r.evaluate_event_condition(r,e,t)})))}const i=["slow","step_by_step"].includes((n=p().workflow.debugger)==null?void 0:n.workflow_mode);if(e.does_fall_back_to_server()&&!i){const n=c.Promise(null,"property evaluation");const i=["Search","GetDataFromAPI"].some((t=>e.find_expressions(t).length>0));if(t.server_workflow_completed||i){n.reject(new a.UnexpectedError("no local evaluation"))}else{let i;try{i=u.CurrentAutoRun;u.CurrentAutoRun={invalidate(){},add_sub(){}};n.resolve(r.evaluate_properties(e,t))}catch(e){n.reject(e)}finally{u.CurrentAutoRun=i}}return n}return l.run_once(30,(()=>{if(t.initial_random_iterations==null&&t.random_generator){t.initial_random_iterations=t.random_generator.iterations}else if(t.initial_random_iterations!=null){t.random_generator=new d.Random(t.random_seed,t.initial_random_iterations)}return r.evaluate_properties(e,t)}))};r.evaluate_action_clientside=function(e,t){if(!e.needs_clientside_properties()){return c.Promise(null)}return r.evaluate_wf_properties(e,t)};r.eval_property=function(e,t,n,r,o){return _.with_eval_node(e.property(t),(()=>{const a=e.json._raw_gchild(s.properties,i.shrink(t));y(a);return g.evaluate(a,n,r,o)[0]}))};const y=e=>{b.addTransactionLabels({"evaluation.raw":JSON.stringify(i.expand_object(e))})}},{"../../lib":741,"../../monitoring/apm":746,"../../safe_require":777,"../../u/shared/async/async_state":829,"../../u/shared/async/autorun":830,"../../u/shared/async/b_async":832,"../../u/shared/errors":846,"../../u/shared/mode_check":851,"../../u/shared/uuid":855,"../appquery":651,"../nodes/node_types":722,"../nodes/registry":724,"../shrink":728,"./eval_node_state":694,"./evaluate":695}],698:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=t.exports;const i=e("../../u");const s=e(".././../safe_require");s.safe_register("./lang/evaluation/page_state",r);r.get_basic_datasources=function(e,t){var n,s;(n=t)!=null?n:t={};const o={current_user(){if(d().bubble_version()>=23){const e=d().current_user()._id();return d().db_instance().get(e)}else{return d().current_user()}},page_data(e,t){return r.get_page_data(e.name,t)},page_data_btype(e){var t;return(t=r.get_page_data_type(e.name))!=null?t:" null"}};if(!(e!=null&&(s=e.is_api)!=null&&s.call(e))){i.extend(o,{current_page_item(){return d().pageparam.get()},current_page_item_btype(){var t;return(t=e.get_static_property("page_item_type"))!=null?t:"null"}})}return i.extend(o,t)};if(window){r.page_width=i.Box($(window).width())}else{r.page_width=i.Box(null,true)}r.page_current_scroll_position=i.Box(0);const o=["Website Home","CurrentLanguage","Website Admin Email","Current Date/Time","AppIsTest","AppVersion"];const a=["Website Home","This Url","CurrentLanguage"];const l=["Current Page Name"];const c=["Website Admin Email","Current Date/Time","Current Position","Current Page Width","Current Page Scrolling Position","Page Loaded Above Fold","Page Loaded (Entire)","AppIsTest","AppVersion"];r.get_page_data_names=function(e){var t,n;if(e.is_api){return o}const r=[...a];if(((t=e.element_node)==null?void 0:(n=t.root())==null?void 0:n.type())==="CustomDefinition"){r.push(...l)}r.push(...c);return r};r.get_page_data_names_new=function(e){var t,n,r,i;if(e.owner_type==="BackendWorkflow"){return o}const s=[...a];if(((t=(n=e.owner_node).context_element)==null?void 0:(r=t.call(n))==null?void 0:(i=r.root())==null?void 0:i.type())==="CustomDefinition"){s.push(...l)}s.push(...c);return s};r.get_all_data_names=function(){return[...a,...l,...c]};r.get_page_data=function(e,t){var n;if(t.is_api&&!o.includes(e)){throw new i.UnexpectedError("calling a PageData datasource in API invalid: "+e)}if(t.in_pageservice&&!["Current Page Name","Website Home","AppIsTest"].includes(e)){throw new i.OwnerError("Datasource not allowed in page",{display:"Calling a data source invalid when generating the page HTML: "+e})}switch(e){case"Website Home":return d().location.get_server_base();case"This Url":return d().location.my_location();case"Current Page Name":return d().location.get_page();case"CurrentLanguage":return d().app_language();case"AppIsTest":return d().app_version()!==p.LIVE_VERSION;case"AppVersion":return u.app_version();case"Website Admin Email":return u.admin_email();case"Current Date/Time":(n=t._current_date_time)!=null?n:t._current_date_time=new Date(i.timestamp());return t._current_date_time;case"Current Position":if(t.frozen_state&&i.on_server()){return t.frozen_state.other_data["Current Position"]}return _.get_current_geographic_position();case"Current Page Width":if(i.on_client()){return r.page_width()}return t.frozen_state.other_data["Current Page Width"];case"Current Page Scrolling Position":if(i.on_client()){return r.page_current_scroll_position()}return t.frozen_state.other_data["Current Page Scroll Position"];case"Is Reset Password Token Valid":return null;case"Page Loaded Above Fold":if(i.on_server()){return true}return d().element.page_done_loading();case"Page Loaded (Entire)":if(i.on_server()){return true}return d().element.page_done_loading(true);default:throw new i.UnexpectedError("unrecognized: "+e)}};r.get_page_data_ready_key=()=>i.FakeKey();r.get_page_data_type=function(e){switch(e){case"Current Date/Time":return"date";case"Current Position":return"geographic_address";case"Current Page Width":return"number";case"Current Page Scrolling Position":return"number";case"Page Loaded Above Fold":case"Page Loaded (Entire)":case"Is Reset Password Token Valid":case"AppIsTest":return"boolean";default:return"text"}};r.input_focused=i.Box(false);const u=e("../appquery");const d=e(".././../lib");const p=e("../../constants/locations");const _=e("../../geolocation/location_lookups")},{"../../constants/locations":74,"../../geolocation/location_lookups":625,"../../u":823,".././../lib":741,".././../safe_require":777,"../appquery":651,"core-js/modules/web.dom-collections.iterator.js":1123}],699:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../../db/hydrate");const s=e("../../db/query_planner");const o=e(".././../safe_require");const a="Message_";const l="ElementParent";const c="ElementAncestor";function u(e,t,n){return r.json_stringify(i.dehydrate_tree({type:e,constraints:s.sort_constraints(Object.values(t!=null?t:{}).filter((e=>e!=null))),sorts_list:n}))}t.exports={CurrentUser:()=>"CurrentUser",Message(e){var t,n,s,o;let{prev:l,arg:c,message:u,properties:d,additional:p,prior_btype_id:_}=e;(t=l)!=null?t:l=null;(n=c)!=null?n:c=null;(s=d)!=null?s:d={};(o=p)!=null?o:p="";const f=[r.json_stringify(i.dehydrate_tree(l)),u,r.json_stringify(i.dehydrate_tree(c)),r.json_stringify(i.dehydrate_tree(d)),p,_];return a+f.join("_")},CurrentPageItem:()=>"CurrentPageItem",CurrentWorkflowItem:()=>null,PageData(e){if(e==="Current Date/Time"){return null}return"PageData_"+e},APIEventParameter:e=>"APIEventParameter_"+e,ElementParent:()=>l,ElementAncestor:()=>c,CurrentCellsIndex:()=>"CurrentCellsIndex",ThisElement(){},PreviousStep:e=>"PreviousStep_"+e,Search:(e,t,n)=>"Search_"+u(e,t,n),GetDataFromAPI:e=>"GetDataFromAPI_"+JSON.stringify(i.dehydrate_tree(e)),ArbitraryText:e=>"ArbitraryText_"+JSON.stringify(i.dehydrate_tree(e))};o.safe_register("./lang/evaluation/state_keys",t.exports)},{"../../db/hydrate":429,"../../db/query_planner":460,"../../u":823,".././../safe_require":777}],700:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../lib");const s=e("../btypes");const o=e("./expression_utils");const a=e("./LiveExpression");t.exports=class e extends a{constructor(e,t,n){var r;super(e,t);this.D=i().load_plugin(i().plugin_prefixes.datasource+n,true);(r=this.D)!=null?r:this.D=o.missing_datasource(n);this._type=n}field_names(){if(!this.D.field_names){throw new r.UnexpectedError("missing field_names for datasource "+this._type)}return this.D.field_names}_fields(){return this.D.fields(this.get_static_property_fetcher(),this)}has_args(){return false}get_value(){const e=this.D.get_value(this.get_static_property_fetcher(),this);return s.get(e)}display(){if(this.D.display){return this.D.display(this.get_static_property_fetcher(),this)}else{return`DataSource ${this._type}`}}get_spot(){var e,t,n;return(e=(t=(n=this.D).get_spot)==null?void 0:t.call(n))!=null?e:"DynamicAtom"}get_literal(){return this.raw()}check_for_errors(e){super.check_for_errors(e);if(this.D.check_for_errors){let t=this.D.check_for_errors(this.get_static_property_fetcher(),this);if(typeof t==="string"){t=[t]}else if(!t){t=[]}for(const n of t){e(this.display()+" - "+n,this)}}const t=this._find_used_properties();return{children:t.concat(this.next())}}serialize_args(){return[this.json,this.owner,this._type]}is_equal_to(e){return super.is_equal_to(e)&&this._type===e._type}thumbnail_id(){var e,t,n;return(e=(t=(n=this.D).thumbnail_id)==null?void 0:t.call(n,this.get_static_property_fetcher(),this))!=null?e:super.thumbnail_id()}}},{"../../lib":741,"../../u":823,"../btypes":653,"./LiveExpression":705,"./expression_utils":710,"core-js/modules/web.dom-collections.iterator.js":1123}],701:[function(e,t,n){"use strict";const r=e("../btypes");const i=e("./StaticExpression");t.exports=class e extends i{get_static(){return null}is_empty(){return true}get_value(){return r.get("null")}get_eval_value(){return r.get("null")}display(){return""}type(){return"Empty"}get_spot(){return"Atom"}}},{"../btypes":653,"./StaticExpression":708}],702:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../lib");const s=e("../../logger");const o=e("../nodes");const a=e("../btypes");const l=e("./expression_utils");t.exports=class e extends o.HasProperties{constructor(e,t){super(e);if(!t){throw new r.UnexpectedError("expression created without owner")}this.owner=t;this._property_owner=this.owner}make_new(){return o.new_expression(...arguments)}has_next(){return false}has_args(){return false}is_empty(){return false}is_literal(){return false}get_spot(){return"DynamicAtom"}get_literal(){return null}get_eval_value(){return a.get("null")}raw(){return this.json.raw()}node_name(){return this.json.name()}get_tree_display(){return this.display()}display_simple(){return this.display()}element_id(){return this.get_static_property("element_id")}pretty_print(e){try{return e+this.get_tree_display()}catch(t){return`${e}Error trying to pretty_print ${this.constructor.name}:\n${t.stack}`}}context_element(){return this.owner.context_element()}parent_expression(){var e,t;const n=this.json.parent();const r=this.owner.path();if(!r||!n){return null}if(n.path()===r||((e=(t=this.owner).type)==null?void 0:e.call(t))==="FakeMultiElement"){return null}return o.new_expression(n,this.owner)}parent_expressions(e){const t=[];let n=this;while(n=n.parent_expression()){t.push(n)}return o.filter_array(e,t)}serialize_args(){return[this.json,this.owner]}find_in_editor(e,t,n){const o=$.fx.off;$.fx.off=true;return r.run_once(30,(()=>this.parent_expression()),((a,l)=>{if(a){s.log(a);return}const c=()=>{$.fx.off=o;if(e){return i().composer.get_owner(this.path(),(e=>t(e==null?void 0:e.canvas)),true)}else{return t()}};if(!l){this.owner.find_in_editor(false,c,n,{path_array:this.path().split(".")});return}const u=l.get_spot();if(u==="DynamicAtom"||u==="Atom"){return l.find_in_editor(false,c,n)}else if(u==="SlidableAtom"){return l.find_in_editor(false,(()=>{var e,t;const n=r.MakeKey(null,"SlidableAtom owns_key");const s=l.path();const o=(e=window)!=null&&e.is_maison?i().slidable_palette:i().SlidablePalette();if(((t=o.node_box())==null?void 0:t.path())!==s){i().composer.clear_owner(s);i().composer.select(s);i().composer.call_on_owner(s,"show");r.wait_for_updates((()=>n.turn()))}else{n.turn()}return r.WaitFor(n,(()=>{if(!o.is_currently_visible()){return o.reveal(c)}else{return r.wait_for_updates(c)}}))}),n)}else{s.error("Unrecognized spot type",{spot_type:u});return c()}}))}find_expressions(e){return o.from_raw_array(this.json,o.new_expression,l.expression_find_expressions(o.to_raw(this),o.make_filter(e)))}}},{"../../lib":741,"../../logger":744,"../../u":823,"../btypes":653,"../nodes":721,"./expression_utils":710,"core-js/modules/web.dom-collections.iterator.js":1123}],703:[function(e,t,n){"use strict";const r=e("../../geolocation/b_location");const i=e("../btypes");const s=e("./StaticExpression");t.exports=class e extends s{is_static(){return true}get_address(){return r.get_address(this.json.child("val").raw())}get_static(){return this.json.child("val").raw()}get_literal(){return this.json.child("val").raw()}type(){return"GeoAddress"}get_eval_value(){return i.get("geographic_address")}get_tree_display(){return this.get_address()}display(){return this.get_address()}}},{"../../geolocation/b_location":621,"../btypes":653,"./StaticExpression":708}],704:[function(e,t,n){"use strict";const r=e("../btypes");const i=e("./expression_utils");const s=e("./StaticExpression");t.exports=class e extends s{get_static(){return this.json.get()}is_literal(){return true}get_literal(){return this.json.get()}type(){return typeof this.json.get()}get_value(){return r.get(i.lit_eval_value(this.type()))}get_eval_value(){return r.get(i.lit_eval_value(this.type()))}get_spot(){return"Atom"}get_tree_display(){const e=this.json.get();switch(this.type()){case"string":case"number":return e;case"boolean":return e?"yes":"no"}}display(){const e=this.json.get();switch(this.type()){case"string":return""+e+"";case"boolean":return e?'"yes"':'"no"';case"number":return e}}display_simple(){const e=this.json.get();switch(this.type()){case"string":return e;case"boolean":return e?'"yes"':'"no"';case"number":return e}}}},{"../btypes":653,"./StaticExpression":708,"./expression_utils":710}],705:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../../lib");const s=e("../btypes");const o=e("../shrink");const a=e("../nodes");const{S:l}=o;const c=e("./Expression");t.exports=class e extends c{has_next(){return true}message_set(e){return i().sets.get_set("Messages")(this,this.get_value(),e)}is_static(){return false}get_static(){return null}get_static_property_fetcher(){return e=>this.get_static_property(e)}get_tree_display(e){if(e){var t,n,r;return(t=this.get_eval_value)==null?void 0:(n=t.call(this))==null?void 0:(r=n.get_bubble_null)==null?void 0:r.call(n)}const i=this.display();const s=this.has_args()?this.args().get_tree_display():"";const o=this.has_next()?this.next().get_tree_display():"";return i+s+o}next(){return a.new_expression(this.json._child(l.next),this.owner)}type(){return this.json.child("type").get()}get_eval_value(e){if(this.has_args()){const t=this.args();if(!this.get_arg_btype().matches(t.get_eval_value())){if(e){const n=this.get_arg_btype().display();let r=t.get_eval_value().display_for_issue();if(r===n){r="different "+r}const i=/^[aeiou]/.test(r[0])?"an":"a";e(`This argument should be a ${n} but right now it is ${i} ${r}`,t)}return s.get("null")}}const t=this.next();if(!t.is_empty()){return t.get_eval_value(e)}else{return this.get_value()}}_find_used_properties(){if(this.get_spot()==="SlidableAtom"){return this.fields().filter((e=>i().getChecker(this,e).condition())).map((e=>this.property(e.name)))}else{return this.properties()}}thumbnail_id(){if(!this.get_value().display()){return null}return{text:"Evaluates to a "+this.get_value().display()}}check_for_errors(e){this.fields().filter((e=>e.editor)).forEach((t=>{const n=i().getChecker(this,t);n.type_check((()=>this.display()),e)}))}set_property(e,t){var n;if(typeof((n=t)==null?void 0:n.raw)==="function"){t=t.raw()}const s=this.property(e).raw();if(JSON.stringify(s)===JSON.stringify(t)){return}let o=this.owner;if(!o.has_id()){o=this.owner.context_element()}const a=o.id();const l=o.path();if(!a){throw new r.UnexpectedError("trying to set property on a MessageNode/DataSourceNode without a context element ...")}const c=this.path().split(l+".")[1];const u=i().changes.create_change("SetData",{target_id:a,path:c+".properties."+e,old_value:s,value:t});u.execute()}}},{"../../lib":741,"../../u":823,"../btypes":653,"../nodes":721,"../shrink":728,"./Expression":702}],706:[function(e,t,n){"use strict";const r=e("../../u");const i=e("../nodes");const s=e("../../lib");const o=e("../btypes");const a=e("./LiveExpression");function l(e){return{fn(){},ret_btype:()=>o.get("null"),arg_btype:()=>null,spot_data(){},field_names:{},_fields(){},M:()=>({}),description:()=>`[Not found: ${e}]`,NOT_FOUND:true}}t.exports=class e extends a{constructor(e,t){var n,r,i,s,a;super(e,t);this._name=this.json.child("name").get();this._parent_value=(n=(r=(i=this.prior()).get_value)==null?void 0:r.call(i))!=null?n:o.get("null");this._message=(s=(a=this._parent_value)==null?void 0:a.get_message(this.name()))!=null?s:l(this._name)}name(){return this._name}is_equal_to(e){if(!super.is_equal_to(e)){return false}if(this._name!==e.name()){return false}if(this._parent_value.id()!==e._parent_value.id()){return false}if(this.get_value().id()!==e.get_value().id()){return false}return true}message(){return this._message}get_value(){return this._message.ret_btype(this.json._raw())}has_args(){return this._message.arg_btype()!=null}args(){return i.new_expression(this.json.child("args"),this.owner)}get_arg_btype(){return this._message.arg_btype()}prior(){return i.new_expression(this.json.parent(),this.owner)}get_spot(){var e;return(e=this._message.spot_data())!=null?e:"DynamicAtom"}field_names(){if(!this._message.field_names){var e,t;throw new r.UnexpectedError("message "+this._name+" on  "+((e=this._parent_value)==null?void 0:(t=e.display)==null?void 0:t.call(e))+" is missing field_names")}return this._message.field_names()}display(){return this._message.description(this)}_fields(){return this._message.fields(this.get_static_property_fetcher(),this)}get_display_for_sliding_palette(){var e;return(e=this._message.M.description_for_sliding_palette)!=null?e:this.display()}argument_set(){var e;const t=this._message.arg_btype();const n=(e=this._message.editor)!=null?e:{};const r=n.default;if(n.static){var i;return s().sets.get_set("EditorOnly")((i=t.get_composer_input_type)==null?void 0:i.call(t),r)}if(!t){return s().sets.get_set("NullSet")()}const o=t.matches("sys.bool")?null:t;return s().sets.get_set("DataSources")(this,t,o,r)}check_for_errors(e){if(this._message.NOT_FOUND){e(this.prior().display()+": missing property... please double-check")}else{super.check_for_errors(e)}this._message.check_for_errors(this,(t=>{e(`${this.display()} - ${t}`)}));const t=this._find_used_properties();return{children:t.concat(this.next(),this.args())}}}},{"../../lib":741,"../../u":823,"../btypes":653,"../nodes":721,"./LiveExpression":705}],707:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i;function s(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const o=e("../nodes");const a=e("../caching");const l=e("../evaluation/evaluate_static");const c=e("./Expression");let u=(r=a.cached({type:a.RUN_MODE}),i=class e extends c{set_field_data(e){this.field_names=()=>e().map((e=>e.name));this._fields=e}entry(e){return o.new_expression(this.json.child(e),this.owner)}type(){return"ObjectLiteral"}next(){if(!this.json.child("next").empty()){return this.entry("next")}}display(){return this.pretty_print(" ")}pretty_print(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";const t=e+"ObjectLiteral:";const n=this.entries().flatMap((t=>[e+"  "+t.json.name(),t.pretty_print(e+"    ",false)]));return[t,...n].join("\n")}_process(e){const t={};for(const n of this.entries()){const r=e(n);t[n.json.name()]=r}return t}properties(){return this.entries()}property(e){return this.entry(e)}get_static_property(e){return this.property(e).get_static()}is_static(){return this.entries().every((e=>e.is_static()))}get_static(){return l.get_static_object_literal(this.json._raw())}check_for_errors(){return{children:this.properties()}}entries(){return o.enhance_array(this.json.children().map((e=>o.new_expression(e,this.owner))))}},s(i.prototype,"entries",[r],Object.getOwnPropertyDescriptor(i.prototype,"entries"),i.prototype),i);t.exports=u},{"../caching":656,"../evaluation/evaluate_static":696,"../nodes":721,"./Expression":702,"core-js/modules/web.dom-collections.iterator.js":1123}],708:[function(e,t,n){"use strict";const r=e("../nodes");const i=e("./Expression");t.exports=class e extends i{is_static(){return true}find_expressions(){return r.enhance_array([])}field_names(){return{}}}},{"../nodes":721,"./Expression":702}],709:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i;function s(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const o=e("../nodes");const a=e("../caching");const l=e("../btypes");const c=e("../shrink");const{S:u}=c;const d=e("../evaluation/evaluate_static");const p=e("./Expression");let _=(r=a.cached({type:a.RUN_MODE}),i=class e extends p{entry(e){return o.new_expression(this.json._gchild(u.entries,c.shrink(e)),this.owner)}type(){return"TextExpression"}properties(){return this.entries()}is_static(){return this.entries().every((e=>e.is_static()))}get_static(){return d.get_static_text_expression(this.json._raw())}get_tree_display(e){return this.entries().map((t=>t.get_tree_display(e))).join("")}display(){return this.get_tree_display()}get_eval_value(){return l.get("text")}field_names(){return{}}check_for_errors(e){for(const t of this.entries()){if(!t.is_empty()){const n=t.get_eval_value(e);if(!n.matches(l.stringable)){let r="Dynamic data in text boxes must be printable as text, but instead this is ";if(n.display()){r+="a "+n.display()}else{r+="a non-text expression"}e(r,t)}}}return{children:this.entries()}}entries(){return o.enhance_array(this.json._child(u.entries).children().map((e=>o.new_expression(e,this.owner))))}},s(i.prototype,"entries",[r],Object.getOwnPropertyDescriptor(i.prototype,"entries"),i.prototype),i);t.exports=_},{"../btypes":653,"../caching":656,"../evaluation/evaluate_static":696,"../nodes":721,"../shrink":728,"./Expression":702,"core-js/modules/web.dom-collections.iterator.js":1123}],710:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.create_reduced=void 0;n.expression_find_expressions=p;n.missing_datasource=n.lit_eval_value=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=a(e("../nodes"));var i=a(e("../shrink"));var s=a(e("../../db/hydrate"));function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const{S:l}=i;const c=function(e,t){if(t==="reduced"){return e}else{return{[l.type]:"Dehydrated",[l.properties]:{[l.val]:s.dehydrate_tree(e),[l.value_id]:t}}}};n.create_reduced=c;const u=function(e){switch(e){case"string":return"text";case"boolean":return"sys.bool";case"number":return"number"}};n.lit_eval_value=u;const d=function(e){return{_fields:()=>[],field_names:{},get_unique_string(){return undefined},evaluate(){return undefined},get_value:()=>"null",display:()=>"[missing: "+e+"]",check_for_errors(t){t("Could not find "+e)}}};n.missing_datasource=d;function p(e,t){const n=[];const{_raw:i}=e;if(!i||typeof i!=="object"){return n}const s=i[l.type];if(["Empty","GeoAddress"].includes(s)){return n}if(!s){for(const i of r.raw_array_node(e)){if(t(i)){n.push(i)}n.push(...p(i,t))}}else if(s==="TextExpression"){for(const i of r.raw_children(e,l.entries)){if(t(i)){n.push(i)}n.push(...p(i,t))}}else{if(i[l.properties]){for(const i of r.raw_children(e,l.properties)){if(t(i)){n.push(i)}n.push(...p(i,t))}}if(s==="Message"&&i[l.args]){const i=r.raw_child(e,l.args);if(i){if(t(i)){n.push(i)}n.push(...p(i,t))}}if(i[l.next]){const i=r.raw_child(e,l.next);if(i){if(t(i)){n.push(i)}n.push(...p(i,t))}}}return n}},{"../../db/hydrate":429,"../nodes":721,"../shrink":728,"core-js/modules/web.dom-collections.iterator.js":1123}],711:[function(e,t,n){"use strict";const r=n;const i=e("../../u");const s=e("../nodes");const o=e("./Expression");const a=e("./Empty");const l=e("./Literal");const c=e("./ObjectLiteral");const u=e("./TextExpression");const d=e("./LiveExpression");const p=e("./DataSource");const _=e("./MessageNode");const f=e("./GeoAddressNode");const h=e("./expression_utils");const m=e("../evaluation/evaluate");const g=e("../evaluation/evaluate_static");r.make_partial_expression_evaluator=m.make_partial_expression_evaluator;r.create_reduced=h.create_reduced;r.expression_find_expressions=h.expression_find_expressions;r.get_static=g.get_static;r.is_static=g.is_static;s.add(s.EXPRESSION,o);s.add(s.EMPTY,a);s.add(s.LITERAL,l);s.add(s.OBJECT_LITERAL,c);s.add(s.TEXT_EXPRESSION,u);s.add(s.LIVE_EXPRESSION,d);s.add(s.DATA_SOURCE,p);s.add(s.MESSAGE_NODE,_);s.add(s.GEO_ADDRESS_NODE,f);s.add_generic("expression",i.is_edit_mode()?v:b);function v(e,t){var n,r,i,s;const o=(n=(r=t.type)==null?void 0:r.call(t))!=null?n:"no_type";const a=(i=(s=t.id)==null?void 0:s.call(t))!=null?i:"no_id";const l=`expression_${a}_${o}`;return e.smart_cache(l,y,t)}function b(e,t){return e.smart_cache("expression",y,t)}function y(e,t){if(e.empty()){return new a(e,t)}const n=e.child("type").get();if(n){switch(n){case"Empty":return new a(e,t);case"Message":return new _(e,t);case"TextExpression":return new u(e,t);case"GeoAddress":return new f(e,t);default:return new p(e,t,n)}}if(e.raw_type()==="object"){return new c(e,t)}return new l(e,t)}},{"../../u":823,"../evaluation/evaluate":695,"../evaluation/evaluate_static":696,"../nodes":721,"./DataSource":700,"./Empty":701,"./Expression":702,"./GeoAddressNode":703,"./Literal":704,"./LiveExpression":705,"./MessageNode":706,"./ObjectLiteral":707,"./TextExpression":709,"./expression_utils":710}],712:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.checkers=void 0;n.getChecker=B;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");var r=p(e("./btypes"));var i=u(e("./lang"));var s=u(e("../editor/utils/evaluate_condition"));var o=e("./elements/types");var a=e("../constants/elements");var l=e("../editor/composer/utilities/dropdown_contents");var c=e("../constants/composer");function u(e){return e&&e.__esModule?e:{default:e}}function d(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(d=function(e){return e?n:t})(e)}function p(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=d(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}class _{constructor(e,t){this.expected_value=void 0;this.node=e;this.property=t}prop_node(){var e,t,n;return(e=(t=(n=this.property).prop_node)==null?void 0:t.call(n,this.node))!=null?e:this.node.property(this.property.name)}optional(){var e,t,n,r,i;if(this.property.optional){return true}const s=(e=(t=(n=this.node).element_version)==null?void 0:t.call(n))!=null?e:a.LATEST_ELEMENT_VERSION;const o=s>=a.VERSION_STYLE_OVERRIDES||this.property.allow_overrides&&a.OLD_VERSION_OVERRIDE_PROPERTIES.includes(this.property.name);return!!(o&&((r=(i=this.node).get_style_if_exists)==null?void 0:r.call(i))!=null)}caption(){return this.property.caption}display(){var e;return(e=this.caption())!=null?e:this.name()}name(){return this.property.name}default(){var e,t,n,r,i;const s=(e=(t=(n=this.node).element_version)==null?void 0:t.call(n))!=null?e:a.LATEST_ELEMENT_VERSION;const o=s>=a.VERSION_STYLE_OVERRIDES||this.property.allow_overrides&&a.OLD_VERSION_OVERRIDE_PROPERTIES.includes(this.property.name);if(o&&((r=(i=this.node).get_style_if_exists)==null?void 0:r.call(i))!=null){return null}else{return this.property.default}}is_numberlike_text(e){var t,n,r;if(((t=e.type)==null?void 0:t.call(e))!=="TextExpression"){return false}const i=(n=(r=e).entries)==null?void 0:n.call(r);if((i==null?void 0:i.length)!==1){return false}if(i!=null&&i[0].get_eval_value().matches("number")){return true}const s=i==null?void 0:i[0].get_literal();return s!=null&&!isNaN(parseFloat(s))}_type_check(e,t,n){if(!this.optional()&&e.is_empty()&&this.default()==null){const r=`${t()}: remember to fill out ${this.display()}`;n(r,e)}else if(!e.is_empty()){var i;const a=(i=this.expected_value)==null?void 0:i.call(this);if(a){const i=e.get_eval_value();const l=a==="number"&&i.matches("text")&&this.is_numberlike_text(e);if(!i.matches(a)&&!l){var s,o;const l=r.display_matcher(a);let c=i.display_for_issue();if(c===l){c="different "+c}if((s=i.custom_type())!=null&&(o=s.deleted)!=null&&o.call(s)){c+=" (deleted)"}const u=`${t()}: ${this.display()} should be ${l} but right now it is a ${c}`;n(u,e)}}}return true}type_check(e,t,n){if(!this.condition()){return false}const r=n!=null?n:this.prop_node();return this._type_check(r,e,t)}condition(){return(0,s.default)(this.property.condition,this.node)}}class f extends _{constructor(){super(...arguments);this.expected_value=()=>"text"}}class h extends f{}class m extends _{constructor(){super(...arguments);this.expected_value=()=>this.property.value}}class g extends _{optional(){return true}}class v extends g{}class b extends _{}class y extends _{}class w extends _{}class x extends _{}class j extends _{}class A extends _{constructor(){super(...arguments);this.expected_value=()=>"text"}}class M extends _{}class E extends _{}class k extends _{}class O extends _{}class S extends _{_type_check(e,t,n){if(!this.optional()&&e.is_empty()&&this.default()==null){const r=`${t()}: remember to fill out ${this.display()}`;n(r,e)}else if(!e.is_empty()){var r,i;const h=(r=e.get_literal())!=null?r:this.default();const m=this.property.set;if(m!=null&&!(m instanceof l.DropdownContents)&&m!=null&&(i=m.has_finite_options)!=null&&i.call(m)&&!(m!=null&&m.ignore_type_check)&&!this.property.ignore_issue_checker){var s;if(!((s=m.contains)!=null&&s.call(m,h))){var o,a,u,d;const r=(o=(a=(u=m.get_display)==null?void 0:u.call(m,h))!=null?a:(d=e.display)==null?void 0:d.call(e))!=null?o:"your choice";n(`${t()} - ${r} is not a possible option`,e)}}if(m!=null&&m instanceof l.DropdownContents&&c.FINITE_OPTION_INPUT_TYPES.has(m.get_input_type())&&!this.property.ignore_issue_checker){const r=m.find((e=>e.display===h||e.value===h))!=null;if(!r&&m.get_display_for_literal(h)==null){var p,_,f;const r=(p=(_=m.get_display_for_literal(h))!=null?_:(f=e.display)==null?void 0:f.call(e))!=null?p:"your choice";n(`${t()} - ${r} is not a possible option`,e)}}}return true}}class D extends _{_type_check(e,t,n){var r,i;return!!((r=(i=this.property).check_for_error)!=null&&r.call(i,this.property,e,t,n))}}class C extends _{}class T extends _{}class N extends _{constructor(e,t){super(e,t);this.range_data_node=void 0;this.origin_address_data_node=void 0;this.range_data_node=i.default.new_expression(this.node.json.child("value").child("range"),this.node.owner);this.origin_address_data_node=i.default.new_expression(this.node.json.child("value").child("origin_address"),this.node.owner)}_type_check(e,t,n){if(!this.range_data_node.exists()){const e=`${t()}: remember to fill out the search range with a number`;n(e,this.range_data_node)}else{const e=this.range_data_node.get_eval_value();if(!e.matches("number")){const r=`${t()}: the range should be a number but right now it is a ${e.display()}`;n(r,this.range_data_node)}}if(!this.origin_address_data_node.exists()){const e=`${t()}: remember to fill out the search origin`;n(e,this.origin_address_data_node)}else{const e=this.origin_address_data_node.get_eval_value();if(!r.get("geographic_address").synonyms().includes(e.id())){const r=`${t()}: the search origin should be a Geographic Address but right now it is a ${e.display()}`;n(r,this.origin_address_data_node)}}return true}}class P extends _{}class I extends _{_type_check(e,t,n){var r,i;const{id_field:s}=this.property;if(s==null){throw new Error("id_field is null")}const o=this.property.static_list().map((e=>({id:e[s],found:false})));const a=false;const l=(r=e==null?void 0:(i=e.entries)==null?void 0:i.call(e))!=null?r:[];let c;let u=true;for(let e=0;e<l.length;e++){c=l[e];const r=o.find((e=>{var t;return e.id===((t=c)==null?void 0:t.json.child(s).raw())}));if(r!=null){r.found=true;for(const r of this.property.sub_properties(c,this.node,e)){var d,p;const e=c;const i=B(e,r);const s=(d=(p=r.prop_node)==null?void 0:p.call(r,e))!=null?d:c.property(r.name);u=u&&!!i.type_check(t,n,s)}}else if(!a){n(`${t()}: Extra / Missing arguments. Click here to autofix`,c)}}if(!a&&o.find((e=>!e.found))!=null){n(`${t()}: Extra / Missing arguments. Click here to autofix`,c)}return u}}class R extends _{_type_check(e,t,n){var r,i;const s=(r=e==null?void 0:(i=e.entries)==null?void 0:i.call(e))!=null?r:[];for(let e=0;e<s.length;e++){const r=s[e];for(const i of this.property.sub_properties(r,this.node,e)){var o,a;const e=r;const s=B(e,i);const l=(o=(a=i.prop_node)==null?void 0:a.call(i,e))!=null?o:r.property(i.name);s.type_check(t,n,l)}}return true}}class L extends S{}const z={[o.EditorType.ShortText]:f,[o.EditorType.LongText]:h,[o.EditorType.Basic]:m,[o.EditorType.NoEditor]:g,[o.EditorType.CheckBox]:v,[o.EditorType.StaticText]:b,[o.EditorType.StaticDate]:y,[o.EditorType.StaticMultiLineText]:w,[o.EditorType.StaticNumber]:x,[o.EditorType.CSSDimension]:j,[o.EditorType.Color]:A,[o.EditorType.Image]:M,[o.EditorType.IconPicker]:E,[o.EditorType.DynamicImage]:k,[o.EditorType.DynamicFile]:O,[o.EditorType.Dropdown]:S,[o.EditorType.Label]:D,[o.EditorType.Button]:C,[o.EditorType.CropButton]:T,[o.EditorType.GeographicSearch]:N,[o.EditorType.CheckboxList]:P,[o.EditorType.StaticList]:I,[o.EditorType.ObjectList]:R,[o.EditorType.FlyoutObjectList]:R,[o.EditorType.DropdownButton]:L};n.checkers=z;function B(e,t){try{return new z[t.editor](e,t)}catch(e){throw new Error(`No checker for editor ${t.editor} for property ${t.name}`)}}},{"../constants/composer":54,"../constants/elements":61,"../editor/composer/utilities/dropdown_contents":556,"../editor/utils/evaluate_condition":594,"./btypes":653,"./elements/types":685,"./lang":714,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123}],713:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.add_user_font_token=_;n.default_font_tokens_to_property=g;n.delete_user_font_token=f;n.load_font_tokens_default=h;n.load_font_tokens_user=m;n.user_font_tokens_to_property=v;e("core-js/modules/es.string.replace.js");var r=p(e("./appquery"));var i=e("../constants/fonts");var s=e("../constants/tokens");var o=e("../webfonts");var a=d(e("./../client/analytics"));var l=e("./../constants/segment_events");var c=e("../u/shared/b_object");function u(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=u(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function p(e){return e&&e.__esModule?e:{default:e}}function _(e,t){var n;let o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"default";const u=r.default.uid();const d=(n=r.default.get_public_setting("font_tokens_user"))!=null?n:(0,c.json_deep_copy)(s.DEFAULT_USER_TOKENS);d[o][u]={font_family:i.DEFAULT_FAMILY,name:e,description:t,order:Object.keys(d[o]).length,deleted:false};a.track(l.STYLES_VARIABLE_CREATED,{app:r.default.appname(),token:u,variant:o,name:e,description:t,type:"Font"});r.default.set_setting(true,"font_tokens_user",d);r.default.commit()}function f(e,t){var n;const i=(n=r.default.get_public_setting("font_tokens_user"))!=null?n:(0,c.json_deep_copy)(s.DEFAULT_USER_TOKENS);const o=i[e][t].order;for(const t in i[e]){if(i[e][t].order>o){i[e][t].order-=1}}a.track(l.STYLES_VARIABLE_DELETED,{app:r.default.appname(),token:t,variant:e,name:i[e][t].name,description:i[e][t].description,type:"Font"});i[e][t].deleted=true;i[e][t].name+=s.DELETED_USER_TOKEN_STRING;r.default.set_setting(true,"font_tokens_user",i);r.default.commit()}function h(){var e;const t=(e=r.default.get_public_setting("font_tokens"))!=null?e:i.DEFAULT_TOKENS;for(const e in t){i.ALL_WEIGHTS.forEach((n=>{(0,o.load_font)((0,o.to_font_face)(t[e],n))}))}}function m(){var e;const t=(e=r.default.get_public_setting("font_tokens_user"))!=null?e:(0,c.json_deep_copy)(s.DEFAULT_USER_TOKENS);for(const e in t){for(const n in t[e]){i.ALL_WEIGHTS.forEach((r=>{(0,o.load_font)((0,o.to_font_face)(t[e][n].font_family,r))}))}}}function g(){var e;const t=(e=r.default.get_public_setting("font_tokens"))!=null?e:i.DEFAULT_TOKENS;const n={};for(const e in t){n["--font_"+e]=JSON.stringify(t[e].replace(i.CUSTOM_FONT_FLAG,""))}return n}function v(){var e;const t=(e=r.default.get_public_setting("font_tokens_user"))!=null?e:(0,c.json_deep_copy)(s.DEFAULT_USER_TOKENS);const n={};for(const e in t){for(const r in t[e]){if(!t[e][r].font_family){continue}n["--font_"+r+"_"+e]=JSON.stringify(t[e][r].font_family.replace(i.CUSTOM_FONT_FLAG,""))}}return n}},{"../constants/fonts":68,"../constants/tokens":93,"../u/shared/b_object":839,"../webfonts":858,"./../client/analytics":20,"./../constants/segment_events":85,"./appquery":651,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],714:[function(e,t,n){"use strict";const r=n;const i=e("../safe_require");i.safe_register("./lang/lang",r);const s=e("../constants/lang");r.DETECT_FIELD_NAMES=s.DETECT_FIELD_NAMES;const o=e("./nodes/node_types");const a=e("./nodes");const l=e("./app_json");const c=e("./caching");const u=e("./expressions");const d=e("./workflow");const p=e("./application/RAW");e("./elements");e("./application");const _=e("./appquery");_.add_methods(a.get(o.APPLICATION_VERSION));const f={};Object.values(o).forEach((e=>{if(a.has(e)){f[e]=a.get(e)}}));r.make_run_app=function(e,t,n){return new r.ApplicationVersion(new r.RuntimeJSON(e,null,null,null,t,n))};const h={...a,...d,...u,...l,...c,...f,RAW:p,EnhancedArray:a.get_EnhancedArray(),DETECT_FIELD_NAMES:s.DETECT_FIELD_NAMES};t.exports=Object.assign(r,h)},{"../constants/lang":73,"../safe_require":777,"./app_json":629,"./application":650,"./application/RAW":646,"./appquery":651,"./caching":656,"./elements":680,"./expressions":711,"./nodes":721,"./nodes/node_types":722,"./workflow":737}],715:[function(e,t,n){"use strict";const r=n;const i=e("./../u");const s=e("./../logger");const o=e("./elements/State");r.node_label=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:40;let n="[not found]";if(e instanceof o){n=e.condition().get_tree_display()}else if(e.get_tree_display!=null){n=e.get_tree_display()}else if(e.display!=null){var r;n=(r=e.display())!=null?r:n}if(n.length>t){n=n.slice(0,t)+"..."}return n};r.simplify_data=function(e,t,n){var o;(o=t)!=null?o:t="";if(e==null){return null}if(typeof e==="number"&&isNaN(e)){return null}if(typeof e==="function"){return null}if(typeof e==="object"){let o=false;let a=true;if(Array.isArray(e)){a=false}const l={};for(const c in e){const u=e[c];if(i.firebase_illegal(c)&&!i.is_plugin_edit_mode()){a=false;s.error("illegal key",{k:c,path:t});if(!n){delete e[c]}}const d=t?t+"."+c:c;const p=r.simplify_data(u,d,n);if(u!==p){a=false}if(p!=null){o=true;l[c]=p}}if(o){return a?e:l}else{return null}}return e};r.delete_key=function(e,t){if(Array.isArray(e)){t=parseInt(t);e.splice(t,1)}else{delete e[t]}}},{"./../logger":744,"./../u":823,"./elements/State":674}],716:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../constants/core");const s=e("../u/shared/b_object");const o=e("./btypes");const a={};r.register_migration=e=>{var t,n;(n=a[t=e.plugin_name])!=null?n:a[t]=[];a[e.plugin_name].push(e)};r.register_migration({plugin_name:"Action:TriggerCustomEvent",original_path:"properties.workflow_thing",new_path:"properties.arguments.0.arg_value",additional_info:()=>({param_id:i.LEGACY_PARAM_ID})});r.register_migration({plugin_name:"Action:ScheduleCustom",original_path:"properties.workflow_thing",new_path:"properties.arguments.0.arg_value",additional_info:()=>({param_id:i.LEGACY_PARAM_ID})});r.register_migration({plugin_name:"Action:TriggerCustomEventFromReusable",original_path:"properties.workflow_thing",new_path:"properties.arguments.0.arg_value",additional_info:()=>({param_id:i.LEGACY_PARAM_ID})});r.register_migration({plugin_name:"Event:CustomEvent",original_path:"properties.custom_event_data_type",new_path:"properties.parameters.0.btype_id",additional_info:e=>{const t=o.get(e);const n=t.is_missing()?"Thing":t.display();return{param_id:i.LEGACY_PARAM_ID,param_name:"Workflow's "+n}}});r.get_raw_migration=e=>{var t;return(t=a[e])!=null?t:[]};r.get_migration_fn=e=>{const t=a[e];if(t){return e=>{let n=false;for(const r of t){const t=e.child_by_path(r.original_path).raw();if(t!=null){n=true;const i=r.new_path.split(".");const o=i[i.length-1];const a=r.new_path.substring(0,r.new_path.length-o.length-1);e.child_by_path(a).set(s.extend({[o]:t},r.additional_info(t)));e.child_by_path(r.original_path).set(null)}}return n}}return()=>false}},{"../constants/core":55,"../u/shared/b_object":839,"./btypes":653,"core-js/modules/web.dom-collections.iterator.js":1123}],717:[function(e,t,n){"use strict";const r=t.exports;const i="Missing btype:";const s="Missing type... ";r.list=()=>[];r.namespace_prefix=()=>i;r.is_missing=e=>e.startsWith(i);r.strip_prefix=e=>r.is_missing(e)?e.slice(i.length+1):e;r.get=function(e){const t=`${i} ${e}`;const n={name:e,id:()=>t,is_missing:()=>true,storable:false,is_simple:false,can_sort:false,display:()=>s,display_for_issue(){let e="a non-defined btype";if(this.id().indexOf("_current")!==-1){e+=" (reinitialize the plugin call)"}return e},debugging_display:function(t){return`(Value is of an unknown type ${e} and cannot be displayed)`},matches:n=>n===e||n===t,cast:()=>null,get_bubble_null:()=>null,get_message_names:()=>[],get_message:e=>undefined};return n}},{}],718:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("./registry");const s=e("./nodes_utils");t.exports=class e{constructor(e){this.json=e}get is_node(){return true}has_id(){return false}toString(){return this.lang_constructor+"<"+this.json.path()+">"}toUniqueString(){return this.lang_constructor+"<"+this.json.toUniqueString()+">"}app(){var e;const t=this.json.root();(e=t._appnode_application_version_cache)!=null?e:t._appnode_application_version_cache=i.create("ApplicationVersion",t);return t._appnode_application_version_cache}id(){return this.json.id()}is_equal_to(e){return(e==null?void 0:e.toUniqueString())===this.toUniqueString()}path(){return this.json.path()}raw(){return this.json.raw()}read_index(){return this.json.read_index(...arguments)}is(e){return s.make_filter(e)(this)}exists(){return this.json.exists()}ensure_exists(){const e=this.json.ensure_exists();if(!e){return null}return this}serialize(){if(!this.lang_constructor){throw new r.UnexpectedError("missing lang_constructor: "+this.constructor.name)}function e(e){if(e.is_json){return{type:"json",value:e._path()}}else if(e.is_node){return{type:"node",value:e.serialize()}}else{return{type:"raw",value:e}}}const t=this.serialize_args().map((t=>e(t)));return{constructor_name:this.lang_constructor,args:t}}serialize_args(){return[this.json]}pre_cache(e,t){this.json.pre_cache(e,t)}uid(){return this.json.uid()}commit(){var e;this.json.get_undostack().commit((e=this.owner)==null?void 0:e.virtual)}commit_merge(){this.json.get_undostack().commit_merge()}is_protected(){return false}get_comment_node(e){if(!this.id()){return}return this.app().comment(this.id(),e)}has_comment(e){const t=this.get_comment_node(e);return(t==null?void 0:t.exists())&&t.get()}}},{"../../u":823,"./nodes_utils":723,"./registry":724,"core-js/modules/web.dom-collections.iterator.js":1123}],719:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../lib");const i=e("./HasProperties");const s=e("./nodes_utils");t.exports=class e extends i{exists(){return this.json.child("id").exists()}has_id(){return true}check_for_errors(e){const t=this.fields();const n=[];for(const i of t){const t=r().getChecker(this,i);if(t.type_check((()=>this.display(true)),e)){n.push(this.property(i.name))}}return{children:s.enhance_array(n)}}}},{"../../lib":741,"./HasProperties":720,"./nodes_utils":723,"core-js/modules/web.dom-collections.iterator.js":1123}],720:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i,s;function o(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const a=e("../../u");const l=e("../../lib");const c=e("../../u/shared/async/b_fiber");const u=e(".././../logger");const d=e("../caching");const p=e("./registry");const _=e("../shrink");const{S:f}=_;const h=e("../../constants/lang");const m=e("./nodes_utils");const g=e("./AppNode");const v=e("../appquery");const b=e("../btype_ids");const y={};t.exports=(r=d.cached({type:d.RUN_MODE,parameters:1}),i=d.cached({type:d.RUN_MODE}),s=class e extends g{get_default(e){var t;if(!this.field_names){throw new a.UnexpectedError("does not have field names defined: "+this)}const n=this.field_names();if(n===h.DETECT_FIELD_NAMES){return null}return(t=n[e])==null?void 0:t.default}fields(e){const t=this.field_names();const n=this._fields(e);return n.map((e=>a.extend({},e,t[e.name])))}_field_data(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;const n=this.fields(t).find((t=>t.name===e));return n!=null?n:{name:e,editor:"NoEditor"}}get_custom_parameters(){var e,t;const n=this.property("parameters");const r=(e=(t=n.entries)==null?void 0:t.call(n))!=null?e:[];return r.map((e=>{var t;const n=(t=e.get_static_property("btype_id"))!=null?t:e.get_static_property("value");const r=e.get_static_property("is_list");return{param_id:e.get_static_property("param_id"),param_name:e.get_static_property("param_name"),optional:e.get_static_property("optional"),btype_id:r?b.list_type(n):n}}))}preprocess_properties(e,t){return e}property(e){var t;const n=`${v.app_version()}${this.json.path_cache()}${e}`;let r;if(a.on_server()){var i,s;(s=(i=c.Fiber.current)._property_json_cache)!=null?s:i._property_json_cache=new LRU({max:1e3,length:()=>1});const t=c.Fiber.current._property_json_cache;if(!t.has(n)){r=this.json._gchild(f.properties,_.shrink(e));t.set(n,r)}else{r=t.get(n)}}else{var o;(o=y[n])!=null?o:y[n]=this.json._gchild(f.properties,_.shrink(e));r=y[n]}return p.new_expression(r,(t=this._property_owner)!=null?t:this)}set_property(e,t,n){var r;if(typeof((r=t)==null?void 0:r.raw)==="function"){t=t.raw()}const i=this.property(e).raw();if(JSON.stringify(i)===JSON.stringify(t)){return}const s=this.id();if(!s){throw new a.UnexpectedError("trying to set property on something without an id... should override set property!")}const o={target_id:s,path:"properties."+e,old_value:i,value:t};if(n&&n!==v.appname()){o.source_appname=n}else{a.add_source_appname_tracker_to_change_args(t,o,v.appname())}const c=l().changes.create_change("SetData",o);return c.execute()}get_static_property(e){const t=this.json._raw_gchild(f.properties,_.shrink(e));if(t!=null){if(typeof t==="object"){switch(t[f.type]){case"Empty":return null;case"TextExpression":{var n;const e=(n=t[f.entries])!=null?n:[];const r=[];Object.values(e).forEach((e=>{if(e!=null&&typeof e==="object"){u.verbose("stringifying object object",{_raw:t})}r.push(e)}));return r.join("")}case"GeoAddressNode":return t[_.shrink("val")];default:return t}}else{return t}}else{var r;return(r=this.get_default(e))!=null?r:null}}properties(){return m.enhance_array(this.json._child(f.properties).children().map((e=>{var t;return p.new_expression(e,(t=this._property_owner)!=null?t:this)})))}},o(s.prototype,"get_static_property",[r],Object.getOwnPropertyDescriptor(s.prototype,"get_static_property"),s.prototype),o(s.prototype,"properties",[i],Object.getOwnPropertyDescriptor(s.prototype,"properties"),s.prototype),s)},{"../../constants/lang":73,"../../lib":741,"../../u":823,"../../u/shared/async/b_fiber":833,".././../logger":744,"../appquery":651,"../btype_ids":652,"../caching":656,"../shrink":728,"./AppNode":718,"./nodes_utils":723,"./registry":724,"core-js/modules/web.dom-collections.iterator.js":1123}],721:[function(e,t,n){"use strict";const r=e("./registry");const i=e("./node_types");const s=e("./AppNode");const o=e("./HasProperties");const a=e("./HasID");const l=e("./nodes_utils");t.exports={...l,...i,...r};const c=t.exports;c.AppNode=s;c.HasProperties=o;c.HasID=a;r.add(i.APP_NODE,s,{abstract:true});r.add(i.HAS_PROPERTIES,o,{abstract:true});r.add(i.HAS_ID,a,{abstract:true})},{"./AppNode":718,"./HasID":719,"./HasProperties":720,"./node_types":722,"./nodes_utils":723,"./registry":724}],722:[function(e,t,n){"use strict";var r=function(e){e["APP_NODE"]="AppNode";e["HAS_PROPERTIES"]="HasProperties";e["HAS_ID"]="HasID";e["FAKE_APPLICATION"]="FakeApplication";e["APPLICATION"]="Application";e["APPLICATION_VERSION"]="ApplicationVersion";e["API_WORKFLOWS"]="API";e["CUSTOM_TYPE"]="CustomType";e["SECURABLE_TYPE"]="SecurableType";e["CUSTOM_FIELD_STATE"]="CustomFieldState";e["CUSTOM_FIELD"]="CustomField";e["PRIVACY_ROLE"]="PrivacyRole";e["OPTION_SET"]="OptionSet";e["OPTION_ATTRIBUTE"]="OptionAttribute";e["OPTION_VALUE"]="OptionValue";e["COMMENT"]="Comment";e["EXPRESSION"]="Expression";e["EMPTY"]="Empty";e["LITERAL"]="Literal";e["OBJECT_LITERAL"]="ObjectLiteral";e["TEXT_EXPRESSION"]="TextExpression";e["LIVE_EXPRESSION"]="LiveExpression";e["DATA_SOURCE"]="DataSource";e["MESSAGE_NODE"]="MessageNode";e["GEO_ADDRESS_NODE"]="GeoAddressNode";e["WORKFLOW_OBJECT"]="WorkflowObject";e["GENERIC_EVENT"]="GenericEvent";e["EVENT"]="Event";e["API_EVENT_OBJECT"]="APIEventObject";e["ACTION"]="Action";e["STATE"]="State";e["TRANSITION"]="Transition";e["GENERIC_ELEMENT"]="GenericElement";e["ELEMENT"]="Element";e["STYLE"]="Style";e["STYLE_STATE"]="StyleState";e["CUSTOM_STATE"]="CustomState";e["ROOT"]="Root";e["PAGE"]="Page";e["CUSTOM_DEFINITION"]="CustomDefinition";return e}(r||{});t.exports=r},{}],723:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../u");const s=e("../../lib");const o=e(".././../logger");const a=e(".././shrink");const{S:l}=a;const c=e("../../constants/app_json");const u=e("../app_json/json_base");const d=e("./registry");const p=e("../enhanced_array");const _=e("../../u/shared/decaf");const f=e("../nodes/node_types");const{OBJECT_MARKER:h}=c;r.deserialize=function(e,t){function n(t){switch(t.type){case"json":return e.json.by_path(t.value);case"node":return r.deserialize(e,t.value);case"raw":return t.value;default:throw new i.UnexpectedError(t.type)}}const s=t.args.map((e=>n(e)));const a=s[0];const l=s[1];const c=s[2];if(s.length>3){o.error("error deserializing: we have something with more than 3 args",{constructor_name:t.constructor_name})}return d.create(t.constructor_name,a,l,c)};r.filter_array=function(e,t){if(!e){return r.enhance_array(t)}e=r.make_filter(e);const n=[];for(const r of t!=null?t:[]){if(e(r)){n.push(r)}}return r.enhance_array(n)};function m(){return"Compiled filter: "+this._original}function g(e,t,n,s,o,a){if(e){if(a instanceof u.JSONBase){throw new i.UnexpectedError("We do not support running class filters on JSONs")}const t=a._raw?r.from_raw(a):a;if(!(t instanceof e)){return false}}let c,d,p;if(a instanceof u.JSONBase){c=a;d=true}else if(a._raw!=null){p=a._raw;d=false}else{c=a.json;d=true}if(d){if(!c){return false}if(t&&t!==c._child(l.type).get()){return false}if(n){var f;let e=c._raw_gchild(l.properties,n);if(((f=e)==null?void 0:f[l.type])==="TextExpression"){e=_.object_values(e[l.entries]).join("")}if(String(e)!==s){return false}}if(o&&c._child(l.name).get()!==o){return false}return true}else{if(p==null){return false}if(t&&t!==p[l.type]){return false}if(n){var h,m;let e=(h=p[l.properties])==null?void 0:h[n];if(((m=e)==null?void 0:m[l.type])==="TextExpression"){e=_.object_values(e[l.entries]).join("")}if(String(e)!==s){return false}}if(o&&p[l.name]!==o){return false}return true}}function v(){return true}v.toString=()=>"Identity filter";const b={};r.make_filter=function(e){if(!e){return v}if(typeof e==="function"){return e}if(!b[e]){let t,n;if(e.charAt(0)==='"'){const r=e.indexOf('"',1);n=e.substring(1,r);t=e.substring(r+2)}else{const r=e.split(".");n=r[0];t=r.slice(1).join(".")}let r,i,s;if(t){r=t.split("=")[0];s=t.split("=")[1];if(r==="name"){i=s;r=null}if(r==="\name"){r="name"}}r=a.shrink(r);let l;if(d.has(n)){o.error("Deprecated: filter using class_type",{filter_str:e});l=d.get(n);n=null}b[e]=g.bind(null,l,n,r,s,i);b[e]._type=n;b[e]._original=e;b[e].toString=m}return b[e]};r.to_raw=function(e){var t;const{json:n}=e;const s=n._raw();if(s==null){return null}const o=n._path();let a;if((t=e.owner)!=null&&t.is_node){a=r.to_raw(e.owner);a.converter=e.owner.make_new;if(!a.converter){throw new i.UnexpectedError("Class "+e.owner.constructor.name+" is missing a make_new function")}}return{_raw:s,_path:o,owner:a}};r.from_raw=function(e,t,n){let{_raw:s,_path:o,owner:a}=n;const l=e.root().by_path(o);if(a!=null){if(!a.converter){throw new i.UnexpectedError("bad owner:\n"+JSON.stringify({_raw:s,_path:o,owner:a},null,4))}a=r.from_raw(e,a.converter,a)}return t(l,a)};r.from_raw_array=(e,t,n)=>r.enhance_array(n.map((n=>r.from_raw(e,t,n))));r.raw_child=function(e,t){let{_raw:n,_path:r,owner:i}=e;n=n[t];if(!n){return null}r=r+"."+t;return{_raw:n,_path:r,owner:i}};r.set_owner=function(e,t,n){e.owner=t;t.converter=n};r.raw_children=function(e,t){var n;let{_raw:r,_path:i,owner:s}=e;const o=i+"."+t+".";const a=(n=r[t])!=null?n:{};return Object.entries(a).filter((e=>{let[t,n]=e;return n!=null&&!["length",h].includes(t)})).map((e=>{let[t,n]=e;return{_raw:n,_path:o+t,owner:s}}))};r.raw_properties=function(e,t){var n;const{_raw:r,_path:i}=e;e.converter=t;const s=i+"."+l.properties+".";const o=(n=r[l.properties])!=null?n:{};return Object.entries(o).filter((e=>{let[t,n]=e;return n!=null&&!["length",h].includes(t)})).map((t=>{let[n,r]=t;return{_raw:r,_path:s+n,owner:e}}))};r.raw_array_node=function(e){let{_raw:t,_path:n,owner:r}=e;const i=n+".";const s=t!=null?t:{};return Object.entries(s).filter((e=>{let[t,n]=e;return n!=null&&!["length",h].includes(t)})).map((e=>{let[t,n]=e;return{_raw:n,_path:i+t,owner:r}}))};let y=null;function w(){const e=[];const t=["asdf"];for(const n of d.list()){const r=d.get(n);if(r&&r.prototype instanceof d.get(f.APP_NODE)){for(const n of i.all_keys(r.prototype)){if(t[n]==null){e.push(n)}}}}y=p.build_class(e,{filter(e){return r.filter_array(e,this)}})}r.get_EnhancedArray=function(){if(!y){w()}return y};r.enhance_array=function(e){if(!y){w()}const t=new y;Array.prototype.push.apply(t,e);return t};r.to_array=function(e){if(e.to_array){return e.to_array()}else{return e}};r.deep_replace=function(e,t){if(!e||typeof e!=="object"){return}Object.entries(e).forEach((n=>{let[i,s]=n;if(s&&typeof s==="object"){r.deep_replace(s,t)}else if(t[s]!==undefined){if(A(i)){e[i]=t[s]}else{o.verbose("found what looks like an id in a non-whitelisted property.",{key:a.expand(i),value:s})}}}))};r.deep_copy_with_new_ids=function(e,t){var n;const s=i.json_deep_copy(e);(n=t)!=null?n:t={};x(s,t);r.deep_replace(s,t);return[s,t]};function x(e,t,n){var r;if(!e||typeof e!=="object"){return}(r=n)!=null?r:n=j(e);function i(){let e=null;while(e==null||n.has(e)){e=s().app().uid()}return e}_.object_entries(e).forEach((r=>{let[s,o]=r;if(o&&typeof o==="object"){x(o,t,n)}else if(["id","_id"].includes(s)){let n;if(t[o]){console.log("warning with change_all_ids: two objects had the same id: "+o);n=i()}else{t[o]=n=i()}e[s]=n}}))}function j(e){const t=new Set;if(e==null||typeof e!=="object"){return t}function n(e){_.object_entries(e).forEach((e=>{let[r,i]=e;if(["id","_id"].includes(r)&&typeof i==="string"){t.add(i)}else if(i!=null&&typeof i==="object"){n(i)}}))}n(e);return t}function A(e){e=a.expand(e);if(["page","id","custom_event","alert_element","said"].includes(e)){return true}let t=e.indexOf("_id");if(t!==-1&&(t=e.length-3)){return true}if(e==="reference"){return true}return false}},{"../../constants/app_json":45,"../../lib":741,"../../u":823,"../../u/shared/decaf":844,".././../logger":744,".././shrink":728,"../app_json/json_base":630,"../enhanced_array":686,"../nodes/node_types":722,"./registry":724,"core-js/modules/web.dom-collections.iterator.js":1123}],724:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../u/shared/errors");const s={};const o={};r.add=function(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const{abstract:r=false}=n;s[e]=t;t.prototype.lang_constructor=e;if(!r&&!t.prototype.make_new){t.prototype.make_new=e=>new t(e)}};r.has=function(e){return e in s};r.is=function(e,t){return e instanceof r.get(t)};r.get=function(e){if(!s[e]){throw new i.UnexpectedError("Unknown app node type",{name:e})}return s[e]};r.list=()=>Object.keys(s);r.create=function(e){const t=r.get(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++){i[s-1]=arguments[s]}return new t(...i)};r.add_generic=function(e,t){o[e]=t};r.create_generic=function(e){if(!o[e]){throw new i.UnexpectedError("Unknown generic app node type",{name:e})}for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++){n[r-1]=arguments[r]}return o[e](...n)};r.new_element=r.create_generic.bind(null,"element");r.new_expression=r.create_generic.bind(null,"expression");r.new_workflow_item=r.create_generic.bind(null,"workflow_item")},{"../../u/shared/errors":846,"core-js/modules/web.dom-collections.iterator.js":1123}],725:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Plugin=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=f(e("../services/shared/plugin_getter"));var i=f(e("../services/shared/plugin_registry"));var s=_(e("../services/shared/service_type_parser"));var o=f(e("./appquery"));var a=_(e("../u"));var l=_(e("../logger"));var c=_(e("../constants/plugin"));var u=_(e("../constants/known_plugins"));var d=_(e("../core/core_elements/shared/image_utils"));function p(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(p=function(e){return e?n:t})(e)}function _(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=p(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function f(e){return e&&e.__esModule?e:{default:e}}const h=n;h.is_hardcoded=e=>{const t=s.get_plugin_id(e);return!a.is_UUID(t)};const m=e=>typeof e==="string"?JSON.parse(e):[];const g={};class v{constructor(e,t){this.id=e;this.data=t}_raw(){if(!this.data){return null}return this.data}exists(){return this.data!=null}is_missing(){var e;return((e=this._raw())==null?void 0:e.display)==null}deleted(){var e;return this.is_missing()||((e=this._raw())==null?void 0:e.deleted)}display(){var e;if(this.is_missing()){return"Removed plugin ("+this.id+")"}return(e=this._raw())==null?void 0:e.display}description(){var e,t;let n=(e=(t=this._raw())==null?void 0:t.description)!=null?e:"";if(this.deleted()){n+=" \n\nNote that the plugin author has removed this plugin from the marketplace. You can still use it in your application but it cannot be installed in new ones."}return n}is_official(){var e,t,n,r;const i=(e=this._raw())==null?void 0:e.official;const s=[c.NO_CREATOR_NAME,c.LEGACY_NO_CREATOR_NAME].includes((t=(n=this._raw())==null?void 0:n.creator_name)!=null?t:"");const o=(r=this._raw())==null?void 0:r.creator_id;const a=!o||c.BUBBLE_TEAM_MEMBER_IDS.includes(o);return!!i||!s&&a}help(){var e,t;return(e=(t=this._raw())==null?void 0:t.help)!=null?e:""}icon(){var e;const t=(e=this._raw())==null?void 0:e.icon;if(!t){return}return d.optimize_image(t+"?ignore_imgix")}has_version(){return!h.is_hardcoded(this.id)&&!this.is_testing()&&!this.is_missing()}versions(){var e;if(!this.has_version()){return{}}const t=m((e=this.data)==null?void 0:e.history);const n={};for(const{version:e,description:r}of t==null?void 0:t.reverse()){n[e]=`${e} - ${r}`}return n}latest_version(){var e;if(!this.has_version()){return}return(e=this._raw())==null?void 0:e.last_version}current_version(){return o.default.get_public_setting(`plugins.${this.id}`)}is_testing(){var e;return(e=this._raw())==null?void 0:e.testing}_get_review_hash(){return this.id+"_"+this.current_version()}get_current_user_review(e){const t=g[this._get_review_hash()];if(t){return e(t)}i.default.get_hardcoded_plugin(u.BUBBLE_PLUGIN).get_call("get_current_user_review").execute_async(undefined,{plugin_id:this.id,version:this.current_version()}).callback(((t,n)=>{if(t){l.log(t);return}const r=n!=null?n:{};g[this._get_review_hash()]=r;e(r)}))}submit_review(e,t){e.plugin_id=this.id;e.version=this.current_version();i.default.get_hardcoded_plugin(u.BUBBLE_PLUGIN).get_call("create_plugin_review").execute_async(undefined,e).callback(((e,n)=>{if(e){l.log(e);return}g[this._get_review_hash()]=n;t()}))}update_review(e,t){e.plugin_id=this.id;e.version=this.current_version();i.default.get_hardcoded_plugin(u.BUBBLE_PLUGIN).get_call("modify_plugin_review").execute_async(undefined,e).callback(((e,n)=>{if(e){l.log(e);return}g[this._get_review_hash()]=n;t()}))}delete_review(e,t){const n={review_id:e};i.default.get_hardcoded_plugin(u.BUBBLE_PLUGIN).get_call("delete_plugin_review").execute_async(undefined,n).callback((e=>{if(e){l.log(e);return}delete g[this._get_review_hash()];t()}))}link(){var e;let t=(e=this._raw())==null?void 0:e.link;if(t!=null&&t.indexOf("http://")!==0&&t.indexOf("https://")!==0){t="http://"+t}return t}tags(e){var t,n,r;if(e===c.BUILT_BY_TAG_TYPE){return this.is_official()?[c.OFFICIAL_TAG_NAME]:[c.THIRD_PARTY_TAG_NAME]}else if(e===c.PREMIUM_TAG_TYPE){return this.is_paid()?[c.PREMIUM_TAG_TYPE]:[c.FREE_TAG_NAME]}return(t=(n=this._raw())==null?void 0:(r=n.tags)==null?void 0:r[e])!=null?t:[]}count(){var e,t;return Math.floor((e=(t=this._raw())==null?void 0:t.count)!=null?e:0)}creator_name(){var e;return(e=this._raw())==null?void 0:e.creator_name}creator_icon(){var e,t;return(e=(t=this._raw())==null?void 0:t.creator_icon)!=null?e:"https://meta.cdn.bubble.io/f1596591999203x427202078355184900/Anonymous.png"}creator_url(){var e;const t=(e=this._raw())==null?void 0:e.creator_id;return t?`https://bubble.io/contributor/${t}`:undefined}should_show_creator_url(){var e;return(e=this._raw())==null?void 0:e.should_show_creator_url}plugin_page_url(){var e;const t=(e=this._raw())==null?void 0:e.meta_id;return t?`https://bubble.io/plugin/${t}`:undefined}bubble_manual_link(){var e;return(e=this._raw())==null?void 0:e.bubble_manual_link}published_date(){var e;return(e=this._raw())==null?void 0:e.published_date}all_versions_rating(){var e;const t=this.has_version();return t?(e=this._raw())==null?void 0:e.all_versions_rating:undefined}last_version_rating(){var e;const t=this.has_version();return t?(e=this._raw())==null?void 0:e.last_version_rating:undefined}_get_price(e){var t;if(this.is_testing()){return 0}return(t=this._raw())==null?void 0:t[e]}price(){return this._get_price("price")}one_time_price(){return this._get_price("one_time_price")}payment_type(){return this._get_price("payment_type")}is_authorized(){var e,t;const n=(e=(t=this._raw())==null?void 0:t.authorized_apps)!=null?e:[];return n.includes(o.default.appname())}license(){const e=this._get_price("license");if(e===c.LICENSE_COMMERCIAL&&this.is_authorized()){return c.LICENSE_PRIVATE}return e}documented(){var e;return(e=this._raw())==null?void 0:e.documented}hidden(){var e;return(e=this._raw())==null?void 0:e.hidden}can_install(){const e=this._raw();if(e==null||e.needs_permission){return o.default.get_private_setting(`plugin_can_install_${this.id}`)}else{return true}}matches(e,t){const n=this.tags(c.TYPES_TAG_TYPE);if(!n.length){return true}if(e&&!n.includes(e)){return false}if(t&&t!=="plugins"&&!this.tags(c.CATEGORIES_TAG_TYPE).includes(t)){return false}return true}get_service(){var e;return(e=r.default.get_plugin(this.id,this.current_version()))!=null?e:b}is_paid(){const e=this.price();const t=this.one_time_price();const n=e?e>0:false;const r=t?t>0:false;return(n||r)&&this.license()===c.LICENSE_COMMERCIAL}}n.Plugin=v;const b={is_missing(){return true}};h.Plugin=v},{"../constants/known_plugins":72,"../constants/plugin":78,"../core/core_elements/shared/image_utils":363,"../logger":744,"../services/shared/plugin_getter":783,"../services/shared/plugin_registry":784,"../services/shared/service_type_parser":785,"../u":823,"./appquery":651,"core-js/modules/web.dom-collections.iterator.js":1123}],726:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../safe_require");i.safe_register("./lang/plugins",r);const s=e("../lib");const o=e("../constants/plugin");const a=e("../constants/known_plugins");const l=e("../u/shared/decaf");const c=e("./plugin");r.get_all_tags=function(e){return o.TAG_TYPE_TO_NAMES[e]||_.get_hardcoded_plugin(a.BUBBLE_PLUGIN).get_call("get_plugins_tags").execute(undefined,{tag_type:e})};let u=null;function d(){if(!u){u=_.get_hardcoded_plugin(a.BUBBLE_PLUGIN).get_call("get_edit_mode_plugins_list").execute(undefined,{appname:f.appname(),current_plugins:f.get_plugin_versions()})}return u}function p(e,t){var n;if(!e){return}if(s().is_edit_mode()&&(n=d())!=null&&n[e]){var r;return(r=d())==null?void 0:r[e]}return _.get_hardcoded_plugin(a.BUBBLE_PLUGIN).get_call("get_plugin_meta_data").execute(undefined,{plugin_id:e,version:t})}r.get_plugin=(e,t)=>new c.Plugin(e,p(e,t));r.get_all_plugins=()=>l.object_entries(d()).map((e=>{let[t,n]=e;return new c.Plugin(t,n)})).filter((e=>e.can_install()));r.get_app_plugins=function(){return Object.entries(f.get_plugin_versions()).map((e=>{let[t,n]=e;return r.get_plugin(t,n)}))};r.get_all_plugins_by_tags=(e,t)=>r.get_all_plugins().filter((n=>n.matches(e,t)));r.get_app_plugins_by_tags=(e,t)=>r.get_app_plugins().filter((n=>n.matches(e,t)));r.is_hardcoded=c.is_hardcoded;const _=e("../services/shared/plugin_registry");const f=e("./appquery")},{"../constants/known_plugins":72,"../constants/plugin":78,"../lib":741,"../safe_require":777,"../services/shared/plugin_registry":784,"../u/shared/decaf":844,"./appquery":651,"./plugin":725,"core-js/modules/web.dom-collections.iterator.js":1123}],727:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("../u");const i=e("./btypes");const s=e("./btype_ids");const o=e("../constants/option_sets");const a=e("../constants/fonts");const{DEFAULT_USER_TOKENS:l}=e("../constants/tokens");const c=e("../constants/special_keys");const{COMPOSER_INPUT_TYPES:u,COMPOSER_INPUT_TYPES_WITH_TYPEAHEAD:d,FINITE_OPTION_INPUT_TYPES:p}=e("../constants/composer");const{API_RETURN_TYPES_IDENTIFIERS:_}=e("../constants/apiworkflow");const f=e("../u/shared/decaf");const h=e("../core/core_datasources/utilities/core_ds_composer_utilities");const m=e("../core/core_datasources/utilities/core_ds_element_utilities");const{sorted_user_tokens:g}=e("../lang/tokens");const v=e("../u/shared/b_object");const{get_set:b}=e("./dropdown_contents/index");const{get_composer:y}=e("../editor/composer/compatibility/composers");const w=n;w.get_set=e=>{var t;if((t=window)!=null&&t.composer_revamp){return b(e)}else{return w[e]}};class x{constructor(e,t,n,r,i,s,o){this.display=e;this.value=t;this.thumbnail_id=n;this.score=r;this.disabled=i;this.caption=s;this.delete_cb=o}}w.Option=x;function j(e){return new x(e.display(),e.id())}class A{get_options(){return[]}get_only_option(){const e=this.get_options();if(e.length===1){return e[0]}}editor_type(){return u.ENUMERATED}add_new(){return[]}supports_score(){return false}supports_sections(){return false}get_section_options(){const e=this.get_options();return{Main:e}}_find(e){if(e==null){return null}const t=this.get_options();for(const n of t!=null?t:[]){if(this.equals(n.value,e)){return n}}return null}contains(e){return this._find(e)!=null}get_display(e){const t=this._find(e);if(t){return t.display}else{return""}}get_default(){return this.default}dropdown_width(){return"long"}get_sorted_list(e){return e.sort(((e,t)=>{var n,r;if(((n=e.display)==null?void 0:n.toLowerCase())<((r=t.display)==null?void 0:r.toLowerCase())){return-1}else{return 1}}))}equals(e,t){return e===t}has_finite_options(){return p.has(this.editor_type())}use_typeahead(){if(this.number_only)return false;return d.has(this.editor_type())}}w.Set=A;class M extends A{get_display(e){var t;const n=this._find(e);return(t=n==null?void 0:n.display)!=null?t:""}}w.StrictSet=M;w.Filtered=r.make_new(class e extends A{constructor(e,t){super();this.set=e;this.filter_fn=t;const n=[...Object.getOwnPropertyNames(this.set),...Object.getOwnPropertyNames(Object.getPrototypeOf(this.set))];for(const e of n){const t=this.set[e];if(!["get_options","get_section_options","_find"].includes(e)){this[e]=t}}}_pass_filter(e){return e.value==null||e.value!=null&&this.filter_fn(e)}get_options(){const e=this.set.get_options();const t=e.filter((e=>this._pass_filter(e)));if(!t.length){this.add_new=()=>[{display:"No available option...",fn(){}}]}return t}get_only_option(){const e=this.set.get_only_option();if(e!=null){if(this._pass_filter(e)){return e}}}get_section_options(){const e=this.set.get_section_options();const t={};for(const n in e){const r=e[n];t[n]=r.filter((e=>this._pass_filter(e)))}return t}_find(e){const t=this.set._find(e);if(ee().is_edit_mode()){if(!t||!this.filter_fn(t)){return null}}return t}get_display(e){return this.set.get_display(e)}});w.Dynamic=r.make_new(class e{constructor(e){this.set_fn=e}get_options(){return this.set_fn().get_options()}editor_type(){return this.set_fn().editor_type()}add_new(){return this.set_fn().add_new()}get_display(e){return this.set_fn().get_display(e)}get_default(){return this.set_fn().get_default()}dropdown_width(){return this.set_fn().dropdown_width()}get_section_options(){return this.set_fn().get_section_options()}});class E extends A{constructor(e,t,n){var r,i;super();this.number_only=true;this.suggestions=e;this.default=t;const s=e=>{if(e==null)return"";return String(e)};this.suggestion_formatting_fn=(r=n==null?void 0:n.suggestion_formatting_fn)!=null?r:s;this.display_formatting_fn=(i=n==null?void 0:n.display_formatting_fn)!=null?i:s}get_options(){return this.suggestions.map((e=>new x(this.suggestion_formatting_fn(e),e)))}editor_type(){return u.NUMBER}get_display(e){return this.display_formatting_fn(e)}dropdown_width(){return"short"}}w.Numeric=r.make_new(E);w.Integer=r.make_new(class e extends E{editor_type(){return u.INTEGER}});function k(){return new x("Advanced...",c.ADVANCED_SEARCH_CONSTRAINT,"Documentation.Data.SearchOperator.AdvancedFilter")}function O(){return new x("Change which field...",c.DYNAMIC_SORTING_FIELD,"Documentation.Data.SearchOperator.sort_field.use_dynamic_sort_field")}function S(){return new x("Random sorting",c.RANDOM_SORTING,"Documentation.Data.SearchOperator.sort_field.random_sorting")}function D(){return new x("email","email","Documentation.Data.Messages.User.email")}function C(){return new x("email confirmed","email_confirmed","Documentation.Data.Messages.User.email_confirmed")}function T(){return new x("Stripe Customer ID","StripeCustomerID")}function N(){return new x("unique id",c.UNIQUE_ID,"Documentation.Data.Messages.CustomType._id")}function P(){return new x("Any field",c.ALL_DB_FIELDS,"Documentation.Data.SearchOperator.AnyField")}w.CustomFields=r.make_new(class e extends M{constructor(e){var t;super();this.parameters=e;if(typeof((t=this.parameters.btype_name)==null?void 0:t.id)==="function"){this.parameters.btype_name=this.parameters.btype_name.id()}}_custom_type(){const e=i.get(this.parameters.btype_name);return e.custom_type()}get_options(){let e,t;let n=[];if(this.parameters.add_email_field_for_user_type){n.push(D())}const s=this._custom_type();if(this.parameters.public_searchable){var o;e=(o=s==null?void 0:s.public_searchable_fields(!this.parameters.include_not_built_ins))!=null?o:[]}else if(this.parameters.writeable){var a;e=(a=s==null?void 0:s.writeable_fields())!=null?a:[]}else{var l;e=(l=s==null?void 0:s.readable_fields())!=null?l:[]}e=r.sort_data_fields(e);n.push(...e);if(this.parameters.btype_name){t=i.get(this.parameters.btype_name)}if(this.parameters.btypes_to_filter_out&&t){n=n.filter((e=>{var n;const r=(n=t.get_message(e.value))==null?void 0:n.ret_btype_id();return!this.parameters.btypes_to_filter_out.includes(r)}))}if(this.parameters.white_list_btypes&&t){n=n.filter((e=>{var n;const r=(n=t.get_message(e.value))==null?void 0:n.ret_btype_id();return this.parameters.white_list_btypes.includes(r)}))}if(this.parameters.add_stripe_customer_id){if(s.id()==="user"){n.push(T())}}if(this.parameters.add_email_confirmed_field_for_user_type){if(s.id()==="user"){n.push(C())}}if(s.id()==="user"&&this.parameters.add_pw){n.push(new x("password","password"))}if(this.parameters.include_all_fields){n.push(P())}if(this.parameters.add_unique_id){n.push(N())}if(this.parameters.show_dynamic_sort_option){n.push(O())}if(this.parameters.show_random_sort_option){n.push(S())}return n}add_new(){if(!this.parameters.writeable||this.parameters.not_add_new||!this._custom_type()||this._custom_type().not_writeable){return[]}else{return[{display:"Create a new field...",hide_dropdown:true,fn:(e,t,n)=>ee().visual_edit.show_create_new_field_modal({div:e,preset_val:t,cb:n,custom_type:this._custom_type(),is_message:false})}]}}editor_type(){return u.REAL_TIME_SEARCH}_find(e){var t;const n=this._custom_type();if(e===c.ALL_DB_FIELDS&&this.parameters.include_all_fields){return P()}if(e==="email"&&this.parameters.add_email_field_for_user_type&&n.id()==="user"){return D()}if(e==="email_confirmed"&&this.parameters.add_email_confirmed_field_for_user_type&&n.id()==="user"){return C()}if(e==="StripeCustomerID"&&this.parameters.add_stripe_customer_id&&n.id()==="user"){return T()}if(e==="_id"&&this.parameters.add_unique_id){return N()}if(e===c.DYNAMIC_SORTING_FIELD&&this.parameters.show_dynamic_sort_option){return O()}if(e===c.RANDOM_SORTING&&this.parameters.show_random_sort_option){return S()}if(e==="password"&&this.parameters.add_pw){return new x("password","password")}return(t=this._custom_type())==null?void 0:t.get_field_option(e)}});w.CustomStates=r.make_new(class e extends M{constructor(e){super();this.element_id=e}get_options(){const e=te.element(this.element_id).element_custom_states();const t={};for(const n of e){t[n]=n.display()}function n(e,n){if(t[e]<t[n]){return-1}else{return 1}}const r=e.sort(n).map((e=>new x(e.display(),e.name(),undefined,undefined,undefined,undefined,(()=>ee().visual_edit.show_confirm_delete_state_modal({custom_state:e})))));return r}add_new(){if(te.element(this.element_id).type()==="CustomElement"){return[{display:"Go to the Reusable Element to add a custom state",hide_dropdown:true,fn:(e,t,n)=>{r.run_once(30,(()=>{de.custom_id_to_name(te.element(this.element_id).get_static_property("custom_id"))}),((e,t)=>{window.change_to_custom(t);$(_e.VISUAL_TAB).click()}))}}]}return[{display:"Create a new custom state...",hide_dropdown:true,thumbnail_id:"Documentation.Elements.GeneralConcepts.States.CustomStates",fn:(e,t,n)=>ee().visual_edit.show_create_new_state_modal({div:e,preset_val:t,cb:n,element:te.element(this.element_id),is_message:false})}]}_find(e){var t;if(!e){return null}const n=(t=te.element(this.element_id))==null?void 0:t.element_custom_state(e);if(!(n!=null&&n.exists())){return null}return new x(n.display(),n.name())}editor_type(){return u.REAL_TIME_SEARCH}});w.Fonts=r.make_new(class e extends A{get preview_fonts(){return true}get ignore_type_check(){return true}get_options(){const e=f.object_keys(te.get_public_setting("fonts")).map((e=>new x(e,e+a.CUSTOM_FONT_FLAG)));const t=Z.get_font_list().map((e=>new x(Z.pretty_font(e),e)));return e.concat(t)}get_display(e){return Z.pretty_font(e)}_find(e){const t=this.get_options();for(const n of t!=null?t:[]){if((n==null?void 0:n.value)===Z.get_canonical(e)){return n}}return null}get_only_option(){}editor_type(){return u.REAL_TIME_SEARCH}});w.FontFamilies=r.make_new(class e extends A{constructor(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;super();this.include_tokens=e}get preview_fonts(){return true}get ignore_type_check(){return true}supports_sections(){return true}get_options(){const e=f.object_keys(te.get_public_setting("fonts")).map((e=>new x(e,e+a.CUSTOM_FONT_FLAG)));const t=Z.get_font_families().map((e=>new x(Z.pretty_font(e),e)));return e.concat(t)}get_section_options(){const e={};if(this.include_tokens){var t,n;e.Tokens=[];const r=(t=te.get_public_setting("font_tokens"))!=null?t:a.DEFAULT_TOKENS;Object.keys(r).map((t=>e.Tokens.push(new x(a.TOKEN_NAMES[t]+" ("+r[t].replace(a.CUSTOM_FONT_FLAG,"")+")","var(--font_"+t+")"))));const i=(n=te.get_public_setting("font_tokens_user"))!=null?n:v.json_deep_copy(l);e.userTokens=[];for(const t in i){for(const n of g(i[t])){const r=i[t][n];if(!r.font_family){continue}e.userTokens.push(new x(r.name+" ("+r.font_family.replace(a.CUSTOM_FONT_FLAG,"")+")","var(--font_"+n+"_"+t+")"))}}}e.Families=this.get_options();return e}get_display(e){return Z.pretty_font(e)}get_only_option(){}editor_type(){return"real_time_search"}});w.FontWeights=r.make_new(class e extends A{constructor(e){super();this.font_family=e}get ignore_type_check(){return true}get_options(){return a.ALL_WEIGHTS.map((e=>{var t;return new x((t=a.SPECIAL_DISPLAY[e])!=null?t:e,e)}))}get_display(e){return e}dropdown_width(){return"short"}get_only_option(){}editor_type(){return"real_time_search"}});const I={contains:"contains","not contains":"doesn't contain",equals:"=","not equal":"<>","greater than":">",gte:"","less than":"<",lte:"","text contains string":"contains","not text contains string":"doesn't contain","text contains":"contains keyword(s)","not text contains":"doesn't contain keyword(s)",empty:"is empty","not empty":"isn't empty",in:"is in","not in":"isn't in",is_empty:"is empty",is_not_empty:"isn't empty",contains_all_fields:"contains",advanced_search_constraint:"Advanced: ",email_equals:"=",email_contains_string:"contains",geographic_search:"is within",range_contains:" contains range ",range_contains_point:" contains (point) ",range_contained_by:" is contained by ",range_overlaps:" overlaps with ",range_greater_than:"is greater ",range_greater_than_point:" is greater (point) ",range_less_than:" is smaller ",range_less_than_point:" is smaller (point) "};w.search_operators_display=I;const R={"text contains string":"text","not text contains string":"text","text contains":"text","not text contains":"text",contains:"list","not contains":"list",empty:"list","not empty":"list",contains_all_fields:"any data field",email_equals:"email",email_contains_string:"email",geographic_search:"geographic search",range_contains:"range",range_contains_point:"range",range_contained_by:"range",range_overlaps:"range",range_greater_than:"range",range_greater_than_point:"range",range_less_than:"range",range_less_than_point:"range"};w.SearchOperators=r.make_new(class e extends M{constructor(e,t){super();this.value=e;this.allow_missing_value=t}get_display(e,t){if(!e){return e}const n=I[e];if(n==null){throw new r.UnexpectedError("unrecognized: "+e)}const i=R[e];if(i!=null&&t){return`${n} (${i})`}else{return n}}get_options_raw(){if(this.value===c.ALL_DB_FIELDS){return["contains_all_fields"]}else if(this.value===c.ADVANCED_SEARCH_CONSTRAINT){return["advanced_search_constraint"]}else if(this.value===c.UNIQUE_ID){return["equals","not equal","in","not in"]}else if(!this.value&&this.allow_missing_value){return f.object_keys(I)}else if(this.value==="StripeCustomerID"){return["equals","not equal"]}else if(this.value==="email"){return["email_equals","email_contains_string"]}else if(this.value.is_list()){return["contains","not contains","empty","not empty"]}else if(this.value.id()==="geographic_address"){return["geographic_search","is_empty","is_not_empty"]}else if(["number_range","date_range"].includes(this.value.id())){return["range_contains","range_contains_point","range_contained_by","range_overlaps","range_greater_than","range_greater_than_point","range_less_than","range_less_than_point","is_empty","is_not_empty"]}else if(this.value.matches("user")||this.value.matches("custom*")||["boolean","sys.bool"].includes(this.value.id())){return["equals","not equal","in","not in","is_empty","is_not_empty"]}else if(this.value.matches("text")){return["equals","not equal","in","not in","text contains string","not text contains string","text contains","not text contains","greater than","less than","is_empty","is_not_empty"]}else if(this.value.storable()){return["equals","not equal","greater than","gte","less than","lte","in","not in","is_empty","is_not_empty"]}else{return[]}}get_options(){const e=[];const t=this.value==null;for(const n of this.get_options_raw()){let r;if(n==="contains_all_fields"){r="Documentation.Data.SearchOperator.AnyField"}else if(n==="advanced_search_constraint"){r="Documentation.Data.SearchOperator.AdvancedFilter"}const i=this.get_display(n,t);e.push(new x(i,n,r))}return e}editor_type(){return u.REAL_TIME_SEARCH}});class L extends A{constructor(e,t){var n;(n=t)!=null?n:t=u.REAL_TIME_SEARCH;super();this.obj=e;this._editor_type=t}get_options(){return f.object_entries(this.obj).map((e=>{let[t,n]=e;return new x(n,t)}))}_find(e){var t;if(((t=this.obj)==null?void 0:t[e])==null){return null}return new x(this.obj[e],e)}editor_type(){return this._editor_type}}w.Object=r.make_new(L);w.List=r.make_new(class e extends A{constructor(e,t,n){var r;(r=t)!=null?r:t=u.REAL_TIME_SEARCH;super();this.list=e;this._editor_type=t;this.non_capitalized=n}get_options(){return f.array_from(this.list).map((e=>new x(this.get_display(e),e)))}get_display(e){if(f.array_from(this.list).includes(e)){if(this.non_capitalized){return e}else{return r.FirstLetterCapitalize(e)}}if(this.editor_type()==="text"){return e}}editor_type(){return this._editor_type}});w.FromOptionsList=r.make_new(class e extends A{constructor(e,t){super();this.options=e;this._editor_type=t!=null?t:u.ENUMERATED}get_options(){return this.options}get_display(e){var t;return(t=this.options.find((t=>t.value===e)))==null?void 0:t.display}editor_type(){return this._editor_type}});w.ChangeActions=r.make_new(class e extends L{constructor(){const e={add:"add",remove:"remove",set_list:"set list",add_list:"add list",remove_list:"remove list",clear_list:"clear list"};super(e)}get_options(){const e=[];for(const t in this.obj){const n=this.obj[t];e.push(new x(n,t,"Documentation.Actions.ChangeThing.changes."+t))}return e}});w.EditorOnly=r.make_new(class e extends A{constructor(e,t){super();this.composer_input_type=e;this.default=t}get_options(){return null}editor_type(){return this.composer_input_type}});w.DataSources=r.make_new(class e extends M{constructor(e,t,n,s){super();this.node=e;this.expected=t;this.literal_value=n;this.default=s;if(typeof this.literal_value==="string"){this.literal_value=i.get(this.literal_value)}if(this.node==null){throw new r.UnexpectedError("must pass a node")}if(this.expected==null){throw new r.UnexpectedError("must pass an expected")}}get_options(){var e,t;const n=h.get_composer_context(this.node);const r=h.get_datasources_for_context(this.expected,n);let i=r.map((e=>h.datasource_to_option(e,n,Object.keys(J))));if(((e=this.literal_value)==null?void 0:(t=e.get_composer_input_type)==null?void 0:t.call(e))===u.BOOLEAN){i=[new x('"yes"',true,null,100),new x('"no"',false,null,100)].concat(i)}return i}get_only_option(){}editor_type(){var e,t,n;return(e=(t=this.literal_value)==null?void 0:(n=t.get_composer_input_type)==null?void 0:n.call(t))!=null?e:u.REAL_TIME_SEARCH}supports_sections(){return true}supports_score(){return true}get_section_options(){const e=this.get_options();const t=h.get_composer_context(this.node);return h.assign_to_sections(e,t)}});w.AllDataSources=r.make_new(class e extends M{get_options(){const e={list_only:true,node:{owner:{},json:ue.VirtualEditorJSON()}};const t=h.get_datasources_for_context(i.any,e);return t.map((t=>h.datasource_to_option(t,e,Object.keys(J))))}equals(e,t){var n,r;if((e==null?void 0:e.type)!==(t==null?void 0:t.type)){return false}if(((n=e.properties)==null?void 0:n.name)!=null||((r=t.properties)==null?void 0:r.name)!=null){return e.properties.name===t.properties.name}return true}editor_type(){return u.REAL_TIME_SEARCH}});w.Pages=r.make_new(class e extends M{constructor(e){var t,n;super();this.skip_builtin=(t=e==null?void 0:e.skip_builtin)!=null?t:false;this.add_pages=(n=e==null?void 0:e.add_pages)!=null?n:[]}get_options(){const e=de.get_sorted_list_of_pages({skip_builtin:this.skip_builtin}).map((e=>new x(e,de.page_name_to_id(e))));if(this.add_pages.length){return e.concat(this.add_pages.map((e=>{let{display:t,value:n}=e;return new x(t,n)})))}else{return e}}add_new(){return[{display:"Create a new page...",hide_dropdown:true,fn(e,t,n){window.make_new_page({current_page_to_clone_id:undefined,existing_raw:undefined,cb(e){if(e){const t=de.page_name_to_id(e);n(null,t)}else{n("did not happen")}}})}}]}_find(e){var t;if(!e){return null}let n=te.page(e);if(!((t=n)!=null&&t.exists())){var r;n=te.page(de.page_name_to_id(e));if(!((r=n)!=null&&r.exists())){const t=this.add_pages.filter((t=>{let{display:n,value:r}=t;return r===e}));if(t.length){return new x(t[0].display,t[0].value)}return null}}return new x(n.name(),n.id())}editor_type(){return u.REAL_TIME_SEARCH}get_only_option(){}});w.CustomDefinitions=r.make_new(class e extends M{get_options(){const e=[];for(const t of de.get_sorted_list_of_custom_definitions()){const n=de.custom_name_to_id(t);e.push(new x(t,n,n))}return e}_find(e){if(!e){return null}const t=te.custom_definition(e);if(!t.exists()){return null}return new x(t.name(),t.id(),t.id())}editor_type(){return u.REAL_TIME_SEARCH}});function z(e){var t;return new x((t=e.get_static_property("event_name"))!=null?t:"(not yet named)",e.id())}w.CustomEvents=r.make_new(class e extends M{constructor(e){super();this.node=e}get_options(){let e;if(!this.node){e=te.find_events("CustomEvent").map((e=>z(e)))}else{var t,n;const r=(t=(n=this.node.root())==null?void 0:n.events("CustomEvent"))!=null?t:ue.enhance_array([]);e=r.filter((e=>e.id()!==this.node.event().id())).map((e=>z(e)))}return this.get_sorted_list(e)}_find(e){var t,n;if(!e){return null}const r=te.event(e);if(!(r!=null&&r.exists())||r.type()!=="CustomEvent"){return null}if(this.node&&((t=r.root())==null?void 0:t.id())!==((n=this.node.root())==null?void 0:n.id())){return null}return z(r)}editor_type(){return u.REAL_TIME_SEARCH}});w.CustomEventsFromReusable=r.make_new(class e extends M{constructor(e,t){super();this.node=e;this.custom_id=t}get_options(){var e,t,n;const r=(e=(t=te.custom_definition(this.custom_id))==null?void 0:(n=t.events)==null?void 0:n.call(t,"CustomEvent"))!=null?e:ue.enhance_array([]);const i=r.filter((e=>{var t;return e.id()!==((t=this.node)==null?void 0:t.event().id())})).map((e=>z(e)));return this.get_sorted_list(i)}editor_type(){return u.REAL_TIME_SEARCH}});class B extends M{add_new(){if(this.add_new_able){return[{display:"Create a new type...",fn(e,t,n){e.empty();e.off();const i=r.div([],e);i.append("New type:");const s=r.input(undefined,i);s.focus();s.on("change",(()=>{var e;const t=$.trim((e=s.val())!=null?e:"");if(t){const e=ee().type_editor.add_new_user_type(t);n(null,e)}}));i.hide();r.velocity(i,"fadeIn",{duration:100})}}]}}get_display(e){var t,n,r;if(e!=null&&typeof e!=="string"){return e.toString()}if((e==null?void 0:e.indexOf(i.missing_id))!==-1){return e}const s=i.get(e);const o=(t=i.get(e))==null?void 0:t.display();if(o!=null&&(n=s.custom_type)!=null&&(r=n.call(s))!=null&&r.deleted()){return o+" (deleted)"}return o!=null?o:e}}function q(){return i.list("custom").map((e=>j(e)))}function U(){return i.list("option").map((e=>j(e)))}class F extends B{constructor(e,t,n){super();this.simple_only=e;this.no_api=t;this.exclude=n}get_options(){const e=i.list().filter((e=>e.storable()&&(!this.simple_only||e.id()!=="user"))).map((e=>j(e)));e.push(...this.get_sorted_list(U())||[]);if(!this.simple_only){e.push(...this.get_sorted_list(q())||[]);if(!this.no_api){const t=i.list("api").filter((e=>{var t;return(t=e.storable)==null?void 0:t.call(e)})).map((e=>j(e)));e.push(...this.get_sorted_list(t)||[])}}if(this.exclude!=null){return e.filter((e=>!this.exclude.includes(e.value)))}return e}get_display(e){if(["Ignore field"].includes(e)){return e}return super.get_display(e)}editor_type(){return u.REAL_TIME_SEARCH}}w.AllowableValues=r.make_new(F);w.ExcludeOptionValues=r.make_new(class e extends F{get_options(){const e=super.get_options();return e.filter((e=>!s.is_option_set(e.value)))}});class W extends B{constructor(e){var t;(t=e)!=null?t:e={};super();this.add_new_able=e.add_new_able;this.filter=e.filter}get_options(){return i.search(this.filter).map((e=>j(e)))}_find(e){const t=this.get_options();for(const n of t!=null?t:[]){if(n.value.indexOf(i.missing_id)!==0&&i.get(n.value).matches(e)){return n}}return null}}w.Values=r.make_new(W);w.DisplayableInListValues=r.make_new(class e extends W{constructor(e,t,n,r){super();this.include_simple=e;this.no_api=t;this.force_add=n;this.put_simple_first=r}get_options(){var e;const t=[];const n=()=>t.push(...i.list().filter((e=>e.storable()&&e.id()!=="user")).map((e=>j(e)))||[]);if(this.put_simple_first&&this.include_simple){n()}t.push(...[j(i.get("user"))].concat(this.get_sorted_list(q()))||[]);t.push(...this.get_sorted_list(U())||[]);if(!this.no_api){t.push(...ae.get_value_ids().map((e=>j(i.get(e))))||[])}if(this.include_simple&&!this.put_simple_first){n()}if((e=this.force_add)!=null&&e.length){for(const e of this.force_add){t.push(j(i.get(e)))}}return t}contains(e){var t;if(typeof e!=="string"){return false}const n=e.split(".");if((t=this.force_add)!=null&&t.length&&this.force_add.includes(e)){return true}if(["user","custom"].includes(n[0])){var r,s;const t=(r=i.get(e))==null?void 0:(s=r.custom_type)==null?void 0:s.call(r);return t&&t.exists()&&!t.deleted()}if(n[0]==="option"){var o,a;const t=(o=i.get(e))==null?void 0:(a=o.option_set)==null?void 0:a.call(o);return t&&t.exists()&&!t.deleted()}if(n[0]==="api"){return!this.no_api&&ae.get_value_ids().includes(e)}if(n[0]==="struct"){return true}if(this.include_simple){var l;return(l=i.get(e))==null?void 0:l.storable()}return false}editor_type(){return u.REAL_TIME_SEARCH}get_only_option(){if(this.include_simple){return null}if(i.list("custom").length){return null}return super.get_only_option()}});w.ObjectValues=r.make_new(class e extends W{constructor(){super({filter:i.compound})}editor_type(){return u.REAL_TIME_SEARCH}});w.CustomTypes=r.make_new(class e extends W{constructor(e,t){super({add_new_able:t});this.include_user=e}get_options(){const e=q();return(this.include_user?[j(i.get("user"))]:[]).concat(this.get_sorted_list(e))}editor_type(){return u.REAL_TIME_SEARCH}_find(e){if(!e){return null}if(e==="user"){return j(i.get("user"))}if(e!=null&&e.indexOf("custom")===0&&i.get(e).id().indexOf(i.missing_id)!==0){return j(i.get(e))}return null}});w.OptionSets=r.make_new(class e extends W{constructor(e){super({add_new_able:e})}get_options(){return this.get_sorted_list(U())}editor_type(){return u.REAL_TIME_SEARCH}_find(e){if(!e){return null}if(e!=null&&s.is_option_set(e)&&i.get(e).id().indexOf(i.missing_id)!==0){return j(i.get(e))}return null}});w.OptionValues=r.make_new(class e extends A{constructor(e,t,n){var r,s;(r=t)!=null?r:t=false;(s=n)!=null?s:n=false;super();this.option_set=e;this.allow_all=t;this.allow_null=n;if(typeof this.option_set==="string"){this.option_set=i.get(this.option_set).option_set()}}_get_null_opt(){return new x("(none)",null)}_get_all_opt(){return new x("All options",o.ALL_OPTIONS)}_get_value_opts(){return this.option_set.values().filter((e=>!e.deleted())).map((e=>new x(e.display(),e.name())))}get_options(){const e=this._get_value_opts();if(this.allow_all){e.push(this._get_all_opt())}if(this.allow_null){e.push(this._get_null_opt())}return e}editor_type(){return u.REAL_TIME_SEARCH}supports_sections(){return this.allow_all||this.allow_null}get_section_options(){return{null_values:this.allow_null?[this._get_null_opt()]:undefined,all_values:this.allow_all?[this._get_all_opt()]:undefined,values:this._get_value_opts()}}get_section_order(e){const t=[];if(this.allow_null){t.push("null_values")}if(this.allow_all){t.push("all_values")}t.push("values");return t}});w.APIReturnTypes=r.make_new(class e extends A{get_options(){return Object.values(_).map((e=>new x(e.caption,e.value)))}supports_sections(){return true}get_section_options(){const e={built_in:[new x(_.plain_text.caption,_.plain_text.value),new x(_.json.caption,_.json.value)],user_defined:[new x(_.custom.caption,_.custom.value)]};return e}});w.APIList=r.make_new(class e extends A{get_options(){const e=ae.get_api_calls();const t="interactions.get_mouse_data";delete e[t];return f.object_entries(e).map((e=>{let[t,n]=e;return new x(n.display(),t)}))}contains(e){return ae.get_api_calls_ids().has(e)}add_new(){return[{display:"Add more APIs...",hide_dropdown:true,fn:(e,t,n)=>{ce.show({types:["api"]})}}]}editor_type(){return u.REAL_TIME_SEARCH}});w.OauthProviders=r.make_new(class e extends A{get_options(){const e=[];for(const n of le.get_app_plugins()){for(const r of(t=n==null?void 0:n.get_oauth_providers())!=null?t:[]){var t;let i;if(r.id&&r.display){i=new x(r.display,r.id)}else if(typeof r==="string"){i=new x(n.display(),r)}e.push(i)}}return this.get_sorted_list(e)}add_new(){return[{display:"Add more login services...",hide_dropdown:true,fn:(e,t,n)=>{ce.show({types:["login service"]})}}]}editor_type(){return u.REAL_TIME_SEARCH}get_display(e){var t;const n=(t=ae.get_oauth_authenticator(e))==null?void 0:t.service();if(!n){return e}for(const t of n.get_oauth_providers()){if(typeof t==="string"&&t===e){return n.display()}else{if(t.id===e){return t.display}}}}});w.FileStorageProviders=r.make_new(class e extends A{get_options(){return[new x("Bubble Storage","bubble")].concat(le.get_app_plugins().filter((e=>e==null?void 0:e.is_storage_provider())).map((e=>new x(e.display(),e.name))))}add_new(){return[{display:"Add more storage services...",hide_dropdown:true,fn:(e,t)=>{ce.show({types:["storage"]})}}]}editor_type(){return u.REAL_TIME_SEARCH}});w.AppLanguages=r.make_new(class e extends A{get_options(){var e;const t=[];const n=pe.get_languages_data();const r=(e=te.get_public_setting("text"))!=null?e:{};for(const e in n){const i=n[e];if(i.deprecated&&!r[e]){continue}const s=i.caption+" ("+e+")";t.push(new x(s,e))}return this.get_sorted_list(t)}add_new(){return[{display:"Request another language...",hide_dropdown:true,fn:(e,t,n)=>{const r=t!=null?t:"...";const i="mailto:support@bubble.io?subject=Adding a language to Bubble&body=Hi, I would like to use "+r+" in Bubble!";window.open(i)}}]}editor_type(){return u.REAL_TIME_SEARCH}get_only_option(){}});w.AppTexts=r.make_new(class e extends A{get_options(){const e=te.get_public_setting("user_text_ids");const t=f.object_keys(e).map((e=>new x(this.get_display(e),e,undefined,undefined,undefined,undefined,(()=>pe.delete_user_text(e)))));return this.get_sorted_list(t)}add_new(){return[{display:"Define another text...",hide_dropdown:true,fn(e,t,n){ee().visual_edit.app_texts_input_panel(n)}}]}editor_type(){return u.REAL_TIME_SEARCH}contains(e){return te.get_public_setting("user_text_ids."+e)!=null}get_display(e){if(!e){return}const t=te.get_public_setting("user_text_ids."+e);if(t===true){return e}else{return t}}});w.WFFolders=r.make_new(class e extends A{constructor(e){super();this.page=e}get_options(){if(!this.page){return[]}const e=this.page.get_static_property("wf_folder_list");const t=[];for(const n in e){const i=e[n];if(i===true){t.push(new x(r.toTitleCase(n),n))}else{t.push(new x(i,n))}}return this.get_sorted_list(t)}get_display(e){if(!e){return}const t=this.page.get_static_property("wf_folder_list");if((t==null?void 0:t[e])===true){return r.toTitleCase(e)}else{return t==null?void 0:t[e]}}add_new(){return ee().visual_edit.wf_folders_add_new()}editor_type(){return u.REAL_TIME_SEARCH}});w.PageFolders=r.make_new(class e extends A{constructor(e){var t;(t=e)!=null?t:e={};const{exclude_add_new:n}=e;super();this.exclude_add_new=n}get_options(){let e=[];const t=te.get_public_setting("page_folders");if(r.not_empty(t)){e=f.object_entries(t).map((e=>{let[t,n]=e;const r=()=>te.set_setting(true,"page_folders."+t,null);return new x(n,t,undefined,undefined,undefined,undefined,r)}))}return this.get_sorted_list(e)}get_display(e){var t,n;if(!e){return}return(t=(n=te.get_public_setting("page_folders"))==null?void 0:n[e])!=null?t:"Page folder"}add_new(){if(!this.exclude_add_new){return ee().visual_edit.page_folders_add_new()}}editor_type(){return u.REAL_TIME_SEARCH}});w.NullSet=r.make_new(class e extends A{get_options(){return null}editor_type(){return null}add_new(){return[]}});function G(e){let t=[];if(e==="Element"){t=f.object_keys(ne.elements_list).filter((e=>!["Page","GroupItem"].includes(e)))}else if(Array.isArray(e)){t=e}else{t=[e]}return t}function V(e,t,n,r){var i;if(e!=null&&(i=e.is_action)!=null&&i.call(e)||n){const i=n?e:e.context_element();let s=h.get_visible_elements(i,t);if(r){h.sort_elements_by_type(s)}if(t!=null){s=ue.filter_array(t,s)}if(i!=null&&i.is(t)&&!s.map((e=>e.id())).includes(i.id())){s.push(i)}return s}else{var s,o;if(t==="Element"){t=undefined}return(s=(o=e.root())==null?void 0:o.find_elements(t))!=null?s:ue.enhance_array([])}}function H(e){const t=new x(e.get_name(),e.id(),e.id());return t}function X(e){return e.map((e=>H(e)))}w.PageElements=r.make_new(class e extends A{constructor(e,t,n,r){var i;(i=t)!=null?i:t="Element";super();this.node=e;this.type=t;this.include_self=n;this.force_is_visible=r}_get_elements(e){let t=[];const n=G(this.type);for(const r of n){const n=V(this.node,r,this.force_is_visible,e);if(n.length){t=t.concat(n.to_array())}}if(this.include_self){t=[this.node.root()].concat(t)}return t}get_options(){return this.get_sorted_list(X(this._get_elements()))}_find(e){if(!e){return null}const t=te.element(e);if(!t.exists()||!m.is_element_visible(t,this.node.context_element())){return null}return H(t)}get_display(e){var t,n;return(t=(n=te.element(e))==null?void 0:n.get_name())!=null?t:e}editor_type(){return u.REAL_TIME_SEARCH}get_only_option(){var e,t;if(!((e=this.node)!=null&&(t=e.is_action)!=null&&t.call(e)||this.force_is_visible)){var n,r;let e;if(this.type==="Element"){e=undefined}else{({type:e}=this)}const t=(n=(r=this.node.root())==null?void 0:r.find_elements(e))!=null?n:ue.enhance_array([]);if(t.length===1){return H(t[0])}}else{const e=this._get_elements(true);if(e.length===1){const t=this.node.id()===e[0].id();if(this.include_self||!t){return H(e[0])}}}}});w.PageElementsByType=r.make_new(class e extends A{constructor(e,t,n,r,i){var s,o;(s=t)!=null?s:t="Element";(o=n)!=null?o:n=false;super();this.node=e;this.type=t;this.include_self=n;this.order_list=r;this.dont_check_visible=i}get_options(e){let t=[];const n=this.get_section_options(e);for(const e in n){const r=n[e];t=t.concat(r)}return t}get_section_options(e){var t;(t=e)!=null?t:e={};const{include_glyph_id:n}=e;const r={};const i=G(this.type);for(const e of i){r[e]=[]}const s=V(this.node);for(const e of s){var o,a;const t=e.type();if(r[t]){r[t].push(e)}else if(r.Popup&&t==="CustomElement"&&(o=(a=e.E).is_popup)!=null&&o.call(a)){r.Popup.push(e)}}if(this.include_self&&this.node!=null){r.Self=[this.node.root()]}for(const e in r){const t=r[e];const i=[];for(const e of t){const t=H(e);if(n){t.glyph_id=ne.get_glyph_id_for_element_type(e.type())}i.push(t)}r[e]=this.get_sorted_list(i)}return r}get_section_order(e){var t;const n=[];(t=this.order_list)!=null?t:this.order_list=["Self","CustomDefinition","CustomElement","Popup","Group","GroupWithFocus","FloatingGroup","RepeatingGroup","HTML","Shape","Image","Text","Icon","Button","Link"];for(const t of this.order_list){if(e[t]){n.push(t)}}for(const t in e){if(!this.order_list.includes(t)){n.push(t)}}return n}get_display(e){var t,n;if(!e){return""}return(t=(n=te.element(e))==null?void 0:n.get_name())!=null?t:"this element"}_find(e){if(!e){return null}const t=te.element(e);if(!this.dont_check_visible){var n;if(!t.exists()||((n=this.node)==null?void 0:n.context_element())!=null&&!m.is_element_visible(t,this.node.context_element())){return null}}return H(t)}editor_type(){return u.REAL_TIME_SEARCH}get_only_option(){const e=G(this.type);const t=[];for(const i of V(this.node,undefined,undefined,true)){var n,r;if(e.includes(i.type())||e.includes("Popup")&&i.type()==="CustomElement"&&(n=(r=i.E).is_popup)!=null&&n.call(r)){t.push(i)}}if(t.length===1&&!this.include_self){return H(t[0])}}});const Y={};w.PageInstances=r.make_new(class e extends A{constructor(e){super();this.node=e}get_options(){let e=[];const t=n=>{for(const i of(r=n.children)!=null?r:[]){var r;const n=this.get_display(i);if(n){e.push(new x(n,i))}t(i)}};t(this.node);this.get_sorted_list(e);e=[new x(this.get_display(this.node),this.node)].concat(e);return e}editor_type(){return u.REAL_TIME_SEARCH}get_display(e){if(!e){return}if(!Y[e.element_id()]){var t,n;(n=Y[t=e.element_id()])!=null?n:Y[t]=e.element.get_name()}let r=Y[e.element_id()];if(!r){return}if(!e.is_visible()){r+=" (invisible)"}return r}});w.ParentElements=r.make_new(class e extends A{constructor(e){super();this.node=e}supports_sections(){return true}get_section_options(){var e;const t={Parents:[],Children:[]};let n=(e=this.node)==null?void 0:e.parent();while(n){t.Parents.push(H(n));n=n.parent()}const r=[];for(const e of(i=(s=this.node)==null?void 0:s.elements())!=null?i:[]){var i,s;r.push(e)}r.sort(((e,t)=>{if(e.get_top()<=t.get_top()){return-1}else{return 1}}));for(const e of r){t.Children.push(H(e))}return t}});const K=["GroupWithFocus","Table","TableMainAxis","TableCrossAxis","TableCell"];w.ElementTypes=r.make_new(class e extends A{constructor(e,t,n){super();this.current_type=e;this.not_add_new=t;this.include_all=n}get_options(e){var t;const n=[];const r=this.current_type?(t=ne.get_element_object(this.current_type))==null?void 0:t.category:undefined;const i=oe.get_app_plugins_by_tags("element",r).map((e=>e.id));for(const t of ne.get_full_list_elements()){if(this.include_all||!K.includes(t)){const s=ne.get_element_object(t);if(s&&(!r||s.category===r)){if(!s.is_plugin||s.is_plugin&&i.includes(s.service)){const t=new x(ne.get_element_display(s.plugin_name),s.plugin_name);if(e){t.category=s.category;t.glyph_id=s.glyph_id;t.list_order=s.list_order;t.keyboard_shortcut=s.keyboard_shortcut}if(s.is_plugin){t.glyph_id=s.icon}n.push(t)}}}}if(e){let e=[];let t=[];let r=[];const i=[];for(const s of n){if(s.category==="visual elements"){e.push(s)}else if(s.category==="input forms"){t.push(s)}else if(s.category==="containers"){r.push(s)}else{i.push(s)}}e=e.sort(((e,t)=>e.list_order-t.list_order));t=t.sort(((e,t)=>e.list_order-t.list_order));r=r.sort(((e,t)=>e.list_order-t.list_order));let s=e.concat(t);s=s.concat(r);s=s.concat(i);return s}else{return n}}add_new(){var e;if(this.not_add_new){return[]}const t=this.current_type?(e=ne.get_element_object(this.current_type))==null?void 0:e.category:undefined;const n=oe.get_app_plugins_by_tags("element",t);if(oe.get_all_plugins_by_tags("element",t).length>n.length){return[{display:"Install more elements...",hide_dropdown:true,fn(e,n,r){ce.show({types:["element"],categories:t?[t]:undefined})}}]}}editor_type(){return u.REAL_TIME_SEARCH}});w.EventTypes=r.make_new(class e extends A{constructor(e,t){super();this.not_add_new=e;this.no_custom=t}get_options(){const e=[];const t=oe.get_app_plugins_by_tags("event").map((e=>e.id));const n=se.get_full_list_events();for(const r in n){const i=n[r];for(const{type:n}of i){if(n&&!this.no_custom||this.no_custom&&n!=="CustomEvent"){const r=se.get_event_object(n);if(r&&(!r.is_plugin||r.is_plugin&&t.includes(r.service))){e.push(new x(r.display(undefined,true),n))}}}}return e}add_new(){if(this.not_add_new){return[]}const e=oe.get_app_plugins_by_tags("event");if(oe.get_all_plugins_by_tags("event").length>e.length){return[{display:"Install more events...",hide_dropdown:true,fn(e,t,n){ce.show({types:["event"]})}}]}}editor_type(){return u.REAL_TIME_SEARCH}});w.ActionTypes=r.make_new(class e extends A{constructor(e){super();this.not_add_new=e}get_options(){const e={};const t=[];const n=oe.get_app_plugins_by_tags("action").map((e=>e.id));const r=re.get_full_list_actions();for(const i in r){const s=r[i];for(const{type:r}of s){if(r&&!e[r]){e[r]=true;const i=re.get_action_object(r);if(i&&(!i.is_plugin||i.is_plugin&&n.includes(i.service))){t.push(new x(i.display(),r))}}}}return t}add_new(){if(this.not_add_new){return[]}const e=oe.get_app_plugins_by_tags("action");if(oe.get_all_plugins_by_tags("action").length>e.length){return[{display:"Install more actions...",hide_dropdown:true,fn(e,t,n){ce.show({types:["action"]})}}]}}editor_type(){return u.REAL_TIME_SEARCH}});w.PageEventsByType=r.make_new(class e extends A{constructor(e,t,n){super();this.node=e;this.type=t;this.include_actions=n}get_options(){var e;let t=this.node.root().events();if(ee().action_canvas!=null){t=ee().action_canvas.sort_workflows(t)}const n=(e=this.node)!=null&&e.is_api()?true:undefined;if(this.type){t=t.filter((e=>e.type()===this.type))}if(this.include_actions){const e=[];for(const r of t){e.push(new x(r.display(n),r.id()));for(const t of r.actions()){e.push(new x("      "+t.display(n),t.id()))}}return e}else{return t.map((e=>new x(e.display(n),e.id())))}}editor_type(){return u.REAL_TIME_SEARCH}_find(e){var t,n,r;if(!e){return null}if(!ee().is_edit_mode()){const t=ie.get_run_mode_api_event_name(e);return new x(t,e)}const i=te.event(e);if(!(i!=null&&i.exists())){return null}if(((t=i.root)==null?void 0:(n=t.call(i))==null?void 0:n.id())!==this.node.root().id()){return null}const s=(r=this.node)!=null&&r.is_api()?true:undefined;if(this.type&&i.type()!==this.type){return null}return new x(i.display(s),i.id())}get_only_option(){const e=this.node.root().events();if(e.length===1){return this._find(e[0].id())}}});w.Styles=r.make_new(class e extends A{constructor(e,t,n,r){super();this.element_type=e;this.current_element_id=t;this.not_add_new=n;this.has_overridden_styles=r}get_display(e){var t;const n=this._find(e);if((t=this.has_overridden_styles)!=null&&t.call(this)){return`${n.display} (Overridden)`}else if(n){return n.display}else{return"None (Custom)"}}get_display_style(){var e;if((e=this.has_overridden_styles)!=null&&e.call(this)){return{"font-style":"italic"}}return{"font-style":""}}get_options(){const e=te.styles().filter((e=>e.type()!=null&&!this.element_type||e.type()===this.element_type));const t={};const n={};for(const r of e){t[r]=ne.get_element_display(r.type());n[r]=r.display().toLowerCase()}function i(e,r){if(t[e]<t[r]){return-1}else if(t[e]>t[r]){return 1}if(n[e]<n[r]){return-1}else{return 1}}e.sort(i);return e.map((e=>new x(r.toTitleCase(e.display()),e.name(),e.name())))}add_new(){if(this.not_add_new){return[]}return[{display:"+ Create a new style...",hide_dropdown:true,fn:(e,t,n)=>ee().visual_edit.show_create_new_style_modal({div:e,preset_val:t,cb:n,element_type:this.element_type,element_id:this.current_element_id})}]}_find(e){const t=te.style(e);if(!t.exists()){return null}return new x(r.toTitleCase(t.display()),t.name(),t.name())}editor_type(){return u.REAL_TIME_SEARCH}});w.MessagesForType=r.make_new(class e extends M{constructor(e){super();this.value_id=e}get_options(){const e=i.get(this.value_id);const t=[];const n=e.get_messages();for(const e of n){const n={display:e.description(),value:e.name()};t.push(n)}return t}});w.Messages=r.make_new(class e extends M{constructor(e,t,n){super();this.node=e;this.value=t;this.expected=n}editor_type(){return u.REAL_TIME_SEARCH}get_options(){const e=h.get_composer_context(this.node);const t=h.get_messages_for_context(this.value,e);return t.filter((e=>!e.no_composer(this.node))).map((t=>h.message_to_option(t,e)))}add_new(){if(this.node.get_value().id().indexOf(i.missing_id)===0){return[]}if(i.saveable(this.node.get_value())){return[{display:"Create a new field...",hide_dropdown:true,fn:(e,t,n)=>ee().visual_edit.show_create_new_field_modal({div:e,preset_val:t,cb:n,custom_type:this.node.get_value().custom_type(),is_message:true})}]}if(this.node.type()==="ElementParent"){return[{display:"Change the parent's thing type...",thumbnail_id:"Documentation.Elements.GeneralConcepts.ChangeParentType",hide_dropdown:true,fn:(e,t,n)=>{e.empty();e.off();const i=new Q.ModalPopup("Change element's type");i.get_canvas().addClass("add-new-popup");const s=i.children_div;i.show();r.div("change-parent-type-title",s,"Change "+this.node.context_element().parent().get_name()+"'s type to...");const o=ee().composer.Owner(this.node.context_element().parent().get_static_property("group_type"));const a=r.div("editor dropdown");r.div("caption type-picker",a,"New type");const l=w.DisplayableInListValues(true);const c=y("Dropdown",o,{json:o.json,set:l});a.append(c.get_canvas());c.get_canvas().addClass("bubble-ui");s.append(a);const u=r.div(["btn","btn-create","bubble-ui"],s);u.text("Change");const d=r.div(["btn","btn-cancel"],s);d.text("Cancel");d.on("vclick",(()=>i.hide()));u.on("vclick",(()=>{const e=o.get();i.hide();this.node.context_element().parent().set_property("group_type",e);this.node.context_element().parent().commit();n()}))}}]}if(["ThisElement","GetElement"].includes(this.node.type())){var e;const t=this.node.type()==="ThisElement"?this.node.context_element():te.element(this.node.element_id());if((e=t.is_style)!=null&&e.call(t)){return[]}return[{display:"Create a new custom state...",hide_dropdown:true,thumbnail_id:"Documentation.Elements.GeneralConcepts.States.CustomStates",fn:(e,n,r)=>ee().visual_edit.show_create_new_state_modal({div:e,preset_val:n,cb:r,element:t,is_message:true})}]}return[]}});w.MessagesWithoutArguments=r.make_new(class e extends M{constructor(e){var t;super();this.params=e;if(typeof((t=this.params.btype_name)==null?void 0:t.id)==="function"){this.params.btype_name=this.params.btype_name.id()}}get_options(){const e=i.get(this.params.btype_name).get_messages(true);let t=e.filter((e=>(e==null?void 0:e.ret_btype().id())&&e.no_arg_no_properties()));if(this.params.btypes_to_filter_out){t=t.filter((e=>!this.params.btypes_to_filter_out.includes(e.ret_btype().id())))}if(this.params.white_list_btypes){t=e.filter((e=>this.params.white_list_btypes.includes(e.ret_btype().id())))}const n=t.map((e=>new x(e.description(undefined,true),e.name())));if(this.params.add_advanced){n.push(k())}if(this.params.show_dynamic_sort_option){n.push(O())}if(this.params.show_random_sort_option){n.push(S())}return n}get_display(e){if(e===c.ADVANCED_SEARCH_CONSTRAINT){return"Advanced: "}if(e===c.DYNAMIC_SORTING_FIELD){return O().display}if(e===c.RANDOM_SORTING){return S().display}return super.get_display(e)}editor_type(){return u.REAL_TIME_SEARCH}_find(e){var t,n;if(!e){return null}if(e===c.ADVANCED_SEARCH_CONSTRAINT){if(this.params.add_advanced){return k()}else{return null}}if(e===c.DYNAMIC_SORTING_FIELD){if(this.params.show_dynamic_sort_option){return O()}else{return null}}if(e===c.RANDOM_SORTING){if(this.params.show_random_sort_option){return S()}else{return null}}const r=i.get(this.params.btype_name).get_message(e);const s=r.ret_btype().id();const o=new x(r.description(undefined,true),r.name());if(((t=this.params.white_list_btypes)!=null?t:[]).includes(s)){return o}if(!r.no_arg_no_properties()){return null}if(((n=this.params.btypes_to_filter_out)!=null?n:[]).includes(s)){return null}return o}});const J=e("../core/core_datasources");const Z=e("../webfonts");const Q=e("../core/widgets");const ee=e("../lib");const te=e("./appquery");const ne=e("../core/core_elements/core_elements_utilities/element_registry");const re=e("../core/core_actions");const ie=e("../core/core_actions/utilities/generic_actions_utilities");const se=e("../core/core_events");const oe=e("./plugins");const ae=e("../services");const le=e("../services/shared/plugin_getter");const ce=e("../editor/add_plugin");const ue=e("./lang");const de=e("./application");const pe=e("../languages");const _e=e("../editor/css")},{"../constants/apiworkflow":44,"../constants/composer":54,"../constants/fonts":68,"../constants/option_sets":77,"../constants/special_keys":87,"../constants/tokens":93,"../core/core_actions":162,"../core/core_actions/utilities/generic_actions_utilities":175,"../core/core_datasources":220,"../core/core_datasources/utilities/core_ds_composer_utilities":231,"../core/core_datasources/utilities/core_ds_element_utilities":234,"../core/core_elements/core_elements_utilities/element_registry":284,"../core/core_events":377,"../core/widgets":421,"../editor/add_plugin":489,"../editor/composer/compatibility/composers":532,"../editor/css":560,"../lang/tokens":730,"../languages":739,"../lib":741,"../services":780,"../services/shared/plugin_getter":783,"../u":823,"../u/shared/b_object":839,"../u/shared/decaf":844,"../webfonts":858,"./application":650,"./appquery":651,"./btype_ids":652,"./btypes":653,"./dropdown_contents/index":664,"./lang":714,"./plugins":726,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],728:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.S=void 0;n.expand=b;n.expand_object=w;n.expand_path=y;n.shrink=h;n.shrink_again=g;n.shrink_object=x;n.shrink_path=m;e("core-js/modules/web.dom-collections.iterator.js");var r=l(e("../u"));var i=l(e("../u/shared/async/b_fiber"));var s=l(e("../logger"));var o=e("../u/shared/loggable");function a(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=a(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const c={display_sender_name:"d7",list_id:"li",deleted:"del",email_address:"ea",action_id:"ai",description:"d3",label:"lab",user_name:"un",floating:"f7",formatting_type:"ft",poststripeauth:"p8",image_pressed:"ip",center_background:"cb",image_normal:"i9",image_hover:"ih",descending:"d2",password2:"p2",require_confirm:"rc",choices:"ch",default:"d1",terms:"tz",thing_type:"tt",initial_values:"i2",element_type:"et",email:"em",from:"fr",sort_field:"sf",separator_width:"sw",useiframe:"u2",columns:"c5",separator_color:"sc",html:"ht",name_has_been_changed:"n0",fields:"f3",rows:"rs",separator_style:"ss",body:"b3",subject:"su",constraint_type:"c2",constraints:"co",element_name:"e4",bind:"bi",meta_description:"md",type_to_find:"t5",group_type:"gt",action:"ak",to_change:"tc",stripes:"st",after:"af",changes:"cs",title:"t1",data_source:"ds",additional_values:"av",limit_number_of_characters:"0l",backdrop:"bd",workflows:"wf",margintop:"mt",password:"pw",event_name:"en",app_path:"ap",mandatory:"1m",linktype:"1l",open_in_new_tab:"o9",stripe_height:"sh",contents:"ct",floating_reference:"3f",stretch_or_rescale:"2f",tabs:"ts",custom_id:"ci",icon:"9i",page:"pa",content_format:"cf",display:"d",icon_color:"ic",args:"a",placeholder:"ps",background_gradient_direction:"b4",content:"c1",background_image:"bgi",bggcolor:"bg2",style:"s1",textshadow:"tes",key:"k",elements:"el",event:"e1",value:"v",repeat_background_vertical:"rbv",repeat_background_horizontal:"rbh",underline:"u",italic:"i",vertical_centering:"vc",textshadow_blur:"tsb",textshadow_color:"tsc",textshadow_horizontal:"tsh",textshadow_vertical:"tsv",page_item_type:"pet",readable_field:"rf",bold:"b",__initialized:"in",element_id:"ei",text:"3",line_height:"lh",condition:"c",letter_spacing:"ls",word_spacing:"ws",padding_vertical:"pv",background_gradient_from:"bgf",background_gradient_to:"bgt",padding_horizontal:"ph",current_parent:"cp",font_face:"f",font_alignment:"fa",font_size:"fs",border_width:"bw",states:"s",boxshadow_blur:"bsb",boxshadow_color:"bsc",boxshadow_vertical:"bv",boxshadow_horizontal:"bh",font_color:"fc",bgcolor:"bgc",default_name:"dn",entries:"e",border_color:"bc",is_visible:"iv",background_style:"bas",border_roundness:"br",border_style:"bos",zindex:"z",top:"t",left:"l",width:"w",height:"h",boxshadow_style:"bs",boxshadow_spread:"bsp",next:"n",name:"nm",properties:"p",type:"x",pages:"p3",element_definitions:"ed"};const u={provider:true,actions:true,val:true,id:true,_id:true,value_id:true};const d={};n.S=d;Object.entries(c).forEach((e=>{let[t,n]=e;const r=t;const i=`%${n}`;d[r]=i}));Object.keys(u).forEach((e=>{d[e]=e}));const p={};const _="%";Object.entries(c).forEach((e=>{let[t,n]=e;const i=t;if(n.includes(_)||t.includes(_)){throw new r.UnexpectedError("cannot use # sign in shrinks: "+t+", "+n)}if(n.toLowerCase()!==n){throw new r.UnexpectedError("cannot use upper case in shrinks: "+n)}if(p[n]){throw new r.UnexpectedError("Mapping "+n+" to "+t+" but "+n+" is already mapped to "+p[n])}p[n]=i}));function f(e){return c[e]!=null}function h(e){if(typeof e!=="string"){return e}if(f(e)){return _+c[e]}if(e.indexOf(_)===0){return _+e}return e}function m(e){return e.split(".").map((e=>h(e))).join(".")}function g(e){if(typeof e!=="string"){return e}if(f(e)){return _+c[e]}return e}function v(e){return p[e]!=null}function b(e){if(typeof e!=="string"){return e}if(e.indexOf(_)!==0){return e}const t=e.slice(1);if(v(t)){return p[t]}return t}function y(e){return e.split(".").map((e=>b(e))).join(".")}function w(e,t){var n;(n=t)!=null?n:t=0;if(t%3===2){i.optional_pause()}if(e==null||typeof e!=="object"){return e}const r=t+1;if(Array.isArray(e)){return e.map(((e,t)=>{if(t%10===0){i.optional_pause()}return w(e,r)}))}const s={};Object.entries(e).forEach(((e,t)=>{let[n,o]=e;if(t%10===0){i.optional_pause()}s[b(n)]=w(o,r)}));return s}function x(e,t){var n;(n=t)!=null?n:t=0;if(t%3===2){i.optional_pause()}if(e==null||typeof e!=="object"){return e}const r=e;if(!Array.isArray(e)&&r.constructor!==Object){s.warn("Shrinking a non-simple object",{object:(0,o.to_loggable)(e),type:r.constructor.name})}const a=t+1;if(Array.isArray(e)){return e.map(((e,t)=>{if(t%10===0){i.optional_pause()}return x(e,a)}))}const l={};Object.entries(e).forEach(((e,t)=>{let[n,r]=e;if(t%10===0){i.optional_pause()}l[h(n)]=x(r,a)}));return l}},{"../logger":744,"../u":823,"../u/shared/async/b_fiber":833,"../u/shared/loggable":849,"core-js/modules/web.dom-collections.iterator.js":1123}],729:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.has_adv_timezone_overridden=s;n.has_input_timezone_controls_on=a;n.has_rounding_operator_timezone_controls_on=o;var r=i(e("./appquery"));function i(e){return e&&e.__esModule?e:{default:e}}function s(){return r.default.get_public_setting("adv_timezone_overridden")}function o(){const e=r.default.get_public_setting("bubble_version");const t=r.default.has_feature_enabled("timezone_improvements");return e>=22||t}function a(){const e=r.default.has_advanced_feature_enabled("timezone_controls_date_time_inputs");const t=r.default.get_public_setting("bubble_version")<22&&(r.default.has_feature_enabled("tz_info_in_date_input")||r.default.get_public_setting("bubble_version")>=20);return e||t}},{"./appquery":651}],730:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.sorted_user_tokens=r;function r(e){return Object.keys(e).filter((t=>!e[t].deleted)).sort(((t,n)=>e[t].order-e[n].order))}},{}],731:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../u");const s=e("../u/shared/mode_check");s.edit_mode_only();const o=e("../lib");const a=e("./../logger");const l=e("../constants/locations");const c=e("../client_config");const u=e("./appquery");const d=e("../u/client/client_storage");const{watch:p}=e("../notifier/client");const{EditorUidTopic:_}=e("../constants/notifier_topics");const f={};const h={};r._is_uids_setup={};const m="uid_count_";const g=6;const v=3;const b={};r.update_count=function(e,t){var n;let i=(n=r.get_raw_count(e))!=null?n:0;if(t>i){i=t;window.localStorage[m+e]=String(i);o().location.post("server://appeditor/set_count",{appname:e,count:i}).then((t=>{const n=t.id_counter;if(n>i){window.localStorage[m+e]=String(n)}}))}return i};r.get_raw_count=function(e){const t=window.localStorage[m+e];const n=parseInt(t);return isNaN(n)?false:n};r.get_count_or_wait=function(e){const t=r.get_raw_count(e);if(t===false){r.set_up_uids(e,{force_refresh:true})}i.ensure_ready(r._is_uids_setup[e]);return t};r.get_count_or_throw=e=>{const t=r.get_raw_count(e);if(t===false){r.set_up_uids(e,{force_refresh:true});throw new i.UnexpectedError("Invalid uid counter; aborting action to avoid damage to app",{stored_uid:window.localStorage[m+e]})}return t};const y=new Map;d.events.on("pre_clear",(()=>{y.clear();for(let e=0;e<window.localStorage.length;e++){const t=window.localStorage.key(e);if(t.startsWith(m)){const e=window.localStorage.getItem(t);y.set(t,e)}}}));d.events.on("clear",(()=>{y.forEach(((e,t)=>{window.localStorage.setItem(t,e)}));y.clear()}));function w(e,t){return o().location.post("server://appeditor/check_count",{appname:e,browser_id:t})}const x=new Set;r.set_up_uids=function(e){var t,n,a;let l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const{force_refresh:c}=l;if(s.running_test()){var d,m;(m=(d=r._is_uids_setup)[e])!=null?m:d[e]=i.MakeSwitch(null,"fake switch");r._is_uids_setup[e].turn_on();return}if(!c&&r._is_uids_setup[e]){return}else if(c&&!((t=r._is_uids_setup[e])!=null&&t.is_turned())){return}(a=(n=r._is_uids_setup)[e])!=null?a:n[e]=i.MakeSwitch(null,`uids set up for ${e}`);r._is_uids_setup[e].turn_off();let y=window.localStorage.uid_browser_id;if(!y){y=String(Math.round(Math.random()*1e7));window.localStorage.uid_browser_id=y}function j(t){f[e]=t.editor_id;r.update_count(e,t.id_counter)}w(e,y).then(j).callback((t=>{if(t){r.handle_app_load_errors(t)}else{r._is_uids_setup[e].turn_on();if(!x.has(e)){x.add(e);p([_,e],(()=>r.get_count_or_throw(e)),(t=>{if(t!=null&&t.message){r.update_count(e,parseInt(t.message))}}))}setInterval((()=>w(e,y).done(j)),6*60*60*1e3)}}));h[e]=function(){var t;let n=b[e];if(!((t=n)!=null&&t.length)){const t=r.get_count_or_wait(e);const i=t+g;r.update_count(e,i);const s=Array(g-v).fill(0).map(((e,n)=>t+n+1+v)).reverse();n=b[e]=s}return n.pop()};i.WaitFor(o().visual_edit_is_ready,(()=>{if(o().undostack.get_write_mode()!==o().undostack.WRITE){return}i.run_once(30,(()=>{const t=u.app().json.child("uid_counter").get();const n=r.get_count_or_wait(e);return Math.max(t,n)}),((t,n)=>{if(t!=null){throw t}r.update_count(e,n);u.commit()}))}))};function j(e){return f[e]}function A(e){return h[e]()}r.get_next_uid=function(e){const t=j(e);const n=A(e);return i.short_uid(n,t)};let M=false;r.handle_app_load_errors=function(e,t){if(M){return e}M=true;let n=o().location.get_base_for_meta();return o().location.post("server://appeditor/get_versions",{appname:u.appname()},((r,s)=>{if(!r){var o;if(t&&!((o=s[t])!=null&&o.access_permitted)){var d;if(u.app_version()!==t&&(d=s[u.app_version()])!=null&&d.access_permitted){return}a.info("Trying to fetch from inaccessible version, redirecting to test",{original_app_version:t,trace:console.trace()});window.change_to_version(l.TEST_VERSION);return}}else{if(!(r instanceof i.Unauthorized||r instanceof i.UnauthorizedEmployee))a.error("failed to get version metadata while handling editor load errors",{get_versions_err:r})}window.alert(a.human_friendly(e));if(!(e instanceof i.Unauthorized||e instanceof i.UnauthorizedEmployee)){return}if(c.stay_on_editor_load_errors&&!c.ask_main_cluster_for_app_permisisons){return}if(c.is_dedicated){n+="?referring_app="+u.appname()}document.location.href=n}))}},{"../client_config":41,"../constants/locations":74,"../constants/notifier_topics":76,"../lib":741,"../notifier/client":747,"../u":823,"../u/client/client_storage":816,"../u/shared/mode_check":851,"./../logger":744,"./appquery":651,"core-js/modules/web.dom-collections.iterator.js":1123}],732:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i;function s(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const o=e("../../u");const a=e("../nodes");const l=e("../caching");const c=e("../appquery");const u=e("../../apiconnectorbase/call_btypes");const d=e("../btype_ids");const p=e("./GenericEvent");let _=(r=l.cached({type:l.AUTORUN}),i=class e extends p{owner(){return a.create(a.API_WORKFLOWS,this.json.parent())}is_api_event(){return true}get_custom_parameters(){if(this.type()!=="APIEvent"){return super.get_custom_parameters()}const e=this.get_static_property("trigger_option")==="get"&&this.get_static_property("expose");if(this.get_static_property("parameter_def")==="auto"&&!e){var t;const{is_list:e}=o.json_parse((t=this.get_static_property("data_type"))!=null?t:"{}");const n="api_wf_data."+this.id();return[{param_id:"_wf_request_data",name:"_wf_request_data",btype_id:e?d.list_type(n):n}]}else{var n,r;const t=this.property("parameters");const i=(n=(r=t.entries)==null?void 0:r.call(t))!=null?n:[];return i.map(((t,n)=>{var r,i;return{param_id:(r=t.get_static_property("key"))!=null?r:`[Missing key: ${n}]`,name:(i=t.get_static_property("key"))!=null?i:`[Missing key: ${n}]`,optional:t.get_static_property("optional"),btype_id:t.get_static_property("is_list")?d.list_type(t.get_static_property("value")):t.get_static_property("value"),in_url:e||t.get_static_property("in_url")}}))}}is_exposed(){return this.get_static_property("expose")}creates_session(){return this.actions("SignUp").length>0||this.actions("LogIn").length>0}return_data_actions(){return this.actions("APIReturnData")}wf_name(e){if(e){var t;return(t=this.get_static_property("wf_name"))==null?void 0:t.trim()}else{var n;return(n=this.get_static_property("wf_name"))==null?void 0:n.toLowerCase().trim()}}can_be_used_in_bulk(e){const t=["SendEmail","SendConfirmationEmail","SendPasswordResetEmail","SendICSFileEmail"];for(const e of t){if(this.actions(e).length){return{response:false,message:"Sends an email"}}}if(this.return_data_actions().length){return{response:false,message:"Returns some data"}}if(this.creates_session()){return{response:false,message:"Creates a session"}}const n=this.get_custom_parameters();if(n.length===0){return{response:false,message:"No parameter"}}if(n.length>1){return{response:false,message:"More than one parameter"}}const{btype_id:r,in_url:i}=n[0];const s=d.is_list(r);if(r!==e||s){return{response:false,message:"Parameter isn't of the right type"}}if(i){return{response:false,message:"Parameter is in the URL, not in the body"}}return{response:true}}check_for_errors(e){const t=this.wf_name();if(t!=null){const n=c.api().events().some((e=>e.id()!==this.id()&&t===e.wf_name()));if(n){e(this.display(true)+": You're using the same name for more than one endpoint")}}if(this.get_static_property("parameter_def")==="auto"&&this.get_static_property("trigger_option")!=="get"){const t=this.get_value();const n=t[this.id()];if(!n){e(this.display(true)+": We were unable to parse the type for this backend API. Please re-initialize the detected fields")}}return super.check_for_errors(e)}get_value(){const e={};if(this.get_static_property("parameter_def")==="auto"){var t;const n={calls:{}};const{types:r}=o.json_parse((t=this.get_static_property("data_type"))!=null?t:"{}");n.calls[this.id()]={types:r};u.get_btypes_from_call("api_event",n,e,"_wf_");for(const t in e){const n=e[t];n.name=t;n.full_name="api_wf_data."+t}}return e}},s(i.prototype,"get_value",[r],Object.getOwnPropertyDescriptor(i.prototype,"get_value"),i.prototype),i);t.exports=_},{"../../apiconnectorbase/call_btypes":5,"../../u":823,"../appquery":651,"../btype_ids":652,"../caching":656,"../nodes":721,"./GenericEvent":735,"core-js/modules/web.dom-collections.iterator.js":1123}],733:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../nodes");const s=e("../btypes");const o=e("../appquery");const a=e("../../lib");const l=e("../../services/shared/plugin_getter");const c=e("../migrations");const u=e("./WorkflowObject");const d=e("./workflow_utils");function p(e){return{field_names:{},fields:()=>[],display:()=>"[missing: "+e+"]"}}t.exports=class t extends u{constructor(e){var t,n;e=e.to_id();super(e);const i=this.type();if(r.is_edit_mode()){c.get_migration_fn(a().plugin_prefixes.action+i)(this.json)}if(i){this.A=a().load_plugin(a().plugin_prefixes.action+i,true)}(t=this.A)!=null?t:this.A=p(i);if(!this.A.field_names){throw new r.UnexpectedError("Missing field names for "+i)}this._field_names=(n=this.A.field_names)!=null?n:{};if(typeof this._field_names==="object"){this._field_names.condition={}}}is_action(){return true}check_use_visible(){return this.A.check_use_visible}is_mergeable(){return this.A.is_mergeable}can_server_side_redirect(){var e,t;return(e=(t=this.A).can_redirect)==null?void 0:e.call(t,this)}server_side_redirect(e){return this.A.server_side_redirect(this,e)}find_expressions(e){return i.from_raw_array(this.json,i.new_expression,d.find_my_expressions(i.to_raw(this),e))}safe_to_send(){return!this.A.do_not_send_result_to_client}safe_to_log(){return!this.A.do_not_log_result}return_value(){var e,t,n;const r=(e=(t=(n=this.A).return_value)==null?void 0:t.call(n,this))!=null?e:"null";return s.get(r)}_custom_event_actions_requires(e,t){const n=["TriggerCustomEvent","TriggerCustomEventFromReusable"];if(!n.includes(this.type())){return false}const r=o.event(this.get_static_property("custom_event"));if(!r||!r.exists()){return false}if(t[r.id()]){return false}t[r.id()]=true;return r.actions().some((n=>n["requires_"+e](t)))}requires_server(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(typeof this.A.requires_server==="function"){return this.A.requires_server()}if(this.A.server_method){return true}return this._custom_event_actions_requires("server",e)}requires_cookies(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(this.A.requires_cookies){return true}return this._custom_event_actions_requires("cookies",e)}server_method(){return this.A.server_method}terminate_server_workflow(){var e;return(e=this.A.terminate_server_workflow)!=null?e:this.A.server_method_resume!=null}server_method_resume(){return this.A.server_method_resume}display(e){const t=this.get_name();if(t&&typeof t==="string"){return t}else{return this.A.display(this,e)}}use_injected_datasource(e){if(this.A.use_injected_datasource){return this.A.use_injected_datasource(this,e)}else{return[false,true]}}get_injected_value(e){var t,n;return(t=(n=this.A).get_injected_value)==null?void 0:t.call(n,this,e)}get_injected_display(e){var t,n;return(t=(n=this.A).get_injected_display)==null?void 0:t.call(n,this,e)}next(){var e;const t=parseInt(this.json.name());const n=(e=this.json.parent())==null?void 0:e.child(t+1);if(n!=null&&n.exists()){return i.new_workflow_item(n)}else{return null}}all_next(e){const t=parseInt(this.json.name());const n=this.json.parent();if(!n){return[]}const r=this.json.parent().children().slice(t+1).map((e=>i.new_workflow_item(e)));return i.filter_array(e,r)}get_next_json(){var e;const t=parseInt(this.json.name());return(e=this.json.parent())==null?void 0:e.child(t+1)}previous(){var e;const t=parseInt(this.json.name());if(t===0){return this.event()}const n=(e=this.json.parent())==null?void 0:e.child(t-1);if(!(n!=null&&n.exists())){return null}return i.new_workflow_item(n)}event(){var e;return i.new_workflow_item((e=this.json.parent())==null?void 0:e.parent())}context_element(){var e;return(e=this.event())==null?void 0:e.context_element()}field_names(){return this._field_names}check_for_errors(e,t){var n,r,i,s,o;if(this.A.ignore_issue_checker){return}const a=(n=(r=this.A).check_for_errors)==null?void 0:n.call(r,this,e,t);if(a===true){return}const c=l.get_app_plugins().filter(Boolean).map((e=>e.name));if(this.A.is_plugin&&!c.includes(this.A.service)){e(this.display()+": You're using this action but haven't installed the plugin "+l.get_plugin(this.A.service).display())}else if((i=(s=this.A).display)!=null&&(o=i.call(s))!=null&&o.includes("[missing: apiconnector2")){e(this.display()+": you're using an API connector call that no longer exists")}return super.check_for_errors(e)}_fields(){if(!this.A.fields){console.log("type: "+this.type());console.log(e("util").inspect(this.A))}return[...this.A.fields(this)||[],{name:"condition",caption:"Only when",editor:"Basic",value:"sys.bool",optional:true,editor_value:"null",dont_show_default_value:true},...d.get_breakpoint_property(this)||[]]}next_recommended_actions(){var e,t,n;return(e=(t=(n=this.A).next_recommended_actions)==null?void 0:t.call(n,this))!=null?e:[]}get_data_to_refresh(e,t){if(this.A.data_to_refresh&&e.condition){return this.A.data_to_refresh(this,e,t.element)}}preprocess_properties(e,t){if(this.A.preprocess_properties){return this.A.preprocess_properties(e,this,t)}else{return e}}can_fall_back_to_server(){return this.A.fall_back_to_server}does_fall_back_to_server(){return this.A.fall_back_to_server&&this.requires_server()}needs_clientside_properties(){return this.A.run||this.A.data_to_refresh}run(e,t,n){if(!this.A.run){n();return}t.callback(((t,r)=>{if(t){if(this.does_fall_back_to_server()){e.get_server_outcome(this,n)}else{n(t)}return}try{if(r.condition||this.A.handle_condition_internally){return this.A.run(this,r,e,n)}else{return n()}}catch(e){return n(e)}}))}resume(e,t){if(this.A.resume){try{return this.A.resume(this,e,t)}catch(e){return t(e)}}else{return t()}}delete(e){if(!this.exists()){return}const t=this.json.raw();const n=a().changes.create_change("RemoveAction",{parent_id:this.previous().id(),id:this.id(),data:t,intent_details:{user_interaction:"Direct Action Delete",user_action:e==null?void 0:e.user_action,parent_user_action:e==null?void 0:e.parent_user_action,parent_id:e==null?void 0:e.parent_id}});n.execute()}}},{"../../lib":741,"../../services/shared/plugin_getter":783,"../../u":823,"../appquery":651,"../btypes":653,"../migrations":716,"../nodes":721,"./WorkflowObject":736,"./workflow_utils":738,"core-js/modules/web.dom-collections.iterator.js":1123,util:2348}],734:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../services/shared/plugin_getter");const i=e("./GenericEvent");t.exports=class e extends i{};const s=e=>[{name:"workflow_disabled",caption:"Disable workflow",editor:"Checkbox",only_edit_mode:true,condition:()=>!e.is_api()}];t.exports=class e extends i{can_server_side_redirect(){if(!this.E.can_redirect){return false}const e=this.all_next();return e.length===1&&e[0].can_server_side_redirect()}server_side_redirect(e){if(!this.E.server_side_redirect()){return false}if(!e(this)){return false}const t=this.all_next()[0];return e(t)}check_for_errors(e){const t=r.get_app_plugins().filter(Boolean).map((e=>e.name));if(this.E.is_plugin&&!t.includes(this.E.service)){e(this.display()+": You're using this event but haven't installed the plugin "+r.get_plugin(this.E.service).display())}return super.check_for_errors(e)}_fields(){return[...super._fields(),...s(this)]}get_custom_parameters(){return super.get_custom_parameters()}}},{"../../services/shared/plugin_getter":783,"./GenericEvent":735,"core-js/modules/web.dom-collections.iterator.js":1123}],735:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i;function s(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const o=e("../../u");const a=e("../nodes");const l=e("../caching");const c=e("../../lib");const u=e("../elements/elements_utils");const d=e("../../constants/eval");const p=e("../shrink");const{S:_}=p;const f=e("../migrations");const h=e("./WorkflowObject");const m=e("./workflow_utils");function g(e){return{_fields:()=>[],field_names:{},display:()=>"[missing: "+e+"]",register(){}}}let v=(r=l.cached({type:l.RUN_MODE}),i=class e extends h{constructor(e){var t,n;e=e.to_id();super(e);const r=this.type();if(o.is_edit_mode()){f.get_migration_fn(c().plugin_prefixes.event+r)(this.json)}if(r){this.E=c().load_plugin(c().plugin_prefixes.event+r,true)}(t=this.E)!=null?t:this.E=g(r);if(this.E.fields&&!this.E.field_names){throw new o.UnexpectedError("missing field_names for "+r)}this._field_names=(n=this.E.field_names)!=null?n:{};if(typeof this._field_names==="object"){this._field_names.condition={prop_type:d.EVAL_TYPE.skip}}if(o.is_edit_mode()){this._field_names=o.extend(this._field_names,{event_color:{default:"grey",only_edit_mode:true},wf_folder:{only_edit_mode:true}})}if(u._use_issue_checker()&&this.app().can_run_issue_checker()){e.register_indexer("issues_list",(()=>{if(c().visual_edit.allow_issue_indexer_runs()){const e=a.new_workflow_item(this.json);const t=e.id();if(!t){return}const n=c().apptests.check_issues(e);const r=["issues_list",t];return[r,o.json_stringify(n)]}}))}}find_expressions(e){return a.from_raw_array(this.json,a.new_expression,m.event_find_expressions(a.to_raw(this),e))}is_action(){return false}is_api_event(){return false}display(e){const t=this.get_name();const n=t&&typeof t==="string"?t:this.E.display(this);if(e||this.E.never_show_condition){return n}const r=this.property("condition").get_tree_display();return n+(r?" and "+r:"")}get_composer_context(e){if(typeof this.E.get_composer_context==="function"){return this.E.get_composer_context(e)}}next(){const e=this.json.child("actions").child(0);return e.exists()?a.new_workflow_item(e):null}all_next(e){const t=this.json.child("actions").children();const n=t.map((e=>a.new_workflow_item(e)));return a.filter_array(e,n)}get_next_json(){const e=this.json.child("actions");return e.child(this.json.children().length)}actions(e){return this.all_next(e)}event(){return this}context_element(){var e;return(e=this.my_element())!=null?e:this.owner()}owner(){var e;const t=(e=this.json.parent())==null?void 0:e.parent();if(t){return a.new_element(t)}}register(e){return this.E.register(this,e)}deferrable(){var e;return(e=this.E.deferrable)!=null?e:false}field_names(){return this._field_names}_fields(){var e,t,n,r;return[...(e=(t=(n=this.E).fields)==null?void 0:t.call(n,this))!=null?e:[],{name:"event_color",caption:"Event color",editor:"Dropdown",set:c().sets.get_set("Object")(m.event_colors_with_captions),optional:true},{name:"wf_folder",caption:(r=window)!=null&&r.is_maison?"Workflow category":"Workflow folder",editor:"Dropdown",set:c().sets.get_set("WFFolders")(this.root()),optional:true,on_change(e){if(c().action_canvas.current_folder()!=="__all"){return c().action_canvas.current_folder(e)}}},{name:"condition",caption:"Only when",editor:"Basic",value:"sys.bool",optional:!this.E.condition_not_optional,editor_value:"null"},...m.get_breakpoint_property(this)]}delete(e){const t=c().changes.create_change("RemoveEvent",{root_id:this.root().id(),id:this.id(),data:this.json.raw(),intent_details:{user_interaction:"Direct Event Delete",user_action:e==null?void 0:e.user_action,parent_user_action:e==null?void 0:e.parent_user_action,parent_id:e==null?void 0:e.parent_id}});t.execute()}check_for_errors(e){var t,n;if(this.get_static_property("workflow_disabled")){return}(t=(n=this.E).check_for_errors)==null?void 0:t.call(n,this,e);const r=super.check_for_errors(e).children;return{children:[...r,...this.all_next()]}}condition(){return a.new_expression(this.json._child(_.properties)._child(_.condition),this)}},s(i.prototype,"condition",[r],Object.getOwnPropertyDescriptor(i.prototype,"condition"),i.prototype),i);t.exports=v},{"../../constants/eval":64,"../../lib":741,"../../u":823,"../caching":656,"../elements/elements_utils":679,"../migrations":716,"../nodes":721,"../shrink":728,"./WorkflowObject":736,"./workflow_utils":738,"core-js/modules/web.dom-collections.iterator.js":1123}],736:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../application/RAW");const s=e("../nodes");const o=e("../appquery");const a=e("../../editor/css");const l=e("../../lib");const c=e("../shrink");const{S:u}=c;const d=e("./workflow_utils");const p={"stripe-CreateCoupon":true};function _(e){return!p[e]}t.exports=class e extends s.HasID{type(){return this.json.child("type").get()}id(){return this.json.id()}is_api(){var e;return(e=this.root())==null?void 0:e.is_api()}pretty_print(e,t){var n,r,i;(n=e)!=null?n:e="";(r=t)!=null?r:t=true;const s=[];if(t){s.push("\n")}s.push(e);let o;try{o=this.display()}catch(e){}(i=o)!=null?i:o=this.type();s.push((this.is_action()?"Action ":"Event ")+this.id()+": "+o);for(const t of this.properties()){s.push("\n"+e+"  "+t.json.name()+":");s.push("\n"+t.pretty_print(e+"    ",false))}const a=this.next();if(a){s.push(e+"\n\n          \n\n");s.push(a.pretty_print(e,false))}if(t){s.push("\n")}return s.join("")}get_name(){const e=this.json.child("name").get();if(e||!_(this.type())){return e}else{return this.get_static_property("name")}}find_my_expressions(e){return s.from_raw_array(this.json,s.new_expression,d.find_my_expressions(s.to_raw(this),e))}root(){var e,t,n;return(e=this.event())==null?void 0:(t=e.owner)==null?void 0:(n=t.call(e))==null?void 0:n.root()}my_element(){const e=this.element_id();if(e){return o.element(e)}else{return null}}element_id(){return this.json.smart_cache("element_id",(e=>e._raw_gchild(u.properties,u.element_id)))}next_recommended_actions(){return[]}new_action(e,t){t=i.copy(t,e).new_data;const n={parent_id:this.id(),id:e,data:t};r.add_source_appname_tracker_to_change_args(t,n,o.appname());const s=l().changes.create_change("CreateAction",n);s.execute()}set_name(e){const t=this.json.child("name").get();if(e!==t){const n=l().changes.create_change("SetData",{target_id:this.id(),path:"name",old_value:t,value:e});n.execute()}}switch_to_new_type(e){const t=this.json.child("properties").raw();const n=l().changes.create_change("ReplaceWFObject",{old_type:this.type(),new_type:e,id:this.id(),old_properties:t,is_action:this.is_action()});n.execute();this.commit()}mandatory_sections(){return null}property_sections(){return[{name:undefined}]}find_in_editor(e,t){return r.run_once(30,(()=>this.root()),((n,i)=>i==null?void 0:i.find_in_editor(false,(()=>{$(a.WORKFLOW_TAB).click();return r.wait_for_updates((()=>{l().action_canvas.current_folder("__all");l().action_canvas.select(this.id());return r.wait_for_updates((()=>{l().action_editor.edit_current_element();return r.wait_for_updates((()=>{if(e){return t(l().action_canvas.key_to_token[this.id()])}else{return t()}}))}))}))}))))}context_element(){return this.root()}event(){return this.owner()}};t.exports.prototype.make_new=s.new_workflow_item},{"../../editor/css":560,"../../lib":741,"../../u":823,"../application/RAW":646,"../appquery":651,"../nodes":721,"../shrink":728,"./workflow_utils":738,"core-js/modules/web.dom-collections.iterator.js":1123}],737:[function(e,t,n){"use strict";const r=n;const i=e("../nodes");const s=e("../../lib");const o=e("../appquery");const a=e("./WorkflowObject");const l=e("./GenericEvent");const c=e("./Event");const u=e("./APIEventObject");const d=e("./Action");const p=e("./workflow_utils");i.add(i.WORKFLOW_OBJECT,a);i.add(i.GENERIC_EVENT,l);i.add(i.EVENT,c);i.add(i.API_EVENT_OBJECT,u);i.add(i.ACTION,d);i.add_generic("workflow_item",_);function _(e){var t,n;if(!e){return null}if(((t=e.parent())==null?void 0:t.name())==="workflows"){return new c(e)}else if(((n=e.parent())==null?void 0:n.name())==="api"){return new u(e)}else{return new d(e)}}r.event_colors=p.event_colors;r.event_find_expressions=p.event_find_expressions;r.get_api_event=function(e){var t;let n=s().derived("APIWFByName",true).content()[e];(t=n)!=null?t:n=s().derived("APIWFByName").content()[e];if(n){var r;const e=o.event(n);if((r=e.is_api_event)!=null&&r.call(e)){return e}}return null}},{"../../lib":741,"../appquery":651,"../nodes":721,"./APIEventObject":732,"./Action":733,"./Event":734,"./GenericEvent":735,"./WorkflowObject":736,"./workflow_utils":738}],738:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../u");const s=e("../nodes");const o=e("../expressions/expression_utils");const a=e("../shrink");const{S:l}=a;r.find_my_expressions=function(e,t){if(!e){return[]}t=s.make_filter(t);const n=s.raw_properties(e,s.new_workflow_item);return n.flatMap((e=>{const n=o.expression_find_expressions(e,t);return t(e)?[e,...n]:n}))};r.event_find_expressions=function(e,t){if(!e){return[]}t=s.make_filter(t);const n=[e,...s.raw_children(e,l.actions)];return n.flatMap((e=>r.find_my_expressions(e,t)))};r.get_breakpoint_property=e=>[{name:"breakpoint",caption:"Add a breakpoint in debug mode",editor:"Checkbox",only_edit_mode:true,condition:()=>!e.is_api()}];r.event_colors=["grey","blue","red","green","orange","purple","cyan","brown"];const c={grey:"Gray"};r.event_colors_with_captions=Object.fromEntries(r.event_colors.map((e=>{var t;const n=(t=c[e])!=null?t:i.toTitleCase(e);return[e,n]})))},{"../../u":823,"../expressions/expression_utils":710,"../nodes":721,"../shrink":728,"core-js/modules/web.dom-collections.iterator.js":1123}],739:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");const r=n;const i=e("./u/shared/b_object");const s=e("./u/shared/errors");const o=e("./u/shared/mode_check");const a=e("./safe_require");a.safe_register("./languages",r);const l=e("./lang/appquery");const c=e("./lang/btypes");const u=e("./logger");const d=e("./lib");const p=e("./lang/btype_ids");const _=e("./shared/apps_utilities");r.available_languages=m;r.is_language_available=g;r.get_runmode_language_data=v;r.get_user_language_field=b;r.app_language=y;r.language_data=w;r.get_text=j;r.get_iso_code=A;r.format_iso_code_for_browser=M;r.is_rtl=E;r.delete_user_text=k;r.iso_lookup_language=S;r.add_built_ins=D;r.get_built_in_json_from_data=C;r.get_language_data=O;r.get_languages_data=N;const f={language:r.get_server_languages_no_cache,translation:r.get_all_languages_translations_object_no_cache,application_message:r.get_editor_app_text_data_no_cache};const h=Object.freeze({language:"server_languages",translation:"server_translations",application_message:"server_application_messages"});r.LANGUAGE_DATA_TYPE_TO_GETTER_FUNCTION=f;r.LANGUAGE_DATA_TYPE_TO_KEY=h;function m(){return Object.keys(r.get_languages_data())}function g(e){return r.get_languages_data()[e]!=null}function v(e){if(o.on_client()){return window.language_data}}function b(){const e=d().app();const t=e.get_public_setting("language_field");if(t){const n=e.custom_type("user").field(t);if(n.exists()){return t}}return null}function y(e){var t,n,i,s,a;function c(e){if(e==="portugese"){return"portuguese"}return e}function u(t){t=c(t);if(t&&r.is_language_available(t)){return t}if(e){return null}else{return"en_us"}}if(d().is_edit_mode()){return u(l.get_public_setting("app_language"))}if(o.on_client()&&window.application_language){return window.application_language}}function w(e){return r.get_runmode_language_data(r.app_language())}const x={YES:"yes",NO:"no"};function j(e,t){const n=d().app_language();const i=d().app().get_public_setting(`text.${n}.${e}.${t}`);if(o.on_client()){let o=i;if(o==null){var s,a;o=(s=r.get_language_data(n))==null?void 0:(a=s[e])==null?void 0:a[t];if(!o){var l,c,p;u.owner_warn("Missing translation text",{display:`No translation available yet for text ${e}-${t} in ${n}`});o=(l=(c=r.get_language_data("en_us"))==null?void 0:(p=c[e])==null?void 0:p[t])!=null?l:"(no translation)"}}return o}}function A(e){if(e==null){return"en_US"}if(o.on_client()){return window.language_data[e].iso_code}}function M(e){const[t,n]=e.split(/[_-]/);if(n!=null){return`${t}-${n.toUpperCase()}`}return t}function E(e){if(o.on_client()){var t;return(t=window.language_data[e].is_rtl)!=null?t:false}}function k(e){l.set_setting(true,`user_text_ids.${e}`,null);for(const t of r.available_languages()){l.set_setting(true,`text.${t}.USER_TEXTS.${e}`,null)}return l.commit()}function O(e){if(o.on_client()){if(window.translation_data[e]!=null){return window.translation_data[e]}if(r.iso_based_language_obj==null){r.iso_based_language_obj=r.iso_lookup_language()}const t=window.translation_data[r.iso_based_language_obj[e]];return t}throw new Error("Cannot call get_language_data on server side")}function S(){const e={};for(const[t,n]of Object.entries(r.get_languages_data())){e[n.iso_code]=t}return e}function D(e){if(e==null){throw new s.UnexpectedError("Language node is null for add_built_ins")}const t=e.child("yes_text").get();const n=e.child("no_text").get();const r=e.child("day_names_text").get();const i=e.child("month_names_text").get();return T({yes_text:t,no_text:n,day_names_text:r,month_names_text:i})}function C(e){if(e==null){throw new s.UnexpectedError("Language data is null for get_built_in_json_from_data")}const t=e.yes;const n=e.no;const r=e.day_names;const i=e.month_names;return T({yes_text:t,no_text:n,day_names_text:r,month_names_text:i})}function T(e){let{yes_text:t,no_text:n,day_names_text:r,month_names_text:i}=e;const s={BUILT_IN:{YES:t,NO:n,DATE_FORMAT:{dayNames:r.split(","),monthNames:i.split(",")}}};return s}function N(){if(o.on_client()){var e;return(e=window.language_data)!=null?e:{}}return get_server_languages()}},{"./lang/appquery":651,"./lang/btype_ids":652,"./lang/btypes":653,"./lib":741,"./logger":744,"./safe_require":777,"./shared/apps_utilities":788,"./u/shared/b_object":839,"./u/shared/errors":846,"./u/shared/mode_check":851,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123}],740:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.url.js");e("core-js/modules/web.url-search-params.js");const r=n;const i=e("seedrandom");const s=e("../u/shared/async/b_async");const o=e("../u/shared/async/b_fiber");const a=e("../u/shared/b_string");const l=e("../u/shared/b_object");const c=e("../u/shared/errors");const u=e("../u/shared/mode_check");const d=e("../u/shared/incremental");const p=e("../u/shared/Locale");const _=e("../logger");const f=e("../constants/time");const h=e("../u/shared/b_date");const m=h.require_moment();const g=e("./lib_factory");const v=e("../retryable");const b="Failed to establish a connection";const y=["body","custom_form","formData","custom_retry_handler","__original_request"];const w=3e4;function x(e){var t,n,r,i;const s={};const o={};for(const t in e){const n=e[t];if(y.includes(t)){s[t]=n}else{o[t]=n}}e=l.json_deep_copy(o);for(const t in s){const n=s[t];e[t]=n}(n=(t=e).method)!=null?n:t.method="get";(i=(r=e).timeout)!=null?i:r.timeout=w;e.gzip=true;return e}function j(e){return $.ajax(e)}function A(e){return s.Promise(e).then((e=>{var t,n;e=x(e);const r=s.Promise(null,"default_lib.http_request "+e.url);e.type=e.method.toUpperCase();delete e.method;(n=(t=e).dataType)!=null?n:t.dataType="jsonp";if(e.data!=null){var i,o;const t=(i=e.headers)==null?void 0:i["Content-Type"];const n=t!=null&&!a.starts_with(t,"application/json");const r=["GET","HEAD"].includes((o=e.type)!=null?o:"GET");if(!r&&!n){var c,u,d,p,_;(u=(c=e).headers)!=null?u:c.headers={};(_=(d=e.headers)[p="Content-Type"])!=null?_:d[p]="application/json";e.processData=false;e.data=l.json_stringify(e.data)}}else if(e.body!=null){e.data=e.body;e.contentType=false;e.processData=false;delete e.body}else if(e.formData){e.contentType=false;e.processData=false;const t=new FormData;for(const n in e.formData){const r=e.formData[n];t.append(n,r)}e.data=t;delete e.formData}if(e.qs){const t=new URL(e.url);for(const[n,r]of Object.entries(e.qs)){t.searchParams.append(n,r)}e.url=t.toString();delete e.qs}const f=j(e);f.done(((e,t,n)=>r.resolve({statusCode:n.status,body:l.json_stringify(e)})));f.fail(((e,t,n)=>{var i;return r.resolve({statusCode:e.status,body:(i=e.responseText)!=null?i:n})}));return r}))}r.get=function(){const e={};for(const t in M.type_to_prefix){const n=M.type_to_prefix[t];e[t]=n+":"}const t={bubble_version(){var e,t,n;return(e=(t=(n=window)==null?void 0:n.bubble_version)!=null?t:this.app().get_public_setting("bubble_version"))!=null?e:0},bv(){return D.get_bv(this.bubble_version())},load_plugin:M.load_plugin,plugin_prefixes:e,load_custom:C.load_custom,current_timezone(){return m.tz.guess()},log:_.log,workflow:new k,pageparam:new E,app_language:O.app_language,get_text:O.get_text,locale(){return p.from_posix(S().app_language())},browser_locale(){var e;if(((e=navigator)==null?void 0:e.language)!=null){return p.from_ietf(navigator.language)}else{return undefined}},test_prod:false,ip:"",app_indicator(e,t,n){var r,i,s;if(typeof e==="string"||e==null){var o;return{appname:e!=null?e:(o=this.appname)==null?void 0:o.call(this),app_version:t!=null?t:this.app_version(),temp_db:n!=null?n:this.temp_db()}}(r=e.appname)!=null?r:e.appname=domain_editor.get_appname_from_domain(e.domain);(i=e.app_version)!=null?i:e.app_version=this.app_version();(s=e.temp_db)!=null?s:e.temp_db=this.temp_db();return e},temp_db:null,http_request(e){if(u.on_server()){return http_request_server(e)}else{return A(e)}},experiment(e,t){const n=this.current_user();if(!n){return-1}const r=n._id();const s=i(e+r);return Math.floor(s()*t)}};return t};r.register=function(){g.getLibFactory().registerLibCreator("default",r.get)};const M=e("../core/plugin_loader");const E=e("../client/pageparamservice");const k=e("../client/workflowengine");const O=e("../languages");const S=e("./index");const D=e("../bv/bubble_version");const C=e("../core/core_elements/custom_elements")},{"../bv/bubble_version":18,"../client/pageparamservice":32,"../client/workflowengine":40,"../constants/time":92,"../core/core_elements/custom_elements":290,"../core/plugin_loader":385,"../languages":739,"../logger":744,"../retryable":776,"../u/shared/Locale":827,"../u/shared/async/b_async":832,"../u/shared/async/b_fiber":833,"../u/shared/b_date":836,"../u/shared/b_object":839,"../u/shared/b_string":841,"../u/shared/errors":846,"../u/shared/incremental":848,"../u/shared/mode_check":851,"./index":741,"./lib_factory":742,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.url-search-params.js":1126,"core-js/modules/web.url.js":1127,seedrandom:2297}],741:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../u/shared/mode_check");const i=e("../u/shared/errors");const s=e("../u/shared/b_object");const o=e("../u/shared/async/b_async");const a=e("../u/shared/async/b_fiber");const l=e("../monitoring/apm");const c=e("../logger");const u={app:"wrap",load_plugin:"function",plugin_prefixes:"object",load_custom:"function",bubble_version:"function",bv:"function",appname:"wrap",app_version:"wrap",db_instance:"wrap",current_user:"wrap",current_user_id:"wrap",current_timezone:"wrap",scope:"wrap",is_edit_mode:"wrap",test_prod:"wrap",http_request:"function",app_domain:"function",app_plan:"function",derived:"function",derived_name:"wrap",experiment:"function",location:"object",element:"object",workflow:"object",pageparam:"object",user:"object",phonegap:"object",app_language:"function",get_text:"function",locale:"wrap",browser_locale:"wrap",ddg:"function",visual_edit:"object",edit_canvas:"object",action_editor:"object",action_canvas:"object",data_editor:"object",data_canvas:"object",styles_editor:"object",styles_canvas:"object",logs_editor:"object",app_owners:"function",plugin_editor:"object",plugin_canvas:"object",settings_editor:"object",settings_canvas:"object",property_editor:"object",undostack:"object",clipboard:"object",comment_panel:"object",property_instance_container:"object",exhaustive_composer_canvas:"object",type_editor:"object",option_set_editor:"object",composer:"object",SlidablePalette:"function",slidable_palette:"object",ImagePalette:"function",appchange:"object",getChecker:"function",changes:"object",sets:"object",get_session_id:"function",current_user_rights:"function",apptests:"object",visual_edit_is_ready:"object",add_plugin:"object",subscription:"object",app_indicator:"function",request:"object",history:"object",bubble_hostname:"wrap",full_url:"wrap",canonical_uri:"wrap",protocol:"wrap",hostname:"wrap",temp_db:"wrap",ignore_privacy_rules:"wrap",is_api:"function",api_version:"function",request_cache:"object",KeyValueDB:"function",emailservice:"object",task_manager:"object",fileupload:"object",ip:"wrap",speakeasy:"object",log_context:"object",bad_values_in_logs:"object",set_log_tag:"function",log:"function",fiber_id:"function",editor_vendor:"object",force_responsive_version:"object"};function d(){const e=["Lib Object {"];e.push("");e.push("Settings:");function t(t){var n;e.push("    "+t+": "+((n=this[t])==null?void 0:n.call(this)))}t("is_edit_mode");t("appname");t("app_version");const n={...u};e.push("");e.push("Available:");e.push(...Object.keys(this).map((e=>{delete n[e];return"    "+e})));e.push("");e.push("Missing:");e.push(...Object.keys(n).map((e=>"    "+e)));e.push("");e.push("}");return e.join("\n")}function p(e){return()=>e}function _(e){var t;(t=e.toString)!=null?t:e.toString=d;for(const t in e){const n=e[t];if(!["toString","running_with_lib"].includes(t)&&n!==undefined){switch(u[t]){case"function":if(typeof n!=="function"){throw new i.UnexpectedError("expected function for "+t+" but got "+n)}break;case"wrap":if(typeof n!=="function"){e[t]=p(n)}break;case"object":if(typeof n!=="object"){throw new i.UnexpectedError("expected object for "+t+" but got "+n)}break;default:if(u[t]==null){throw new i.UnexpectedError("Trying to validate a lib and found an invalid key: "+t)}throw new i.UnexpectedError("Unrecognized contents entry for "+t+": "+u[t])}}}}let f;if(typeof window==="undefined"||window===null){f=()=>{var e;return(e=a.Fiber.current)==null?void 0:e._running_lib}}else{f=()=>D}t.exports=f;const h=t.exports;const m=e("../safe_require");m.safe_register("./lib",h);h.if_any=f;h.or_throw=function(){const e=f();if(e==null){throw new i.UnexpectedError("Missing Lib!")}return e};m.safe_register("./lib",h);h.register_watcher=x;const g="enter";const v="exit";const b="extend";const y="retract";const w={[g]:[],[v]:[],[b]:[],[y]:[]};function x(e,t){if(!(e in w)||typeof t!=="function")return;w[e].push(t)}function j(e,t,n){for(const i of(r=w[e])!=null?r:[]){var r;i(t,n)}}function A(e,t,n){E(e,t);if(n===g&&t==null){M()}j(n,e,t);if([g,b].includes(n)){k(e,t)}}function M(){if(!r.is_edit_mode()){i.set_error_hook("default_display",(()=>{var e;return(e=h())==null?void 0:e.get_text("CORE","TEMPORARY_BUG")}))}i.set_error_hook("localize_message",((e,t)=>{var n;return(n=h())==null?void 0:n.get_text(e,t)}));i.set_error_hook("get_client_args",(e=>{var t,n,r;const i=(t=(n=e.code)!=null?n:(r=h())==null?void 0:r.fiber_id())!=null?t:"no code found";return{code:i}}))}function E(e){var t,n,r;if((e==null?void 0:e.appname)==null||((t=a.Fiber)==null?void 0:t.current)==null){return}const i=(n=e.appname)==null?void 0:n.call(e);const s=(r=e.app_version)==null?void 0:r.call(e);if(i!=null){a.set_running_app(i,s)}}function k(e){var t,n,r;if((e==null?void 0:e.appname)==null||((t=a.Fiber)==null?void 0:t.current)==null){return}const i=(n=e.appname)==null?void 0:n.call(e);const s=(r=e.app_version)==null?void 0:r.call(e);const{fiber_appname:o}=a.Fiber.current;if(i==null){if(o!=null){c.log("warn","overwriting fiber appname with null",{fiber_appname:o});a.Fiber.current.fiber_appname=null}}else if(i==="meta"){if(o==null){a.assign_fiber_ownership(i,s)}}else{if(o==null||o==="meta"||o===i){a.assign_fiber_ownership(i,s)}else{c.log("warn","transmuting fiber between non-meta apps",{fiber_appname:o,new_appname:i});a.assign_fiber_ownership(i,s)}}}let O=null;const S=h.get_lib_ready_key=()=>{var e;(e=O)!=null?e:O=o.MakeKey(null,"lib_ready_key");return O};let D;h.set_global_lib=function(e){_(e);A(e,D,g);D=e;S().turn()};h.extend_global=function(e){const t=h();const n=s.extend({},t,e);A(n,t,b);return h.set_global_lib(n)};h.wait_for_lib=e=>o.WaitFor(S(),e);h.with_lib=function(e,t){_(e);if(e.running_with_lib){e={...e}}else{e.running_with_lib=true}const n=a.Fiber.current._running_lib;A(e,n,g);a.Fiber.current._running_lib=e;if(typeof e.fiber_id==="function"){l.addTransactionLabels({fiber_id:e.fiber_id()})}try{return t()}finally{A(n,e,v);a.Fiber.current._running_lib=n}};if(typeof window!=="undefined"&&window!==null){h.extend=function(e,t){if(!D){throw new i.UnexpectedError("can only call Lib.extend if you have already called Lib.set_global_lib")}_(e);const n={};for(const[t,r]of Object.entries(e)){if(r!==undefined){n[t]=D[t];D[t]=r}}A(D,n,b);try{return t()}finally{A(n,D,y);Object.assign(D,n)}}}else{h.extend=function(e,t){if(!a.Fiber.current._running_lib){throw new i.UnexpectedError("can only call Lib.extend if you are already in a Lib.with_lib")}_(e);const n={};for(const[t,r]of Object.entries(e)){if(r!==undefined){n[t]=a.Fiber.current._running_lib[t];a.Fiber.current._running_lib[t]=r}}A(a.Fiber.current._running_lib,n,b);try{return t()}finally{A(n,a.Fiber.current._running_lib,y);Object.assign(a.Fiber.current._running_lib,n)}}}},{"../logger":744,"../monitoring/apm":746,"../safe_require":777,"../u/shared/async/b_async":832,"../u/shared/async/b_fiber":833,"../u/shared/b_object":839,"../u/shared/errors":846,"../u/shared/mode_check":851,"core-js/modules/web.dom-collections.iterator.js":1123}],742:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.getLibFactory=s;n.getNamedLib=o;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");class r{constructor(){this._libCreators=new Map;this._libExtenders=new Map}registerLibCreator(e,t,n){this._libCreators.set(e,t);if(n){this.registerLibExtender(e,n)}}registerLibExtender(e,t){this._libExtenders.set(e,t)}_unpackAppname(e){if(e){if(e.appname!=null&&typeof e.appname==="object"){const{appname:t,app_version:n,temp_db:r}=e.appname;e.appname=t;e.app_version=n;e.temp_db=r}}return e}getLib(e,t){const n=this._libCreators.get(e);if(n){t=this._unpackAppname(t);return n(t)}throw new Error(`No lib creator registered for ${e}`)}getPartialLib(e,t){const n=this._libExtenders.get(e);if(n){t=this._unpackAppname(t);return n(t)}throw new Error(`No lib extender registered for ${e}`)}libCaller(e){if("wither"in e){return e.wither(this.getLib(e.libName,e.libParams),e.fn)}return e.extender(this.getPartialLib(e.libName,e.libParams),e.fn)}}let i;function s(){var e;(e=i)!=null?e:i=new r;return i}function o(e,t){return s().getLib(e,t)}},{"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123}],743:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("url");const s=e("querystring");const o=e("./util");const a=e("./u/shared/b_string");const l=e("./u/shared/b_object");const c=e("./u/shared/errors");const u=e("./u/shared/uuid");const d=e("url");const p=e("./safe_require");const _=e("./client_config");const f=e("./constants/locations");const h=e("./shared/apps_utilities");const m=e("./shared/environment_utilities");const g=e("./u/server/server_errors");p.safe_register("./locations",r);r.get_primary_version=function(e){if(e===f.LIVE_VERSION){return e}return f.TEST_VERSION};r.get_db_version=function(e){if(e===f.LIVE_VERSION){return e}if(a.starts_with(e,_.private_version_prefix)){return e}if(f.TEMPLATE_VERSIONS.includes(e)){return e}return f.TEST_VERSION};r.get_db_display=function(e){e=r.get_db_version(e);if(e===f.TEST_VERSION){return f.TEST_VERSION_DISPLAY}else{return f.LIVE_VERSION_DISPLAY}};r.is_hardcode=(e,t)=>h.is_hardcoded(e)&&(t==null?void 0:t.indexOf(_.private_version_prefix))!==0;r.live_key=()=>{var e;return _.env+" "+o.get_meta_hostname()+" "+((e=_.hostname_modifier)!=null?e:"")};r.Location=class e{constructor(e,t){this.base_url=e;if(t&&t.normalizeUnicode){this.base_url=this.standardize_unicode_url()}}get_pieces(){var e;const t={};const n=this.parsed_url();if(l.is_empty(n)){return{}}let r=n.pathname.split("/").filter((e=>e!==""));if(_.apps_domain&&a.ends_with(n.hostname,"."+_.apps_domain)){t.appname=n.hostname.slice(0,n.hostname.lastIndexOf("."+_.apps_domain));t.use_apps_domain=true}else if(_.apps_domain&&n.hostname===_.apps_domain){throw new g.Redirect(302,"https://"+o.get_meta_hostname())}else if(o.is_meta_hostname(n.hostname)&&r[0]==="site"){t.use_site_path=true;t.appname=r[1];r=r.slice(2)}else{t.domain=n.hostname}if(((e=r[0])==null?void 0:e.indexOf(f.VERSION_PATH_PREFIX))===0){t.app_version=r[0].slice(f.VERSION_PATH_PREFIX.length);t.version_explicit=true;r=r.slice(1)}else{t.version_explicit=false;t.app_version=f.LIVE_VERSION}t.path=r;t.query=n.query;return t}is_production(e){if(this.parsed_url().hostname!==o.get_meta_hostname_for_app(e)){return false}return true}format_pieces(e,t){var n;let r=((n=t==null?void 0:t.protocol)!=null?n:this.parsed_url().protocol)+"//";if(e.domain){r+=e.domain}else if(_.apps_domain&&!e.use_site_path){r+=e.appname+"."+_.apps_domain}else{var i;r+=(i=e.meta_hostname)!=null?i:o.get_meta_hostname_for_hostname(this.parsed_url().hostname);r+="/site/";r+=e.appname}const a=e.version_explicit;if(!["default",undefined,null,true,false].includes(a)){throw new c.UnexpectedError("unrecognized version explicit: "+a)}if(a===true||a==="default"&&e.app_version!==f.LIVE_VERSION){r+="/version-"+e.app_version}for(const t of(l=e.path)!=null?l:[]){var l;r+="/"+t}const u=s.stringify(e.query);if(e.query!=null&&u.length!==0){r+="?"+u}return r}protocol(){return this.parsed_url().protocol}get_base_for_meta(e){var t;const n=this.parsed_url();let r=m.is_production()?"https:":(t=e==null?void 0:e.protocol)!=null?t:n.protocol;r+="//";r+=o.get_meta_hostname_for_hostname(n.hostname);if(n.port){r+=":"+n.port}return r}get_server_base(e){const t=this.get_pieces();delete t.path;delete t.query;return this.format_pieces(t,e)+"/"}get_page_url(e,t,n){const r=i.parse(e!=null?e:"");if(r.pathname==="index"){r.pathname=""}let o=this.get_server_base()+r.pathname;const a=r.query!=null?s.decode(r.query):{};if(t&&!l.is_empty(t)){l.extend(a,t)}const c=s.stringify(a);if(c.length>0){o+="?"+c}if(n){o+="#"+n}return o}get_page(){var e;return(e=this.get_pieces().path[0])!=null?e:"index"}get_underlying_page(){var e,t;return(e=(t=window)==null?void 0:t.bubble_page_name)!=null?e:this.get_page()}parsed_url(){if(!this.base_url){return{}}return i.parse(this.base_url,true)}my_location(){return this.base_url}get_query(){return this.parsed_url().query}get_unique_id_in_url(){const{path:e}=this.get_pieces();if(e[1]!=null){const t=e[1];const n=t.split("-");const r=n[n.length-1];if(u.is_UUID(r)){return r}}return null}get_slug_in_url(){const{path:e}=this.get_pieces();if(e[1]!=null){const t=decodeURIComponent(e[1]);if(!this.get_unique_id_in_url()){return t}}return null}get_canonical_url(){const e=this.parsed_url();const t=`${e.protocol}//${e.hostname}${e.pathname}`;return t}standardize_unicode_url(){const e=d.parse(this.base_url);for(const t of["search","pathname"]){if(/[^\u0000-\u007f]/.test(e[t])){e[t]=encodeURI(e[t])}}return d.format(e)}}},{"./client_config":41,"./constants/locations":74,"./safe_require":777,"./shared/apps_utilities":788,"./shared/environment_utilities":793,"./u/server/server_errors":824,"./u/shared/b_object":839,"./u/shared/b_string":841,"./u/shared/errors":846,"./u/shared/uuid":855,"./util":857,"core-js/modules/web.dom-collections.iterator.js":1123,querystring:2279,url:981}],744:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.STACK_OMITTED=n.LOG_MESSAGE=n.AREAS=void 0;n.debug=T;n.error=R;n.fatal=L;n.human_friendly=V;n.info=P;n.install_browser_error_handler=C;n.log=void 0;n.owner_error=B;n.owner_only_error=U;n.owner_warn=q;n.propagated_error=$;n.register_logger=b;n.user_error=F;n.verbose=N;n.warn=I;n.with_user_level=G;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");var r=f(e("util"));var i=f(e("./constants/logging"));var s=f(e("./constants/plugin"));var o=f(e("./u/shared/mode_check"));var a=f(e("./u/shared/errors"));var l=f(e("./u/shared/logging"));var c=p(e("./safe_require"));var u=e("./u/shared/loggable");var d=f(e("./shared/environment_utilities"));function p(e){return e&&e.__esModule?e:{default:e}}function _(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(_=function(e){return e?n:t})(e)}function f(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=_(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}c.default.safe_register("./logger",t.exports);const h=new WeakSet;const m=(e,t,n)=>{var r;(r=n)!=null?r:n={};n.level=e;n.message=t!=null?t:"";console.log(JSON.stringify(n))};const g={fiber_wrapper(e){return e},log(e,t,n){m("error","Logging Error: must call logger.register_logger before logging",{});m(e,t,n)}};let v=g;function b(e){v=e}const y="log message";n.LOG_MESSAGE=y;const w=i.AREAS;n.AREAS=w;const x=i.STACK_OMITTED;n.STACK_OMITTED=x;const j="NO_MESSAGE";function A(e){return e instanceof a.NotReadyError}function M(e){return e!=null&&typeof e==="object"&&typeof e.suggested_level==="string"}function E(e){const t=i.ALL_LEVELS;return t.includes(e)}function k(e){const t=[...a.ERROR_LEVELS,"owner_warn"];return t.includes(e)}function O(e){if(M(e)){const t=e.suggested_level;if(E(t)){return z[t]}else if(k(t)){return W[t]}}return R}const S=v.fiber_wrapper(((e,t,n)=>{if(e instanceof Error||A(e)){const t=O(e);return t(a.ensure_bubble_error(e))}else if(e==null&&t==null){return T(j)}else if(typeof e!=="string"){throw new a.UnexpectedError("Expected logger.log(err) or logger.log(level, message, data), but got a non-string level",{level:e})}if(n==null){n={}}else if(typeof n==="string"){n={data:n}}if(!E(e)){throw new a.UnexpectedError("unknown level",{level:e})}const s=t;if(t instanceof a.NotReadyError){t=a.ensure_bubble_error(t)}if(t instanceof Error){var c,d,p;if(h.has(t)){return}h.add(t);const e=(c=t.args)!=null?c:{};for(const t in e){const r=e[t];if(typeof r==="function"){n[t]=r()}else{n[t]=(0,u.to_loggable)(r)}}n.stack=t.stack;(p=(d=n).tags)!=null?p:d.tags={};n.tags.error_class=t.error_class;if(n.tags.user_level&&!n.display){n.display=t.display()}if(n.display&&typeof n.display!=="string")n.display=String(n.display);t=t.message}else if(typeof t==="string"){var _,f,m,g;(f=(_=n).stack)!=null?f:_.stack=a.capture_stack(t,1);(g=(m=n).tags)!=null?g:m.tags={};n.tags.error_class=y}else if(t==null){t=j}else{throw new a.UnexpectedError("invalid message format, must be error or string",{message:r.inspect(t)})}if(n!=null&&typeof n!=="object"){throw new a.UnexpectedError("invalid data format, object, error, or undefined",{data:r.inspect(n)})}v.log(e,t,n);function b(e,t){return o.running_test()&&l.level_gte(t,"error")&&(e instanceof Error||typeof e==="string"&&!i.ALLOWED_ERRORS_IN_TESTS.includes(e))}if(s!==undefined&&b(s,e)){console.log(t,n);throw new a.UnexpectedError("log with level >= error while running test",{level:e,original:t,data:(0,u.to_loggable)(n)})}}));n.log=S;function D(e){if(!window.headers_source_maps){return null}for(const[t,n,r]of window.headers_source_maps){if(e>Number(n)&&e<=Number(r)){return t}}return null}function C(e){let{Lib:t}=e;window.onerror=(e,n,r,l,c)=>{var u,p,_,f;if(!c){return}const h=a.ensure_bubble_error(c);const m=`\n    at root (${n!=null?n:""}:${r!=null?r:-1}:${l!=null?l:-1})`;h.stack=((u=h.stack)!=null?u:"")+m;const g=(p=n==null?void 0:n.startsWith((_=(f=t())==null?void 0:f.location.get_server_base())!=null?_:""))!=null?p:false;const v=r?D(r):null;let b=false;let y=false;if(g&&v){b=[i.CUSTOM_PAGE_HEADER_TAG,i.CUSTOM_APP_HEADER_TAG].includes(v);y=v.startsWith(i.PLUGIN_MAIN_HEADER_PREFIX)||v.startsWith(i.PLUGIN_PAGE_HEADER_PREFIX);if(h instanceof a.BubbleError){h.extend({html_section:v})}}const w=y||h.stack.includes(s.PLUGIN_CODE_SRC_PREFIX);const x=10;const j=!o.is_edit_mode()&&!o.is_plugin_edit_mode();const A=j&&!d.is_local()&&!h.stack.split("\n").filter((e=>{var t,n;e=(t=(n=e.match(/\/package\/.+(?:run|run_debug)\.js:(\d+):/))==null?void 0:n[1])!=null?t:"";return parseInt(e)>x})).join("\n").includes("/package/");const M=A&&h.stack.includes("/package/");const E=b||h.stack.includes("UNMANGLED_html_wrap");const k=h.stack.includes("chrome-extension://");if(h instanceof a.BubbleError){h.extend({UNCAUGHT:"caught by window.onerror",is_plugin_code:w,is_3rd_party_code:w||E,is_outside_package:A})}if(E){U("html bug",{display:"Bug in custom html:\n"+h.stack})}else if(!n||k){return}else if(w||A){if(M){B("Error in jQuery code -- likely a plugin",{display:"Bug in custom code "+h.stack,original:h})}else{B("Error in custom code",{display:"Bug in custom code "+h.stack,original:h})}}else{R(h)}return true}}function T(e,t){S("debug",e,t)}function N(e,t){S("verbose",e,t)}function P(e,t){S("info",e,t)}function I(e,t){S("warn",e,t)}function R(e,t){S("error",e,t)}function L(e,t){S("debug",e,t)}const z={debug:T,verbose:N,info:P,warn:I,error:R,fatal:L};function B(e,t){var n;(n=t)!=null?n:t={};t=G(t,"owner_error");P(e,t)}function q(e,t){var n;(n=t)!=null?n:t={};t=G(t,"owner_warn");P(e,t)}function U(e,t){var n;(n=t)!=null?n:t={};t=G(t,"owner_error");N(e,t)}function F(e,t){var n;(n=t)!=null?n:t={};t=G(t,"user_error");P(e,t)}const W={owner_error:B,owner_warn:q,user_error:F,error:R};function $(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const r=O(t);r(e,{inner_error:t,...n})}function G(e,t){e={...e};if(typeof e.tags==="object"){e.tags={...e.tags}}else{e.tags={}}e.tags.user_level=t;return e}function V(e){if(e==null){return""}S(e);return a.ensure_bubble_error(e).display()}},{"./constants/logging":75,"./constants/plugin":78,"./safe_require":777,"./shared/environment_utilities":793,"./u/shared/errors":846,"./u/shared/loggable":849,"./u/shared/logging":850,"./u/shared/mode_check":851,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123,util:2348}],745:[function(e,t,n){"use strict";var r,i;const s=n;const o=e("../../logger");let a;const l={currentTransaction:null,completedTransactions:[]};class c{constructor(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this.name=e;this.labels=t;this.sync=n;this.start=Date.now()}end(){this.end=Date.now()}setStart(e){this.start=e}}class u extends c{constructor(e,t){super(e,t);this.spans=[]}startSpan(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const r=new c(e,t,n);this.spans.push(r);return r}end(){super.end();l.completedTransactions.push(l.currentTransaction);l.currentTransaction=null}}s.startTransaction=function(e,t){if(l.currentTransaction){o.warn("APM: Only one transaction can exist at a time");return}l.currentTransaction=new u(e,t);return l.currentTransaction};s.endTransaction=function(e){if(e)e.end()};s.addTransactionLabels=function(e){if(l.currentTransaction){Object.assign(l.currentTransaction.labels,e)}};if(a!=null&&a.trace){s.addTransactionLabels=a.addSpanAttributes}s.startSpan=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!l.currentTransaction){return}return l.currentTransaction.startSpan(e,t,n)};s.endSpan=function(e){if(e)e.end()};s._traceSpanCb=function(e,t,n){const r=s.startSpan(e,t,true);try{return n()}finally{s.endSpan(r)}};s.traceSpan=s._traceSpanCb;if(a!=null&&a.trace){s.traceSpan=a.trace}s.getCompletedTransactions=()=>l.completedTransactions;s.clearCompletedTransactions=()=>l.completedTransactions=[];s.getBaggageEntry=(r=a==null?void 0:a.getBaggageEntry)!=null?r:()=>undefined;s.withBaggageEntries=(i=a==null?void 0:a.withBaggageEntries)!=null?i:(e,t)=>t()},{"../../logger":744}],746:[function(e,t,n){"use strict";const r=e("../../u/shared/mode_check");const i=e("../../safe_require");const s=e;if(r.on_server()){t.exports=s("./serverApm")}else{t.exports=e("./clientApm")}i.safe_register("./monitoring/apm",t.exports)},{"../../safe_require":777,"../../u/shared/mode_check":851,"./clientApm":745}],747:[function(e,t,n){(function(t){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.get_server_time_offset=h;n.watch=p;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.immediate.js");var r=l(e("../u"));var i=l(e("../u/shared/errors"));var s=l(e("../logger"));var o=l(e("../client_config"));function a(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=a(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const c={};const u=23*60*60*1e3;const d=25;function p(e,n,r){var a;let[l,...u]=e;if(!o.notifier_host){return}const d=`${l}${u.join("-")}`;(a=c[d])!=null?a:c[d]={watchers:[],last_msg:null,subscribed_version:null};c[d].watchers.push({version_fn:n,on_update:r});const{last_msg:p,subscribed_version:_}=c[d];if(_!=null){var f;const e=n();if(typeof e!=="number"){s.error("non-numeric version",{version:e,topic:d})}if(e<_){throw new i.UnexpectedError("Watching Notifier topic that has been subscribed to with a newer version",{topic:d,version:e,subscribed_version:_})}if(p!=null&&e<((f=p.version)!=null?f:-Infinity)){r(p)}}else{c[d].subscribed_version=-Infinity;t((()=>O(d)))}}let _=null;let f=null;function h(e){C();function t(){if(b()&&_==null){var n;const r=Date.now();_=function(t){const n=Date.now();const i=Math.round((r+n)/2);const s=t-i;e(s);_=null;f=null};f=function(){_=null;setTimeout(t,100);f=null};(n=g)==null?void 0:n.send("ts")}else{setTimeout(t,100)}}t()}let m=false;let g=null;let v=false;function b(){var e;return v&&((e=g)==null?void 0:e.readyState)===1}let y=null;let w=0;let x=false;let j=0;let A;if(typeof window!=="undefined"&&window!==null){A=false;window.kill_notifier_socket=function(){var e;A=true;(e=g)==null?void 0:e.close()};window.restore_notifier_socket=function(){A=false;M()}}function M(){var e,t,n;if(A){return}if(window.WebSocket==null){console.log("No window.WebSocket class defined: real time updates are disabled");return}(e=f)==null?void 0:e();v=false;let i;const a=(t=o.notifier_host)!=null?t:"";const l=(n=o.notifier_port)!=null?n:"";if(a){i=`${a}:${l}`}else{i=a}g=new window.WebSocket(`wss://${i}`);let u=null;g.onclose=function(e){var t;(t=y)!=null?t:y=Date.now();x=false;setTimeout(M,Math.min(6e4,w*w*1e3));w++;if(w===10){s.error("notifier_client: socket closed after 10 retries",{last_error:u,close_code:e==null?void 0:e.code,close_reason:e==null?void 0:e.reason})}};g.onerror=function(e){var t;u=e;console.log(`notifier_client.coffee: got error from socket: ${(t=u.stack)!=null?t:""}`)};g.onopen=()=>{var e;g.send(`s ${(e=o.notifier_domain)!=null?e:String(new r.UnexpectedError("no notifier domain set"))}`)};g.onmessage=function(e){const t=e.data;if(t==="ok"){if(!v){v=true;w=0;k()}}else if(t.slice(0,2)==="h "){const e=t.split(" ");const n=e[1];const r=e[2]?parseInt(e[2]):-Infinity;const i=e[3];if(c[n]!=null){c[n].last_msg={topic:n,version:r,message:i};c[n].watchers.forEach((e=>e.on_update({topic:n,version:r,message:i})))}}else if(t.slice(0,2)==="i "){const e=t.split(" ")[1];if(e!==String(j)){s.error("Got a bad subscription ack!",{ack_counter:j,msg:t,msg_id:e});g.close();return}x=false;S()}else if(t.slice(0,3)==="ts "){var n;(n=_)==null?void 0:n(parseInt(t.slice(3)))}else{s.error("unrecognized message from notifier",{msg:t})}}}let E=[];function k(){E=Object.keys(c);S()}function O(e){E.push(e);S()}function S(){var e;if(E.length===0){D();return}if(!b()||x){C();return}x=true;const t=E.slice(0,d);E=E.slice(d);j++;let n="g "+String(j);for(const e of t){const t=c[e].watchers.map((e=>e.version_fn())).filter((t=>{if(typeof t!=="number"){s.error("non-numeric version",{version:t,topic:e});return false}return true}));if(t.length===0){continue}const r=Math.min(...t);c[e].subscribed_version=r;n+=" "+e+" "+String(r)}(e=g)==null?void 0:e.send(n)}function D(){if(y){if(Date.now()-y>u){for(const e in c){c[e].watchers.forEach((e=>{let{on_update:t}=e;return t({stale:true})}))}}y=null}}function C(){if(!m){m=true;M()}}}).call(this)}).call(this,e("timers").setImmediate)},{"../client_config":41,"../logger":744,"../u":823,"../u/shared/errors":846,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.immediate.js":1124,timers:2334}],748:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("./lang/appquery");const i=e("./constants/app_json");const s=e("./lang/btype_ids");n.OptionSetStore=class e{add_new_option_set(e,t,i){var o;(o=t)!=null?o:t=false;let a;if(t){a=e}else{a=n.get_safe_id(e,{exists(e){return r.option_set(e).exists()}})}r.create_option_set(a,e,i);return s.option_set_type(a)}add_new_attribute(e,t,r,i){var s,o;const a=n.get_safe_id(t,{reserved:e.reserved_attributes(),exists(t){return e.attribute(t).exists()}});const l=(s=(o=r.id)==null?void 0:o.call(r))!=null?s:r;e.create_attribute(a,t,l,i);return a}add_new_value(e,t){const r=n.get_safe_id(t,{reserved:e.reserved_values(),exists(t){return e.value(t).exists()}});const i=o(e);e.create_value(r,t,{sort_factor:i});return r}};function o(e){let t=0;for(const n of e.values()){t=Math.max(t,n.sort_factor())}return t+1}n.get_safe_id=function(e,t){var n,r,s;(n=t)!=null?n:t={};const o=(r=t.reserved)!=null?r:[];const l=(s=t.exists)!=null?s:()=>false;const c=a(e);function u(e){if(i.PROTECTED_KEYS.has(e)){return true}if(i.BUBBLE_RESERVED_KEYS.has(e)){return true}return o.includes(e)||l(e)}let d=c;let p=0;while(u(d)){d=c+p;p++}return d};function a(e){const t=e.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();if(/^\d+$/.test(t)){return`${t}_`}return t}n.sort_options_fn=(e,t)=>e.sort_factor()-t.sort_factor();n.sort_attributes_fn=function(e,t){var n,r;if(((n=e.display())==null?void 0:n.toLowerCase())<((r=t.display())==null?void 0:r.toLowerCase())){return-1}else{return 1}};n.sort_types_fn=function(e,t){var n,r;if(((n=e.display())==null?void 0:n.toLowerCase())<((r=t.display())==null?void 0:r.toLowerCase())){return-1}return 1}},{"./constants/app_json":45,"./lang/appquery":651,"./lang/btype_ids":652,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],749:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.additional_fields_for_meta=void 0;n.format_campaign_data=E;n.init_segment=C;n.manage_utm_data=S;n.package_utm_data=O;n.page=I;n.register_tracking_hooks=A;n.reset=T;n.retrieve_utm_from_header=M;n.track=P;n.track_count=q;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var r,i,s,o;const a=e;const l=(r=(i=window)==null?void 0:i.u)!=null?r:a("./../u");const c=(s=(o=window)==null?void 0:o.safe_require)!=null?s:a("./../safe_require");const u=c.safe_require("./constants/db");const d=c.safe_require("./lib");const p=c.safe_require("./lang/appquery");const _=c.safe_require("./logger");const f=c.safe_require("./client_config");const h=c.safe_require("./shared/environment_utilities");const m=c.safe_require("./shared/domain_utilities");const g=c.safe_require("url");let v=null;n.additional_fields_for_meta=v;let b=false;const y={extend_with_meta_identity_properties:w,add_options_for_meta:N,add_data_for_meta:j,meta_log_on_page_call:x};function w(e,t){}function x(e,t,n){}function j(e){}function A(e){Object.entries(e).forEach((e=>{let[t,n]=e;y[t]=n}))}function M(){const e=[];const t=d.or_throw().location.get_query();for(const s of["utm_source","utm_medium","utm_campaign","utm_content","utm_term"]){if(t[s]!=null){var n,r,i;let o;if(typeof t[s]!=="string"&&typeof(((n=t[s])==null?void 0:n[0])!=null)==="string"){o=t[s][0]}else{o=t[s]}const a=(r=(i=o).replace)==null?void 0:r.call(i,/[^a-zA-Z0-9_-]/g,"");e.push({key:s+"_text",value:a})}}return e}function E(e){const t={};for(let n in e){const r=e[n];n=n.replace("utm_","");n=n.replace("_text","");n=n.replace("campaign","name");t[n]=r}return t}const k=["utm_source_text","utm_medium_text","utm_campaign_text","utm_content_text","utm_term_text"];function O(){S();const e=M();const t={};for(const n of k){for(const r of e){if(r.key===n){t[n]=r.value}}}return l.json_stringify(E(t))}function S(){var e,t,r,i;if(typeof window==="undefined"||window===null){return}const s=l.json_parse((e=(t=l.session_storage)==null?void 0:t.getItem("metadata_for_logging"))!=null?e:"[]");(r=v)!=null?r:n.additional_fields_for_meta=v=(i=window.pv_data)!=null?i:[];for(const e of s){if(!v.map((e=>e.key)).includes(e.key)){v.push(e)}}const o=[];for(const e of v){if(k.includes(e.key)){o.push(e)}}try{var a;(a=l.session_storage)==null?void 0:a.setItem("metadata_for_logging",l.json_stringify(o))}catch(e){console.log(e)}}function D(){var e;const t=(e=g.parse(window.location.href).hostname)!=null?e:"";return m.is_host_aws(t)}function C(e,t){try{var n;if(l.running_test()||!h.is_production()||((n=window)==null?void 0:n.location)!=null&&D()||!f.use_analytics){if(window.analytics!=null&&!l.running_test()&&!D()){_.warn("init_segment | window.analytics is here but should not be");delete window.analytics}e();return}if(window.analytics==null){e();_.warn("init_segment | Missing window.analytics!");return}if(b){e();return}b=true}catch(e){throw new l.UnexpectedError("init_segment | error before run_once",{e:e})}l.run_once(30,(()=>{let e;if(!t){const t=d.or_throw().current_user();e={email:t.get_email(),is_logged_in:t.is_logged_in()};w(e,t)}return e}),((n,r)=>{if(n){_.warn("init_segment | error in init_segment run_once",{err:n});r={}}try{if(t){N({},(e=>window.analytics.identify(t,{},e)))}else{var i;t=d.or_throw().current_user()._id();if(t&&(i=r)!=null&&i.is_logged_in){N({},(e=>window.analytics.identify(t,r,e)))}}if(t===u.NO_USER&&d.or_throw().is_edit_mode()&&p.appname()!=="learn"){delete window.analytics;console.log("turning off segment because we are in edit mode, not logged in, and it's not learn");e();return}return e()}catch(e){throw new l.UnexpectedError("init_segment | error in init_segment run_once callback",{err:e})}}))}function T(){b=false;window.analytics.reset()}function N(e,t){var n;(n=e)!=null?n:e={};t(e)}function P(e,t,n,r){C((()=>{var i,s;(i=t)!=null?i:t={};(s=n)!=null?s:n={};j(t);N(n,(n=>{var i;(i=window.analytics)==null?void 0:i.track(e,t,n,r)}))}))}function I(e,t,n,r,i){C((()=>{var s,o;(s=n)!=null?s:n={};(o=r)!=null?o:r={};j(n);N(r,(r=>{var s;x(t,n,r);(s=window.analytics)==null?void 0:s.page(e,t,n,r,i)}))}))}let R={};let L=false;function z(){L=false;const e=R;R={};for(const t in e){const{event:n,data:r,count:i}=e[t];r.count=i;P(n,r)}}let B=false;function q(e,t){var n,r;if(!B){B=true;window.addEventListener("beforeunload",z)}if(!L){L=true;setTimeout(z,5*60*1e3)}const i=e+"_"+JSON.stringify(t);(r=(n=R)[i])!=null?r:n[i]={event:e,data:t,count:0};R[i].count++}},{"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],750:[function(e,t,n){"use strict";e("core-js/modules/es.error.cause.js");var r,i;const s=n;if(typeof window!=="undefined"&&window!==null){var o,a;(a=(o=window).optional_modules)!=null?a:o.optional_modules={};window.optional_modules.interactions=s}const l=e;const c=(r=(i=window)==null?void 0:i.safe_require)!=null?r:l("./../safe_require");const u=c.safe_require("./assert");const d=c.safe_require("./box");function p(e){var t;if((t=window)!=null&&t.testing){window.testing.log(e)}}function _(e,t,n){var r;(r=n)!=null?r:n=false;return{clientX:e,clientY:t,which:n?2:1,button:n?1:0}}s.make_mouse_event=_;s.mouse_event_from_tag=function(e,t){var n;(n=t)!=null?n:t=false;return _(5+d.offset_left(e),5+d.offset_top(e),t)};function f(e,t,n){const r=new MouseEvent(t,{bubbles:true,...n});e.each(((e,t)=>{t.dispatchEvent(r)}))}s.triggerMouse=f;s.dblclick=function(e){u.assert(e,"called double click on a bad object: "+e);u.assert(e.length>0,"called double click on an empty set: "+e.selector);p(`double clicking on tag ${e.selector}`);f(e,"mousedown",s.mouse_event_from_tag(e));f(e,"click",s.mouse_event_from_tag(e));f(e,"mouseup",s.mouse_event_from_tag(e));f(e,"mousedown",s.mouse_event_from_tag(e));f(e,"click",s.mouse_event_from_tag(e));f(e,"dblclick",s.mouse_event_from_tag(e));f(e,"mouseup",s.mouse_event_from_tag(e))};s.click=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};u.assert(e,"called click on a bad object: "+e);u.assert(e.length>0,"called click on an empty set: "+e.selector);p(`clicking on tag ${e.selector}`);const n=Object.assign(s.mouse_event_from_tag(e),t);f(e,"mousedown",n);f(e,"click",n);f(e,"mouseup",n)};s.click_drag_release=function(e,t,n,r){p(`dragging from ${e}, ${t} to ${n}, ${r}`);const i=s.find_element_by_position(e,t);f(i,"mousedown",_(e,t));f(i,"mousemove",_((e+n)/2,(t+r)/2));f(i,"mousemove",_(n,r));f(i,"mouseup",_(n,r))};s.find_element_by_position=function(e,t){const n=$(document.elementFromPoint(e-$(document).scrollLeft(),t-$(document).scrollTop()));if(!n){throw new Error("find element by position ("+e+", "+t+") failed.  Is the element on the screen?")}return n};function h(e){return $(e).filter((function(){return $(this).children().length===0||$(this).children().text().trim()===""}))}s.filter_by_text=function(e,t,n){var r;(r=n)!=null?r:n=false;const i=e.selector;let s=n?e:h(e);s=s.filter((function(){return $(this).text().toLowerCase()===t.toLowerCase()}));s.selector=`${i} with text ${t}`;return s}},{"core-js/modules/es.error.cause.js":1116}],751:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.META_VIDEO_FIELDS=n.META_USER_FIELDS=n.META_TEMPLATE_FIELDS=void 0;const r={app_goals:"app_goals_list_text",bought_templates:"bought_templates_list_custom_template",bubble_coach:"coach1_boolean",bubble_employee:"bubble_employee_boolean",bubble_instructor:"bootcamp_instructor_boolean",created_date:"Created Date",credit_balance:"balance_number",done_lessons_list:"done_lessons_list",email_confirmed:"email_confirmed___manual__boolean",first_name:"first_name_text",growth_experiment_groups:"growth_experiment_groups_list_text",iterable_campaign_id:"iterable_campaignid_number",iterable_template_id:"iterable_templateid_number",last_app_category:"last_app_category_text",last_app_goal:"last_app_goal_text",last_editor_visit:"last_editor_visit_date",last_name:"last_name_text",last_watched_video:"last_watched_video_custom_video",log_triggered_actually_building:"log_actually_building_triggered_date",log_triggered_first_app_created:"log_triggered_first_app_created_date",log_triggered_first_subscription:"log_triggered_first_subscription_date",mrr:"mrr_number",onboarding_persona:"onboarding_persona_option_onboarding_persona",perk_program:"perk_program_custom_perk_program",total_charges:"total_charges_number",user_permissions:"up_option_up"};n.META_USER_FIELDS=r;const i={name:"name_text"};n.META_TEMPLATE_FIELDS=i;const s={title:"title_text"};n.META_VIDEO_FIELDS=s},{}],752:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r,i,s,o;const a=n;if(typeof window!=="undefined"&&window!==null){var l,c;(c=(l=window).optional_modules)!=null?c:l.optional_modules={};window.optional_modules.bubble_plugin=a}const u=e;const d=(r=(i=window)==null?void 0:i.u)!=null?r:u("../../u");const p=(s=(o=window)==null?void 0:o.safe_require)!=null?s:u("./../../safe_require");const _=p.safe_require("./lang/btype_ids");const f=p.safe_require("./external");const h=p.safe_require("./lib");const m=p.safe_require("./u/shared/async/b_fiber");const g=p.safe_require("./db/hydrate");let v=p.safe_require("./client_config");let b=p.safe_require("./constants/locations");const y=p.safe_require("./shared/domain_utilities");let w,x,j,A;const M=["Blog","CRM","Dashboard","Game","Landing Page","Marketplace","Online Store","Portfolio","Social","Directory & Listings","Professional Services","On-demand Services","Project Management","Building Blocks"].sort().concat(["Other","Unlisted"]);function E(e){let t;const n=app_lib.get_server_app(e,"test");if(n.json.child("last_change").get()==null){return{}}const r=y.get_dedicated_env(app_metadata.get_dedicated_from_appname(e));const i={_id:e,name:e,parent_app_text:app_lib.get_parent_app(e),template_boolean:n.is_template(),domain:domain_editor.get_domain_from_appname(e),dedicated:r,trial_source:app_lib.get_trial_source(e)};if(app_lib.current_user_app_admin(e)){i.master_owner_boolean=true}if(n.get_public_setting("pw_protection")){t="https://s3.amazonaws.com/appforest_uf/f1524305487738x240992023609578600/Desktop%202018-04-21%20at%2012.11.05%20PM.png"}else{t=n.json.child("screenshot").child("screenshot").get()}if(t){i.screenshot_image=t}let s=null;if(!v.is_dedicated){s=app_lib.get_app_meta_thing(e);i.meta_object=g.dehydrate_tree(s)}if(v.is_dedicated||r){i.last_change_date=app_lib.get_last_change_date(e)}else{i.last_change_date=app_lib.get_last_change_date_including_meta_thing(e,s)}i.owner_emails=app_lib.get_app_owners(e).map((e=>x.get_user_by_id(e).get_email()));i.plan_data=w(e);i.latest_contributors=Object.entries(j(e)).map((e=>{let[t,{last_change_date:n,user_id:r,user:i}]=e;return{app_version:t,last_change_date:n,user_id:r,user_email:i.email}}));return i}function k(e){const t=app_lib.get_server_app(e,b.TEST_VERSION);t.pre_cache("settings.client_safe.parent_app");t.pre_cache("settings.client_safe.pw_protection");t.pre_cache("last_change_date");t.pre_cache("last_change");t.pre_cache("is_template");t.pre_cache("screenshot.screenshot");const n=app_lib.get_server_app(e,b.LIVE_VERSION);return n.pre_cache("last_change")}function O(){if(h().appname()!=="meta"){throw new d.OwnerError("Sorry, this operation can only be done from the actual Bubble homepage. Go to https://bubble.io and try again.")}}a.cls=class e extends f.Service{constructor(){super();this.authenticator=new f.NoAuth;this.values=this._get_initial_values();this.calls=this._get_initial_calls()}get skip_property_security(){return true}get public_calls(){return["get_bubble_lessons","get_tutorial_videos","get_plan_info","get_usage_plans","get_plugin_call_list","get_app_with_owner_count","get_user_count","get_user_paid_apps","get_user_apps_full","get_user_app_names","get_user_app_details","get_user_native_apps","get_app_plan","get_app_from_subscription_id","get_app_flag_status","get_admin_users_for_app","get_monthly_page_views","get_all_plans","get_plugin_pending_data","get_plugins_tags","get_template_categories","get_experiment","get_appname_validation_regex"]}get public_values(){return["reference_content","lesson","tutorial_video","showcased_app","bubble_plan","usage_plan","app_plan","application","native_app","pending_plugin"]}_get_initial_values(){return{reference_content:new f.StructValue("Reference",{tag:{},text:{},level:{ret_value:"number"}}),lesson:new f.StructValue("Lesson",{lesson_description:{},lesson_name:{},number:{ret_value:"number"},rank:{ret_value:"number"},length:{ret_value:"number"}}),tutorial_video:new f.StructValue("Tutorial video",{id:{},category:{},description:{},length:{},number:{ret_value:"number"},thumbnail:{ret_value:"image"},title:{},vimeo_id:{},script:{}}),showcased_app:new f.StructValue("Showcased App",{name:{},description:{},url:{},testimonial_content:{},testimonial_author:{},testimonial_title:{},top_section:{ret_value:"boolean"},logo:{ret_value:"image"}}),app_plan:new f.StructValue("App plan",{plan:{},frequency:{},creation_date:{ret_value:"date"},next_billing_date:{ret_value:"date"},subscription_id:{},capacity:{ret_value:"number"},status:{},paying_user_id:{},dedicated_env:{}}),bubble_plan:new f.StructValue("Bubble plan",{display:{},id:{},can_use_multiple_clusters:{ret_value:"boolean"},custom_domain:{ret_value:"boolean"},private_apps:{ret_value:"number"},import_export_csv:{ret_value:"boolean"},collaboration:{ret_value:"number"},api:{ret_value:"boolean"},logs:{ret_value:"number"},price:{},monthly_price:{},yearly_price:{},support:{},version_control:{ret_value:"number"},versions:{ret_value:"number"},db_backup:{ret_value:"number"},sub_apps:{ret_value:"boolean"},ssl:{ret_value:"boolean"},seo:{ret_value:"boolean"},recurring_frequencies:{ret_value:_.list_type("text")},live_version:{ret_value:"boolean"},edit_mode_pw_protection:{ret_value:"boolean"},pw_protection:{ret_value:"boolean"},initial_capacity:{ret_value:"number"},initial_storage:{ret_value:"number"},possible_additional_units:{ret_value:"number"},monitoring:{ret_value:"boolean"},scheduler:{ret_value:"boolean"},two_factor_auth:{ret_value:"boolean"},value_prop:{},max_total_db_things:{ret_value:"number"},db_things_overage_chunk:{ret_value:"number"},db_things_overage_price_per_chunk:{ret_value:"number"},max_monthly_unique_daily_visitors:{ret_value:"number"},monthly_unique_daily_visitors_overage_chunk:{ret_value:"number"},monthly_unique_daily_visitors_overage_price_per_chunk:{ret_value:"number"},workload_units:{ret_value:"number"},workload_overage_rate:{ret_value:"number"},additional_storage_unit_price:{ret_value:"number"},can_buy_plugins:{ret_value:"boolean"}}),usage_plan:new f.StructValue("Usage Plan",{display:{},monthly_price:{ret_value:"number"},yearly_price:{ret_value:"number"},workload_units:{ret_value:"number"},workload_overage_rate:{ret_value:"number"}}),application:new f.StructValue("Bubble Application",{name:{caption:"name",ret_value:"text"},current_month_unique_visitors:{caption:"current_month_unique_visitors",ret_value:"number"},last_12_month_unique_visitors:{caption:"last_12_month_unique_visitors",ret_value:_.list_type("number")},last_change_date:{caption:"last_change_date",ret_value:"date"},next_end_date:{caption:"next_end_date",ret_value:"date"},parent_app_text:{caption:"parent_app",ret_value:"text"},master_owner_boolean:{caption:"master_owner",ret_value:"boolean"},template_boolean:{caption:"template",ret_value:"boolean"},screenshot_image:{caption:"screenshot",ret_value:"image"},domain:{ret_value:"text"},dedicated:{ret_value:"text"},meta_object:{ret_value:_.custom_type("application_metadata")},trial_source:{ret_value:"text"},owner_emails:{ret_value:_.list_type("text")},plan_data:{ret_value:_.api_type("bubble_plugin.app_plan")},latest_contributors:{ret_value:_.list_type(_.api_type("bubble_plugin.contribution"))}}),contribution:new f.StructValue("Contribution",{user_id:{caption:"contributor id",ret_value:"text"},user_email:{caption:"contributor email",ret_value:"text"},last_change_date:{caption:"change date",ret_value:"date"},app_version:{caption:"app version",ret_value:"text"}}),native_app:new f.StructValue("Bubble Native Application",{name:{caption:"name",ret_value:"text"},current_month_unique_visitors:{caption:"current_month_unique_visitors",ret_value:"number"},last_change_date:{caption:"last_change_date",ret_value:"date"},nativeappname:{caption:"nativeappname",ret_value:"text"},pagename:{caption:"pagename",ret_value:"text"}}),pending_plugin:new f.StructValue("Pending plugin",{release_description:{},license:{},name:{},image:{ret_value:"image"},description:{},instructions:{},demo_page:{},categories:{ret_value:_.list_type("image")},plugin:{ret_value:_.custom_type("plugins")}})}}_get_initial_calls(){return{get_user_app_names:class e extends f.Call{constructor(){super(...arguments);this.execute=this.execute.bind(this)}get human(){return"Get user app names"}get value_id(){return"text"}get parameters(){return{}}get is_list(){return true}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}O();if(h().current_user_id()==null){throw new d.Unauthorized(null,"User must be logged in")}const s=h().current_user();if(!s.is_logged_in()){throw new d.Unauthorized(null,"User must be logged in")}const o=s._id();if(!o){return[]}const a=app_lib.get_user_apps(o);if(s.child("skip_sorting_app_list_boolean").get()){return a}return app_lib.sort_apps_by_last_modified(a)}},get_user_app_details:class e extends f.Call{constructor(){super(...arguments);this.execute=this.execute.bind(this)}get human(){return"Get user app details"}get value_id(){return _.api_type("bubble_plugin.application")}get parameters(){return{appname:{editor:"Basic",value:"text"}}}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}O();if(h().current_user_id()==null){throw new d.Unauthorized(null,"User must be logged in")}const s=h().current_user();if(!s.is_logged_in()){throw new d.Unauthorized(null,"User must be logged in")}const o=s._id();if(!o){return[]}k(t.appname);return E(t.appname)}},get_user_apps_full:class e extends f.Call{constructor(){super(...arguments);this.execute=this.execute.bind(this)}get human(){return"Get user apps full"}get value_id(){return _.api_type("bubble_plugin.application")}get is_list(){return true}get parameters(){return{}}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}O();if(h().current_user_id()==null){throw new d.Unauthorized(null,"User must be logged in")}const s=h().current_user();if(!s.is_logged_in()){throw new d.Unauthorized(null,"User must be logged in")}const o=s._id();if(!o){return[]}const a=app_lib.get_user_apps(o);for(const e of a){k(e)}const l=[];app_lib.make_sure_all_apps_exists(o);for(const e of a){l.push(E(e))}return l}},get_user_native_apps:class e extends f.Call{constructor(){super(...arguments);this.execute=this.execute.bind(this)}get human(){return"Get user native apps"}get value_id(){return _.api_type("bubble_plugin.native_app")}get is_list(){return true}get parameters(){return{}}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}O();if(h().current_user_id()==null){throw new d.Unauthorized(null,"User must be logged in")}const s=h().current_user();if(!s.is_logged_in()){throw new d.Unauthorized(null,"User must be logged in")}const o=s._id();if(!o){return[]}const a=app_lib.get_user_apps(o);const l=[];for(const e of a){const t=app_lib.get_server_app(e,b.TEST_VERSION);for(const n of t.pages()){if(n.get_static_property("native_app")){l.push({_id:e,name:e,pagename:n.get_name(),nativeappname:e+" - "+n.get_name(),last_change_date:app_lib.get_last_change_date(e)})}}}return l}},get_user_paid_apps:class e extends f.Call{constructor(){super(...arguments);this.execute=this.execute.bind(this)}get human(){return"Get user apps simple"}get value_id(){return"text"}get is_list(){return true}get parameters(){return{user_id:{},dedicated_env:{optional:true},paid_only:{editor:"Checkbox"},master_only:{editor:"Checkbox"},admin_only:{editor:"Checkbox"},with_domain_only:{editor:"Checkbox"},never_trialed:{editor:"Checkbox"},specific_plan:{optional:true}}}get _must_proxy(){return true}execute(e,t,n,r,i){if(!t.user_id){return[]}if(d.on_client()){return super.execute(e,t,n,r,i)}let s=[];if(t.dedicated_env){s=app_metadata.get_dedicated_appnames(t.dedicated_env+".bubble.is")}else if(t.paid_only){s=app_metadata.get_paid_apps_for_user(t.user_id)}else if(t.master_only){s=app_lib.get_master_owner_apps(t.user_id)}else if(![null,undefined,""].includes(t.specific_plan)){for(const e of app_lib.get_user_apps(t.user_id)){const n=app_metadata.get_app_plan(e);if(n===t.specific_plan){s.push(e)}}}else{if(t.admin_only){for(const e of app_lib.get_user_apps(t.user_id)){const n=app_lib.get_user_app_permissions(e,b.TEST_VERSION,t.user_id);if(n.admin){s.push(e)}}}else{s=app_lib.get_user_apps(t.user_id)}}if(t.with_domain_only){var o;s=((o=s)!=null?o:[]).filter((e=>domain_editor.get_domain_from_appname(e)))}if(t.never_trialed){var a;s=((a=s)!=null?a:[]).filter((e=>!app_lib.get_trial_source(e)))}return s}},get_app_from_subscription_id:class e extends f.Call{constructor(){super(...arguments);this.execute=this.execute.bind(this)}get human(){return"Get app from subscription ID"}get value_id(){return"text"}get parameters(){return{subscription_id:{}}}get _must_proxy(){return true}execute(e,t,n,r,i){if(!t.subscription_id){return[]}if(d.on_client()){return super.execute(e,t,n,r,i)}return app_metadata.get_app_from_subscription_id(t.subscription_id)}},get_app_flag_status:class e extends f.Call{constructor(){super(...arguments);this.execute=this.execute.bind(this)}get human(){return"Get app flag status"}get value_id(){return"boolean"}get parameters(){return{appname:{}}}get _must_proxy(){return true}execute(e,t,n,r,i){if(!t.appname){return{}}if(d.on_client()){return super.execute(e,t,n,r,i)}const s=app_lib.get_server_app(t.appname,"test");return s.json.child_by_path(app_lib_consts.PROTECTED_PATHS.RUNMODE_BLOCKED_APP).get()}},get_app_plan:class e extends f.Call{constructor(){super(...arguments);this.execute=this.execute.bind(this)}get human(){return"Get app plan"}get value_id(){return _.api_type("bubble_plugin.app_plan")}get parameters(){return{appname:{}}}get _must_proxy(){return true}execute(e,t,n,r,i){if(!t.appname){return{}}if(d.on_client()){return super.execute(e,t,n,r,i)}return w(t.appname)}},get_all_plans:class e extends f.Call{get human(){return"Get plans"}get value_id(){return"text"}get is_list(){return true}get parameters(){return{}}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}return[...bubble_plans.get_sorted_plan_ids_with_custom()]}},get_admin_users_for_app:class e extends f.Call{get human(){return"Get app admin emails"}get value_id(){return"text"}get is_list(){return true}get parameters(){return{appname:{}}}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}const s=app_metadata.get_app_permissions(t.appname);const o=[];for(const e in s.users){const t=s.users[e];if(t.admin){o.push(h().db_instance().get(e).get_email())}}return o}},get_plan_info:class e extends f.Call{get human(){"Get Bubble plan"}get value_id(){return _.api_type("bubble_plugin.bubble_plan")}get parameters(){return{plan:{},new_2023_pricing_enabled:{editor:"Checkbox"}}}get _must_proxy(){return true}execute(e,t,n,r,i){var s;if(!t.plan){return}if(d.on_client()){return super.execute(e,t,n,r,i)}if(!bubble_plans.plan_exists(t.plan)){return}if(!bubble_plans.get_app_plan_edit_mode(t.plan)){return{}}const o=d.json_deep_copy(bubble_plans.get_app_plan_edit_mode(t.plan,t.new_2023_pricing_enabled));(s=o.display)!=null?s:o.display=d.toTitleCase(t.plan);return o}},get_usage_plans:class e extends f.Call{get human(){"Get usage plans"}get value_id(){return _.api_type("bubble_plugin.usage_plan")}get is_list(){return true}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}return usage_plans.get_usage_plans().map((e=>{const{monthly_price:t,yearly_price:n,workload_units:r,workload_overage_rate:i}=e;return{display:usage_plans.get_usage_plan_display(e),monthly_price:t,yearly_price:n,workload_units:r,workload_overage_rate:i}}))}},get_user_count:class e extends f.Call{get human(){return"Get user count"}get value_id(){return"number"}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}return h.extend({ignore_privacy_rules(){return true}},(()=>{var e;const t=h().db_instance("meta","live").find("user",[],[],"<no node>");return(e=t.length({cacheable:true,should_approx:true}))!=null?e:1609349}))}},get_app_with_owner_count:class e extends f.Call{get human(){return"Get all apps count"}get value_id(){return"number"}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}const s=app_metadata.list_apps();return s.length}},get_monthly_page_views:class e extends f.Call{get human(){return"Get monthly page views"}get value_id(){return"number"}get _must_proxy(){return true}execute(){if(d.on_client()){return super.execute()}}},get_bubble_lessons:class e extends f.Call{get human(){return"Get Bubble lessons"}get value_id(){return _.api_type("bubble_plugin.lesson")}get is_list(){return true}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}const s=[];for(const e in learningcontent){const t=learningcontent[e];s.push({lesson_description:t.lesson_description,lesson_name:t.lesson_name,number:t.number,rank:t.rank,length:t.steps.length})}return s}},get_tutorial_videos:class e extends f.Call{get human(){return"Get Tutorial Video"}get value_id(){return _.api_type("bubble_plugin.tutorial_video")}get is_list(){return true}get _must_proxy(){return true}get parameters(){return{edit_mode:{}}}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}const s=[];for(const e in tutorial_videos.general_videos){const n=tutorial_videos.general_videos[e];const r={vimeo_id:n.vimeo_id,number:n.number,title:n.title,id:e};if(!t.edit_mode){r.description=n.description;r.length=n.length;r.category=n.category;r.thumbnail=n.thumbnail;r.script=n.script}s.push(r)}return s.sort(((e,t)=>{if(e.number<t.number){return-1}else{return 1}}))}},get_edit_mode_plugins_list:class e extends f.Call{get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}if(v.plugins_live_here){return plugin_lib.get_all_plugins(t)}else{const r=super.execute(e,t,n);const i=plugin_lib.get_all_plugins(t);return d.extend(r,i)}}build(e,t,n){return S({path:"plugins/get_edit_mode_list",data:t})}post_processing(e,t){if(!v.plugins_live_here){for(const r in e){var n;const i=e[r];if(i.meta_id&&(n=t.current_plugins)!=null&&n[r]){plugin_lib.save_plugin_meta_dedicated(r,i)}}}return e}},get_plugin_meta_data:class e extends f.Call{get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}if(hardcoded_plugins.raw_data[t.plugin_id]){return hardcoded_plugins.raw_data[t.plugin_id]}if(v.plugins_live_here){return plugin_lib.get_plugin_meta_data(t)}else{return super.execute(e,t,n)}}build(e,t,n){return{path:"plugins/get_plugin_meta_data",data:t}}},get_plugin_pending_data:class e extends f.Call{get human(){return"Get plugin pending data"}get value_id(){return _.api_type("bubble_plugin.pending_plugin")}get parameters(){return{plugin_id:{}}}get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}const s=plugin_lib.get_pending_data(t.plugin_id);if((s==null?void 0:s.original_raw)==null){throw new d.UnexpectedError("Missing pending data")}const{meta_data:o}=s.original_raw;const a={release_description:s.pending_data,license:o.license,name:o.name,image:o.image,description:o.description,instructions:o.instructions,categories:o.categories,demo_page:o.demo_page,plugin:g.dehydrate_tree(h().db_instance().get(t.plugin_id))};return a}},subscribe_dedicated_app_to_plugin:class e extends f.Call{get _must_proxy(){return true}build(e,t){if(d.on_client()||v.plugins_live_here){throw new d.UnexpectedError("This should never happen, this should be done on dedicated")}return S({path:"plugins/subscribe_app_plugin",data:t,method:"post"})}},cancel_dedicated_plugins_plan:class e extends f.Call{get _must_proxy(){return true}build(e,t){if(d.on_client()||v.plugins_live_here){throw new d.UnexpectedError("This should never happen, this should be done on dedicated")}return S({path:"plugins/cancel_dedicated_plugin",data:t,method:"post"})}},buy_dedicated_app_plugin:class e extends f.Call{get _must_proxy(){return true}build(e,t){if(d.on_client()||v.plugins_live_here){throw new d.UnexpectedError("This should never happen, this should be done on dedicated")}return S({path:"plugins/buy_dedicated_app_plugin",data:t,method:"post"})}},get_dedicated_stripe_plan:class e extends f.Call{get _must_proxy(){return true}build(e,t){if(d.on_client()||v.plugins_live_here){throw new d.UnexpectedError("This should never happen, this should be done on dedicated")}return S({path:"plugins/get_dedicated_stripe_plan",data:t,method:"post"})}},get_plugins_tags:class e extends f.Call{get _must_proxy(){return true}get human(){return"Get plugin categories"}get value_id(){return"text"}get is_list(){return true}get parameters(){return{tag_type:{}}}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}return Object.values(plugin_consts.PLUGIN_TAGS[t.tag_type]||{})}},get_template_categories:class e extends f.Call{get human(){return"Get template categories"}get value_id(){return"text"}get is_list(){return true}execute(){return M}},create_plugin_review:class e extends f.Call{get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}if(v.plugins_live_here){return template_plugin_reviews.create_review(t)}else{return super.execute(e,t,n)}}build(e,t,n){return S({path:"plugins/create_review",data:t,method:"post"})}},modify_plugin_review:class e extends f.Call{get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}if(v.plugins_live_here){return template_plugin_reviews.modify_review(t)}else{return super.execute(e,t,n)}}build(e,t,n){return S({path:"plugins/modify_review",data:t,method:"post"})}},delete_plugin_review:class e extends f.Call{get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}if(v.plugins_live_here){return template_plugin_reviews.delete_review(t)}else{return super.execute(e,t,n)}}build(e,t,n){return S({path:"plugins/delete_review",data:t,method:"post"})}},get_current_user_review:class e extends f.Call{get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}if(v.plugins_live_here){return template_plugin_reviews.get_current_user_review(t)}else{return super.execute(e,t,n)}}build(e,t,n){return S({path:"plugins/get_current_user_review",data:t})}},get_raw_plugin:class e extends f.Call{get _must_proxy(){return true}execute(t,n,r,i,s){var o;if(d.on_client()){throw new d.UnexpectedError("get_raw_plugin called on client")}if(!((o=v.meta_api_endpoint_key)!=null?o:"").split(",").includes(r==null?void 0:r.key)){throw new d.Unauthorized(null,"Invalid key")}if(n.version!=="current"){return fiber_cache.with_cache(`user_plugin:from_s3_${d.json_stringify(n)}`,(()=>{if(v.plugins_live_here){return plugin_lib.get_raw_plugin(n)}else{try{const e=plugin_lib.get_cached_plugin_from_s3_dedicated(n.plugin_id,n.version);if(e){return plugin_lib.parse_plugin(e,n.version)}}catch(e){if(e!==plugin_lib.NO_DATA_MESSAGE_DEDICATED){throw e}}const i=Object.getPrototypeOf(e).prototype.execute.call(this,t,n,r);plugin_lib.save_plugin_to_s3_dedicated(n.plugin_id,n.version,i.plugin_data);return i}}))}else{if(v.plugins_live_here){return plugin_lib.get_raw_plugin(n)}else{return super.execute(t,n,r)}}}build(e,t,n){return D({path:"plugins/get_raw_plugin",data:t,method:"post"})}},get_plugin_current_etag:class e extends f.Call{get _must_proxy(){return true}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}if(v.plugins_live_here){return plugin_lib.get_plugin_current_etag(t)}else{return super.execute(e,t,n)}}build(e,t,n){return{path:"plugins/get_plugin_current_etag",data:t,method:"post"}}},get_plugin_call_list:class e extends f.Call{get human(){return"Get plugin calls list"}get _must_proxy(){return true}get value_id(){return"text"}get is_list(){return true}get parameters(){return{plugin_id:{}}}execute(e,t,n,r,i){if(d.on_client()){return super.execute(e,t,n,r,i)}return plugin_lib.get_plugin_call_list(t.plugin_id)}},get_user_app_permissions:class e extends f.Call{get _must_proxy(){return true}build(e,t,n){return S({path:"bubble/get_user_app_permissions",data:t,method:"post"})}},mark_user_last_release:class e extends f.Call{get _must_proxy(){return true}execute(e,t,n,r,i){if(!v.is_dedicated){const e=h().current_user();if(e.is_logged_in()){return e.child("last_release_note_date").set(Date.now())}}}},get_raw_template_data:class e extends f.Call{get _must_proxy(){return true}build(e,t,n){return{path:"plugins/get_raw_template_data",data:t,method:"post"}}},get_experiment:class e extends f.Call{constructor(){super(...arguments);this.execute=this.execute.bind(this)}get human(){return"Get experiment group"}get value_id(){return"number"}get parameters(){return{experiment_name:{editor:"ShortText",value:"text",caption:"Experiment name"},number_of_groups:{editor:"Basic",value:"number",caption:"Number of groups"}}}execute(e,t,n,r,i){return h().experiment(t.experiment_name,t.number_of_groups)}},get_appname_validation_regex:class e extends f.Call{get human(){return"Get appname validation regex"}get value_id(){return"text"}execute(e,t,n,r,i){return y.LABEL_REGEX.source}}}}get server_actions(){return["handle_template_sale","handle_affiliate_marketplace","monitor_bought_capacity","submit_template","publish_template","remove_once_paid_plugin","approve_plugin","compute_mrr","mark_draft_invoices_as_collectable","disable_2fa_admin","batch_flag_apps","batch_take_down_apps","undo_keyword_app_flag","df","new_application","duplicate_application","forking_application","upgrade_app_to_enterprise","notify_custom_plan_changed","set_app_additional_storage","upgrade_app_plan","downgrade_app_to_free","set_additional_capacity_on_app","delete_application","copy_hardcoded_to_account","save_app_plan","save_apps_plan","notify_workload_credits_changed","test_showcased_apps","duplicate_plugin","fork_plugin","convert_into_template","add_sub_user","add_user_to_org","add_enterprise_owner_as_app_admin","cancel_agency","check_appname_availability"]}base_url(){return v.meta_api_endpoint}get_error_message(e){if(e.statusCode>=400&&e.statusCode<=500){var t,n;let r;try{r=JSON.parse(e.body)}catch(e){return}if(r.error_class!=null){const t=errors.from_json_client(r);t.statusCode=e.statusCode;throw t}else if((t=r)!=null&&(n=t.error)!=null&&n.message){return"Error connecting to Bubble Plugin: "+r.error.message}}}};function S(e){if(v.is_dedicated){const n=h().current_user().child("authentication").child("appconnector-bTGMG").child("access_token").get();if(!n){return e}else{var t;(t=e.headers)!=null?t:e.headers={};e.headers.Authorization="Bearer "+n}}return e}function D(e){if(v.meta_api_endpoint_key){var t;(t=e.headers)!=null?t:e.headers={};const n=v.meta_api_endpoint_key.split(",")[0];e.headers.Authorization="Bearer "+n}return e}const C=p.safe_require("./services/shared/plugin_registry");C.register_plugin("bubble_plugin",a)},{"core-js/modules/web.dom-collections.iterator.js":1123}],753:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("./u");function i(e,t){var n;(n=t.inset)!=null?n:t.inset="";const r=`${t.horizontal}px ${t.vertical}px ${t.blur}px ${t.spread}px ${t.color} ${t.inset}`;e.css({"-webkit-box-shadow":r,"-moz-box-shadow":r,"box-shadow":r})}function s(e){let t=e.data("__outline_stack");if(!t){t=[];e.data("__outline_stack",t)}return t}function o(e,t){s(e).push(t)}function a(e,t){let n;const i=s(e);const o=i.filter((e=>e.key===t));for(n of o){r.array_remove(i,n)}}function l(e){let t=null;let n=-2;for(const r of s(e)){if(r.priority>n){n=r.priority;t=r}}return t}function c(e){const t=l(e);u(e,t)}function u(e,t){var n;if((n=!(t!=null&&t.box_shadow_properties))!=null?n:false){e.css({"-webkit-box-shadow":"none","-moz-box-shadow":"none","box-shadow":"none"})}else{i(e,t.box_shadow_properties)}}n.add_outline=function(e,t,n,r,i,s,l,u){let d;if(!e){console.log("called add_outline without a div");return}if(i===undefined){d=r}else{d={horizontal:r,vertical:i,blur:s,spread:l,color:u}}a(e,t);o(e,{key:t,priority:n,box_shadow_properties:d});c(e)};n.remove_outline=function(e,t){if(!e){return}a(e,t);c(e)};n.get_default_shadow=function(e){if(!e){throw new r.UnexpectedError("called get_default_shadow without a div")}for(const t of s(e)){if(t.key==="default"){return t.box_shadow_properties}}}},{"./u":823,"core-js/modules/web.dom-collections.iterator.js":1123}],754:[function(e,t,n){"use strict";const r=n;const i=e("./lib");const s=e("./shared/slug");r.get_page_thing_id=e=>{var t;const n=e.get_unique_id_in_url();if(n!=null){return n}const i=r.get_unique_id_from_slug_in_url(e);if(i!=null){return i}const{path:s}=e.get_pieces();if(s&&s[1]!=null){return s[1]}return(t=e.get_query())==null?void 0:t.id};r.page_has_a_thing=e=>{if(e.get_unique_id_in_url()!=null||e.get_slug_in_url()!=null){return true}return false};r.get_unique_id_from_slug_in_url=e=>{const t=e.get_slug_in_url();if(t!=null){var n,r;const o=(n=i().app().get_page_by_name(e.get_underlying_page()))==null?void 0:n.get_static_property("page_item_type");const a=(r=s.get_thing_id_from_slug({appname:i().appname(),app_version:i().app_version(),type:o,slug_value:t}))!=null?r:null;return a}return null};r.get_page_thing=e=>i().db_instance().get(r.get_page_thing_id(e))},{"./lib":741,"./shared/slug":808}],755:[function(e,t,n){"use strict";e("core-js/modules/es.error.cause.js");e("core-js/modules/web.dom-collections.iterator.js");const r=e("./u/shared/b_object");const i=e("./u/shared/incremental");const s=e("./u/shared/errors");const o=e("./u/shared/async/b_fiber");const a=e("./constants/special_keys");const l=e("./lang/btypes");const c=e("./geolocation/b_location");const u=e("./lib");const d=n;d.is_list=_;d.row_to_object=h;class p extends Error{constructor(e,t){super(e);this.message=e;this.args=t;this.stack=s.capture_stack(`${this.error_class} ${this.message}`,1);if(!this.args||typeof this.args!=="object"){this.args={}}}}d.ParseError=p;function _(e){return e.is_list()||["number_range","date_range"].includes(e.id())}const f=/^\s*\[((?:[^[\]]|\[[^\]]*\])*)\]\s*$/;function h(e){let{row:t,list_delimiters:n,field_names:s,field_btypes:d,composite_fields:h,db_instance:m,type:g,modify_mode:v}=e;function b(e,t,n){if(t==="_id"){if(typeof n!=="string"||n===""){throw new p(`Invalid id ${n}. Must be a non-empty string!`)}const t=m.get(n);if(t&&t._type()===e){return t}else{throw new p(`We found 0 entries with the value ${n} in the table of ${l.get(e).display()}`)}}const r=[{key:t,constraint_type:"equals",value:n}];const i=m.find(e,r);const s=i.get_children(0,2);if(s.length!==1){throw new p(`We found ${s.length} entries with the value ${n} in the table of ${l.get(e).display()}`)}else{return s[0]}}function y(e,t){const y=s[e];const w=l.get(d[e]);function x(e,t,n){if(v&&y===a.UNIQUE_ID){const t=m.get(e);if(!(t!=null&&t.exists())){if(m._get_ready_key(e).is_turned()){throw new p(`${e} does not exist in the database`)}return}if(t._type()!==g){throw new p(`${e} does not have the right type in the database`)}}if(n.id()==="date"){if(isNaN(e==null?void 0:e.getMonth())){throw new p(`${t} doesn't have the type date`)}}else if(n.id()==="number"){if(e!==Number(t)){throw new p(`${t} doesn't look like a real number`)}}else if(n.id()==="boolean"){const n=u().get_text("BUILT_IN","YES").toLowerCase();const r=u().get_text("BUILT_IN","NO").toLowerCase();const i=e===true&&!["true","yes",n].includes(t==null?void 0:t.toLowerCase());const s=e===false&&!["false","no",r].includes(t==null?void 0:t.toLowerCase());const o=e===null&&![null,undefined,""].includes(t);if(i||s||o){throw new p(`${t} doesn't look like a real boolean, new_val: ${e}`)}}else if(n.option_set()!=null){if(e!=null&&n.option_set().value(e).display()!==t||e==null&&t!==""){throw new p(`${t} is not a valid option for set ${n.display()}`)}}else{if(r.json_stringify(e)!==r.json_stringify(t)&&String(e)!==t.trim()){throw new p(`${t} doesn't have the type ${n.display()}`)}}}let j;if(w.id()==="geographic_address"){j=c.from_address(t,true);if(j===null&&t!=null){throw new p(`${t} is not recognized as an address`)}}else{if(_(w)){function A(t,r){let s;if(t.id()==="number_range"){s=l.get("number")}else if(t.id()==="date_range"){s=l.get("date")}else{s=t.inner()}if(_(s)){const e=/\[[^[\]]*\]/g;const t=[];let n;while((n=e.exec(r))!=null){t.push(A(s,n[0]));if(t.length%10===0){o.optional_pause()}}return t}else{var a,c;r=(a=(c=f.exec(r))==null?void 0:c[1])!=null?a:r;const t=i.incremental_map(r.split(n[e]),(e=>e.trim()));if(s.custom_type()!=null){const n=h[e];for(const e of t){if(n==="_id"){var u;(u=m.get(e))==null?void 0:u.precache()}}return t.map((e=>b(s.id(),n,e)))}else{return i.incremental_map(t,(e=>{const t=s.from_human(e);x(t,e,s);return t}))}}}j=A(w,t)}else if(w.custom_type()!=null){const M=h[e];j=b(w.id(),M,t)}else{j=w.from_human(t);x(j,t,w)}}return{bubble_field:y,bubble_val:j}}const w=Object.entries(t!=null?t:{}).filter((e=>{let[t,n]=e;return s[t]&&n&&n!==""})).map((e=>{let[t,n]=e;const r=y(t,n);return[r.bubble_field,r.bubble_val]}));return Object.fromEntries(w)}},{"./constants/special_keys":87,"./geolocation/b_location":621,"./lang/btypes":653,"./lib":741,"./u/shared/async/b_fiber":833,"./u/shared/b_object":839,"./u/shared/errors":846,"./u/shared/incremental":848,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123}],756:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");var r,i,s;function o(e,t,n,r,i){var s={};Object.keys(r).forEach((function(e){s[e]=r[e]}));s.enumerable=!!s.enumerable;s.configurable=!!s.configurable;if("value"in s||s.initializer){s.writable=true}s=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),s);if(i&&s.initializer!==void 0){s.value=s.initializer?s.initializer.call(i):void 0;s.initializer=undefined}if(s.initializer===void 0){Object.defineProperty(e,t,s);s=null}return s}const a=n;const l=e("base64url");const c=e("./u");const u=e("./u/shared/b_object");const d=e("./u/shared/errors");const p=e("./u/shared/mode_check");const _=e("./u/shared/async/b_async");const f=e("./u/shared/async/autorun");const h=e("./u/client/b_ui");const m=e("./u/shared/incremental");const g=e("./lang/caching");const v=e("./external");const b=e("./apiconnectorbase");const y=e("./lib");const w=e("./lang/appquery");const x=e("./pv/plugin_versioning");const j=e("./core/property_applications");const A=e("./core/core_actions");const M=e("./core/shared_fields");const E=e("./core/core_elements/shared/inputs");const k=e("./core/core_elements/core_elements_utilities/element_workflows");const O=e("./lang/btypes");const S=e("./core/widgets");const D=e("./core/widgets/fileupload");const C=e("./geolocation/b_location");const T=e("./services/shared/service_type_parser");const N=e("./logger");const P=e("./constants/plugin");const I=e("./shared/external_api_utilities");const R=e("./shared/responsive/responsive_layout");const L=e("./lang/evaluation/element_eval");const z=e("./lang/evaluation/element_props");const B=e("./u/shared/decaf");const q=e("./lang/btype_ids");const U=/function\(([\w,\s?]*)\)/;const F=e("./lang/color_tokens");const{displayableInListBtypes:W}=e("./lang/btypes_dropdowns");a.MAX_LENGTH_SERVER_SIDE=2e6;a.MAX_LENGTH_PACKAGE=5e5;a.PREDEFINED_BTYPE_TYPES=["text","number","number_range","boolean","image","file","geographic_address","date","date_range","user"];const G={};a.get_plugin_execution_time=function(){return G};a.can_use_message=function(e,t){const n=O.get(e);const r=n.get_message(t);return(r.is_lookup()||r.public_for_plugins())&&!r.is_not_found()};a.get_ListProperties=function(e){const t=O.get(e);return t.plugin.get_message_names().filter(m.with_pause_tick((t=>a.can_use_message(e,t))),5)};const V={StaticText:true,StaticNumber:true,Checkbox:true,Color:true,Dropdown:true,Image:true,key_value_list:false};const H={text:true,number:true,boolean:true,image:true,file:true,geographic_address:false};a.property_uses_default=function(e,t,n){var r;if(V[e]!=null){return V[e]}if(n){return false}return(r=H[t])!=null?r:false};a.extract_code=function(e,t){var n,r,i;e=(n=e)==null?void 0:n.trim();const[s,o]=(r=(i=e)==null?void 0:i.match(U))!=null?r:[];let a=e.split(s).slice(1).join(s);a=a.split("{").slice(1).join("{").split("}").slice(0,-1).join("}");a+=`\n//# sourceURL=${P.PLUGIN_CODE_SRC_PREFIX}${t.replace(/[^\w/]/g,"-")}.js`;return{vars:o,code:a}};a.create_code=function(e,t,n,r){const i=Date.now();try{var s;let{vars:n,code:o}=a.extract_code(e,t);if(r){o=r(o)}const l=new Function(n,o);const c=Date.now();G[`${t}`]=(s=G[`${t}`])!=null?s:0;G[`${t}`]+=c-i;return function(){const e=Date.now();try{return l(...arguments)}finally{const n=Date.now();G[`${t}`]+=n-e}}}catch(e){n(e);return null}};a.get_keys=function(e,t,n){const r={};switch(e==null?void 0:e.auth){case"private_key_url":case"private_key_header":Object.assign(r,{appsecret:{caption:"API Key",type:"secure"}});break;case"oauth2_pw":case"basic_auth":Object.assign(r,{appid:{caption:"Username",type:"client_safe"},appsecret:{caption:"Password",type:"secure"}});break;case"jwt":Object.assign(r,{iss:{caption:"Iss (account email)",type:"client_safe"},private_key:{caption:"Private key (between -----BEGIN RSA PRIVATE KEY----- and -----END RSA PRIVATE KEY-----)",type:"secure",editor:"MultilineTextBox"}});break;case"cert_key":Object.assign(r,{cert_file:{caption:"Certificate file content",type:"secure",editor:"MultilineTextBox"},key_file:{caption:"Key file content",type:"secure",editor:"MultilineTextBox"}});break;case"oauth2_custom":{for(const t of["body_params","headers"]){for(const n in(i=e.calls)==null?void 0:(s=i.token_call)==null?void 0:s[t]){var i,s,o,a;const{key:l,visibility:c}=(o=e.calls)==null?void 0:(a=o.token_call)==null?void 0:a[t][n];if(l!=null&&c==="secret"){const e=b.user_friendly_parameter_names[t];Object.assign(r,{[`token_call_${t}_${n}`]:{caption:`${l} ${e} (token call)`,type:"secure"}})}}}break}case"oauth2_user":Object.assign(r,{appid:{caption:"App ID/API Key",type:"client_safe"},appsecret:{caption:"App Secret",type:"secure"}});break}for(const e in t==null?void 0:t.params){const{key:n}=t==null?void 0:t.params[e];Object.assign(r,{[`header_${e}`]:{caption:n+" (headers)",type:"client_safe"}})}Object.assign(r,n);for(const t of["shared_headers","shared_params"]){for(const n in e==null?void 0:e[t]){const i=e==null?void 0:e[t][n];if((i==null?void 0:i.visibility)==="secret"&&i.key){r[t+"_"+n]={caption:i.key+" "+b.user_friendly_parameter_names[t],type:"secure"}}}}for(const t in e==null?void 0:e.calls){const n=e==null?void 0:e.calls[t];if(n.initialized&&t!=="token_call"){for(const e of["url_params","headers","params","body_params"]){for(const i in n[e]){const s=n[e][i];if((s==null?void 0:s.visibility)==="secret"&&s.key){r[t+"_"+e+"_"+i]={caption:n.name+" - "+s.key+" "+b.user_friendly_parameter_names[e],type:"secure"}}}}}}return r};let X=false;function Y(e){try{var t;X=true;return e==null?void 0:(t=e.__original)==null?void 0:t.call(e)}finally{X=false}}a.api_key_prefix="_p_";const K={};const J={};const Z={};function Q(e){var t,n;let{file:r,fileName:i,contents:s,attach_to:o}=e;const a=r?r.name+"_"+r.lastModified:i+"_"+s;return a+"_"+((t=Y(o))==null?void 0:(n=t._id)==null?void 0:n.call(t))}function ee(e,t){var n;const r=e+"_"+Q(t);if(K[r]){var i;(i=t.callback)==null?void 0:i.call(t,null,K[r]);return}(n=J[e])!=null?n:J[e]=[];J[e].push(t);te(e)}function te(e){if(!Z[e]&&J[e].length){const t=J[e][0];const{file:n,fileName:r,contents:i,callback:s,attach_to:o,callback_progress:a,instance:l}=t;const c=e+"_"+Q(t);function u(){J[e]=J[e].slice(1);if(J[e].length<50){Z[e]=false;te(e)}else{setTimeout((()=>{Z[e]=false;te(e)}),1e3*J[e].length*100)}}if(K[c]){s==null?void 0:s(null,K[c]);u()}else{Z[e]=true;function p(e){if(o){var t,n;const r=(t=Y(o))==null?void 0:(n=t._id)==null?void 0:n.call(t);if(!r){const t=new d.UnexpectedError("Trying to attach an upload to a non Bubble thing");e(t);throw t}else{e(null,{attach_to:r})}}else{e(null,{})}}function _(t){K[e+"_"+r+"+"+i]=t;s==null?void 0:s(null,t);u()}const f=undefined;function h(e){s==null?void 0:s(e);u()}if(n){D.upload_file(n,l,p,_,f,h,(e=>a==null?void 0:a(e)))}else{S.upload_file({contents:i},undefined,p,_,f,h,undefined,r)}}}}let ne=(r=g.cached({type:g.AUTORUN}),i=g.cached({type:g.AUTORUN}),s=class e extends v.Service{calls(){const e={};const t=this.get_api();const{name:n}=this;if(t.auth==="oauth2_user"){e.oauth_user_data_call=class e extends v.Call{get human(){return t.human}get _must_proxy(){return true}get value_id(){return q.api_type(`${n}.oauth_profile`)}build(e,n){const r=t.oauth_user_data_call;return{path:r}}}}for(const n in t.calls){const r=t.calls[n];e[n]=r;if(this.is_testing()){e[n].api_human=t.human+" (testing)"}else{e[n].api_human=t.human}e[n].api_id=this.name}return e}get_call_class(e){const t=this.calls()[e];if(e==="oauth_user_data_call"){return t}return b.get_call_from_raw(e,t)}handle_request_failures(e){return I.handle_request_failures(e)}get_error_message(e,t){return b.get_error_message(e,t,true)}get dynamic_calls(){return true}constructor(e,t,n){var r;super();this.name=e;this.version=t;this.raw=n;this.human=(r=this.raw.human)!=null?r:this.get_api().human;if(this.is_testing()){this.human+=" (testing)"}this.pv=x.get_pv(this.get_plugin_api_version())}get_plugin_api_version(){var e;const t=(e=this.raw.dependencies)==null?void 0:e.plugin_api_version;if(t){return String(t)}return"0"}is_testing(){return this.version==="current"}response_to_data(e,t,n,r){var i;(i=n)!=null?i:n="json";const s=super.response_to_data(e,t,n,r,r==null?void 0:r.wrap_error);if(r!=null&&r.get_headers||r!=null&&r.wrap_error){const{headers:e}=t;return{body:s,headers:e}}return s}get_api(){if(!this._processed_raw_api){var e;this._processed_raw_api=u.deep_copy((e=this.raw.plugin_api)!=null?e:{});const t=T.get_plugin_id(this.name);const n=new RegExp(t,"g");for(const e in this._processed_raw_api.calls){const t=this._processed_raw_api.calls[e];for(const e of["types","data_container"]){if(t[e]&&typeof t[e]==="string"){if(this.is_testing()&&e==="types"){t[e]=t[e].replace(n,this.name)}t[e]=u.json_parse(t[e])}}}}return this._processed_raw_api}has_html_header(){var e,t;return((e=(t=this.get_html_header())==null?void 0:t.snippet)!=null?e:"")!==""}get_html_header(){return this.raw.html_header}get_keys(){var e,t;const n=a.get_keys(this.get_api(),this.get_html_header(),this.raw.shared_keys);(e=(t=this.get_authenticator()).add_generic_authenticator_keys)==null?void 0:e.call(t,n);return n}get_keys_for_context(){const e={};const t=this.get_keys();for(const n in t){const{caption:r}=t[n];const i=this.get_key(n);if(i!=null){e[r]=i}}return e}authenticator(){const e=this.get_api();let t;switch(e.auth){case null:case undefined:case"none":t=new v.NoAuth;break;case"private_key_url":case"private_key_header":if(!e.token_param_name){if(e.auth==="private_key_url"){e.token_param_name="private_key"}else{e.token_param_name="Authorization"}}t=new v.PrivateKey(b.get_private_key_auth_params(e));break;case"basic_auth":t=new v.BasicAuth;break;case"oauth2_pw":t=new v.Oauth2PWFlow(b.get_oauth2_pw_auth_params(e));break;case"oauth2_custom":t=new v.Oauth2Custom;break;case"jwt":t=new v.JWT(b.get_jwt_auth_params(e));break;case"cert_key":t=new v.SSLProtocol;break;case"oauth2_user":{const n={...b.get_oauth2_user_auth_params(e),_id:this.name};t=new v.Oauth2(n)}}t._service=this;t._display=e.human;t.add_shared_params_and_headers=t=>{b.add_shared_params_and_headers(e,t,this.name,((e,t)=>{if(t.visibility==="secret"){return this.get_key("shared_headers_"+e)}else{return t.value}}),((e,t)=>{if(t.visibility==="secret"){return this.get_key("shared_params_"+e)}else{return t.value}}))};return t}public_values(){return B.object_values(this.get_api().calls).filter((e=>e.publish_as==="data"&&e.initialized)).flatMap((e=>B.object_keys(e.types)))}values(){const e={};const t=this.get_api();if(t.auth==="oauth2_user"){e.oauth_profile=new v.StructValue("Profile "+t.human,{id:{path:t.id_path!=null?t.id_path.split("."):undefined},email:{path:t.email_path!=null?t.email_path.split("."):undefined}})}b.get_btypes_from_call(this.name,t,e,a.api_key_prefix);for(const n of Object.values(e)){n.human+=" ("+t.human+")"}return e}_get_sorted_list(e){return B.object_entries(this.get_api().calls).filter((t=>{let[n,r]=t;return r.publish_as===e&&b.is_call_initialized(r)})).map(((e,t)=>{var n;let[r,i]=e;return{call_id:r,rank:(n=i.rank)!=null?n:t}})).sort(((e,t)=>e.rank-t.rank)).map((e=>{let{call_id:t}=e;return t}))}public_calls(){return this._get_sorted_list("data")}action_calls(){return this._get_sorted_list("action")}user_calls(){const e=this.get_api();if(e.auth==="oauth2_user"){return["oauth_user_data_call"]}else{return[]}}oauth_providers(){const e=this.get_api();if(e.auth==="oauth2_user"){return[{id:this.name,display:e.human}]}else{return[]}}base_url(){return""}_get_processed_elements_raw(){if(!this._processed_raw_elements){this._processed_raw_elements=this._interpret_raw_plugin_def()}return this._processed_raw_elements}actions(){return this._get_processed_elements_raw().actions}elements(){return this._get_processed_elements_raw().elements}events(){return this._get_processed_elements_raw().events}_interpret_raw_plugin_def(){var e;const t={};const n={};const r={};const i=this.version;const s=this.name;const o=this.human;const m=this.pv;function g(e,t,n){var r;let i;(r=t)!=null?r:t="null";if(t.startsWith("custom_data_")){if(t.startsWith("custom_data_element_")){const n=w.element(e.get_static_property("element_id"));if(n!=null&&n.exists()){i=n.get_static_property(t.split("custom_data_element_")[1])}}else{i=e.get_static_property(t.split("custom_data_")[1])}}else if(t==="_any_thing"){if(n){return"list*"}else{return O.any}}else if(t==="_any_thing_bindable"){if(n){return"list*bindable"}else{return O.compound}}else{i=t}if(typeof i!=="string"){return"null"}if(n){return q.list_type(i)}else{return i}}function v(e,t){const{fields:n,support_autobinding:r,autobinding_value:i,add_large_file_upload_properties:s}=e;const o={};if(t){o.element_id={}}for(const e in n){const t=n[e];const{caption:r,editor:i,optional:s,in_style:l,value:c,is_list:u}=t;let{default_val:d}=t;if(!a.property_uses_default(i,c,u)){d=null}if(r&&i){o[e]={};if(s){o[e].optional=s}if(d!=null){o[e].default=d}if(["custom_type","Label"].includes(i)||i.indexOf("custom_field_")===0){o[e].no_states=true}if(["StaticText","StaticNumber","Checkbox","Color","Dropdown","Image"].includes(i)&&l){o[e].in_style=true}}}if(r&&i){Object.assign(o,E.get_auto_binding_field_names)}if(s){Object.assign(o,E.get_max_file_size_field_name);Object.assign(o,E.get_file_upload_condition_field_name)}return o}function b(e,t,n,r,i,s){let o,l,c;if(a.PREDEFINED_BTYPE_TYPES.includes(t)){if(n){o="Basic";t=q.list_type(t)}else{if(t==="text"){if(r){o="LongText"}else{o="ShortText"}}else if(t==="image"){o="DynamicImage"}else if(t==="file"){o="DynamicFile"}else{o="Basic"}}}else if(t){o="Basic";if(t.indexOf("custom_data_")===0){let n,r;if(t.indexOf("custom_data_element_")===0){r=w.element(i.get_static_property("element_id"));n=t.split("custom_data_element_")[1]}else{r=i;n=t.split("custom_data_")[1]}c={property_modifier(e){return M.set_group_type_list_elements(r,e,n)},generate_message(e){return M.get_generate_message_list_elements(r,e,n,"this element's data type","setting")}};if(!s){c.no_need_to_show_message=()=>M.no_need_to_show_message_container_elements(i,e)}}t=g(i,t,n);l=e=>t!=null}return{editor:o,value:t,condition:l,value_setter:c}}function x(e,t,n){let{fields:r,support_autobinding:i,autobinding_value:s,autobinding_is_list:o,add_large_file_upload_properties:l}=t;const c=[];if(i&&s){let t;if(o){t=[q.list_type(s)]}else{t=[s]}c.push(...M.get_binding_properties(e,t))}if(l){c.push(...M.get_max_file_size_property());c.push(...M.get_file_upload_condition_property()||[])}const u=B.object_entries(r).map(((e,t)=>{var n;let[r,i]=e;return{field_id:r,field_data:i,rank:(n=i.rank)!=null?n:t}})).filter((e=>{let{field_data:{caption:t,editor:n}}=e;return t&&n})).sort(((e,t)=>e.rank-t.rank)).map((t=>{let{field_id:r,field_data:i}=t;const{caption:s,options:o,is_list:l,long_text:c,field_list:u,doc:d}=i;let{editor:p,field_type_restriction:_,value:f}=i;const h={name:r,caption:s};if(!n){h.pretty={section:"PluginElement"}}let m,g,v,x,j,A,M;if(p==="Label"){h.label_text=s;h.name="information";delete h.caption}else if(["StaticText","StaticNumber","Checkbox","Color","Dropdown","Image"].includes(p)){if(p==="StaticText"&&c){p="StaticMultiLineText"}if(p==="Dropdown"){var E;g=y().sets.get_set("List")((E=o==null?void 0:o.split(","))!=null?E:[],undefined,true)}if(p==="Color"){m=true}}else if(p==="key_value_list"){p="ObjectList";v="Set another key / value";const e=b(r,f);x="generic_object_list";j=()=>[{name:"key",editor:"StaticText"},{name:"action",editor:"Label",label_text:" = "},{name:"value",editor:e.editor,value:e.value}]}else if(p==="custom_type"){p="Dropdown";if(w.has_feature_enabled("reorg_component_selection")){g=W()}else{g=y().sets.get_set("DisplayableInListValues")(true)}}else if(p.startsWith("custom_field_")){const t=p.split("custom_field_")[1];const n=e.get_static_property(t);p="Dropdown";if(_){if(_==="text_image_file"){_=["text","image","file"]}else{_=[_]}if(u){_=_.map((e=>q.list_type(e)))}g=y().sets.get_set("Filtered")(y().sets.get_set("MessagesWithoutArguments")({btype_name:n,btypes_to_filter_out:["sys.bool"]}),(e=>{if(!a.can_use_message(n,e.value)){return false}const t=O.get(n).get_message(e.value);return _.includes(t.ret_btype().id())}))}else{g=y().sets.get_set("Filtered")(y().sets.get_set("MessagesWithoutArguments")({btype_name:n,btypes_to_filter_out:["sys.bool"]}),(e=>a.can_use_message(n,e.value)))}A=e=>{var n;return e.get_static_property(t)!=null&&((n=window)!=null&&n.composer_revamp?g.all().length:g.get_options().length)}}else{const t=b(r,f,l,c,e,n);p=t.editor;f=t.value;A=t.condition;M=t.value_setter}if(!p){return null}h.editor=p;if(f!=null){h.value=f}if(g!=null){h.set=g}if(A!=null){h.condition=A}if(v!=null){h.button_caption=v}if(j!=null){h.sub_properties=j}if(x!=null){h.additional_class=x}if(m!=null){h.dynamic=m}if(M!=null){h.value_setter=M}if(d!=null){h.plugin_doc=d}return h})).filter((e=>e!==null));c.push(...u);return c}const S=(e,t)=>{let{fn:n,add_debugger:r}=e;if(y().is_edit_mode()){throw new d.UnexpectedError("running plugin code in edit mode!!!!")}if(p.on_server()){throw new d.UnexpectedError("running plugin code on the server!!!! TO REMOVE WHEN WE HAVE SERVER ACTIONS")}return a.create_code(n,`${s}/${o} ${t}`,(e=>{const r="WARNING: Error parsing plugin code for "+t+". Please check \n"+(n!=null?n:"missing function");const i=r.slice(0,8191);N.owner_error("error parsing plugin code",{display:i,original_error:e})}),(e=>{if(i==="current"&&r){e="  debugger; // Debugger entry point for Bubble Plugin // \n"+e}return e}))};const D=(e,t,n,r)=>{try{return t()}catch(t){var s,o,a,l,c,u;if(t instanceof d.NotReadyError){throw t}let m="The plugin "+this.display();if(n==="element"&&((s=e.element)==null?void 0:(o=s.E)==null?void 0:o.display)!=null){var p,_;m+=" / element "+((p=e.element)==null?void 0:(_=p.E)==null?void 0:_.display)}else if(n==="action"&&((a=e.A)==null?void 0:(l=a.display)==null?void 0:l.call(a))!=null){var f,h;m+=" / action "+((f=e.A)==null?void 0:(h=f.display)==null?void 0:h.call(f))}m+=" threw the following error: ";m+=((c=(u=t.stack)!=null?u:t.message)!=null?c:"").split("\n").slice(0,3).join("\n");if(i==="current"){m+=" (please check your plugin's code)"}else{m+=" (please report this to the plugin author)"}const g=new d.OwnerError("plugin evaluation error",{display:m,original_error:t,element_instance:n==="element"?e:null,action:n==="action"?e:null});N.log(g);r==null?void 0:r(g)}};function T(e,t,n){if(e==null){return null}const r=e=>{var t;if(e==null){return null}if((t=e._type)!=null&&t.call(e)){var n;return(n=e._type)==null?void 0:n.call(e)}else{if(e.getTime!=null){return"date"}if(C.ensure_valid_location(e)){return"geographic_address"}else if(Array.isArray(e)){if(typeof e[0]==="number"){return"number_range"}else if(e[0].getTime!=null){return"date_range"}}else{switch(typeof e){case"string":return"text";case"number":return"number";case"boolean":return"boolean"}}}};if(typeof t==="function"){t=r(e)}else if(["list*","list*bindable"].includes(t)){var i,s;const n=(i=(s=e.all)==null?void 0:s.call(e))!=null?i:[];if(n.length===0){return{length(){return 0},get(){return[]}}}let o;for(const e of n){if(e!=null){o=e;break}}const a=r(o);if(!a){return null}t=q.list_type(a)}if(!t){return null}const o=O.get(t);const l=a.PREDEFINED_BTYPE_TYPES.includes(t)&&t!=="user";if(l){if(n&&m.fix_server_dates){if(t==="date"){var c;return{date:true,val:(c=o.get_JS_object(e))==null?void 0:c.getTime()}}else if(t==="date_range"){var u;return{date_range:true,val:(u=o.get_JS_object(e))==null?void 0:u.map((e=>e.getTime()))}}}return o.get_JS_object(e)}if(n){if(q.is_list(t)){const t=o.inner();return{list:true,val:e.all().map((e=>T(e,t.id(),true)))}}else if(q.is_option_set(t)){return o.get_JS_object(e)}else{return{object:true,type:t,val:o.get_JS_object(e)}}}else{if(q.is_list(t)){return{length(){return e.length()},get(t,n){if(t==null){throw new d.UnexpectedError("Invalid from: "+t)}if(n==null){throw new d.UnexpectedError("Invalid from: "+n)}return e.get_children(t,n).map((e=>T(e,o.inner().id())))}}}else{return{get(n){if(!n){throw new d.UnexpectedError("Invalid fieldName: "+n)}const r=o.get_message(n);if(!a.can_use_message(t,n)){throw new d.UnexpectedError("This fieldName does not exist: "+n)}return T(r.evaluate(e),r.ret_btype_id())},listProperties(){return a.get_ListProperties(t)},__original(){if(!X){throw new d.UnexpectedError("Forbidden function")}return e}}}}}function P(e,t,n,r,i,s){if(!r){if(n==="Color"){return F.color_property_to_rgba(e)}return e}if(n==="custom_type"){return O.get(e).display()}if(n!=null&&n.indexOf("custom_field_")===0){const r=t.get_static_property(n.split("custom_field_")[1]);const i=O.get(r).get_message(e);if(i.is_not_found()){return null}return i.name()}if(n==="key_value_list"){return B.object_values(e).map((e=>{delete e.action;e.value=T(e.value,r,s);return e}))}return T(e,g(t,r,i),s)}function I(e,t,n,r){const i={};for(const s in n){const{name:o,value:a,is_list:l,editor:c}=n[s];i[o]=P(t[s],e,c,a,l,r)}return i}const U=(e=this.raw.dependencies)==null?void 0:e.use_jquery;const G={};const V={};const H={};const K=e=>{let{instance:t,action:n,bubble_context:r}=e;const i={currentUser:P(y().current_user(),undefined,undefined,"user")};if(U){i.jQuery=$}i.uploadContent=(e,t,n,r)=>{if(!t){return null}ee(s,{fileName:e,contents:t,callback:n,attach_to:r});return null};i.keys=this.get_keys_for_context();i.async=function(e){var n,i;const s=e.toString()+((n=t==null?void 0:t.toUniqueString())!=null?n:r==null?void 0:r.run_id);if(G[s]==null){G[s]=_.MakeKey(null,"Pluginservice.context.async "+s);e(((e,t)=>{if(e){V[s]=e}else{H[s]=t}return G[s].turn()}))}_.ensure_ready(G[s]);return(i=V[s])!=null?i:H[s]};i.onCookieOptIn=function(e){if(typeof e!=="function"){N.owner_error("Calling onCookieOptIn without a function");return}return y().user.on_cookie_opt_in((()=>D(undefined,e,"general")))};i.reportDebugger=e=>N.owner_error("plugin reported a message",{display:String(e),element_instance:t,action:n});return i};const J=this;for(const he in this.raw.plugin_elements){var Z,Q,te,ne,re,ie;const me=this.raw.plugin_elements[he];const ge={is_non_hardcoded_plugin:true,display:me.display+`${(Z=J.is_testing)!=null&&Z.call(J)?" (testing)":""}`,category:me.category,icon:me.icon,get_html(){return"<div></div>"},add_an_invisible_div_on_the_top:true,is_input:false,is_container:false,change_cursor_style_if_clickable:false,mandatory_sections(){return["PluginElement"]},defaults:me.default_dim,uses_css_responsive:m.responsive_version>0,can_fit_width:me.can_fit_width,can_fit_height:me.can_fit_height};ge.field_names=v(me);ge.styleable_properties={};for(const ke in ge.field_names){const Oe=ge.field_names[ke];if(Oe.in_style){ge.styleable_properties[ke]=true}}ge._fields=e=>x(e,me);const ve=[];for(const Se in me.property_applications){const De=me.property_applications[Se];if(De&&!["resizable","Font"].includes(Se)){ve.push(new j[Se])}}if((Q=me.property_applications)!=null&&Q.resizable){ve.push(new j.Dimensions)}else{ve.push(new j.PositionOnly);ge.not_resizable=()=>true}ge.property_applications=e=>{var t;const n=[...ve];if((t=me.property_applications)!=null&&t.Font){n.push(new j.Font)}if(m.responsive_version>0){n.push(new j.ResponsiveElement(e))}return n};if((te=me.property_applications)!=null&&te.MinWidth){ge.get_min_width=()=>0}ge.dont_add_hover_pressed=!me.add_hover_pressed;ge.starts_hidden=!me.add_is_visible;const be=(ne=(re=me.headers)==null?void 0:(ie=re.snippet)==null?void 0:ie.trim())!=null?ne:"";if(be!==""){ge.element_html_header=function(){return be.replace(/\r?\n|\r/g,"")}}ge.get_states=()=>{var e;return Object.keys((e=me.states)!=null?e:{})};ge.add_specific_messages=function(e,t){for(const n in me.states){const r=me.states[n];if(r.value!=null){Object.assign(e,{[`get_${n}`]:{description:"'s "+r.caption,section:"States",ret_btype:g(t,r.value,r.is_list),fn(e,t){return this.ret_btype().cast(e==null?void 0:e.state(n))}}})}}};ge.get_state_value=function(e,t){for(const n in me.states){const r=me.states[n];if(r.value!=null){if(r.caption===t){return g(e,r.value,r.is_list)}}}};const ye=[];const we=me.has_reset_fn&&me.code.reset;if(we){ye.push("reset_input")}ge.get_messages=()=>ye;function xe(e,t,n){for(const r in n[t]){const{name:i}=n[t][r];if(i===e){return r}}}function je(e){let{thing:t,node:n,value:r,is_list:i}=e;if(t==null){return null}const s=g(n,r,i);if(q.is_list(s)){if(!Array.isArray(t)){N.owner_error("Trying to send an invalid array to Bubble",{array_sent:t,element_instance:n})}const e=O.get(s).inner().id();return t.map((t=>je({thing:t,node:n,value:e})))}const o=O.get(s);if(t.__original!=null){return Y(t)}if(o.can_JS_to_bubble()){return o.JS_to_bubble(t)}N.owner_error("Trying to convert an invalid object to Bubble",{object_sent:t,element_instance:n})}const Ae=e=>{var t;const n={};if(U){n.canvas=e.get_canvas();n.jQuery=$}else{n.canvas=e.get_canvas()[0]}n.publishState=function(t,n){const r=xe(t,"states",me);if(r){if(!me.states[r].value){N.owner_error("state does not have defined value",{display:"State "+t+" does not have a defined value",element_instance:e});return}return D(e,(()=>{const t=je({thing:n,node:e,value:me.states[r].value,is_list:me.states[r].is_list});return e.state(r,t)}),"element")}else{return N.owner_error("state is not defined in the plugin",{display:"State "+t+" is not defined in the plugin",element_instance:e})}};n.triggerEvent=(t,n)=>{const r=xe(t,"events",me);if(r){const t=k.run_element_workflow(e,s+"-"+r,undefined,undefined,undefined,true);if(n!=null){return t==null?void 0:t.callback(n)}}else{return N.owner_error("event is not defined in the plugin",{display:"Event "+t+" is not defined in the plugin",element_instance:e})}};if(m.responsive_version===0){n.setHeight=function(t){if(typeof t!=="number"||t<0||isNaN(t)){N.owner_error("Trying to set a negative or non-number height",{display:"Trying to set a negative or non-number height: "+t,element_instance:e});return}return e.set_height(t)}}if(!me.add_is_visible){n.show=function(){e.canvas[0].style.display="block";e._is_visible_me=true;return e._update_visible()};n.hide=function(){e.canvas[0].style.display="none";e._is_visible_me=false;return e._update_visible()}}(t=e._plugin_data)!=null?t:e._plugin_data={};n.data=e._plugin_data;if(me.support_autobinding&&me.autobinding_value){n.publishAutobinding=function(t){const n=je({thing:t,node:e,value:me.autobinding_value,is_list:me.autobinding_is_list});return E.run_auto_binding(e,n,true)}}if(me.add_large_file_upload_properties){n.uploadFile=(t,n,r,i)=>{if(!t){return null}ee(s,{instance:e,file:t,callback:n,attach_to:r,callback_progress:i});return null};n.canUploadFile=function(t){if(!t){return false}return L.evaluate_property(e,"file_upload_condition")&&t.size<=L.evaluate_property(e,"max_size")*1e3*1e3||false}}return n};const Me=(e,t)=>{var n;(n=t)!=null?n:t={};const{recursion_checker:r,no_sizing_props:i}=t;function s(e){if(!p.bubble[e].exists){p.bubble[e].exists=true;p.bubble[e].cache=d(e)}return p.bubble[e].cache}const o=e=>{if(i&&["width","height"].includes(e)){return 0}if(y().is_edit_mode()||!m.bubble_props_as_functions){return d(e)}return()=>s(e)};const a=e=>{var t;return((t=e.element.parent())==null?void 0:t.container_layout())===R.FIXED_LAYOUT};const l=e=>{var t;return((t=e.element.root())==null?void 0:t.get_responsive_version())===0};const c={min_width_css(e){if(l(e)){return`${e.element.get_min_width()}px`}else if(a(e)){return`${e.element.get_width()}px`}else{return z.min_width_css(e)}},max_width_css(e){if(l(e)){const t=e.element.get_max_width();if(t!=null){return`${t}px`}else{return null}}if(a(e)){return`${e.element.get_width()}px`}else{return z.max_width_css(e)}},fit_width(e){if(l(e)){return false}else{return z.is_fitting_width(e)}},min_height_css(e){if(l(e)){return"0px"}else if(a(e)){return`${e.element.get_height()}px`}else{return z.min_height_css(e)}},max_height_css(e){if(l(e)){return null}else if(a(e)){return`${e.element.get_height()}px`}else{return z.max_height_css(e)}},fit_height(e){if(l(e)){return true}else{return z.is_fitting_height(e)}},font_face(e){return z.get_font_face(e)}};const u=t=>{var n,r;return(n=(r=c[t])==null?void 0:r.call(c,e))!=null?n:L.evaluate_property(e,t)};function d(t){if(!r){return u(t)}if(r[t]){N.owner_error("Property contains circular reference to this element",{element_instance:e,prop_name:t});return null}try{r[t]=true;return u(t)}finally{delete r[t]}}const p={bubble:{}};for(const t in me.fields){const{name:n,editor:r,value:i,is_list:s}=me.fields[t];const o=d(t);p[n]=P(o,e,r,i,s)}if(me.support_autobinding&&me.autobinding_value){const t=E.get_input_parent_thing_field(e);p.autobinding=P(t,e,undefined,me.autobinding_value,me.autobinding_is_list)}const _=e.element.field_names();for(let e in _){var f;const t=_[e];if(((f=me.fields)==null?void 0:f[e])==null&&!t.only_edit_mode){if(e==="font_family"){e="font_face"}if(e==="font_weight"){continue}p.bubble[e]=o(e)}}return p};ge.can_defer_drawing=()=>true;ge.register=e=>{e.is_getting_property={};if(!e.run_mode()){return}e.initialize_fn=S(me.code.initialize,"initialize ("+me.display+")");if(we){e.reset_fn=S(me.code.reset,"reset ("+me.display+")")}const t=K({instance:e});for(const n in me.states){const{caption:r,initialization_code:i}=me.states[n];if((i==null?void 0:i.fn)!=null&&r!=null){function s(){const n=S(i,"initializeState_"+r+"("+me.display+")");const s=Me(e,{recursion_checker:e.is_getting_property});return n==null?void 0:n(s,t)}e.state(n,(()=>D(e,s,"element")))}}};ge.initialize=e=>{const t=e.get_canvas();if(!e.run_mode()){var n,r;const o=y().visual_edit;const a=$(`<div style="\nbackground-color: lightgray;\nwidth: ${me.default_dim.width}px;\nheight: ${me.default_dim.height}px;\npadding-left: ${me.default_dim.width/2-100}px;\npadding-top: ${me.default_dim.height/2-5}px;\noverflow: hidden;\n">(no plugin preview available)<div>\n`);let c=null;function u(t){e.autorun((()=>{const n=Ae(e);const r=Me(e,{no_sizing_props:m.responsive_version>0});const i={jQuery:n.jQuery!=null,responsive_mode:e.responsive_mode(),properties:r,bubble_props_as_functions:m.bubble_props_as_functions,base64_code:l.encode(me.code.preview.fn),responsive_version:m.responsive_version};if(o){o.register_plugin_preview()}y().location.post("server://appeditor/cache_iframe_content",{content:i},((n,i)=>{var s,o,a,l;if(n){N.error(n);return}let u;if((s=e.is_destroyed)!=null&&s.call(e)){return}const d=i;const{plugin_name:p}=e.element.E;const _=`${y().location.get_base_for_meta()}/appeditor/plugin_preview/${p}/${d}`;const f=(o=t!=null?t:r.bubble.height)!=null?o:me.default_dim.height;const h=(a=r.bubble.width)!=null?a:me.default_dim.width;if(m.responsive_version===0){u=`width="${h}"\nheight="${f}"`}c=$(`<iframe src="${_}"\nid='user_preview_iframe'\n${(l=u)!=null?l:""}\nsandbox="allow-scripts"\nstyle="display: block;"\n>\n(this browser does not support plugin preview rendering)\n</iframe>`);if(m.responsive_version>0){c.css({width:"100%",height:"100%",minWidth:"100%",minHeight:"100%"})}e.canvas.empty();e.canvas.append(c);const g=`<div style="width: 100%; height: 100%; position: absolute; top: 0; left: 0;"></div>`;e.canvas.append(g)}))}))}const d=t=>{if(!(o!=null&&o.can_preview_plugin())){e.canvas.empty();e.canvas.append(a)}else{u(t)}};if(((n=me.code)==null?void 0:(r=n.preview)==null?void 0:r.fn)!=null){e.autorun((()=>{var t;if(m.responsive_version>0&&((t=e.element.root())==null?void 0:t.get_responsive_version())>0){if(!z.is_fitting_height(e)){e.canvas.find("iframe").css("height","100%")}if(!z.is_fitting_width(e)){e.canvas.find("iframe").css("width","100%")}}}));window.addEventListener("message",(t=>{var n,r;if(t.source!==((n=c)==null?void 0:n[0].contentWindow))return;if(e.is_destroyed())return;if(m.responsive_version>0&&((r=e.element.root())==null?void 0:r.get_responsive_version())>0){if(t.data.height!=null&&z.is_fitting_height(e)){e.canvas.find("iframe").css({height:t.data.height})}if(t.data.width!=null&&z.is_fitting_width(e)){e.canvas.find("iframe").css({width:t.data.width})}}else if(!e.edit_mode()||e.thumbnail_mode()){if(t.data.height){e.set_height(t.data.height);if(m.responsive_version===0){d(t.data.height)}}}}));const p="function(instance, properties) {\n\n\n\n}";if(me.code.preview.fn===p){e.canvas.empty();e.canvas.append(a);return}d();return}else{const f=me.edit_mode_image;if(f){h.img("plugin-edit-placeholder",t,f)}return}}let i=Ae(e);let s=K({instance:e});if(we){e.on_message("reset_input",(()=>D(e,(()=>e.reset_fn(i,s)))))}e.wait_for_visible((()=>{var n;const r=m.responsive_version>0&&((n=e.element.root())==null?void 0:n.get_responsive_version())===0;if(r&&me.can_fit_height){t.css("height","max-content")}D(e,(()=>{var t;(t=e.initialize_fn)==null?void 0:t.call(e,i,s)}),"element");const o=S(me.code.update,"update ("+me.display+")");e.autorun((()=>{const t=Me(e);if(m.bubble_props_as_functions){for(const e in t.bubble){t.bubble[e]()}}i=Ae(e);s=K({instance:e});_.run_without_catching_not_ready((()=>D(e,(()=>o==null?void 0:o(i,t,s)),"element")))}));if(r&&me.can_fit_height){e.autorun((()=>{const t=e.current_height();e.set_height(t,{no_css_update:true});e.canvas.css("height","max-content")}))}}))};for(const Ce of["events","actions"]){var se;ge[Ce]=Object.keys((se=me[Ce])!=null?se:{}).map((e=>`${s}-${e}`))}for(const Te in me.events){const Ne=me.events[Te];n[Te]={_display(){return" "+Ne.caption},element_name:"A "+me.display}}function Ee(e,t){const n=w.element(e==null?void 0:e.element_id());const r=n?n.get_name():`a ${me.display}`;return`${t} ${r}`+`${J.is_testing()?" (testing)":""}`}for(const Pe in me.actions){const Ie=me.actions[Pe];let Re;if(!y().is_edit_mode()&&!p.on_server()){Re=S(Ie.code,"element_action ("+me.display+"-"+Ie.caption+")")}r[Pe]={category:"Element Actions",display(e){return Ee(e,Ie.caption)},field_names:v(Ie,true),fields(e){return A.get_element_id_field(e).concat(x(e,Ie,true))},run(e,t,n,r){return f.run_once(30,(()=>{const r=I(e,t,Ie.fields);const i=n.element.find_instance_by_id(t.element_id);return{properties:r,instance:i}}),((t,i)=>{if(t){r(t);return}const{properties:s,instance:o}=i;o.with_canvas((t=>{const i=Ae(o);const a=K({instance:o,action:e,bubble_context:n});return f.run_once(30,(()=>_.run_without_catching_not_ready((()=>D(e,(()=>{var e;return(e=Re)==null?void 0:e(i,s,a)}),"action",(e=>r(e)))))),r)}))}))}}}t[he]=ge}for(const Le in this.raw.plugin_actions){var oe;const ze=this.raw.plugin_actions[Le];const Be=ze.type==="server_side";const qe={display(){return ze.display+`${J.is_testing()?" (testing)":""}`},category:(oe=ze.category)!=null?oe:"plugins",data_to_refresh:null,not_api:ze.type==="client_side"};qe.field_names=v(ze,true);qe._fields=e=>x(e,ze,true);if(Be){var ae,le,ce,ue,de,pe,_e;let Ue=ze==null?void 0:(ae=ze.code)==null?void 0:ae.package_used;if((ze==null?void 0:(le=ze.code)==null?void 0:le.package_status)==="empty"){Ue=false}let Fe;if(Ue){var fe;Fe=ze==null?void 0:(fe=ze.code)==null?void 0:fe.package_hash}qe.server_method="custom_plugin_code";qe.code=ze==null?void 0:(ce=ze.code)==null?void 0:(ue=ce.server)==null?void 0:ue.fn;qe.package=ze==null?void 0:(de=ze.code)==null?void 0:(pe=de.package)==null?void 0:pe.fn;qe.package_used=Ue;qe.package_hash=Fe;qe.node_version=(_e=this.raw.meta_data)==null?void 0:_e.sa_node_version;qe.plugin_api_version=this.get_plugin_api_version();qe._transform_properties=(e,t)=>I(t,e,ze.fields,Be);qe.return_value=function(e){if(u.not_empty(ze.return_value)){const t={};B.object_entries(ze.return_value).map(((e,t)=>{var n;let[r,i]=e;return{key_id:r,key_data:i,rank:(n=i.rank)!=null?n:t}})).sort(((e,t)=>e.rank-t.rank)).forEach((n=>{let{key_data:r}=n;t[r.name]=[r.caption,g(e,r.value,r.is_list),true]}));const n=O.get("struct."+c.base64(JSON.stringify({definition:t,caption:e.display()})));return n}else{return O.get("null")}};qe.run=(e,t,n,r)=>n.get_server_outcome(e,((t,n)=>{if(t){t.pluginservice_action=ze.display;t=d.ensure_bubble_error(t).extend({action:e})}r(t,n);if(i==="current"&&n){console.log("Result of "+ze.display);const t=qe.return_value(e);f.run_once(30,(()=>{var e;return{val:(e=t==null?void 0:t.get_JS_object(n))!=null?e:n}}),((e,t)=>{if(e){N.log(e);return}console.log(t)}))}}))}else{let We;if(!y().is_edit_mode()&&!p.on_server()){We=S(ze.code.client,"action ("+ze.display+")")}qe.run=function(e,t,n,r){const i=K({action:e,bubble_context:n});f.run_once(30,(()=>_.run_without_catching_not_ready((()=>{const n=I(e,t,ze.fields,Be);D(e,(()=>{var e;return(e=We)==null?void 0:e(n,i)}),"action",(e=>r(e)))}))),r)}}r[Le]=qe}return{elements:t,events:n,actions:r}}},o(s.prototype,"calls",[r],Object.getOwnPropertyDescriptor(s.prototype,"calls"),s.prototype),o(s.prototype,"get_call_class",[i],Object.getOwnPropertyDescriptor(s.prototype,"get_call_class"),s.prototype),s);a.ThirdPartyPluginWrapper=ne},{"./apiconnectorbase":7,"./constants/plugin":78,"./core/core_actions":162,"./core/core_elements/core_elements_utilities/element_workflows":288,"./core/core_elements/shared/inputs":364,"./core/property_applications":412,"./core/shared_fields":414,"./core/widgets":421,"./core/widgets/fileupload":420,"./external":618,"./geolocation/b_location":621,"./lang/appquery":651,"./lang/btype_ids":652,"./lang/btypes":653,"./lang/btypes_dropdowns":654,"./lang/caching":656,"./lang/color_tokens":657,"./lang/evaluation/element_eval":690,"./lang/evaluation/element_props":691,"./lib":741,"./logger":744,"./pv/plugin_versioning":764,"./services/shared/service_type_parser":785,"./shared/external_api_utilities":794,"./shared/responsive/responsive_layout":804,"./u":823,"./u/client/b_ui":813,"./u/shared/async/autorun":830,"./u/shared/async/b_async":832,"./u/shared/b_object":839,"./u/shared/decaf":844,"./u/shared/errors":846,"./u/shared/incremental":848,"./u/shared/mode_check":851,base64url:957,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],757:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;r.message="Initial API Version";r.changelog=[];r.date=1477087595e3;r.fix_server_dates=false;r.fix_server_field_types=function(e){Object.entries(e).forEach((t=>{let[n,r]=t;e[n]=r.replace("Date","String")}))};r.old_server_list=true},{"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],758:[function(e,t,n){"use strict";const r=n;r.bubble_props_as_functions=false;r.message="Updated server-side actions API to match client-side one";r.changelog=["Changed List.get() for server-side actions to be (start, length), just like client-side actions, instead of (start, end)","Dates now get correctly passed in as Javascript Date objects on the server, instead of Strings"];r.date=1598479637e3},{}],759:[function(e,t,n){"use strict";const r=n;r.message="Changed properties object from static properties to functions";r.changelog=["Changed properties object from static properties to get functions; this allows plugin elements ","to be defined with conditional properties that depend on the element's own states","state without throwing a recursion error."];r.date=1605784035408;r.responsive_version=0},{}],760:[function(e,t,n){"use strict";const r=n;r.message="Updated plugin editor to the new responsive engine";r.changelog=["Changed the properties exposed on properties.bubble to the new responsive properties","Added options for elements to fit width or fit height","Can still access width/height to re-run update function on resize","On legacy engine, plugin elements should still work"];r.date=1648335983613},{}],761:[function(e,t,n){"use strict";const r=n;r.message="Updated plugins to run on node 18";r.changelog=["Moved context.request and context.async to context.v3 and they now return promises","Modified .get and .length to return promises","Added two utility methods id() and getAll()","Made lists implement AsyncIterable interface","Addded isBubbleThing and isBubbleList in place of single_api and list_api. single_api and list_api are still present","Added getThingById and getThingsById to the context object"];r.date=1686667570313},{}],762:[function(e,t,n){"use strict";const r=n;r.message="Updated plugins to run on node 18";r.changelog=["Moved context.request and context.async to context.v3 and they now return promises","Modified .get and .length to return promises","Added two utility methods id() and getAll()","Made lists implement AsyncIterable interface","Addded isBubbleThing and isBubbleList in place of single_api and list_api. single_api and list_api are still present","Added getThingById and getThingsById to the context object","See forum post here: https://forum.bubble.io/t/alpha-invite-for-plugin-developers-bubble-plugin-api-version-4/262297"];r.date=1680546487e3},{}],763:[function(e,t,n){"use strict";const r=n;r.fix_server_dates=true;r.fix_server_field_types=e=>e;r.old_server_list=false;r.bubble_props_as_functions=true;r.responsive_version=1},{}],764:[function(e,t,n){"use strict";const r=e("../u");const i=e("./0");const s=e("./1");const o=e("./2");const a=e("./3");const l=e("./4_alpha");const c=e("./4");const u=n;u.LATEST_VERSION="4";u.LATEST_PUBLIC_VERSION=4;let d=null;const p=["0","1","2","3","4_alpha","4"];const _={0:{display_name:"0",node_version:14,is_public:true,can_upgrade:true},1:{display_name:"1",node_version:14,is_public:true,can_upgrade:true},2:{display_name:"2",node_version:14,is_public:true,can_upgrade:true},3:{display_name:"3",node_version:14,is_public:true,can_upgrade:false},"4_alpha":{display_name:"4 (alpha)",node_version:18,is_public:false,can_upgrade:false},4:{display_name:"4",node_version:18,is_public:true,can_upgrade:false}};u.get_pv_metadata=function(e){return _[e!=null?e:"0"]};let f=null;u.get_all_version_messages=function(){if(!f){f=[];for(let e=0;e<p.length;e++){const{message:t,changelog:n,date:r}=m[h(e)];f.push({id:h(e),message:t,changelog:n,date:r})}}return f};function h(e){return p[e]}const m={};m["0"]=i;m["1"]=s;m["2"]=o;m["3"]=a;m["4_alpha"]=l;m["4"]=c;u.get_pv=function(e){if(!d){v()}return d[e!=null?e:"0"]};function g(e){return m[e]}function v(){const t=0;let n=e("./latest");d={};for(let e=p.length;e>=t;e--){n=d[h(e)]=r.extend({},n,g(h(e)))}}u.meta_mapping={0:0,1:1,2:2,3:3,"4_alpha":4,4:5}},{"../u":823,"./0":757,"./1":758,"./2":759,"./3":760,"./4":761,"./4_alpha":762,"./latest":763}],765:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js");var i=e("solid-js/web");var s=o(e("./PortalContext"));function o(e){return e&&e.__esModule?e:{default:e}}t.exports=function e(t){if(i.isServer){return""}const n=document.createTextNode("");function o(){if(r.sharedConfig.context){const[e,n]=(0,r.createSignal)(false);queueMicrotask((()=>n(true)));return()=>e()&&t.children}else return()=>t.children}const a=(0,r.useContext)(s.default);function l(e){a.addElement(e);(0,r.onCleanup)((()=>a.removeElement(e)))}function c(e){if(e==null)return;if(typeof e==="object"){l(e)}else{l(document.createTextNode(String(e)))}}const u=(0,r.children)(o());(0,r.createRenderEffect)((()=>{const e=u();if(Array.isArray(e)){e.forEach(c)}else{c(e)}}));return n}},{"./PortalContext":768,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],766:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.FIRST_DIVIDER=n.EditorContext=void 0;var r=e("solid-js");const i=Symbol("FIRST");n.FIRST_DIVIDER=i;const s=(0,r.createContext)();n.EditorContext=s;var o=s;n.default=o},{"solid-js":2313}],767:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=c;e("core-js/modules/es.string.replace.js");var r=e("solid-js/web");var i=e("solid-js");var s=l(e("../shared/responsive/responsive_css"));var o=e("./EditorContext");var a=e("./solid_utils/autorun_signals");function l(e){return e&&e.__esModule?e:{default:e}}function c(e){const t=e.instance;if(t.edit_mode()){const e=t.element.E.edit_fallback_component;if(e!=null){const n=Object.create(t.element);n.should_add_extra_wrapper=()=>false;const s=e.buildComponent(n,undefined);(0,i.onMount)((()=>{if(!t.is_drawn){t.mark_skeleton_ready();t.initialize_canvas()}}));return(0,r.createComponent)(s,{instance:t})}}const n=t.element.added_to_container();if(t.canvas==null){const e=t.edit_mode()?"inner-element":`bubble-element ${t.element.type()}`;const n=t.get_html();t.canvas=$(n);t.canvas.addClass(e);if(t.edit_mode()){t.canvas.attr("id",t.element_id().replace(/[^a-zA-Z0-9]/g,"_"))}t.canvas[0].bubble_data={bubble_instance:t};t._observe_canvas()}(0,a.onAfterMount)((()=>{const e=t.canvas;if(!n&&!t.thumbnail_mode()){t.position_canvas(e)}if(!t.has_skeleton){t.create_child_skeletons()}const r=[];if(!t.edit_mode()&&n){r.push(t.autorun((()=>{e.css(s.default.element_reset);e.css(t.container.element_css(t))})),t.autorun((()=>{e.css("z-index",t.element.get_zindex())})),t.autorun((()=>{if(t.get_static_property("collapse_when_hidden")){const n=t.autorun((()=>{if(t.container.should_collapse(t)){e.css("display","none")}else{e.css("display","")}}));n.set_run_immediately(true)}else{e.css("display","")}})))}if(t.edit_mode()&&!t._is_visible_me){t._hide_me()}t.mark_skeleton_ready();if(!t.is_drawn){t.initialize_canvas()}t.get_children_drawn_key().turn();return()=>{r.forEach((e=>{e.destroy()}))}}));if(t.edit_mode()){const e=(0,i.createMemo)((()=>({...t.container.element_css(t),"z-index":t.element.get_zindex(),display:t.get_static_property("collapse_when_hidden")&&t.container.should_collapse(t)?"none":""})));const n=(0,i.useContext)(o.EditorContext).wrapper;return(0,r.createComponent)(n,{instance:t,get style(){return e()},get children(){return t.canvas[0]}})}else{return n?t.canvas[0]:document.createTextNode("")}}},{"../shared/responsive/responsive_css":803,"./EditorContext":766,"./solid_utils/autorun_signals":774,"core-js/modules/es.string.replace.js":1121,"solid-js":2313,"solid-js/web":2315}],768:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=void 0;var r=e("solid-js");var i=(0,r.createContext)({addElement(e){document.body.appendChild(e)},removeElement(e){document.body.removeChild(e)}});n.default=i},{"solid-js":2313}],769:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.RenderElement=p;e("core-js/modules/web.dom-collections.iterator.js");var r=e("solid-js/web");var i=e("solid-js");var s=d(e("../logger"));var o=e("./solid_utils/autorun_signals");var a=c(e("./LegacyComponent"));var l=e("../u/shared/async/autorun");function c(e){return e&&e.__esModule?e:{default:e}}function u(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=u(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function p(e){var t;const n=e.instance;if(!n.is_solid_initialized){s.warn(`Attempting to render an element which doesn't have solid initialized. ${n.toUniqueString()}`);return}if(n.element.solid_component!=null||n.children.length===0){(0,o.onAfterMount)((()=>n.mark_skeleton_ready()))}const c=(t=n.element.solid_component)!=null?t:a.default;let u=()=>{if(n.child_container){return(0,r.createComponent)(c,(0,r.mergeProps)(e,{get children(){return n.children.map((e=>(0,r.createComponent)(p,{instance:e})))}}))}else{return(0,r.createComponent)(c,e)}};if(n.thumbnail_mode()){const[t]=(0,i.createResource)((async()=>await(0,l.run_once)(30,(()=>{var e,t;n.element.raw();(e=(t=n.element.E).custom_definition)==null?void 0:e.call(t).raw();return true}))));if(n.element.E.use_legacy_in_thumbnail){u=()=>(0,r.createComponent)(a.default,e)}return(0,r.createComponent)(i.Show,{get when(){return t()},get children(){return u()}})}if((0,i.untrack)((()=>n.draw_signal.get()))){return u()}return(0,r.createComponent)(i.Show,{get when(){return n.draw_signal.get()},get children(){return u()}})}},{"../logger":744,"../u/shared/async/autorun":830,"./LegacyComponent":767,"./solid_utils/autorun_signals":774,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313,"solid-js/web":2315}],770:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.TestContext=void 0;var r=e("solid-js");const i=(0,r.createContext)();n.TestContext=i;var s=i;n.default=s},{"solid-js":2313}],771:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.ThumbnailContext=void 0;var r=e("solid-js");const i=(0,r.createContext)();n.ThumbnailContext=i;var s=i;n.default=s},{"solid-js":2313}],772:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.checkNonDeferrable=m;n.mustRegisterId=g;n.watchDraw=c;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../u/shared/async/b_async");var i=a(e("../lang/appquery"));var s=e("../u/shared/uuid");var o=e("../lang/shrink");function a(e){return e&&e.__esModule?e:{default:e}}function l(e){if(e._is_visible||e.is_visible(true))return(0,r.FakeKey)();const t=(0,r.MakeKey)(undefined,`${e.element_id()} turned visible`);e._is_visible_cbs.push((()=>{t.turn()}));return t}function c(e,t){function n(e,i){const s=l(e);const o=(0,r.MakeKeyList)([i,s]);function a(t){if(!e.element.draws_own_children()){function n(){e.children.forEach((e=>{if(e.element.added_to_container()){t(e)}}))}if(e.child_container==null&&e.children.length>0){e.wait_for_first_draw(n)}else{n()}}}if(o.is_turned()){t.onDraw(e);a((e=>{n(e,(0,r.FakeKey)())}))}else{t.onSizeDraw(e);(0,r.WaitFor)(o,(()=>t.onDraw(e)));function c(){if(e.element.ignores_child_sizes()){(0,r.WaitFor)(o,(()=>{a((e=>{n(e,(0,r.FakeKey)())}))}))}else{a((e=>{n(e,o)}))}}if(e.element.no_size_when_hidden()){(0,r.WaitFor)(s,c)}else{c()}}}n(e,(0,r.FakeKey)())}const u=new Set(["Alert","AutocompleteDropdown","Button","Checkbox","CustomDefinition","DateInput","Dropdown","FileInput","FloatingGroup","GoogleMaps","Group","GroupFocus","GroupWithFocus","Icon","Image","Input","Link","MultiLineInput","Page","PictureInput","Popup","PoweredByBubble","RadioButtons","RepeatingGroup","Shape","SliderInput","TableElement","TableMainAxis","TableCrossAxis","TableCell","Text","VideoComponent"]);const d=new Set;const p=new Set;const _=new Set;function f(e){const t=e[o.S.type];if(u.has(t)||(0,s.is_UUID)(t)){return true}if(t==="CustomElement"){var n;const t=(n=e[o.S.properties])==null?void 0:n[o.S.custom_id];if(t==null)return false;const r=i.default.custom_definition(t);if(r==null)return false;if(!p.has(t)){if(d.has(t)){return false}d.add(t);m(r);p.add(t)}return!_.has(t)}if(t==="HTML"){var r;return((r=e[o.S.properties])==null?void 0:r.defer_drawing)===true}return false}function h(e){let t=false;const n=e[o.S.elements];if(n!=null){for(const e of Object.values(n)){if((e==null?void 0:e[o.S.id])!=null){const n=h(e);t||(t=n)}}}if(t||!f(e)){_.add(e[o.S.id]);return true}return false}function m(e){const t=e.json._raw();if((t==null?void 0:t[o.S.id])!=null){h(t)}if(!e.is_responsive_v1()||e.events().some((e=>!e.deferrable()))){_.add(e.id())}}function g(e){return _.has(e)}},{"../lang/appquery":651,"../lang/shrink":728,"../u/shared/async/b_async":832,"../u/shared/uuid":855,"core-js/modules/web.dom-collections.iterator.js":1123}],773:[function(e,t,n){"use strict";const{ssr:r}=e("solid-js/web");function i(e){return r(e.html)}t.exports=i},{"solid-js/web":2315}],774:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.createAutorun=p;n.createWatcher=_;n.onAfterMount=d;e("core-js/modules/web.dom-collections.iterator.js");var r=u(e("../../u/shared/async/autorun"));var i=u(e("../../u/shared/mode_check"));var s=e("solid-js");var o=l(e("../TestContext"));var a=e("../../u/shared/errors");function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=c(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function d(e,t){(0,s.createEffect)((()=>{var n;let r;let l=false;const c=(n=t==null?void 0:t.map((e=>e())))!=null?n:[];if(i.running_test()){const t=(0,s.useContext)(o.default);if(t==null){throw new a.UnexpectedError("Invalid test state while running solid test")}t.afterMounts.push((()=>{r=e(...c)}))}else{void Promise.resolve().then((()=>{if(!l){r=e(...c)}}))}(0,s.onCleanup)((()=>{var e;(e=r)==null?void 0:e();l=true}))}))}function p(e){d((()=>{const t=r.autorun(e);return()=>t.destroy()}))}function _(e,t){const[n,i]=(0,s.createSignal)(t==null?void 0:t.fallback);d((function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++){n[s]=arguments[s]}const o=r.Watcher((()=>e(...n)));o.on_value(i);return()=>o.destroy()}),t==null?void 0:t.inputs);return n}},{"../../u/shared/async/autorun":830,"../../u/shared/errors":846,"../../u/shared/mode_check":851,"../TestContext":770,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],775:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.OptimizedShow=i;var r=e("solid-js");function i(e){if(e.isStatic){return e.when?()=>e.children:()=>e.fallback}else{return(0,r.Show)(e)}}},{"solid-js":2313}],776:[function(e,t,n){"use strict";const r=n;const i=e("./u/shared/b_string");const s="Failed to establish a connection";r.is_retryable=function(e,t,n,r){if(n){if(n(t,e)){return true}}if(e){var o;if(i.string_contains(e.message,s)){return true}switch((o=e.args)==null?void 0:o.code){case"ESOCKETTIMEDOUT":if(!r){return true}break;case"ECONNRESET":case"ECONNREFUSED":case"ETIMEDOUT":case"EHOSTUNREACH":case"ENETUNREACH":case"EPROTO":return true}if(i.string_contains(e.message,"socket hang up")){return true}if(i.string_contains(e.message,"SSL3_GET_RECORD:decryption failed or bad record mac")){return true}}if(t){if([429,502,503,504].includes(t.statusCode)){return true}}return false}},{"./u/shared/b_string":841}],777:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");var r=o(e("url"));var i=o(e("querystring"));function s(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(s=function(e){return e?n:t})(e)}function o(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=s(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var a=i?Object.getOwnPropertyDescriptor(e,o):null;if(a&&(a.get||a.set)){Object.defineProperty(r,o,a)}else{r[o]=e[o]}}}r.default=e;if(n){n.set(e,r)}return r}t.exports={safe_require:l,safe_register:c};if(typeof window!=="undefined"){window.safe_require={safe_require:l,safe_register:c}}const a={url:r,querystring:i};function l(t){const n=a[t];if(n!=null){return n}const r=t.split("/");if(typeof window!=="undefined"&&r[1]==="optional"){const e=r[r.length-1];const n=window.optional_modules;if(e in n){const t=n[e];return t}else{throw new Error("could not find optional module: "+t)}}else{return e(t)}}function c(e,t){a[e]=t}},{"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123,querystring:2279,url:981}],778:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../u");const s=e("../../lib");const o=e("../../editor/css");const a=e("../shared/plugin_getter");const l=e("../../safe_require");l.safe_register("./services/client/editor_utils",r);r.enter_your_api_key_button_field_names={key_info:{no_states:true}};r.get_enter_your_api_key_button=function(e,t,n){var r;(r=n)!=null?r:n="Enter your API key";return[{name:"key_info",editor:"Button",button_caption:n,condition(){return t},optional:true,click_cb(){if(s().plugin_canvas.change_current_plugin!=null){s().plugin_canvas.change_current_plugin(e)}else{s().plugin_canvas.tabs.InstalledPlugins.currently_displayed_plugin(e)}$(o.PLUGIN_TAB).click()},pretty:{no_caption:true,width:"small"}}]};r.add_fields_from_parameters=function(e,t){for(const o in e){var n,r;const a=e[o];const l={name:o,caption:(n=(r=a.display)!=null?r:a.caption)!=null?n:o,optional:a.optional,default:a.default,label_text:a.label_text,no_rich_text_editing:a.no_rich_text_editing};if(a.choices){l.editor="Dropdown";l.set=s().sets.get_set("List")(a.choices)}else{var i;l.editor=(i=a.editor)!=null?i:"ShortText";l.value=a.value}if(a.doc){l.plugin_doc=a.doc}t.push(l)}return t};r.add_key_button=function(e,t){const n=a.get_plugin(e);if(n.has_keys()&&!t.map((e=>e.name)).includes("key_info")){const i=n.are_keys_missing();t.push(...r.get_enter_your_api_key_button(e,i)||[])}};const c={};const u={};const d={};r.get_api_data_for_edit_mode=function(e,t,n,r,o,a){var l;(l=o)!=null?l:o="";const p=e+"_"+o+"_"+(r!=null?r:"");if(!u[p]){let e;u[p]=i.MakeKey(null,"api_data_loaded for "+p);if(n==="post"){e=s().location.post(t,{apikey:r})}else if(n==="get"){e=s().location.get(t)}e.then((e=>{var t;if(!e||e.error||(t=e.errors)!=null&&t.length){c[p]=null}else{c[p]={};if(a){a(c[p],e)}else{c[p]=e}}return u[p].turn()}),(e=>{d[p]=e;u[p].turn();return null}))}i.ensure_ready(u[p]);return c[p]};r.wipe_edit_mode_cache=function(e,t,n){var r;(r=n)!=null?r:n="";const i=e+"_"+n+"_"+(t!=null?t:"");delete c[i];delete u[i]}},{"../../editor/css":560,"../../lib":741,"../../safe_require":777,"../../u":823,"../shared/plugin_getter":783,"core-js/modules/web.dom-collections.iterator.js":1123}],779:[function(e,t,n){"use strict";const r=e("../../../u");const i=e("../../../client_config");const s=e("../../../logger");const o=e("../../../pluginservice");const{get_error_message:a}=e("../../shared/utilities/get_error_message");let l=false;let c=false;const u="Using plugins in testing mode can considerably slow down your application as they are not cached. You should only use a test app to test plugins.";const d="Testing plugins should not be done with an application in a dedicated cluster. Please test your plugin with an app on the main cluster.";t.exports=function e(t,n,a){var l,f;let h=(l=window)==null?void 0:(f=l.plugins)==null?void 0:f[n];if(typeof h==="string"){h=r.json_parse(h)}if(p(h)){_(n,h);return}if(a==="current"){if(!c){s.owner_warn(u);if(i.is_dedicated){s.owner_warn(d)}c=true}}return new o.ThirdPartyPluginWrapper(n,a,h)};function p(e){return e==null||r.is_empty(e)||e.forbidden}function _(e,t){if(t==null){if(window.bubble_no_third_party_plugin){if(l){return}s.owner_warn("Community plugins are not loaded in safe mode.");l=true}else{s.owner_error("Plugin could not be loaded",{display:`The plugin ${e} could not be loaded. Please check it exists.`})}}else if(t.forbidden){s.owner_error(t.forbidden,{display:a(t,e)})}}},{"../../../client_config":41,"../../../logger":744,"../../../pluginservice":756,"../../../u":823,"../../shared/utilities/get_error_message":787}],780:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../u");const s=e("../lang/appquery");const o=e("../constants/plugin");const a=e("../logger");const l=e("lodash/isEqual");const c=e("./shared/service_type_parser");const u=e("./shared/plugin_getter");const d=e("../safe_require");d.safe_register("./services",r);let p;if(i.on_server()){const t=e;p=t("../u/shared/async/b_fiber")}const _={};function f(e){return JSON.stringify(e)}r.log_plugin_element_init=function(e){const t=f(e);if(!_[t]){a.verbose("plugin initialized",e);_[t]=true}};r.get_oauth_authenticator=function(e){if(!e){return null}if(e.indexOf(o.PLUGIN_SEPARATOR)===-1){var t;return(t=u.get_plugin(e))==null?void 0:t.get_authenticator()}else{var n;const[t,r]=c.get_plugin_and_type(e,"oauth");return(n=u.get_plugin(t))==null?void 0:n.get_authenticator(r,"oauth")}};r.get_api_calls=i.autorun_cache((()=>{const e={};for(const t of s.list_plugins()){const n=u.get_plugin(t);const r=n==null?void 0:n.get_public_calls();for(const i of r!=null?r:[]){const r=t+"."+i;const s=n.get_call(i);if(!s){a.error("could not find call",{name:r})}else{e[r]=s}}}return e}));r.get_api_calls_ids=i.autorun_cache({fn(){return new Set(Object.keys(r.get_api_calls()))},compare_fn:l});r.get_user_calls=function(){var e,t;const n={};(e=p)==null?void 0:e.optional_pause();for(const e of s.get_user_calls()){var r;(r=p)==null?void 0:r.optional_pause();const[t,i]=c.get_plugin_and_type(e);const s=u.get_plugin(t);if(s==null){continue}const o=s==null?void 0:s.get_call(i);if(o){n[i]=o}}(t=p)==null?void 0:t.optional_pause();return n};r.get_value_ids=i.autorun_cache((()=>{const e=[];for(const t of s.list_plugins()){const n=u.get_plugin(t);if(n){for(const t of n.get_public_values()){e.push(n.get_values()[t].full_name)}}}return e}));r._last_date_generated=null},{"../constants/plugin":78,"../lang/appquery":651,"../logger":744,"../safe_require":777,"../u":823,"./shared/plugin_getter":783,"./shared/service_type_parser":785,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/isEqual":1321}],781:[function(e,t,n){"use strict";const r=e("../lang/appquery");t.exports=function e(t){return r.list_plugins().includes(t)}},{"../lang/appquery":651}],782:[function(e,t,n){"use strict";const r=e("./shared/registry_management");const i=e("../../safe_require");const s=n;i.safe_register("./services/shared/internal_service_registry",s);s.services={};s.add_service=function(e,t){r.add_to_registry(e,t,s.services)};s.get_service=function(e){if(e==null){return}if(s.services[e]!=null){return s.services[e]}}},{"../../safe_require":777,"./shared/registry_management":786}],783:[function(e,t,n){"use strict";e("core-js/modules/es.error.cause.js");e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../lang/appquery");const s=e("./service_type_parser");const o=e("../../safe_require");const a=e("./plugin_registry");const l=e("./internal_service_registry");const c=e("../../logger");const u=n;u.initialize=p;u.get_plugin=h;u.get_app_plugins=f;o.safe_register("./services/shared/plugin_getter",u);let d;function p(e){if(d==null){d=e}else{throw new Error("plugin_getter: pluginservice_getter_fn already initialized")}}function _(e){if(d==null){throw new Error(`plugin_getter.${e} called before initialization`)}}function f(){_("get_app_plugins");return Object.entries(i.get_plugin_versions()).map((e=>{let[t,n]=e;return h(t,n)}))}function h(e,t){_("get_plugin");if(e==null){return}const n=l.get_service(e);if(n!=null){c.warn("plugin_getter: provided name is an internal service, not a plugin",{service_name:e,version:t});return n}const o=a.get_hardcoded_plugin(e,t);if(o!=null){return o}const u=e;if(e.indexOf("_current")!==-1){e=s.get_plugin_id(e);t="current"}if(!r.is_UUID(e)){return}if(!t){t=i.get_plugin_version(e);if(!t){return}}return m(e,u,t)}const m=r.autorun_cache(((e,t,n)=>d(e,t,n)))},{"../../lang/appquery":651,"../../logger":744,"../../safe_require":777,"../../u":823,"./internal_service_registry":782,"./plugin_registry":784,"./service_type_parser":785,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123}],784:[function(e,t,n){(function(t){(function(){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("fs");const i=e("path");const s=e("../../u");const o=e;const a=e("./shared/registry_management");const l=e("../../lang/appquery");const c=e("../../safe_require");const u=n;c.safe_register("./services/shared/plugin_registry",u);u.register_plugin=m;u.get_hardcoded_plugin=g;u.on_plugin_registration=h;u.get_app_hardcoded_plugins=v;const d={};const p=[];const _=[];const f={};u.defaults_for_plugins_settings=f;function h(e){for(const t of p){e(t,d[t])}_.push(e)}function m(e,n){if(s.on_server()){const a="../server/"+e+"_server";const l=i.join(t,`${a}.js`);if(r.existsSync(l)){s.extend(n.cls.prototype,o("./"+a))}}a.add_to_registry(e,n.cls,d);p.push(e);const l=d[e];for(const t in l.keys){const n=l.keys[t];if(n.default){f[e+"_"+t]=n.default}}for(const t of _){t(e,l)}}function g(e){if(e==null){return}if(d[e]!=null){return d[e]}}function v(){return Object.entries(l.get_plugin_versions()).filter((e=>{let[t,n]=e;return n===true})).map((e=>{let[t]=e;return g(t)}))}}).call(this)}).call(this,"/lib-browser/services/shared")},{"../../lang/appquery":651,"../../safe_require":777,"../../u":823,"./shared/registry_management":786,"core-js/modules/web.dom-collections.iterator.js":1123,fs:976,path:2268}],785:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.get_plugin_and_type=o;n.get_plugin_id=a;var r=s(e("../../constants/plugin"));function i(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(i=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=i(t);if(n&&n.has(e)){return n.get(e)}var r={};var s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;if(a&&(a.get||a.set)){Object.defineProperty(r,o,a)}else{r[o]=e[o]}}}r.default=e;if(n){n.set(e,r)}return r}function o(e){if(!e){return[null,null]}if(!e.includes(r.PLUGIN_SEPARATOR)){return[null,e]}const t=e.split(r.PLUGIN_SEPARATOR);return[t[0],t.slice(1).join(r.PLUGIN_SEPARATOR)]}function a(e){return e.split("_current")[0]}},{"../../constants/plugin":78,"core-js/modules/web.dom-collections.iterator.js":1123}],786:[function(e,t,n){"use strict";const r=e("../../../u");const i=n;i.add_to_registry=s;function s(e,t,n){if(!n[e]){var i;const s=new t;s.name=e;(i=s.human)!=null?i:s.human=r.toTitleCase(e);n[e]=s;if(!s.authenticator){throw new r.UnexpectedError("Error building service "+e+": missing authenticator")}if(typeof s.authenticator!=="function"){s.authenticator._service=s}}}},{"../../../u":823}],787:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.get_error_message=s;var r=i(e("../../../client_config"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n,i,s,o;switch(e.forbidden){case"NOT_PAID":return"The plugin "+((n=e.caption)!=null?n:t)+" is published under a commercial license and this app does not have a subscription. Please subscribe in the editor.";case"BLOCKED":return"The plugin "+((i=e.caption)!=null?i:t)+" is blocked by Bubble.";case"NOT_AUTHORIZED":return"The plugin "+((s=e.caption)!=null?s:t)+" is published under a private license and this app is not authorized.";case"NOT_TEST_APP":return"The plugin "+((o=e.caption)!=null?o:t)+" is in test mode and the current app is not the registered test app.";case"ISSUE":{var a;let n="The plugin "+((a=e.caption)!=null?a:t)+" could not be retrieved for this app. ";if(r.default.is_dedicated){n+="Please upgrade your Dedicated Cluster and try again."}else{n+="Please make sure it exists."}return n}}}},{"../../../client_config":41}],788:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.get_hardcoded_plan=g;n.hardcoded_apps=b;n.is_app_with_testing_plan=m;n.is_blocked=c;n.is_forkable=d;n.is_hardcoded=_;n.is_local_editable=u;n.is_meta=f;n.is_test=h;n.no_issue_checker=p;e("core-js/modules/web.dom-collections.iterator.js");var r=e("../constants/apps");var i=a(e("../client_config"));var s;function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}r.SPECIAL_APPS.meta.hard_code=(s=i.meta_hardcoded)!=null?s:false;function l(e,t){var n,i;return(n=(i=r.SPECIAL_APPS[e])==null?void 0:i[t])!=null?n:false}function c(e){return l(e,"blocked")}function u(e){return l(e,"editable")}function d(e){return l(e,"forkable")}function p(e){return l(e,"no_issue_checker")}function _(e){return l(e,"hard_code")}function f(e){return l(e,"meta")}function h(e){return l(e,"test")}function m(e){var t;return((t=r.SPECIAL_APPS[e])==null?void 0:t.plan)==="app_testing"}function g(e){if(e in r.SPECIAL_APPS){const t=r.SPECIAL_APPS[e];if(t.plan){return t.plan}if(t.hard_code){return"app_personal_2019"}}return undefined}let v;function b(){if(v==null){var e;(e=v)!=null?e:v=new Set(Object.entries(r.SPECIAL_APPS).filter((e=>{let[t,n]=e;return n.hard_code})).map((e=>{let[t,n]=e;return t})));Object.freeze(v)}return v}},{"../client_config":41,"../constants/apps":49,"core-js/modules/web.dom-collections.iterator.js":1123}],789:[function(e,t,n){"use strict";const r=e("../lib");const i=e("../core/core_elements/shared/links");const s=e("../u");const o=n;o.build_page_url_for_action=function(e,t,n,o,a,l,c){const u={};let d="";if(c){d=c}if(s.is_debug_mode()){u.debug_mode=true}let p={};if(t){const e=n!=null?n:{};for(const t in e){const n=e[t];p[n.key]=n.value}}if(o){p=s.extend(r().location.get_query(),p)}for(const e in p){const t=p[e];if(!i.forbidden_url_keys.includes(e)){u[e]=t}}const _={pg_thing:d,data_fr_link:u};return _}},{"../core/core_elements/shared/links":365,"../lib":741,"../u":823}],790:[function(e,t,n){"use strict";const r=n;const i=e("../constants/locations");const s=e("../client_config");r.uid_cookie_name=function(e,t,n){var r,o,a;const l=(r=(o=(a=s.cookie_name_prefix)!=null?a:s.environment_name)!=null?o:s.env)!=null?r:"";return e+"_u1"+(t!==i.LIVE_VERSION?"_"+t:"")+l+(n?"_"+n:"")};r.sid_cookie_name=function(e,t,n){var r,i,o;const a=(r=(i=(o=s.cookie_name_prefix)!=null?o:s.environment_name)!=null?i:s.env)!=null?r:"";return e+"_"+t+"_u2"+a+(n?"_"+n:"")};r.debug_mode_cookie_name=e=>`${e}_debug_mode`;r.firebase_cookie_name=(e,t)=>e+"-"+t},{"../client_config":41,"../constants/locations":74}],791:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("pluralize");const i=e("../lib");const s=e("../lang/appquery");const o=e("../logger");const a=e("../u");const l=e("../constants/security");const c=e("../constants/db");const u=e("../lang/btypes");const d=e("../core/core_elements/shared/image_utils");const p=e("../u/shared/errors");const _=e("../u/shared/decaf");const{ignoreError:f}=e("../u/shared/callbacks");const h=e("../lang/btype_ids");const m=n;m.create_default_view=function(e,t){var n;let i=e.readable_fields().map((e=>e.value));if(!t){i=i.slice(0,7)}if(e.id()==="user"){i.push(l.USER_FIELDS.find((e=>e.display==="email")).value)}return{display:`All ${r((n=e.display())!=null?n:"")}`,type:e.to_value(),fields_to_show:i,default_view:true,id:`default_view_${e.id()}`,type_id:e.id(),constraints:[],sort_field:"Created Date",descending:true}};m.resolve_search_from_view=function(e){var t;let{view_data:n,quick_search_content:r}=e;if(!n){return null}const o=(t=a.json_deep_copy(n.constraints))!=null?t:[];const l=i().db_instance(s.appname(),s.app_version());if(r){o.push({constraint_type:"contains_all_fields",key:"_all",value:r,opts:{no_language:true}});return l.find(n.type,o,[{sort_field:n.sort_field,descending:n.descending}],c.DATA_PANEL_SEARCH_FAKE_EVAL_NODE)}const u=i().bv().resolve_constraints(o);return l.find(n.type,u,[{sort_field:n.sort_field,descending:n.descending}],c.DATA_PANEL_SEARCH_FAKE_EVAL_NODE)};m.get_printable_field=function(e){let{field_object:t,item_value:n,always_return_text:r,primary_fields:i,preserve_numbers:s}=e;if(n==null){return""}if(t.has_export_to_string()){try{return t.export_to_string(n,{option_show_if_deleted:true,custom_use_primary_field:true,booleans_yes_no:true,always_return_text:r,preserve_numbers:s,get_primary_field(e){return m.get_primary_field(e,i)},optimize_image:m.optimize_image})}catch(e){if(e instanceof p.NotReadyError){throw e}o.warn("Failed to cast value to string",{id:t.id(),err:e});return"(error casting to string)"}}o.error("Tried to display a value in admin panel but no export_to_string for this btype",{id:t.id()});return""};const g={};const v={};m.guess_primary_field=function(e){let t;if(h.is_custom_type(e)){t=h.custom_type_name(e)}else{t=e}if(!v[t]){v[t]=a.MakeKey(null,"getting fields for "+t);if(e==="user"){g[t]="email";v[t].turn()}else{a.run_once(30,(()=>u.get(e).custom_type().readable_fields()),f((e=>{for(const n of e){const e=n.display.toLowerCase();for(const r of["name","description","title","reference"]){if(e.indexOf(r)!==-1){g[t]=n.value;break}}}g[t]="_id";v[t].turn()})))}}a.ensure_ready(v[t]);return g[t]};m.get_primary_field=function(e,t){var n;const r=h.custom_type_name(e);return(n=t==null?void 0:t[r])!=null?n:m.guess_primary_field(e)};m.get_printable_object=function(e){let{entry:t,view_data:n,only_text:r,use_captions:i,primary_fields:s,preserve_numbers:o}=e;const a={};const l=u.get(n.type);for(const e of _.array_from(n.fields_to_show)){const n=l.get_message(e);const c=n.ret_btype();const u=n.evaluate(t);let d;if(i){d=n.description(undefined,true)}else{d=n.name()}a[d]=m.get_printable_field({field_object:c,item_value:u,always_return_text:r,primary_fields:s,preserve_numbers:o})}return a};const b={};m.optimize_image=function(e,t,n){const r=e+n+t;if(!b[r]){b[r]=d.optimize_image(e,t,n)}return b[r]}},{"../constants/db":58,"../constants/security":84,"../core/core_elements/shared/image_utils":363,"../lang/appquery":651,"../lang/btype_ids":652,"../lang/btypes":653,"../lib":741,"../logger":744,"../u":823,"../u/shared/callbacks":843,"../u/shared/decaf":844,"../u/shared/errors":846,"core-js/modules/web.dom-collections.iterator.js":1123,pluralize:2275}],792:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.LABEL_REGEX=void 0;n.get_dedicated_env=N;n.get_domain_from_referer=P;n.is_appname_valid=w;n.is_environment_dedicated=T;n.is_host_aws=A;n.is_host_ip_address=M;n.is_host_on_bubble=S;n.is_hostname_bubble=k;n.is_hostname_bubble_plus_subdomain=O;n.is_hostname_dedicated=C;n.is_hostname_local_bubble=j;n.is_hostname_valid=x;n.is_internal_request=E;n.is_origin_on_bubble=D;n.validate_url=I;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.url.js");e("core-js/modules/web.url-search-params.js");var r=a(e("../constants/domain"));var i=s(e("../safe_require"));function s(e){return e&&e.__esModule?e:{default:e}}function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}i.default.safe_register("./shared/domain_utilities",n);const l=/^(?:[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?)$/;n.LABEL_REGEX=l;const c=/^(?:[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?\.)+(?:xn--[a-z\d]+|[a-z]{2,})$/;const u=/^(?:https?:\/\/)?(?:[^@/\n]+@)?(?:www.)?([^:/\n]+)/;const d="bubble\\.i[so]";const p="(td|d\\d+)";const _=new RegExp(`^${d}$`);const f=new RegExp(`^([a-z\\d-]+\\.)?${r.META_HOSTNAME}$`);const h=new RegExp(`^https:\\/\\/([a-z\\d-]+\\.)?${d}$`);const m=new RegExp(`\\b${d}(?:$|/)`);const g=new RegExp(`^${p}\\.${d}$`);const v=new RegExp(`^${p}$`);const b=/\.amazonaws\.com(?::\d+)?$/;const y=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/;function w(e){return l.test(e)}function x(e){return c.test(e)}function j(e){return e===r.LOCAL_HOSTNAME}function A(e){return b.test(e)}function M(e){return y.test(e)}function E(e){return!!e&&(e.startsWith("localhost")||A(e)||M(e))}function k(e){return _.test(e)}function O(e){return f.test(e)}function S(e){return m.test(e)}function D(e){return h.test(e)}function C(e){return g.test(e)}function T(e){return v.test(e)}function N(e){var t;if(!e){return}return(t=e.match(g))==null?void 0:t[1]}function P(e){if(e!=null){if(e.startsWith(r.BLOG_URL)){return"bubble.io/blog"}const t=u.exec(e);if(t){return t[1]}}return"direct"}function I(e){try{return new URL(e)}catch(e){return false}}},{"../constants/domain":59,"../safe_require":777,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.url-search-params.js":1126,"core-js/modules/web.url.js":1127}],793:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.is_development=d;n.is_local=p;n.is_production=c;n.is_production_not_dedicated=_;n.is_test=u;var r=l(e("../constants/environment"));var i=l(e("../client_config"));var s=o(e("../safe_require"));function o(e){return e&&e.__esModule?e:{default:e}}function a(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=a(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}s.default.safe_register("./shared/environment_utilities",n);function c(){return i.env===r.PROD}function u(){return i.env===r.QA}function d(){return i.env===r.DEV||i.env===r.LOCAL}function p(){return i.env===r.LOCAL}function _(){return c()&&!i.is_dedicated}},{"../client_config":41,"../constants/environment":62,"../safe_require":777,"core-js/modules/web.dom-collections.iterator.js":1123}],794:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=n;const i=e("../safe_require");i.safe_register("./shared/external_api_utilities",r);const s=e("../retryable");const o=e("../u/shared/errors");r.handle_request_failures=e=>{const t=String(e.message);if(t.indexOf("ENOTFOUND")!==-1){return new o.OwnerError("Could not find domain",{display:"Could not find domain:"+t.replace("ENOTFOUND","")})}else if(t.indexOf("Failed to establish a connection after")!==-1){return new o.OwnerError("Failed to establish a connection",{display:t})}else if(t.indexOf("ESOCKETTIMEDOUT")!==-1||t.indexOf("ETIMEDOUT")!==-1){return new o.OwnerError("Could not connect to remote server")}else if(t.indexOf("certificate has expired")!==-1){return new o.OwnerError("The remote server's SSL certificate has expired")}else if(t.indexOf("certificate not trusted")!==-1){return new o.OwnerError("There is an issue with the remote server's SSL certificate")}else if(t.indexOf("self signed certificate")!==-1){return new o.OwnerError("The remote server's SSL certificate is self-signed")}else if(t.indexOf("Invalid protocol")!==-1){return new o.OwnerError("The request protocol is invalid, it should only be 'http' or 'https'")}else if(t.indexOf("unable to verify the first certificate")!==-1){return new o.OwnerError("There is an issue with the remote server's SSL certificate")}else if(t.indexOf("Hostname/IP doesn't match certificate's altnames")!==-1){return new o.OwnerError("SSL Cert mismatch",{display:t})}else if(t.indexOf("Hostname/IP does not match certificate's altnames")!==-1){return new o.OwnerError("SSL Cert mismatch",{display:t})}else if(t.indexOf("Exceeded maxRedirects")!==-1){return new o.OwnerError("request maxRedirects",{display:t})}else if(s.is_retryable(e)){return new o.OwnerError("Could not connect to the remote server")}else{return e}}},{"../retryable":776,"../safe_require":777,"../u/shared/errors":846,"core-js/modules/es.string.replace.js":1121}],795:[function(e,t,n){"use strict";function r(){return $("body").css("imageOrientation")==="from-image"}function i(e){let{orientation:t,canvas:n,context:i}=e;if(r()){return}if(t>4){const{width:e,height:t}=n;n.width=t;n.height=e}switch(t){case 2:i.translate(n.width,0);i.scale(-1,1);break;case 3:i.translate(n.width,n.height);i.rotate(Math.PI);break;case 4:i.translate(0,n.height);i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI);i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI);i.translate(0,-n.width);break;case 7:i.rotate(.5*Math.PI);i.translate(n.height,-n.width);i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI);i.translate(-n.height,0);break}}function s(e){let{image_url:t,file:n,_cb:r}=e;const i=new FileReader;i.onload=function(e){const t=new window.DataView(e.target.result);if(t.getUint16(0,false)!==65496){r(-2);return}const n=t.byteLength;let i=2;while(i<n){const e=t.getUint16(i,false);i+=2;if(e===65505){if(t.getUint32(i+=2,false)!==1165519206){r(-1);return}const e=t.getUint16(i+=6,false)===18761;i+=t.getUint32(i+4,e);const n=t.getUint16(i,e);i+=2;for(let s=0,o=n,a=o>=0;a?s<o:s>o;a?s++:s--){if(t.getUint16(i+s*12,e)===274){r(t.getUint16(i+s*12+8,e));return}}}else if((e&65280)!==65280){break}else{i+=t.getUint16(i,false)}}r(-1)};i.readAsArrayBuffer(n)}const o={WIDTH:800,HEIGHT:600};t.exports=function(e){let{file:t,image_url:n,extension:r,success_callback:a,fail_callback:l,progress_bar_hide_fn:c}=e;const u=r==="png"?"image/png":"image/jpeg";const d=document.createElement("img");d.src=n;d.onerror=function(){c();l==null?void 0:l()};d.onload=function(){const e=document.createElement("canvas");let{width:n}=d;let{height:r}=d;if(n>r){if(n>o.WIDTH){r*=o.WIDTH/n;n=o.WIDTH}}else{if(r>o.HEIGHT){n*=o.HEIGHT/r;r=o.HEIGHT}}s({file:t,_cb(s){const o=e.getContext("2d");e.width=n;e.height=r;i({orientation:s,canvas:e,context:o});o.drawImage(d,0,0,n,r);t.contents=e.toDataURL(u,.8).split(",")[1];a()}})}}},{}],796:[function(e,t,n){"use strict";const r=n;const i=e("../client_config");const s=e("../u");const o=e("../imgix");const a={};r.get_image_real_dimensions=function(e,t){if(!e){t({});return}if(a[e]){t(a[e]);return}function n(){const n=s.img(undefined,$("body"),e);n.hide();n.on("load",(()=>{const r={width:n.width(),height:n.height()};n.remove();a[e]=r;t(r)}));n.on("error",(()=>{n.remove();t({})}))}const r=s.fixedEncodeURIComponent(i.user_file_url);const l=e.indexOf(i.user_file_url)!==-1||e.indexOf(r)!==-1;const c=i.image_optimization_service&&e.indexOf(i.image_optimization_service)!==-1;if(l&&c){o.get_image_json_data(e,(r=>{if(!r){n()}else{a[e]=r;t(r)}}))}else{n()}}},{"../client_config":41,"../imgix":628,"../u":823}],797:[function(e,t,n){(function(t){(function(){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");const r=n;r.initialize_globals=function(){if(typeof t==="undefined"){return}const e=["window","document","navigator"];for(const i of e){var n,r;(r=(n=t)[i])!=null?r:n[i]=undefined}};r.initialize=function(){Error.stackTraceLimit=1e3;r.initialize_globals()}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123}],798:[function(e,t,n){"use strict";const r=n;const i=e("../lib");const s=e("../u/shared/async/b_fiber");const o=e("../u/shared/mode_check");const a=e("./environment_utilities");const l=e("../constants/special_logging_apps");const c=e("../constants/logging");const u=e("../shared/test_apps_utilities");class d{constructor(e){this.filter=e}active(e){var t;(t=e)!=null?t:e={};return this.filter(e)}}r.Investigation=d;function p(e,t){return()=>{var n;const r=(n=s.Fiber)==null?void 0:n.current;if(r!=null){var i,o,a;(i=r.investigations)!=null?i:r.investigations={};(a=(o=r.investigations)[e])!=null?a:o[e]=Math.random()<t;return r.investigations[e]}else{return false}}}function _(e){return Math.random()<e}function f(){var e,t;const n=(e=(t=i()).appname)==null?void 0:e.call(t);if(o.running_test()||u.is_e2e_test_appname(n)){return true}else{var r;return(r=l.ALL[n])!=null?r:false}}function h(e){if(_(e)){return new d((()=>true))}else{return new d((()=>false))}}r.frozen_state_discrepancies=new d((()=>{let e;if(a.is_production()){e=.001}else if(o.running_test()){e=1}else{e=.1}return _(e)}));r.frozen_state_debugging=new d(f);r.workflow_execution=new d(f);r.action_update_thing=new d(f);r.postgres_dangerous_procedures=new d((e=>{let{appname:t,proc:n}=e;return l.ALL[t]&&c.SPECIAL_LOGGING_PROCS[n]}));r.fetch_bigger_chunks=h(.01)},{"../constants/logging":75,"../constants/special_logging_apps":88,"../lib":741,"../shared/test_apps_utilities":809,"../u/shared/async/b_fiber":833,"../u/shared/mode_check":851,"./environment_utilities":793}],799:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.is_zero_decimal_currency=n.get_service_corrected_amount=n.get_bubble_corrected_amount=void 0;var r=l(e("./../safe_require"));var i=a(e("../u/shared/errors"));var s=l(e("../lib"));function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function l(e){return e&&e.__esModule?e:{default:e}}r.default.safe_register("./shared/payment_converter",n);function c(e,t){if(t){return parseInt((100*e).toFixed())}return parseInt(e.toFixed())}function u(e,t){if(t){return parseFloat(String(e/100))}return parseInt(e.toFixed())}const d={stripe(e,t,n){if(e==null){return null}let r;if(n&&s.default.or_throw().bubble_version()<14){r=true}else{r=!f(t)}return c(e,r)},braintree(e){return parseFloat(e.toFixed(2))}};const p=function(e){let{service_name:t,bubble_amount:n,currency:r,only_after_bv14:s}=e;if(d[t]==null){throw new i.UnexpectedError("unsupported service",{service_name:t})}return d[t](n,r,s)};n.get_service_corrected_amount=p;const _=function(e,t,n){if(e==null){return null}let r;if(n&&s.default.or_throw().bubble_version()<14){r=true}else{r=!f(t)}return u(e,r)};n.get_bubble_corrected_amount=_;const f=function(e){if(e==null){return false}return["BIF","CLP","DJF","GNF","JPY","KMF","KRW","MGA","PYG","RWF","UGX","VND","VUV","XAF","XOF","XPF"].includes(e.toUpperCase())};n.is_zero_decimal_currency=f},{"../lib":741,"../u/shared/errors":846,"./../safe_require":777,"core-js/modules/web.dom-collections.iterator.js":1123}],800:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.getPricingPlanKey=c;n.isStateR=l;n.registerIsStateRHook=u;n.registerPricingPlanKeyHook=d;var r=s(e("../logger"));function i(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(i=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=i(t);if(n&&n.has(e)){return n.get(e)}var r={};var s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;if(a&&(a.get||a.set)){Object.defineProperty(r,o,a)}else{r[o]=e[o]}}}r.default=e;if(n){n.set(e,r)}return r}let o;let a;function l(){if(!o){r.warn("No function registered to isStateR");return false}return o()}function c(e){if(!a){r.warn("No function registered to getPricingPlanKey");return undefined}return a(e)}function u(e){o=e}function d(e){a=e}},{"../logger":744,"core-js/modules/web.dom-collections.iterator.js":1123}],801:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=e("../../u");const i=e("../../lib");const s=e("./responsive_css");const o=e("../../lang/lang");const a=e("./responsive_layout");const l=e("../../lang/evaluation/element_eval");const c=e("../../lang/evaluation/element_props");const u=e("../../client/responsive_v0/containers");t.exports=class e{constructor(e,t){this.owner_instance=e;this.container_canvas=t;this._destroy_fns=[];this.instances={};this.element_autoruns={};this.child_containers=[];this.flow_created=r.MakeKey(null,"flow created");this.dependency=r.Dependency();if(this.owner_instance!=null&&this.container_canvas!=null){if(this.owner_instance.run_mode()){this.handle_extra_wrapper()}this.container_canvas.addClass("bubble-r-container");if(this.owner_instance.element.type()==="Page"){if(r.is_debug_mode()){const e=300;if(this.owner_instance.element.container_layout()==="fixed"){this.container_canvas.css("height",this.container_canvas.height()+e)}else{this.container_canvas.css("padding-bottom",e)}}}this.autorun((()=>{const e=this.layout();this.container_canvas.removeClass(a.CONTAINER_CLASSES);this.container_canvas.addClass(e.classes);this.container_canvas.css(this.get_container_props())}))}}get_container_props(){const e=this.layout();const t={};for(const n in e.container_properties){const r=e.container_properties[n];t[r]=l.evaluate_property(this.owner_instance,n)}return s.container_properties(t)}destroy(){var e;if(this.destroyed){return}this.destroyed=true;(e=this.owner_instance)==null?void 0:e.destroy();this.owner_instance=null;for(const e of(t=this.child_containers)!=null?t:[]){var t;e.destroy()}for(const e of this._destroy_fns){e()}this._destroy_fns=undefined}on_destroy(e){if(this.destroyed){e()}else{this._destroy_fns.push(e)}}autorun(e,t){const n=r.autorun((()=>{if(!this.destroyed){e()}}),t);this.on_destroy((()=>n.destroy()));return n}handle_extra_wrapper(){if(this.owner_instance.element.should_add_extra_wrapper()){this.container_canvas.addClass("bubble-r-container-wrapper");this.container_canvas=r.div("",this.container_canvas)}}layout_type(){var e,t;return(e=(t=this.owner_instance)==null?void 0:t.element.container_layout())!=null?e:"fixed"}layout(){return a.LAYOUT_PROPERTIES[this.layout_type()]}resize_width(){}add_to_instances(e){this.instances[e.element_id()]=e}remove_from_instances(e){delete this.instances[e.element_id()]}ready_key(){return this.flow_created}get_canvas(){return this.container_canvas}get_owner(){return this.owner_instance}render(e){const t=$(e);t.addClass("bubble-element");return t}to_canvas(e){return e.canvas}set_height(e,t){e.canvas.css("height",t)}get_width_properties(e){const{element:t}=e;const n=this.layout_type()===a.FIXED_LAYOUT;return{min_width:n?t.get_width():c.min_width_css(e),max_width:n?t.get_width():c.max_width_css(e),min_height:n?t.get_height():c.min_height_css(e),max_height:n?t.get_height():c.max_height_css(e),fit_width:c.is_fitting_width(e),fit_height:c.is_fitting_height(e),has_fixed_aspect_ratio:t.has_fixed_aspect_ratio()}}should_collapse(e){return!e.is_visible_me()&&!(e.is_animating()&&e._is_animating_me)}element_css(e){const{element:t}=e;const n=this.layout();const r=this.get_width_properties(e);for(const t of s.margin_properties){r[t]=l.evaluate_property(e,t)}for(const t in n.element_properties){const i=n.element_properties[t];r[i]=l.evaluate_property(e,t)}const i=n.css_func(r);if(!t.E.uses_css_responsive){var o;i["min-width"]=t.get_min_width();i["max-width"]=(o=t.get_max_width())!=null?o:"";if(!e.run_mode()){i.width=t.get_width();i.height=t.get_height();i["flex-grow"]=0}else{delete i.height}i["min-height"]="";i["max-height"]=""}return i}setup_element(e){const t=this.to_canvas(e);const{element:n}=e;e.autorun((()=>{t.css("z-index",n.get_zindex())}));e.autorun((()=>{this.autorun((()=>{t.css(s.element_reset);t.css(this.element_css(e))}));this.autorun((()=>{if(e.get_static_property("collapse_when_hidden")){const n=this.autorun((()=>{if(this.should_collapse(e)){t.hide()}else{t.show()}}));n.set_run_immediately(true)}else{t.show()}}))}))}root_css(e){var t,n;const{element:r}=e;return{width:e.run_mode()?"100%":i().visual_edit.root_width(),"min-width":r.root_min_width(),"max-width":(t=r.root_max_width())!=null?t:"","min-height":r.root_min_height(),"max-height":(n=r.root_max_height())!=null?n:""}}setup_root(e){const t=this.to_canvas(e);t.css({"z-index":2,position:"relative"});this.autorun((()=>{t.css(this.root_css(e))}))}add(e){const{element:t}=e;const n=this.to_canvas(e);if(t instanceof o.Root){this.autorun((()=>{this.setup_root(e)}));this.container_canvas.append(n);return}else if(!t.added_to_container()){return}const r=e.element.id();this.instances[r]=e;this.element_autoruns[r]=this.autorun((()=>{this.setup_element(e)}));this.container_canvas.append(n)}create_child(t,n){const r=t.element.E.custom_definition;if(r){if(r().get_responsive_version()>0){return new e(t,n)}else if(!r().use_responsive_algorithm()){return new u.OldContainer(t,n)}else{return new u.Container(t,n,t.element.get_responsive_data())}}else{const r=new e(t,n);this.child_containers.push(r);return r}}initialize(){this.flow_created.turn()}detach(e){this.to_canvas(e).detach()}}},{"../../client/responsive_v0/containers":33,"../../lang/evaluation/element_eval":690,"../../lang/evaluation/element_props":691,"../../lang/lang":714,"../../lib":741,"../../u":823,"./responsive_css":803,"./responsive_layout":804,"core-js/modules/web.dom-collections.iterator.js":1123}],802:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../../lang/evaluation/element_edit_eval");r.get_default_sizing=e=>{let{width:t,height:n,can_fit_height:r}=e;return{single_width:true,min_width_css:`${t}px`,horiz_alignment:"flex-start",min_height_css:`${n}px`,fit_height:r,single_height:!r}};r.on_container_layout_change_from_fixed=function(e){let t;if(e.is_root()){t=r.get_default_root_sizing({width:e.get_width(),height:e.get_height()})}else{t=r.get_default_sizing({width:e.get_width(),height:e.get_height(),can_fit_height:e.can_fit_height()})}for(const n in t){const r=t[n];e.set_property(n,r)}};r.get_default_root_sizing=e=>{let{width:t,height:n}=e;return{default_width:t,min_width_px:0,min_height_px:n}};r.calculate_flexbox=function(e){let{container_height:t,container_width:n,element_data:r,layout_type:i,only_order:s}=e;const o={};function a(e){delete e.cross_base;delete e.cross_size;delete e.cross_end;delete e.main_base;delete e.main_size;delete e.main_end;if(s){delete e.margin_left;delete e.margin_right;delete e.margin_top;delete e.margin_bottom}}let l,c,u,d,p,_,f;if(i==="row"){p="margin_left";d="margin_right";u="margin_top";c="margin_bottom";l=true;_=t;f=n}else if(i==="column"){u="margin_left";c="margin_right";p="margin_top";d="margin_bottom";l=false;f=t;_=n}else{return o}const h=[];for(const e in r){const t=r[e];const{ih:n,it:s,il:a,iw:l}=t;h.push(e);if(i==="row"){o[e]={cross_size:n,cross_base:s,cross_end:s+n,main_base:a,main_size:l,main_end:a+l}}else{o[e]={main_size:a,main_base:s,main_end:s+n,cross_base:a,cross_size:l,cross_end:a+l}}}if(h.length===0){return o}h.sort(((e,t)=>o[e].cross_base-o[t].cross_base));const m=[];let g=null;for(const e of h){if(g==null||l&&o[e].cross_base>g.end){g={elements:[e],base:o[e].cross_base,end:o[e].cross_end};m.push(g)}else{g.elements.push(e);g.end=Math.max(g.end,o[e].cross_end)}}let v=0;let b=0;let y=1;for(let e=0;e<m.length;e++){const t=m[e];t.elements.sort(((e,t)=>o[e].main_base-o[t].main_base));for(let n=0;n<t.elements.length;n++){const r=t.elements[n];const i=o[r];i[u]=i.cross_base-v;i[p]=i.main_base-b;if(n===t.elements.length-1){i[d]=f-i.main_end}else{i[d]=0}if(e===m.length-1){i[c]=_-i.cross_end}else{i[c]=0}b=i.main_end;i.order=y;y+=1;a(i)}v=t.end}return o};r.calculate_nonant=function(e){let{left:t,top:n,width:r,height:i,margins:s,container_width:o,container_height:a}=e;function l(e){let{dist_start:t,dist_end:n}=e;if(t<n/2){return"a"}else if(n<t/2){return"c"}else{return"b"}}return l({dist_start:t-s.left,dist_end:o-(t+r+s.right)})+l({dist_start:n-s.top,dist_end:a-(n+i+s.bottom)})};r.calculate_instance_nonant=function(e,t){const n=e.to_canvas(t);const s=n.offset();const o=e.container_corner();const a={};for(const e of["top","left","right","bottom"]){a[e]=i.edit_eval(`margin_${e}`,t)}return r.calculate_nonant({left:s.left-o.left,top:s.top-o.top,width:n.outerWidth(),height:n.outerHeight(),margins:a,container_width:e.container_canvas.innerWidth(),container_height:e.container_canvas.innerHeight()})};r.calculate_nonants=function(e){const t={};for(const n in e.instances){const i=e.instances[n];if(i.element.added_to_container()){t[n]={nonant_alignment:r.calculate_instance_nonant(e,i)}}}return t};r.calculate_fixed_positions=function(e){const t=e.container_corner();const n={};for(const r in e.instances){const i=e.instances[r];if(i.element.added_to_container()){const s=e.to_canvas(i);const o=s.offset();n[r]={top:o.top-t.top,left:o.left-t.left,width:parseInt(s.outerWidth()),height:parseInt(s.outerHeight())}}}return n}},{"../../lang/evaluation/element_edit_eval":689,"core-js/modules/web.dom-collections.iterator.js":1123}],803:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;r.margin_properties=["margin_left","margin_right","margin_top","margin_bottom"];r.container_properties=e=>{var t,n,r;return{"justify-content":(t=e.container_alignment)!=null?t:"","row-gap":e.use_gap?(n=e.row_gap)!=null?n:"":"","column-gap":e.use_gap?(r=e.column_gap)!=null?r:"":""}};function i(e,t){for(const n of["left","top","right","bottom"]){const r=t[`margin_${n}`];e[`margin-${n}`]=r!=null?`${r}px`:""}}r.flex_element_properties=e=>t=>{var n,r,s,o;const a={"align-self":(n=t.align_self)!=null?n:"","min-width":t.min_width,"max-width":(r=t.max_width)!=null?r:"",order:(s=t.order)!=null?s:"","min-height":t.has_fixed_aspect_ratio?"":t.min_height,"max-height":t.has_fixed_aspect_ratio?"":(o=t.max_height)!=null?o:""};if(e==="row"){if(t.fit_width){a.width="max-content";a["flex-grow"]=0}else{a.width=t.min_width;a["flex-grow"]=1}if(t.fit_height||t.has_fixed_aspect_ratio){a.height="max-content"}else if(t.min_height===t.max_height){a.height=t.min_height}else if(t.align_self==="stretch"){a.height="auto"}else{a.height=t.min_height}}else{if(t.fit_height||t.has_fixed_aspect_ratio){a.height="max-content";a["flex-grow"]=0;a["flex-shrink"]=0}else{a.height=t.min_height;a["flex-grow"]=1}if(t.min_width===t.max_width){a.width=t.min_width}else if(t.align_self==="stretch"||t.fit_width){a.width="auto"}else{a.width=`calc(100% - ${t.margin_left+t.margin_right}px)`}}i(a,t);return a};const s={a:"start",b:"center",c:"end"};r.relative_element_properties=function(e){var t,n,r,o;const a={"align-self":s[(t=e.nonant_alignment)==null?void 0:t.charAt(1)],"justify-self":s[(n=e.nonant_alignment)==null?void 0:n.charAt(0)],"min-width":e.min_width,"max-width":(r=e.max_width)!=null?r:"","min-height":e.has_fixed_aspect_ratio?"":e.min_height,"max-height":e.has_fixed_aspect_ratio?"":(o=e.max_height)!=null?o:""};if(e.min_width===e.max_width){a.width=e.min_width}else if(e.fit_width){a.width="max-content"}else{a.width=`calc(100% - ${e.margin_left+e.margin_right}px)`}if(e.fit_height||e.has_fixed_aspect_ratio){a.height="max-content"}else if(e.min_height===e.max_height){a.height=e.min_height}else{a.height=`calc(100% - ${e.margin_top+e.margin_bottom}px)`}i(a,e);return a};r.fixed_element_properties=e=>({top:`${e.top}px`,left:`${e.left}px`,width:`${e.min_width}px`,height:`${e.min_height}px`});r.element_reset={margin:"","align-self":"","justify-self":"","min-width":"","max-width":"",width:"","min-height":"","max-height":"","flex-grow":"",top:"",left:"",right:"",bottom:"",position:""}},{"core-js/modules/web.dom-collections.iterator.js":1123}],804:[function(e,t,n){"use strict";const r=e("./responsive_css");const i=e("../../lang/appquery");const{compare:s}=e("../../u/shared/sorting");const o=n;o.CONTAINER_CLASSES="fixed relative flex row column";function a(e){return(t,n)=>{var r,i,o,a,l,c;return t.get_static_property(e)-n.get_static_property(e)||s((r=(i=t.element_id)==null?void 0:i.call(t))!=null?r:(o=t.id)==null?void 0:o.call(t),(a=(l=n.element_id)==null?void 0:l.call(n))!=null?a:(c=n.id)==null?void 0:c.call(n))}}o.LAYOUT_PROPERTIES={fixed:{classes:"fixed",css_func:r.fixed_element_properties,container_properties:{},element_properties:{top:"top",left:"left"},sort_fn:a("zindex")},relative:{classes:"relative",css_func:r.relative_element_properties,container_properties:{},element_properties:{nonant_alignment:"nonant_alignment"},sort_fn:a("zindex")},row:{classes:"flex row",css_func:r.flex_element_properties("row"),container_properties:{container_horiz_alignment:"container_alignment",use_gap:"use_gap",row_gap:"row_gap",column_gap:"column_gap"},element_properties:{vert_alignment:"align_self",order:"order"},sort_fn:a("order")},column:{classes:"flex column",css_func:r.flex_element_properties("column"),container_properties:{container_vert_alignment:"container_alignment",use_gap:"use_gap",row_gap:"row_gap"},element_properties:{horiz_alignment:"align_self",order:"order"},sort_fn:a("order")},table:{classes:"table",css_fnc:()=>{},container_properties:{},element_properties:{},sort_fn:a("axis_index")},table_cross_axis:{classes:"axis",css_fnc:()=>{},container_properties:{},element_properties:{},sort_fn:(e,t)=>{const n=i.element(e.get_static_property("cell_main_axis_id"));const r=i.element(t.get_static_property("cell_main_axis_id"));return a("axis_index")(n,r)}}};o.LAYOUT_NAMES={fixed:"Fixed",relative:"Align to parent",row:"Row",column:"Column"};o.FLEX_LAYOUTS=["row","column"];o.NON_FIXED_LAYOUTS=["row","column","relative"];o.FIXED_LAYOUT="fixed";o.DIMENSION_TO_CROSS_AXIS={width:"column",height:"row"};o.CONTAINER_PROPERTIES=["container_layout","container_horiz_alignment","container_vert_alignment","use_gap","row_gap","column_gap"]},{"../../lang/appquery":651,"../../u/shared/sorting":853,"./responsive_css":803}],805:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;r.calculate_lines=function(e){const t={elements:{},boxes:{},lines:[]};const{elements:n}=t;const{boxes:r}=t;const{lines:i}=t;const a=e.elements();const l=[];for(const y of a){if(y.exists()&&y.added_to_container()){var c,u,d,p,_,f;const w=(c=y.get_height())!=null?c:0;const x=(u=y.get_top())!=null?u:0;const j=(d=y.get_left())!=null?d:0;const A=(p=y.get_width())!=null?p:0;const M=(_=y.get_zindex())!=null?_:0;let E=(f=y.get_min_width())!=null?f:0;let k=y.get_max_width();if(E>A){E=A}if(k&&k<A){k=A}const O=y.id();l.push(O);const S=[];const D=[];n[O]={ih:w,it:x,il:j,iw:A,iz:M,mw:E,maxw:k,pushes:S,pushed_by:D};const C=y.responsive_show();if(C!=null){n[O].rsw=y.responsive_show_width();if(n[O].rsw){n[O].rs=C}}if(y.get_static_property("wrap_to_previous")){n[O].wtp=true}}}if(l.length===0){return t}l.sort(((e,t)=>n[e].it-n[t].it));function h(e,t){const r={top:n[e].it,top_margin:n[e].it-t,bottom:n[e].it+n[e].ih,contains:[e],boxes:[],topmost:e};i.push(r);return r}let m=l[0];let g=h(m,0);for(const T of l.slice(1)){if(n[T].it<g.bottom){g.contains.push(T);g.bottom=Math.max(g.bottom,n[T].it+n[T].ih)}else{g=h(T,g.bottom)}}function v(e,t){e.contains.push(t);n[t].box=e.box_id;if(n[t].il+n[t].iw>e.right){e.right=n[t].il+n[t].iw;e.rightmost=t}e.min_bottom=Math.max(e.min_bottom,n[t].it+n[t].ih)}let b=0;for(let N=0;N<i.length;N++){const P=i[N];function I(e,t){var i;const o=r[b]={box_id:b,top:P.top,bottom:P.bottom,min_bottom:n[e].it+n[e].ih,left:n[e].il,left_margin:n[e].il-t,right:0,contains:[],first:e,line_idx:N,rightmost:e,leftmost:e};v(o,e);P.boxes.push(b);b++;const a=s.element(e);o.collapse_margin=(i=a.get_static_property("collapse_margin"))!=null?i:null;const l=a.get_static_property("responsive_alignment");if(["left","right"].includes(l)){o.align=l}return o}P.contains.sort(((e,t)=>n[e].il-n[t].il));m=P.contains[0];let R=I(m,0);for(const L of P.contains.slice(1)){if(n[L].il<R.right){v(R,L)}else{R=I(L,R.right)}}P.boxes_length=P.boxes.length;for(let z=0;z<P.boxes.length;z++){const B=P.boxes[z];const q=r[B];for(const F of q.contains){n[F].it-=q.top;n[F].il-=q.left}q.contains.sort(((e,t)=>n[e].it-n[t].it));const U={};U[q.contains[0]]=true;for(const W of q.contains.slice(1)){const $={};const G={};function V(e){if(n[W].it<n[e].it+n[e].ih/2){return false}return n[W].il+n[W].iw>=n[e].il&&n[W].il<=n[e].il+n[e].iw}const H=Object.keys(U);function X(e){for(const t of n[e].pushes){if(G[t]==null&&$[t]==null){X(t)}if($[t]||G[t]){G[e]=true;return}}$[e]=V(e);if(!$[e]){for(const t of n[e].pushed_by){H.push(t)}}}while(H[0]!=null){const Y=H.shift();if(G[Y]==null&&$[Y]==null){X(Y)}}for(const K in $){const J=$[K];if(J){n[K].pushes.push(W);n[W].pushed_by.push(K);delete U[K]}}U[W]=true}q.bottoms=Object.keys(U);q.ih=q.bottom-q.top;q.iw=q.right-q.left;q.line_gap=q.bottom-q.min_bottom;if(z===P.boxes.length-1){q.right_margin=o.get_container_width(e)-q.right}delete q.bottom;delete q.top;delete q.left;delete q.right;delete q.min_bottom}delete P.contains}t.lines_length=i.length;return t};r.build_push_tree=function(e,t){const n={};const r={};const s=e.elements();const o=[];for(const g of s){if(g.exists()&&g.added_to_container()){var a,l,c,u,d;const v=(a=g.get_height())!=null?a:0;const b=(l=g.get_top())!=null?l:0;const y=(c=g.get_left())!=null?c:0;const w=(u=g.get_width())!=null?u:0;const x=(d=g.get_zindex())!=null?d:0;const j=[];const A=[];const M=g.id();o.push(M);n[M]={ih:v,it:b,il:y,iw:w,iz:x,pushes:j,pushed_by:A};r[M]={min_x:y,max_x:y+w}}}const p=function(){let e=0;const r=t!=null?t:{};for(let i=0;i<r.length;i++){const s=r[i];e++;for(const e of["ih","it","il","iw","iz"]){if(t[s][e]!==n[s][e]){return true}}}if(e!==o.length){return true}return false}();if(!p){return null}o.sort(((e,t)=>n[e].it-n[t].it));const _={};_[o[0]]=true;for(const E of o.slice(1)){const k={};const O={};function S(e){if(n[E].it<n[e].it+n[e].ih/2){return false}return n[E].il+n[E].iw>=n[e].il&&n[E].il<=n[e].il+n[e].iw}function D(e){return n[E].il+n[E].iw>=r[e].min_x&&n[E].il<=r[e].max_x}const C=Object.keys(_);function T(e){for(const t of n[e].pushes){if(O[t]==null&&k[t]==null){T(t)}if(k[t]||O[t]){O[e]=true;return}}k[e]=S(e);if(!k[e]){for(const t of n[e].pushed_by){if(D(t)){C.push(t)}}}}while(C[0]!=null){const N=C.shift();if(O[N]==null&&k[N]==null){T(N)}}for(const P in k){const I=k[P];if(I){n[P].pushes.push(E);n[E].pushed_by.push(P);delete _[P];r[E].min_x=Math.min(r[E].min_x,r[P].min_x);r[E].max_x=Math.max(r[E].max_x,r[P].max_x)}}_[E]=true}if(e.E.get_private_messages().includes("movement_in_stripe")){var f,h,m;const R=(f=(h=(m=i.get_stripes(e)).raw)==null?void 0:h.call(m))!=null?f:[];if(R.length){let L=0;const z=[];for(let q=0;q<R.length;q++){const U=R[q];if(U.floating===true&&U.floating_reference!=="top"){z.push({})}else{z.push({top:L,height:U.stripe_height});L+=U.stripe_height}}const B={};for(const F in n){const W=n[F];for(let $=0;$<z.length;$++){const G=z[$];if(!G.top===undefined){continue}const V=W.it+W.ih;if(G.top<=V&&V<G.top+G.height){B[F]=$}}}for(const H in n){const X=n[H];let Y=true;for(const K of X.pushes){if(B[K]===B[H]){Y=false;break}}if(Y){X.pushes_stripe=B[H]}}}}n.container_bottoms=Object.keys(_);return n};const i=e("../core/core_elements/shared/pages");const s=e("../lang/appquery");const o=e("../lang/evaluation/element_edit_eval")},{"../core/core_elements/shared/pages":366,"../lang/appquery":651,"../lang/evaluation/element_edit_eval":689,"core-js/modules/web.dom-collections.iterator.js":1123}],806:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.getPropertyCache=r;function r(e){var t;return(t=window._bubble_watcher_cache)==null?void 0:t[e]}},{}],807:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.fixValue=l;n.toCamelCase=o;n.toClass=i;n.toClassDef=c;n.toDashes=s;e("core-js/modules/es.string.replace.js");var r=e("../../constants/server_rendering");function i(e){return e.replace(/^[\d]|[A-Z]/g,"a$&")}function s(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}function o(e){return e.replace(/-./g,(e=>e[1].toUpperCase()))}const a=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function l(e,t){if(typeof t==="number"&&!a.test(o(e)))return`${t}px`;return t}function c(e,t,n){let s="";function o(e,t){s+=`  ${e}: ${l(e,t)};\n`}function a(e,t){s+=`${e} {\n`;for(const e in t){const n=t[e];if(n!=null&&n!==""){if(Array.isArray(n)){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r!=null&&r!==""){o(e,r)}}}else{o(e,n)}}}s+="}\n"}const c=i(e);a(`.${r.ROOT_CLASS} .bubble-element.${c}`,t);if(n){for(const e in n){let t;if(e.startsWith(r.AT_ROOT)){t=e.replace(r.AT_ROOT,`.${r.ROOT_CLASS}`)}else{t=`.${r.ROOT_CLASS} .${c}${e}`}a(t,n[e])}}return s}},{"../../constants/server_rendering":86,"core-js/modules/es.string.replace.js":1121}],808:[function(e,t,n){"use strict";const r=n;const i=e("../lib");const s=e("../u/shared/async/autorun");const o=e("../core/url_data");const a=e("../lang/btypes");const l=e("../u/shared/uuid");const{re:c}=e("../u/shared/regexUtilities");r.MAX_SLUG_LENGTH=250;const u=c`^(.*-)?${l.uuid_regexp}$`;r.bad_slug_formatting_message=function(e){if(e.length>r.MAX_SLUG_LENGTH){return`The slug value that you have entered contains more than ${r.MAX_SLUG_LENGTH} characters. A slug should have less than ${r.MAX_SLUG_LENGTH} characters.`}if(e.match(u)){return`The slug value that you have entered is not correctly formatted. A slug can't end with a Thing's unique ID.`}const t=o.make_URL_friendly_string(e,r.MAX_SLUG_LENGTH);if(e!==t){return"The slug value that you have entered is not correctly formatted. A slug should be composed of only lowercase letters, digits, or hyphens."}return null};r.format_correctly=function(e){e=o.make_URL_friendly_string(e,r.MAX_SLUG_LENGTH);if(e.length>r.MAX_SLUG_LENGTH){e=e.substring(0,r.MAX_SLUG_LENGTH)}return e};r.get_thing_from_slug=function(e){let{appname:t,app_version:n,type:r,slug_value:s,ignore_privacy_rules:o}=e;if(r==null||s==null){return null}return i.extend({appname:t,app_version:n,ignore_privacy_rules:o},(()=>{var e,t;const n=a.get(r);if(!(n!=null&&(e=n.custom_type())!=null&&e.exists())){return null}const o=i().db_instance().find(r,[{key:"Slug",constraint_type:"equals",value:s}]).get_children(0,1);return(t=o==null?void 0:o[0])!=null?t:null}))};r.get_thing_id_from_slug=function(e){let{appname:t,app_version:n,type:i,slug_value:s,ignore_privacy_rules:o}=e;const l=r.get_thing_from_slug({appname:t,app_version:n,type:i,slug_value:s,ignore_privacy_rules:o});if(l!=null){return l.id}const c=a.get(i);const u=c.get_sample();if(s===(u==null?void 0:u.child("Slug").get())){return u._id()}return null};r.is_slug_unique=function(e){let{appname:t,app_version:n,type:i,slug_value:s,thing:o,ignore_privacy_rules:a}=e;if(s==null||s===""){return true}const l=r.get_thing_id_from_slug({appname:t,app_version:n,type:i,slug_value:s,ignore_privacy_rules:a});if(l!=null){return(o==null?void 0:o._id())===l}return true};r.is_slug_valid=function(e,t,n,i,s){if(i==null||i===""){return true}const o=r.bad_slug_formatting_message(i);if(o!=null){return false}const a=r.is_slug_unique({appname:e,app_version:t,type:n,slug_value:i,thing:s});return a};r.create_slug_watcher=function(){const e=s.Watcher((()=>i().pageparam.get()));let t=null;let n=null;e.on_value((e=>{var r;(r=n)==null?void 0:r.destroy();if(e!=null&&i().location.get_slug_in_url()!=null){t=e.id;n=s.Watcher((()=>e.child("Slug").get()));n.on_value((r=>{let s;if(t!==e.id){return}if(r!=null&&r!==""){s=r}else{var a;const r=i().location.get_underlying_page();const l=i().app().get_page_by_name(r);s=o.get_data_to_send(e,l.get_static_property("readable_field"));(a=n)==null?void 0:a.destroy();t=null;n=null}const l=i().location.get_pieces();if(l.path[1]!==s){l.path[1]=s;const e=i().location.format_pieces(l);i().location.set_url_without_refresh({url:e})}}))}else{t=null;n=null}}))}},{"../core/url_data":416,"../lang/btypes":653,"../lib":741,"../u/shared/async/autorun":830,"../u/shared/regexUtilities":852,"../u/shared/uuid":855}],809:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.is_e2e_test_appname=o;n.is_functional_test_appname=s;e("core-js/modules/web.dom-collections.iterator.js");var r=e("./apps_utilities");var i=e("../constants/test_apps");function s(e){return[i.TEST_APP_KEY,i.OLD_TEST_APP_KEY,...i.FUNCTIONAL_TEST_APPNAME_PREFIXES].some((t=>e.includes(t)))}function o(e){return(0,r.hardcoded_apps)().has(e)&&e.startsWith(i.E2E_TEST_APPS_PREFIX)}},{"../constants/test_apps":91,"./apps_utilities":788,"core-js/modules/web.dom-collections.iterator.js":1123}],810:[function(e,t,n){"use strict";const r=n;r.MISSING_PLUGIN="could not find plugin"},{}],811:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=t.exports;const i=e("../u");const s=e("../assert");const o=e("../u/client/test_state");const a=e("../safe_require");a.safe_register("./test_utilities/testing",r);const l=e("../core/status_bar");const c=e("../webfonts");const u=e("fast-deep-equal");const d=e("../shared/domain_utilities");const p=a.safe_require("./lib");if(i.on_server()){const t=e;i.extend(r,t("./test_lib"))}let _;if(typeof window!=="undefined"&&window!==null){window.testing=r;_=i.MakeSwitch(null,"server_running_key");_.turn_on();$(document).ajaxStart((()=>_.turn_off()));$(document).ajaxStop((()=>_.turn_on()))}r.initialize=function(){const e=i.MakeKeyList([p().workflow.everything_done_key(),_,p().location.open_requests,i.scheduled_key,i.no_outstanding_run_once,l.no_status_bar,c.active_key]);window.everything_ready=()=>e;window.wait_for_everything=t=>setTimeout((()=>{if(e.is_turned()){return t()}else{return window.wait_for_everything(t)}}),100)};r.fail=s.fail;r.assert=s.assert;r.assert_equals=function(e,t,n){console.log(`Asserting equals: ${e}, ${t}`);if(e!==t){r.fail(n!=null?n:`expected:\n${e}\nbut got:\n${t}`)}};r.assert_deep_equals=function(e,t,n){if(!u(e,t)){r.fail(n!=null?n:`expected:\n${JSON.stringify(e)}\nbut got:\n${JSON.stringify(t)}`)}};r.assert_set_equals=function(e,t,n){console.log(`Asserting set equals: [${e.join(", ")}], [${t.join(", ")}]`);const i=[];for(const n of e){if(!t.includes(n)){i.push(n)}}const s=[];for(const n of t){if(!e.includes(n)){s.push(n)}}if(i.length!==0||s.length!==0){let o=(n!=null?n:"Sets are not equal")+"\n";o+="Expected: "+e.join(", ")+"\n";o+="Got: "+t.join(", ")+"\n";if(i.length!==0){o+="Missing Items: "+i.join(", ")+"\n"}if(s.length!==0){o+="Extra Items: "+s.join(", ")+"\n"}r.fail(o)}};r.assert_contains=function(e,t,n){console.log(`Asserting contains: ${e}, ${t}`);if(t.indexOf(e)===-1){r.fail(n!=null?n:`expected it to contain ${e} but got ${t}`)}};r.assert_error=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}const i=Math.max(t.length,1);const s=t.slice(0,i-1);const o=t[i-1];console.log("asserting there is an error...");let a=false;try{o();a=true}catch(e){if(s[0]){if(!(e instanceof s[0])){var l;console.log(e.stack);r.fail(`Expected an instance of ${s[0].prototype.error_class} but got ${e==null?void 0:(l=e.constructor)==null?void 0:l.name}`)}}return e}if(a){r.fail("Expected an error but did not get one")}};r.wait_for=function(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:3e4;const r=setInterval((()=>{if(e()){clearInterval(r);clearTimeout(s);t()}}),500);const s=setTimeout((()=>{clearInterval(r);throw new i.UnexpectedError("Timed out after 30 seconds of waiting for: "+e)}),n)};r.set_domain=function(e){r.DOMAIN=e;const t=d.is_host_aws(e)?"http":"https";r.DOMAIN_PREFIX=`${t}://${r.DOMAIN}/`;r.DOMAIN_PREFIX_DIRECT=`${t}://${r.DOMAIN}`};let f=[];r.log=e=>f.push(e);r.get_log=function(){const e=f;f=[];return e};function h(){if(o.all_page_errors.length>0){var e;const t=o.all_page_errors[0];o.all_page_errors=[];return(e=t.stacktrace)!=null?e:JSON.stringify(t)}return null}let m=null;function g(e){clearInterval(m);m=setInterval((()=>{const t=h();if(t){e(t);clearInterval(m)}}),1e3)}r.SimpleTest=class e{constructor(e,t,n){this._name=e;this.fn=t;this.setup=n}name(){return this._name}run(e){g(e);try{return this.fn((t=>e(t!=null?t:h())))}catch(t){return e(t)}}}},{"../assert":12,"../core/status_bar":415,"../safe_require":777,"../shared/domain_utilities":792,"../u":823,"../u/client/test_state":821,"../webfonts":858,"core-js/modules/web.dom-collections.iterator.js":1123,"fast-deep-equal":1190}],812:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=e("./u/shared/mode_check");const i=e("./u/shared/errors");const s=e("./lang/appquery");r.edit_mode_only();const o=e("./logger");const a=e("./constants/app_json");const l=e("./constants/security");const c=e("./lang/btype_ids");n.TypeStore=class e{add_new_user_type(e,t,n){var r;(r=t)!=null?r:t=false;const u=s.custom_types().length;if(u>900){o.error("USER IS APPROACHING TYPE LIMIT",{type_count:u})}if(u>999){throw new i.OwnerError("You are at the limit of 1000 custom types.  Please contact Bubble for help permanently deleting types you no longer need")}let d;if(t){d=e}else{let t=e.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();if(t.indexOf(l.SECURABLE)===0){t=`x${t}`}let n="";const r=()=>t+n;while(a.PROTECTED_KEYS.has(r())||a.BUBBLE_RESERVED_KEYS.has(r())||s.custom_type(r()).exists()){n=(n||0)+1}d=r()}s.create_custom_type(d,e,null,n);return c.custom_type(d)}add_new_field(e,t,n){var r,s;const l=e.fields().length;if(l>800){o.error("USER IS APPROACHING FIELD LIMIT",{field_count:l,type_name:e.name()})}if(l>999){throw new i.OwnerError("You are at the limit of 1000 fields per type.  Please contact Bubble for help permanently deleting fields you no longer need")}const c=t.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();const u=(r=(s=n.id)==null?void 0:s.call(n))!=null?r:n;const d=u.replace(/[^a-zA-Z0-9]/g,"_");let p="";const _=()=>`${c}${p}_${d}`;while(a.PROTECTED_KEYS.has(_())||a.BUBBLE_RESERVED_KEYS.has(_())||e.reserved_fields().includes(_())||e.field(_()).exists()){p=(p||0)+1}const f=_();e.create_field(f,t,u);return f}};n.sort_types_fn=function(e,t){const r=n.safely_retrieve_display_name(e).toLowerCase();const i=n.safely_retrieve_display_name(t).toLowerCase();if(r<i){return-1}else if(r>i){return 1}else{return 0}};n.safely_retrieve_display_name=function(e){if(e.display()){return e.display()}else if(e.name()==="box_file"){const e=s.securable_type("box","box_file").display();return e}return e.json.__name}},{"./constants/app_json":45,"./constants/security":84,"./lang/appquery":651,"./lang/btype_ids":652,"./logger":744,"./u/shared/errors":846,"./u/shared/mode_check":851,"core-js/modules/es.string.replace.js":1121}],813:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.all_transition_names=void 0;n.apply_css_fallbacks=O;n.apply_scale=k;n.are_animations_running=R;n.bbcode_to_html=G;n.build_key_combo_string=oe;n.console_with_styling=ie;n.create_style_sheet=ne;n.custom_transitions=void 0;n.delay=L;n.did_event_pass_through=C;n.escape=n.div=void 0;n.get_element=le;n.has_bbcode=V;n.highlight_dom_changes=g;n.img=M;n.input=w;n.isScrolledIntoView=K;n.is_attached=D;n.is_fixed=S;n.make_key_combo_listener=ae;n.make_numeric=re;n.make_zindex=Z;n.meta=U;n.pre_json=n.page_loaded_key=n.page_is_loaded=void 0;n.real_inner_width=ee;n.real_inner_width_slow=Q;n.real_inner_width_superfast=te;n.remove_global_cursor=q;n.revealInScreen=J;n.scroll_freeze=X;n.scroll_unfreeze=Y;n.set_global_cursor=B;n.span=void 0;n.text=A;n.textarea=x;n.trigger_blur=T;n.unescape=void 0;n.velocity=I;e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");var r=h(e("../shared/async/b_async"));var i=_(e("./bbcodeparser"));var s=_(e("./customVelocityAnimations"));var o=h(e("../shared/errors"));var a=h(e("../shared/mode_check"));var l=h(e("../shared/uuid"));var c=h(e("./b_window"));var u=h(e("../../constants/workflow"));var d=_(e("lodash/escape"));var p=_(e("lodash/unescape"));function _(e){return e&&e.__esModule?e:{default:e}}function f(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(f=function(e){return e?n:t})(e)}function h(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=f(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}let m=false;function g(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;m=e}if(typeof window!=="undefined"){window.highlight_dom_changes=g}const v=(e,t,n,r)=>E("div",e,t,n,r);n.div=v;const b=(e,t,n,r)=>E("pre",e,t,n,r);n.pre_json=b;const y=(e,t,n,r)=>E("span",e,t,n,r);n.span=y;function w(e,t,n,r,i){const s=E("input",e,t,"",i);s.attr("type",n);s.attr("placeholder",r);if(a.is_edit_mode()||a.is_plugin_edit_mode()){s.attr("autocomplete","new-password");s.attr("name",l.LUID())}return s}function x(e,t,n,r,i){const s=E("textarea",e,t,"",i);s.attr("name",n);s.attr("placeholder",r);return s}function j(e,t){return e.includes(t)}function A(e,t,n,r){const i=["h1","h2","h3","h4","h5"];if(j(i,e)){return E(e,r,t,n)}const s=e;if(r)r=r+" "+(s!=null?s:"");return E("p",r,t,n)}function M(e,t,n,r){const i=E("img",e,t,undefined,r);if(n){i[0].src=n}return i}function E(e,t,n,r,i){if(t==null||t===""){t=[]}if(!Array.isArray(t)){t=[t]}t=t.map((e=>e.replace(".","")));const s=$("<"+e+"></"+e+">");for(const e of t){if(e){s.addClass(e.toLowerCase())}}if(typeof i==="object"){s.css(i)}if(m){s[0].classList.add("highlight-dom-changes");s.one("animationend",(()=>{s[0].classList.remove("highlight-dom-changes")}))}if(n){n.append(s)}if(r!=null){s.text(r)}return s}function k(e,t){const n=`scale(${t},${t})`;const r="0 0";e.css({transform:n,"-ms-transform":n,"-webkit-transform":n,"-o-transform":n,"-moz-transform":n,"tranform-origin":r,"-ms-transform-origin":r,"-webkit-transform-origin":r,"-o-transform-origin":r,"-moz-transform-origin":r})}function O(e,t){var n;if(typeof CSS==="undefined"||typeof CSS.supports!=="function"){return t[t.length-1]}return(n=t.find((t=>typeof t!=="string"||CSS.supports(e,t))))!=null?n:t[t.length-1]}function S(e){let t=e;while(t.length&&!t.is("body")){if(t.css("position")==="fixed"){return true}t=t.parent()}return false}function D(e){return e.closest("html").length>0}function C(e,t){var n;if(e.currentTarget===null)return false;let r;if(typeof t==="string"){r=e=>e.is(t)}else{r=t}let i=$((n=e.target)!=null?n:undefined);while(i[0]!=null&&i[0]!==e.currentTarget){if(r(i)){return true}i=i.parent()}return false}function T(e){var t,n;if(((t=window.BrowserDetect)==null?void 0:t.OS)==="iPhone/iPod"&&((n=window.BrowserDetect)==null?void 0:n.browser)==="Safari"){e.blur();return}const r=$('<input class="fake-input"></input>');if(c.is_on_mobile_or_tablet()){r.attr("readonly","true")}r.css({top:$(window).scrollTop()+5,left:10,position:"absolute",overflow:"hidden",width:0,"font-size":"40px"});$("body").append(r);r.focus();r.blur();r.remove()}let N=false;let P=false;function I(e,t,n){if(!e||!e.length){var r;(r=n.complete_cb)==null?void 0:r.call(n);return}if(e.velocity==null){if(!P){P=true;window.alert("Some code is overwriting jQuery which prevents your app from working normally. Please check your application in the editor and make sure you are not requiring a version of jQuery in the page/app headers or in a plugin. \n\nYou can use Bubble safe mode to test your application (hover on PREVIEW).")}return}if(n.complete){throw new o.UnexpectedError("b_ui.velocity called with complete, it should be complete_cb not to be overwritten")}if(typeof n!=="object"){throw new o.UnexpectedError(`b_ui.velocity called with options not being an object, will break ${String(n)}`)}if($.fx.off){n.duration=0}n.complete=function(){var e;(e=n.complete_cb)==null?void 0:e.call(n);N=false};N=true;return e.velocity(t,n)}function R(){return N}function L(e,t){e.css("fake_css_nonsense",100);void I(e,{fake_css_nonsense:0},{duration:t})}let z;function B(e){if(!z){z=$("<style></style>")}z.text(`* { cursor: ${e} !important; }`);$(document.head).append(z)}function q(){var e;(e=z)==null?void 0:e.remove()}function U(e){return e.metaKey||e.ctrlKey}const F=d.default;n.escape=F;const W=p.default;n.unescape=W;function G(e,t){var n,r;(n=e)!=null?n:e="";(r=t)!=null?r:t=false;let s=e;s=s.replace(/&#x2F;/g,"/");return i.default.fromBB_to_HTML(s,t)}function V(e){var t;(t=e)!=null?t:e="";return i.default.probably_has_bbcode(e)}let H;function X(){H=$(document).scrollTop()}function Y(){$(document).scrollTop(H)}function K(e,t){var n;let r,i,s;(n=t)!=null?n:t=window;if(e.length===0){return{status:true}}if(t===window||!e.parents(t+":visible").length){s=$(window);i=$(s).scrollTop();r=i+s.height()-30}else{s=e.parents(t+":visible");i=Math.max(s.offset().top,$(window).scrollTop());r=Math.min(i+s.height(),$(window).scrollTop()+$(window).height()-40)}const o=$(e).offset().top;const a=o+$(e).height();if(a<=r&&o>=i){return{status:true}}else{return{status:false,side:a>r?"bottom":"top"}}}function J(e,t,n){var r;(r=t)!=null?r:t=window;if(e==null||!e.length||e==="destroyed"){return}if(n==null){var i,s;n=(i=e.offset)==null?void 0:(s=i.call(e))==null?void 0:s.top;if(n==null){return}if(t!==window){const e=$(t+":visible");n=n+e.scrollTop()-e.offset().top}}if(!K(e,t).status){try{if(t!==window){$(t+":visible").scrollTop(n-20)}else{$(document).scrollTop(n-100)}}catch(e){}}}function Z(e){let t=20;let n=e;while(n.length>0&&n[0]!==document){let e=parseFloat(n.css("z-index"));if(isNaN(e)){e=0}if(e>t){t=e}n=n.parent()}return t+1}function Q(e){if(e==="destroyed"){return}const t=v("measure",e);const n=t.width();t.remove();if(n===0){const t=e.width();if(t===100&&e.css("width")==="100%"){return}return e.width()}else{return n}}function ee(e){if(e==="destroyed")return;const t=e[0].clientWidth;if(t===0)return e.innerWidth();const n=e[0].scrollHeight>e[0].clientHeight;const{overflowY:r}=window.getComputedStyle(e[0]);const i=r==="scroll"||n&&r==="auto";if(i)return t;const{width:s}=e[0].getBoundingClientRect();const{borderRightWidth:o,borderLeftWidth:a,paddingLeft:l,paddingRight:c}=window.getComputedStyle(e[0]);const u=parseFloat(o)+parseFloat(a);const d=parseFloat(l)+parseFloat(c);return s-u-d}function te(e){if(e==="destroyed")return;const t=e[0].clientWidth;if(t>0)return t;return Math.round(e.innerWidth())}function ne(e){const t=document.createElement("style");t.type="text/css";t.innerHTML=e;document.getElementsByTagName("head")[0].appendChild(t)}function re(e,t){e.keydown((e=>{let n;if((e.keyCode>=65&&e.keyCode<=90||[186,191,219,220,221,222,187].includes(e.keyCode))&&!e.ctrlKey&&!e.altKey&&!e.metaKey){n=true}if(t&&e.keyCode===190){n=true}if(n){e.preventDefault()}}))}function ie(e){console.log("");console.log("%c"+e,["background: #0205D3","color: white","display: block","text-align: center","font-weight: bold","padding: 7px","border-radius: 2px"].join(";"));console.log("")}function se(e){return e==="Shift"||e==="Alt"||e==="Meta"||e==="Control"}function oe(e){const t=[];if(e.ctrlKey){t.push("Ctrl")}if(e.metaKey){t.push("Meta")}if(e.shiftKey){t.push("Shift")}if(e.altKey){t.push("Alt")}const n=e=>/^([a-z0-9A-Z\\\][';/.,`]{1}$)/.test(e);if(!se(e.key)){if(n(e.key)){t.push(e.key)}else if(u.KEY_CODE_TO_CHAR[e.key]){t.push(u.KEY_CODE_TO_CHAR[e.key])}else if(u.KEY_CODE_TO_CHAR[e.code]){t.push(u.KEY_CODE_TO_CHAR[e.code])}else if(n(String.fromCharCode(e.keyCode))&&e.key!=="Dead"){t.push(String.fromCharCode(e.keyCode))}}let r="";for(let e=0;e<t.length;e++){let n=t[e];if(n==="Meta"){var i,s;if(((i=window)==null?void 0:(s=i.BrowserDetect)==null?void 0:s.OS)==="Windows"){n="WindowsKey"}else{n="Command"}}else if(n==="Alt"){var o,a;if(((o=window)==null?void 0:(a=o.BrowserDetect)==null?void 0:a.OS)==="Windows"){n="Alt"}else{n="Option"}}if(e>0){r+="+"+n}else{r+=n}}return r}function ae(e){const t=t=>{t.stopPropagation();t.preventDefault();e.val(oe(t));e.on("blur",(()=>e.trigger("change")))};e[0].addEventListener("keydown",t)}function le(e){if(typeof e==="string"){e=$(e)}if(a.is_edit_mode()){if(!e.hasClass("inner-element")){e=e.parents(".inner-element").first()}const t=e.attr("id");if(!t){return"not found -- should be a div with the inner-element class"}return window.appquery.element(t)}else{var t,n,r;if(!e.hasClass("bubble-element")){e=e.parents(".bubble-element").first()}return(t=(n=e[0])==null?void 0:(r=n.bubble_data)==null?void 0:r.bubble_instance)!=null?t:"not found -- should be a div with the bubble-element class"}}const ce=s.default.customTransitions;n.custom_transitions=ce;const ue=s.default.allTransitionNames;n.all_transition_names=ue;let de;n.page_loaded_key=de;let pe;n.page_is_loaded=pe;if(typeof window!=="undefined"){const e=n.page_loaded_key=de=r.MakeKey(undefined,"b_ui.page_loaded_key");const t=Date.now();n.page_is_loaded=pe=function(){e.turn();$(document.body).append(v("page-is-loaded"));console.log(`page is loaded after ${(Date.now()-t)/1e3} seconds`)}}},{"../../constants/workflow":95,"../shared/async/b_async":832,"../shared/errors":846,"../shared/mode_check":851,"../shared/uuid":855,"./b_window":814,"./bbcodeparser":815,"./customVelocityAnimations":818,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"lodash/escape":1313,"lodash/unescape":1339}],814:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.get_source_appname_from_data=n.base64decode=n.base64=n.add_source_appname_tracker_to_change_args=n.add_source_appname_tracker=void 0;n.is_android=u;n.is_fullscreen=p;n.is_on_mobile_or_tablet=d;n.maybe_add_source_appname_to_object=void 0;var r=o(e("./customVelocityAnimations"));var i=e("js-base64");var s;function o(e){return e&&e.__esModule?e:{default:e}}if(typeof window!=="undefined"){e("../../../vendor/jquery_plugins/jquery.dotdotdot-1.5.6.js");e("../../../vendor/jquery_plugins/jquery.velocity.min.js");e("../../../vendor/jquery_plugins/jquery.velocity.ui.min.js");r.default.injectTransitions()}(s=Number.isNaN)!=null?s:Number.isNaN=e=>typeof e==="number"&&isNaN(e);let a=false;let l=false;function c(){if(typeof window!=="undefined"&&typeof navigator!=="undefined"){function e(){const e=navigator.userAgent||navigator.vendor;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ipad|playbook|silk|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.substr(0,4))){return true}return false}l=e();const t=navigator.userAgent;const n=/iemobile/i.test(t);a=/android/i.test(t)&&!n}}c();function u(){return a}function d(){return l}function p(){return Boolean(typeof document!=="undefined"&&(document.fullscreenElement!=null||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement))}function _(){window.BrowserDetect={browser:"",version:0,OS:"",versionSearchString:"",init(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString(e){for(let t=0;t<e.length;t++){const n=e[t].string;const r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.includes(e[t].subString)){return e[t].identity}}else if(r){return e[t].identity}}return undefined},searchVersion(e){const t=e.indexOf(this.versionSearchString);if(t===-1)return;return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};window.BrowserDetect.init()}if(typeof window!=="undefined"){_()}let f;n.base64=f;let h;n.base64decode=h;let m;n.add_source_appname_tracker=m;let g;n.maybe_add_source_appname_to_object=g;let v;n.get_source_appname_from_data=v;let b;n.add_source_appname_tracker_to_change_args=b;if(typeof window!=="undefined"){n.base64=f=e=>i.Base64.encode(e);n.base64decode=h=e=>i.Base64.decode(e);n.add_source_appname_tracker=m=(e,t)=>{if(e){e.said=f(t)}};n.maybe_add_source_appname_to_object=g=(e,t,n)=>{if(!e||!n){return}if(n!==t){e.source_appname=n}};const e=e=>{if(e){delete e.said}};n.get_source_appname_from_data=v=e=>e!=null&&e.said?h(e.said):undefined;n.add_source_appname_tracker_to_change_args=b=(t,n,r)=>{const i=v(t);g(n,r,i);e(t)}}},{"../../../vendor/jquery_plugins/jquery.dotdotdot-1.5.6.js":2350,"../../../vendor/jquery_plugins/jquery.velocity.min.js":2351,"../../../vendor/jquery_plugins/jquery.velocity.ui.min.js":2352,"./customVelocityAnimations":818,"js-base64":1199}],815:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");var r=true,i=false,s=false,r=false,o=true,a=true,l=true;var c=false;var u={always:1,never:2,auto:3};var d=function(e){return e?e.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2"):e};var p=function(){var e=arguments;return e[0].replace(/\{(\d+)\}/g,(function(t,n){return typeof e[n-0+1]!=="undefined"?e[n-0+1]:"{"+n+"}"}))};var _=function(e){var t,n;n=function(e){e=parseInt(e,10);if(isNaN(e))return"00";e=Math.max(0,Math.min(e,255)).toString(16);return e.length<2?"0"+e:e};e=e||"#000";if(t=e.match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))return"#"+n(t[1])+n(t[2]-0)+n(t[3]-0);if(t=e.match(/#([0-f])([0-f])([0-f])\s*?$/i))return"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3];return e};var f=["decimal","lower-alpha","lower-roman"];var h=function(e){while(f.length<=e){f.push("decimal","lower-alpha","lower-roman")}return f[e]};var m=function(e){if(!e)return e;return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ {2}/g," &nbsp;").replace(/\r\n|\r/g,"\n").replace(/\n/g,"<br />")};var g=function(e,t){var n=A(w(e));if(o)C(n);if(a)T(n);if(l)N(n);S(n,null,t);if(a)T(n);return n};var v={open:"open",content:"content",newline:"newline",close:"close"};var b=function(e,t,n){var r=n.length;while(r--)if(n[r].type===t&&n[r].name===e)return true;return false};var y=function(e,t,n,r,i,s){var o=this;o.type=e;o.name=t;o.val=n;o.attrs=r||{};o.children=i||[];o.closing=s||null};y.prototype={clone:function(e){var t=this;return new y(t.type,t.name,t.val,t.attrs,e?t.children:[],t.closing?t.closing.clone():null)},splitAt:function(e){var t,n=this,r=0,i=n.children.length;if(typeof object!=="number")e=n.children.indexOf(e);if(e<0||e>i)return null;while(i--){if(i>=e)r++;else i=0}t=n.clone();t.children=n.children.splice(e,r);return t}};var w=function(e){var t,n,r,i=[],s=[{type:"close",regex:/^\[\/[^\[\]]+\]/},{type:"open",regex:/^\[[^\[\]]+\]/},{type:"newline",regex:/^(\r\n|\r|\n)/},{type:"content",regex:/^([^\[\r\n]+|\[)/}];s.reverse();e:while(e.length){r=s.length;while(r--){n=s[r].type;if(!(t=e.match(s[r].regex))||!t[0])continue;i.push(x(n,t[0]));e=e.substr(t[0].length);continue e}if(e.length)i.push(x(v.content,e));e=""}return i};var x=function(e,t){var n,r,i;if(e==="open"&&(n=t.match(/\[([^\]\s=]+)(?:([^\]]+))?\]/))){i=O(n[1]);if(n[2]&&(n[2]=n[2].replace(/^\s\s*/,"").replace(/\s\s*$/,"")))r=j(n[2])}else if(e==="close"&&(n=t.match(/\[\/([^\[\]]+)\]/)))i=O(n[1]);else if(e==="newline")i="#newline";if(!i||(e==="open"||e==="close")&&!I()[i]){e="content";i="#"}return new y(e,i,t,r)};var j=function(e){var t,n=/([^\s=]+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|((?:.(?!\s\S+=))*.))/g,r=d,i={};if(e.charAt(0)==="="&&e.indexOf("=",1)<0)i.defaultattr=r(e.substr(1));else{if(e.charAt(0)==="=")e="defaultattr"+e;while(t=n.exec(e))i[O(t[1])]=r(t[3])||t[4]}return i};var A=function(e){var t,n,i,s,o,a,l,c=[],u=[],d=[],p=function(){return k(d)},_=function(e){if(p())p().children.push(e);else u.push(e)},f=function(e){return p()&&(n=I()[p().name])&&n.closedBy&&n.closedBy.indexOf(e)>-1};while(t=e.shift()){l=e[0];switch(t.type){case v.open:if(f(t.name))d.pop();_(t);n=I()[t.name];if((!n||!n.isSelfClosing)&&(n.closedBy||b(t.name,v.close,e)))d.push(t);else if(!n||!n.isSelfClosing)t.type=v.content;break;case v.close:if(p()&&t.name!==p().name&&f("/"+t.name))d.pop();if(p()&&t.name===p().name){p().closing=t;d.pop()}else if(b(t.name,v.open,d)){while(i=d.pop()){if(i.name===t.name){i.closing=t;break}s=i.clone();if(c.length>1)s.children.push(k(c));c.push(s)}_(k(c));o=c.length;while(o--)d.push(c[o]);c.length=0}else{t.type=v.content;_(t)}break;case v.newline:if(p()&&l&&f((l.type===v.close?"/":"")+l.name)){if(!(l.type===v.close&&l.name===p().name)){n=I()[p().name];if(n&&n.breakAfter)d.pop();else if(n&&n.isInline===false&&r&&n.breakAfter!==false)d.pop()}}_(t);break;default:_(t);break}a=t}return u};var M={always:1,never:2,auto:3};var E=function(e,t,n){var r=/\s|=/.test(e);if(typeof t=="function")return t(e,n);if(t===M.never||t===M.auto&&!r)return e;return'"'+e.replace("\\","\\\\").replace('"','\\"')+'"'};var k=function(e){if(e.length)return e[e.length-1];return null};var O=function(e){return e.toLowerCase()};var S=function(e,t,n){var o,a,l,c,u,d,p,_,f=e.length,h=f;if(t)c=I()[t.name];while(h--){if(!(o=e[h]))continue;if(o.type===v.newline){a=h>0?e[h-1]:null;l=h<f-1?e[h+1]:null;_=false;if(!n&&c&&c.isSelfClosing!==true){if(!a){if(c.isInline===false&&i&&c.breakStart!==false)_=true;if(c.breakStart)_=true}else if(!d&&!l){if(c.isInline===false&&s&&c.breakEnd!==false)_=true;if(c.breakEnd)_=true;d=_}}if(a&&a.type===v.open){if(u=I()[a.name]){if(!n){if(u.isInline===false&&r&&u.breakAfter!==false)_=true;if(u.breakAfter)_=true}else if(u.isInline===false)_=true}}if(!n&&!p&&l&&l.type===v.open){if(u=I()[l.name]){if(u.isInline===false&&false&&u.breakBefore!==false)_=true;if(u.breakBefore)_=true;p=_;if(_){e.splice(h,1);continue}}}if(_)e.splice(h,1);p=false}else if(o.type===v.open)S(o.children,o,n)}};var D=function(e,t){var n,r,i,s,o,a,l,u,d=[];l=function(e){return(!e||(typeof e.isHtmlInline!=="undefined"?e.isHtmlInline:e.isInline))!==false};while(e.length>0){if(!(n=e.shift()))continue;if(n.type===v.open){u=n.children[n.children.length-1]||{};r=I()[n.name];o=t&&l(r);i=D(n.children,false);if(r&&r.html){if(!l(r)&&l(I()[u.name])&&!r.isPreFormatted&&!r.skipLastLineBreak){i+="<br />"}if(typeof r.html=="function")s=r.html(n,n.attrs,i);else s=p(r.html,i)}else s=n.val+i+(n.closing?n.closing.val:"")}else if(n.type===v.newline){if(t&&a==false){d.push("<br />");continue}if(!a&&!c){d.push("<div>");a=true}if(a)d.push("</div>");d.push("\n");a=false;continue}else{o=t;s=m(n.val)}if(!o&&a){d.push("</div>\n");a=false}d.push(s)}if(a)d.push("</div>\n");return d.join("")};var C=function(e,t){var n,r,i=e.length;while(i--){if(!(n=e[i]))continue;if(!P(t,n)){n.name=null;n.type=v.content;if(P(t,n)){r=[i+1,0].concat(n.children);if(n.closing){n.closing.name=null;n.closing.type=v.content;r.push(n.closing)}i+=r.length-1;Array.prototype.splice.apply(e,r)}else t.children.splice(i,1)}if(n.type===v.open)C(n.children,n)}};var T=function(e){var t,n,r,i=e.length;r=function(e){var t=e.length;while(t--){if(e[t].type===v.open)return false;if(e[t].type===v.close)return false;if(e[t].type===v.content&&e[t].val&&/\S|\u00A0/.test(e[t].val))return false}return true};while(i--){if(!(t=e[i])||t.type!==v.open)continue;n=I()[t.name];T(t.children);if(r(t.children)&&n&&!n.isSelfClosing&&!n.allowsEmpty)e.splice.apply(e,[i,1].concat(t.children))}};var N=function(e,t,n,r){var i,s,o,a,l,c,u=function(e){var t=I()[e.name];return!t||t.isInline!==false};t=t||[];r=r||e;for(s=0;s<e.length;s++){if(!(i=e[s])||i.type!==v.open)continue;if(!u(i)&&n){o=k(t);c=o.splitAt(i);l=t.length>1?t[t.length-2].children:r;if((a=l.indexOf(o))>-1){c.children.splice(c.children.indexOf(i),1);l.splice(a+1,0,i,c);return}}t.push(i);N(i.children,t,n||u(i),r);t.pop(i)}};var P=function(e,t){var n=e?I()[e.name]:null,r=n?n.allowedChildren:null;if(!o||!r)return true;if(r&&r.indexOf(t.name||"#")<0)return false;return true};var I=function(){return{b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},em:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},quoteType:u.never,format:function(e,t){var n;if(e[0].nodeName.toLowerCase()!=="font"||!(n=e.attr("face")))n=e.css("font-family");return"[font="+d(n)+"]"+t+"[/font]"},html:function(e,t,n){return'<font face="'+t.defaultattr+'">'+n+"</font>"}},h1:{tags:{h1:null},styles:{"font-size":null},format:"[h1]{0}[/h1]",html:function(e,t,n){return'<span style="font-size:2.2em">'+n+"</span>"}},h2:{tags:{h2:null},styles:{"font-size":null},format:"[h2]{0}[/h2]",html:function(e,t,n){return'<span style="font-size:1.7em">'+n+"</span>"}},h3:{tags:{h3:null},styles:{"font-size":null},format:"[h3]{0}[/h3]",html:function(e,t,n){return'<span style="font-size:1.17em">'+n+"</span>"}},h4:{tags:{h4:null},styles:{"font-size":null},format:"[h4]{0}[/h4]",html:function(e,t,n){return'<span style="font-size:1em">'+n+"</span>"}},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(e,t){var n=e.attr("size"),r=1;if(!n)n=e.css("fontSize");if(n.indexOf("px")>-1){n=n.replace("px","")-0;if(n>12)r=2;if(n>15)r=3;if(n>17)r=4;if(n>23)r=5;if(n>31)r=6;if(n>47)r=7}else r=n;return"[size="+r+"]"+t+"[/size]"},html:function(e,t,n){return'<font size="'+t.defaultattr+'">'+n+"</font>"}},color:{tags:{font:{color:null}},styles:{color:null},quoteType:u.never,html:function(e,t,n){return'<font color="'+_(t.defaultattr)+'">'+n+"</font>"}},highlight:{tags:{font:{color:null}},styles:{color:null},quoteType:u.never,html:function(e,t,n){return'<span style="background:'+_(t.defaultattr)+'">'+n+"</span>"}},ul:{tags:{ul:null},breakStart:true,isInline:false,skipLastLineBreak:true,html:"<ul>{0}</ul>"},ml:{tags:{ml:null},html:""},list:{breakStart:true,isInline:false,skipLastLineBreak:true,html:function(e,t,n){var r={1:"decimal",a:"lower-alpha",A:"upper-alpha",i:"lower-roman",I:"upper-roman"};if(t.defaultattr!=null&&r[t.defaultattr]!=null){var i=r[t.defaultattr];return'<ol style="list-style-type:'+i+'">'+n+"</ol>"}return"<ul>"+n+"</ul>"}},ol:{tags:{ol:null},breakStart:true,isInline:false,skipLastLineBreak:true,html:function(e,t,n){if(typeof t.data!=="undefined"){var r=Number(t.data);return'<ol style="list-style-type:'+h(r)+';">'+n+"</ol>"}else{return"<ol>"+n+"</ol>"}}},li:{tags:{li:null},isInline:false,closedBy:["/ul","/ol","/list","*","li"],html:function(e,t,n){if(typeof t.align!=="undefined"){return'<li style="text-align:'+t.align+';">'+n+"</li>"}else{return"<li>"+n+"</li>"}}},"*":{isInline:false,closedBy:["/ul","/ol","/list","*","li"],html:"<li>{0}</li>"},table:{tags:{table:null},isInline:false,isHtmlInline:true,skipLastLineBreak:true,html:"<table>{0}</table>"},tr:{tags:{tr:null},isInline:false,skipLastLineBreak:true,html:"<tr>{0}</tr>"},th:{tags:{th:null},allowsEmpty:true,isInline:false,html:"<th>{0}</th>"},td:{tags:{td:null},allowsEmpty:true,isInline:false,html:"<td>{0}</td>"},emoticon:{allowsEmpty:true,tags:{img:{src:null,"data-sceditor-emoticon":null}},html:"{0}"},hr:{tags:{hr:null},allowsEmpty:true,isSelfClosing:true,isInline:false,html:"<hr />"},img:{allowsEmpty:true,tags:{img:{src:null}},quoteType:u.never,html:function(e,t,n){var r,i="";if(typeof t.width!=="undefined")i+=' width="'+t.width+'"';if(typeof t.height!=="undefined")i+=' height="'+t.height+'"';if(t.defaultattr){r=t.defaultattr.split(/x/i);i=' width="'+r[0]+'"'+' height="'+(r.length===2?r[1]:r[0])+'"'}if(t.alt){i+=' alt="'+t.alt+'"'}if(typeof window==="undefined"&&n.indexOf("http:")===-1&&n.indexOf("https:")===-1){n="http:"+n}return"<img"+i+' src="'+n+'" />'}},link:{allowsEmpty:true,tags:{a:{href:null}},quoteType:u.never,html:function(e,t,n){return'<a href="'+encodeURI(t.defaultattr||n)+'" target="_blank">'+n+"</a>"}},url:{allowsEmpty:true,tags:{a:{href:null}},quoteType:u.never,html:function(e,t,n){var r,i;if(typeof t.target=="undefined")r="_blank";else r=t.target;i='<a href="'+(t.defaultattr||n)+'" target='+r;if(typeof t.nofollow!="undefined")i=i+' rel="nofollow"';i=i+">"+n+"</a>";return i}},email:{quoteType:u.never,html:function(e,t,n){return'<a href="mailto:'+(t.defaultattr||n)+'" target = "_blank">'+n+"</a>"}},quote:{tags:{blockquote:null},isInline:false,quoteType:u.never,html:function(e,t,n){if(t.defaultattr)n='<cite style="border-left: 4px solid #ccc;margin-bottom: 5px;margin-top: 5px;padding-left: 16px;">'+t.defaultattr+"</cite>"+n;return'<blockquote style="border-left: 4px solid #ccc;margin-bottom: 5px;margin-top: 5px;padding-left: 16px;">'+n+"</blockquote>"}},indent:{tags:{indent:null},isInline:true,html:function(e,t,n){var r="<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";if(typeof t.data!=="undefined"){var i=Number(t.data);var s="";var o=1;while(o<=i){s+=r;o+=1}return s+n}else{return n}}},code:{tags:{code:null},isInline:false,allowedChildren:["#","#newline"],html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:false,html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:false,html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:false,html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:false,html:'<div align="justify" '+(c?'style="white-space: pre-line"':"")+">{0}</div>"},youtube:{allowsEmpty:true,tags:{iframe:{"data-youtube-id":null}},html:'<iframe width="560" height="315" src="//www.youtube.com/embed/{0}?wmode=opaque'+'" data-youtube-id="{0}" frameborder="0" allowfullscreen></iframe>'},video:{allowsEmpty:true,html:'<iframe width="560" height="315" src="{0}" frameborder="0" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},html:'<div style="direction: ltr">{0}</div>'},fa:{quoteType:u.never,html:function(e,t,n){return'<div class="fa fa-'+(t.defaultattr||n)+'"></div>'}},ignore:{}}};var R=function(e){var t,n,r,i=$("<div />").hide().appendTo(document.body),s=i[0];r=function(e,t){if(e.childNodes.length!==1||!$(e.firstChild).is("br")){while(n=e.firstChild)s.insertBefore(n,e)}if(t){var r=s.lastChild;if(e!==r&&$(r).is("div")&&e.nextSibling===r)s.insertBefore(document.createElement("br"),e)}s.removeChild(e)};s.innerHTML=e.replace(/<\/div>\n/g,"</div>");if((t=s.firstChild)&&$(t).is("div"))r(t,true);if((t=s.lastChild)&&$(t).is("div"))r(t);s=s.innerHTML;i.remove();return s};var L=function(e,t){return D(g(e,t),true)};var z=L;n.fromBB_to_HTML=function(e,t){c=t;return z(e,true)};var B=/\[\/([^\]]{1,20})\]/;n.probably_has_bbcode=function(e){return!!e.match(B)}},{"core-js/modules/es.string.replace.js":1121}],816:[function(e,t,n){(function(t){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.approve_global_clipboard=W;n.clipboard_script=void 0;n.cookies_enabled=z;n.copy_on_click=X;n.createCookie=I;n.eraseCookie=L;n.events=void 0;n.get_active_epoch=K;n.get_all_cookies=B;n.handle_clipboard_message=H;n.initialize_global_clipboard=V;n.local_data_retrieve=b;n.local_data_store=v;n.local_storage_get=j;n.local_storage_is_available=y;n.local_storage_put=w;n.local_storage_put_object=x;n.readCookie=R;n.rebuild_cookies=P;n.session_storage=void 0;n.set_active_epoch=J;e("core-js/modules/web.dom-collections.iterator.js");var r=f(e("events"));var i=_(e("../shared/b_string"));var s=_(e("../../constants/domain"));var o=_(e("../../shared/domain_utilities"));var a=_(e("../shared/errors"));var l=_(e("../../logger"));var c=_(e("../shared/mode_check"));var u=_(e("../shared/uuid"));var d=e("../../constants/time");function p(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(p=function(e){return e?n:t})(e)}function _(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=p(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function f(e){return e&&e.__esModule?e:{default:e}}const h=new r.default.EventEmitter;n.events=h;let m;n.session_storage=m;try{var g;n.session_storage=m=(g=window)==null?void 0:g.sessionStorage}catch(e){}function v(e,t){const n=u.LUID();w(n,e,t);return n}function b(e){var n;const r=j(e);if(((n=window)==null?void 0:n.localStorage)==null){t.local_storage_fallback(e,null,true)}else{window.localStorage.removeItem(e)}return r}t.local_storage_fallback=(e,t,n)=>{throw new a.UnexpectedError("trying to store into localstorage, but it does not exist")};function y(){var e;const t=u.LUID();if(((e=window)==null?void 0:e.localStorage)!=null){try{window.localStorage.setItem(t,"testing-localstorage");window.localStorage.removeItem(t);return true}catch(e){return false}}return false}function w(e,t,n,r){x({key:e,data:t,show_warning:n,skip_global:r})}function x(e){var n;let{key:r,data:i,show_warning:s,skip_global:o,on_quota_exceeded_fn:l}=e;if(!o&&q(r)){F(r,i)}const c=JSON.stringify(i);if(((n=window)==null?void 0:n.localStorage)==null){t.local_storage_fallback(r,c)}else{try{window.localStorage.setItem(r,c)}catch(e){const t=e;if(l&&t.message.includes("exceeded the quota")){const e=window.localStorage.getItem(r);const t=e?e.length+r.length:0;const n=S();l(n+t);return}console.log(t.stack);console.log("clearing local storage");h.emit("pre_clear");window.localStorage.clear();h.emit("clear");try{window.localStorage.setItem(r,c)}catch(e){if(s){var u,d;let e;if(((u=window)==null?void 0:(d=u.BrowserDetect)==null?void 0:d.browser)==="Safari"){e="Safari in private mode does not support local storage, which prevents the workflow from running properly."}else{e="This browser does not support local storage, which prevents the workflow from running properly."}throw new a.UserError(undefined,e)}else{throw new a.UnexpectedError(`Second local storage failure.  Encoded size is ${c.length}, and message was: ${e.message}. key was ' +\n              ${r} and data was: ${c.slice(0,2e3)}`)}}}}}function j(e){try{if(typeof window==="undefined"){return JSON.parse(t.local_storage_fallback(e))}if(window.localStorage==null){l.info("no local storage present");return null}else{var n;return JSON.parse((n=window.localStorage.getItem(e))!=null?n:"null")}}catch(e){l.info("cannot read local storage",{error:a.ensure_bubble_error(e)});return null}}const A=()=>Object.entries(window.localStorage).reduce(((e,t)=>{let[n,r]=t;return e+n.length+r.length}),0);const M=1e3;const E=10*1e3*1e3;let k;const O=()=>{if(!k){let e=A();let t=E;const n=Array(t-e+1).join("0");const r=u.LUID();let i;while(t-e>M){i=Math.floor((t+e)/2);try{window.localStorage.setItem(r,n.slice(0,i));e=i}catch{t=i}}window.localStorage.removeItem(r);k=e}return k};const S=()=>O()-A();function D(e,t,n){const r=e.split(t);const i=[];i.push(...r.slice(0,n));i.push(r.slice(n).join(t));return i}let C=null;let T=false;let N=false;function P(){C={};if(c.on_phonegap()){for(const e in window.localStorage){const t=window.localStorage[e];C[e]=t}}else{var e;for(const e of document.cookie.split(";")){const[t,n]=D(e.trim(),"=",1);C[t]=n}T=((e=document.cookie)==null?void 0:e.length)>0;if(!T){document.cookie="testcookie=hello";T=document.cookie.includes("testcookie");document.cookie="testcookie=; expires=Thu, 01 Jan 1970 00:00:01 GMT"}}N=true}function I(e,t,n){if(c.on_phonegap()){window.localStorage.setItem(e,t)}else{let r,s;if(n===-1){r="; expires=Thu, 01 Jan 1970 00:00:01 GMT"}else if(n){const e=new Date(Date.now()+n*d.DAY_MS);r="; expires="+e.toUTCString()}else{r=""}if(i.starts_with(window.document.location.href,"https://")){s="; secure; SameSite=Lax"}else{s=""}document.cookie=e+"="+t+r+"; path=/"+s}C=null}function R(e){var t;if(!C){P()}return(t=C[e])!=null?t:null}function L(e){I(e,"",-1)}function z(){if(!N){P()}return c.on_phonegap()||T}function B(){if(!C){P()}return Object.keys(C)}function q(e){return c.is_edit_mode()&&e.includes("clipboard")}let U;function F(e,t){var n,r;V();const i=Date.now();window.localStorage["_this_session_clipboard_"+e]=i;(n=U)==null?void 0:(r=n[0].contentWindow)==null?void 0:r.postMessage({action:"global_clipboard_put",key:e,data:t,timestamp:i,id:u.UUID()},s.META_ORIGIN)}function W(e){const t=window.localStorage.global_clipboard_approved?JSON.parse(window.localStorage.global_clipboard_approved):[];t.push(e);console.log("Approved origin "+e+" on this computer.  Please refresh your editor window");window.localStorage.global_clipboard_approved=JSON.stringify(t)}const G=`\nvar _dead = false;\nfunction receiveMessage(event) {\nif (_dead) { return; }\n\nif (!isOkay(event.origin)) {\n    _dead = true;\n    console.log('Note: an unrecognized domain, ' + event.origin + ', is trying to access your global Bubble editor clipboard.  If you would like to grant access, go to https://bubble.io, and in the javascript console, type client_storage.approve_global_clipboard(\\'' + event.origin + '\\'); and then refresh the editor window.');\n    return;\n}\n\nvar parentOrigin = event.origin;\n\nif (event.data.action === 'init_sync') {\n    function handleStoragePut(event) {\n        if (!event.key) { return; }\n        if (event.key.indexOf('global_clipboard_message_') != 0) { return; }\n        if (!event.newValue) { return; }\n        var message = JSON.parse(event.newValue);\n        parent.postMessage({\n            'action': 'new_clipboard_item',\n            'key': message.key,\n            'data': message.data,\n            'timestamp': message.timestamp\n        }, parentOrigin);\n    }\n\n    window.addEventListener("storage", handleStoragePut, false);\n}\n\nif (event.data.action === 'global_clipboard_put') {\n    var message_key = 'global_clipboard_message_' + event.data.id;\n    window.localStorage[message_key] = JSON.stringify(event.data);\n    setTimeout(function() {\n        delete window.localStorage[message_key];\n    }, 10000);\n}\n}\n\nfunction isOkay(origin) {\nif (window.localStorage.global_clipboard_approved && JSON.parse(window.localStorage.global_clipboard_approved).indexOf(event.origin) > -1) {\n    return true;\n}\nif (/^https:\\/\\/([^\\.]+\\.)?bubble\\.i[so]$/.test(origin)) {\n    return true;\n}\nreturn false;\n}\n\nwindow.addEventListener("message", receiveMessage, false);\n\nparent.postMessage({'action': 'init_me'}, '*');`;n.clipboard_script=G;function V(){if(!U){window.addEventListener("message",H,false);U=$(`<iframe\n     src="${s.META_ORIGIN}/appeditor/clipboard"\n     style="position: absolute; left: -2px; width: 1px; height: 1px"\n></iframe>"`);$("body").append(U)}}function H(e){var t,n;if(!o.is_origin_on_bubble(e.origin)){return}if(((t=e.data)==null?void 0:t.action)==="init_me"){var r,i;(r=U)==null?void 0:(i=r[0].contentWindow)==null?void 0:i.postMessage({action:"init_sync",url:window.location.href},s.META_ORIGIN);return}if(((n=e.data)==null?void 0:n.action)!=="new_clipboard_item"){return}const a=e.data.key;if(window.localStorage["_this_session_clipboard_"+a]>=e.data.timestamp){return}window.localStorage["_this_session_clipboard_"+a]=e.data.timestamp;w(e.data.key,e.data.data,false,true)}function X(e,t,n){if(!n){e.css({"-webkit-user-select":"all","-moz-user-select":"all","-ms-user-select":"all","user-select":"all",cursor:"pointer"})}const r="(copied)";e.on("vclick",(()=>{if(e.text().includes(r)){return}setTimeout((()=>{let n;document.execCommand("copy");const i=e.html();if(t){n=r+"  "+i}else{n=i+"  "+r}e.html(n);setTimeout((()=>{e.html(i)}),1e3)}),100)}))}const Y={epoch:{active:undefined}};function K(){return Y.epoch.active}function J(e){Y.epoch.active=e}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../constants/domain":59,"../../constants/time":92,"../../logger":744,"../../shared/domain_utilities":792,"../shared/b_string":841,"../shared/errors":846,"../shared/mode_check":851,"../shared/uuid":855,"core-js/modules/web.dom-collections.iterator.js":1123,events:978}],817:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.HexToNumber=c;n.NumberToHex=u;n.RGBA_to_ARGB=d;n.RGBA_to_RGB=g;n.RGBToHex=l;n.decimal_to_percent=_;n.hexToRGB=a;n.hex_to_rgb=h;n.lighten_color=y;n.lighten_rgb_color=void 0;n.percent_to_decimal=f;n.rgb_color_to_rgb_string=void 0;n.rgb_to_hex=p;n.rgba_to_array=m;e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");function r(e){return parseInt(o(e).substring(0,2),16)}function i(e){return parseInt(o(e).substring(2,4),16)}function s(e){return parseInt(o(e).substring(4,6),16)}function o(e){return e.charAt(0)==="#"?e.substring(1,7):e}function a(e){return[r(e),i(e),s(e)]}function l(e){return"#"+(e[0]*256*256+e[1]*256+e[2]).toString(16)}function c(e){return parseInt(o(e),16)}function u(e){return"#"+e.toString(16)}function d(e){if(!e||e.split==null){return""}const t=e.split("rgba(");if(t.length===1){return e}e=t[t.length-1];e=e.slice(0,e.length-1).replace(/\s/g,"");const[n,r,i,s]=e.split(",");return"#"+Math.floor(parseFloat(s)*255).toString(16)+parseInt(n).toString(16)+parseInt(r).toString(16)+parseInt(i).toString(16)}function p(e){const t=e.split("rgba(");if(t.length===1){return{code:e,opacity:1}}e=t[t.length-1];e=e.slice(0,e.length-1).replace(/\s/g,"");const[n,r,i,s]=e.split(",");return{opacity:parseFloat(s),code:"#"+((1<<24)+(parseInt(n)<<16)+(parseInt(r)<<8)+parseInt(i)).toString(16).substr(1)}}function _(e){return`${Math.round(e*100)}%`}function f(e){return parseFloat(e)/100}function h(e,t){e=e.replace("#","");const n=r(e);const o=i(e);const a=s(e);return`rgba(${n},${o},${a},${t/100})`}function m(e){return e.match(/[.?\d]+/g)}function g(e){if(!e||e.split==null){return""}const t=e.split("rgba(");if(t.length===1){return e}const n=t[1].split(",");return"rgb("+n.slice(0,n.length-1).join(",")+")"}const v=(e,t)=>{let[n,r,i]=e;const s=e=>Math.round(e*t+255*(1-t));return[s(n),s(r),s(i)]};n.lighten_rgb_color=v;const b=e=>{let[t,n,r]=e;return`rgb(${t}, ${n}, ${r})`};n.rgb_color_to_rgb_string=b;function y(e,t){try{const n=a(e);return l(v(n,t))}catch(e){return"#FFFFFF"}}},{"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],818:[function(e,t,n){"use strict";var r={"transition.noBounceUpIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateY:[0,1e3]},.6,{easing:"easeOutCirc"}]]},"transition.noBounceUpOut":{defaultDuration:1e3,calls:[[{opacity:[0,"easeInCirc",1],translateY:-1e3},.8]],reset:{translateY:0}},"transition.noBounceDownIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateY:[0,-1e3]},.6,{easing:"easeOutCirc"}]]},"transition.noBounceDownOut":{defaultDuration:1e3,calls:[[{opacity:[0,"easeInCirc",1],translateY:1e3},.8]],reset:{translateY:0}},"transition.noBounceLeftIn":{defaultDuration:750,calls:[[{opacity:[1,0],translateX:[0,-1250]},.6,{easing:"easeOutCirc"}]]},"transition.noBounceLeftOut":{defaultDuration:750,calls:[[{opacity:[0,"easeInCirc",1],translateX:-1250},.8]],reset:{translateX:0}},"transition.noBounceRightIn":{defaultDuration:750,calls:[[{opacity:[1,0],translateX:[0,1250]},.6,{easing:"easeOutCirc"}]]},"transition.noBounceRightOut":{defaultDuration:750,calls:[[{opacity:[0,"easeInCirc",1],translateX:1250},.8]],reset:{translateX:0}}};var i=["callout.bounce","callout.shake","callout.flash","callout.pulse","callout.swing","callout.tada","transition.fadeIn","transition.fadeOut","transition.flipXIn","transition.flipXOut","transition.flipYIn","transition.flipYOut","transition.flipBounceXIn","transition.flipBounceXOut","transition.flipBounceYIn","transition.flipBounceYOut","transition.swoopIn","transition.swoopOut","transition.whirlIn","transition.whirlOut","transition.shrinkIn","transition.shrinkOut","transition.expandIn","transition.expandOut","transition.bounceIn","transition.bounceOut","transition.bounceUpIn","transition.bounceUpOut","transition.bounceDownIn","transition.bounceDownOut","transition.bounceLeftIn","transition.bounceLeftOut","transition.bounceRightIn","transition.bounceRightOut","transition.slideUpIn","transition.slideUpOut","transition.slideDownIn","transition.slideDownOut","transition.slideLeftIn","transition.slideLeftOut","transition.slideRightIn","transition.slideRightOut","transition.slideUpBigIn","transition.slideUpBigOut","transition.slideDownBigIn","transition.slideDownBigOut","transition.slideLeftBigIn","transition.slideLeftBigOut","transition.slideRightBigIn","transition.slideRightBigOut","transition.perspectiveUpIn","transition.perspectiveUpOut","transition.perspectiveDownIn","transition.perspectiveDownOut","transition.perspectiveLeftIn","transition.perspectiveLeftOut","transition.perspectiveRightIn","transition.perspectiveRightOut"];var s=function(){if(typeof window==="undefined"||typeof window.$==="undefined"||typeof window.$.Velocity==="undefined"||typeof window.$.Velocity.RegisterEffect==="undefined"){console.log("Cannot load extra transitions before window, jQuery, Velocity or VelocityUI");return}Object.keys(r).forEach((function(e){window.$.Velocity.RegisterEffect(e,r[e])}))};t.exports={injectTransitions:s,customTransitions:r,allTransitionNames:i.concat(Object.keys(r))}},{}],819:[function(e,t,n){"use strict";t.exports={ar:["ar"],bg:["bg_BG"],bs:["bs_BA"],ca:["ca_ES"],cs:["cs_CZ"],da:["da_DK"],de:["de_DE"],el:["el_GR"],es:["es_ES"],et:["et_EE"],eu:["eu_ES"],fa:["fa_ir"],fi:["fi_FI"],fr:["fr_FR"],gl:["gl_ES"],he:["he_IL"],hi:["hi_IN"],hr:["hr_HR"],hu:["hu_HU"],id:["id_ID"],is:["is_IS"],it:["it_IT"],ja:["ja_JP"],ko:["ko_KR"],lt:["lt_LT"],lv:["lv_LV"],nb:["nb_NO"],ne:["ne_NP"],nl:["nl_NL"],no:["no_NO"],pl:["pl_PL"],pt:["pt_PT","pt_BR"],ro:["ro_RO"],ru:["ru_RU"],sk:["sk_SK"],sl:["sl_SI"],sv:["sv_SE"],th:["th_TH"],tr:["tr_TR"],uk:["uk_UA"],vi:["vi_VN"],zh:["zh_CN","zh_TW"]}},{}],820:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.observe=s;n.unobserve=o;e("core-js/modules/web.dom-collections.iterator.js");let r=null;function i(e){for(const r of e){var t,n;(t=(n=r.target)._b_resize_fn)==null?void 0:t.call(n,r)}}function s(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"border-box";if(typeof ResizeObserver!=="undefined"){var s;e._b_resize_fn=t;(s=r)!=null?s:r=new ResizeObserver(i);r.observe(e,{box:n})}}function o(e){var t;(t=r)==null?void 0:t.unobserve(e);delete e._b_resize_fn}},{"core-js/modules/web.dom-collections.iterator.js":1123}],821:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.all_page_errors=void 0;const r=[];n.all_page_errors=r},{}],822:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../shared/b_array");const s=e("../client/b_ui");const o=e("events");const a=e("../shared/mode_check");const l=e("../client/b_window");let c=false;r.simulate_double_tap_on_ipad=function(e,t){if(l.is_on_mobile_or_tablet()){e.on("vmouseup.fake-double-tap-1",(n=>{n.preventDefault();if(!c){c=true;e.on("vmouseup.fake-double-tap-2",(()=>{n.preventDefault();t(n)}));setTimeout((()=>{c=false;e.off("vmouseup.fake-double-tap-2")}),200)}}))}};r.one_blur=function(e,t){const n=new r.HasFocus(e,null);n.focus=true;let i=false;function s(){if(i){return}i=true;n.destroy();e.off("blur",s);e.off("change",s);t()}n.on("blur",s);e.on("blur",s);e.on("change",s)};const u=[];function d(){if(a.is_edit_mode()){return"vmousedown"}else{return"mousedown"}}r.HasFocus=class e extends o.EventEmitter{constructor(e,t){super();this.canvas=e;this.mouse_event=t!=null?t:d();if(!this.canvas.data("_HasFocus_watchers")){this.canvas.data("_HasFocus_watchers",[])}this.canvas.data("_HasFocus_watchers").push(this);u.push(this);this.focus=false;this.canvas_click=false;this.my_mousedown=()=>{this.handle_click();return true};this.canvas.on(this.mouse_event,this.my_mousedown);this.doc_mousedown=()=>{if(!this.canvas_click){this.force_blur()}this.canvas_click=false;return true};$(document).on(this.mouse_event,this.doc_mousedown)}force_blur(){if(this.focus){this.focus=false;this.emit("blur")}}prevent_deselect(){this.canvas_click=true}handle_click(){this.prevent_deselect();if(!this.focus){this.focus=true;this.emit("focus")}}destroy(){i.array_remove(u,this);this.canvas.off(this.mouse_event,this.my_mousedown);$(document).off(this.mouse_event,this.doc_mousedown)}};r.SetFocusOwner=function(e,t){e.data("HasFocusOwner",t);$(e).off(d()+".setfocusowner");$(e).on(d()+".setfocusowner",(function(){let e;if(t){const r=p(t);for(const t of r){for(e of(n=t.data("_HasFocus_watchers"))!=null?n:[]){var n;e.handle_click()}}}else{for(e of u){e.prevent_deselect()}}}))};function p(e){if(!e||e.length===0){return[]}const t=p(e.parent());const n=p(e.data("HasFocusOwner"));return[e].concat(t).concat(n)}r.force_focus_change=function(){s.scroll_freeze();const e=$("<input></input>");if(l.is_on_mobile_or_tablet()){e.attr("readonly",true)}$("body").append(e);e[0].focus();e.remove();s.scroll_unfreeze()};let _=null;r.add_finish_cb_to_vimeo=function(e,t,n){var r,i,s,o;let a;const l=(n,r)=>{const i={method:n};if(r){i.value=r}$(e.find("iframe"))[0].contentWindow.postMessage(JSON.stringify(i),"https://player.vimeo.com/video/"+t)};(r=(i=window).removeEventListener)==null?void 0:r.call(i,"message",_);(s=(o=window).detachEvent)==null?void 0:s.call(o,"onmessage",_);_=a=e=>{var t;if((t=e)!=null&&t.data){try{const t=JSON.parse(e.data);if(t.event==="finish"){n()}if(t.event==="ready"){l("addEventListener","finish")}}catch(t){e=t}}};if(window.addEventListener){window.addEventListener("message",a,false)}else{window.attachEvent("onmessage",a,false)}}},{"../client/b_ui":813,"../client/b_window":814,"../shared/b_array":835,"../shared/mode_check":851,"core-js/modules/web.dom-collections.iterator.js":1123,events:978}],823:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});var r=s(e("./u"));Object.keys(r).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in n&&n[e]===r[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return r[e]}})}));function i(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(i=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=i(t);if(n&&n.has(e)){return n.get(e)}var r={};var s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;if(a&&(a.get||a.set)){Object.defineProperty(r,o,a)}else{r[o]=e[o]}}}r.default=e;if(n){n.set(e,r)}return r}if(typeof window!=="undefined"){window.u=r}},{"./u":856,"core-js/modules/web.dom-collections.iterator.js":1123}],824:[function(e,t,n){"use strict";var r,i,s,o;const a=n;const l=e("../shared/errors");a.Redirect=(r=class e extends l.ExpectedError{constructor(e,t){super("redirect");this.statusCode=e;this.url=t}},r.prototype.error_class="Redirect",r);a.Redirect.prototype.toString=function(){return`Redirect (${this.statusCode}) to ${this.url}`};a.NotFound=(i=class e extends l.ExpectedError{},i.prototype.error_class="NotFound",i);a.ServerResponse=(s=class e extends l.ExpectedError{constructor(e,t,n){super("server_response");this.statusCode=e;this.headers=t;this.body=n}toString(){return`ServerResponse ${this.statusCode}`}},s.prototype.error_class="ServerResponse",s);a.ClientError=(o=class e extends l.UnexpectedError{display(){return"Invalid request: see error code for details"}},(()=>{o.prototype.error_class="ClientError";o.prototype.suggested_level="owner_error"})(),o)},{"../shared/errors":846}],825:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");const r=n;const i=e("../shared/async/b_fiber");r.with_fiber_notifier=function(e,t){const n=i.Fiber.current._u_with_fiber_notifier;i.Fiber.current._u_with_fiber_notifier=e;try{return t()}finally{i.Fiber.current._u_with_fiber_notifier=n}};r.no_fiber_notifier=function(e){function t(){}return r.with_fiber_notifier(t,e)};r.publish_fiber_notification=function(e){var t,n;(t=i.Fiber.current)==null?void 0:(n=t._u_with_fiber_notifier)==null?void 0:n.call(t,e)};r.notification_capturer=function(e){const t=[];const n=e=>t.push(e);const i=r.with_fiber_notifier(n,e);function s(){for(const e of t){r.publish_fiber_notification(e)}}return[i,s]};r.with_flush_caches=function(e){const t=i.Fiber.current._u_with_flush_caches;i.Fiber.current._u_with_flush_caches=true;try{return e()}finally{i.Fiber.current._u_with_flush_caches=t}};r.flushing_caches=()=>i.Fiber.current._u_with_flush_caches},{"../shared/async/b_fiber":833,"core-js/modules/web.dom-collections.iterator.js":1123}],826:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.default=n.DummyCounter=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=s(e("./mode_check"));function i(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(i=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=i(t);if(n&&n.has(e)){return n.get(e)}var r={};var s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;if(a&&(a.get||a.set)){Object.defineProperty(r,o,a)}else{r[o]=e[o]}}}r.default=e;if(n){n.set(e,r)}return r}class o{constructor(e){this._map=void 0;this._total=undefined;if(typeof e==="number"||!e){this._total=e!=null?e:0}else{this._map={...e}}}static onClient(e){if(r.on_client()){return new o(e)}else{return new a}}withTotal(){var e;(e=this._total)!=null?e:this._total=0;return this}get total(){var e;return(e=this._total)!=null?e:0}get(e){if(e===undefined){var t;return(t=this._total)!=null?t:0}else{var n,r;return(n=(r=this._map)==null?void 0:r[e])!=null?n:0}}add(e,t){const[n,r]=typeof e==="number"?[undefined,e!=null?e:1]:[e,t!=null?t:1];if(typeof this._total==="number"){this._total+=r}if(typeof n!=="undefined"){var i,s;(i=this._map)!=null?i:this._map={};this._map[n]=((s=this._map[n])!=null?s:0)+r}}toJSON(){if(this._total!==undefined&&this._map!==undefined){return{total:this.total,...this._map}}else if(this._total!==undefined){return this._total}else if(this._map!==undefined){return{...this._map}}else{return 0}}}n.default=o;class a extends o{get(){return 0}add(){return undefined}}n.DummyCounter=a},{"./mode_check":851,"core-js/modules/web.dom-collections.iterator.js":1123}],827:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=e("./errors");const i=e("./b_string");const s=e("./b_number");const o=e("./mode_check");const a=20;const l={posix:{},ietf:{}};function c(e,t,n){if(o.on_server()){return n()}const r=l[e][t];if(r!=null){return r}else{const r=l[e][t]=n();return r}}t.exports=class e{constructor(t){const{posix_code:n,ietf_code:i}=t;this.posix_code=n;this.ietf_code=i;if(this.posix_code&&this.ietf_code){throw new r.UnexpectedError("Can't provide two codes for a Locale")}else if(this.posix_code){this.ietf_code=e.posix_to_ietf(this.posix_code)}else if(this.ietf_code){this.posix_code=e.ietf_to_posix(this.ietf_code)}else{throw new r.UnexpectedError("Must provide a code to construct a Locale")}}static from_posix(t){return c("posix",t,(()=>new e({posix_code:t})))}static from_ietf(t){return c("ietf",t,(()=>new e({ietf_code:t})))}static posix_to_ietf(e){const[t,n]=e.split("_");if(t&&n){return`${t}-${n.toUpperCase()}`}else{return t}}static ietf_to_posix(e){const[t,n]=e.split("-");if(t&&n){return`${t}_${n.toLowerCase()}`}else{return t}}get_regional_separators(){if(this.decimal_separator==null||this.group_separator==null||this.decimal_digits==null){const e=this.format_number(111111111.1111111);const t=e[0];for(let n=e.length-1;n>=0;n--){const r=e.charAt(n);if(r!==t){this.decimal_separator=r;this.decimal_digits=e.length-n-1;break}}for(let t=0;t<e.length;t++){const n=e.charAt(t);if(n!=="1"&&n!==this.decimal_separator){this.group_separator=n;break}this.group_separator=""}}return{decimal_separator:this.decimal_separator,group_separator:this.group_separator,decimal_digits:this.decimal_digits}}format_number(e,t){let n,r;if(t!=null){t=Math.max(0,Math.min(a,t))}if(typeof Intl==="undefined"||Intl===null){if(t!=null){return e.toFixed(t)}else{return e.toString()}}if(t!=null){r={maximumFractionDigits:t,minimumFractionDigits:t}}else{r={maximumFractionDigits:a}}try{n=new Intl.NumberFormat(this.ietf_code+"-u-nu-latn",r)}catch(e){n=new Intl.NumberFormat(this.ietf_code,r)}return n.format(e)}format_decimal(e){const{decimal_separator:t}=this.get_regional_separators();return s.dec_to_string(e).replace(".",t)}parse_float(e){if(typeof e!=="string"){return parseFloat(e)}e=e.trim();let{decimal_separator:t,group_separator:n}=p(e,this.get_regional_separators());if(n!=null&&n.charCodeAt(0)===160){e=i.replace_all(e,n," ");n=" "}const r=[",","."," "];for(const s of r){if(s!==t&&s!==n){if(i.safe_contains(e,s)){return NaN}}}let s=false;for(let r=e.length-1;r>=0;r--){const i=e.charAt(r);if(s){if(i===t){return NaN}}else{if(i===n||i===t){s=true}}}e=i.replace_all(e,n,"");if(t!=="."){e=i.replace_all(e,t,".")}return parseFloat(e)}};function u(e){let t=null;let n=null;const r=[",","."];let i=e.length-1;while(i>=0){const n=e.charAt(i);if(r.includes(n)){t=n;break}i-=1}for(let s=0;s<i;s++){const i=e.charAt(s);if(i===t){n=i;t=null;break}else if(r.includes(i)){n=i;break}n=null}return{interpreted_decimal_separator:t,interpreted_group_separator:n}}function d(e,t){const n=e.charAt(0);if(n===t){return false}let r=null;let i=0;while(i<e.length){const n=e.charAt(i);if(n!==t){i+=1;continue}if(r==null&&i>3){return false}if(r!=null&&i-r!==4){return false}r=i;i+=1}if(r==null||i-r!==4){return false}return true}function p(e,t){const{decimal_separator:n,group_separator:r}=t;const i=n;const s=r;const{interpreted_decimal_separator:o,interpreted_group_separator:a}=u(e);if(o!=null&&a!=null){return{decimal_separator:o,group_separator:a}}if(o==null&&a==null){return{decimal_separator:i,group_separator:s}}if(d(e,a)){return{decimal_separator:o,group_separator:a}}if(d(e,s)&&o===s){return{decimal_separator:i,group_separator:s}}return{decimal_separator:o,group_separator:null}}},{"./b_number":838,"./b_string":841,"./errors":846,"./mode_check":851,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],828:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Mediator=void 0;class r{constructor(){this.observers=[]}register(e){this.observers.push(e)}sendMessage(e,t){this.observers.filter((t=>t.id!==e)).forEach((e=>e.onMessage(t)))}}n.Mediator=r},{}],829:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});const r={CurrentAutoRun:null,CurrentNotReadyCatcher:null,server_connection_problems:false};t.exports=r},{}],830:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Autorun=n.AlwaysErrorWatcher=void 0;n.Box=H;n.BoxClass=void 0;n.FakeWatcher=k;n.Watcher=A;n.autorun=P;n.autorun_once=L;n.autorun_return=Y;n.autorun_top=z;n.autorun_watch=V;n.autotop=B;n.mock_auto_run=q;n.no_outstanding_run_once=void 0;n.run_once=y;n.scheduled_key=n.schedule=void 0;n.singleton=w;n.wait_for_attached=T;n.wait_for_element=C;n.wait_for_updates=D;n.wait_for_updates_keys=void 0;n.wait_for_visible=N;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.promise.finally.js");var r=v(e("./async_state"));var i=e("./b_async");var s=g(e("../b_object"));var o=g(e("../../client/b_ui"));var a=e("./dependency");var l=e("../errors");var c=g(e("../../../logger"));var u=g(e("../mode_check"));var d=e("../uuid");var p=v(e("../../../client/epoch"));var _=e("../../../constants/epoch");var f=e("solid-js");var h=v(e("../../../safe_require"));function m(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(m=function(e){return e?n:t})(e)}function g(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=m(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function v(e){return e&&e.__esModule?e:{default:e}}h.default.safe_register("./u/shared/async/autorun",t.exports);const b=(0,i.MakeKeyList)();n.no_outstanding_run_once=b;function y(e,t,n){let s=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let o;if(typeof e!=="number"){throw new l.UnexpectedError("calling run_once with non-numeric value for timeout_seconds")}if(u.on_server()){o=(0,i.Promise)(t)}else{let a;o=(0,i.Promise)(null,`Running once: ${String(t)}`);if(s){a=(0,i.MakeKey)(e+5,"run once: "+String(t))}else{a=b.make(e+5,"run once: "+String(t))}const c=A(t);if(s){c.dont_track_scheduling()}c.once_value((e=>{if(a.is_turned()){return}a.turn();c.destroy();o.resolve(e)}));c.once_error((e=>{if(a.is_turned()){return}a.turn();c.destroy();o.reject(e)}));const d=Date.now()+e*1e3;function p(){var e;if(a.is_turned()){return}let t=c.max_expected_time();(e=t)!=null?e:t=d-Date.now();if(t<0){_()}else{setTimeout(p,Math.min(1e4,t))}}function _(){let n;const i=c.get_current_status();if(i.status==="error"){n="WAS AN ERR, WHY DID WE NOT CALL ERROR HANDLER?"}else if(i.status==="ready"){n=`WATCHER IS READY, WHY DID WE NOT CALL ONCE_VALUE: ${String(i.value)}`}else{if(!i.ready_keys){n="<NO READY KEYS>"}else if(i.ready_keys.is_turned()){n=`Watcher is marked not ready but keys are turned. _debug_turned_key = ${String(c._debug_turned_key)}. IS SCHEDULED: ${String(!!c._is_scheduled)}`}else{n=`waiting on ${String(i.ready_keys)}`}}if(r.default.server_connection_problems){o.reject(new l.UserError("BAD_CONNECTION"))}else{o.reject(new l.UnexpectedError("autorun.run_once timeout",{timeout_seconds:e,fn_source:String(t),waiting_on:n}))}a.turn();c.destroy()}p()}if(n){o.callback(n)}return o}function w(e){let t=null;return()=>{if(t==null){t=z((()=>new e))}return t}}function x(e,t,n){try{e()}catch(e){t(e)}finally{n()}}function j(e,t){try{return[true,s.compare(e,t)]}catch(e){if(e instanceof l.NotReadyError){return[false]}else{throw e}}}function A(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let n,r;if(typeof e==="function"){r=e}else{({fn:r,compare:n}=e)}return new M(r,{watcher_test:t,compare:n})}class M{constructor(e){var t;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.evaluate=void 0;this.ready_keys=void 0;this._is_scheduled=void 0;this._dont_track_scheduling=false;this._ar_object=void 0;this.error=void 0;this.value=void 0;this.ready=false;this._debug_turned_key=void 0;this.dependency=void 0;this.error_listeners=void 0;this.listeners=void 0;this.not_ready_listeners=void 0;const{watcher_test:s=false,compare:o,log_errors:p=true}=n;this.evaluate=()=>{const t=r.default.CurrentNotReadyCatcher;const n=[];const a=r.default.CurrentAutoRun;const _={id:(0,d.LUID)(),_subs:[],invalidate:()=>{if(this.ready_keys&&!this.ready_keys.is_turned()){this.ready_keys.turned_dependency().register(_);return}_.invalidate=function(){};_.destroy();if(u.running_test()&&!s){_.run_me()}else{if(u.on_server()){c.warn("invalidating watcher on server",{keys:String(this.ready_keys)})}W(_);this._is_scheduled=_}},add_sub:e=>{_._subs.push(e)},destroy_subs(){for(const e of _._subs){e.destroy()}_._subs=[]},_is_destroyed:false,destroy:()=>{_._is_destroyed=true;_.destroy_subs()},run_me:()=>{_.run_me=function(){};if(_===this._is_scheduled){this._is_scheduled=undefined}this.evaluate()},dont_track_scheduling:this._dont_track_scheduling,stop_tracking:()=>{this.dont_track_scheduling()}};this._ar_object=_;let f;let h;x((function(){r.default.CurrentNotReadyCatcher=n;r.default.CurrentAutoRun=_;h=e()}),(function(e){if(e instanceof l.NotReadyError&&e.not_ready_key!=null){const t=e.not_ready_key;if(!t.is_registered(_)&&e.suppress_dependency_error!==true){c.error("Watcher caught unregistered key",{key:t.toString()})}n.push(t)}else{f=(0,l.ensure_bubble_error)(e)}}),(function(){r.default.CurrentNotReadyCatcher=t;r.default.CurrentAutoRun=a}));if(f!=null){var m;this.error=f;this.value=undefined;this.ready=true;this._debug_turned_key=undefined;(m=this.dependency)==null?void 0:m.invalidate();if(this.error_listeners!=null&&this.error_listeners.size>0){for(const e of this.error_listeners){try{e(this.error)}catch(e){c.log((0,l.ensure_bubble_error)(e))}}}else if(p){c.log(this.error)}}else if(n.length===0){let e=!this.ready;if(!e){if(o){e=!o(h,this.value)}else{const t=j(h,this.value);e=!t[0]||!t[1]}}if(e){var g;this.ready=true;this.error=undefined;this.value=h;this._debug_turned_key=undefined;(g=this.dependency)==null?void 0:g.invalidate();if(this.listeners){for(const e of this.listeners){try{e(this.value)}catch(e){c.log((0,l.ensure_bubble_error)(e))}}}}else{this.value=h}}else{var v;if(this.ready&&this.not_ready_listeners){for(const e of this.not_ready_listeners){try{e()}catch(e){c.log((0,l.ensure_bubble_error)(e))}}}this.ready=false;this.value=undefined;this.error=undefined;(v=this.ready_keys)!=null?v:this.ready_keys=(0,i.MakeKeyList)();this.ready_keys.remove_all();for(const e of n){if(e.is_turned()){this._debug_turned_key=e}else{this.ready_keys.add_key(e)}}}};this.evaluate();if(((t=this._ar_object)==null?void 0:t._has_dependency)===true||!this.ready){this.dependency=(0,a.Dependency)()}else{this.evaluate=undefined;this._ar_object=undefined}}get_ready_key(){var e;(e=this.ready_keys)!=null?e:this.ready_keys=(0,i.TransientKeyList)();return this.ready_keys}dont_track_scheduling(){this._dont_track_scheduling=true;if(this._ar_object){this._ar_object.dont_track_scheduling=true}}invalidate(){var e;return(e=this._ar_object)==null?void 0:e.invalidate()}max_expected_time(){var e,t;return(e=(t=this.ready_keys)==null?void 0:t.max_expected_time())!=null?e:null}get_current(){var e,t;let n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;(e=this._is_scheduled)==null?void 0:e.run_me();(t=this.dependency)==null?void 0:t.register();if(this.error!=null){if(n){return[null,null,this.error]}throw this.error}if(this.ready){return[this.ready,this.value]}else{return[this.ready,this.ready_keys]}}get_current_status(){if(this.error!=null){return{status:"error",error:this.error}}else if(this.ready){return{status:"ready",value:this.value}}else{return{status:"not_ready",ready_keys:this.ready_keys}}}get_current_status_array(){if(this.error!=null){return[this.error]}if(this.ready){return[null,this.ready,this.value]}else{return[null,this.ready,this.ready_keys]}}get(){var e,t;(e=this._is_scheduled)==null?void 0:e.run_me();if(this.error!=null){var n;(n=this.dependency)==null?void 0:n.register();throw this.error}if(!this.ready){var r;(0,i.ensure_ready)(this.ready_keys,false);this.evaluate();const e=this.get();(r=this.dependency)==null?void 0:r.register();return e}(t=this.dependency)==null?void 0:t.register();return this.value}on_value(e){var t;(t=this.listeners)!=null?t:this.listeners=new Set;this.listeners.add(e);if(this.error!=null){c.log(this.error)}else if(this.ready){try{e(this.value)}catch(e){c.log((0,l.ensure_bubble_error)(e))}}}on_condition(e,t){let n;if(typeof e==="function"){n=e}else{n=t=>t===e}this.on_value((e=>{if(n(e)){t(e)}}))}on_not_ready(e){var t;(t=this.not_ready_listeners)!=null?t:this.not_ready_listeners=new Set;this.not_ready_listeners.add(e);if(!this.ready){try{e()}catch(e){c.log((0,l.ensure_bubble_error)(e))}}}on_error(e){var t;(t=this.error_listeners)!=null?t:this.error_listeners=new Set;this.error_listeners.add(e);if(this.error!=null){try{e(this.error)}catch(e){c.log((0,l.ensure_bubble_error)(e))}}}once_error(e){const t=n=>{var r;(r=this.error_listeners)==null?void 0:r.delete(t);e(n)};this.on_error(t)}once_value(e){const t=n=>{var r;(r=this.listeners)==null?void 0:r.delete(t);e(n)};this.on_value(t)}once_condition(e,t){let n;if(typeof e==="function"){n=e}else{n=t=>t===e}const r=e=>{if(n(e)){var i;(i=this.listeners)==null?void 0:i.delete(r);t(e)}};this.on_value(r)}once_change(e){var t;(t=this.listeners)!=null?t:this.listeners=new Set;const n=t=>{var r;(r=this.listeners)==null?void 0:r.delete(n);e(t)};this.listeners.add(n)}destroy(){var e,t;this.listeners=undefined;this.not_ready_listeners=undefined;this.error_listeners=undefined;this.dependency=undefined;(e=this.ready_keys)==null?void 0:e.destroy();this.ready_keys=undefined;this.evaluate=function(){};this._is_scheduled=undefined;(t=this._ar_object)==null?void 0:t.destroy();this._ar_object=undefined}}const E=new M((()=>{throw new l.UnexpectedError("This watcher cannot be accessed")}),{log_errors:false});n.AlwaysErrorWatcher=E;function k(e){return new O(e)}class O{constructor(e){this.data=void 0;this.data=e}get_ready_key(){return(0,i.FakeKey)()}dont_track_scheduling(){}max_expected_time(){return null}invalidate(){}get_current(){return[true,this.data]}get_current_status(){return{status:"ready",value:this.data}}get_current_status_array(){return[null,true,this.data]}get(){return this.data}on_value(e){e(this.data)}on_error(){}on_not_ready(){}once_error(){}once_value(e){e(this.data)}once_change(){}on_condition(e,t){if(e===this.data||typeof e==="function"&&e(this.data)){t(this.data)}}once_condition(e,t){this.on_condition(e,t)}destroy(){}}const S=(0,i.MakeKeyList)();n.wait_for_updates_keys=S;function D(e){setTimeout((function(){if(F.is_turned()&&S.is_turned()){e()}else{(0,i.WaitFor)(F,S,(()=>D(e)))}}),10)}function C(e,t,n){let r;const i=setTimeout((function(){if(r!=null)clearTimeout(r);n(`could not find ${e} after ${t} ms`)}),t);function s(){if($(e).length>0){clearTimeout(i);n()}else{r=setTimeout(s,100)}}s()}function T(e,t,n){var r;(r=n)!=null?r:n={};const{error_message:s}=n;let a=false;e.on("remove",(function(){a=true}));function l(n){var r;(r=n)!=null?r:n=10;if(a){return}if(o.is_attached(e)){t()}else{if(typeof n==="function"){n()}else{const e=n*2;setTimeout((function(){l(e)}),n)}}}l((function(){(0,i.WaitFor)(F,(function(){l((function(){if(s){c.owner_warn("element not attached after scheduled_key",{display:s,html:e[0].outerHTML})}else{c.error("element was not attached after autorun.scheduled_key",{html:e[0].outerHTML})}l()}))}))}))}function N(e,t){function n(r){var i;(i=r)!=null?i:r=10;if(r>500){return}if(e.is(":visible")){t()}else{if(typeof r==="function"){r()}else{const e=r*2;setTimeout((()=>n(e)),r)}}}n((function(){(0,i.WaitFor)(F,(()=>n()))}))}function P(e,t){const n=typeof e==="object"?e:{do:e,while:undefined,finally:t};let{do:r,while:i,finally:s}=n;if(u.is_edit_mode()){const e=r;const t=s;let n;r=()=>{z((()=>(0,f.untrack)((()=>{var e;return(e=n)==null?void 0:e()}))));const t=(0,f.createRoot)((t=>{n=t;try{e()}catch(e){if(e instanceof l.NotReadyError){return e}throw e}return null}));if(t!=null){throw t}};s=()=>{var e;(e=n)==null?void 0:e();t==null?void 0:t()}}if(!i){return new R(r,s).run_me()}else{return I(r,i,s)}}function I(e,t,n){let r=false;const i=new R(e,(()=>{n==null?void 0:n();s.destroy()}));const s=new R((()=>{if(t()){i.unpause();if(!r){r=true;i.run_me()}}else{i.pause()}})).run_me();return i}class R{constructor(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this._is_destroyed=false;this._subs=[];this._is_paused=false;this._is_ancestor_paused=false;this._run_on_unpause=false;this.fn=void 0;this.cleanup=void 0;this.run_once=void 0;this.id=void 0;this.run_immediately=false;this._is_running=false;this._do_another_run=void 0;this._recursive_runs=void 0;this.dont_track_scheduling=false;this.fn=e;this.cleanup=t;this.run_once=n;this.id=(0,d.LUID)();if(r.default.CurrentAutoRun!=null){r.default.CurrentAutoRun.add_sub(this)}}set_run_immediately(e){this.run_immediately=e}alive(){return!this._is_destroyed}invalidate(){if(this._is_destroyed){return}if(this.run_once){return}if(G===this){c.error("Watched autorun just got invalidated")}if(this._is_paused||this._is_ancestor_paused){this._run_on_unpause=true;return}if(this.run_immediately||u.on_server()){if(this._is_running){this._do_another_run=true;if(this._recursive_runs!=null&&this._recursive_runs>20){throw new l.UnexpectedError("recursive autorun run immediately loop")}}else{this.run_me()}}else{W(this)}}run_me(){if(this._is_destroyed||this._is_paused||this._is_ancestor_paused){return this}this.destroy_subs();const e=r.default.CurrentAutoRun;r.default.CurrentAutoRun=this;const t=r.default.CurrentNotReadyCatcher;r.default.CurrentNotReadyCatcher=null;this._is_running=true;try{this.fn()}catch(e){if(e instanceof l.NotReadyError&&e.not_ready_key!=null){const t=e.not_ready_key;if(!t.is_registered(this)&&e.suppress_dependency_error!==true){c.error("Unregistered key caught by autorun",{key:t.toString()})}}else{c.log((0,l.ensure_bubble_error)(e))}}finally{this._is_running=false;r.default.CurrentAutoRun=e;r.default.CurrentNotReadyCatcher=t}if(this._do_another_run===true){var n;this._do_another_run=false;(n=this._recursive_runs)!=null?n:this._recursive_runs=0;this._recursive_runs++;this.run_me()}else{delete this._recursive_runs}return this}destroy_subs(){for(const e of this._subs){e.destroy()}this._subs=[]}destroy(){var e;this._is_destroyed=true;this.destroy_subs();(e=this.cleanup)==null?void 0:e.call(this)}add_sub(e){this._subs.push(e)}stop_tracking(){this.dont_track_scheduling=true}pause(){this._is_paused=true;this._subs.forEach(e);function e(t){const n=t._is_paused||t._is_ancestor_paused;t._is_ancestor_paused=true;if(!n){t._subs.forEach(e)}}}unpause(){this._is_paused=false;e(this);function e(t){if(t._is_paused||t._is_ancestor_paused){return}if(t._run_on_unpause){t._run_on_unpause=false;t.invalidate()}else{t._subs.forEach((t=>{t._is_ancestor_paused=false;e(t)}))}}}}n.Autorun=R;function L(e){return new R(e,undefined,true).run_me()}function z(e){const t=r.default.CurrentAutoRun;r.default.CurrentAutoRun=null;const n=r.default.CurrentNotReadyCatcher;r.default.CurrentNotReadyCatcher=null;try{return e()}catch(e){if(e instanceof l.NotReadyError){c.log((0,l.ensure_bubble_error)(e))}throw e}finally{r.default.CurrentAutoRun=t;r.default.CurrentNotReadyCatcher=n}}function B(e){return z((()=>P(e)))}function q(e){let t,n;try{n=r.default.CurrentAutoRun;const i=new U;r.default.CurrentAutoRun=i;t=r.default.CurrentNotReadyCatcher;r.default.CurrentNotReadyCatcher=null;e();return i}finally{r.default.CurrentAutoRun=n;r.default.CurrentNotReadyCatcher=t}}class U{constructor(){this.wr=void 0;this.id=void 0;this.wr=false;this.id=(0,d.LUID)()}add_sub(e){}stop_tracking(){}will_run(){return this.wr}invalidate(){this.wr=true}destroy(){}}const F=(0,i.MakeSwitch)(undefined,"autorun.scheduled_key");n.scheduled_key=F;F.turn_on();const W=function(){let e={};let t=false;let n=0;let r=false;const i=u.is_edit_mode()?0:100;function s(){if(t){return}t=true;n++;if(!r){var e,s;(e=window)==null?void 0:(s=e.requestAnimationFrame)==null?void 0:s.call(e,o);setTimeout(o)}else if(n<=i){queueMicrotask(o)}else{setTimeout(o,1);n=0}}function o(){const e=_.SPANS.autorun_scheduled;p.default.traceSpan(e.name,e.type,(()=>a()))}function a(){t=false;r=true;const i=Object.values(e);e={};for(const e of i){e.run_me()}r=false;if(!t){setTimeout((()=>{if(!t)F.turn_on()}),1);n=0}}return function(t){e[t.id]=t;if(!t.dont_track_scheduling){F.turn_off()}s()}}();n.schedule=W;let G;function V(){G=r.default.CurrentAutoRun}function H(e,t){const n=new X(e);if(t===true){n.not_ready()}const r=n.val.bind(n);return Object.assign(r,{set:n.set.bind(n),get:n.get.bind(n),dangerously_peek:n.dangerously_peek.bind(n)})}class X{constructor(e){this.state=void 0;this.dependency=void 0;this.is_not_ready=void 0;this.not_ready_switch=void 0;this.state=e;this.dependency=(0,a.Dependency)();this.is_not_ready=false}not_ready(){var e;this.is_not_ready=true;(e=this.not_ready_switch)!=null?e:this.not_ready_switch=(0,i.MakeSwitch)(undefined,"autorun.Box not_ready_switch");this.not_ready_switch.turn_off()}val(e,t){if(t===true){this.not_ready()}else if(e===undefined){return this.get()}else{this.set(e)}return undefined}dangerously_peek(){return this.state}get(){if(this.is_not_ready){(0,i.ensure_ready)(this.not_ready_switch)}this.dependency.register();return this.state}set(e){if(!s.compare(this.state,e)){this.state=e;this.dependency.invalidate();if(this.is_not_ready){this.is_not_ready=false;this.not_ready_switch.turn_on()}}}}n.BoxClass=X;function Y(e){const t=(0,a.Dependency)();let n;let r;P((()=>{try{const i=e();if(!s.compare(i,n)){t.invalidate()}n=i;r=undefined}catch(e){r=e;t.invalidate()}}));t.register();if(r!=null){r.suppress_dependency_error=true;throw r}return n}},{"../../../client/epoch":25,"../../../constants/epoch":63,"../../../logger":744,"../../../safe_require":777,"../../client/b_ui":813,"../b_object":839,"../errors":846,"../mode_check":851,"../uuid":855,"./async_state":829,"./b_async":832,"./dependency":834,"core-js/modules/es.promise.finally.js":1117,"core-js/modules/web.dom-collections.iterator.js":1123,"solid-js":2313}],831:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.autorun_cache=f;e("core-js/modules/web.dom-collections.iterator.js");var r=e("./autorun");var i=e("../errors");var s=_(e("./b_fiber"));var o=_(e("../mode_check"));var a=d(e("../../server/server_notifications"));var l=e("../uuid");var c=e("../b_object");var u=e("../loggable");function d(e){return e&&e.__esModule?e:{default:e}}function p(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(p=function(e){return e?n:t})(e)}function _(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=p(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function f(e){let t,n;if(typeof e==="function"){t=e;n={}}else{n=e;t=e.fn}const d={};const p=(0,l.LUID)();return function(){for(var e=arguments.length,l=new Array(e),_=0;_<e;_++){l[_]=arguments[_]}if(l.length>3){throw new i.UnexpectedError("autorun_cache only supports 3 args right now")}const f=l.slice(0,3);if((0,c.has_unique_string)(this)){f.push(this)}for(let e=0;e<f.length;e++){let t=f[e];if((0,c.has_unique_string)(t)){t=t.toUniqueString()}if(typeof t==="string"){t='"'+t}if(t!=null&&typeof t==="object"){throw new i.UnexpectedError("passed in object to autorun_cache",{the_object:(0,u.to_loggable)(t)})}f[e]=t}const h=f.join(" ");if(o.on_server()){var m,g,v,b;const e=(m=s.Fiber)==null?void 0:m.current;if(e==null){return t.call(this,...l)}const n=e.running_appname;const r=e.running_app_version;const i=`${p}${n}_${r}`;(g=e.__server_autorun_cache)!=null?g:e.__server_autorun_cache={};(b=(v=e.__server_autorun_cache)[i])!=null?b:v[i]=new LRU({max:1e3,length(){return 1}});const o=e.__server_autorun_cache[i];let c;if(!o.has(h)){const[e,n]=a.default.notification_capturer((()=>t.call(this,...l)));c={res:e,rethrower:n};o.set(h,c)}else{c=o.get(h)}c.rethrower();return c.res}else{let e=d[h];if(e==="evaluating"){return t.call(this,...l)}else{if(e==null){d[h]="evaluating";d[h]=e=(0,r.Watcher)({fn:()=>t.call(this,...l),compare:n.compare_fn})}return e.get()}}}}},{"../../server/server_notifications":825,"../b_object":839,"../errors":846,"../loggable":849,"../mode_check":851,"../uuid":855,"./autorun":830,"./b_fiber":833,"core-js/modules/web.dom-collections.iterator.js":1123}],832:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.FakeKey=D;n.KeyList=n.KeyBase=n.Key=void 0;n.MakeKey=O;n.MakeKeyList=B;n.MakeSwitch=L;n.Promise=g;n.Switch=n.PromiseClass=void 0;n.SyncWait=k;n.TransientKeyList=q;n.WaitFor=N;n.ensure_ready=A;n.promise_array=b;n.retry=E;n.retry_on_match=M;n.run_without_catching_not_ready=j;n.throw_not_ready=x;n.timeout_promise=y;n.timeout_warning=I;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");var r=h(e("./async_state"));var i=e("../backoff");var s=f(e("../b_string"));var o=f(e("../b_array"));var a=e("./dependency");var l=e("../errors");var c=f(e("./b_fiber"));var u=f(e("../mode_check"));var d=f(e("../../../logger"));var p=h(e("../../../safe_require"));function _(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(_=function(e){return e?n:t})(e)}function f(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=_(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function h(e){return e&&e.__esModule?e:{default:e}}p.default.safe_register("./u/shared/async/b_async",t.exports);function m(e){return e}function g(e,t){if(e!=null&&(e instanceof v||typeof e.then==="function")){return e}else{return new v(e,t)}}class v{constructor(e,t){this._fails=void 0;this._dones=void 0;this._done=void 0;this._waiting_on=void 0;this.prefetching=false;this._error=void 0;this._value=void 0;this._handled_error=false;this._ready_key=void 0;this._fails=[];this._dones=[];this._done=false;if(t){this._waiting_on=t}else{if(typeof e==="function"){let t;try{t=e()}catch(e){this.reject(e);return}this.resolve(t)}else{this.resolve(e)}}}get_prefetching(){if(this.prefetching){return this.prefetching}if(this._waiting_on instanceof v){return this._waiting_on.get_prefetching()}return false}toString(){if(this._done){var e;return`Promise(${String((e=this._error)!=null?e:this._value)})`}else{if(this._waiting_on instanceof v){return String(this._waiting_on)}else{return`Promise(waiting on ${String(this._waiting_on)})`}}}reject(e){if(this._done){return}if(e instanceof l.NotReadyError){d.warn("Promise rejected with a not-ready key: use a autorun.run_once!")}this._done=true;this._waiting_on=undefined;this._error=e;if(this._fails.length>0){for(const t of this._fails){t(e)}}else if(u.on_client()){setTimeout((()=>{if(!this._handled_error){throw e}}),100)}}resolve(e){if(this._done){return}if(e instanceof v){this._waiting_on=e;e._attach_success((e=>this.resolve(e)));e._attach_failure((e=>this.reject(e)))}else{this._done=true;this._waiting_on=undefined;this._value=e;for(const t of this._dones){t(e)}}}_attach_success(e){if(typeof e!=="function"){throw new l.UnexpectedError("not a function")}if(this._done){if(this._error==null){e(this._value)}}else{this._dones.push(e)}}_attach_failure(e){if(typeof e!=="function"){throw new l.UnexpectedError("not a function")}if(this._done){if(this._error!=null){e(this._error);this._handled_error=true}}else{this._fails.push(e)}}then(e,t){const n=e!=null?e:m;const r=t!=null?t:m;const i=g(null,this);this._attach_success((e=>{let t;try{t=n(e)}catch(e){i.reject(e);return}i.resolve(t)}));this._attach_failure((e=>{let t;try{t=r(e)}catch(e){t=e}if(t!=null){i.reject(t)}else{i.resolve(undefined)}}));return i}callback(e){this.then((t=>{e(null,t)}),(t=>{e(t);return null}))}done(e){var t;(t=e)!=null?t:e=m;this._attach_success(e);this._attach_failure((e=>{if(e!=null){setTimeout((()=>{throw e}),1)}}))}block(){const e=c.Block(this.toString(),this.get_prefetching());this.callback(((t,n)=>{if(t!=null){e.fail(t)}else{e.success(n)}}));return e.wait()}block_promise(e){if(u.on_server()){c.suspend_fiber_timeout(e,(()=>this.block()))}return this}sync(){if(u.on_server()){return this.block()}A(this.ready_key(),false);if(this._error!=null){throw this._error}return this._value}ready_key(){if(!this._ready_key){const e=O(undefined,(()=>this.toString()));this._ready_key=e;this._attach_success((()=>e.turn()));this._attach_failure((()=>e.turn()))}return this._ready_key}inspect(){if(!this._done){return{state:"pending"}}if(this._error!=null){return{state:"rejected",reason:this._error}}else{return{state:"fulfilled",value:this._value}}}make_cb(){return(e,t)=>e!=null?this.reject(e):this.resolve(t)}}n.PromiseClass=v;function b(e){if(e.length===0){return g([])}if(e.length===1){return e[0].then((e=>[e]))}const[t,n]=o.partition(e);return b(t).then((e=>b(n).then((t=>e.concat(t)))))}function y(e){const t=g(null,`b_async.timeout_promise:${e}`);setTimeout(t.resolve.bind(t),e);return t}let w=false;function x(e,t){var n;(n=t)!=null?n:t=true;e.turned_dependency().register();if(t&&r.default.CurrentNotReadyCatcher&&!w){r.default.CurrentNotReadyCatcher.push(e)}else{throw new l.NotReadyError(e)}}function j(e){const t=w;try{w=true;e();return}finally{w=t}}function A(e,t){var n,r;(n=t)!=null?n:t=true;if(e.is_turned()){return true}if(((r=c.Fiber)==null?void 0:r.current)!=null&&!u.running_test()){k(e);return true}else{x(e,t);return false}}function M(e){let{retries:t,delay:n,try_fn:r,match_fn:o,before_retry_fn:a}=e;if(typeof t!=="number"){throw new l.UnexpectedError("b_async.retry bad retries")}if(typeof r!=="function"){throw new l.UnexpectedError("b_async.retry bad function param")}try{return r()}catch(e){if(o){if(!o(e)){throw e}}if(e instanceof Error&&s.safe_contains(e.message,c.QUEUE_TIMEOUT)){throw e}if(!(t>0)){throw e}if(n){c.pause((0,i.jitter)(n),"retry on match delay")}a==null?void 0:a(e);return M({retries:t-1,delay:n,try_fn:r,match_fn:o,before_retry_fn:a})}}function E(e,t,n){return M({retries:e,delay:t,try_fn:n})}function k(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}const r=q(t);if(r.is_turned()){return}const i=c.Block(r.toString());N(r,i.success.bind(i));i.wait()}function O(e,t,n){if(!t){d.error("anonymous key created: please name it: b_async.MakeKey(null, 'my name') or b_async.MakeKey(timeout, 'my name')")}return new R(e,t,n)}let S=null;function D(){if(!S){S=O(undefined,"fake_key");S.turn()}return S}let C=0;class T{constructor(){this._id=void 0;this._listeners=void 0;this._listener_count=0;this._turned_dependency=void 0}id(){if(!this._id){this._id=C;C++}return this._id}listen(e){var t;(t=this._listeners)!=null?t:this._listeners={};const n=e.id();if(this._listeners[n]!=null){return}this._listeners[n]=e;this._listener_count++;if(this._listener_count===1e4){var r;if(!u.is_edit_mode()||(r=window)!=null&&r.current_user_is_admin){d.warn("Listener count at 10000",{key:String(this)})}}}unlisten(e){var t;const n=e.id();if(((t=this._listeners)==null?void 0:t[n])!=null){delete this._listeners[n];this._listener_count--}}turned_dependency(){var e;(e=this._turned_dependency)!=null?e:this._turned_dependency=(0,a.Dependency)();return this._turned_dependency}is_registered(e){return this.turned_dependency().is_registered(e)}_was_updated(){var e;const t=(e=this._listeners)!=null?e:{};for(const e in t){const n=t[e];n.notify(this)}if(this.is_turned()){var n;(n=this._turned_dependency)==null?void 0:n.invalidate()}if(this.is_dead()){delete this._listeners;delete this._turned_dependency}}_update_dead(){var e;if(!this.is_dead()){throw new l.UnexpectedError("not dead")}const t=(e=this._listeners)!=null?e:{};for(const e in t){const n=t[e];n.notify_dead(this)}delete this._listeners;delete this._turned_dependency}to_promise(){const e=g(null,this);N(this,(()=>e.resolve()));return e}toString(){return`KeyBase of type ${this.constructor.name}`}}n.KeyBase=T;function N(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}const r=Math.max(t.length,1);const i=t.slice(0,r-1);const s=t[r-1];if(s==null){return}const o=i.flat();const a=q(o);if(a.is_turned()){s()}else{a.listen(new P(s))}}class P extends T{constructor(e){super();this.fn=void 0;this.fn=e}is_dead(){return this.fn!=null}is_turned(){return this.fn!=null}max_expected_time(){return null}notify(e){if(e.is_turned()){var t;(t=this.fn)==null?void 0:t.call(this);this.fn=null;this._was_updated()}}notify_dead(){}toString(){var e;return`Waiter {${String((e=this.fn)==null?void 0:e.toString().slice(0,100))}...}`}}function I(e,t,n){const r=t!=null?t:40;const i=setTimeout((function(){if(typeof e==="function"){e=e()}d.info("Key failed to return after timeout",{wait_seconds:r,name:e});n==null?void 0:n()}),r*1e3);return()=>clearTimeout(i)}class R extends T{constructor(e,t,n){super();this.timeout_length=void 0;this.name=void 0;this.end_time=void 0;this.timeout=void 0;this._turned=void 0;this.timeout_length=e;this.name=t;if(this.timeout_length&&this.timeout_length!==Infinity){this.end_time=Date.now()+1e3*this.timeout_length;this.timeout=I(this.name,this.timeout_length,n)}this._turned=false}is_turned(){return this._turned}is_dead(){return this._turned}max_expected_time(){if(this.is_turned()||!this.end_time){return null}if(this.timeout_length===Infinity){return Infinity}return this.end_time-Date.now()}turn(){var e;if(this._turned){return}this._turned=true;this._was_updated();(e=this.timeout)==null?void 0:e.call(this)}toString(){if(this.name!=null){const e=typeof this.name==="function"?this.name():this.name;return"Key "+e}else{return"Anonymous Key"}}}n.Key=R;function L(e,t){if(!t){d.error("anonymous switch created: please name it")}if(e){throw new l.UnexpectedError("switch timeout not implemented")}return new z(t)}class z extends T{constructor(e){super();this.name=void 0;this._turned=void 0;this._destroyed=void 0;this.name=e;this._turned=false;this._destroyed=false}is_turned(){return this._turned}is_dead(){return this._destroyed}max_expected_time(){return null}turn_off(){if(!this._turned){return}if(this._destroyed){throw new l.UnexpectedError("cannot turn off a destroyed switch")}this._turned=false;this._was_updated()}turn_on(){if(this._turned){return}this._turned=true;this._was_updated()}destroy(){this._destroyed=true;if(!this._turned){this.turn_on()}else{this._update_dead()}}toString(){if(this.name){return"Switch "+this.name}else{return"Anonymous Switch"}}}n.Switch=z;function B(e){return new U(e)}function q(e){return new U(e,true)}class U extends T{constructor(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;super();this.transient=void 0;this._keys=void 0;this._unturned=void 0;this._destroyed=void 0;this.transient=t;this._keys={};this._unturned=0;for(const t of e!=null?e:[]){this.add_key(t)}}is_turned(){return this._unturned===0}is_dead(){var e;return(e=this._destroyed)!=null?e:false}make_transient(){return q(Object.values(this._keys))}remove_all(){const e=this.is_turned();for(const e in this._keys){const t=this._keys[e];this._remove(t)}this._unturned=0;if(!e){this._was_updated()}}_inc(){this._unturned++;if(this._unturned===1){this._was_updated()}}_dec(){this._unturned--;if(this._unturned===0){this._was_updated()}}max_expected_time(){const e=Object.values(this._keys).map((e=>e.max_expected_time())).filter((e=>!!e));if(!e.length){return null}return Math.min(...e)}add_key(e){if(this._destroyed===true){throw new l.UnexpectedError("cannot add key to a destroyed list")}if(e.is_dead()){return}if(this._keys[e.id()]!=null){return}if(!e.is_turned()){this._inc()}else if(this.transient){return}this._keys[e.id()]=e;e.listen(this)}notify(e){if(e.is_turned()){this._dec()}else{this._inc()}if(e.is_dead()||this.transient){this._remove(e)}}notify_dead(e){this._remove(e)}_remove(e){delete this._keys[e.id()];e.unlisten(this)}add_promise(e){return this.add_key(e.ready_key())}make(e,t,n){const r=O(e,t,n);this.add_key(r);return r}get(){return Object.values(this._keys)}toString(){const e=this.get();const t=e.filter((e=>e.is_turned!=null&&!e.is_turned())).map((e=>e.toString()));return`[KeyList(${e.length}) ${t.join(", ")} ]`}destroy(){this._destroyed=true;for(const e in this._keys){const t=this._keys[e];t.unlisten(this)}this._keys={};if(this._unturned===0){this._update_dead()}else{this._unturned=0;this._was_updated()}}}n.KeyList=U},{"../../../logger":744,"../../../safe_require":777,"../b_array":835,"../b_string":841,"../backoff":842,"../errors":846,"../mode_check":851,"./async_state":829,"./b_fiber":833,"./dependency":834,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123}],833:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.Parallel=n.GetFiberTimeout=n.FiberTimeout=n.Fiber=n.Block=void 0;Object.defineProperty(n,"QUEUE_TIMEOUT",{enumerable:true,get:function(){return o.QUEUE_TIMEOUT}});Object.defineProperty(n,"SYSTEM_FIBER",{enumerable:true,get:function(){return o.SYSTEM_FIBER}});n.tag_fiber=n.tabulate_metrics=n.suspend_fiber_timeout=n.state=n.spend_time=n.set_running_app=n.set_global_fiber_timeout=n.set_fiber_queue=n.pause=n.optional_pause=n.on_post_fiber_run=n.on_fiber_created=n.kill_fiber=n.initialize_fiber_metrics=n.increment_fiber_sampling_with_timer=n.increment_fiber_sampling=n.has_time_left=n.handlers=n.get_tabulated_metrics=n.get_current_fiber_workload_used_units=n.get_current_fiber_activity=n.get_capacity_units_as_number_display=n.get_capacity_units=n.fiber_queue_soft_clean=n.fiber_queue_shutdown=n.fiber_lock=n.fiber_finalize=n.fiber_elapsed_time_ns=n.await=n.assign_fiber_ownership=n.add_metrics_headers=n.SyncRun=n.Sync=void 0;var r=e("../../errors");var i=De(e("../../mode_check"));var s=Oe(e("../../../../safe_require"));var o=e("../../../../constants/fibers");var a,l,c,u,d,p,_,f,h,m,g,v,b,y,w,x,j,A,M,E,k,O,S,D,C,T,N,P,I,R,L,z,B,q,U,F,W,$,G,V,H,X,Y,K,J,Z,Q,ee,te,ne,re,ie,se,oe,ae,le,ce,ue,de,pe,_e,fe,he,me,ge,ve,be,ye,we,xe,je,Ae,Me,Ee,ke;function Oe(e){return e&&e.__esModule?e:{default:e}}function Se(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(Se=function(e){return e?n:t})(e)}function De(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=Se(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}s.default.safe_register("./u/shared/async/b_fiber",n);const Ce=e;let Te;if(i.on_server()){Te=Ce("./server")}function Ne(){throw new r.UnexpectedError("Function should only be called on the server")}function Pe(){}const Ie=(a=Te)==null?void 0:a.Fiber;n.Fiber=Ie;const Re=(l=(c=Te)==null?void 0:c.fiber_lock)!=null?l:Ne;n.fiber_lock=Re;const Le=(u=(d=Te)==null?void 0:d.tag_fiber)!=null?u:Ne;n.tag_fiber=Le;const ze=(p=(_=Te)==null?void 0:_.increment_fiber_sampling_with_timer)!=null?p:Pe;n.increment_fiber_sampling_with_timer=ze;const Be=(f=(h=Te)==null?void 0:h.increment_fiber_sampling)!=null?f:Pe;n.increment_fiber_sampling=Be;const qe=(m=(g=Te)==null?void 0:g.initialize_fiber_metrics)!=null?m:Ne;n.initialize_fiber_metrics=qe;const Ue=(v=(b=Te)==null?void 0:b.fiber_elapsed_time_ns)!=null?v:Ne;n.fiber_elapsed_time_ns=Ue;const Fe=(y=(w=Te)==null?void 0:w.tabulate_metrics)!=null?y:Ne;n.tabulate_metrics=Fe;const We=(x=(j=Te)==null?void 0:j.get_tabulated_metrics)!=null?x:Ne;n.get_tabulated_metrics=We;const $e=(A=(M=Te)==null?void 0:M.add_metrics_headers)!=null?A:Pe;n.add_metrics_headers=$e;const Ge=(E=(k=Te)==null?void 0:k.handlers)!=null?E:{};n.handlers=Ge;const Ve=(O=(S=Te)==null?void 0:S.set_running_app)!=null?O:Ne;n.set_running_app=Ve;const He=(D=(C=Te)==null?void 0:C.assign_fiber_ownership)!=null?D:Ne;n.assign_fiber_ownership=He;const Xe=(T=(N=Te)==null?void 0:N.has_time_left)!=null?T:Ne;n.has_time_left=Xe;const Ye=(P=(I=Te)==null?void 0:I.spend_time)!=null?P:Ne;n.spend_time=Ye;const Ke=(R=(L=Te)==null?void 0:L.get_capacity_units)!=null?R:Ne;n.get_capacity_units=Ke;const Je=(z=(B=Te)==null?void 0:B.get_capacity_units_as_number_display)!=null?z:Ne;n.get_capacity_units_as_number_display=Je;const Ze=(q=(U=Te)==null?void 0:U.on_post_fiber_run)!=null?q:Ne;n.on_post_fiber_run=Ze;const Qe=(F=(W=Te)==null?void 0:W.on_fiber_created)!=null?F:Ne;n.on_fiber_created=Qe;const et=($=(G=Te)==null?void 0:G.set_fiber_queue)!=null?$:Ne;n.set_fiber_queue=et;const tt=(V=(H=Te)==null?void 0:H.fiber_queue_soft_clean)!=null?V:Ne;n.fiber_queue_soft_clean=tt;const nt=(X=(Y=Te)==null?void 0:Y.fiber_queue_shutdown)!=null?X:Ne;n.fiber_queue_shutdown=nt;const rt=(K=(J=Te)==null?void 0:J.optional_pause)!=null?K:Pe;n.optional_pause=rt;const it=(Z=(Q=Te)==null?void 0:Q.state)!=null?Z:{open_fibers:0};n.state=it;const st=(ee=(te=Te)==null?void 0:te.kill_fiber)!=null?ee:Ne;n.kill_fiber=st;const ot=(ne=(re=Te)==null?void 0:re.SyncRun)!=null?ne:Ne;n.SyncRun=ot;const at=(ie=(se=Te)==null?void 0:se.set_global_fiber_timeout)!=null?ie:Ne;n.set_global_fiber_timeout=at;const lt=(oe=(ae=Te)==null?void 0:ae.fiber_finalize)!=null?oe:Ne;n.fiber_finalize=lt;const ct=(le=(ce=Te)==null?void 0:ce.Sync)!=null?le:Ne;n.Sync=ct;const ut=(ue=(de=Te)==null?void 0:de.Parallel)!=null?ue:Ne;n.Parallel=ut;const dt=(pe=(_e=Te)==null?void 0:_e.await)!=null?pe:Ne;n.await=dt;const pt=(fe=(he=Te)==null?void 0:he.FiberTimeout)!=null?fe:Ne;n.FiberTimeout=pt;const _t=(me=(ge=Te)==null?void 0:ge.GetFiberTimeout)!=null?me:Ne;n.GetFiberTimeout=_t;const ft=(ve=(be=Te)==null?void 0:be.suspend_fiber_timeout)!=null?ve:Ne;n.suspend_fiber_timeout=ft;const ht=(ye=(we=Te)==null?void 0:we.Block)!=null?ye:Ne;n.Block=ht;const mt=(xe=(je=Te)==null?void 0:je.pause)!=null?xe:Ne;n.pause=mt;const gt=(Ae=(Me=Te)==null?void 0:Me.get_current_fiber_activity)!=null?Ae:Ne;n.get_current_fiber_activity=gt;const vt=(Ee=(ke=Te)==null?void 0:ke.get_current_fiber_workload_used_units)!=null?Ee:Ne;n.get_current_fiber_workload_used_units=vt},{"../../../../constants/fibers":67,"../../../../safe_require":777,"../../errors":846,"../../mode_check":851,"core-js/modules/web.dom-collections.iterator.js":1123}],834:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Dependency=a;n.DependencyClass=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=s(e("./async_state"));var i=e("../uuid");function s(e){return e&&e.__esModule?e:{default:e}}class o{constructor(){this.runs=void 0;this.count=void 0;this.no_scheduled_collection=void 0;this.runs={};this.count=0;this.no_scheduled_collection=true}register(e){var t;(t=e)!=null?t:e=r.default.CurrentAutoRun;if(e!=null){this.runs[e.id]=e;this.count++;e._has_dependency=true;if(this.no_scheduled_collection&&this.count>50){this.no_scheduled_collection=false;this.schedule_collection()}}}is_registered(e){var t;(t=e)!=null?t:e=r.default.CurrentAutoRun;return e!=null&&this.runs[e.id]!=null}needed(){if(this.count===0){return false}this.garbage_collect();return this.count>0}garbage_collect(){const e=this.runs;this.runs={};this.count=0;for(const t in e){const n=e[t];if(n._is_destroyed!==true){this.runs[t]=n;this.count++}}}schedule_collection(){setTimeout((()=>{this.no_scheduled_collection=true;this.garbage_collect()}),3e4)}once_invalidate(e){this.runs[(0,i.LUID)()]={invalidate:e}}invalidate(){const e=Object.values(this.runs);this.runs={};this.count=0;for(const t of e){t.invalidate()}}}n.DependencyClass=o;function a(){return new o}},{"../uuid":855,"./async_state":829,"core-js/modules/web.dom-collections.iterator.js":1123}],835:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.TimeoutLinkedList=n.LinkedList=void 0;n.array_remove=s;n.array_replace=o;n.isArrayLike=g;n.join_into_human_readable_list=p;n.partition=d;n.range=h;n.range_right=m;n.shuffle_array=l;n.sort_array=u;n.unique=a;n.zip=c;e("core-js/modules/es.error.cause.js");e("core-js/modules/web.dom-collections.iterator.js");var r=i(e("fast-deep-equal"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){let n;if(!e){return}while((n=e.indexOf(t))!==-1){e.splice(n,1)}}function o(e,t,n){return e.map((e=>{if(e===t){return n}else{return e}}))}function a(e){const t={};for(let n=0;n<e.length;n++){t[e[n]]=e[n]}return Object.values(t)}function l(e){let t=e.length;while(--t>0){const n=~~(Math.random()*(t+1));const r=e[n];e[n]=e[t];e[t]=r}return e}function c(e,t,n){if(e.length!==t.length){throw new Error(`zip: left array size ${e.length}; right array size ${t.length}`)}return[...Array(e.length)].map(((r,i)=>n(e[i],t[i])))}function u(e,t){const n=[];for(const r of t){if(e.includes(r)){n.push(r)}}for(const r of e){if(!n.includes(r)&&!t.includes(r)){n.push(r)}}return n}function d(e){const t=Math.ceil(e.length/2);const n=e.slice(0,t);const r=e.slice(t);return[n,r]}function p(e){if(e.length<2){return e[0]||""}else{const t=e.slice(0,-1).join(", ");const n=e.slice(-1)[0];return[t,n].join(" and ")}}class _{constructor(){this.length=void 0;this.links=void 0;this.length=0;this.links=null}push(e){if(!this.links){const t={item:e};this.links={head:t,tail:t}}else{this.links.tail.next={item:e};this.links.tail=this.links.tail.next}this.length++;return this.length}shift(){if(this.links===null){return undefined}const{item:e}=this.links.head;if(this.links.head.next){this.links.head=this.links.head.next}else{this.links=null}this.length--;return e}shift_while(e,t){while(this.links!==null&&e(this.links.head.item)){const e=this.links.head.item;this.shift();t(e)}}peek(){var e;return(e=this.links)==null?void 0:e.head.item}}n.LinkedList=_;class f{constructor(e,t){this.timeout=void 0;this.timeout_cb=void 0;this._timeout_started=false;this.list=void 0;this.list=new _;this.timeout=e;this.timeout_cb=t}get length(){return this.list.length}push(e){const t=Date.now();if(!this._timeout_started){this.start_timeout(t)}return this.list.push({item:e,start_time:t})}shift(){var e;return(e=this.list.shift())==null?void 0:e.item}start_timeout(e){this._timeout_started=true;setTimeout((()=>{this._timeout_started=false;this.list.shift_while((e=>e.start_time+this.timeout<=Date.now()),(e=>{this.timeout_cb(e.item)}));const e=this.list.peek();if(e){this.start_timeout(e.start_time)}}),e+this.timeout-Date.now())}}n.TimeoutLinkedList=f;function h(e,t){if(t===undefined){t=e;e=0}const n=[];for(let r=e;r<t;r++){n.push(r)}return n}function m(e,t){if(t===undefined){t=e;e=0}const n=[];for(let r=1;r<=t-e;r++){n.push(t-r)}return n}function g(e){return(0,r.default)(Object.fromEntries(Object.entries(Object.values(e))),e)}},{"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123,"fast-deep-equal":1190}],836:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.date_math=void 0;n.format_date=E;n.format_date_interval=k;n.get_last_day_of_utc_month=n.get_last_day_of_month=n.get_first_day_of_month=n.format_date_short_based_on_locale=void 0;n.get_previous_month_year=D;n.get_utc_tomorrow_midnight=n.get_prior_midnight_utc_date=void 0;n.human_readable_to_epoch=O;n.mk_date=R;n.print_date_interval=S;n.require_moment=_;n.to_moment=L;e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");var r=p(e("moment"));var i=d(e("./mode_check"));var s=p(e("../../lib"));var o=d(e("../../constants/time"));var a=d(e("./b_string"));var l=e("./regexUtilities");var c=e("./errors");function u(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=u(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function p(e){return e&&e.__esModule?e:{default:e}}function _(){let t;if(i.on_server()){const n=e;t=n("moment-timezone")}else{t=e("../../../vendor/jquery_plugins/moment.timezone.min")}return t}function f(e){let t;const n=[];let r="";while((t=(0,l.oneOf)('"',"'").exec(e))!=null){const i=e.indexOf(t[0],t.index+1);if(i!==-1){n.push({content:r+e.substring(0,t.index),type:"normal"});n.push({content:e.substring(t.index+1,i),type:"literal"});e=e.substring(i+1);r=""}else{r=e.substring(0,t.index+1);e=e.substring(t.index+1)}}if(e!==""){n.push({content:r+e,type:"normal"})}return n}const h="[";const m="]";const g=[["yyyy","YYYY"],["yy","YY"],["m","M"],[null,"Mo"],["mm","MM"],["mmm","MMM"],["mmmm","MMMM"],[null,"w"],[null,"wo"],[null,"ww"],["d","D"],["dd","DD"],[null,"DDD"],[null,"DDDo"],[null,"DDDD"],["ddd","ddd"],["dddd","dddd"],[null,"do"],["TT","A"],["tt","a"],["H","H"],["HH","HH"],["h","h"],["hh","hh"],["M","m"],["MM","mm"],["L","SS"],["l","SSS"],["Z","z"],[null,"zz"]];const v={t:e=>h+e.format("a")[0]+m,T:e=>h+e.format("A")[0]+m,o:e=>{const t=e.utcOffset();const n=Math.floor(Math.abs(t)/60);const r=Math.abs(t)-60*n;const i=t>=0?"+":"-";return h+i+(n<10?`0${n}`:`${n}`)+(r<10?`0${r}`:`${r}`)+m},S:e=>{const t=e.format("Do");return h+t.replace(/\d/g,"")+m}};const b=(0,l.withFlags)("g",(0,l.capture)("esc",(0,l.oneOf)(h,m)));const y=new Set(g.map((e=>e[1])));const w=new Map(g.filter((e=>e[0]!==null)));const x=(0,l.withFlags)("g",(0,l.capture)("token",(0,l.oneOf)(...[...y.values(),...w.keys(),...Object.keys(v)].sort(((e,t)=>t.length-e.length)))));function j(e){return t=>{const n=w.get(t);if(n!=null){return n}const r=v[t];if(r!=null){return r(e)}if(y.has(t)){return h+t+m}throw new c.UnexpectedError("Invalid Capturing Group detected in regex!",{fullMatch:t})}}function A(e,t){if(t.startsWith("UTC:")){t=t.substring(4);e=e.tz("UTC")}const n=f(t);let r="";for(const t of n){if(t.type==="literal"){r+=h;r+=t.content.replace(b,`${m}$<esc>${h}`);r+=m}else{r+=t.content.replace(b,`${h}$<esc>${m}`).replace(x,j(e))}}return{result:r,date:e}}const M=(e,t)=>{let{year:n,month:r,day:i,hour:s,minute:o}=t;return e.toLocaleString(undefined,{year:n?"numeric":undefined,month:r?"short":undefined,day:i?"numeric":undefined,hour:s?"2-digit":undefined,minute:o?"2-digit":undefined})};n.format_date_short_based_on_locale=M;function E(e,t,n,i){var s;(s=t)!=null?s:t="ddd mmm dd yyyy hh:MM:ss";if(e==null||isNaN(e.valueOf())){return""}else{let s=L(e,i);if(t){const{result:e,date:n}=A(s,t);t=e;s=n}if(n!=null){const e=r.default.locale();r.default.defineLocale("temp_locale",{parentLocale:e,monthsShort:n.monthNames.slice(0,12),months:n.monthNames.slice(12),weekdaysShort:n.dayNames.slice(0,7),weekdays:n.dayNames.slice(7)});const i=s.locale("temp_locale").format(t);r.default.updateLocale("temp_locale",null);r.default.locale(e);return i}else{return s.format(t)}}}function k(e,t){if(isNaN(e)){return null}switch(t){case"days":return Math.round(e/(1e3*60*60*24)*10)/10;case"hours":return Math.round(e/(1e3*60*60)*10)/10;case"minutes":return Math.round(e/(1e3*60));case"seconds":return Math.round(e/1e3)}}function O(e,t){if(!e){return null}else{if(t){return r.default.tz(e,"MM/DD/YYYY H:mm",t).valueOf()}return(0,r.default)(e,"MM/DD/YYYY H:mm").valueOf()}}function S(e){for(const t of["days","hours","minutes","seconds"]){const n=k(e,t);if(n===1){return`${n} ${t.slice(0,t.length-1)}`}else if(n!==null&&n>1||t==="seconds"){return`${n!=null?n:"NaN"} ${t}`}}return""}function D(e){const t=e!=null?e:new Date;const n=t.getFullYear();const r=t.getMonth();const i=r===0?12:r;const s=i<12?n:n-1;return{month:i,year:s}}const C=(e,t)=>new Date(e,t,0);n.get_last_day_of_month=C;const T=(e,t)=>new Date(Date.UTC(e,t,0));n.get_last_day_of_utc_month=T;const N=(e,t)=>new Date(e,t,1);n.get_first_day_of_month=N;const P=()=>{const e=new Date(Date.now()+o.DAY_MS);return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()))};n.get_utc_tomorrow_midnight=P;const I=e=>{const t=e!=null?e:new Date;const n=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()));return n};n.get_prior_midnight_utc_date=I;function R(e,t){let n;if(e instanceof Date){n=e}else if(typeof e==="number"){n=new Date(e)}else if(typeof e==="string"){if(String(parseFloat(e))===e){n=new Date(parseFloat(e))}else if(t!=null||s.default.or_throw().bubble_version()>=17){var i;(i=t)!=null?i:t=s.default.or_throw().current_timezone();if((0,r.default)(e,[r.default.ISO_8601,r.default.RFC_2822]).isValid()){n=r.default.tz(e,t).toDate()}else if(/GMT[+-]\d{4}/.test(e)||/\((?!PM|AM|am|pm)([a-z]|[A-Z]){2,3}\)/.test(e)||/ (?!PM|AM|am|pm)([a-z]|[A-Z]){2,3}$/.test(e)){n=(0,r.default)(e).toDate()}else{const i=(0,r.default)(e).format("YYYY-MM-DD[T]HH:mm:ss");n=r.default.tz(i,t).toDate()}}else{n=(0,r.default)(e).toDate()}}else{n=new Date(NaN)}if(isNaN(n.valueOf())){return null}else{return n}}function L(e,t){var n;const i=(0,r.default)(R(e));if(t!=null){i.tz(t)}return i}function z(e){if(e.isValid()){return R(e.toDate())}else{return null}}function B(e,t,n){var r;const i=L(e,s.default.or_throw().current_timezone());const o=(r=a.to_num(t))!=null?r:0;i.add(o,n);return z(i)}function q(e,t,n){const r=L(e,s.default.or_throw().current_timezone());const i=a.to_num(t);if(i==null){return z(r)}r.set(n,i);return z(r)}const U={plus_seconds(e,t){var n;const r=R(e);if(r==null||e==null){return null}const i=(n=a.to_num(t))!=null?n:0;return R(new Date(Math.round(r.valueOf()+i*o.SECOND_MS)))},plus_minutes(e,t){var n;const r=R(e);if(e==null||r==null){return null}const i=(n=a.to_num(t))!=null?n:0;return R(new Date(Math.round(r.valueOf()+i*o.MINUTE_MS)))},plus_hours(e,t){var n;const r=R(e);if(e==null||r==null){return null}const i=(n=a.to_num(t))!=null?n:0;return R(new Date(Math.round(r.valueOf()+i*o.HOUR_MS)))},plus_days(e,t){return B(e,t,"days")},plus_months(e,t){return B(e,t,"months")},plus_years(e,t){return B(e,t,"years")},change_seconds(e,t){return q(q(e,t,"second"),"0","millisecond")},change_minutes(e,t){return q(e,t,"minute")},change_hours(e,t){return q(e,t,"hour")},change_date(e,t){return q(e,t,"date")},change_month(e,t){let n=a.to_num(t);if(n==null){return R(e)}n-=1;return q(e,n,"month")},change_years(e,t){return q(e,t,"year")},extract_from_date(e,t,n){let r;switch(n.tz_type){case"static":r=n.tz_static;break;case"dynamic":r=n.tz_dynamic;break;default:r=s.default.or_throw().current_timezone()}const i=L(e,r);if(!i.isValid()){return null}switch(n.component_to_extract){case"minute":return i.minute();case"hour":return i.hour();case"day":return i.day();case"date":return i.date();case"week":return i.isoWeek();case"month":return i.month()+1;case"year":return i.year();case"UNIX":return i.valueOf();default:return null}}};n.date_math=U},{"../../../vendor/jquery_plugins/moment.timezone.min":2353,"../../constants/time":92,"../../lib":741,"./b_string":841,"./errors":846,"./mode_check":851,"./regexUtilities":852,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,moment:2264}],837:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.CDN_URL_SUFFIX=void 0;n.get_file_cdn_url=c;n.is_file_cdn_url=u;n.replace_s3_with_cdn_url=l;e("core-js/modules/es.string.replace.js");var r=a(e("../../client_config"));var i=e("../../constants/bundle");var s=a(e("./hash"));function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function l(e,t){if(!r.user_file_url)return e;return e.replace(r.user_file_url,c(t))}function c(e){if(e==="meta")return`${i.META_APPNAME_FOR_OWN_CDN}.${d}`;return`${s.digest(e!=null?e:"")}.${d}`}function u(e){const{user_file_url:t,user_file_cdn:n}=r;return t!=null&&e.includes(t)||n!=null&&e.includes(n)||e.includes("."+d)}const d="cdn.bubble.io/";n.CDN_URL_SUFFIX=d},{"../../client_config":41,"../../constants/bundle":51,"./hash":847,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],838:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=n;const i=e("./async/b_fiber");const s=e("./incremental");const{to_num:o}=e("./b_string");r.DEFAULT_PRECISION=15;const a=e=>parseFloat(e.toPrecision(r.DEFAULT_PRECISION));r.round_all=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{count:0};if(Array.isArray(e)){s.incremental_for_each(e,((e,n,i)=>{if(typeof e==="number"){i[n]=a(e)}else{r.round_all(i[n],t)}}))}else if(e&&(e.constructor===Object||e.constructor==null)){for(const n in e){if(typeof e[n]==="number"){t.count++;e[n]=a(e[n])}else{r.round_all(e[n],t)}}}};r.dec_to_string=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:r.DEFAULT_PRECISION;let n=e.toPrecision(t);n=n.replace(/(\.[0-9]*?)0*(e-?[0-9]+)?$/,"$1$2").replace(/\.(e-?[0-9]+)?$/,"$1");return n};r.num_equals=function(e,t){const n=o(e);const r=o(t);const i=Math.abs(n);const s=Math.abs(r);if(n===r){return true}const a=Math.abs(n-r);const l=1e-15;if(n===0||r===0||a<Number.MIN_VALUE){return a<l*Number.MIN_VALUE}return a/Math.min(i+s,Number.MAX_VALUE)<l}},{"./async/b_fiber":833,"./b_string":841,"./incremental":848,"core-js/modules/es.string.replace.js":1121}],839:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.all_keys=I;n.compare=D;n.deep_copy=_;n.deep_freeze=h;n.extend=d;n.extract_from_object=C;n.flatten=p;n.get_sorted_object_by_values=R;n.has_a_key=k;n.has_unique_string=j;n.is_empty=M;n.is_json=f;n.is_record=u;n.json_deep_copy=m;n.json_parse=v;n.json_stringify=g;n.make_new=O;n.map_values=q;n.not_empty=E;n.remove_circular_references=N;n.smush=x;n.sort_data_fields=P;n.sort_obj=T;n.stableSort=z;n.stableSortLanguages=B;n.stripFalsy=L;n.to_object=c;n.walk=w;e("core-js/modules/web.dom-collections.iterator.js");var r=l(e("./errors"));var i=l(e("../../constants/security"));var s=l(e("./uuid"));var o=e("./loggable");function a(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=a(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function c(e){const t={};for(const n of e){t[n[0]]=n[1]}return t}function u(e){return e!=null&&typeof e==="object"}function d(e,t,n,i,s,o){if(o!=null){console.log(o);throw new r.UnexpectedError("b_object.extend using more than 4 args!!!!")}if(t!=null){for(const n in t){const r=t[n];if(r!==undefined){e[n]=r}}}if(n!=null){for(const t in n){const r=n[t];if(r!==undefined){e[t]=r}}}if(i!=null){for(const t in i){const n=i[t];if(n!==undefined){e[t]=n}}}if(s!=null){for(const t in s){const n=s[t];if(n!==undefined){e[t]=n}}}return e}function p(e){return[].concat(...e!=null?e:[])}function _(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++){n[r-1]=arguments[r]}return y(null,e,...n)}function f(e){try{JSON.stringify(e);return true}catch(e){return false}}function h(e){Object.freeze(e);for(const t of Object.values(e)){if(typeof t==="object"&&t!=null){h(t)}}}function m(e){if(typeof e==="object"&&e!=null){return JSON.parse(JSON.stringify(e))}else{return e}}function g(t,n,i){var s;(s=i)!=null?s:i=false;try{return JSON.stringify(t,null,n)}catch(n){if(i){return e("util").inspect(t)}let s;if(typeof n==="object"&&n&&"message"in n){s=String(n.message)}else{s=String(n)}s+=".  Data was "+t.constructor.name+", with fields: "+Object.keys(t).join(", ");throw new r.UnexpectedError(s)}}function v(e,t){try{return JSON.parse(e)}catch(n){if(t){return e}let i="json_parse failure: ";if(typeof n==="object"&&n&&"message"in n){i+=String(n.message)}else{i+=String(n)}throw new r.UnexpectedError(i,{string:e})}}function b(e,t,n,i){if(t==null){throw new r.UnexpectedError("Trying to _deep_copy onto mising value",{dest:t,key:(0,o.to_loggable)(n),value:(0,o.to_loggable)(i)})}if(typeof i==="object"&&i!==null){if(t[n]==null){if(Array.isArray(i)){t[n]=[]}else{t[n]={}}}y(e,t[n],i)}else{if(i!==undefined){if(e&&(n==="id"||n==="_id")){const r=t[n];const i=s.LUID();t[n]=i;e[r]=i}else{t[n]=i}}}}function y(e,t){if(t==null){throw new r.UnexpectedError("Trying to dc onto mising value",{dest:(0,o.to_loggable)(t)})}for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++){i[s-2]=arguments[s]}if(Array.isArray(t)){for(const n of i){if(!Array.isArray(n)){throw new r.UnexpectedError("can only extend an array with another array")}for(let r=0;r<n.length;r++){b(e,t,r,n[r])}}}else{for(const n of i){for(const r in n){const i=n[r];b(e,t,r,i)}}}return t}function w(e,t,n){var r;(r=n)!=null?r:n="";t(e,n);if(e!=null&&typeof e==="object"){for(const r in e){const i=e[r];w(i,t,n+"."+r)}}}function x(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return A(t)}function j(e){if(typeof e!=="object"||!e)return false;const t=e;return typeof t.toUniqueString==="function"}function A(e){e=e.map((e=>{if(e==null||["string","number"].includes(typeof e)||e instanceof Date){return e}else if(Array.isArray(e)){return A(e)}else if(j(e)&&e.toUniqueString()!==""){return e.toUniqueString()}else{throw new r.UnexpectedError("bad smush: "+String(e))}}));return JSON.stringify(e)}function M(e){if(e==null||typeof e!=="object"){return false}if(Object.keys(e).length>0){return false}return true}function E(e){return typeof e==="object"&&e!=null&&!M(e)}function k(e){if(e==null||typeof e!=="object"){return false}for(const t in e){return true}return false}function O(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}return new e(...n)}}function S(e){if(typeof e!=="object"||!e)return false;const t=e;return typeof t.is_equal_to==="function"}function D(e,t){if(e===t){return true}if(S(e)){return e.is_equal_to(t)}if(j(e)&&j(t)){return e.toUniqueString()===t.toUniqueString()}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length){return false}for(let n=0;n<e.length;n++){const r=e[n];if(!D(r,t[n])){return false}}return true}if(e instanceof Date&&t instanceof Date){return e.getTime()===t.getTime()}return false}function C(e,t){let n=e;for(const e of t){if(u(n)&&n[e]!=null){n=n[e]}else{return null}}return n}function T(e){const t={};const n=[];for(const r in e){const e=r.toLowerCase();t[e]=r;n.push(e)}n.sort();const r={};for(const i of n){const n=t[i];r[n]=e[n]}return r}function N(e){try{const t=new Set;const n=JSON.stringify(e,(function(e,n){if(n!=null&&typeof n==="object"){if(t.has(n)){return null}t.add(n)}return n}));const r=JSON.parse(n);return r}catch(e){return"failed to remove circular references"}}function P(e){const t=[];let n=[];const r=i.BUILTIN_FIELDS;for(const i of e){if(r.includes(i.value)||i.value==="_id"){t.push(i)}else{n.push(i)}}n=n.sort(((e,t)=>{if(e.display.toLowerCase()>=t.display.toLowerCase()){return 1}else{return-1}}));return n.concat(t)}function I(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Object.prototype;const n=[];let r=e;while(r!=null&&r!==t){n.push(...Object.getOwnPropertyNames(r));r=Object.getPrototypeOf(r)}return n}function R(e){const t=[];for(const n in e){const r=e[n];t.push({id:n,value:r})}t.sort(((e,t)=>{const n=!(e.value!=null||t.value!=null);if(n){return 1}else{if(e.value==null){return 1}if(t.value==null){return-1}const n=typeof e.value==="string"&&typeof t.value==="string";if(!n){if(typeof t.value==="string"){return 1}else{return-1}}if(e.value.toLowerCase()<t.value.toLowerCase()){return-1}else{return 1}}}));const n={};for(const e of t){n[e.id]=e.value}return n}function L(e,t){return Object.fromEntries(Object.entries(e).filter((e=>{let[t,n]=e;return Boolean(n)})).map((e=>{let[n,r]=e;return[n,r===Object(r)&&t?L(r,t):r]})))}function z(e){if(Array.isArray(e)){return e.map(z)}if(e!=null&&typeof e==="object"){const t={};Object.keys(e).sort().forEach((n=>t[n]=z(e[n])));return t}return e}function B(e){if(Array.isArray(e)){return e}if(e!=null&&typeof e==="object"){const t={};Object.keys(e).sort().forEach((n=>t[n]=B(e[n])));return t}return e}function q(e,t){const n={};for(const r in e){n[r]=t(e[r],r)}return n}},{"../../constants/security":84,"./errors":846,"./loggable":849,"./uuid":855,"core-js/modules/web.dom-collections.iterator.js":1123,util:2348}],840:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.searchNextIncrementalNumber=void 0;const r=e=>{let{isPresent:t,startValue:n}=e;const{lastObservedPresentValue:r,firstObservedAbsentValue:o}=i({isPresent:t,startValue:n});if(r==null){return o}return s({isPresent:e=>{if(e===o){return false}else{return t(e)}},fromValue:r+1,toValue:o})};n.searchNextIncrementalNumber=r;const i=e=>{let{isPresent:t,startValue:n}=e;if(t(n)){const e=n===0?1:n*2;return{lastObservedPresentValue:n,...i({isPresent:t,startValue:e})}}else{return{firstObservedAbsentValue:n}}};const s=e=>{let{isPresent:t,fromValue:n,toValue:r}=e;let i=Number.NaN;while(n<=r){const e=Math.floor((n+r)/2);if(t(e)){n=e+1}else{i=e;r=e-1}}return i}},{}],841:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.FirstLetterCapitalize=j;n.add_thousand_sep=ee;n.cast_to_string=oe;n.charCode=E;n.compact_hours=void 0;n.compact_number=ie;n.create_compound_key=void 0;n.create_css_class_from_label=re;n.csv_to_downloadable_file=y;n.custom_type_name=F;n.decode_key=Q;n.eager_first_sentence_cut=ae;n.encode_key=Z;n.ends_with=D;n.firebase_illegal=void 0;n.firebase_remove_illegal=Y;n.fixedEncodeURIComponent=P;n.format_bytes=q;n.get_columns_header=v;n.id_safe=ne;n.increment_filename=U;n.is_email=A;n.is_url=void 0;n.is_url_safe=z;n.remove_invalid_from_num=N;n.replace_all=m;n.replace_spaces_with_hyphens=B;n.safe_contains=void 0;n.starts_with=C;n.starts_with_number=T;n.starts_with_vowel=S;n.string_contains=f;n.string_replace_range=k;n.text_contains=O;n.toTitleCase=x;n.to_num=b;n.truncate_text=w;e("core-js/modules/es.string.replace.js");e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/web.url.js");e("core-js/modules/web.url-search-params.js");var r=_(e("url"));var i=_(e("./errors"));var s=_(e("../../logger"));var o=e("./loggable");var a=e("../../constants/byte");var l=e("../../lang/btype_ids");var c=e("../../constants/time");var u=d(e("pluralize"));function d(e){return e&&e.__esModule?e:{default:e}}function p(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(p=function(e){return e?n:t})(e)}function _(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=p(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function f(e,t){if(typeof e!=="string"){if(e!=null&&typeof e==="object"&&e.indexOf!=null){s.info("string contains called incorrectly on something vaguely like a string",{str:(0,o.to_loggable)(e)})}return false}return e.includes(t)}const h=f;n.safe_contains=h;function m(e,t,n){return e.split(t).join(n!=null?n:"")}function g(e){return e.replace(/"/g,"")}function v(e,t,n){var r,i;(r=t)!=null?r:t=",";(i=n)!=null?i:n=false;if(!e||e.trim()===""){return undefined}e=e.trim();const s=e.split("\n");const o=[];for(const e of s[0].split(t)){if(n){o.push(g(e))}else{o.push(e)}}return o}function b(e){const t=typeof e==="string"?parseFloat(e):e;if(!isFinite(t)){return null}else{return t}}function y(e,t){if(typeof navigator==="undefined"){return}const n=new Blob([t],{type:"text/csv"});if(e.slice(-4)!==".csv"){e+=".csv"}const r=navigator;if(r.msSaveOrOpenBlob){const t=r.msSaveOrOpenBlob;setTimeout((()=>{t(n,e)}),1e3)}else{const t=window.URL.createObjectURL(n);const r=document.createElement("a");r.className="fake-link-to-trigger-a-download";r.rel="noopener";r.download=e;r.href=t;document.body.appendChild(r);r.click();document.body.removeChild(r);setTimeout((()=>{window.URL.revokeObjectURL(t)}),5e3)}}function w(e,t,n){if(typeof e!=="string"||e.length<=t){return e}const r=e.substr(0,t-1);if(n){return r.substr(0,r.lastIndexOf(" "))}else{return r+""}}function x(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(typeof e!=="string"){return e}let n=/(?:^|\s)./g;if(t){n=/(?:^|\s)(?:\[.*?\])?./g}return e.replace(n,(e=>{const t=e.length;return e.slice(0,t-1)+e[t-1].toUpperCase()}))}function j(e){if(typeof e!=="string"||e.length===0){return e}return e[0].toUpperCase()+e.slice(1)}function A(e){if(typeof e!=="string"){return false}const t=e.toLowerCase();const n=t.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);if(!n||n[0]!==t){return false}else{return true}}const M=function(e,t){if(typeof e!=="string"){return false}let n;if(e.slice(0,2)==="//"){n=r.parse("http:"+e);n.protocol="//"}else{n=r.parse(e)}if(!n.protocol){return false}if(t&&!t.includes(n.protocol)){return false}if(!n.host){return false}return true};n.is_url=M;function E(e){return e.charCodeAt(0)}function k(e,t,n,r){return e.substring(0,t)+r+e.substring(n)}function O(e,t){var n,r,i,s;return(n=e==null?void 0:(r=(i=e.toLowerCase()).indexOf)==null?void 0:r.call(i,(s=t==null?void 0:t.toLowerCase())!=null?s:""))!=null?n:-1}function S(e){const t=/^[aeiou]/i;return t.test(e)}function D(e,t){if(typeof e!=="string"){return false}const n=e.lastIndexOf(t);if(n===-1){return false}return n+t.length===e.length}function C(e,t){if(typeof e!=="string"){return false}if(typeof t!=="string"){return false}return e.slice(0,t.length)===t}function T(e){return/^\d/.test(e)}function N(e){const t=e[0]==="-";const n=/[^0-9., ]+/g;let r=e.replace(n,"");if(t){r="-"+r}return r}function P(e){return encodeURIComponent(e).replace(/[!'()*]/g,(e=>"%"+e.charCodeAt(0).toString(16)))}const I="[^a-z0-9\\-]";const R=new RegExp(I);const L=new RegExp(I,"g");function z(e){return!R.test(e)}function B(e){return(e!=null?e:"").toLowerCase().replace(/\s/g,"-").replace(L,"")}function q(e,t){var n;(n=t)!=null?n:t=0;if(e===0){return"0 Bytes"}const r=Math.floor(Math.log(e)/Math.log(a.KIBIBYTE));if(r===0){t=0}return`${parseFloat((e/Math.pow(a.KIBIBYTE,r)).toFixed(t))} ${a.STORAGE_UNITS[r]}`}function U(e){const t=/\(([0-9]+)\)/;const n=t.exec(e);if(n){const r=parseInt(n[1])+1;return e.replace(t,`(${r})`)}else{const t=e.split(".");return t.slice(0,t.length-1).join(".")+" (1)."+t[t.length-1]}}function F(e){if(e!=="user"){e=(0,l.custom_type)(e)}return e}const W="&";const $={1:".",2:"$",3:"#",4:"[",5:"]",6:"/"};const G=`[${Object.values($).map((e=>"\\"+e)).join("")}]`;const V=new RegExp(G);const H=new RegExp(G,"g");const X=e=>V.test(e);n.firebase_illegal=X;function Y(e){return e.replace(H,"_")}const K={};for(const[e,t]of Object.entries($)){K[t]=e}function J(e,t,n){const r=e.split(t);if(r.length===1){return e}return r.join(n)}function Z(e){if(!X(e)){return e}let t=J(e,W,W+W);for(const e in K){const n=K[e];t=J(t,e,W+n)}return t}function Q(e){let t=J(e,W+W,W);for(const[e,n]of Object.entries($)){t=J(t,W+e,n)}return t}function ee(e,t){var n;(n=t)!=null?n:t=",";if(e==null){return""}return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)}const te=/[.#$[\]/]/g;function ne(e){if(!e){throw new i.UnexpectedError("bad id: falsy value ",{id_as_string:String(e)})}return e.replace(te,"__")}function re(e){return e.replace(/ /g,"_").replace(/'/g,"_").replace(/\.\.\./g,"_").replace(/\./g,"_").toLowerCase()}function ie(e){const t=Intl.NumberFormat("en",{notation:"compact"});return t.format(e)}const se=e=>{if(e<c.DAY_H){return`${e} ${(0,u.default)("hour",e)}`}const t=e/c.DAY_H;return`${t} ${(0,u.default)("day",t)}`};n.compact_hours=se;function oe(e){if(e==null){return""}else{return String(e)}}function ae(e,t){const n=e.slice(0,t);const r=n.indexOf(". ");let i;if(r>-1){i=n.slice(0,r+1)}else{i=n}if(i.length<t)return i;if(i===e)return i;return i.slice(0,i.lastIndexOf(" "))+""}const le=e=>e.map((e=>encodeURIComponent(e))).join("/");n.create_compound_key=le},{"../../constants/byte":52,"../../constants/time":92,"../../lang/btype_ids":652,"../../logger":744,"./errors":846,"./loggable":849,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"core-js/modules/web.url-search-params.js":1126,"core-js/modules/web.url.js":1127,pluralize:2275,url:981}],842:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.jitter=i;n.jitterFloat=r;function r(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:.1;let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(t>1)t=1;else if(t<0)t=0;let r;if(n<0){r=Math.random()*-1}else if(n>0){r=Math.random()}else{r=(Math.random()-.5)*2}return e+e*r*t}function i(e,t,n){return Math.round(r(e,t,n))}},{}],843:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.ignoreError=r;function r(e){return(t,n)=>e(n)}},{}],844:[function(e,t,n){"use strict";const r=n;const i=e("../../safe_require");i.safe_register("./u/shared/decaf",r);r.object_keys=e=>e&&(typeof e==="object"||typeof e==="function")?Object.keys(e):[];r.object_values=e=>e&&(typeof e==="object"||typeof e==="function")?Object.values(e):[];r.object_entries=e=>e&&(typeof e==="object"||typeof e==="function")?Object.entries(e):[];r.array_from=e=>Array.from(e)},{"../../safe_require":777}],845:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");let r;const i=n;const s=e("./b_string");const o=e("./mode_check");i.get_domain_components=function(e){if(e.indexOf("www.")===0){e=e.slice(4)}if(o.on_server()){const t=r.parse(e);return{top_domain:t.domain,subdomains:t.subdomain}}else{const t=["ac.uk","co.uk","gov.uk","ltd.uk","me.uk","net.uk","nhs.uk","org.uk","plc.uk","police.uk","com.au","com.br"];const n=e.split(".");let r=0;for(const n of t){if(s.ends_with(e,n)){r+=1;break}}const i=n.slice(-(2+r));const o=n.slice(0,n.length-(2+r));return{top_domain:i.join("."),subdomains:o.join(".")}}}},{"./b_string":841,"./mode_check":851,"core-js/modules/web.dom-collections.iterator.js":1123}],846:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.UserError=n.UsageLimitError=n.UsageLimitAction=n.UnexpectedPostgresError=n.UnexpectedError=n.UnauthorizedEmployee=n.Unauthorized=n.StripePaymentRequiresAction=n.OwnerError=n.NotReadyError=n.ExpectedError=n.ERROR_LEVELS=n.BubbleError=void 0;n.capture_stack=g;n.clean_args=w;n.ensure_bubble_error=m;n.error_append=B;n.error_append_args=q;n.format_data_for_logging=R;n.format_for_logging=I;n.from_json_client=P;n.get_status_code=z;n.is_mapping_error=F;n.set_error_hook=p;n.throw_test_error=U;n.to_owner_display=W;e("core-js/modules/es.error.cause.js");e("core-js/modules/web.dom-collections.iterator.js");var r=a(e("util"));var i=a(e("../../constants/postgres_pool"));var s=e("./loggable");function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const l="Sorry, we ran into a temporary bug and can't complete your request.  We'll fix it as soon as we can; please try again in a bit!";const c=["error","owner_error","user_error"];n.ERROR_LEVELS=c;function u(e){return typeof e==="object"&&e!=null&&(e instanceof Error||"stack"in e&&"message"in e)}const d={default_display(){return undefined},localize_message(e,t){return undefined},get_client_args(e){return undefined}};function p(e,t){if(e in d){d[e]=t}else{throw new A("attempt to set invalid error hook",{name:e})}}function _(){var e;return(e=d.default_display())!=null?e:l}function f(e,t){var n;return(n=d.localize_message(e,t))!=null?n:`${e}: ${t}`}function h(e){var t,n;return(t=d.get_client_args(e))!=null?t:{code:(n=e.code)!=null?n:"no code found"}}function m(e){if(e instanceof x){return e}if(e instanceof j){return new A("not ready",{not_ready_key:e.not_ready_key})}if(u(e)){const t={origin:"native error",...e};const n=new A(e.message,t);if(e.stack!=null){n.stack=e.stack}return n}if(typeof e==="string"){return new A(e)}return new A("object thrown as error",{original:(0,s.to_loggable)(e)})}function g(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;const n=new Error;let{stack:r}=n;if(typeof r!=="string"){r="(no stack)"}r=r.split("\n").slice(3+t).join("\n");return e+"\n"+r}const v=1e4;const b=1e3;const y=50;function w(e){const{args:t,path:n=[],to_client:r=false,visited_objects:i=new Map}=e;if(typeof t==="function"){return t.toString().slice(0,y)}if(typeof t!=="object"||t==null){return t}const s=i.get(t);if(s){const e=["root",...s].join(".");return`recursion or repeated property: ${e}`}i.set(t,n);if(n.length>10){return"hit recursion depth > 10 when processing args"}if(i.size>v){return"hit max object nodes when processing args"}if(t instanceof Error){return m(t).to_json({to_client:r,path:n,visited_objects:i})}if(typeof t.id==="function"){try{return t.id()}catch(e){return"hit error trying to get args.id"}}if(typeof t.toUniqueString==="function"){try{return t.toUniqueString()}catch(e){return"hit error trying to get args.toUniqueString"}}if(Array.isArray(t)){const e=t.slice(0,b).map(((e,t)=>w({args:e,path:n.concat(String(t)),visited_objects:i})));if(e.length<t.length){e.push("hit max keys when processing args")}return e}else{const e={};let r=0;for(const s in t){r+=1;if(r>b){e[s]="hit max keys when processing args";break}const o=t[s];e[s]=w({args:o,path:n.concat(s),visited_objects:i})}return e}}class x extends Error{constructor(e,t){var n;super(e);this.args=void 0;this.statusCode=void 0;this.message=e;(n=this.stack)!=null?n:this.stack=g(this.error_class+" "+this.message,1);if(t!=null&&typeof t==="object"){this.args=t}else{this.args={}}}static from(e,t){return new this(e,t)}display(){return _()}toString(){return this.error_class+" "+this.message}to_json(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const{to_client:t=false,path:n=[],visited_objects:r=new Map}=e;const i=w({args:this.args,path:n,to_client:t,visited_objects:r});const s={error_class:this.error_class,args:i!=null?i:{}};if(t){return{...s,args:h(s.args),message:this.display()}}else{return{...s,stack:this.stack,message:this.message}}}extend(e){Object.assign(this.args,e);return this}}n.BubbleError=x;(()=>{x.prototype.error_class="BubbleError";x.prototype.suggested_level="error"})();class j{constructor(e){this.not_ready_key=void 0;this.suppress_dependency_error=void 0;this.not_ready_key=e}}n.NotReadyError=j;class A extends x{}n.UnexpectedError=A;A.prototype.error_class="UnexpectedError";class M extends x{}n.ExpectedError=M;M.prototype.error_class="ExpectedError";class E extends M{display(){var e;return(e=this.args.display)!=null?e:this.message}}n.OwnerError=E;(()=>{E.prototype.error_class="OwnerError";E.prototype.suggested_level="owner_error"})();let k=function(e){e["UsingDataAPI"]="using Data API";e["UsingWorkflowAPI"]="using Workflow API";e["SavingData"]="saving data";return e}({});n.UsageLimitAction=k;class O extends E{constructor(e){super(`This application is at its usage limit. Please upgrade your application to continue ${e}`)}}n.UsageLimitError=O;O.prototype.error_class="UsageLimitError";class S extends M{constructor(e,t,n){const r=e!=null?e:t;if(r){super(r,n);this.translation=void 0}else{throw new A("must have message or translation")}if(t){this.translation=t}if(!e){this.message=null}}display(){if(!this.translation){let[e,t]=this.message.split(".");if(!t){t=e;e="CORE"}this.translation=f(e,t)}return this.translation}to_json(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const{to_client:t=false}=e;const n=super.to_json(e);if(t){n.message=this.message;n.translation=this.display()}return n}}n.UserError=S;(()=>{S.prototype.error_class="UserError";S.prototype.suggested_level="user_error"})();class D extends S{}n.Unauthorized=D;D.prototype.error_class="Unauthorized";class C extends S{}n.StripePaymentRequiresAction=C;C.prototype.error_class="StripePaymentRequiresAction";class T extends D{}n.UnauthorizedEmployee=T;T.prototype.error_class="UnauthorizedEmployee";class N extends A{}n.UnexpectedPostgresError=N;N.prototype.error_class="UnexpectedPostgresError";function P(e){var t;(t=e.args)!=null?t:e.args={};e.args.server_generated=true;switch(e.error_class){case"OwnerError":case"UsageLimitError":return new E(e.message,e.args);case"StripePaymentRequiresAction":return new C(e.message,e.translation,e.args);case"UserError":return new S(e.message,e.translation,e.args);case"Unauthorized":return new D(e.message,e.translation,e.args);case"UnauthorizedEmployee":return new T(e.message,e.translation,e.args);case"ClientError":return new A("bad request from client",e.args);default:return new A("Unexpected server error: please report the code parameter to the team",e.args)}}function I(e){var t;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";const r=m(e);let i=L((t=r.stack)!=null?t:"",n);if(r.args!=null&&Object.keys(r.args).length>0){i+=R(r.args,n+"    ")+"\n"}return i}function R(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"    ";function n(e){if(e instanceof Error){return"\n"+I(e,t+"    ")}else if(typeof e==="string"&&e.includes("\n")){return"\n"+L(e,t)}else{return" "+r.inspect(e,{depth:4})}}let i="";for(const r in e){const s=e[r];if(["stack"].includes(r)){continue}i+="\n"+t+r+":"+n(s)}return i}function L(e,t){return e.split("\n").map((e=>t+e)).join("\n")}function z(e){return e.statusCode}function B(e,t){try{return t()}catch(t){if(t instanceof Error){if(typeof t.message==="string"){t.message+=`\n\t${e}`}else{t.message=e}}throw t}}function q(e,t){try{return t()}catch(t){if(t instanceof x){t.args=Object.assign({},t.args,e)}throw t}}function U(){throw new A("This is a test error")}function F(e){if("message"in e&&typeof e.message==="string"){return i.mapping_error_regex.test(e.message)}else{return false}}function W(e,t){const n=m(e);if(n instanceof E||n instanceof S){return n.display()}return t}},{"../../constants/postgres_pool":80,"./loggable":849,"core-js/modules/es.error.cause.js":1116,"core-js/modules/web.dom-collections.iterator.js":1123,util:2348}],847:[function(e,t,n){(function(t){(function(){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("create-hash");const s=e("./async/b_fiber");const o=e("./mode_check");r.digest=function(e,t){var n;(n=t)!=null?n:t="utf8";const r=i("md5");r.update(e,t);return r.digest("hex")};r.incremental_digest=function(e){const n=i("md5");let r=0;const a=new Set;function l(e){r+=1;if(r%100===0){s.optional_pause("add incremental digest")}if(a.has(e))return;if(e!=null&&typeof e==="object"){a.add(e);if(o.on_server()&&t.isBuffer(e)){n.update(e);return}n.update("os|","utf8");if(e instanceof Date){n.update("d|"+String(e))}for(const t in e){const r=e[t];n.update(t+"|","utf8");l(r)}n.update("|oe","utf8");return}if(typeof e==="string"){n.update("s|"+e.replace(/\|/g,"||"))}else{n.update("r|"+String(e))}}l(e);return n.digest("hex")}}).call(this)}).call(this,{isBuffer:e("../../../node_modules/is-buffer/index.js")})},{"../../../node_modules/is-buffer/index.js":1196,"./async/b_fiber":833,"./mode_check":851,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,"create-hash":1129}],848:[function(e,t,n){(function(t){(function(){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("./async/b_fiber");const s=e("./mode_check");const o=100;r.optional_pause_tick=function(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;let t=arguments.length>1?arguments[1]:undefined;if(s.on_server()){var n,r;(r=(n=i.Fiber.current).optional_pause_ticks)!=null?r:n.optional_pause_ticks=0;i.Fiber.current.optional_pause_ticks+=e;if(i.Fiber.current.optional_pause_ticks>=o){i.Fiber.current.optional_pause_ticks=0;i.optional_pause(t)}}};r.with_pause_tick=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return function(){const n=e(...arguments);r.optional_pause_tick(t);return n}};r.incremental_json_deep_copy=function(e){const t=r.incremental_json_stringify(e);return r.incremental_json_parse(t)};r.incremental_json_parse=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1e4;if(String(e)==="")return null;if(!s.on_server()||String(e).length<t){return JSON.parse(e)}return JSON.parse(e,((e,t)=>{r.optional_pause_tick(1,"incremental json parse");return t}))};r.incremental_json_stringify=function(e){if(!s.on_server())return JSON.stringify(e);return JSON.stringify(e,((e,t)=>{r.optional_pause_tick(1,"incremental json stringify");return t}))};r.incremental_json_length=function(e){const n=new Set;const r=[];let s=0;let o=0;function a(e){o++;if(o%100===0){i.optional_pause("incremental json length")}switch(typeof e){case"string":s+=2+e.length;return;case"boolean":case"number":s+=String(e).length;return;case"function":return;case"object":if(e==null){s+=4}else if(t.isBuffer(e)){s+=2+e.length}else if(!n.has(e)){n.add(e);r.push(e)}}}a(e);while(r.length>0){const e=r.pop();if(Array.isArray(e)){s+=2;for(let t=0;t<e.length;t++){a(e[t]);s+=t===0?0:1}}else if(e.constructor===Object||e.constructor===null){s+=2;let t=true;for(const n in e){const r=e[n];if(r!==undefined){s+=2+n.length+1;a(r);s+=t?0:1;t=false}}}}return s};r.incremental_for_each=function(){let e,t,n;for(var r=arguments.length,s=new Array(r),o=0;o<r;o++){s[o]=arguments[o]}if(s.length>2){[n,e,t]=s}else{n=50;[e,t]=s}e.forEach(((e,r,s)=>{t(e,r,s);if((r+1)%n===0){return i.optional_pause()}}))};r.incremental_map=function(){let e,t,n;for(var r=arguments.length,s=new Array(r),o=0;o<r;o++){s[o]=arguments[o]}if(s.length>2){[n,e,t]=s}else{n=50;[e,t]=s}return e.map(((e,r,s)=>{const o=t(e,r,s);if((r+1)%n===0){i.optional_pause()}return o}))};r.incremental_for_each_2=function(){let e,t,n;for(var r=arguments.length,s=new Array(r),o=0;o<r;o++){s[o]=arguments[o]}if(s.length>2){[n,e,t]=s}else{n=50;[e,t]=s}let a=0;for(const r of e){for(const e of r){t(e);a++;if(a%n===0){i.optional_pause()}}}};r.json_to_csv=function(e,t,n,r,s){var o,a,l,c;(o=t)!=null?o:t=",";(a=n)!=null?a:n=true;(l=r)!=null?l:r=false;(c=s)!=null?c:s=100;if(typeof e!=="object"){e=JSON.parse(e)}let u="";if(n){const n=[];if(r){for(const t in e[0]){const e=t+"";n.push('"'+e.replace(/"/g,'""')+'"')}}else{for(const t in e[0]){n.push(t)}}u=n.join(t)+"\n"}for(let n=0;n<e.length;n++){const o=e[n];if(n%s===0){i.optional_pause()}const a=[];if(r){for(const e in o){const t=String(o[e]);a.push('"'+t.replace(/"/g,'""')+'"')}}else{for(const e in o){const t=o[e];a.push(t)}}u=u+a.join(t)+"\n"}return u}}).call(this)}).call(this,{isBuffer:e("../../../node_modules/is-buffer/index.js")})},{"../../../node_modules/is-buffer/index.js":1196,"./async/b_fiber":833,"./mode_check":851,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],849:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.to_loggable=r;function r(e){return e}},{}],850:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("util");const s=e("./errors");const o=e("../../constants/logging");const a=100;const l=100;const c=1e4;r.UNLOGGABLE_KEYS=new Set(["authorization","x-auth-token","x-api-key","cookie","ssn","password","password2","account","old_password","new_password","new_password_again","token"]);r.level_gte=function(e,t){return o.LEVEL_SEVERITY[e]>=o.LEVEL_SEVERITY[t]};r.preprocess=(e,t)=>{const n=u(e);return d(n,t)};r.extract_bad_values=function(e){let t=[];if(Array.isArray(e==null?void 0:e.calls)){for(const s of e.calls){var n,r,i;t=t.concat((n=(r=s.client_state)==null?void 0:(i=r.other_data)==null?void 0:i.secure_list)!=null?n:[])}}if(typeof(e==null?void 0:e.password)==="string"&&e.password.length>3){t.push(e.password)}return t};function u(e){let t;if(e==null){return}else if(Array.isArray(e)){t=[];for(let n=0;n<e.length;n++){const r=e[n];t.push(u(r));if(n===a){break}}if(e.length>a){t.push(`Truncated list of ${e.length} to ${a} items`)}}else if(typeof e==="object"){t={};const n=Object.keys(e);for(let r=0;r<n.length;r++){const i=n[r];t[i]=u(e[i]);if(r===l){break}}if(n.length>l){t.truncation_message=`Truncated object of ${n.length} to ${l} items`}}else if(typeof e==="string"&&e.length>c){t=`${e.slice(0,c)} [truncated, was ${e.length}]`}else{t=e}return t}function d(e,t){p(e);return _(e,t)}function p(e){try{return JSON.stringify(e)}catch(t){const n="could not sanitize message not JSON stringifyable";throw new s.UnexpectedError(n,{message:i.inspect(e)})}}function _(e,t){let n;if(e==null){return e}if(typeof e==="string"&&t){n=e;for(const r of t){n=e.replace(r,`sanitized ${r.length}`)}}else if(Array.isArray(e)){n=[];for(const r of e){n.push(_(r,t))}}else if(typeof e==="object"){n={};for(const i in e){const s=e[i];if(r.UNLOGGABLE_KEYS.has(i)){n[i]=s!=null?`sanitized ${s.length}`:s}else{n[i]=_(s,t)}}}else{n=e}return n}},{"../../constants/logging":75,"./errors":846,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123,util:2348}],851:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});n.edit_mode_only=E;n.is_debug_mode=A;n.is_edit_mode=x;n.is_maison=M;n.is_plugin_edit_mode=j;n.on_client=_;n.on_phonegap=m;n.on_server=f;n.on_worker=w;n.running_server=y;n.running_test=g;n.set_running_server=b;var r=l(e("./errors"));var i=l(e("../../constants/bundle"));var s,o;function a(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=a(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const c=typeof window!=="undefined";const u=typeof window==="undefined"&&typeof postMessage!=="undefined";const d=(s=window)==null?void 0:s.bubble_bundle_name;const p=i.BASE_BUNDLES[d];function _(){return c&&!u}function f(){return!c&&!u}const h=((o=document)==null?void 0:o.URL)!=null&&document.URL.includes("file://");function m(){return h}function g(){return false}let v=false;function b(e){v=e}function y(){return v}function w(){return u}function x(){var e;return(e=p==null?void 0:p.is_edit_mode)!=null?e:false}function j(){var e;return(e=p==null?void 0:p.is_plugin_edit_mode)!=null?e:false}function A(){var e;return(e=p==null?void 0:p.is_debug_mode)!=null?e:false}function M(){var e;return(e=p==null?void 0:p.is_maison_editor)!=null?e:false}function E(){if(_()&&!x()&&!A()){throw new r.UnexpectedError("Oops, looks like we are in run-mode, but have required edit-mode code.  Look at the stack trace to see who is requiring this...")}}},{"../../constants/bundle":51,"./errors":846,"core-js/modules/web.dom-collections.iterator.js":1123}],852:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.asRegexSource=u;n.atomic=d;n.capture=o;n.concat=s;n.escapeString=m;n.negativeLookahead=a;n.oneOf=i;n.re=r;n.regexTemplate=c;n.unescapeLiteral=p;n.withFlags=l;e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.error.cause.js");e("core-js/modules/es.string.replace.js");function r(e){if(typeof e==="string"){return function(){return new RegExp(c(...arguments),e)}}else{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++){n[r-1]=arguments[r]}return c(e,...n)}}function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}if(t.length===0){return/^\b$/}return new RegExp(t.map(u).join("|"))}function s(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return new RegExp(t.map(u).join(""))}function o(e,t){return new RegExp(`(?<${e}>${u(t)})`)}function a(e){return new RegExp(`(?!${u(e)})`)}function l(e,t){return new RegExp(t,e)}function c(e){let t=p(e.raw[0]);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++){r[i-1]=arguments[i]}for(const[n,i]of r.entries()){t+=u(i);t+=p(e.raw[n+1])}return new RegExp(t)}function u(e){if(e instanceof RegExp){return d(e.source)}else if(typeof e==="string"){return d(m(e))}else{throw new Error("Illegal value used as regex part")}}function d(e){return`(?:${e})`}function p(e){return e.replace(/\\`/g,"`")}const _=Array.from(["\\",".[]^-{}","()<>?!=:","^$","{}*+?|"].join(""));const f=_.map((e=>`\\${e}`));const h=new RegExp(`[${f.join("")}]`,"g");function m(e){return e.replace(h,"\\$&")}},{"core-js/modules/es.error.cause.js":1116,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],853:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.compare=r;n.create_sort_function=s;n.filterNulls=i;function r(e,t){return i(((e,t)=>{switch(typeof e){case"number":return e-t;case"string":if(e<t)return-1;else if(e>t)return 1;return 0}}),"first")(e,t)}function i(e,t){return(n,r)=>{if(n==null&&r==null)return 0;if(n==null)return t==="first"?-1:1;if(r==null)return t==="first"?1:-1;return e(n,r)}}function s(e,t){return(n,i)=>{const s=e(n);const o=e(i);const a=t!=null?t:r;return a(s,o)}}},{}],854:[function(e,t,n){"use strict";const r=n;const i=e("./mode_check");const s=e("./errors");if(i.on_server()){r.timestamp=()=>Date.now()}else if(i.on_worker()){r.timestamp=function(){throw new s.UnexpectedError("not supported in web workers right now")}}else if(i.on_client()){r.timestamp=()=>Date.now()+window.server_time_offset}else{throw new s.UnexpectedError("unrecognized environment: on_server, on_worker, on_client all returned false")}},{"./errors":846,"./mode_check":851}],855:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:true});n.Random=n.LUID=void 0;n.UUID=u;n.count=E;n.get_random_seed=b;n.get_uuid_seed=h;n.is_UUID=p;n.short_uid=j;n.start_count=M;n.stop_count=k;n.uuid_regexp=void 0;e("core-js/modules/web.dom-collections.iterator.js");var r=l(e("seedrandom"));var i=a(e("../../logger"));var s=a(e("../../constants/core"));function o(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(o=function(e){return e?n:t})(e)}function a(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=o(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;if(a&&(a.get||a.set)){Object.defineProperty(r,s,a)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}function l(e){return e&&e.__esModule?e:{default:e}}const c=1e18;function u(){const e=Math.round(Math.random()*c);return`${Date.now()}x${_(e,18)}`}const d=/\d{13}x\d{18}/;n.uuid_regexp=d;function p(e){return typeof e==="string"&&d.test(e)}function _(e,t){const n=String(e);return n+new Array(t+1-n.length).join("0")}const f=function(){let e=1;return()=>{e++;return`${Date.now()}x${e}`}}();n.LUID=f;function h(e){let{seed:t,timestamp:n,iterations:r}=e;return new y(t,n,r)}const m=c;const g=1664525;const v=1013904223;function b(){return Math.round(Math.random()*c)%m}class y{constructor(e,t,n){var r;this.seed=void 0;this.timestamp=void 0;this.iterations=void 0;this.seed=e;this.timestamp=t;(r=n)!=null?r:n=0;this.iterations=n;for(let e=0;e<n;e++){this.randn()}}randn(){this.seed=(g*this.seed+v)%m;this.iterations++;return this.seed}UUID(){return`${this.timestamp}x${_(this.randn(),18)}`}}class w{constructor(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this.seed=void 0;this.iterations=void 0;if(t>s.SLOW_RANDOM_LENGTH)i.warn("dangerously high random initialization iterations",{iterations:t});this.seed=e;this.iterations=0;for(let e=0;e<t;e++){this.next()}}next(){this.seed=(0,r.default)(`${this.seed}`)();this.iterations++;return this.seed}random(e,t){this.next();return Math.floor(this.seed*(t-e)+e)}}n.Random=w;const x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function j(e,t){let n;if(e<70304){n=3}else if(e<175478784){n=5;e+=190102016}else if(e<1e14){n=10;e+=0x1edcf7bcf280000}else{return u()}const r=new Array(n);for(let t=n-1;t>=0;t--){r[t]=x.charAt(e%52);e=Math.floor(e/52)}return r.join("")+(String(t)==="-1"?"":String(t))}let A=null;function M(){A={}}function E(e){if(A){var t,n;(n=(t=A)[e])!=null?n:t[e]=0;A[e]++}}function k(){if(A){const e=Object.entries(A);e.sort(((e,t)=>t[1]-e[1]));for(const[t,n]of e){console.log(`${t}: ${n}`)}}}},{"../../constants/core":55,"../../logger":744,"core-js/modules/web.dom-collections.iterator.js":1123,seedrandom:2297}],856:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");Object.defineProperty(n,"__esModule",{value:true});var r={require:true,server_errors:true,base64:true,base64decode:true,ClientError:true,NotFound:true,Redirect:true,errors:true};n.server_errors=n.require=n.errors=n.base64decode=n.base64=n.Redirect=n.NotFound=n.ClientError=void 0;var i=R(e("./shared/mode_check"));Object.keys(i).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===i[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return i[e]}})}));var s=R(e("./shared/errors"));n.errors=s;Object.keys(s).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===s[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return s[e]}})}));var o=R(e("./client/b_window"));Object.keys(o).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===o[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return o[e]}})}));var a=e("./shared/b_object");Object.keys(a).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===a[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return a[e]}})}));var l=e("./shared/b_array");Object.keys(l).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===l[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return l[e]}})}));var c=e("./shared/b_date");Object.keys(c).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===c[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return c[e]}})}));var u=e("./shared/b_number");Object.keys(u).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===u[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return u[e]}})}));var d=e("./shared/b_search");Object.keys(d).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===d[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return d[e]}})}));var p=e("./shared/b_string");Object.keys(p).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===p[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return p[e]}})}));var _=e("./client/b_ui");Object.keys(_).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===_[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return _[e]}})}));var f=e("./editor_all/b_ui_editor");Object.keys(f).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===f[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return f[e]}})}));var h=e("./shared/domain_parser");Object.keys(h).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===h[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return h[e]}})}));var m=e("./shared/timestamp");Object.keys(m).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===m[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return m[e]}})}));var g=e("./shared/uuid");Object.keys(g).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===g[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return g[e]}})}));var v=e("./client/color");Object.keys(v).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===v[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return v[e]}})}));var b=e("./shared/async/b_async");Object.keys(b).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===b[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return b[e]}})}));var y=e("./shared/async/autorun");Object.keys(y).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===y[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return y[e]}})}));var w=e("./shared/async/autorun_cache");Object.keys(w).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===w[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return w[e]}})}));var x=e("./shared/async/dependency");Object.keys(x).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===x[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return x[e]}})}));var j=e("./client/client_storage");Object.keys(j).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===j[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return j[e]}})}));var A=e("./shared/hash");Object.keys(A).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===A[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return A[e]}})}));var M=e("./shared/incremental");Object.keys(M).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===M[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return M[e]}})}));var E=e("./server/server_notifications");Object.keys(E).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===E[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return E[e]}})}));var k=e("./client/test_state");Object.keys(k).forEach((function(e){if(e==="default"||e==="__esModule")return;if(Object.prototype.hasOwnProperty.call(r,e))return;if(e in n&&n[e]===k[e])return;Object.defineProperty(n,e,{enumerable:true,get:function(){return k[e]}})}));var O,S,D,C,T,N,P;function I(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(I=function(e){return e?n:t})(e)}function R(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=I(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}const L=e;n.require=L;let z;let B;n.server_errors=B;if(i.on_server()||i.running_test()){z=L("./shared/buffer");n.server_errors=B=L("./server/server_errors")}const q=(O=(S=z)==null?void 0:S.base64)!=null?O:o.base64;n.base64=q;const U=(D=(C=z)==null?void 0:C.base64decode)!=null?D:o.base64decode;n.base64decode=U;const F=(T=B)==null?void 0:T.ClientError;n.ClientError=F;const W=(N=B)==null?void 0:N.NotFound;n.NotFound=W;const $=(P=B)==null?void 0:P.Redirect;n.Redirect=$},{"./client/b_ui":813,"./client/b_window":814,"./client/client_storage":816,"./client/color":817,"./client/test_state":821,"./editor_all/b_ui_editor":822,"./server/server_notifications":825,"./shared/async/autorun":830,"./shared/async/autorun_cache":831,"./shared/async/b_async":832,"./shared/async/dependency":834,"./shared/b_array":835,"./shared/b_date":836,"./shared/b_number":838,"./shared/b_object":839,"./shared/b_search":840,"./shared/b_string":841,"./shared/domain_parser":845,"./shared/errors":846,"./shared/hash":847,"./shared/incremental":848,"./shared/mode_check":851,"./shared/timestamp":854,"./shared/uuid":855,"core-js/modules/web.dom-collections.iterator.js":1123}],857:[function(e,t,n){"use strict";e("core-js/modules/es.string.replace.js");const r=n;const i=e("./client_config");const s=e("./safe_require");const o=e("./shared/environment_utilities");const a=e("./constants/domain");const l=e("./shared/domain_utilities");const c=e("./u/shared/decaf");s.safe_register("./util",r);r.get_meta_hostname_for_app=function(e){if(i.is_dedicated){return i.dedicated_subdomain}else{return i.PROD_DOMAINS.main}};let u=[];r.get_dedicated_subdomains=()=>u;r.set_dedicated_subdomains=e=>u=e;r.set_dedicated_subdomain=function(e){const t=e.replace(/\.i[so]$/,".is");const n=e.replace(/\.i[so]$/,".io");u=[t,n]};if(i.is_dedicated&&i.dedicated_subdomain){r.set_dedicated_subdomain(i.dedicated_subdomain)}r.is_meta_hostname=function(e){if(typeof e!=="string"){return false}if(/\.local$/.test(e)){return true}if(l.is_hostname_bubble_plus_subdomain(e)){return true}if(u.includes(e)){return true}if(l.is_host_aws(e)){return true}const t=e.replace(/(?:^www\.)?(?:\.*$)?/g,"");if(c.object_values(i.PROD_DOMAINS).includes(t)){return true}if(l.is_hostname_local_bubble(e)){return true}return false};let d=null;if(o.is_production()){if(i.is_dedicated){d=i.dedicated_subdomain}else{d=i.PROD_DOMAINS.main}}else{if(i.dedicated_subdomain){d=i.dedicated_subdomain}else{d=a.LOCAL_HOSTNAME}}r.get_meta_hostname_for_hostname=function(e){if(i.echo_hostname){if(r.is_meta_hostname(e)){return e}}return d};r.get_meta_hostname=()=>d},{"./client_config":41,"./constants/domain":59,"./safe_require":777,"./shared/domain_utilities":792,"./shared/environment_utilities":793,"./u/shared/decaf":844,"core-js/modules/es.string.replace.js":1121}],858:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");e("core-js/modules/es.string.replace.js");const r=n;const i=e("./u/shared/async/autorun");const s=e("./u/shared/mode_check");const o=e("./u/shared/errors");const a=e("./u/shared/b_object");const l=e("./u/shared/async/b_async");const c=e("./safe_require");const u=e("./logger");const d=e("./constants/fonts");const{DEFAULT_USER_TOKENS:p}=e("./constants/tokens");const _=e("./lang/appquery");const f=e("./lib");c.safe_register("./webfonts",r);const h=["Arial:::","Tinos:::","Raleway:::","Cousine:::","Open Sans:::","Open Sans:::600","Droid Sans:::","Droid Serif:::","EB Garamond:::","PT Sans:::","Ubuntu:::","Lato:::","Oswald:::","ABeeZee:::","Source Sans 3:::300","Source Sans 3:::400"];const m=["Arial:::","Times New Roman:::","Courier New:::","Georgia:::","Trebuchet MS:::","Verdana:::","Palatino:::","Garamond:::","Bookman:::","Avant Garde:::","Arial Black:::","Impact:::"];const g={"Source Sans Pro":"Source Sans 3","Source Serif Pro":"Source Serif 4"};r.already_loaded=[];const v=["BESbswy"," "].join("");const b=e;let y,w;if(s.on_server()){y=b("./configuration");w=b("./server/assets/core/with_cache")}r.get_font_list=A;r.get_font_families=M;r.filter_font_list=k;r.filter_out_unsupported_fonts_server=O;r.get_font_list_from_google=C;r.standardized_name=I;r.get_unquoted_face_and_variant=R;r.get_quoted_face_and_variant=L;r.get_face_and_variant=z;r.get_canonical=B;r.font_token_to_font=q;r.substitute_font_token=U;r.pretty_font=F;r.load_font=V;r.load_external=H;r.load_for_preview=K;r.clean_list=Q;r.to_google_list=ee;r.load_app_fonts=te;r.load_default_fonts=re;r.check_font_valid=ie;r.get_full_clean_list=oe;r.to_font_face=ae;r.is_user_font_token=le;r.convert_if_legacy=N;r.convert_all_legacy=P;const x=[];function j(){if(x.length===0){var e;const t=f().location.request_synchronous("server://appeditor/get_font_list","post");x.push(...(e=t==null?void 0:t.items)!=null?e:[])}return x}function A(){const e=j().filter((e=>!h.includes(e.family))).map((e=>{let{family:t,variants:n}=e;return n?n.map((e=>r.standardized_name({font_family:t,variant:e}))):r.standardized_name({font_family:t})})).flat();return h.concat(e)}function M(){const e=j();const t=h.map((e=>e.split(":::")[0])).filter(((e,t,n)=>n.indexOf(e)===t));return t.concat(e.filter((e=>!t.includes(e.family))).map((e=>e.family)))}const E={400:"regular","400italic":"italic",regular:"400",italic:"400italic"};function k(e,t){const n=new Map;for(const{family:e,files:r}of t){n.set(e,r)}const i=[];for(const t of e){var s;let[e,o]=t.split(":");const a=n.get(e);if(a==null)continue;if((s=e)!=null&&s.includes("var(")){e=r.font_token_to_font(e).font_family}if(o==null){i.push(t)}else if(a[o]!=null){i.push(t)}else if(a[E[o]]!=null){i.push(`${e}:${E[o]}`)}else if(!(o in a)){const t=Object.keys(a).filter((e=>!e.includes("italic")));if(t.includes("regular")){t[t.indexOf("regular")]=E.regular}t.sort();if(o==="regular"){o=E.regular}let n="";let r=900;if(parseInt(o)<500){for(const e of t){const t=parseInt(o-parseInt(e));if(n&&e>o){break}else if(t<r){r=t;n=e}}}else if(parseInt(o)>500){for(const e of t.reverse()){const t=parseInt(o-parseInt(e));if(n&&e<o){break}else if(t<r){r=t;n=e}}}i.push(`${e}:${n}`)}}return i}function O(e){const t=r.get_font_list_from_google();return r.filter_font_list(e,t.items)}function S(e,t){i.run_once(30,j,((n,i)=>{if(n)u.log(n);if(!i){t(r.to_google_list(e));return}const s=r.filter_font_list(r.to_google_list(e),i);t(s)}))}function D(){const e=f().http_request({url:`https://www.googleapis.com/webfonts/v1/webfonts?key=${y.google_webfont_api_key}`}).block();if(e.statusCode!==200){throw new o.UnexpectedError("Issues fetching webfonts",{response:e})}return e.body}function C(){return a.json_parse(w.text("google_font_list",{area:"google_font_list"},D))}function T(e){const t=s.on_server()?r.get_font_list_from_google().items:j();const n=r.get_face_and_variant(e);if(n.variant==null)return[];const i=t.filter((e=>e.family===n.font_family));return i.length===0?[]:i[0].variants}function N(e){const{font_family:t,variant:n}=R(e);if(t in g){return I({font_family:g[t],variant:n})}else{return e}}function P(e){for(let t=0;t<e.length;t++){e[t]=N(e[t])}}function I(e){if(e.variant){return`${e.font_family}:::${e.variant}`}else{return`${e.font_family}:::`}}function R(e){if(!e)return{};if(!e.includes(":::"))return{font_family:e,variant:null};const t=e.split(":::");return{font_family:t.slice(0,t.length-1).join(":::"),variant:t[t.length-1]||null}}function L(e){const t=r.get_unquoted_face_and_variant(e);if(e!=null&&e.includes("var("))return t;t.font_family=`'${t.font_family}'`;return t}function z(e){var t;e=N(e);if(typeof window!=="undefined"&&(t=window)!=null&&t.google_web_fonts_active){return r.get_quoted_face_and_variant(e)}else{return r.get_unquoted_face_and_variant(e)}}function B(e){if(e)return r.standardized_name(r.get_face_and_variant(e));return undefined}function q(e){const t=e.match(d.FONT_TOKEN_NAME_AND_WEIGHT)[1];if(le(t)){var n,r;const e=(n=_.get_public_setting("font_tokens_user"))!=null?n:a.json_deep_copy(p);const[i,s]=t.split("_");const o=(r=e[s][i])!=null?r:{name:d.MISSING_USER_FONT_TOKEN_TEXT,font_family:d.DEFAULT_FAMILY};return{font_token:t,token_name:o.name,font_family:o.font_family.replace(d.CUSTOM_FONT_FLAG,"")}}else{var i;const e=(i=_.get_public_setting("font_tokens"))!=null?i:d.DEFAULT_TOKENS;return{font_token:t,token_name:d.TOKEN_NAMES[t],font_family:e[t].replace(d.CUSTOM_FONT_FLAG,"")}}}function U(e){return e.replace(d.FONT_TOKEN_NAME_AND_WEIGHT,((e,t,n)=>{if(le(t)){var r;const e=(r=_.get_public_setting("font_tokens_user"))!=null?r:a.json_deep_copy(p);const[i,s]=t.split("_");const o=e[s][i];if(o.font_family.includes(d.CUSTOM_FONT_FLAG)){return o.font_family}else{return o.font_family+n}}else{var i;const e=(i=_.get_public_setting("font_tokens"))!=null?i:d.DEFAULT_TOKENS;if(e[t].includes(d.CUSTOM_FONT_FLAG)){return e[t]}else{return e[t]+n}}}))}function F(e){const{font_family:t,variant:n}=r.get_face_and_variant(e);let i=t;if(t!=null&&t.includes("var(")){const e=r.font_token_to_font(t);i=`${e.token_name} (${e.font_family})`}if(n!=null&&n!=="custom"){i+=` (${n})`}return i}r.active_key=l.MakeKey(null,"webfonts.active_key");r.fontface_key=l.MakeKey(null,"webfonts.fontface_key");r.fontface_keys={};if(typeof window!=="undefined"&&window!==null){if(window.google_web_fonts_active){r.active_key.turn()}else{window.google_web_fonts_active_cb=()=>r.active_key.turn()}for(const e of Object.keys((W=window.fontface_loaded)!=null?W:{}).concat(m)){var W,$,G;(G=($=r.fontface_keys)[e])!=null?G:$[e]=l.MakeKey(null,`webfont.fontface_key_${e}`);r.fontface_keys[e].turn()}if(window.all_fontface_loaded){r.fontface_key.turn()}else{window.fontface_webfonts_loaded_cb=function(e){if(e!=null){var t,n;(n=(t=r.fontface_keys)[e])!=null?n:t[e]=l.MakeKey(null,`webfont.fontface_key_${e}`);r.fontface_keys[e].turn()}else{r.fontface_key.turn()}}}}else{r.active_key.turn();r.fontface_key.turn()}function V(e,t){var n;let i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;(n=t)!=null?n:t=false;if(!e)return;e=r.get_canonical(e);if(!J(e)){if(r.get_face_and_variant(e).variant==="custom"){r.load_external(r.get_face_and_variant(e).font_family)}else{Z([e],i,t)}}}function H(e,t){const{font_family:n}=r.get_quoted_face_and_variant(e);r.already_loaded.push(`${n}${d.CUSTOM_FONT_FLAG}`);const i={custom:{families:[n],urls:[t]}};window.WebFont.load(i)}function X(e){const{font_family:t,variant:n}=r.get_face_and_variant(e);if(n)return`${t}:${n}`;return t}function Y(e){const t=e.filter((e=>!J(e)));if(t.length>0){Z(t,(()=>r.active_key.turn()))}else{r.active_key.turn()}}function K(e,t){P(e);const n=e.filter((e=>!J(e)));if(n.length!==0){Z(n,t)}}function J(e){return r.already_loaded.includes(e)||m.includes(e)}function Z(e){var t;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;let i=arguments.length>2?arguments[2]:undefined;(t=i)!=null?t:i=false;for(const t of e){r.already_loaded.push(t)}S(e,(t=>{if(t.length<1){t=["Lato"]}const s={google:{families:t},active(){n==null?void 0:n()}};if(i&&e.length===1){s.google.text=r.pretty_font(e[0])}window.WebFont.load(s)}))}function Q(e){return e.filter((e=>{const t=r.get_canonical(e);return t&&typeof t==="string"&&!m.includes(t)}))}function ee(e){return e.filter(Boolean).map((e=>X(e)))}function te(){i.run_once(60,(()=>{var e;return{fonts_used_in_app:f().derived("AppFonts").content(),custom_fonts_installed:(e=f().app().get_public_setting("fonts"))!=null?e:{}}}),((e,t)=>{if(e){u.log(e);t={needed_fonts:[],fonts_used_in_app:[],custom_fonts_installed:{}}}const n=t.fonts_used_in_app.concat(h);P(n);Y(n);ne(t.custom_fonts_installed)}))}function ne(e){window.WebFont.load({custom:{families:Object.keys(e),urls:Object.values(e)}})}function re(){Y(h)}function ie(e,t,n,r){const i={};i[e]=v;const s={custom:{families:[e],urls:[t],testStrings:i},active(){n==null?void 0:n(e,t)},fontinactive(){r==null?void 0:r(e,t);console.log(`fontinactive being called for ${e}, Google says the fonts didnt render`)}};window.WebFont.load(s)}const se=["regular","italic"];function oe(e){const t=[];for(const n of e){const e=r.get_face_and_variant(n);if(!se.includes(e.variant)){t.push(n);continue}const i=T(n);if(i==null){t.push(n);continue}for(const n of se){if(i.includes(n)){const i=r.standardized_name({font_family:e.font_family,variant:n});if(!t.includes(i))t.push(i)}}}return r.clean_list(t)}function ae(e,t){if(e in g){e=g[e]}if(e==null)return null;if(e.includes(d.CUSTOM_FONT_FLAG))return e;return r.standardized_name({...r.get_unquoted_face_and_variant(e),variant:t})}function le(e){var t;return!((t=Object.keys(d.DEFAULT_TOKENS))!=null&&t.includes(e))}},{"./constants/fonts":68,"./constants/tokens":93,"./lang/appquery":651,"./lib":741,"./logger":744,"./safe_require":777,"./u/shared/async/autorun":830,"./u/shared/async/b_async":832,"./u/shared/b_object":839,"./u/shared/errors":846,"./u/shared/mode_check":851,"core-js/modules/es.string.replace.js":1121,"core-js/modules/web.dom-collections.iterator.js":1123}],859:[function(e,t,n){"use strict";e("core-js/modules/web.dom-collections.iterator.js");var r=y(e("./u"));var i=v(e("./lang/appquery"));var s=y(e("./client/bubble_banner"));var o=y(e("./ddg"));var a=e("./ctx/DefaultLib");var l=y(e("./constants/epoch"));var c=y(e("./u/shared/errors"));var u=v(e("./lib"));var d=y(e("./client/oauth"));var p=y(e("./client/page_load"));var _=y(e("./client/page_load_performance"));var f=y(e("./client/set_up_page"));var h=y(e("./client/seo_runner"));var m=y(e("./shared/slug"));var g=y(e("./webfonts"));function v(e){return e&&e.__esModule?e:{default:e}}function b(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var n=new WeakMap;return(b=function(e){return e?n:t})(e)}function y(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var n=b(t);if(n&&n.has(e)){return n.get(e)}var r={};var i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e){if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;if(o&&(o.get||o.set)){Object.defineProperty(r,s,o)}else{r[s]=e[s]}}}r.default=e;if(n){n.set(e,r)}return r}e("./lang/btypes");e("./box");class w{constructor(){this.current_state="PRE_DOCUMENT_READY";this.page_id=void 0;this.states={PRE_DOCUMENT_READY:{events:{finished_ready_document:{target_state:"WAIT_FOR_DISPLAY_PAGE_CALL",action(){f.make_document_ready()}}}},WAIT_FOR_DISPLAY_PAGE_CALL:{events:{display_page_called:{target_state:"WAIT_FOR_DOCUMENT_READY",action(e){var t,n;const{page_id:r,app:i}=e;this.page_id=r;window.Lib=u.default;const s=a.DefaultLib.get();Object.assign(s,f.create_lib(i,r));u.default.set_global_lib(s);(t=(n=window).Lib_post_load)==null?void 0:t.call(n)}}}},WAIT_FOR_DOCUMENT_READY:{actions:{onEnter(){r.WaitFor(window.document_ready_key,(()=>{if(window.dont_call_page_display){this.transition("document_is_ready_dont_display_page")}else{this.transition("document_is_ready_display_page")}}))}},events:{document_is_ready_display_page:{target_state:"WAIT_FOR_USER_OATH",action(){var e,t;p.render_start(l.EPOCHS.load_runmode.name);const n=this.page_id;let r;if(n){r=i.default.get_page_by_name(n)}o.optimizations.prefetchData();f.set_webfonts_key();f.set_up_debugger();(e=(0,u.default)())==null?void 0:e.element.display(r);m.create_slug_watcher();(t=(0,u.default)())==null?void 0:t.location.load()}},document_is_ready_dont_display_page:{target_state:"WAIT_FOR_PAGE_LOAD",action(){p.render_start(l.EPOCHS.load_runmode.name)}}}},WAIT_FOR_USER_OATH:{actions:{onEnter(){d.onload((()=>{this.transition("user_successful_oath")}))}},events:{user_successful_oath:{target_state:"WAIT_FOR_USER_AND_WEBFONTS",action(){var e,t;(e=(0,u.default)())==null?void 0:e.workflow.initialize();f.initialize_tests();(t=(0,u.default)())==null?void 0:t.user.on_page_load_for_confirmation_email();f.set_temp_db()}}}},WAIT_FOR_USER_AND_WEBFONTS:{actions:{onEnter(){const e=(0,u.default)();if(e!=null){r.WaitFor(e.user.ready_key,g.active_key,g.fontface_key,(()=>{this.transition("user_and_webfonts_ready")}))}}},events:{user_and_webfonts_ready:{target_state:"WAIT_FOR_PAGE_LOAD",action(){s.add_bubble_marketing(this.page_id);p.render_end();r.stop_count()}}}},WAIT_FOR_PAGE_LOAD:{actions:{onEnter(){var e;(e=(0,u.default)())==null?void 0:e.element.on_page_done_loading(false,(()=>this.transition("page_done_loading")))}},events:{page_done_loading:{target_state:"WAIT_FOR_INITIAL_WORKFLOWS",action(){_.page_load_performance_metrics(p.fully_loaded(),this.page_id)}}}},WAIT_FOR_INITIAL_WORKFLOWS:{actions:{onEnter(){const e=(0,u.default)();if(e!=null){setTimeout((()=>r.WaitFor(e.workflow.everything_done_key(),(()=>{this.transition("initial_workflows_ready")}))),3e3)}}},events:{initial_workflows_ready:{target_state:"DONE",action(){h.do_it()}}}},DONE:{}}}transition(e){var t,n,r;const i=typeof e==="string"?{type:e}:e;const s=(t=(n=this.states[this.current_state])==null?void 0:n.events)!=null?t:{};const o=s[i.type];if(!o){throw new c.UnexpectedError("invalid transition",{current_state:this.current_state,event_type:i.type})}const a=o.target_state;const l=this.states[a];if(o.action){o.action.call(this,i)}this.current_state=a;if(l!=null&&(r=l.actions)!=null&&r.onEnter){l.actions.onEnter.call(this)}}}const x=new w;x.transition("finished_ready_document");if(typeof window!=="undefined"&&window!==null){window.display_page=function(e,t){x.transition({type:"display_page_called",app:e,page_id:t})}}},{"./box":13,"./client/bubble_banner":21,"./client/oauth":29,"./client/page_load":30,"./client/page_load_performance":31,"./client/seo_runner":36,"./client/set_up_page":37,"./constants/epoch":63,"./ctx/DefaultLib":422,"./ddg":484,"./lang/appquery":651,"./lang/btypes":653,"./lib":741,"./shared/slug":808,"./u":823,"./u/shared/errors":846,"./webfonts":858,"core-js/modules/web.dom-collections.iterator.js":1123}],860:[function(e,t,n){"use strict";const r=e("./u");e("./window");const i=e("./lang/sets");const s=e("./editor/composer/legacy");const o=e("./client/debugger");const a=e("./client/client_initializer");const l=e("./logger");const c=e("./core/core_fields");const u=e("./lib");e("./optional/services/bubble_plugin");c.add_fields_to_core();if(typeof window!=="undefined"&&window!==null){a.initialize();window.start_debugger=function(){const e=u();r.extend(e,{sets:i,composer:s});u.set_global_lib(e);o.install();if(window.bubble_safe_mode){l.owner_warn("This page is rendered in safe mode, custom HTML in the header and the body and HTML elements are not executed.")}}}},{"./client/client_initializer":22,"./client/debugger":23,"./core/core_fields":378,"./editor/composer/legacy":544,"./lang/sets":727,"./lib":741,"./logger":744,"./optional/services/bubble_plugin":752,"./u":823,"./window":859}],861:[function(e,t,n){(function(e){(function(){(function(e,r){typeof n==="object"&&typeof t!=="undefined"?r(n):typeof define==="function"&&define.amd?define(["exports"],r):(e=typeof globalThis!=="undefined"?globalThis:e||self,r(e.Experiment={}))})(this,(function(t){"use strict";var n=function(){function e(e){this.amplitudeInstance=e}e.prototype.getUser=function(){var e,t,n,r,i,s,o,a,l,c;return{device_id:(t=(e=this.amplitudeInstance)===null||e===void 0?void 0:e.options)===null||t===void 0?void 0:t.deviceId,user_id:(r=(n=this.amplitudeInstance)===null||n===void 0?void 0:n.options)===null||r===void 0?void 0:r.userId,version:(s=(i=this.amplitudeInstance)===null||i===void 0?void 0:i.options)===null||s===void 0?void 0:s.versionName,language:(a=(o=this.amplitudeInstance)===null||o===void 0?void 0:o.options)===null||a===void 0?void 0:a.language,platform:(c=(l=this.amplitudeInstance)===null||l===void 0?void 0:l.options)===null||c===void 0?void 0:c.platform,os:this.getOs(),device_model:this.getDeviceModel()}};e.prototype.getOs=function(){var e,t,n,r,i,s;return[(n=(t=(e=this.amplitudeInstance)===null||e===void 0?void 0:e._ua)===null||t===void 0?void 0:t.browser)===null||n===void 0?void 0:n.name,(s=(i=(r=this.amplitudeInstance)===null||r===void 0?void 0:r._ua)===null||i===void 0?void 0:i.browser)===null||s===void 0?void 0:s.major].filter((function(e){return e!==null&&e!==undefined})).join(" ")};e.prototype.getDeviceModel=function(){var e,t,n;return(n=(t=(e=this.amplitudeInstance)===null||e===void 0?void 0:e._ua)===null||t===void 0?void 0:t.os)===null||n===void 0?void 0:n.name};return e}();var r=function(){function e(e){this.amplitudeInstance=e}e.prototype.track=function(e){this.amplitudeInstance.logEvent(e.name,e.properties)};e.prototype.setUserProperty=function(e){var t;var n;this.amplitudeInstance.setUserProperties((t={},t[e.userProperty]=(n=e.variant)===null||n===void 0?void 0:n.value,t))};e.prototype.unsetUserProperty=function(e){var t;this.amplitudeInstance["_logEvent"]("$identify",null,null,{$unset:(t={},t[e.userProperty]="-",t)})};return e}();
